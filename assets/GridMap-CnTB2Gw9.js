import{d as _,n as E,g as M,m as H,S as R,V as A,C as G}from"./index-D_sw2g-2.js";import{G as j}from"./lil-gui.esm-D2cLj-mk.js";import{d as q}from"./index-CVL_6l40.js";import{Y as k}from"./index-DFKcNkqO.js";import{c as U}from"./index-D9ClEd7w.js";import{a as Y,D as W}from"./DashboardDataManager-mkjvCydQ.js";import{u as X,H as Z}from"./HTTPFileSystem-ChhivMzi.js";import{L as Q,P as F}from"./ColorsAndWidths-D0mbSer2.js";import{C as O}from"./Coords-C-Mhj230.js";import{C as J}from"./CollapsiblePanel-DSPRew5z.js";import{D as K}from"./DrawingTool-C9sJ7itr.js";import{Z as tt}from"./ZoomButtons-B4PrQ7mG.js";import{d as et}from"./index-CCqgbF9K.js";import{e as $,d as it}from"./threeDBuildings-eDgufgS4.js";import{M as st}from"./mapbox-overlay-HS93bZkL.js";import{C as at}from"./column-layer-CJ5MI3Z4.js";import{J as ot,S as lt,U as nt}from"./layer-T9N9JmIf.js";import{B as rt}from"./BackgroundLayers-Dp9DDZZa.js";import"./group-hI8ly2Wr.js";import"./index-_doEQLKC.js";import"./fxp-DjoqftHf.js";import"./cubehelix-BzW-tINw.js";import"./threshold-CrWFx_nu.js";import"./rainbow-DNS2KC2A.js";import"./geojson-layer-DvtTfj7b.js";import"./turf.es-BzqbG201.js";import"./geo-utils-DZRrIAx0.js";import"./sequential-pySAYR1V.js";import"./pow-RbZoge3Z.js";import"./precisionRound-CRsIqO1V.js";class ht extends ot{constructor(t={}){const{id:i=lt("cube-geometry"),indices:s=!0}=t;super(s?{...t,id:i,topology:"triangle-list",indices:{size:1,value:mt},attributes:{...vt,...t.attributes}}:{...t,id:i,topology:"triangle-list",indices:void 0,attributes:{...yt,...t.attributes}})}}const mt=new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),dt=new Float32Array([-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1]),ut=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0]),ct=new Float32Array([0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1]),gt=new Float32Array([1,-1,1,-1,-1,1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,-1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,1,1,1,1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,-1,1,-1,1,1,1,-1,1,1,-1,-1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1]),pt=new Float32Array([1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,1,0,0]),ft=new Float32Array([1,0,1,1,0,0,1,1,0,0,0,1,1,0,0,1,1,0,1,1,0,0,0,1,1,1,1,1,1,0,1,1,1,0,0,1,1,1,0,1,1,1,1,1,1,0,0,1,0,1,1,1,1,1,1,1,1,1,0,1,0,1,0,1,0,1,1,1,1,1,0,1,0,0,1,1,0,1,1,1,0,1,0,1,0,0,0,1,0,0,1,1,0,1,0,1,1,1,1,1,0,1,1,1,0,0,1,1,0,0,1,1,1,0,1,1,1,1,1,1,1,0,0,1,0,0,0,1,0,1,0,1,1,1,0,1,1,0,0,1,0,1,0,1]),vt={POSITION:{size:3,value:dt},NORMAL:{size:3,value:ut},TEXCOORD_0:{size:2,value:ct}},yt={POSITION:{size:3,value:gt},TEXCOORD_0:{size:2,value:pt},COLOR_0:{size:3,value:ft}},Ct={cellSize:{type:"number",min:0,value:1e3},offset:{type:"array",value:[1,1]}};class V extends at{_updateGeometry(){const t=new ht;this.state.fillModel.setGeometry(t)}draw({uniforms:t}){const{elevationScale:i,extruded:s,offset:l,coverage:a,cellSize:h,angle:m,radiusUnits:c}=this.props,d=this.state.fillModel,v={radius:h/2,radiusUnits:nt[c],angle:m,offset:l,extruded:s,stroked:!1,coverage:a,elevationScale:i,edgeDistance:1,isStroke:!1,widthUnits:0,widthScale:0,widthMinPixels:0,widthMaxPixels:0};d.shaderInputs.setProps({column:v}),d.draw(this.context.renderPass)}}V.layerName="GridCellLayer";V.defaultProps=Ct;const Tt=_({name:"clickThroughTimes",props:{range:{type:Array,required:!0},allTimes:[]},data:()=>({state:{datasetRange:[0,86400],label:"",timeFilter:[0,3599],timeLabel:[0],currentTime:0,allTimesIndex:0},id:"id-"+Math.floor(1e12*Math.random())}),computed:{fullDatasetTimeSpan(){return console.log(this.state.datasetRange),this.state.datasetRange[1]-this.state.datasetRange[0]},hasNonZeroTimeRange(){return!!this.fullDatasetTimeSpan}},mounted(){this.setupInitialValues()},watch:{"state.allTimesIndex"(){this.emitValues()}},methods:{setupInitialValues(){this.state.label=this.convertSecondsToClockTimeMinutes(this.$props.allTimes[0]),this.state.timeFilter=this.allTimes[this.state.allTimesIndex],this.emitValues()},getPreviousHour(){this.state.allTimesIndex>0?(this.state.allTimesIndex--,this.state.label=this.convertSecondsToClockTimeMinutes(this.$props.allTimes[this.state.allTimesIndex])):this.state.label=this.convertSecondsToClockTimeMinutes(this.$props.allTimes[0]),this.state.timeFilter=this.allTimes[this.state.allTimesIndex]},getNextHour(){this.state.allTimesIndex<this.$props.allTimes.length-1?(this.state.allTimesIndex++,this.state.label=this.convertSecondsToClockTimeMinutes(this.$props.allTimes[this.state.allTimesIndex])):this.state.label=this.convertSecondsToClockTimeMinutes(this.$props.allTimes[this.state.allTimesIndex]),this.state.timeFilter=this.allTimes[this.state.allTimesIndex]},emitValues(){this.$emit("timeUpdate",{extent:this.state.timeFilter,index:this.state.allTimesIndex})},convertSecondsToClockTimeMinutes(e){const t=Math.floor(e/3600),i=Math.floor((e-t*3600)/60),s={h:`${t}`,m:`${i}`.padStart(2,"0")};return`${s.h}:${s.m}`},updateData(){this.state.timeLabel=[this.convertSecondsToClockTimeMinutes(this.allTimes[0])],this.state.timeFilter=[this.allTimes[0]]}}});var bt=function(){var t=this,i=t._self._c;return t._self._setupProxy,i("div",{staticClass:"click-through-times-component"},[i("div",{staticClass:"label-area"},[i("div",{staticClass:"label"},[t._v(t._s(t.state.label))]),i("div",{staticClass:"buttons-row"},[i("button",{staticClass:"button play-button",attrs:{size:"is-small",type:"is-link"},on:{click:t.getPreviousHour}},[t._v(t._s("<"))]),i("button",{staticClass:"button play-button2",attrs:{id:"btn-next-time",size:"is-small",type:"is-link"},on:{click:t.getNextHour}},[t._v(t._s(">"))])])])])},Dt=[],wt=E(Tt,bt,Dt,!1,null,"8ae024eb");const xt=wt.exports,I=6,St=_({name:"TimeSliderV2",props:{range:{type:Array,required:!0},allTimes:[]},data:()=>({state:{componentWidth:0,dragStartX:0,dragType:0,isDragging:!1,isSetupComplete:!1,leftPosition:0,rightPosition:1,datasetRange:[0,86400],labels:["",""],animationElapsedTime:0,startTime:0,timeFilter:[0,3599],animator:null,timeLabels:[0,1],currentTime:0},id:"id-"+Math.floor(1e12*Math.random()),resizer:null,ANIMATE_SPEED:5,isAnimating:!1}),computed:{fullDatasetTimeSpan(){return this.state.datasetRange[1]-this.state.datasetRange[0]+this.allTimes[0]},extentLeftToRight(){return this.state.rightPosition-this.state.leftPosition},hasNonZeroTimeRange(){return!!this.fullDatasetTimeSpan},calculateActiveMargins(){const e=this.state.componentWidth-2*I,t=Math.floor(e*this.state.leftPosition),i=Math.floor(e*(1-this.state.rightPosition));return{marginLeft:`${t}px`,marginRight:`${i}px`}}},mounted(){this.allTimes.unshift(0),this.range[0]=0,this.getDimensions(),this.setupInitialValues(),this.setupResizer(),window.addEventListener("mouseup",this.dragEnd),window.addEventListener("mousemove",this.dragging)},beforeDestroy(){this.resizer?.disconnect(),window.removeEventListener("mouseup",this.dragEnd),window.removeEventListener("mousemove",this.dragging),this.state.animator&&window.cancelAnimationFrame(this.state.animator)},watch:{"state.currentTime"(){this.updateExtent()},labels(){this.updateLabels()},"state.leftPosition"(){this.emitValues()},"state.rightPosition"(){this.emitValues()}},methods:{updateAnimation(){this.isAnimating=!this.isAnimating,this.isAnimating&&(this.state.animationElapsedTime=this.state.timeFilter[0]-this.range[0],this.state.startTime=Date.now()-this.state.animationElapsedTime/this.ANIMATE_SPEED,this.animate())},findIndexLessThanOrEqualTo(e){let t=0,i=this.allTimes.length-1,s=0;for(;t<=i;){const l=Math.floor((t+i)/2);if(this.allTimes[l]===e)return l;this.allTimes[l]<=e?(s=l,t=l+1):i=l-1}return s},animate(){if(!this.isAnimating)return;this.state.animationElapsedTime=this.ANIMATE_SPEED*(Date.now()-this.state.startTime);const e=this.state.animationElapsedTime+this.range[0];this.state.currentTime=this.findIndexLessThanOrEqualTo(e),e>this.range[1]+this.allTimes[0]&&(this.state.startTime=Date.now(),this.state.animationElapsedTime=0),this.state.timeFilter=[this.allTimes[this.state.currentTime],this.allTimes[this.state.currentTime+1]==null?0:this.allTimes[this.state.currentTime+1]],this.state.animator=window.requestAnimationFrame(this.animate)},setupResizer(){try{this.resizer=new ResizeObserver(this.getDimensions);const e=document.getElementById(`id-${this.id}`);this.resizer.observe(e)}catch(e){console.error(""+e)}},setupInitialValues(){try{this.range&&(this.state.datasetRange=this.range,this.state.timeFilter=[this.allTimes[0],this.allTimes[1]]),this.fullDatasetTimeSpan===0?(this.state.leftPosition=0,this.state.rightPosition=1):this.updateExtent()}catch(e){console.error(""+e)}finally{this.state.isSetupComplete=!0}},updateExtent(){this.state.timeFilter&&(this.state.leftPosition=1/this.fullDatasetTimeSpan*(this.allTimes[this.state.currentTime]-this.allTimes[0]),this.state.rightPosition=1/this.fullDatasetTimeSpan*(this.allTimes[this.state.currentTime+1]==null?this.allTimes[this.state.currentTime]+this.allTimes[0]:this.allTimes[this.state.currentTime+1]-this.allTimes[0]),this.state.timeLabels=[this.convertSecondsToClockTimeMinutes(this.allTimes[this.state.currentTime]),this.convertSecondsToClockTimeMinutes(this.allTimes[this.state.currentTime+1]==null?this.allTimes[this.state.currentTime]+this.allTimes[0]:this.allTimes[this.state.currentTime+1])],this.updateLabels())},updateLabels(){this.state.timeLabels&&(this.state.labels=this.state.timeLabels)},emitValues(){this.state.isSetupComplete&&this.$emit("timeExtent",this.state.timeFilter)},convertSecondsToClockTimeMinutes(e){const t=Math.floor(e/3600),i=Math.floor((e-t*3600)/60),s={h:`${t}`,m:`${i}`.padStart(2,"0")};return`${s.h}:${s.m}`},getDimensions(){this.state.componentWidth=this.$refs.slider?.clientWidth||0},dragStart(e){this.state.isDragging=!0,this.state.dragStartX=e.clientX;const t=this.state.componentWidth-2*I,i=Math.floor(t*this.state.leftPosition),s=Math.floor(t*(1-this.state.rightPosition)),l=this.state.componentWidth-s-i-2*I;e.offsetX>=0&&e.offsetX<l?this.state.dragType=0:e.offsetX<0?this.state.dragType=1:e.offsetX>l&&(this.state.dragType=2)},dragging(e){if(!this.state.isDragging)return;const t=e.clientX-this.state.dragStartX,i=this.state.componentWidth-2*I;if(this.state.dragType==0){const s=this.extentLeftToRight;let l=(i*this.state.leftPosition+t)/i,a=l+s;l<0&&(l=0,a=s),a>1&&(a=1,l=a-s),this.state.leftPosition=l,this.state.rightPosition=a,this.updateLabels(),this.updateData(),this.state.dragStartX=e.clientX;return}},dragEnd(e){const t=this.findIndexLessThanOrEqualTo(this.state.leftPosition*this.fullDatasetTimeSpan+this.allTimes[0]);this.state.leftPosition=1/this.fullDatasetTimeSpan*(this.allTimes[t]-this.allTimes[0]),this.state.rightPosition=1/this.fullDatasetTimeSpan*(this.allTimes[t+1]==null?this.allTimes[t]+this.allTimes[0]:this.allTimes[t+1]-this.allTimes[0]),this.state.timeFilter=[this.allTimes[t]-this.allTimes[0],this.allTimes[t+1]==null?this.allTimes[t]+this.allTimes[0]:this.allTimes[t+1]-this.allTimes[0]],this.state.isDragging=!1},updateData(){const e=this.findIndexLessThanOrEqualTo(this.state.leftPosition*this.fullDatasetTimeSpan+this.allTimes[0]),t=this.findIndexLessThanOrEqualTo(this.state.leftPosition*this.fullDatasetTimeSpan+this.allTimes[0])+1;this.state.timeLabels=[this.convertSecondsToClockTimeMinutes(this.allTimes[e]),this.convertSecondsToClockTimeMinutes(this.allTimes[t])],this.state.timeFilter=[this.allTimes[e],this.allTimes[t]]}}});var zt=function(){var t=this,i=t._self._c;return t._self._setupProxy,t.hasNonZeroTimeRange?i("div",{staticClass:"time-slider-component",attrs:{id:`id-${t.id}`}},[i("div",{staticClass:"label-area"},[i("p",{staticClass:"p1"},[t._v(t._s(t.state.labels[0]))]),i("p",{directives:[{name:"show",rawName:"v-show",value:t.state.labels[1]!==void 0,expression:"state.labels[1] !== undefined"}],staticClass:"p2"},[t._v(" - "+t._s(t.state.labels[1]))])]),i("div",{staticClass:"slider-area"},[i("button",{staticClass:"button play-button",attrs:{size:"is-small",type:"is-link"},on:{click:t.updateAnimation}},[t._v(t._s(t.isAnimating?"| |":">"))]),i("div",{ref:"slider",staticClass:"time-slider-dragger",on:{mousemove:t.dragging}},[i("div",{staticClass:"active-region",style:t.calculateActiveMargins,on:{mousedown:t.dragStart,mouseup:function(s){return s.stopPropagation(),t.dragEnd.apply(null,arguments)},mousemove:function(s){return s.stopPropagation(),t.dragging.apply(null,arguments)}}})])])]):t._e()},Rt=[],It=E(St,zt,Rt,!1,null,"c898e554");const Mt=It.exports,B="/simwrapper/",_t=_({name:"MyDeckComponent",props:{viewId:{type:Number,required:!0},dark:{type:Boolean,required:!0},data:{type:Object,required:!0},mapIsIndependent:{type:Boolean,required:!0},colorRamp:{type:String,required:!0},colorDataDigits:{type:Number,required:!0},negativeValues:{type:Boolean,required:!0},currentTimeIndex:{type:Number,required:!0},maxHeight:{type:Number,required:!0},cellSize:{type:Number,required:!0},opacity:{type:Number,required:!0},upperPercentile:{type:Number,required:!0},cbTooltip:{type:Function,required:!0},onClick:{type:Function,required:!1},bgLayers:{type:Object},show3dBuildings:{type:Boolean,required:!1,default:!1}},data(){return{mymap:null,deckOverlay:null,globalState:M.state,clearTooltip:null,tooltipHTML:"",tooltipStyle:{padding:"4px 8px",display:"block",top:0,left:0}}},watch:{layers(){this.deckOverlay?.setProps({layers:this.layers})},dark(){const e=`${B}map-styles/${this.globalState.isDarkMode?"dark":"positron"}.json`;this.mymap?.setStyle(e)},show3dBuildings(){this.mymap&&(this.show3dBuildings?$(this.mymap):it(this.mymap))},"globalState.viewState"(){if(this.mapIsIndependent)return;const e=this.globalState.viewState,t=this.mymap?.getCenter();(e.longitude!==t.lng||e.latitude!==t.lat||e.zoom!==this.mymap?.getZoom()||e.pitch!==this.mymap?.getPitch()||e.bearing!==this.mymap?.getBearing())&&this.mymap?.jumpTo(Object.assign({center:{lng:e.longitude,lat:e.latitude}},e))}},computed:{rowData(){return this.data},layers(){const e=[],t=this.bgLayers?.layers();t&&e.push(...t.layersBelow);const i=this.maxHeight>0&&!this.negativeValues;return e.push(new V({id:"gridlayer",data:{length:this.data.mapData[this.currentTimeIndex].length,attributes:{getPosition:{value:this.data.mapData[this.currentTimeIndex].centroid,size:2},getFillColor:{value:this.data.mapData[this.currentTimeIndex].colorData,size:this.colorDataDigits},getElevation:this.negativeValues?{value:null}:{value:this.data.mapData[this.currentTimeIndex].values,size:1}}},autoHighlight:!0,beforeId:i?void 0:"water",cellSize:this.cellSize,elevationRange:[0,this.maxHeight],elevationScale:this.maxHeight,extruded:i,highlightColor:[255,255,255,128],material:{ambient:.64,diffuse:.6,shininess:32,specularColor:[51,51,51]},onHover:this.getTooltip,opacity:this.opacity,parameters:{},pickable:!0,transitions:{elevationScale:{type:"interpolation",duration:50}},upperPercentile:this.upperPercentile})),t&&e.push(...t.layersOnTop),e}},mounted(){this.clearTooltip=et.debounce(()=>{this.tooltipHTML=""},2e3);const e=`${B}map-styles/${this.globalState.isDarkMode?"dark":"positron"}.json`,t=`map-${this.viewId}`,i=this.globalState.viewState.center;this.mymap=new H.Map({center:i,zoom:9,container:t,style:e}),this.mymap.on("move",this.handleMove),this.mymap.on("style.load",()=>{this.show3dBuildings&&this.mymap&&$(this.mymap),this.deckOverlay=new st({interleaved:!0,layers:this.layers,onClick:this.handleClick}),this.mymap?.addControl(this.deckOverlay)})},beforeDestroy(){this.deckOverlay&&this.mymap?.removeControl(this.deckOverlay),this.mymap?.remove()},methods:{getTooltip(e){if(!e?.coordinate)return this.tooltipHTML="",null;const t=this.data.mapData[this.currentTimeIndex]?.values;if(!t||e.index==null||e.index<0||e.index>=t.length||!Number.isFinite(t[e.index]))return null;const[i,s]=e.coordinate,a=t[e.index]/this.data.scaledFactor,h=Number(a.toFixed(6)),m=this.data.unit,c=Number.isFinite(s)?s.toFixed(4):"",d=Number.isFinite(i)?i.toFixed(4):"",v=`<b>${h} ${m}</b><br/>${c} / ${d}<br/>
    `;this.tooltipStyle.display="block",this.tooltipStyle.top=`${12+Math.floor(e.y)}px`,this.tooltipStyle.left=`${12+Math.floor(e.x)}px`,this.tooltipHTML=v,this.clearTooltip()},handleMove(){if(this.mapIsIndependent)return;const e=this.mymap?.getCenter(),t={latitude:e.lat,longitude:e.lng,zoom:this.mymap?.getZoom(),bearing:this.mymap?.getBearing(),pitch:this.mymap?.getPitch(),jump:!0};M.commit("setMapCamera",t)},handleClick(e,t){this.tooltipHTML="",this.onClick&&this.onClick(e,t)}}});var Et=function(){var t=this,i=t._self._c;return t._self._setupProxy,i("div",{staticClass:"deck-map flex-col"},[i("div",{staticClass:"map-container",attrs:{id:`map-${t.viewId}`}}),i("div",{directives:[{name:"show",rawName:"v-show",value:t.tooltipHTML,expression:"tooltipHTML"}],staticClass:"deck-tooltip",style:t.tooltipStyle,domProps:{innerHTML:t._s(t.tooltipHTML)}})])},Nt=[],Pt=E(_t,Et,Nt,!1,null,"ae3c9e6c");const At=Pt.exports,Ft={messages:{en:{loading:"Loading data...",sorting:"Sorting into bins...",aggregate:"Summary",maxHeight:"3D Height",showDetails:"Show Details",selection:"Selection",areas:"Areas",count:"Count"},de:{loading:"Dateien laden...",sorting:"Sortieren...",aggregate:"Daten",maxHeight:"3-D Höhe",showDetails:"Details anzeigen",selection:"Ausgewählt",areas:"Orte",count:"Anzahl"}}},Ot=_({name:"GridMapPlugin",i18n:Ft,components:{CollapsiblePanel:J,DrawingTool:K,MapComponent:At,ToggleButton:q.ToggleButton,ZoomButtons:tt,ClickThroughTimes:xt,TimeSlider:Mt},props:{root:{type:String,required:!0},subfolder:{type:String,required:!0},yamlConfig:String,config:Object,thumbnail:Boolean,datamanager:{type:Object}},data(){const e=["Inferno","Magma","Viridis","Greens","Reds","RdYlGn (div)","greenRed (div)","RdBu (div)"];return{id:Math.floor(1e12*Math.random()),standaloneYAMLconfig:{title:"",description:"",file:"",projection:"",thumbnail:"",cellSize:250,opacity:.7,maxHeight:0,userColorRamp:"Viridis",center:null,zoom:9,mapIsIndependent:!1},colorRamps:e,columnLookup:[],gzipWorker:null,colorRamp:e[0],globalState:M.state,globalMaxValue:Number.POSITIVE_INFINITY,globalMinValue:Number.NEGATIVE_INFINITY,valuesIncludeNeg:!1,tooltip:null,backgroundLayers:null,mediaQuery:null,vizDetails:{title:"",description:"",file:"",projection:"",thumbnail:"",cellSize:250,opacity:.7,maxHeight:0,userColorRamp:"viridis",center:null,zoom:9,breakpoints:null,opacityColumn:"",valueColumn:"value",secondValueColumn:"",diff:!1,unit:"",timeSelector:null},myState:{statusMessage:"",subfolder:"",yamlConfig:"",thumbnail:!1},data:null,colorDataDigits:3,selectedTimeData:[],allTimePeriodes:[],csv:{},colors:U({colormap:"Viridis",nshades:10,format:"rba",alpha:1}).map(t=>[t[0],t[1],t[2],255]),currentTime:[0,0],timeToIndex:new Map,guiConfig:{buckets:10,exponent:4,radius:150,opacity:1,height:100,show3dBuildings:!1,"color ramp":"Viridis","upper bound":100,"lower bound":-100,"bounds enabled":!0,colorRamps:e,flip:!1,steps:10,opacityColumn:"none",valueColumn:"",secondValueColumn:"",diff:!1},configId:`gui-config-${Math.floor(1e12*Math.random())}`,guiController:null,minRadius:50,maxRadius:500,radiusStep:5,isLoaded:!1,show3dBuildings:!1,thumbnailUrl:"url('assets/thumbnail.jpg') no-repeat;",timeRange:[1/0,-1/0],allTimes:[],myDataManager:this.datamanager||new W(this.root,this.subfolder),availableColumns:[]}},computed:{fileApi(){return new Z(this.fileSystem,M)},fileSystem(){const e=this.$store.state.svnProjects.filter(t=>t.slug===this.root);if(e.length===0)throw console.log("no such project"),Error;return e[0]},urlThumbnail(){return this.thumbnailUrl},mapProps(){return window.__testdata__=this.data,{viewId:this.id,colorRamp:this.colorRamp,coverage:.65,dark:this.$store.state.isDarkMode,data:this.data,currentTimeIndex:this.timeToIndex.get(this.currentTime[0])||0,mapIsIndependent:this.vizDetails.mapIsIndependent||!1,maxHeight:this.guiConfig.height,colorDataDigits:this.colorDataDigits,userColorRamp:this.guiConfig["color ramp"],cellSize:this.guiConfig.radius,opacity:this.guiConfig.opacity,upperPercentile:100,cbTooltip:this.cbTooltip,bgLayers:this.backgroundLayers,show3dBuildings:this.show3dBuildings}},textColor(){const e={text:"#3498db",bg:"#eeeef480"},t={text:"white",bg:"#181518aa"};return this.$store.state.colorScheme===G.DarkMode?t:e}},watch:{},methods:{cbTooltip(e,t){if(!t){this.tooltip=null;return}e.style.left=`${16+t.devicePixel[0]}px`,e.style.bottom=`${16+t.devicePixel[1]}px`,this.tooltip=e},toggle3dBuildings(){this.show3dBuildings=!this.show3dBuildings,this.guiConfig.show3dBuildings=this.show3dBuildings},pickColor(e,t,i,s,l){if(this.guiConfig["bounds enabled"]){const a=this.guiConfig["upper bound"],h=this.guiConfig["lower bound"];a!==1/0&&h!==-1/0&&(e=Math.max(Math.min(e,a),h),e=(e-h)/(a-h)*100)}else if(this.valuesIncludeNeg){let a;a=Math.max(Math.abs(t),Math.abs(i)),e=(e/a+1)*50}else if(Number.isNaN(e)||e<0||e>100)return[0,0,0,0];if(this.vizDetails.colorRamp.breakpoints&&this.vizDetails.colorRamp.breakpoints.length==this.vizDetails.colorRamp.fixedColors.length-1){for(let a=0;a<this.vizDetails.colorRamp.breakpoints.length-1;a++)if(e>this.vizDetails.colorRamp.breakpoints[a]&&e<=this.vizDetails.colorRamp.breakpoints[a+1])return F(this.vizDetails.colorRamp.fixedColors[a+1]);return e<this.vizDetails.colorRamp.breakpoints[0]?F(this.vizDetails.colorRamp.fixedColors[0]):e>=this.vizDetails.colorRamp.breakpoints[this.vizDetails.colorRamp.breakpoints.length-1]?F(this.vizDetails.colorRamp.fixedColors[this.vizDetails.colorRamp.fixedColors.length-1]):new Uint8Array([255,255,255,255])}else{const a=this.colors.length;if(!a)return[0,0,0,0];const h=Math.max(0,Math.min(100,e)),m=Math.min(a-1,Math.floor(h/100*a));return this.colors[m]}},async solveProjection(){if(console.log("solveProjection"),!this.thumbnail){console.log("WHAT PROJECTION:");try{const e=await this.fileApi.getFileText(this.myState.subfolder+"/"+this.myState.yamlConfig);this.vizDetails=k.parse(e)}catch(e){console.error(e)}}},async getVizDetails(){if(this.config){this.validateYAML(),this.vizDetails=Object.assign({colorRamp:""},this.config),this.setRadiusAndHeight(),this.setCustomGuiConfig(),this.show3dBuildings=!!(this.vizDetails.buildings3d??this.vizDetails.show3dBuildings),this.guiConfig.show3dBuildings=this.show3dBuildings;return}new RegExp(".*(yml|yaml)$").test(this.myState.yamlConfig)?await this.loadStandaloneYAMLConfig():this.loadOutputTripsConfig()},loadOutputTripsConfig(){let e="";this.myState.thumbnail||(e=prompt('Enter projection: e.g. "EPSG:31468"')||"EPSG:31468",parseInt(e,10)&&(e="EPSG:"+e)),this.vizDetails={title:"Output Trips",description:this.myState.yamlConfig,file:this.myState.yamlConfig,projection:e,cellSize:this.vizDetails.cellSize,colorRamp:this.vizDetails.colorRamp,opacity:this.vizDetails.opacity,maxHeight:this.vizDetails.maxHeight,userColorRamp:this.vizDetails.userColorRamp,center:this.vizDetails.center,zoom:this.vizDetails.zoom,opacityColumn:this.vizDetails.opacityColumn,valueColumn:this.vizDetails.valueColumn,secondValueColumn:this.vizDetails.secondValueColumn,diff:this.vizDetails.diff,unit:this.vizDetails.unit,timeSelector:this.vizDetails.timeSelector},this.$emit("title",this.vizDetails.title),this.solveProjection()},setRadiusAndHeight(){this.vizDetails.cellSize||A.set(this.vizDetails,"cellSize",250),this.vizDetails.maxHeight||A.set(this.vizDetails,"maxHeight",0),this.vizDetails.opacity||A.set(this.vizDetails,"opacity",.7)},async loadStandaloneYAMLConfig(){try{const e=this.myState.yamlConfig.includes("/")?this.myState.yamlConfig:`${this.myState.subfolder}/${this.myState.yamlConfig}`,t=await this.fileApi.getFileText(e);this.standaloneYAMLconfig=k.parse(t),this.validateYAML(),this.setVizDetails()}catch{const t=`File not found: ${this.myState.subfolder}/${this.myState.yamlConfig}`;this.$emit("error",t)}},validateYAML(){const e=new RegExp(".*(yml|yaml)$").test(this.myState.yamlConfig);let t={};e?(console.log("has yaml"),t=this.standaloneYAMLconfig):(console.log("no yaml"),t=this.config),t.cellSize==0&&this.$store.commit("setStatus",{type:R.WARNING,msg:"Radius is out of the recommended range",desc:"Radius can not be zero, preset value used instead. "}),(t.opacity<=0||t.opacity>1)&&this.$store.commit("setStatus",{type:R.WARNING,msg:"Opacity set to zero",desc:"Opacity levels should be between 0 and 1. "}),(t.zoom<5||t.zoom>20)&&this.$store.commit("setStatus",{type:R.WARNING,msg:"Zoom is out of the recommended range ",desc:"Zoom levels should be between 5 and 20. "}),t.maxHeight<0&&this.$store.commit("setStatus",{type:R.WARNING,msg:"maxHeight is out of the recommended range ",desc:"maxHeight should be greater than 0"})},setVizDetails(){this.vizDetails=Object.assign({},this.vizDetails,this.standaloneYAMLconfig),this.setRadiusAndHeight(),this.show3dBuildings=!!(this.vizDetails.buildings3d??this.vizDetails.show3dBuildings),this.guiConfig.show3dBuildings=this.show3dBuildings;const e=this.vizDetails.title?this.vizDetails.title:"Grid Map";this.$emit("title",e)},async buildThumbnail(){if(this.thumbnail&&this.vizDetails.thumbnail)try{const t=await(await this.fileApi.getFileBlob(this.myState.subfolder+"/"+this.vizDetails.thumbnail)).arrayBuffer(),i=X.arrayBufferToBase64(t);i&&(this.thumbnailUrl=`center / cover no-repeat url(data:image/png;base64,${i})`)}catch(e){console.error(e)}},setMapCenter(){if(this.vizDetails.center){typeof this.vizDetails.center=="string"&&(this.vizDetails.center=this.vizDetails.center.split(",").map(Number));const e={longitude:this.vizDetails.center[0],latitude:this.vizDetails.center[1],bearing:10,pitch:0,zoom:this.vizDetails.zoom||10,jump:!0,center:[this.vizDetails.center[0],this.vizDetails.center[1]]};this.$store.commit("setMapCamera",e)}},async loadAndPrepareData(){return this.vizDetails.file.indexOf(".avro")>-1?await this.loadAndPrepareAvroData():await this.loadAndPrepareCSVData()},async loadAndPrepareAvroData(){const e=`${this.subfolder}/${this.vizDetails.file}`,t=await this.fileApi.getFileBlob(e),i=await new Promise((u,n)=>{const p=[];Y.createBlobDecoder(t).on("metadata",o=>{}).on("data",o=>{p.push(o)}).on("end",()=>{u(p)})});let s=Number.NEGATIVE_INFINITY;const l=i[0];this.allTimes=l.timestamps,this.allTimes=this.allTimes.sort((u,n)=>u-n),this.timeRange[0]=this.allTimes[0],this.timeRange[1]=this.allTimes[this.allTimes.length-1];const a=Object.keys(l.data)[0],h=l.data[a];for(const u of h)s=Math.max(s,u);const m=s>0?100/s:0;this.vizDetails.unit==null&&(this.vizDetails.unit="");const c={mapData:[],scaledFactor:m,unit:this.vizDetails.unit},d=l.xCoords,v=l.yCoords,f=d.length*v.length;l.crs&&(this.vizDetails.projection=l.crs),this.vizDetails.projection||this.$emit("error",'No coordinate projection. Add "projection: EPSG:xxxx" to config');const g=new Float32Array(f*2);let T=0;for(let u=0;u<d.length;u++)for(let n=0;n<v.length;n++){let p=[d[u],v[n]];p=O.toLngLat(this.vizDetails.projection,p),g[T]=p[0],g[T+1]=p[1],T+=2}this.allTimes.forEach((u,n)=>{this.timeToIndex.set(u,n),c.mapData.push({length:f,time:u,centroid:g,values:new Float32Array(f),opacityValues:new Float32Array(f),colorData:new Uint8Array(f*3)})});for(let u=0;u<this.allTimes.length;u++){console.log("time",u);for(let n=0;n<f;n++){const p=u*f+n,o=m*h[p];c.mapData[u].values[n]=o}}return this.myState.statusMessage="",c},async loadAndPrepareCSVData(){this.allTimes=[],this.timeToIndex.clear();const e={dataset:this.vizDetails.file};let t={};try{t=await this.myDataManager.getDataset(e,{subfolder:this.subfolder})}catch(o){this.$emit("error",""+o)}t.comments&&t.comments.length&&t.comments.forEach(o=>{if(o.includes("EPSG")){const r=o.substring(o.lastIndexOf("EPSG")).trim();r&&(this.vizDetails.projection=r)}});let i=this.vizDetails.valueColumn||"";if(!t.allRows[i]){const o=Object.keys(t.allRows).filter(C=>!["x","y","time"].includes(C)),r=o.filter(C=>Array.from(t.allRows[C].values).every(x=>typeof x=="number"));i=(r.length?r[0]:o[0])||"",this.vizDetails.valueColumn=i}const s=t.allRows[this.vizDetails.valueColumn].values;let l;this.vizDetails.diff&&this.vizDetails.secondValueColumn&&(l=t.allRows[this.vizDetails.secondValueColumn].values);const a=t.allRows.time.values;this.availableColumns=Object.keys(t.allRows).filter(o=>!["x","y","time"].includes(o)),this.guiConfig.valueColumn=this.vizDetails.valueColumn,this.guiConfig.secondValueColumn=this.vizDetails.secondValueColumn||"";let h=Number.POSITIVE_INFINITY,m=Number.NEGATIVE_INFINITY;const c=new Set;if(l)for(let o=0;o<s.length;o++){const r=this.vizDetails.diff?s[o]-l[o]:s[o];m=Math.max(m,r),h=Math.min(h,r),c.add(a[o])}else for(let o=0;o<s.length;o++)m=Math.max(m,s[o]),h=Math.min(h,s[o]),c.add(a[o]);this.valuesIncludeNeg=h<0,this.allTimes=[...c].sort((o,r)=>o-r),this.timeRange[0]=Math.min.apply(Math,this.allTimes),this.timeRange[1]=Math.max.apply(Math,this.allTimes);const d=Math.ceil(s.length/this.allTimes.length);let v=h,f=m,g=0,T=100;this.valuesIncludeNeg&&(m=(m-v)*T/(f-v)),this.globalMinValue=v,this.globalMaxValue=f;const u=m!==0?100/m:0,n={mapData:[],scaledFactor:u,unit:this.vizDetails.unit||""};if(this.guiConfig.opacityColumn!="none"?this.colorDataDigits=4:this.colorDataDigits=3,this.allTimes.forEach((o,r)=>{this.timeToIndex.set(o,r),n.mapData.push({time:o,values:new Float32Array(d),opacityValues:new Float32Array(d),centroid:new Float32Array(d*2),colorData:new Uint8Array(d*this.colorDataDigits),numberOfFilledValues:0,numberOfFilledCentroids:0,numberOfFilledColors:0,length:d})}),!this.vizDetails.projection){const o='No coordinate projection. Add "projection: EPSG:xxxx" to config';throw this.$emit("error",o),Error(o)}for(let o=0;o<s.length;o++){const r=this.timeToIndex.get(a[o]);let C=s[o];l&&this.vizDetails.diff&&(C=C-l[o]);const x=u*C,L=this.pickColor(x,v,f,g,T),b=n.mapData[r].numberOfFilledValues,w=n.mapData[r].numberOfFilledColors,N=n.mapData[r].numberOfFilledCentroids;if(n.mapData[r].values[b]=x,this.guiConfig.opacityColumn!="none"){var p;let D=this.vizDetails.opacityColumn||"";if(!t.allRows[D])console.error("column for opacity values not found, defaulting to standard opacity funcitonality with slider.");else{p=t.allRows[this.vizDetails.opacityColumn].values;let z=Number.POSITIVE_INFINITY,P=Number.NEGATIVE_INFINITY;for(let y=0;y<p.length;y++)p[y]<z&&(z=p[y]),p[y]>P&&(P=p[y]);n.mapData[r].opacityValues[b]=Math.round((p[o]-z)/(P-z)*100)/100,n.mapData[r].opacityValues[b]==0&&(n.mapData[r].opacityValues[b]=.01);for(let y=0;y<4;y++)y==3?n.mapData[r].colorData[w+y]=Math.round(n.mapData[r].opacityValues[b]*255):n.mapData[r].colorData[w+y]=L[y]}}else for(let D=0;D<3;D++)n.mapData[r].colorData[w+D]=L[D];let S=[t.allRows.x.values[o],t.allRows.y.values[o]];this.vizDetails.projection!=="EPSG:4326"&&(S=O.toLngLat(this.vizDetails.projection,S)),n.mapData[r].centroid[N]=S[0],n.mapData[r].centroid[N+1]=S[1],n.mapData[r].numberOfFilledValues=b+1,n.mapData[r].numberOfFilledCentroids=N+2,this.guiConfig.opacityColumn!="none"?n.mapData[r].numberOfFilledColors=w+4:n.mapData[r].numberOfFilledColors=w+3}return Array.from(this.allTimes.keys()).forEach(o=>{delete n.mapData[o].numberOfFilledValues,delete n.mapData[o].numberOfFilledCentroids,delete n.mapData[o].numberOfFilledColors}),this.myState.statusMessage="",n},resolveProjection(){if(this.vizDetails.projection!=="EPSG:4326")for(let e=0;e<this.data.length;e++){const t=O.toLngLat(this.vizDetails.projection,this.data[e].centroid);this.data[e].centroid=t}},handleDiscreteTimeValues(e){this.currentTime=[e.extent,e.extent],this.selectedTimeData=[];for(let t=0;t<this.data.mapData.length;t++)String(this.data.mapData[t].time)==String(e.extent)&&this.selectedTimeData.push(this.data.mapData[t].values);this.setColors()},handleTimeSliderValues(e){this.currentTime=e,this.selectedTimeData=[];for(let t=0;t<this.data.length;t++)this.data[t].time==e[0]&&this.selectedTimeData.push(this.data[t])},setupGui(){let e=200;this.mediaQuery.matchMedia&&(e=175);const t={title:"Settings",injectStyles:!0,width:e,container:document.getElementById(this.configId)||void 0};this.guiController=new j(t);const i=this.guiController;i.add(this.guiConfig,"radius",this.minRadius,this.maxRadius,this.radiusStep),i.add(this.guiConfig,"opacity",0,1,.1),i.add(this.guiConfig,"height",0,250,5),i.add(this.guiConfig,"show3dBuildings").name("3D buildings").onChange(a=>this.show3dBuildings=a),i.add(this.guiConfig,"diff").name("Diff").onChange(a=>{a?l.show():l.hide(),this.handleDiffChange(a)});let s=["none"].concat(this.availableColumns);s.length>0&&i.add(this.guiConfig,"opacityColumn",s).name("Opacity column").onChange(a=>{this.handleOpacityColumnChange(a)}),this.availableColumns.length>0&&i.add(this.guiConfig,"valueColumn",this.availableColumns).name("1st column").onChange(a=>{this.handleColumnChange(a)});const l=i.add(this.guiConfig,"secondValueColumn",["",...this.availableColumns]).name("2nd column").onChange(a=>this.handleSecondColumnChange(a));if(this.guiConfig.diff?l.show():l.hide(),!this.vizDetails.colorRamp||!this.vizDetails.colorRamp.breakpoints){const a=i.addFolder("Colors");a.add(this.guiConfig,"color ramp",this.guiConfig.colorRamps).onChange(m=>{const d=m.endsWith(" (div)")?"diverging":"sequential";this.computeBounds(d),this.setColors()}),a.add(this.guiConfig,"flip").onChange(this.setColors),a.add(this.guiConfig,"steps",2,50,1).onChange(this.setColors);const h=i.addFolder("Color Bounds");h.add(this.guiConfig,"bounds enabled").name("Enable Bounds").onChange(this.setColors),h.add(this.guiConfig,"lower bound").name("Lower Bound").onChange(this.setColors).listen().onChange(m=>{this.guiConfig["lower bound"]=Number(m.toFixed(2)),this.setColors()}),h.add(this.guiConfig,"upper bound").name("Upper Bound").onChange(this.setColors).listen().onChange(m=>{this.guiConfig["upper bound"]=Number(m.toFixed(2)),this.setColors()}),this.setColors()}},computeBounds(e){const t=this.globalMinValue,i=this.globalMaxValue;if(e==="diverging"){const s=Math.max(Math.abs(t),Math.abs(i));this.guiConfig["upper bound"]=Number(s.toFixed(2)),this.guiConfig["lower bound"]=Number((-s).toFixed(2)),console.log("Diverging bounds set:",{upper:this.guiConfig["upper bound"],lower:this.guiConfig["lower bound"]})}else this.guiConfig["upper bound"]=Number(i.toFixed(2)),this.guiConfig["lower bound"]=Number(t.toFixed(2)),console.log("Sequential bounds set:",{upper:this.guiConfig["upper bound"],lower:this.guiConfig["lower bound"]})},getCurrentSelectedTime(){const e=Number(this.currentTime?.[0]);return Number.isFinite(e)?e:null},resolveSelectedTime(e){if(!this.allTimes.length)return 0;if(e!==null&&this.timeToIndex.has(e))return e;if(e===null)return this.allTimes[0];let t=this.allTimes[0],i=Math.abs(t-e);for(let s=1;s<this.allTimes.length;s++){const l=Math.abs(this.allTimes[s]-e);l<i&&(i=l,t=this.allTimes[s])}return t},async reloadDataAndPreserveSelectedTime(){const e=this.getCurrentSelectedTime();this.data=await this.loadAndPrepareData();const t=this.resolveSelectedTime(e);this.currentTime=[t,t],this.setColors()},async handleOpacityColumnChange(e){this.vizDetails.opacityColumn=e,await this.reloadDataAndPreserveSelectedTime()},async handleColumnChange(e){this.vizDetails.valueColumn=e,await this.reloadDataAndPreserveSelectedTime()},async handleDiffChange(e){this.vizDetails.diff=e,await this.reloadDataAndPreserveSelectedTime()},windowResize(){this.mediaQuery=window.matchMedia("(max-width: 600px)"),this.mediaQuery.matches&&this.guiController?this.guiController.root.close():!this.mediaQuery.matches&&this.guiController&&this.guiController.root.open()},async handleSecondColumnChange(e){this.vizDetails.secondValueColumn=e,await this.reloadDataAndPreserveSelectedTime()},setColors(){if(!this.data)return;const i={ramp:this.guiConfig["color ramp"].replace(/\s*\(div\)$/,"")},s=Q(i,this.guiConfig.steps);s.length&&(this.colors=[]),this.colors=this.hexArrayToRgbArray(s);let l=this.globalMinValue,a=this.globalMaxValue,h=0,m=100;this.guiConfig.flip&&(this.colors=this.colors.reverse());for(let c=0;c<this.data.mapData.length;c++)for(let d=0;d<this.data.mapData[c].values.length;d++){const v=this.data.mapData[c].values[d],f=this.pickColor(v,l,a,h,m);if(f==null)break;if(this.guiConfig.opacityColumn=="none")for(let g=d*3;g<=d*3+2;g++)this.data.mapData[c].colorData[g]=f[g%3];else try{for(let g=d*4;g<=d*4+3;g++)(g+1)%4==0?this.data.mapData[c].colorData[g]=Math.round(this.data.mapData[c].opacityValues[d]*255):this.data.mapData[c].colorData[g]=f[g%4]}catch(g){this.$emit("error",""+g)}}this.data={...this.data}},hexArrayToRgbArray(e){const t=[];for(let i=0;i<e.length;i++){const s=e[i].replace(/^#/,""),l=parseInt(s.substring(0,2),16),a=parseInt(s.substring(2,4),16),h=parseInt(s.substring(4,6),16);t.push([l,a,h,255])}return t},setCustomGuiConfig(){this.config&&(this.config.colorRamp&&(this.config.colorRamp.ramp!=null&&(this.guiConfig["color ramp"]=this.config.colorRamp.ramp==="RdBu"?"RdBu (div)":this.config.colorRamp.ramp),this.config.colorRamp.reverse!=null&&(this.guiConfig.flip=this.config.colorRamp.reverse),this.config.colorRamp.steps!=null&&(this.guiConfig.steps=this.config.colorRamp.steps),this.config.colorRamp.upperBound!=null&&(this.guiConfig["upper bound"]=this.config.colorRamp.upperBound),this.config.colorRamp.lowerBound!=null&&(this.guiConfig["lower bound"]=this.config.colorRamp.lowerBound),this.config.colorRamp.boundsEnabled!=null&&(this.guiConfig["bounds enabled"]=this.config.colorRamp.boundsEnabled)),this.config.cellSize>=this.minRadius&&this.config.cellSize<=this.maxRadius&&(this.guiConfig.radius=this.config.cellSize),this.config.maxHeight!==void 0&&(this.guiConfig.height=this.config.maxHeight),this.config.opacity&&(this.guiConfig.opacity=this.config.opacity),typeof this.config.diff=="boolean"&&(this.guiConfig.diff=this.config.diff,this.vizDetails.diff=this.config.diff),typeof this.config.secondValueColumn=="string"&&(this.guiConfig.secondValueColumn=this.config.secondValueColumn,this.vizDetails.secondValueColumn=this.config.secondValueColumn))}},async mounted(){if(this.$store.commit("setFullScreen",!this.thumbnail),this.myState.thumbnail=this.thumbnail,this.myState.yamlConfig=this.yamlConfig||"",this.myState.subfolder=this.subfolder,await this.getVizDetails(),this.thumbnail)return;this.myState.statusMessage=`${this.$i18n.t("loading")}`,this.data=await this.loadAndPrepareData();const t=this.guiConfig["color ramp"].endsWith(" (div)")?"diverging":"sequential";(!this.config?.colorRamp||this.config.colorRamp.boundsEnabled===void 0)&&this.computeBounds(t),this.mediaQuery=window.matchMedia("(max-width: 600px)"),this.setupGui(),this.mediaQuery.matches&&this.guiController?(this.vizDetails.zoom=8,this.guiController.root.close()):!this.mediaQuery.matches&&this.guiController&&this.guiController.root.open(),this.setColors(),this.isLoaded=!0,this.setMapCenter();try{this.backgroundLayers=new rt({vizDetails:this.vizDetails,fileApi:this.fileApi,subfolder:this.subfolder}),await this.backgroundLayers.initialLoad()}catch{this.$emit("error","Error loading background layers")}},beforeDestroy(){delete window.__testdata__,this.data=null,this.guiController?.destroy(),this.$store.commit("setFullScreen",!1)}});var Vt=function(){var t=this,i=t._self._c;return t._self._setupProxy,i("div",{staticClass:"grid-map-view",class:{"hide-thumbnail":!t.thumbnail},attrs:{oncontextmenu:"return false",id:`id-${t.id}`}},[!t.thumbnail&&t.isLoaded?i("MapComponent",t._b({attrs:{negativeValues:t.valuesIncludeNeg}},"MapComponent",t.mapProps,!1)):t._e(),!t.thumbnail&&t.isLoaded?i("zoom-buttons",{attrs:{corner:"top-left",show3dToggle:!0,is3dBuildings:t.show3dBuildings,onToggle3dBuildings:t.toggle3dBuildings}}):t._e(),i("div",{staticClass:"top-right"},[i("div",{staticClass:"gui-config",attrs:{id:t.configId}})]),t.isLoaded&&this.vizDetails.timeSelector&&this.vizDetails.timeSelector=="discrete"?i("click-through-times",{staticClass:"time-slider-area",attrs:{allTimes:t.allTimes,range:t.timeRange},on:{timeUpdate:t.handleDiscreteTimeValues}}):t._e(),t.isLoaded&&(!this.vizDetails.timeSelector||this.vizDetails.timeSelector=="slider")?i("time-slider",{staticClass:"time-slider-area",attrs:{range:t.timeRange,allTimes:t.allTimes},on:{timeExtent:t.handleTimeSliderValues}}):t._e(),!t.thumbnail&&t.myState.statusMessage?i("div",{staticClass:"message"},[i("p",{staticClass:"status-message"},[t._v(t._s(t.myState.statusMessage))])]):t._e(),t.tooltip?i("div",{staticClass:"tooltip",style:t.tooltip.style,domProps:{innerHTML:t._s(t.tooltip.html)}}):t._e()],1)},Lt=[],kt=E(Ot,Vt,Lt,!1,null,"06d8c4b8");const fe=kt.exports;export{fe as default};
