import{n as d,d as f,g as m,o as u}from"./index-BSRT1qCd.js";import{Y as _}from"./index-r3K0jT4B.js";import{l as S}from"./lodash-DIXK_M8r.js";import{H as x,g as k}from"./HTTPFileSystem-CM0ZTrcf.js";import{b as v}from"./DashboardDataManager-C_pYT4V3.js";import{O as $,P as w,S as n,g}from"./ColorsAndWidths-Cxe49fkT.js";import{a as b,d as C}from"./index-SKlkcK94.js";import{L as D}from"./LegendBox-Bxs999nK.js";const L={name:"FileSelector",props:{multiple:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1},acceptExtensions:{type:String,default:""},maxFileSize:{type:Number,default:NaN},height:{type:Number,default:NaN},validateFn:{type:Function,default:()=>!0}},data(){return{isDragEnter:!1}},methods:{startDrag(){this.isDragEnter=!0},handleFilesChange(i){this.preprocessFiles(i.target.files)},handleDrop(i){this.isDragEnter=!1,this.preprocessFiles(i.dataTransfer.files)},checkFileExtensions(i){const e=[...new Set(this.acceptExtensions.toLowerCase().split(",").filter(Boolean))];return Array.from(i).findIndex(a=>{const l=`.${a.name.toLowerCase().split(".").pop()}`;return!e.includes(l)})===-1},checkFileSize(i){return Number.isNaN(this.maxFileSize)?!0:Array.from(i).findIndex(s=>s.size>this.maxFileSize)===-1},validate(i){return!this.multiple&&i.length>1?"MULTIFILES_ERROR":this.checkFileExtensions(i)?this.checkFileSize(i)?this.validateFn(i):"FILE_SIZE_ERROR":"EXTENSION_ERROR"},preprocessFiles(i){const e=this.validate(i);this.$emit("validated",e,i),e===!0&&this.$emit("changed",i),this.$refs.fsFileInput.value=""}}};var O=function(){var e=this,t=e._self._c;return t("div",{staticClass:"fs-file-selector",class:{"fs-drag-enter":e.isDragEnter}},[t("div",{directives:[{name:"show",rawName:"v-show",value:e.isLoading,expression:"isLoading"}],staticClass:"fs-loader"},[e._t("loader",function(){return[e._v(" Loading... ")]})],2),t("div",{ref:"fsDroppable",staticClass:"fs-droppable",class:{isDragEnter:"is-dragging"},style:{height:e.height+"px"},on:{dragenter:function(s){return s.stopPropagation(),s.preventDefault(),e.startDrag()},dragover:function(s){return s.stopPropagation(),s.preventDefault(),e.startDrag()},dragleave:function(s){e.isDragEnter=!1},drop:function(s){return s.stopPropagation(),s.preventDefault(),e.handleDrop.apply(null,arguments)}}},[t("input",{ref:"fsFileInput",attrs:{type:"file",tabindex:"-1",multiple:e.multiple,accept:e.acceptExtensions},on:{change:e.handleFilesChange}}),e._t("top"),t("div",{staticClass:"fs-btn-select",attrs:{href:"#"},on:{click:function(s){return e.$refs.fsFileInput.click()}}},[e._t("default",function(){return[e._v("Select")]})],2),e._t("bottom")],2)])},z=[],F=d(L,O,z,!1,null,"5f37ddf8");const j=F.exports,R=f({name:"AddDatasetsPanel",components:{FileSelector:j},props:{fileSystem:{type:Object,required:!0},subfolder:{type:String,required:!0},vizConfiguration:{type:Object}},data:()=>({validDataTypes:["CSV","TSV","TAB","TXT","DBF","GZ","DAT"],validRegex:/\.(CSV|TSV|TAB|TXT|DBF|DAT)(\.GZ)?$/,fileChoice:"",filesInFolder:[],isLoading:!1}),computed:{fileApi(){return new x(this.fileSystem)}},async mounted(){const{files:i}=await this.fileApi.getDirectory(this.subfolder);this.filesInFolder=i.filter(e=>this.validRegex.test(e.toLocaleUpperCase())).sort()},watch:{fileChoice(){console.warn("*** File Chosen!"),this.fileChoiceChanged(this.fileChoice)}},methods:{clickedClose(){this.$emit("update",{})},async fileChoiceChanged(i){if(!i)return;this.isLoading=!0;const e=await this.fetchDataset(i);let t=i;const s=this.validRegex.exec(i.toLocaleUpperCase());s&&s[0]&&(t=i.substring(0,i.length-s[0].length));const a={key:t,dataTable:e,filename:i};this.$emit("update",{dataset:a}),this.isLoading=!1},handleFilesValidated(i,e){console.log("Validated result",i)},async handleFilesChanged(i){this.isLoading=!0;const e=Array.from(i);for(const t of e){let s=await this.loadDataUrl(t);const a=s.buffer||s,l=await this.processBuffer(t.name,a),{comments:c,...r}=l;let o=t.name;const p=this.validRegex.exec(o.toLocaleUpperCase());p&&p[0]&&(o=o.substring(0,o.length-p[0].length));const y={key:o,dataTable:r,filename:t};this.$emit("update",{dataset:y})}this.isLoading=!1},async processBuffer(i,e){return new Promise((t,s)=>{const a=new v;try{a.postMessage({config:{dataset:i},buffer:e},[e]),a.onmessage=l=>{a.terminate(),t(l.data)}}catch(l){a.terminate(),s(l)}})},async loadDataUrl(i){return await new Promise(t=>{const s=new FileReader;s.readAsArrayBuffer(i),s.onload=async a=>{const l=a.target.result,c=await k(l);t(c)}})},async fetchDataset(i){return new Promise((e,t)=>{const s=new v;try{s.postMessage({fileSystemConfig:this.fileSystem,subfolder:this.subfolder,files:this.filesInFolder,config:{dataset:i}}),s.onmessage=a=>{s.terminate(),e(a.data)}}catch(a){s.terminate(),t(a)}})}}});var P=function(){var e=this,t=e._self._c;return e._self._setupProxy,t("div",{staticClass:"datasets-panel"},[e.isLoading?t("div",{staticClass:"loading-panel"},[e._m(0)]):e._e(),t("h3",{staticClass:"button-close",on:{click:e.clickedClose}},[t("i",{staticClass:"fa fa-sm fa-times"})]),t("h3",{staticClass:"header-line"},[e._v("Add Data")]),t("div",{staticClass:"widgets"},[t("div",{staticClass:"widget"},[t("b",[e._v("Choose a dataset from files in this folder:")]),t("b-select",{staticClass:"selector",attrs:{expanded:""},model:{value:e.fileChoice,callback:function(s){e.fileChoice=s},expression:"fileChoice"}},[t("option",{attrs:{value:"",label:"Select file..."}}),e._l(e.filesInFolder,function(s){return t("option",{attrs:{label:s},domProps:{value:s}})})],2)],1)]),t("br"),t("div",{staticClass:"drop-zone flex-col"},[t("b",[e._v("Or Drag and Drop any dataset file:")]),t("file-selector",{staticClass:"flex1",attrs:{"accept-extensions":e.validDataTypes.map(s=>`.${s}`).join(","),multiple:!0,"is-loading":e.isLoading},on:{validated:e.handleFilesValidated,changed:e.handleFilesChanged}},[e._v("or "),t("b",[t("a",[e._v("browse your files")])]),t("div",{staticClass:"section-top",attrs:{slot:"top"},slot:"top"},[t("br"),t("p",[e._v("Drop files into this area.")]),t("p",[e._v("No size limit, but large datasets could crash your browser :-)")]),t("br"),t("p",[e._v("Supported file types: "),t("b",[e._v(e._s(e.validDataTypes.join(", ")))])])]),t("div",{staticClass:"section-bottom",attrs:{slot:"loader"},slot:"loader"},[t("p",[t("b",[e._v("Processing files"),t("br")])]),t("p",[t("i",[e._v("Please wait...")])])])]),t("br"),e._m(1)],1)])},I=[function(){var i=this,e=i._self._c;return i._self._setupProxy,e("div",{staticClass:"thing"},[e("div",{staticClass:"spinner-box"},[e("p",[i._v(" ")])]),e("h3",[i._v("LOADING...")])])},function(){var i=this,e=i._self._c;return i._self._setupProxy,e("p",{staticClass:"center"},[e("input",{staticStyle:{display:"none"},attrs:{name:"dataBrowser",id:"dataBrowser",type:"file"}})])}],N=d(R,P,I,!1,null,"e21a2f44");const A=N.exports,h=Object.assign({},$,w),T=f({name:"ColorsConfig",props:{vizConfiguration:{type:Object,required:!0},datasets:{type:Object,required:!0}},data:()=>{const i=[{ramp:"Viridis",style:2,reverse:!0},{ramp:"Cividis",style:2,reverse:!0},{ramp:"Plasma",style:2,reverse:!0},{ramp:"Turbo",style:2,reverse:!0},{ramp:"Blues",style:2},{ramp:"Greens",style:2},{ramp:"Purples",style:2},{ramp:"Oranges",style:2},{ramp:"Tableau10",style:0},{ramp:"Paired",style:0},{ramp:"RdBu",style:1,reverse:!0},{ramp:"PRGn",style:1,reverse:!0}];return{colorChoices:i,globalState:m.state,steps:"9",flip:!1,dataColumn:"",selectedColor:i[0],selectedSingleColor:"",datasetLabels:[],isFirstDataset:!0}},computed:{simpleColors(){return this.buildColors({ramp:"Tableau10",style:0},10)}},mounted(){this.selectedSingleColor=this.simpleColors[0],this.datasetLabels=Object.keys(this.vizConfiguration.datasets),this.datasetsAreLoaded()},watch:{vizConfiguration(){this.vizConfigChanged()},datasets(){this.datasetsAreLoaded()},flip(){this.emitColorSpecification()},steps(){this.emitColorSpecification()},dataColumn(){this.emitColorSpecification()},"global.isDarkMode"(){this.emitColorSpecification()}},methods:{vizConfigChanged(){const i=this.vizConfiguration.display?.color;if(i?.columnName){const e=`${i.dataset}/${i.columnName}`;this.dataColumn=e,this.datasetLabels=[...this.datasetLabels]}},datasetsAreLoaded(){const i=Object.keys(this.datasets);if(this.datasetLabels=i,!this.isFirstDataset)return;i.length&&(this.isFirstDataset=!1);const{dataset:e,columnName:t,colorRamp:s}=this.vizConfiguration.display.color;if(e&&t)this.dataColumn=`${e}/${t}`,s&&(this.selectedColor=this.colorChoices.find(a=>a.ramp.toLowerCase()===s.ramp.toLowerCase())||this.colorChoices[0],this.flip=!!s.reverse,s.steps&&(this.steps=""+s.steps));else if(i.length){const a=Object.keys(this.datasets[i[0]])[1];console.log(a),a&&(this.dataColumn=`${i[0]}/${a}`)}},emitColorSpecification(){if(!this.dataColumn)return;const i=this.dataColumn.indexOf("/");if(i===-1){this.clickedSingleColor(this.selectedSingleColor);return}const e=this.dataColumn.substring(0,i),t=this.dataColumn.substring(i+1),s=this.buildColors(this.selectedColor,parseInt(this.steps)),a=parseInt(this.steps),l={dataset:e,columnName:t,fixedColors:s,colorRamp:{ramp:this.selectedColor.ramp,style:this.selectedColor.style,reverse:this.flip,steps:a}};setTimeout(()=>this.$emit("update",{color:l}),50)},clickedSingleColor(i){this.selectedSingleColor=i;const e={fixedColors:[this.selectedSingleColor],dataset:"",columnName:""};setTimeout(()=>this.$emit("update",{color:e}),50)},datasetChoices(){return this.datasetLabels.filter(i=>i!=="csvBase")},columnsInDataset(i){const e=this.datasets[i];return e?Object.keys(e).filter(s=>e[s].type!==u.LOOKUP):[]},pickColor(i){this.selectedColor=i,this.emitColorSpecification()},buildColors(i,e){let t=[...this.ramp(i,e||parseInt(this.steps))],s=!!i.reverse;return this.flip&&(s=!s),s&&(t=t.reverse()),i.style===2&&this.globalState.isDarkMode&&(t=t.reverse()),t},ramp(i,e){let t;if(i.style===0)return h[`scheme${i.ramp}`].slice(0,e);if(h[`scheme${i.ramp}`]&&h[`scheme${i.ramp}`][e])t=h[`scheme${i.ramp}`][e];else try{const s=h[`interpolate${i.ramp}`];t=[];for(let a=0;a<e;++a)t.push(h.rgb(s(a/(e-1))).hex())}catch{return this.ramp(i,e-1)}return t}}});var E=function(){var e=this,t=e._self._c;return e._self._setupProxy,t("div",{staticClass:"color-ramp-picker"},[t("div",{staticClass:"widgets"},[t("div",{staticClass:"widget"},[t("b-select",{staticClass:"selector",attrs:{expanded:""},model:{value:e.dataColumn,callback:function(s){e.dataColumn=s},expression:"dataColumn"}},[t("option",{attrs:{label:"Single color",value:""}}),e._l(e.datasetChoices(),function(s){return t("optgroup",{key:s,attrs:{label:s}},e._l(e.columnsInDataset(s),function(a){return t("option",{attrs:{label:a},domProps:{value:`${s}/${a}`}})}),0)})],2)],1)]),t("div",{directives:[{name:"show",rawName:"v-show",value:!e.dataColumn,expression:"!dataColumn"}],staticClass:"colorbar single"},e._l(e.simpleColors,function(s){return t("div",{key:s,staticClass:"single-color",class:{active:e.selectedSingleColor==s},style:{backgroundColor:`${s}`},on:{click:function(a){return e.clickedSingleColor(s)}}})}),0),t("div",{directives:[{name:"show",rawName:"v-show",value:e.dataColumn,expression:"dataColumn"}],staticClass:"more"},[t("div",{staticClass:"widgets"},[t("div",{staticClass:"widget"},[t("p",[e._v("Steps")]),t("b-input",{attrs:{placeholder:"Number",type:"number",min:"2",max:"15"},model:{value:e.steps,callback:function(s){e.steps=s},expression:"steps"}})],1),t("div",{staticClass:"widget"},[t("p",[e._v("Reverse")]),t("b-checkbox",{staticClass:"hello",model:{value:e.flip,callback:function(s){e.flip=s},expression:"flip"}})],1)]),e._l(e.colorChoices,function(s){return t("div",{key:s.ramp,staticClass:"color-ramp",class:{active:s===e.selectedColor},on:{click:function(a){return e.pickColor(s)}}},[t("div",{staticClass:"colorbar"},e._l(e.buildColors(s),function(a,l){return t("div",{key:l,staticClass:"swatch",style:{backgroundColor:`${a}`}},[t("p",[e._v(" ")])])}),0)])})],2)])},U=[],q=d(T,E,U,!1,null,"16985f9c");const M=q.exports,W=f({name:"WidthConfig",props:{vizDetails:{required:!1},vizConfiguration:{type:Object,required:!0},datasets:{type:Object,required:!0}},data:i=>{const e=["none","sqrt","pow5"];return{dataColumn:"",xscaleFactor:""+(i.vizDetails?.widthFactor||100),selectedTransform:e[0],datasetLabels:[],debounceHandleWidthChanged:b(i.emitWidthSpecification,500)}},mounted(){this.datasetsAreLoaded()},computed:{datasetChoices(){return this.datasetLabels.filter(i=>i!=="csvBase")}},watch:{vizConfiguration(){this.vizConfigChanged()},datasets(){this.datasetsAreLoaded()},xscaleFactor(){this.debounceHandleWidthChanged()},dataColumn(){this.emitWidthSpecification()}},methods:{vizConfigChanged(){const i=this.vizConfiguration.display?.width;if(i?.columnName){const e=`${i.dataset}/${i.columnName}`;this.dataColumn=e,this.datasetLabels=[...this.datasetLabels]}},datasetsAreLoaded(){const i=Object.keys(this.datasets),{dataset:e,columnName:t,scaleFactor:s}=this.vizConfiguration.display.width;if(e&&t)this.dataColumn=`${e}/${t}`,s&&(this.xscaleFactor=""+s);else if(i.length){const a=Object.keys(this.datasets[i[0]])[1];a&&(this.dataColumn=`${i[0]}/${a}`)}this.datasetLabels=i},emitWidthSpecification(){const i=this.dataColumn.indexOf("/");if(i===-1){this.clickedSingle();return}const e=this.dataColumn.substring(0,i),t=this.dataColumn.substring(i+1),s={dataset:e,columnName:t,scaleFactor:parseFloat(this.xscaleFactor)};setTimeout(()=>this.$emit("update",{width:s}),50)},clickedSingle(){const i={dataset:"",columnName:"",scaleFactor:parseFloat(this.xscaleFactor)};setTimeout(()=>this.$emit("update",{width:i}),50)},numericColumnsInDataset(i){const e=this.datasets[i];return e?Object.keys(e).filter(s=>e[s].type!==u.LOOKUP):[]}}});var B=function(){var e=this,t=e._self._c;return e._self._setupProxy,t("div",{staticClass:"width-panel"},[t("div",{staticClass:"widgets"},[t("div",{staticClass:"widget"},[t("b-select",{staticClass:"selector",attrs:{expanded:""},model:{value:e.dataColumn,callback:function(s){e.dataColumn=s},expression:"dataColumn"}},[t("option",{attrs:{label:"None",value:""}}),e._l(e.datasetChoices,function(s){return t("optgroup",{key:s,attrs:{label:s}},e._l(e.numericColumnsInDataset(s),function(a){return t("option",{attrs:{label:a},domProps:{value:`${s}/${a}`}})}),0)})],2)],1)]),t("div",{staticClass:"widgets"},[t("div",{staticClass:"widget"},[t("p",[e._v("Scaling")]),t("b-field",[t("b-input",{attrs:{disabled:!e.dataColumn,placeholder:"1.0"},model:{value:e.xscaleFactor,callback:function(s){e.xscaleFactor=s},expression:"xscaleFactor"}})],1)],1)])])},H=[],V=d(W,B,H,!1,null,"509e05c7");const J=V.exports,K=[{ramp:"Viridis",style:n.sequential,reverse:!0},{ramp:"Plasma",style:n.sequential,reverse:!0},{ramp:"Blues",style:n.sequential},{ramp:"Greens",style:n.sequential},{ramp:"Purples",style:n.sequential},{ramp:"Oranges",style:n.sequential},{ramp:"RdBu",style:n.diverging,reverse:!0},{ramp:"RdYlBu",style:n.sequential},{ramp:"PRGn",style:n.diverging,reverse:!0},{ramp:"Tableau10",style:n.categorical},{ramp:"Paired",style:n.categorical}],G=f({name:"LineColorsConfig",props:{vizConfiguration:{type:Object,required:!0},datasets:{type:Object,required:!0}},computed:{simpleColors(){return this.buildColors({ramp:"Tableau10",style:n.categorical},10)},colorChoices(){return K},datasetChoices(){return this.datasetLabels.filter(i=>i!=="csvBase").reverse()}},data:()=>({globalState:m.state,dataColumn:"@0",datasetLabels:[],diffDatasets:[],diffRelative:!1,diffUISelection:"",diffChoices:[],emitColorSpecification:{},flip:!1,isCurrentlyDiffMode:!1,join:"",normalSelection:"",selectedColor:{},selectedSingleColor:"",steps:"9",useHardCodedColors:!1}),mounted(){this.emitColorSpecification=C.debounce(this.emitColorSpecificationDebounced,150),this.selectedSingleColor=this.simpleColors[0],this.selectedColor=this.colorChoices[0],this.datasetLabels=Object.keys(this.vizConfiguration.datasets),this.datasetsAreLoaded(),this.vizConfiguration.display?.lineColor?.fixedColors&&(this.useHardCodedColors=!0),this.vizConfigChanged()},watch:{vizConfiguration(){this.vizConfigChanged()},datasets(){this.datasetsAreLoaded()},diffUISelection(){this.diffSelectionChanged()},dataColumn(){this.emitColorSpecification()},join(){this.emitColorSpecification()},diffDatasets(){this.emitColorSpecification()},flip(){this.emitColorSpecification()},"globalState.isDarkMode"(){this.emitColorSpecification()},normalSelection(){this.emitColorSpecification()},selectedColor(){this.emitColorSpecification()},steps(){this.emitColorSpecification()},diffRelative(){this.emitColorSpecification()}},methods:{vizConfigChanged(){const i=this.vizConfiguration.display?.lineColor;if(this.setupDiffMode(i),i?.columnName){const e=this.diffDatasets.length?`${this.diffDatasets[0]}/${i.columnName}`:`${i.dataset}/${i.columnName}`;if(this.dataColumn=e,this.datasetLabels=[...this.datasetLabels],i?.normalize&&(this.normalSelection=i.normalize),i?.join&&(this.join=i.join),i.colorRamp){let t=this.colorChoices.find(s=>s.ramp==i.colorRamp.ramp)||this.colorChoices[0];this.selectedColor=t,this.steps=i.colorRamp.steps,this.flip=!!i.colorRamp.reverse}}else i?.fixedColors&&this.clickedSingleColor(i.fixedColors[0])},setupDiffMode(i){if(!i?.diff)return;let e=[];if(i.diff.indexOf(" - ")>-1)e=i.diff.split(" - ").map(t=>t.trim());else if(e=i.diff.split("-").map(t=>t.trim()),e.length>2)throw Error('Ambiguous diff, use " - " to separate terms');this.diffDatasets=e,this.diffRelative=!!i.relative,this.diffUISelection=`${e[0]} - ${e[1]}`},datasetsAreLoaded(){const i=Object.keys(this.datasets);this.datasetLabels=i,this.updateDiffLabels()},updateDiffLabels(){const i=[];if(i.push(["No",""]),this.datasetLabels.length<=1)return;const e=this.datasetLabels.slice(1);let t=e.flatMap((s,a)=>e.slice(a+1).map(l=>s+" - "+l));t.forEach(s=>i.push([s,s])),e.reverse(),t=e.flatMap((s,a)=>e.slice(a+1).map(l=>s+" - "+l)),t.forEach(s=>i.push([s,s])),this.diffChoices=i},diffSelectionChanged(){if(this.diffUISelection){const i=this.diffUISelection.split(" - ");this.diffDatasets=i}else this.diffDatasets=[],this.diffRelative=!1;this.isCurrentlyDiffMode=!!this.diffUISelection},emitColorSpecificationDebounced(){if(this.dataColumn==null)return;if(this.dataColumn===""){this.normalSelection="",this.selectedSingleColor=this.simpleColors[0],this.clickedSingleColor(this.selectedSingleColor);return}if(this.dataColumn==="@0"){this.$emit("update",{lineColor:{dataset:"",columnName:"@0"}});return}if(this.dataColumn==="@"){this.normalSelection="",this.selectedSingleColor||(this.selectedSingleColor=this.simpleColors[0]),this.clickedSingleColor(this.selectedSingleColor);return}const i=this.dataColumn.indexOf("/"),e=this.dataColumn.substring(0,i),t=this.dataColumn.substring(i+1),s=parseInt(this.steps),a=this.useHardCodedColors?this.vizConfiguration.display?.lineColor?.fixedColors.slice():this.buildColors(this.selectedColor,s);this.useHardCodedColors=!1;const l={dataset:e,columnName:t,join:this.join,fixedColors:a,normalize:this.normalSelection,colorRamp:{ramp:this.selectedColor.ramp,style:this.selectedColor.style,reverse:this.flip,steps:s}};this.diffDatasets.length&&(l.diffDatasets=this.diffDatasets),this.diffRelative&&(l.relative=!0),this.vizConfiguration.display?.lineColor?.colorRamp?.breakpoints&&(l.colorRamp.breakpoints=this.vizConfiguration.display?.lineColor?.colorRamp?.breakpoints),this.$emit("update",{lineColor:l})},clickedSingleColor(i){this.selectedSingleColor=i;const e={fixedColors:[this.selectedSingleColor],dataset:"",columnName:"",normalize:""};this.$emit("update",{lineColor:e})},columnsInDataset(i){const e=this.datasets[i];return e?Object.keys(e).filter(s=>e[s].type!==u.LOOKUP):[]},pickColor(i){this.selectedColor=i,this.emitColorSpecification()},buildColors(i,e){let t=[...g(i,e||parseInt(this.steps))],s=!!i.reverse;return this.flip&&(s=!s),s&&(t=t.reverse()),i.style===n.sequential&&this.globalState.isDarkMode&&(t=t.reverse()),t}}});var Y=function(){var e=this,t=e._self._c;return e._self._setupProxy,t("div",{staticClass:"color-ramp-picker"},[t("div",{staticClass:"widgets"},[t("div",{staticClass:"widget"},[t("p",{staticClass:"tight"},[e._v("Display")]),t("b-select",{staticClass:"selector",attrs:{expanded:""},model:{value:e.dataColumn,callback:function(s){e.dataColumn=s},expression:"dataColumn"}},[t("option",{attrs:{label:"None",value:"@0"}}),t("option",{attrs:{label:"Single color",value:"@"}}),e._l(e.datasetChoices,function(s){return t("optgroup",{key:s,attrs:{label:s}},e._l(e.columnsInDataset(s),function(a){return t("option",{key:`${s}/${a}`,attrs:{label:a},domProps:{value:`${s}/${a}`}})}),0)})],2)],1)]),e.datasetChoices.length>1&&e.dataColumn&&e.dataColumn.length>1?t("div",{staticClass:"widgets"},[t("div",{staticClass:"widget"},[t("p",{staticClass:"tight"},[e._v("Join by")]),t("b-select",{staticClass:"selector",attrs:{expanded:""},model:{value:e.join,callback:function(s){e.join=s},expression:"join"}},[t("option",{attrs:{label:"None",value:""}}),t("option",{attrs:{label:"Row count",value:"@count"}}),t("optgroup",{attrs:{label:"Join by..."}},e._l(e.columnsInDataset(e.dataColumn?.slice(0,e.dataColumn.indexOf("/"))||[]),function(s){return t("option",{attrs:{label:s},domProps:{value:s}})}),0)])],1)]):e._e(),e.dataColumn&&e.dataColumn.length>1?t("div",{staticClass:"widgets"},[t("div",{staticClass:"widget"},[t("p",{staticClass:"tight"},[e._v("Normalize by")]),t("b-select",{staticClass:"selector",attrs:{expanded:""},model:{value:e.normalSelection,callback:function(s){e.normalSelection=s},expression:"normalSelection"}},[t("option",{attrs:{label:"None",value:""}}),e._l(e.datasetChoices,function(s){return t("optgroup",{key:s,attrs:{label:s}},e._l(e.columnsInDataset(s),function(a){return t("option",{key:`${s}/${a}`,attrs:{label:a},domProps:{value:`${s}:${a}`}})}),0)})],2)],1)]):e._e(),t("div",{staticClass:"more",attrs:{title:e.diffChoices.length<2?"Add two datasets to enable comparisons":""}},[t("div",{staticClass:"widgets"},[t("div",{staticClass:"widget",staticStyle:{flex:"3"}},[t("p",{staticClass:"tight"},[e._v("Compare datasets")]),t("b-select",{staticClass:"selector",attrs:{disabled:!e.dataColumn||e.diffChoices.length<2,expanded:""},model:{value:e.diffUISelection,callback:function(s){e.diffUISelection=s},expression:"diffUISelection"}},e._l(e.diffChoices,function(s){return t("option",{attrs:{label:s[0]},domProps:{value:s[1]}})}),0)],1),t("div",{staticClass:"widget"},[t("p",[e._v("%Diff")]),t("b-checkbox",{staticClass:"hello",attrs:{disabled:!e.diffUISelection||!e.dataColumn||e.diffChoices.length<2},model:{value:e.diffRelative,callback:function(s){e.diffRelative=s},expression:"diffRelative"}})],1)])]),t("div",{directives:[{name:"show",rawName:"v-show",value:e.dataColumn=="@",expression:"dataColumn=='@'"}],staticClass:"colorbar single"},e._l(e.simpleColors,function(s){return t("div",{key:s,staticClass:"single-color",class:{active:e.selectedSingleColor==s},style:{backgroundColor:`${s}`},on:{click:function(a){return e.clickedSingleColor(s)}}})}),0),t("div",{directives:[{name:"show",rawName:"v-show",value:e.dataColumn&&e.dataColumn!=="@0"&&e.dataColumn.length>1,expression:"dataColumn && dataColumn !== '@0' && dataColumn.length > 1"}],staticClass:"more"},[t("div",{staticClass:"widgets"},[t("div",{staticClass:"widget",staticStyle:{flex:"3"}},[t("p",[e._v("Steps")]),t("b-input",{attrs:{placeholder:"Number",type:"number",min:"2",max:"15"},model:{value:e.steps,callback:function(s){e.steps=s},expression:"steps"}})],1),t("div",{staticClass:"widget"},[t("p",[e._v("Flip")]),t("b-checkbox",{staticClass:"hello",model:{value:e.flip,callback:function(s){e.flip=s},expression:"flip"}})],1)]),e._l(e.colorChoices,function(s){return t("div",{key:s.ramp,staticClass:"color-ramp",class:{active:s===e.selectedColor},on:{click:function(a){return e.pickColor(s)}}},[t("div",{staticClass:"colorbar"},e._l(e.buildColors(s),function(a,l){return t("div",{key:l,staticClass:"swatch",style:{backgroundColor:`${a}`}},[t("p",[e._v(" ")])])}),0)])})],2)])},X=[],Z=d(G,Y,X,!1,null,"9e6f09c7");const Q=Z.exports,ee=[{ramp:"Viridis",style:n.sequential,reverse:!0},{ramp:"Cividis",style:n.sequential,reverse:!0},{ramp:"Plasma",style:n.sequential,reverse:!0},{ramp:"Turbo",style:n.sequential,reverse:!0},{ramp:"Blues",style:n.sequential},{ramp:"Greens",style:n.sequential},{ramp:"Purples",style:n.sequential},{ramp:"Oranges",style:n.sequential},{ramp:"Tableau10",style:n.categorical},{ramp:"Paired",style:n.categorical},{ramp:"RdBu",style:n.diverging,reverse:!0},{ramp:"PRGn",style:n.diverging,reverse:!0}],te=f({name:"FillColorsConfig",props:{vizConfiguration:{type:Object,required:!0},datasets:{type:Object,required:!0}},computed:{simpleColors(){return this.buildColors({ramp:"Tableau10",style:n.categorical},10)},colorChoices(){return ee},datasetChoices(){return this.datasetLabels.filter(i=>i!=="csvBase").reverse()}},data:()=>({globalState:m.state,dataColumn:"",transparencyColumn:"@",datasetLabels:[],diffDatasets:[],diffRelative:!1,diffUISelection:"",diffChoices:[],emitColorSpecification:{},flip:!1,isCurrentlyDiffMode:!1,join:"",normalSelection:"",selectedColor:{},selectedSingleColor:"",steps:"9",useHardCodedColors:!1}),mounted(){this.emitColorSpecification=C.debounce(this.emitColorSpecificationDebounced,150),this.selectedSingleColor=this.simpleColors[0],this.selectedColor=this.colorChoices[0],this.datasetLabels=Object.keys(this.vizConfiguration.datasets),this.datasetsAreLoaded(),this.vizConfiguration.display?.fill?.fixedColors&&(this.useHardCodedColors=!0),this.vizConfigChanged()},watch:{vizConfiguration(){this.vizConfigChanged()},datasets(){this.datasetsAreLoaded()},diffUISelection(){this.diffSelectionChanged()},dataColumn(){this.emitColorSpecification()},transparencyColumn(){this.emitColorSpecification()},join(){this.emitColorSpecification()},diffDatasets(){this.emitColorSpecification()},flip(){this.emitColorSpecification()},"globalState.isDarkMode"(){this.emitColorSpecification()},normalSelection(){this.emitColorSpecification()},selectedColor(){this.emitColorSpecification()},steps(){this.emitColorSpecification()},diffRelative(){this.emitColorSpecification()}},methods:{vizConfigChanged(){const i=this.vizConfiguration.display?.fill;if(this.setupDiffMode(i),i?.columnName){const e=this.diffDatasets.length?`${this.diffDatasets[0]}/${i.columnName}`:`${i.dataset}/${i.columnName}`;if(this.dataColumn=e,this.datasetLabels=[...this.datasetLabels],i?.normalize&&(this.normalSelection=i.normalize),i?.join&&(this.join=i.join),i.colorRamp){let t=this.colorChoices.find(s=>s.ramp==i.colorRamp.ramp)||this.colorChoices[0];this.selectedColor=t,this.steps=i.colorRamp.steps,this.flip=!!i.colorRamp.reverse}}else i?.fixedColors&&this.clickedSingleColor(i.fixedColors[0])},setupDiffMode(i){if(!i?.diff)return;let e=[];if(i.diff.indexOf(" - ")>-1)e=i.diff.split(" - ").map(t=>t.trim());else if(e=i.diff.split("-").map(t=>t.trim()),e.length>2)throw Error('Ambiguous diff, use " - " to separate terms');this.diffDatasets=e,this.diffRelative=!!i.relative,this.diffUISelection=`${e[0]} - ${e[1]}`},datasetsAreLoaded(){const i=Object.keys(this.datasets);this.datasetLabels=i,this.updateDiffLabels()},updateDiffLabels(){const i=[];if(i.push(["No",""]),this.datasetLabels.length<=1)return;const e=this.datasetLabels.slice(1);let t=e.flatMap((s,a)=>e.slice(a+1).map(l=>s+" - "+l));t.forEach(s=>i.push([s,s])),e.reverse(),t=e.flatMap((s,a)=>e.slice(a+1).map(l=>s+" - "+l)),t.forEach(s=>i.push([s,s])),this.diffChoices=i},diffSelectionChanged(){if(this.diffUISelection){const i=this.diffUISelection.split(" - ");this.diffDatasets=i}else this.diffDatasets=[],this.diffRelative=!1;this.isCurrentlyDiffMode=!!this.diffUISelection},emitColorSpecificationDebounced(){if(!this.dataColumn)return;if(this.dataColumn==="@"){this.normalSelection="",this.selectedSingleColor||(this.selectedSingleColor=this.simpleColors[0]),this.clickedSingleColor(this.selectedSingleColor);return}const i=this.dataColumn.indexOf("/"),e=this.dataColumn.substring(0,i),t=this.dataColumn.substring(i+1),s=parseInt(this.steps),a=this.useHardCodedColors?this.vizConfiguration.display?.fill?.fixedColors.slice():this.buildColors(this.selectedColor,s);this.useHardCodedColors=!1;const l={dataset:e,columnName:t,join:this.join,fixedColors:a,normalize:this.normalSelection,colorRamp:{ramp:this.selectedColor.ramp,style:this.selectedColor.style,reverse:this.flip,steps:s}};this.transparencyColumn!=="@"&&(l.transparency=this.transparencyColumn),this.diffDatasets.length&&(l.diffDatasets=this.diffDatasets),this.diffRelative&&(l.relative=!0),this.vizConfiguration.display?.fill?.colorRamp?.breakpoints&&(l.colorRamp.breakpoints=this.vizConfiguration.display?.fill?.colorRamp?.breakpoints),this.$emit("update",{fill:l})},clickedSingleColor(i){this.selectedSingleColor=i;const e={fixedColors:[this.selectedSingleColor],dataset:"",columnName:"",normalize:""};this.$emit("update",{fill:e})},columnsInDataset(i){const e=this.datasets[i];return e?Object.keys(e).filter(s=>e[s].type!==u.LOOKUP):[]},pickColor(i){this.selectedColor=i,this.emitColorSpecification()},buildColors(i,e){let t=[...g(i,e||parseInt(this.steps))],s=!!i.reverse;return this.flip&&(s=!s),s&&(t=t.reverse()),i.style===n.sequential&&this.globalState.isDarkMode&&(t=t.reverse()),t}}});var se=function(){var e=this,t=e._self._c;return e._self._setupProxy,t("div",{staticClass:"color-ramp-picker"},[t("div",{staticClass:"widgets"},[t("div",{staticClass:"widget"},[t("p",{staticClass:"tight"},[e._v("Display")]),t("b-select",{staticClass:"selector",attrs:{size:"is-small",expanded:""},model:{value:e.dataColumn,callback:function(s){e.dataColumn=s},expression:"dataColumn"}},[t("option",{attrs:{label:"Single color",value:"@"}}),e._l(e.datasetChoices,function(s){return t("optgroup",{key:s,attrs:{label:s}},e._l(e.columnsInDataset(s),function(a){return t("option",{key:`${s}/${a}`,attrs:{label:a},domProps:{value:`${s}/${a}`}})}),0)})],2)],1)]),e.datasetChoices.length>1?t("div",{staticClass:"widgets"},[t("div",{staticClass:"widget"},[t("p",{staticClass:"tight"},[e._v("Join by")]),t("b-select",{staticClass:"selector",attrs:{size:"is-small",expanded:""},model:{value:e.join,callback:function(s){e.join=s},expression:"join"}},[t("option",{attrs:{label:"None",value:""}}),t("option",{attrs:{label:"Row count",value:"@count"}}),t("optgroup",{attrs:{label:"Join by..."}},e._l(e.columnsInDataset(e.dataColumn?.slice(0,e.dataColumn.indexOf("/"))||[]),function(s){return t("option",{attrs:{label:s},domProps:{value:s}})}),0)])],1)]):e._e(),e.dataColumn&&e.dataColumn.length>1?t("div",{staticClass:"widgets"},[t("div",{staticClass:"widget"},[t("p",{staticClass:"tight"},[e._v("Normalize by")]),t("b-select",{staticClass:"selector",attrs:{size:"is-small",expanded:""},model:{value:e.normalSelection,callback:function(s){e.normalSelection=s},expression:"normalSelection"}},[t("option",{attrs:{label:"None",value:""}}),e._l(e.datasetChoices,function(s){return t("optgroup",{key:s,attrs:{label:s}},e._l(e.columnsInDataset(s),function(a){return t("option",{key:`${s}/${a}`,attrs:{label:a},domProps:{value:`${s}:${a}`}})}),0)})],2)],1)]):e._e(),e.dataColumn&&e.dataColumn.length>1?t("div",{staticClass:"widgets"},[t("div",{staticClass:"widget"},[t("p",{staticClass:"tight"},[e._v("Transparency (0.0-1.0)")]),t("b-select",{staticClass:"selector",attrs:{size:"is-small",expanded:""},model:{value:e.transparencyColumn,callback:function(s){e.transparencyColumn=s},expression:"transparencyColumn"}},[t("option",{attrs:{label:"None",value:"@"}}),e._l(e.datasetChoices,function(s){return t("optgroup",{key:s,attrs:{label:s}},e._l(e.columnsInDataset(s),function(a){return t("option",{key:`${s}/${a}`,attrs:{label:a},domProps:{value:`${s}/${a}`}})}),0)})],2)],1)]):e._e(),t("div",{staticClass:"more",attrs:{title:e.diffChoices.length<2?"Add two datasets to enable comparisons":""}},[t("div",{staticClass:"widgets"},[t("div",{staticClass:"widget",staticStyle:{flex:"3"}},[t("p",{staticClass:"tight"},[e._v("Compare datasets")]),t("b-select",{staticClass:"selector",attrs:{size:"is-small",disabled:!e.dataColumn||e.diffChoices.length<2,expanded:""},model:{value:e.diffUISelection,callback:function(s){e.diffUISelection=s},expression:"diffUISelection"}},e._l(e.diffChoices,function(s){return t("option",{attrs:{label:s[0]},domProps:{value:s[1]}})}),0)],1),t("div",{staticClass:"widget"},[t("p",[e._v("%Diff")]),t("b-checkbox",{staticClass:"hello",attrs:{disabled:!e.diffUISelection||!e.dataColumn||e.diffChoices.length<2},model:{value:e.diffRelative,callback:function(s){e.diffRelative=s},expression:"diffRelative"}})],1)])]),t("div",{directives:[{name:"show",rawName:"v-show",value:e.dataColumn=="@",expression:"dataColumn=='@'"}],staticClass:"colorbar single"},e._l(e.simpleColors,function(s){return t("div",{key:s,staticClass:"single-color",class:{active:e.selectedSingleColor==s},style:{backgroundColor:`${s}`},on:{click:function(a){return e.clickedSingleColor(s)}}})}),0),t("div",{directives:[{name:"show",rawName:"v-show",value:e.dataColumn&&e.dataColumn.length>1,expression:"dataColumn && dataColumn.length > 1"}],staticClass:"more"},[t("div",{staticClass:"widgets"},[t("div",{staticClass:"widget",staticStyle:{flex:"3"}},[t("p",[e._v("Steps")]),t("b-input",{attrs:{size:"is-small",placeholder:"Number",type:"number",min:"2",max:"15"},model:{value:e.steps,callback:function(s){e.steps=s},expression:"steps"}})],1),t("div",{staticClass:"widget"},[t("p",[e._v("Flip")]),t("b-checkbox",{staticClass:"hello",model:{value:e.flip,callback:function(s){e.flip=s},expression:"flip"}})],1)]),e._l(e.colorChoices,function(s){return t("div",{key:s.ramp,staticClass:"color-ramp",class:{active:s===e.selectedColor},on:{click:function(a){return e.pickColor(s)}}},[t("div",{staticClass:"colorbar"},e._l(e.buildColors(s),function(a,l){return t("div",{key:l,staticClass:"swatch",style:{backgroundColor:`${a}`}},[t("p",[e._v(" ")])])}),0)])})],2)])},ie=[],ae=d(te,se,ie,!1,null,"70f3c63d");const le=ae.exports,oe=f({name:"FillHeightConfig",props:{vizConfiguration:{type:Object,required:!0},datasets:{type:Object,required:!0}},data:()=>{const i=["none","sqrt","pow5"];return{transforms:i,dataColumn:"",join:"",normalSelection:"",scaleFactor:"1",selectedTransform:i[0],datasetLabels:[],debounceHandleScale:{}}},mounted(){this.datasetLabels=Object.keys(this.vizConfiguration.datasets),this.debounceHandleScale=C.debounce(this.handleScaleChanged,500),this.datasetsAreLoaded(),this.vizConfigChanged()},watch:{vizConfiguration(){this.vizConfigChanged()},datasets(){this.datasetsAreLoaded()},join(){this.emitSpecification()},scaleFactor(){this.debounceHandleScale()},dataColumn(){this.emitSpecification()},normalSelection(){this.emitSpecification()}},computed:{datasetChoices(){return this.datasetLabels.filter(i=>i!=="csvBase").reverse()}},methods:{vizConfigChanged(){const i=this.vizConfiguration.display?.fillHeight;i?.columnName&&(this.dataColumn=`${i.dataset}/${i.columnName}`,this.datasetLabels=[...this.datasetLabels],this.scaleFactor=i.scaleFactor,this.join=i.join,i?.normalize&&(this.normalSelection=i.normalize))},datasetsAreLoaded(){const i=Object.keys(this.datasets);this.datasetLabels=i},handleScaleChanged(){this.emitSpecification()},emitSpecification(){if(!this.dataColumn)return;if(this.dataColumn==="^"){this.normalSelection="";const a={dataset:"",columnName:"",join:this.join,normalize:this.normalSelection,scaleFactor:parseFloat(this.scaleFactor)};setTimeout(()=>this.$emit("update",{fillHeight:a}),25);return}const i=this.dataColumn.indexOf("/"),e=this.dataColumn.substring(0,i),t=this.dataColumn.substring(i+1),s={dataset:e,columnName:t,join:this.join,normalize:this.normalSelection,scaleFactor:parseFloat(this.scaleFactor)};setTimeout(()=>this.$emit("update",{fillHeight:s}),25)},columnsInDataset(i){const e=this.datasets[i];return e?Object.keys(e).filter(s=>e[s].type!==u.LOOKUP):[]},numericColumnsInDataset(i){const e=this.datasets[i];return e?Object.keys(e).filter(s=>e[s].type!==u.LOOKUP):[]}}});var ne=function(){var e=this,t=e._self._c;return e._self._setupProxy,t("div",{staticClass:"height-panel"},[t("div",{staticClass:"widgets"},[t("div",{staticClass:"widget"},[t("p",{staticClass:"tight"},[e._v("Display")]),t("b-select",{staticClass:"selector",attrs:{expanded:""},model:{value:e.dataColumn,callback:function(s){e.dataColumn=s},expression:"dataColumn"}},[t("option",{attrs:{label:"None",value:"^"}}),e._l(e.datasetChoices,function(s){return t("optgroup",{key:s,attrs:{label:s}},e._l(e.numericColumnsInDataset(s),function(a){return t("option",{key:`${s}/${a}`,attrs:{label:a},domProps:{value:`${s}/${a}`}})}),0)})],2)],1)]),e.datasetChoices.length>1?t("div",{staticClass:"widgets"},[t("div",{staticClass:"widget"},[t("p",{staticClass:"tight"},[e._v("Join by")]),t("b-select",{staticClass:"selector",attrs:{expanded:""},model:{value:e.join,callback:function(s){e.join=s},expression:"join"}},[t("option",{attrs:{label:"None",value:""}}),t("option",{attrs:{label:"Row count",value:"@count"}}),t("optgroup",{attrs:{label:"Join by..."}},e._l(e.columnsInDataset(e.dataColumn?.slice(0,e.dataColumn.indexOf("/"))||[]),function(s){return t("option",{key:s,attrs:{label:s},domProps:{value:s}})}),0)])],1)]):e._e(),e.dataColumn&&e.dataColumn.length>1?t("div",{staticClass:"widgets"},[t("div",{staticClass:"widget"},[t("p",{staticClass:"tight"},[e._v("Normalize by")]),t("b-select",{staticClass:"selector",attrs:{expanded:""},model:{value:e.normalSelection,callback:function(s){e.normalSelection=s},expression:"normalSelection"}},[t("option",{attrs:{label:"None",value:""}}),e._l(e.datasetChoices,function(s){return t("optgroup",{key:s,attrs:{label:s}},e._l(e.numericColumnsInDataset(s),function(a){return t("option",{key:`${s}/${a}`,attrs:{label:a},domProps:{value:`${s}:${a}`}})}),0)})],2)],1)]):e._e(),t("div",{staticClass:"widgets"},[t("div",{staticClass:"widget"},[t("p",[e._v("Scaling")]),t("b-field",[t("b-input",{attrs:{disabled:!e.dataColumn,placeholder:"1.0"},model:{value:e.scaleFactor,callback:function(s){e.scaleFactor=s},expression:"scaleFactor"}})],1)],1)])])},re=[],ce=d(oe,ne,re,!1,null,"a845e5a4");const de=ce.exports,ue=f({name:"LineWidthsConfig",props:{vizConfiguration:{type:Object,required:!0},datasets:{type:Object,required:!0}},data:()=>({dataColumn:"",scaleFactor:"1",join:"",selectedTransform:["none","sqrt","pow5"][0],datasetLabels:[],diffDatasets:[],diffRelative:!1,diffUISelection:"",diffChoices:[],isCurrentlyDiffMode:!1,debounceHandleScaleChanged:{}}),mounted(){this.debounceHandleScaleChanged=b(this.handleScaleChanged,500),this.datasetsAreLoaded(),this.vizConfigChanged()},watch:{vizConfiguration(){this.vizConfigChanged()},dataColumn(){this.emitSpecification()},diffDatasets(){this.emitSpecification()},diffRelative(){this.emitSpecification()},datasets(){this.datasetsAreLoaded()},diffUISelection(){this.diffSelectionChanged()},scaleFactor(){this.debounceHandleScaleChanged()},join(){this.emitSpecification()}},computed:{datasetChoices(){return this.datasetLabels.filter(i=>i!=="csvBase").reverse()}},methods:{vizConfigChanged(){const i=this.vizConfiguration.display?.lineWidth;this.setupDiffMode(i),i?.columnName?(this.dataColumn=this.diffDatasets.length?`${this.diffDatasets[0]}/${i.columnName}`:`${i.dataset}/${i.columnName}`,this.datasetLabels=[...this.datasetLabels],this.scaleFactor=i.scaleFactor??"1",this.join=i.join):/^@\d$/.test(i?.dataset)&&(this.dataColumn=i.dataset)},setupDiffMode(i){if(!i?.diff)return;let e=[];if(i.diff.indexOf(" - ")>-1)e=i.diff.split(" - ").map(t=>t.trim());else if(e=i.diff.split("-").map(t=>t.trim()),e.length>2)throw Error('Ambiguous diff, use " - " to separate terms');this.diffDatasets=e,this.diffRelative=!!i.relative,this.diffUISelection=`${e[0]} - ${e[1]}`},datasetsAreLoaded(){const i=Object.keys(this.datasets);this.datasetLabels=i,this.updateDiffLabels()},updateDiffLabels(){const i=[];if(i.push(["No",""]),this.datasetLabels.length<=1)return;const e=this.datasetLabels.slice(1);let t=e.flatMap((s,a)=>e.slice(a+1).map(l=>s+" - "+l));t.forEach(s=>i.push([s,s])),e.reverse(),t=e.flatMap((s,a)=>e.slice(a+1).map(l=>s+" - "+l)),t.forEach(s=>i.push([s,s])),this.diffChoices=i},diffSelectionChanged(){if(this.diffUISelection){const i=this.diffUISelection.split(" - ");this.diffDatasets=i}else this.diffDatasets=[],this.diffRelative=!1;this.isCurrentlyDiffMode=!!this.diffUISelection},handleScaleChanged(){this.emitSpecification()},emitSpecification(){if(!this.dataColumn)return;const i=this.dataColumn.indexOf("/");if(i===-1){this.clickedSingle();return}const e=this.dataColumn.substring(0,i),t=this.dataColumn.substring(i+1),s={dataset:e,columnName:t,join:this.join,scaleFactor:parseFloat(this.scaleFactor)};this.diffDatasets.length&&(s.diffDatasets=this.diffDatasets),this.diffRelative&&(s.relative=!0),setTimeout(()=>this.$emit("update",{lineWidth:s}),50)},clickedSingle(){const i={dataset:"",columnName:"",scaleFactor:parseFloat(this.scaleFactor)};/^@\d$/.test(this.dataColumn)&&(i.dataset=this.dataColumn),setTimeout(()=>this.$emit("update",{lineWidth:i}),20)},columnsInDataset(i){const e=this.datasets[i];return e?Object.keys(e).filter(s=>e[s].type!==u.LOOKUP):[]},numericColumnsInDataset(i){const e=this.datasets[i];return e?Object.keys(e).filter(s=>e[s].type!==u.LOOKUP):[]}}});var fe=function(){var e=this,t=e._self._c;return e._self._setupProxy,t("div",{staticClass:"width-panel"},[t("div",{staticClass:"widgets"},[t("div",{staticClass:"widget"},[t("p",{staticClass:"tight"},[e._v("Display")]),t("b-select",{staticClass:"selector",attrs:{expanded:""},model:{value:e.dataColumn,callback:function(s){e.dataColumn=s},expression:"dataColumn"}},[t("option",{attrs:{label:"None",value:"@0"}}),t("option",{attrs:{label:"1px",value:"@1"}}),t("option",{attrs:{label:"2px",value:"@2"}}),t("option",{attrs:{label:"3px",value:"@3"}}),t("option",{attrs:{label:"5px",value:"@5"}}),t("option",{attrs:{label:"8px",value:"@8"}}),e._l(e.datasetChoices,function(s){return t("optgroup",{key:s,attrs:{label:s}},e._l(e.numericColumnsInDataset(s),function(a){return t("option",{key:`${s}/${a}`,attrs:{label:a},domProps:{value:`${s}/${a}`}})}),0)})],2)],1)]),e.datasetChoices.length>1&&e.dataColumn&&e.dataColumn.length>2?t("div",{staticClass:"widgets"},[t("div",{staticClass:"widget"},[t("p",{staticClass:"tight"},[e._v("Join by")]),t("b-select",{staticClass:"selector",attrs:{expanded:""},model:{value:e.join,callback:function(s){e.join=s},expression:"join"}},[t("option",{attrs:{label:"None",value:""}}),t("option",{attrs:{label:"Row count",value:"@count"}}),t("optgroup",{attrs:{label:"Join by..."}},e._l(e.columnsInDataset(e.dataColumn?.slice(0,e.dataColumn.indexOf("/"))||[]),function(s){return t("option",{key:s,attrs:{label:s},domProps:{value:s}})}),0)])],1)]):e._e(),e.dataColumn&&e.dataColumn.length>2?t("div",{staticClass:"widgets"},[t("div",{staticClass:"widget"},[t("p",[e._v("Scaling")]),t("b-field",[t("b-input",{attrs:{disabled:!e.dataColumn,placeholder:"1.0"},model:{value:e.scaleFactor,callback:function(s){e.scaleFactor=s},expression:"scaleFactor"}})],1)],1)]):e._e(),t("div",{staticClass:"more",attrs:{title:e.diffChoices.length<2?"Add two datasets to enable comparisons":""}},[t("div",{staticClass:"widgets"},[t("div",{staticClass:"widget",staticStyle:{flex:"3"}},[t("p",{staticClass:"tight"},[e._v("Compare datasets")]),t("b-select",{staticClass:"selector",attrs:{disabled:!e.dataColumn||e.diffChoices.length<2,expanded:""},model:{value:e.diffUISelection,callback:function(s){e.diffUISelection=s},expression:"diffUISelection"}},e._l(e.diffChoices,function(s){return t("option",{attrs:{label:s[0]},domProps:{value:s[1]}})}),0)],1)])])])},pe=[],he=d(ue,fe,pe,!1,null,"f5e874c7");const me=he.exports,Ce=f({name:"LayersConfig",props:{vizConfiguration:{type:Object,required:!0},subfolder:String},data:()=>({helpFileText:`File types supported:
URLs, GeoJSON, Shapefiles.

Note: The browser "Open" dialog does not provide the relative path,
so you may need to add the relative folder location here.`,rawFileData:{}}),mounted(){},computed:{layers(){return Object.keys(this.vizConfiguration.backgroundLayers).map(t=>{const s=this.vizConfiguration.backgroundLayers[t];return s.title=t,JSON.parse(JSON.stringify(s))})}},watch:{},methods:{async openFileDialog(i){const e=await this.loadFile();e.file&&(i.shapes=e.file.name,alert(`Note: If the selected file is not in the current folder:
/${this.subfolder}

then you must manually add the relative path, e.g.
../../${e.file.name}.

This is a browser security limitation.`),this.updateLayers())},loadFile(){return new Promise((i,e)=>{const t=document.createElement("input");t.type="file",t.accept=".geojson, .shp, gpkg",t.onchange=s=>{const a=s.target.files[0];if(a){const l=new FileReader;l.onload=c=>i({file:a,content:c.target.result}),l.onerror=c=>e(c),l.readAsArrayBuffer(a)}},t.click()})},deleteLayer(i){const e=this.layers[i].title;confirm(`Delete layer "${e}"?`)&&(this.layers.splice(i,1),this.updateLayers())},addLayer(){this.layers.unshift({title:`Layer ${1+this.layers.length}`,shapes:"",fill:"Rainbow",opacity:.5,borderColor:"#fff",borderWidth:3,label:"",visible:!0,onTop:!1}),this.updateLayers()},updateLayers(){setTimeout(()=>{this.$emit("update",{layers:this.layers})},100)},getLayer(i){try{return this.vizConfiguration?.backgroundLayers[i]}catch{return}}}});var ve=function(){var e=this,t=e._self._c;return e._self._setupProxy,t("div",{staticClass:"layers-panel"},[t("b-button",{staticClass:"is-small is-warning",on:{click:function(s){return e.addLayer()}}},[e._v("+ Add Layer")]),e._l(e.layers,function(s,a){return t("div",{staticClass:"layer"},[t("div",{staticClass:"delete-button",on:{click:function(l){return e.deleteLayer(a)}}},[e._v("x")]),e._m(0,!0),t("b-input",{attrs:{size:"is-small"},on:{input:e.updateLayers},model:{value:s.title,callback:function(l){e.$set(s,"title",l)},expression:"layer.title"}}),t("div",{staticClass:"xlabel",attrs:{title:e.helpFileText}},[e._v("File / URL ℹ️")]),t("div",{staticClass:"flex-row",staticStyle:{gap:"0.25rem"}},[t("b-input",{staticClass:"flex1",attrs:{size:"is-small"},on:{input:e.updateLayers},model:{value:s.shapes,callback:function(l){e.$set(s,"shapes",l)},expression:"layer.shapes"}}),t("b-button",{staticClass:"is-small",attrs:{title:"Open file..."},on:{click:function(l){return e.openFileDialog(s)}}},[t("i",{staticClass:"fas fa-folder"})])],1),t("div",{staticClass:"flex-row",staticStyle:{gap:"0.25rem"}},[t("div",{staticClass:"flex-col flex1"},[t("div",{staticClass:"xlabel"},[e._v("Fill Color")]),t("b-input",{attrs:{size:"is-small"},on:{input:e.updateLayers},model:{value:s.fill,callback:function(l){e.$set(s,"fill",l)},expression:"layer.fill"}})],1),t("div",{staticClass:"flex-col flex1"},[t("div",{staticClass:"xlabel"},[e._v("Opacity")]),t("b-input",{attrs:{size:"is-small"},on:{input:e.updateLayers},model:{value:s.opacity,callback:function(l){e.$set(s,"opacity",l)},expression:"layer.opacity"}})],1)]),t("div",{staticClass:"xlabel flex-row",staticStyle:{gap:"0.25rem"}},[t("div",{staticClass:"flex-col flex1"},[t("div",{staticClass:"t"},[e._v("Border Color")]),t("b-input",{attrs:{size:"is-small"},on:{input:e.updateLayers},model:{value:s.borderColor,callback:function(l){e.$set(s,"borderColor",l)},expression:"layer.borderColor"}})],1),t("div",{staticClass:"flex-col flex1"},[t("div",{staticClass:"t"},[e._v("Border Width")]),t("b-input",{attrs:{size:"is-small"},on:{input:e.updateLayers},model:{value:s.borderWidth,callback:function(l){e.$set(s,"borderWidth",l)},expression:"layer.borderWidth"}})],1)]),t("div",{staticClass:"xlabel"},[e._v("Label Column")]),t("b-input",{attrs:{size:"is-small"},on:{input:e.updateLayers},model:{value:s.label,callback:function(l){e.$set(s,"label",l)},expression:"layer.label"}}),t("div",{staticClass:"flex-row"},[t("b-checkbox",{staticClass:"flex1 simple-checkbox",on:{input:e.updateLayers},model:{value:s.visible,callback:function(l){e.$set(s,"visible",l)},expression:"layer.visible"}},[e._v("Visible")]),t("b-checkbox",{staticClass:"flex1 simple-checkbox",on:{input:e.updateLayers},model:{value:s.onTop,callback:function(l){e.$set(s,"onTop",l)},expression:"layer.onTop"}},[e._v("On top")])],1)],1)})],2)},ge=[function(){var i=this,e=i._self._c;return i._self._setupProxy,e("div",{staticClass:"xlabel",staticStyle:{"margin-top":"0"}},[e("b",[i._v("Layer Title")])])}],be=d(Ce,ve,ge,!1,null,"6b25b34a");const ye=be.exports,_e=f({name:"CircleRadiusConfig",props:{vizConfiguration:{type:Object,required:!0},datasets:{type:Object,required:!0}},data:()=>{const i=["none","sqrt","pow5"];return{transforms:i,dataColumn:"",scaleFactor:"100",selectedTransform:i[0],datasetLabels:[],join:""}},mounted(){this.datasetsAreLoaded(),this.vizConfigChanged()},watch:{vizConfiguration(){this.vizConfigChanged()},datasets(){this.datasetsAreLoaded()},scaleFactor(){this.emitWidthSpecification()},dataColumn(){this.emitWidthSpecification()},join(){this.emitWidthSpecification()}},computed:{datasetChoices(){return this.datasetLabels.filter(i=>i!=="csvBase").reverse()}},methods:{vizConfigChanged(){const i=this.vizConfiguration.display?.radius;if(i?.columnName){const e=`${i.dataset}/${i.columnName}`;this.dataColumn=e,this.datasetLabels=[...this.datasetLabels],this.scaleFactor=i.scaleFactor,this.join=i.join??""}},datasetsAreLoaded(){const i=Object.keys(this.datasets);this.datasetLabels=i},emitWidthSpecification(){if(!this.dataColumn)return;if(this.dataColumn=="@"){const a={columnName:"",scaleFactor:parseFloat(this.scaleFactor),join:this.join};setTimeout(()=>this.$emit("update",{radius:a}),50);return}const i=this.dataColumn.indexOf("/"),e=this.dataColumn.substring(0,i),t=this.dataColumn.substring(i+1),s={dataset:e,columnName:t,scaleFactor:parseFloat(this.scaleFactor),join:this.join};setTimeout(()=>this.$emit("update",{radius:s}),50)},columnsInDataset(i){const e=this.datasets[i];return e?Object.keys(e).filter(s=>e[s].type!==u.LOOKUP):[]},numericColumnsInDataset(i){const e=this.datasets[i];return e?Object.keys(e).filter(s=>e[s].type!==u.LOOKUP):[]}}});var Se=function(){var e=this,t=e._self._c;return e._self._setupProxy,t("div",{staticClass:"width-panel"},[t("div",{staticClass:"widgets"},[t("div",{staticClass:"widget"},[t("p",{staticClass:"tight"},[e._v("Display")]),t("b-select",{staticClass:"selector",attrs:{expanded:""},model:{value:e.dataColumn,callback:function(s){e.dataColumn=s},expression:"dataColumn"}},[t("option",{attrs:{label:"None",value:"@"}}),e._l(e.datasetChoices,function(s){return t("optgroup",{key:s,attrs:{label:s}},e._l(e.numericColumnsInDataset(s),function(a){return t("option",{attrs:{label:a},domProps:{value:`${s}/${a}`}})}),0)})],2)],1)]),e.datasetChoices.length>1?t("div",{staticClass:"widgets"},[t("div",{staticClass:"widget"},[t("p",{staticClass:"tight"},[e._v("Join by")]),t("b-select",{staticClass:"selector",attrs:{expanded:""},model:{value:e.join,callback:function(s){e.join=s},expression:"join"}},[t("option",{attrs:{label:"None",value:""}}),t("option",{attrs:{label:"Row count",value:"@count"}}),t("optgroup",{attrs:{label:"Join by..."}},e._l(e.columnsInDataset(e.dataColumn?.slice(0,e.dataColumn.indexOf("/"))||[]),function(s){return t("option",{key:s,attrs:{label:s},domProps:{value:s}})}),0)])],1)]):e._e(),t("div",{staticClass:"widgets"},[t("div",{staticClass:"widget"},[t("p",[e._v("Scaling")]),t("b-field",[t("b-input",{attrs:{disabled:!e.dataColumn,placeholder:"1.0"},model:{value:e.scaleFactor,callback:function(s){e.scaleFactor=s},expression:"scaleFactor"}})],1)],1)])])},xe=[],ke=d(_e,Se,xe,!1,null,"58b1c77a");const $e=ke.exports,we=f({props:{vizConfiguration:{type:Object,required:!0},datasets:{type:Object,required:!0}},data:()=>{const i=["Categories","==","!=","<=",">=","<",">"];return{OPERATORS:i,filters:{},addDataColumn:null,addOperator:i[0],addValue:"",datasetLabels:[]}},mounted(){this.datasetsAreLoaded(),this.vizConfigChanged()},watch:{filters(){this.emitSpecification()},vizConfiguration(){this.vizConfigChanged()},datasets(){this.datasetsAreLoaded()}},computed:{filterIds(){return Object.keys(this.filters)},datasetChoices(){return this.datasetLabels.filter(i=>i!=="XcsvBase").reverse()}},methods:{eraseFields(){this.addDataColumn=null,this.addOperator=this.OPERATORS[0],this.addValue=""},clickedCancel(){this.eraseFields()},clickedAddFilter(){let[i,e]=this.addDataColumn?this.addDataColumn.split("@"):["",""];this.datasetLabels.indexOf(i)<1&&(i="shapes"),this.addOperator===this.OPERATORS[0]&&(this.addValue="");const t={dataset:i,column:e,operator:this.addOperator,value:this.addValue};this.filters[`${i}.${e}`]=t,this.filters=Object.assign({},this.filters),this.eraseFields()},clickedRemoveFilter(i){delete this.filters[i],this.filters=Object.assign({},this.filters)},vizConfigChanged(){if(this.filters={},!this.vizConfiguration.filters)return;let i=JSON.parse(JSON.stringify(this.vizConfiguration.filters));if(Array.isArray(i)){const e={};i.forEach(t=>Object.assign(e,t)),i=e}for(const e of Object.keys(i)){const[t,s]=e.split(".");if(s==null){this.$emit("error",`Filter key is not "dataset.column": ${e}`);continue}const a={dataset:t,column:s,operator:"",value:i[e]};a.value===this.OPERATORS[0]&&(a.column=a.column.substring(0,a.column.length-1),a.operator=this.OPERATORS[0]),s.endsWith("!")&&(a.column=a.column.substring(0,a.column.length-1),a.operator="!=");for(const l of["<=",">=","<",">"])if(typeof a.value=="string"&&a.value.startsWith(l)){a.value=a.value.substring(l.length).trim(),a.operator=l;break}this.filters[`${a.dataset}.${a.column}`]=a}this.datasetLabels=[...this.datasetLabels]},datasetsAreLoaded(){const i=Object.keys(this.datasets);this.datasetLabels=i},emitSpecification(){const i={};for(const e of Object.keys(this.filters)){const t=Object.assign({},this.filters[e]);let s=`${t.dataset}.${t.column}`;t.operator==="!="&&(s+="!"),t.operator===this.OPERATORS[0]&&(t.value="@categorical"),(t.operator.startsWith("<")||t.operator.startsWith(">"))&&(t.value=`${t.operator} ${t.value}`),i[s]=t.value}setTimeout(()=>this.$emit("update",{filters:i}),25)},numericColumnsInDataset(i){const e=this.datasets[i];return e?Object.keys(e).filter(s=>e[s].type!==u.LOOKUP):[]}}});var De=function(){var e=this,t=e._self._c;return e._self._setupProxy,t("div",{staticClass:"width-panel"},[t("div",{directives:[{name:"show",rawName:"v-show",value:e.filterIds.length,expression:"filterIds.length"}],staticClass:"widgets"},[t("div",{staticClass:"widget"},[t("h4",[e._v("Active Filters")]),t("div",{staticClass:"filter-items"},e._l(e.filterIds,function(s){return t("div",{key:s,staticClass:"active-filter filter-details"},[t("p",{staticClass:"stretch"},[t("b",[e._v(e._s(e.filters[s].dataset)+": ")]),e.filters[s].operator==e.OPERATORS[0]?t("span",[e._v("by ")]):e._e(),e._v(e._s(`${e.filters[s].column}`)),e.filters[s].operator!==e.OPERATORS[0]?t("span",[e._v(" "+e._s(`${e.filters[s].operator} ${e.filters[s].value}`))]):e._e()]),t("div",{staticClass:"span close-button",on:{click:function(a){return e.clickedRemoveFilter(s)}}},[e._v("×")])])}),0)])]),t("div",{staticClass:"widgets"},[t("div",{staticClass:"widget boop"},[t("h4",[e._v("Add New Filter")]),t("b-select",{staticClass:"tight selector",attrs:{expanded:"",placeholder:"Select..."},model:{value:e.addDataColumn,callback:function(s){e.addDataColumn=s},expression:"addDataColumn"}},e._l(e.datasetChoices,function(s){return t("optgroup",{key:s,attrs:{label:s}},e._l(e.numericColumnsInDataset(s),function(a){return t("option",{attrs:{label:a},domProps:{value:`${s}@${a}`}})}),0)}),0),e.addDataColumn?t("div",{staticClass:"filter-details2"},[t("b-select",{staticClass:"operator",attrs:{expanded:""},model:{value:e.addOperator,callback:function(s){e.addOperator=s},expression:"addOperator"}},e._l(e.OPERATORS,function(s){return t("option",{attrs:{label:s},domProps:{value:s}})}),0),e.addOperator!==e.OPERATORS[0]?t("b-field",[t("b-input",{attrs:{placeholder:"1.0"},model:{value:e.addValue,callback:function(s){e.addValue=s},expression:"addValue"}})],1):e._e()],1):e._e(),e.addDataColumn?t("div",{staticClass:"button-bar"},[t("button",{staticClass:"button add-button is-small is-inverted",on:{click:e.clickedCancel}},[e._v("Cancel")]),e.addDataColumn?t("button",{staticClass:"button add-button is-small is-primary",attrs:{disabled:e.addOperator!==e.OPERATORS[0]&&e.addValue===""},on:{click:e.clickedAddFilter}},[e._v("  Add  ")]):e._e()]):e._e()],1)])])},Le=[],Oe=d(we,De,Le,!1,null,"3d1e0de6");const ze=Oe.exports,Fe=f({name:"VizConfigurator",components:{AddDatasetsPanel:A,CircleRadiusPanel:$e,ColorPanel:M,WidthPanel:J,FillColorPanel:le,FillHeightPanel:de,LegendBox:D,LineColorPanel:Q,LineWidthPanel:me,FiltersPanel:ze,LayersPanel:ye},props:{vizDetails:{type:Object,required:!0},datasets:{type:Object,required:!0},fileSystem:{type:Object,required:!0},subfolder:{type:String,required:!0},yamlConfig:{type:String},legendStore:{type:Object,required:!0},filterDefinitions:{type:Object,required:!0},sections:{type:Array},embedded:Boolean},data:()=>({showPanels:!1,showLegend:!0,activeSection:"",showAddDatasets:!1,selectedExportAction:"",layer:{general:{type:"links",dataset:"network.geojson",columns:{}},display:{lineColor:{},color:{},lineWidth:{},radius:{},fill:{},label:{},fillHeight:{}}}}),mounted(){this.activeSection=this.sections?this.sections[0]:"color",this.embedded&&(this.showLegend=!0)},computed:{vizConfiguration(){return{datasets:this.vizDetails.datasets,display:this.vizDetails.display,filters:this.vizDetails.filters,backgroundLayers:this.vizDetails.backgroundLayers||{}}},fidgetSections(){return Object.keys(this.layer.display)}},methods:{getSections(){return this.sections?this.sections.map(i=>({component:S.startCase(i.replaceAll("-"," ")).replaceAll(" ","")+"Panel",name:i.replaceAll("-"," ")})):[{component:"ColorPanel",name:"color"},{component:"WidthPanel",name:"width"}]},clickedShowHide(){this.showPanels=!this.showPanels},clickedLegendShowHide(){this.$emit("toggleLegend"),this.showLegend=!this.showLegend},clickedSection(i){i===this.activeSection?this.activeSection="":this.activeSection=i},async handleConfigChanged(i){this.showAddDatasets=!1,await this.$nextTick(),this.$emit("update",i)},clickedAddData(){this.showAddDatasets=!0},async clickedExport(i){await this.$nextTick(),this.selectedExportAction=="yaml"?this.exportYaml():this.selectedExportAction=="png"&&this.$emit("screenshot"),this.selectedExportAction=""},exportYaml(){let i="viz-viztype-config.yaml";const e=this.yamlConfig?.toLocaleLowerCase()||"";(e.endsWith("yaml")||e.endsWith("yml"))&&(i=this.yamlConfig||"viz-viztype-config.yaml"),e.endsWith("shp")&&(i=`viz-map-${e}.yaml`);const t=prompt("Export filename:",i);if(!t)return;const s={title:this.vizDetails.title,description:this.vizDetails.description,zoom:Math.round(10*this.$store.state.viewState.zoom)/10,pitch:Math.round(this.$store.state.viewState.pitch),bearing:Math.round(this.$store.state.viewState.bearing),center:[Math.round(100*this.$store.state.viewState.center[0])/100,Math.round(100*this.$store.state.viewState.center[1])/100],network:this.vizDetails.network||this.vizDetails.geojsonFile,projection:this.vizDetails.projection,showDifferences:this.vizDetails.showDifferences,sampleRate:this.vizDetails.sampleRate,shapes:this.vizDetails.shapes?.file||this.vizDetails.shapes,datasets:{...this.vizDetails.datasets},display:{...this.vizDetails.display},filters:{},backgroundLayers:this.vizDetails.backgroundLayers||{}};for(const r of Object.keys(s.backgroundLayers)){const o=s.backgroundLayers[r];delete o.title,o.label===""&&delete o.label}typeof this.vizDetails.shapes=="object"&&this.vizDetails.shapes.join&&(s.shapes={file:s.shapes,join:this.vizDetails.shapes.join}),this.$store.state.viewState.bearing||delete s.bearing,this.$store.state.viewState.pitch||delete s.pitch;const a=typeof s.shapes=="string"?s?.shapes?.substring(1+s.shapes.lastIndexOf("/")):s?.shapes?.file?.substring(1+s.shapes.file.lastIndexOf("/")||0);s.datasets[a]&&delete s.datasets[a];for(const r of Object.keys(s))s[r]||delete s[r];s.display.color&&(delete s.display.color?.colorRamp?.style,delete s.display.color?.fixedColors),s.display.fill&&(s.display.fill.colorRamp?(delete s.display.fill.colorRamp?.style,delete s.display.fill.fixedColors,s.display.fill.colorRamp.reverse||delete s.display.fill.colorRamp.reverse):(delete s.display.fill.filters,delete s.display.fill.dataset,delete s.display.fill.columnName)),s.display.lineColor&&(console.log(555,s.display.lineColor),s.display.lineColor.fixedColors&&s.display.lineColor.fixedColors[0]===""?s.display.lineColor=!1:s.display.lineColor.colorRamp?(delete s.display.lineColor.colorRamp?.style,delete s.display.lineColor.fixedColors,s.display.lineColor.colorRamp.reverse||delete s.display.lineColor.colorRamp.reverse):(delete s.display.lineColor.dataset,delete s.display.lineColor.columnName));for(const r of["fill","lineColor","lineWidth"]){const o=s.display[r];if(o&&(o.normalize||delete o.normalize,o.relative||delete o.relative,o.diffDatasets)){o.diff=`${o.diffDatasets[0]} - ${o.diffDatasets[1]}`,delete o.dataset,delete o.diffDatasets;const p={diff:o.diff,columnName:o.columnName};o.relative&&(p.relative=!0),s.display[r]=Object.assign(p,o)}}if(s.datasets)for(const[r,o]of Object.entries(s.datasets))typeof o.file=="object"&&(s.datasets[r].file=o.file?.name||o.file||r),typeof o=="object"&&(delete s.datasets[r].join,Object.keys(s.datasets[r]).length==1&&s.datasets[r].file&&(s.datasets[r]=s.datasets[r].file));for(const r of Object.entries(s.display))r[1]!==!1&&(Object.keys(r[1]).length||delete s.display[r[0]]);Object.keys(this.filterDefinitions).length?s.filters=Object.assign({},this.filterDefinitions):delete s.filters;const l=_.stringify(s,{indent:4,simpleKeys:!0});var c=document.createElement("a");c.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(l)),c.setAttribute("download",t),c.style.display="none",document.body.appendChild(c),c.click(),document.body.removeChild(c)}}});var je=function(){var e=this,t=e._self._c;return e._self._setupProxy,t("div",{staticClass:"viz-configurator"},[t("div",{staticClass:"map-actions"},[t("button",{directives:[{name:"show",rawName:"v-show",value:!e.embedded,expression:"!embedded"}],staticClass:"button draw-button is-tiny",class:{"is-showing":e.showPanels},attrs:{title:"Config"},on:{click:e.clickedShowHide}},[t("i",{staticClass:"fa fa-sliders-h settings-icon"})]),t("button",{staticClass:"button draw-button is-tiny",class:{"is-showing":e.showLegend},attrs:{title:"Legend"},on:{click:e.clickedLegendShowHide}},[t("i",{staticClass:"fa fa-info settings-icon"})])]),t("div",{staticClass:"right-panels"},[t("div",{directives:[{name:"show",rawName:"v-show",value:e.showPanels&&!e.showAddDatasets,expression:"showPanels && !showAddDatasets"}],staticClass:"configuration-panels"},[t("div",{staticClass:"section-panel"},[t("div",{staticClass:"actions"},[t("select",{directives:[{name:"model",rawName:"v-model",value:e.selectedExportAction,expression:"selectedExportAction"}],staticClass:"select-exporter",attrs:{name:"exporter"},on:{change:[function(s){var a=Array.prototype.filter.call(s.target.options,function(l){return l.selected}).map(function(l){var c="_value"in l?l._value:l.value;return c});e.selectedExportAction=s.target.multiple?a:a[0]},e.clickedExport]}},[e._v("hello"),t("option",{attrs:{value:"","aria-role":"menu"}},[e._v("EXPORT...")]),t("option",{attrs:{value:"yaml","aria-role":"listitem"}},[e._v("Save YAML config")]),t("option",{attrs:{value:"png","aria-role":"listitem"}},[e._v("Take screenshot")])]),t("b-button",{staticClass:"is-small is-white export-button",on:{click:e.clickedAddData}},[t("i",{staticClass:"fa fa-sm fa-plus"}),e._v(" Add Data")])],1)]),e._l(e.getSections(),function(s){return t("div",{key:s.name,staticClass:"section-panel"},[t("h1",{class:{h1active:s.name===e.activeSection},on:{click:function(a){return e.clickedSection(s.name)}}},[e._v(e._s(s.name))]),t("div",{directives:[{name:"show",rawName:"v-show",value:s.name===e.activeSection,expression:"section.name===activeSection"}],staticClass:"symbology-panel",class:{active:s.name===e.activeSection}},[s.component?t(s.component,{tag:"component",attrs:{vizConfiguration:e.vizConfiguration,vizDetails:e.vizDetails,datasets:e.datasets,subfolder:e.subfolder},on:{update:e.handleConfigChanged}}):t("p",[e._v("To be added")])],1)])})],2)]),e.showAddDatasets?t("add-datasets-panel",{attrs:{vizConfiguration:e.vizConfiguration,fileSystem:e.fileSystem,subfolder:e.subfolder},on:{update:e.handleConfigChanged}}):e._e()],1)},Re=[],Pe=d(Fe,je,Re,!1,null,"e26a8936");const We=Pe.exports;export{j as F,We as V};
