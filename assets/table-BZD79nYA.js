import{d as f,S as h,g as c,n as g}from"./index-D_sw2g-2.js";import{_ as u}from"./vue-good-table.esm-CI0urkCK.js";const p=f({name:"TablePanel",components:{VueGoodTable:u},props:{fileSystemConfig:{type:Object,required:!0},subfolder:{type:String,required:!0},files:{type:Array,required:!0},config:{type:Object,required:!0},cardTitle:{type:String,required:!1},cardId:String,datamanager:{type:Object,required:!0}},data:()=>({globalState:c.state,dataSet:{},id:"line-"+Math.floor(1e12*Math.random()),YAMLrequirementsLine:{dataset:""},YAMLdeprecations:[],columns:[],rows:[],paginationOptions:{enabled:!0,perPageDropdown:[],dropdownAllowAll:!1,perPage:5},dataColumnNames:["date"],percentColumnNames:["percent"],hideHeader:void 0,isFullsize:!1,alignmentClasses:[]}),async mounted(){this.dataSet=await this.loadData(),this.setAlignmentClasses(),this.prepareData(),this.$emit("isLoaded")},beforeDestroy(){this.datamanager?.removeFilterListener({...this.config,subfolder:this.subfolder},this.handleFilterChanged)},methods:{handleFilterChanged(){if(!this.datamanager)return;const{filteredRows:e}=this.datamanager.getFilteredDataset(this.config);if(!e||!e.length)this.dataSet={allRows:{}};else{const i={},n=Object.keys(e[0]);n.forEach(a=>i[a]={name:a,values:[]}),e.forEach(a=>{n.forEach(r=>i[r].values.push(a[r]))}),this.dataSet={allRows:i}}},async loadData(){if(!this.files.length)return{};try{let e=await this.datamanager.getDataset(this.config,{highPrecision:!0,subfolder:this.subfolder});if(!this.config.filters)return e;this.datamanager.addFilterListener({...this.config,subfolder:this.subfolder},this.handleFilterChanged);for(const[i,n]of Object.entries(this.config.filters)){const a={dataset:this.config.dataset,column:i,value:n,range:Array.isArray(n)};this.datamanager.setFilter(a)}return{allRows:{}}}catch(e){this.$emit("error",`Error loading: ${this.subfolder}/${this.config.dataset}`),console.error(""+e)}return{allRows:{}}},validateYAML(){for(const e in this.YAMLrequirementsLine)e in this.config||this.$emit("error",{type:h.ERROR,msg:`tablev2: missing required key: ${e}`,desc:JSON.stringify(this.config)});for(const e of this.YAMLdeprecations)this.config[e]&&this.$emit("error",{type:h.WARNING,msg:`tablev2: deprecated field: ${e}`,desc:JSON.stringify(this.config)})},onlyNumbers(e){return e.every(i=>typeof i=="number"||i==null)},onlyDates(e){return e.every(i=>i.length==10&&i.split("-").length==3)},columnFilterFn(e,i){return e.toString().includes(i.toString())},setAlignmentClasses(){if(this.config.alignment)for(let e=0;e<this.config.alignment.length;e++)this.config.alignment[e]=="left"?this.alignmentClasses.push(`col-left-${e+1}`):this.config.alignment[e]=="center"?this.alignmentClasses.push(`col-center-${e+1}`):this.config.alignment[e]=="right"&&this.alignmentClasses.push(`col-right-${e+1}`)},prepareData(){let e=0,i,n=[],a=[];this.columns=[],this.rows=[],Object.entries(this.dataSet.allRows).forEach(([t,o])=>{let s=t;s.indexOf(".")>-1&&(s=d=>d[t]),this.columns.push({label:t.charAt(0).toUpperCase()+t.slice(1),field:s,originalField:t,hidden:!1,filterOptions:{enabled:!0,filterFn:this.columnFilterFn}}),i=o,e=i.values.length});for(let t=0;t<e;t++)this.rows.push({});Object.entries(this.dataSet.allRows).forEach(([t,o])=>{i=o,this.onlyNumbers(i.values)?n.push(t):this.onlyDates(i.values)&&a.push(t),e=i.values.length;for(let s=0;s<e;s++)this.rows[s][t]=i.values[s]}),Object.values(this.columns).forEach(t=>{n.includes(t.field)&&Object.assign(t,{type:"number",tdClass:"vgt-right-align-text-for-numbers"}),(a.includes(t.field)||this.dataColumnNames.includes(t.field))&&(Object.assign(t,{type:"date"}),Object.assign(t,{dateInputFormat:"yyyy-MM-dd"}),Object.assign(t,{dateOutputFormat:"yyyy-MM-dd"})),this.percentColumnNames.includes(t.field)&&Object.assign(t,{type:"percentage"})});for(let t=0;t<this.columns.length;t++)this.config.enableFilter?(this.columns[t].filterOptions.enabled=!0,this.columns[t].filterOptions.filterFn=this.columnFilterFn):this.columns[t].filterOptions.enabled=!1;const r=Array.isArray(this.config.show)?new Set(this.config.show.map(t=>t.toString().toLowerCase())):null,l=Array.isArray(this.config.hide)?new Set(this.config.hide.map(t=>t.toString().toLowerCase())):null;if(r||l)for(let t=0;t<this.columns.length;t++){const s=(this.columns[t].originalField??(typeof this.columns[t].field=="string"?this.columns[t].field:"")).toString().toLowerCase();r?this.columns[t].hidden=!r.has(s):l&&(this.columns[t].hidden=l.has(s))}e<5?(this.paginationOptions.perPage=e,this.paginationOptions={...this.paginationOptions,perPageDropdown:[e]}):e<10?this.paginationOptions={...this.paginationOptions,perPageDropdown:[5]}:e<20?this.paginationOptions={...this.paginationOptions,perPageDropdown:[5,10]}:this.paginationOptions={...this.paginationOptions,perPageDropdown:[5,10,20]},this.config.style=="topsheet"&&(this.hideHeader=!0,this.isFullsize=!0),this.config.hideHeader!=null&&(this.hideHeader=this.config.hideHeader),(this.isFullsize||this.config.fullsize||this.config.showAllRows||this.config.showallrows||this.config.showAllrows)&&(this.paginationOptions.enabled=!1),e<5&&(this.paginationOptions.enabled=!1)}}});var m=function(){var i=this,n=i._self._c;return i._self._setupProxy,n("vue-good-table",{staticClass:"plugin-panel",class:[i.globalState.isDarkMode?"darktable":"lighttable",i.hideHeader?"hide-header":"",this.config.style,...this.alignmentClasses],attrs:{"data-testid":"vue-good-table",columns:i.columns,rows:i.rows,"fixed-header":!1,"pagination-options":i.paginationOptions,styleClass:"vgt-table striped bordered condensed"}})},b=[],y=g(p,m,b,!1,null,"c92635b9");const C=y.exports;export{C as default};
