import{a as i_,r as je,j as kS}from"./index-BSRT1qCd.js";import{_ as Vb}from"./HTTPFileSystem-CM0ZTrcf.js";function RS(r,e){for(var i=0;i<e.length;i++){const l=e[i];if(typeof l!="string"&&!Array.isArray(l)){for(const u in l)if(u!=="default"&&!(u in r)){const m=Object.getOwnPropertyDescriptor(l,u);m&&Object.defineProperty(r,u,m.get?m:{enumerable:!0,get:()=>l[u]})}}}return Object.freeze(Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}))}function Sc(r){"@babel/helpers - typeof";return Sc=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Sc(r)}function OS(r,e){if(Sc(r)!="object"||!r)return r;var i=r[Symbol.toPrimitive];if(i!==void 0){var l=i.call(r,e||"default");if(Sc(l)!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function Gb(r){var e=OS(r,"string");return Sc(e)=="symbol"?e:e+""}function j(r,e,i){return(e=Gb(e))in r?Object.defineProperty(r,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[e]=i,r}function go(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function bg(r,e){return bg=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,l){return i.__proto__=l,i},bg(r,e)}var Zb={exports:{}},DS="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",zS=DS,BS=zS;function $b(){}function Wb(){}Wb.resetWarningCache=$b;var FS=function(){function r(l,u,m,y,T,a){if(a!==BS){var P=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw P.name="Invariant Violation",P}}r.isRequired=r;function e(){return r}var i={array:r,bigint:r,bool:r,func:r,number:r,object:r,string:r,symbol:r,any:r,arrayOf:e,element:r,elementType:r,instanceOf:e,node:r,objectOf:e,oneOf:e,oneOfType:e,shape:e,exact:e,checkPropTypes:Wb,resetWarningCache:$b};return i.PropTypes=i,i};Zb.exports=FS();var Pe=Zb.exports;const wF=i_(Pe);var qb=function(){if(typeof Map<"u")return Map;function r(e,i){var l=-1;return e.some(function(u,m){return u[0]===i?(l=m,!0):!1}),l}return function(){function e(){this.__entries__=[]}return Object.defineProperty(e.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),e.prototype.get=function(i){var l=r(this.__entries__,i),u=this.__entries__[l];return u&&u[1]},e.prototype.set=function(i,l){var u=r(this.__entries__,i);~u?this.__entries__[u][1]=l:this.__entries__.push([i,l])},e.prototype.delete=function(i){var l=this.__entries__,u=r(l,i);~u&&l.splice(u,1)},e.prototype.has=function(i){return!!~r(this.__entries__,i)},e.prototype.clear=function(){this.__entries__.splice(0)},e.prototype.forEach=function(i,l){l===void 0&&(l=null);for(var u=0,m=this.__entries__;u<m.length;u++){var y=m[u];i.call(l,y[1],y[0])}},e}()}(),wg=typeof window<"u"&&typeof document<"u"&&window.document===document,Vd=function(){return typeof global<"u"&&global.Math===Math?global:typeof self<"u"&&self.Math===Math?self:typeof window<"u"&&window.Math===Math?window:Function("return this")()}(),NS=function(){return typeof requestAnimationFrame=="function"?requestAnimationFrame.bind(Vd):function(r){return setTimeout(function(){return r(Date.now())},1e3/60)}}(),US=2;function jS(r,e){var i=!1,l=!1,u=0;function m(){i&&(i=!1,r()),l&&T()}function y(){NS(m)}function T(){var a=Date.now();if(i){if(a-u<US)return;l=!0}else i=!0,l=!1,setTimeout(y,e);u=a}return T}var VS=20,GS=["top","right","bottom","left","width","height","size","weight"],ZS=typeof MutationObserver<"u",$S=function(){function r(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=jS(this.refresh.bind(this),VS)}return r.prototype.addObserver=function(e){~this.observers_.indexOf(e)||this.observers_.push(e),this.connected_||this.connect_()},r.prototype.removeObserver=function(e){var i=this.observers_,l=i.indexOf(e);~l&&i.splice(l,1),!i.length&&this.connected_&&this.disconnect_()},r.prototype.refresh=function(){var e=this.updateObservers_();e&&this.refresh()},r.prototype.updateObservers_=function(){var e=this.observers_.filter(function(i){return i.gatherActive(),i.hasActive()});return e.forEach(function(i){return i.broadcastActive()}),e.length>0},r.prototype.connect_=function(){!wg||this.connected_||(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),ZS?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},r.prototype.disconnect_=function(){!wg||!this.connected_||(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},r.prototype.onTransitionEnd_=function(e){var i=e.propertyName,l=i===void 0?"":i,u=GS.some(function(m){return!!~l.indexOf(m)});u&&this.refresh()},r.getInstance=function(){return this.instance_||(this.instance_=new r),this.instance_},r.instance_=null,r}(),Xb=function(r,e){for(var i=0,l=Object.keys(e);i<l.length;i++){var u=l[i];Object.defineProperty(r,u,{value:e[u],enumerable:!1,writable:!1,configurable:!0})}return r},Ac=function(r){var e=r&&r.ownerDocument&&r.ownerDocument.defaultView;return e||Vd},Hb=sp(0,0,0,0);function Gd(r){return parseFloat(r)||0}function _0(r){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];return e.reduce(function(l,u){var m=r["border-"+u+"-width"];return l+Gd(m)},0)}function WS(r){for(var e=["top","right","bottom","left"],i={},l=0,u=e;l<u.length;l++){var m=u[l],y=r["padding-"+m];i[m]=Gd(y)}return i}function qS(r){var e=r.getBBox();return sp(0,0,e.width,e.height)}function XS(r){var e=r.clientWidth,i=r.clientHeight;if(!e&&!i)return Hb;var l=Ac(r).getComputedStyle(r),u=WS(l),m=u.left+u.right,y=u.top+u.bottom,T=Gd(l.width),a=Gd(l.height);if(l.boxSizing==="border-box"&&(Math.round(T+m)!==e&&(T-=_0(l,"left","right")+m),Math.round(a+y)!==i&&(a-=_0(l,"top","bottom")+y)),!YS(r)){var P=Math.round(T+m)-e,D=Math.round(a+y)-i;Math.abs(P)!==1&&(T-=P),Math.abs(D)!==1&&(a-=D)}return sp(u.left,u.top,T,a)}var HS=function(){return typeof SVGGraphicsElement<"u"?function(r){return r instanceof Ac(r).SVGGraphicsElement}:function(r){return r instanceof Ac(r).SVGElement&&typeof r.getBBox=="function"}}();function YS(r){return r===Ac(r).document.documentElement}function KS(r){return wg?HS(r)?qS(r):XS(r):Hb}function JS(r){var e=r.x,i=r.y,l=r.width,u=r.height,m=typeof DOMRectReadOnly<"u"?DOMRectReadOnly:Object,y=Object.create(m.prototype);return Xb(y,{x:e,y:i,width:l,height:u,top:i,right:e+l,bottom:u+i,left:e}),y}function sp(r,e,i,l){return{x:r,y:e,width:i,height:l}}var QS=function(){function r(e){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=sp(0,0,0,0),this.target=e}return r.prototype.isActive=function(){var e=KS(this.target);return this.contentRect_=e,e.width!==this.broadcastWidth||e.height!==this.broadcastHeight},r.prototype.broadcastRect=function(){var e=this.contentRect_;return this.broadcastWidth=e.width,this.broadcastHeight=e.height,e},r}(),eA=function(){function r(e,i){var l=JS(i);Xb(this,{target:e,contentRect:l})}return r}(),tA=function(){function r(e,i,l){if(this.activeObservations_=[],this.observations_=new qb,typeof e!="function")throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=e,this.controller_=i,this.callbackCtx_=l}return r.prototype.observe=function(e){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if(!(typeof Element>"u"||!(Element instanceof Object))){if(!(e instanceof Ac(e).Element))throw new TypeError('parameter 1 is not of type "Element".');var i=this.observations_;i.has(e)||(i.set(e,new QS(e)),this.controller_.addObserver(this),this.controller_.refresh())}},r.prototype.unobserve=function(e){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if(!(typeof Element>"u"||!(Element instanceof Object))){if(!(e instanceof Ac(e).Element))throw new TypeError('parameter 1 is not of type "Element".');var i=this.observations_;i.has(e)&&(i.delete(e),i.size||this.controller_.removeObserver(this))}},r.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},r.prototype.gatherActive=function(){var e=this;this.clearActive(),this.observations_.forEach(function(i){i.isActive()&&e.activeObservations_.push(i)})},r.prototype.broadcastActive=function(){if(this.hasActive()){var e=this.callbackCtx_,i=this.activeObservations_.map(function(l){return new eA(l.target,l.broadcastRect())});this.callback_.call(e,i,e),this.clearActive()}},r.prototype.clearActive=function(){this.activeObservations_.splice(0)},r.prototype.hasActive=function(){return this.activeObservations_.length>0},r}(),Yb=typeof WeakMap<"u"?new WeakMap:new qb,Kb=function(){function r(e){if(!(this instanceof r))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var i=$S.getInstance(),l=new tA(e,i,this);Yb.set(this,l)}return r}();["observe","unobserve","disconnect"].forEach(function(r){Kb.prototype[r]=function(){var e;return(e=Yb.get(this))[r].apply(e,arguments)}});var iA=function(){return typeof Vd.ResizeObserver<"u"?Vd.ResizeObserver:Kb}();function y0(r,e){if(!r)throw new Error(e||"loader assertion failed.")}const Jb=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),v0=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);v0&&parseFloat(v0[1]);const rA="3.2.11";function bo(r,e){if(!r)throw new Error(e||"loaders.gl assertion failed.")}const Rd=typeof process!="object"||String(process)!=="[object process]"||process.browser,nA=typeof window<"u"&&typeof window.orientation<"u",x0=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);x0&&parseFloat(x0[1]);class sA{constructor(e,i){j(this,"name",void 0),j(this,"workerThread",void 0),j(this,"isRunning",!0),j(this,"result",void 0),j(this,"_resolve",()=>{}),j(this,"_reject",()=>{}),this.name=e,this.workerThread=i,this.result=new Promise((l,u)=>{this._resolve=l,this._reject=u})}postMessage(e,i){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:i})}done(e){bo(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){bo(this.isRunning),this.isRunning=!1,this._reject(e)}}let Vm=class{};const Gm=new Map;function oA(r){bo(r.source&&!r.url||!r.source&&r.url);let e=Gm.get(r.source||r.url);return e||(r.url&&(e=aA(r.url),Gm.set(r.url,e)),r.source&&(e=Qb(r.source),Gm.set(r.source,e))),bo(e),e}function aA(r){if(!r.startsWith("http"))return r;const e=lA(r);return Qb(e)}function Qb(r){const e=new Blob([r],{type:"application/javascript"});return URL.createObjectURL(e)}function lA(r){return`try {
  importScripts('`.concat(r,`');
} catch (error) {
  console.error(error);
  throw error;
}`)}function e1(r,e=!0,i){const l=i||new Set;if(r){if(b0(r))l.add(r);else if(b0(r.buffer))l.add(r.buffer);else if(!ArrayBuffer.isView(r)){if(e&&typeof r=="object")for(const u in r)e1(r[u],e,l)}}return i===void 0?Array.from(l):[]}function b0(r){return r?r instanceof ArrayBuffer||typeof MessagePort<"u"&&r instanceof MessagePort||typeof ImageBitmap<"u"&&r instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&r instanceof OffscreenCanvas:!1}const Zm=()=>{};class Tg{static isSupported(){return typeof Worker<"u"&&Rd||typeof Vm<"u"&&!Rd}constructor(e){j(this,"name",void 0),j(this,"source",void 0),j(this,"url",void 0),j(this,"terminated",!1),j(this,"worker",void 0),j(this,"onMessage",void 0),j(this,"onError",void 0),j(this,"_loadableURL","");const{name:i,source:l,url:u}=e;bo(l||u),this.name=i,this.source=l,this.url=u,this.onMessage=Zm,this.onError=m=>console.log(m),this.worker=Rd?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=Zm,this.onError=Zm,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,i){i=i||e1(e),this.worker.postMessage(e,i)}_getErrorFromErrorEvent(e){let i="Failed to load ";return i+="worker ".concat(this.name," from ").concat(this.url,". "),e.message&&(i+="".concat(e.message," in ")),e.lineno&&(i+=":".concat(e.lineno,":").concat(e.colno)),new Error(i)}_createBrowserWorker(){this._loadableURL=oA({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=i=>{i.data?this.onMessage(i.data):this.onError(new Error("No data received"))},e.onerror=i=>{this.onError(this._getErrorFromErrorEvent(i)),this.terminated=!0},e.onmessageerror=i=>console.error(i),e}_createNodeWorker(){let e;if(this.url){const l=this.url.includes(":/")||this.url.startsWith("/")?this.url:"./".concat(this.url);e=new Vm(l,{eval:!1})}else if(this.source)e=new Vm(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",i=>{this.onMessage(i)}),e.on("error",i=>{this.onError(i)}),e.on("exit",i=>{}),e}}class cA{static isSupported(){return Tg.isSupported()}constructor(e){j(this,"name","unnamed"),j(this,"source",void 0),j(this,"url",void 0),j(this,"maxConcurrency",1),j(this,"maxMobileConcurrency",1),j(this,"onDebug",()=>{}),j(this,"reuseWorkers",!0),j(this,"props",{}),j(this,"jobQueue",[]),j(this,"idleQueue",[]),j(this,"count",0),j(this,"isDestroyed",!1),this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,i=(u,m,y)=>u.done(y),l=(u,m)=>u.error(m)){const u=new Promise(m=>(this.jobQueue.push({name:e,onMessage:i,onError:l,onStart:m}),this));return this._startQueuedJob(),await u}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const i=this.jobQueue.shift();if(i){this.onDebug({message:"Starting job",name:i.name,workerThread:e,backlog:this.jobQueue.length});const l=new sA(i.name,e);e.onMessage=u=>i.onMessage(l,u.type,u.payload),e.onError=u=>i.onError(l,u),i.onStart(l);try{await l.result}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e="".concat(this.name.toLowerCase()," (#").concat(this.count," of ").concat(this.maxConcurrency,")");return new Tg({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return nA?this.maxMobileConcurrency:this.maxConcurrency}}const uA={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class yo{static isSupported(){return Tg.isSupported()}static getWorkerFarm(e={}){return yo._workerFarm=yo._workerFarm||new yo({}),yo._workerFarm.setProps(e),yo._workerFarm}constructor(e){j(this,"props",void 0),j(this,"workerPools",new Map),this.props={...uA},this.setProps(e),this.workerPools=new Map}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const i of this.workerPools.values())i.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:i,source:l,url:u}=e;let m=this.workerPools.get(i);return m||(m=new cA({name:i,source:l,url:u}),m.setProps(this._getWorkerPoolProps()),this.workerPools.set(i,m)),m}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}j(yo,"_workerFarm",void 0);const hA="latest";function fA(r,e={}){const i=e[r.id]||{},l="".concat(r.id,"-worker.js");let u=i.workerUrl;if(!u&&r.id==="compression"&&(u=e.workerUrl),e._workerType==="test"&&(u="modules/".concat(r.module,"/dist/").concat(l)),!u){let m=r.version;m==="latest"&&(m=hA);const y=m?"@".concat(m):"";u="https://unpkg.com/@loaders.gl/".concat(r.module).concat(y,"/dist/").concat(l)}return bo(u),u}function dA(r,e=rA){bo(r,"no worker provided");const i=r.version;return!(!e||!i)}function pA(r,e){return!yo.isSupported()||!Rd&&!(e!=null&&e._nodeWorkers)?!1:r.worker&&e?.worker}async function mA(r,e,i,l,u){const m=r.id,y=fA(r,i),a=yo.getWorkerFarm(i).getWorkerPool({name:m,url:y});i=JSON.parse(JSON.stringify(i)),l=JSON.parse(JSON.stringify(l||{}));const P=await a.startJob("process-on-worker",gA.bind(null,u));return P.postMessage("process",{input:e,options:i,context:l}),await(await P.result).result}async function gA(r,e,i,l){switch(i){case"done":e.done(l);break;case"error":e.error(new Error(l.error));break;case"process":const{id:u,input:m,options:y}=l;try{const T=await r(m,y);e.postMessage("done",{id:u,result:T})}catch(T){const a=T instanceof Error?T.message:"unknown error";e.postMessage("error",{id:u,error:a})}break;default:console.warn("parse-with-worker unknown message ".concat(i))}}function t1(r){return r&&typeof r=="object"&&r.isBuffer}function _A(r){return t1(r)?new Uint8Array(r.buffer,r.byteOffset,r.length).slice().buffer:r}function i1(r){if(t1(r))return _A(r);if(r instanceof ArrayBuffer)return r;if(ArrayBuffer.isView(r))return r.byteOffset===0&&r.byteLength===r.buffer.byteLength?r.buffer:r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength);if(typeof r=="string"){const e=r;return new TextEncoder().encode(e).buffer}if(r&&typeof r=="object"&&r._toArrayBuffer)return r._toArrayBuffer();throw new Error("toArrayBuffer")}function yA(r,e,i){if(i=i||r.byteLength,r.byteLength<i||e.byteLength<i)return!1;const l=new Uint8Array(r),u=new Uint8Array(e);for(let m=0;m<l.length;++m)if(l[m]!==u[m])return!1;return!0}function vA(...r){const e=r.map(m=>m instanceof ArrayBuffer?new Uint8Array(m):m),i=e.reduce((m,y)=>m+y.byteLength,0),l=new Uint8Array(i);let u=0;for(const m of e)l.set(m,u),u+=m.byteLength;return l.buffer}async function xA(r){const e=[];for await(const i of r)e.push(i);return vA(...e)}function w0(){let r;if(typeof window<"u"&&window.performance)r=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();r=e[0]*1e3+e[1]/1e6}else r=Date.now();return r}class T0{constructor(e,i){j(this,"name",void 0),j(this,"type",void 0),j(this,"sampleSize",1),j(this,"time",void 0),j(this,"count",void 0),j(this,"samples",void 0),j(this,"lastTiming",void 0),j(this,"lastSampleTime",void 0),j(this,"lastSampleCount",void 0),j(this,"_count",0),j(this,"_time",0),j(this,"_samples",0),j(this,"_startTime",0),j(this,"_timerPending",!1),this.name=e,this.type=i,this.reset()}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=w0(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(w0()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class r_{constructor(e){j(this,"id",void 0),j(this,"stats",{}),this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:e,type:i})}get size(){return Object.keys(this.stats).length}reset(){for(const e in this.stats)this.stats[e].reset();return this}forEach(e){for(const i in this.stats)e(this.stats[i])}getTable(){const e={};return this.forEach(i=>{e[i.name]={time:i.time||0,count:i.count||0,average:i.getAverageTime()||0,hz:i.getHz()||0}}),e}_initializeStats(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(i=>this._getOrCreate(i))}_getOrCreate(e){if(!e||!e.name)return null;const{name:i,type:l}=e;return this.stats[i]||(e instanceof T0?this.stats[i]=e:this.stats[i]=new T0(i,l)),this.stats[i]}}let bA="";const E0={};function wA(r){for(const e in E0)if(r.startsWith(e)){const i=E0[e];r=r.replace(e,i)}return!r.startsWith("http://")&&!r.startsWith("https://")&&(r="".concat(bA).concat(r)),r}function TA(r){const e=r&&r.lastIndexOf("/");return e>=0?r.substr(e+1):""}const EA=r=>typeof r=="boolean",yh=r=>typeof r=="function",Oh=r=>r!==null&&typeof r=="object",S0=r=>Oh(r)&&r.constructor==={}.constructor,SA=r=>r&&typeof r[Symbol.iterator]=="function",AA=r=>r&&typeof r[Symbol.asyncIterator]=="function",Dc=r=>typeof Response<"u"&&r instanceof Response||r&&r.arrayBuffer&&r.text&&r.json,zc=r=>typeof Blob<"u"&&r instanceof Blob,MA=r=>r&&typeof r=="object"&&r.isBuffer,PA=r=>typeof ReadableStream<"u"&&r instanceof ReadableStream||Oh(r)&&yh(r.tee)&&yh(r.cancel)&&yh(r.getReader),IA=r=>Oh(r)&&yh(r.read)&&yh(r.pipe)&&EA(r.readable),r1=r=>PA(r)||IA(r),CA=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,LA=/^([-\w.]+\/[-\w.+]+)/;function kA(r){const e=LA.exec(r);return e?e[1]:r}function A0(r){const e=CA.exec(r);return e?e[1]:""}const RA=/\?.*/;function op(r){if(Dc(r)){const e=$m(r.url||""),i=r.headers.get("content-type")||"";return{url:e,type:kA(i)||A0(e)}}return zc(r)?{url:$m(r.name||""),type:r.type||""}:typeof r=="string"?{url:$m(r),type:A0(r)}:{url:"",type:""}}function OA(r){return Dc(r)?r.headers["content-length"]||-1:zc(r)?r.size:typeof r=="string"?r.length:r instanceof ArrayBuffer||ArrayBuffer.isView(r)?r.byteLength:-1}function $m(r){return r.replace(RA,"")}async function n1(r){if(Dc(r))return r;const e={},i=OA(r);i>=0&&(e["content-length"]=String(i));const{url:l,type:u}=op(r);u&&(e["content-type"]=u);const m=await BA(r);m&&(e["x-first-bytes"]=m),typeof r=="string"&&(r=new TextEncoder().encode(r));const y=new Response(r,{headers:e});return Object.defineProperty(y,"url",{value:l}),y}async function DA(r){if(!r.ok){const e=await zA(r);throw new Error(e)}}async function zA(r){let e="Failed to fetch resource ".concat(r.url," (").concat(r.status,"): ");try{const i=r.headers.get("Content-Type");let l=r.statusText;i.includes("application/json")&&(l+=" ".concat(await r.text())),e+=l,e=e.length>60?"".concat(e.slice(0,60),"..."):e}catch{}return e}async function BA(r){if(typeof r=="string")return"data:,".concat(r.slice(0,5));if(r instanceof Blob){const i=r.slice(0,5);return await new Promise(l=>{const u=new FileReader;u.onload=m=>{var y;return l(m==null||(y=m.target)===null||y===void 0?void 0:y.result)},u.readAsDataURL(i)})}if(r instanceof ArrayBuffer){const i=r.slice(0,5),l=FA(i);return"data:base64,".concat(l)}return null}function FA(r){let e="";const i=new Uint8Array(r);for(let l=0;l<i.byteLength;l++)e+=String.fromCharCode(i[l]);return btoa(e)}async function M0(r,e){if(typeof r=="string"){r=wA(r);let i=e;return e!=null&&e.fetch&&typeof e?.fetch!="function"&&(i=e.fetch),await fetch(r,i)}return await n1(r)}function s1(r){if(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&process.versions.electron)return!0;const i=typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent;return!!(i&&i.indexOf("Electron")>=0)}function Eo(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process.browser)||s1()}const Od={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document,process:typeof process=="object"&&process},yd=Od.window||Od.self||Od.global,uh=Od.process||{},o1=typeof __VERSION__<"u"?__VERSION__:"untranspiled source";Eo();const Wm=globalThis;function a1(r){if(!Eo())return"Node";if(s1())return"Electron";const i=(typeof navigator<"u"?navigator:{}).userAgent||"";if(i.indexOf("Edge")>-1)return"Edge";const l=i.indexOf("MSIE ")!==-1,u=i.indexOf("Trident/")!==-1;return l||u?"IE":Wm.chrome?"Chrome":Wm.safari?"Safari":Wm.mozInnerScreenX?"Firefox":"Unknown"}function NA(r){try{const e=window[r],i="__storage_test__";return e.setItem(i,i),e.removeItem(i),e}catch{return null}}class UA{constructor(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"sessionStorage";j(this,"storage",void 0),j(this,"id",void 0),j(this,"config",{}),this.storage=NA(l),this.id=e,this.config={},Object.assign(this.config,i),this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){return this.config={},this.updateConfiguration(e)}updateConfiguration(e){if(Object.assign(this.config,e),this.storage){const i=JSON.stringify(this.config);this.storage.setItem(this.id,i)}return this}_loadConfiguration(){let e={};if(this.storage){const i=this.storage.getItem(this.id);e=i?JSON.parse(i):{}}return Object.assign(this.config,e),this}}function jA(r){let e;return r<10?e="".concat(r.toFixed(2),"ms"):r<100?e="".concat(r.toFixed(1),"ms"):r<1e3?e="".concat(r.toFixed(0),"ms"):e="".concat((r/1e3).toFixed(2),"s"),e}function VA(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8;const i=Math.max(e-r.length,0);return"".concat(" ".repeat(i)).concat(r)}function qm(r,e,i){let l=arguments.length>3&&arguments[3]!==void 0?arguments[3]:600;const u=r.src.replace(/\(/g,"%28").replace(/\)/g,"%29");r.width>l&&(i=Math.min(i,l/r.width));const m=r.width*i,y=r.height*i,T=["font-size:1px;","padding:".concat(Math.floor(y/2),"px ").concat(Math.floor(m/2),"px;"),"line-height:".concat(y,"px;"),"background:url(".concat(u,");"),"background-size:".concat(m,"px ").concat(y,"px;"),"color:transparent;"].join("");return["".concat(e," %c+"),T]}let Zd;(function(r){r[r.BLACK=30]="BLACK",r[r.RED=31]="RED",r[r.GREEN=32]="GREEN",r[r.YELLOW=33]="YELLOW",r[r.BLUE=34]="BLUE",r[r.MAGENTA=35]="MAGENTA",r[r.CYAN=36]="CYAN",r[r.WHITE=37]="WHITE",r[r.BRIGHT_BLACK=90]="BRIGHT_BLACK",r[r.BRIGHT_RED=91]="BRIGHT_RED",r[r.BRIGHT_GREEN=92]="BRIGHT_GREEN",r[r.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",r[r.BRIGHT_BLUE=94]="BRIGHT_BLUE",r[r.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",r[r.BRIGHT_CYAN=96]="BRIGHT_CYAN",r[r.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(Zd||(Zd={}));function P0(r){return typeof r=="string"?Zd[r.toUpperCase()]||Zd.WHITE:r}function GA(r,e,i){return!Eo&&typeof r=="string"&&(e&&(e=P0(e),r="\x1B[".concat(e,"m").concat(r,"\x1B[39m")),i&&(e=P0(i),r="\x1B[".concat(i+10,"m").concat(r,"\x1B[49m"))),r}function ZA(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["constructor"];const i=Object.getPrototypeOf(r),l=Object.getOwnPropertyNames(i);for(const u of l)typeof r[u]=="function"&&(e.find(m=>u===m)||(r[u]=r[u].bind(r)))}function $d(r,e){if(!r)throw new Error(e||"Assertion failed")}function hc(){let r;if(Eo&&"performance"in yd){var e,i;r=yd==null||(e=yd.performance)===null||e===void 0||(i=e.now)===null||i===void 0?void 0:i.call(e)}else if("hrtime"in uh){var l;const u=uh==null||(l=uh.hrtime)===null||l===void 0?void 0:l.call(uh);r=u[0]*1e3+u[1]/1e6}else r=Date.now();return r}const fc={debug:Eo&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},$A={enabled:!0,level:0};function jn(){}const I0={},C0={once:!0};class Dh{constructor(){let{id:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{id:""};j(this,"id",void 0),j(this,"VERSION",o1),j(this,"_startTs",hc()),j(this,"_deltaTs",hc()),j(this,"_storage",void 0),j(this,"userData",{}),j(this,"LOG_THROTTLE_TIMEOUT",0),this.id=e,this._storage=new UA("__probe-".concat(this.id,"__"),$A),this.userData={},this.timeStamp("".concat(this.id," started")),ZA(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((hc()-this._startTs).toPrecision(10))}getDelta(){return Number((hc()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._storage.updateConfiguration({enabled:e}),this}setLevel(e){return this._storage.updateConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,i){this._storage.updateConfiguration({[e]:i})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,i){$d(e,i)}warn(e){return this._getLogFunction(0,e,fc.warn,arguments,C0)}error(e){return this._getLogFunction(0,e,fc.error,arguments)}deprecated(e,i){return this.warn("`".concat(e,"` is deprecated and will be removed in a later version. Use `").concat(i,"` instead"))}removed(e,i){return this.error("`".concat(e,"` has been removed. Use `").concat(i,"` instead"))}probe(e,i){return this._getLogFunction(e,i,fc.log,arguments,{time:!0,once:!0})}log(e,i){return this._getLogFunction(e,i,fc.debug,arguments)}info(e,i){return this._getLogFunction(e,i,console.info,arguments)}once(e,i){for(var l=arguments.length,u=new Array(l>2?l-2:0),m=2;m<l;m++)u[m-2]=arguments[m];return this._getLogFunction(e,i,fc.debug||fc.info,arguments,C0)}table(e,i,l){return i?this._getLogFunction(e,i,console.table||jn,l&&[l],{tag:HA(i)}):jn}image(e){let{logLevel:i,priority:l,image:u,message:m="",scale:y=1}=e;return this._shouldLog(i||l)?Eo?XA({image:u,message:m,scale:y}):qA({image:u,message:m,scale:y}):jn}time(e,i){return this._getLogFunction(e,i,console.time?console.time:console.info)}timeEnd(e,i){return this._getLogFunction(e,i,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,i){return this._getLogFunction(e,i,console.timeStamp||jn)}group(e,i){let l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{collapsed:!1};const u=L0({logLevel:e,message:i,opts:l}),{collapsed:m}=l;return u.method=(m?console.groupCollapsed:console.group)||console.info,this._getLogFunction(u)}groupCollapsed(e,i){let l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.group(e,i,Object.assign({},l,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||jn)}withGroup(e,i,l){this.group(e,i)();try{l()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=l1(e)}_getLogFunction(e,i,l,u,m){if(this._shouldLog(e)){m=L0({logLevel:e,message:i,args:u,opts:m}),l=l||m.method,$d(l),m.total=this.getTotal(),m.delta=this.getDelta(),this._deltaTs=hc();const y=m.tag||m.message;if(m.once)if(!I0[y])I0[y]=hc();else return jn;return i=WA(this.id,m.message,m),l.bind(console,i,...m.args)}return jn}}j(Dh,"VERSION",o1);function l1(r){if(!r)return 0;let e;switch(typeof r){case"number":e=r;break;case"object":e=r.logLevel||r.priority||0;break;default:return 0}return $d(Number.isFinite(e)&&e>=0),e}function L0(r){const{logLevel:e,message:i}=r;r.logLevel=l1(e);const l=r.args?Array.from(r.args):[];for(;l.length&&l.shift()!==i;);switch(typeof e){case"string":case"function":i!==void 0&&l.unshift(i),r.message=e;break;case"object":Object.assign(r,e);break}typeof r.message=="function"&&(r.message=r.message());const u=typeof r.message;return $d(u==="string"||u==="object"),Object.assign(r,{args:l},r.opts)}function WA(r,e,i){if(typeof e=="string"){const l=i.time?VA(jA(i.total)):"";e=i.time?"".concat(r,": ").concat(l,"  ").concat(e):"".concat(r,": ").concat(e),e=GA(e,i.color,i.background)}return e}function qA(r){let{image:e,message:i="",scale:l=1}=r;return(void 0)({image:e,message:i,scale:l}),jn}function XA(r){let{image:e,message:i="",scale:l=1}=r;if(typeof e=="string"){const m=new Image;return m.onload=()=>{const y=qm(m,i,l);console.log(...y)},m.src=e,jn}const u=e.nodeName||"";if(u.toLowerCase()==="img")return console.log(...qm(e,i,l)),jn;if(u.toLowerCase()==="canvas"){const m=new Image;return m.onload=()=>console.log(...qm(m,i,l)),m.src=e.toDataURL(),jn}return jn}function HA(r){for(const e in r)for(const i in r[e])return i||"untitled";return"empty"}const k0=new Dh({id:"loaders.gl"});class YA{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class KA{constructor(){j(this,"console",void 0),this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}}const c1={fetch:null,mimeType:void 0,nothrow:!1,log:new KA,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:Jb,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},JA={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function u1(){globalThis.loaders=globalThis.loaders||{};const{loaders:r}=globalThis;return r._state=r._state||{},r._state}const h1=()=>{const r=u1();return r.globalOptions=r.globalOptions||{...c1},r.globalOptions};function QA(r,e,i,l){return i=i||[],i=Array.isArray(i)?i:[i],eM(r,i),iM(e,r,l)}function f1(r,e){const i=h1(),l=r||i;return typeof l.fetch=="function"?l.fetch:Oh(l.fetch)?u=>M0(u,l):e!=null&&e.fetch?e?.fetch:M0}function eM(r,e){R0(r,null,c1,JA,e);for(const i of e){const l=r&&r[i.id]||{},u=i.options&&i.options[i.id]||{},m=i.deprecatedOptions&&i.deprecatedOptions[i.id]||{};R0(l,i.id,u,m,e)}}function R0(r,e,i,l,u){const m=e||"Top level",y=e?"".concat(e,"."):"";for(const T in r){const a=!e&&Oh(r[T]),P=T==="baseUri"&&!e,D=T==="workerUrl"&&e;if(!(T in i)&&!P&&!D){if(T in l)k0.warn("".concat(m," loader option '").concat(y).concat(T,"' no longer supported, use '").concat(l[T],"'"))();else if(!a){const N=tM(T,u);k0.warn("".concat(m," loader option '").concat(y).concat(T,"' not recognized. ").concat(N))()}}}}function tM(r,e){const i=r.toLowerCase();let l="";for(const u of e)for(const m in u.options){if(r===m)return"Did you mean '".concat(u.id,".").concat(m,"'?");const y=m.toLowerCase();(i.startsWith(y)||y.startsWith(i))&&(l=l||"Did you mean '".concat(u.id,".").concat(m,"'?"))}return l}function iM(r,e,i){const u={...r.options||{}};return rM(u,i),u.log===null&&(u.log=new YA),O0(u,h1()),O0(u,e),u}function O0(r,e){for(const i in e)if(i in e){const l=e[i];S0(l)&&S0(r[i])?r[i]={...r[i],...e[i]}:r[i]=e[i]}}function rM(r,e){e&&!("baseUri"in r)&&(r.baseUri=e)}function n_(r){var e;return r?(Array.isArray(r)&&(r=r[0]),Array.isArray((e=r)===null||e===void 0?void 0:e.extensions)):!1}function s_(r){var e,i;y0(r,"null loader"),y0(n_(r),"invalid loader");let l;return Array.isArray(r)&&(l=r[1],r=r[0],r={...r,options:{...r.options,...l}}),((e=r)!==null&&e!==void 0&&e.parseTextSync||(i=r)!==null&&i!==void 0&&i.parseText)&&(r.text=!0),r.text||(r.binary=!0),r}const d1=()=>{const r=u1();return r.loaderRegistry=r.loaderRegistry||[],r.loaderRegistry};function nM(r){const e=d1();r=Array.isArray(r)?r:[r];for(const i of r){const l=s_(i);e.find(u=>l===u)||e.unshift(l)}}function sM(){return d1()}const oM=new Dh({id:"loaders.gl"}),aM=/\.([^.]+)$/;async function lM(r,e=[],i,l){if(!p1(r))return null;let u=D0(r,e,{...i,nothrow:!0});if(u)return u;if(zc(r)&&(r=await r.slice(0,10).arrayBuffer(),u=D0(r,e,i)),!u&&!(i!=null&&i.nothrow))throw new Error(m1(r));return u}function D0(r,e=[],i,l){if(!p1(r))return null;if(e&&!Array.isArray(e))return s_(e);let u=[];e&&(u=u.concat(e)),i!=null&&i.ignoreRegisteredLoaders||u.push(...sM()),uM(u);const m=cM(r,u,i);if(!m&&!(i!=null&&i.nothrow))throw new Error(m1(r));return m}function cM(r,e,i,l){const{url:u,type:m}=op(r),y=u||void 0;let T=null,a="";if(i!=null&&i.mimeType&&(T=Xm(e,i?.mimeType),a="match forced by supplied MIME type ".concat(i?.mimeType)),T=T||hM(e,y),a=a||(T?"matched url ".concat(y):""),T=T||Xm(e,m),a=a||(T?"matched MIME type ".concat(m):""),T=T||dM(e,r),a=a||(T?"matched initial data ".concat(g1(r)):""),T=T||Xm(e,i?.fallbackMimeType),a=a||(T?"matched fallback MIME type ".concat(m):""),a){var P;oM.log(1,"selectLoader selected ".concat((P=T)===null||P===void 0?void 0:P.name,": ").concat(a,"."))}return T}function p1(r){return!(r instanceof Response&&r.status===204)}function m1(r){const{url:e,type:i}=op(r);let l="No valid loader found (";l+=e?"".concat(TA(e),", "):"no url provided, ",l+="MIME type: ".concat(i?'"'.concat(i,'"'):"not provided",", ");const u=r?g1(r):"";return l+=u?' first bytes: "'.concat(u,'"'):"first bytes: not available",l+=")",l}function uM(r){for(const e of r)s_(e)}function hM(r,e){const i=e&&aM.exec(e),l=i&&i[1];return l?fM(r,l):null}function fM(r,e){e=e.toLowerCase();for(const i of r)for(const l of i.extensions)if(l.toLowerCase()===e)return i;return null}function Xm(r,e){for(const i of r)if(i.mimeTypes&&i.mimeTypes.includes(e)||e==="application/x.".concat(i.id))return i;return null}function dM(r,e){if(!e)return null;for(const i of r)if(typeof e=="string"){if(pM(e,i))return i}else if(ArrayBuffer.isView(e)){if(z0(e.buffer,e.byteOffset,i))return i}else if(e instanceof ArrayBuffer&&z0(e,0,i))return i;return null}function pM(r,e){return e.testText?e.testText(r):(Array.isArray(e.tests)?e.tests:[e.tests]).some(l=>r.startsWith(l))}function z0(r,e,i){return(Array.isArray(i.tests)?i.tests:[i.tests]).some(u=>mM(r,e,i,u))}function mM(r,e,i,l){if(l instanceof ArrayBuffer)return yA(l,r,l.byteLength);switch(typeof l){case"function":return l(r,i);case"string":const u=Eg(r,e,l.length);return l===u;default:return!1}}function g1(r,e=5){return typeof r=="string"?r.slice(0,e):ArrayBuffer.isView(r)?Eg(r.buffer,r.byteOffset,e):r instanceof ArrayBuffer?Eg(r,0,e):""}function Eg(r,e,i){if(r.byteLength<e+i)return"";const l=new DataView(r);let u="";for(let m=0;m<i;m++)u+=String.fromCharCode(l.getUint8(e+m));return u}const gM=256*1024;function*_M(r,e){const i=e?.chunkSize||gM;let l=0;const u=new TextEncoder;for(;l<r.length;){const m=Math.min(r.length-l,i),y=r.slice(l,l+m);l+=m,yield u.encode(y)}}const yM=256*1024;function*vM(r,e={}){const{chunkSize:i=yM}=e;let l=0;for(;l<r.byteLength;){const u=Math.min(r.byteLength-l,i),m=new ArrayBuffer(u),y=new Uint8Array(r,l,u);new Uint8Array(m).set(y),l+=u,yield m}}const xM=1024*1024;async function*bM(r,e){const i=e?.chunkSize||xM;let l=0;for(;l<r.size;){const u=l+i,m=await r.slice(l,u).arrayBuffer();l=u,yield m}}function B0(r,e){return Jb?wM(r,e):TM(r)}async function*wM(r,e){const i=r.getReader();let l;try{for(;;){const u=l||i.read();e!=null&&e._streamReadAhead&&(l=i.read());const{done:m,value:y}=await u;if(m)return;yield i1(y)}}catch{i.releaseLock()}}async function*TM(r,e){for await(const i of r)yield i1(i)}function EM(r,e){if(typeof r=="string")return _M(r,e);if(r instanceof ArrayBuffer)return vM(r,e);if(zc(r))return bM(r,e);if(r1(r))return B0(r,e);if(Dc(r))return B0(r.body,e);throw new Error("makeIterator")}const _1="Cannot convert supplied data type";function SM(r,e,i){if(e.text&&typeof r=="string")return r;if(MA(r)&&(r=r.buffer),r instanceof ArrayBuffer){const l=r;return e.text&&!e.binary?new TextDecoder("utf8").decode(l):l}if(ArrayBuffer.isView(r)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(r);let l=r.buffer;const u=r.byteLength||r.length;return(r.byteOffset!==0||u!==l.byteLength)&&(l=l.slice(r.byteOffset,r.byteOffset+u)),l}throw new Error(_1)}async function AM(r,e,i){const l=r instanceof ArrayBuffer||ArrayBuffer.isView(r);if(typeof r=="string"||l)return SM(r,e);if(zc(r)&&(r=await n1(r)),Dc(r)){const u=r;return await DA(u),e.binary?await u.arrayBuffer():await u.text()}if(r1(r)&&(r=EM(r,i)),SA(r)||AA(r))return xA(r);throw new Error(_1)}function MM(r,e,i=null){if(i)return i;const l={fetch:f1(e,r),...r};return Array.isArray(l.loaders)||(l.loaders=null),l}function PM(r,e){if(!e&&r&&!Array.isArray(r))return r;let i;if(r&&(i=Array.isArray(r)?r:[r]),e&&e.loaders){const l=Array.isArray(e.loaders)?e.loaders:[e.loaders];i=i?[...i,...l]:l}return i&&i.length?i:null}async function o_(r,e,i,l){bo(!l||typeof l=="object"),e&&!Array.isArray(e)&&!n_(e)&&(l=void 0,i=e,e=void 0),r=await r,i=i||{};const{url:u}=op(r),y=PM(e,l),T=await lM(r,y,i);return T?(i=QA(i,T,y,u),l=MM({url:u,parse:o_,loaders:y},i,l),await IM(T,r,i,l)):null}async function IM(r,e,i,l){if(dA(r),Dc(e)){const u=e,{ok:m,redirected:y,status:T,statusText:a,type:P,url:D}=u,N=Object.fromEntries(u.headers.entries());l.response={headers:N,ok:m,redirected:y,status:T,statusText:a,type:P,url:D}}if(e=await AM(e,r,i),r.parseTextSync&&typeof e=="string")return i.dataType="text",r.parseTextSync(e,i,l,r);if(pA(r,i))return await mA(r,e,i,l,o_);if(r.parseText&&typeof e=="string")return await r.parseText(e,i,l,r);if(r.parse)return await r.parse(e,i,l,r);throw bo(!r.parseSync),new Error("".concat(r.id," loader - no parser found and worker is disabled"))}async function Sg(r,e,i,l){!Array.isArray(e)&&!n_(e)&&(i=e,e=void 0);const u=f1(i);let m=r;return typeof r=="string"&&(m=await u(r)),zc(r)&&(m=await u(r)),await o_(m,e,i)}const CM="3.2.12";function y1(r,e){if(!r)throw new Error("loader assertion failed.")}const LM=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),F0=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);F0&&parseFloat(F0[1]);const{_parseImageNode:kM}=globalThis,Ag=typeof Image<"u",Mg=typeof ImageBitmap<"u",RM=!!kM,Pg=LM?!0:RM;function OM(r){switch(r){case"auto":return Mg||Ag||Pg;case"imagebitmap":return Mg;case"image":return Ag;case"data":return Pg;default:throw new Error("@loaders.gl/images: image ".concat(r," not supported in this environment"))}}function DM(){if(Mg)return"imagebitmap";if(Ag)return"image";if(Pg)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function zM(r){const e=FM(r);if(!e)throw new Error("Not an image");return e}function BM(r){switch(zM(r)){case"data":return r;case"image":case"imagebitmap":const e=document.createElement("canvas"),i=e.getContext("2d");if(!i)throw new Error("getImageData");return e.width=r.width,e.height=r.height,i.drawImage(r,0,0),i.getImageData(0,0,r.width,r.height);default:throw new Error("getImageData")}}function FM(r){return typeof ImageBitmap<"u"&&r instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&r instanceof Image?"image":r&&typeof r=="object"&&r.data&&r.width&&r.height?"data":null}const NM=/^data:image\/svg\+xml/,UM=/\.svg((\?|#).*)?$/;function a_(r){return r&&(NM.test(r)||UM.test(r))}function jM(r,e){if(a_(e)){let l=new TextDecoder().decode(r);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(l=unescape(encodeURIComponent(l)))}catch(m){throw new Error(m.message)}return"data:image/svg+xml;base64,".concat(btoa(l))}return v1(r,e)}function v1(r,e){if(a_(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(r)])}async function x1(r,e,i){const l=jM(r,i),u=self.URL||self.webkitURL,m=typeof l!="string"&&u.createObjectURL(l);try{return await VM(m||l,e)}finally{m&&u.revokeObjectURL(m)}}async function VM(r,e){const i=new Image;return i.src=r,e.image&&e.image.decode&&i.decode?(await i.decode(),i):await new Promise((l,u)=>{try{i.onload=()=>l(i),i.onerror=m=>u(new Error("Could not load image ".concat(r,": ").concat(m)))}catch(m){u(m)}})}const GM={};let N0=!0;async function ZM(r,e,i){let l;a_(i)?l=await x1(r,e,i):l=v1(r,i);const u=e&&e.imagebitmap;return await $M(l,u)}async function $M(r,e=null){if((WM(e)||!N0)&&(e=null),e)try{return await createImageBitmap(r,e)}catch(i){console.warn(i),N0=!1}return await createImageBitmap(r)}function WM(r){for(const e in r||GM)return!1;return!0}const zs=!1,vh=!0;function b1(r){const e=zh(r);return qM(e)||YM(e)||XM(e)||HM(e)}function qM(r){const e=zh(r);return e.byteLength>=24&&e.getUint32(0,zs)===2303741511?{mimeType:"image/png",width:e.getUint32(16,zs),height:e.getUint32(20,zs)}:null}function XM(r){const e=zh(r);return e.byteLength>=10&&e.getUint32(0,zs)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,vh),height:e.getUint16(8,vh)}:null}function HM(r){const e=zh(r);return e.byteLength>=14&&e.getUint16(0,zs)===16973&&e.getUint32(2,vh)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,vh),height:e.getUint32(22,vh)}:null}function YM(r){const e=zh(r);if(!(e.byteLength>=3&&e.getUint16(0,zs)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:l,sofMarkers:u}=KM();let m=2;for(;m+9<e.byteLength;){const y=e.getUint16(m,zs);if(u.has(y))return{mimeType:"image/jpeg",height:e.getUint16(m+5,zs),width:e.getUint16(m+7,zs)};if(!l.has(y))return null;m+=2,m+=e.getUint16(m,zs)}return null}function KM(){const r=new Set([65499,65476,65484,65501,65534]);for(let i=65504;i<65520;++i)r.add(i);return{tableMarkers:r,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function zh(r){if(r instanceof DataView)return r;if(ArrayBuffer.isView(r))return new DataView(r.buffer);if(r instanceof ArrayBuffer)return new DataView(r);throw new Error("toDataView")}async function JM(r,e){const{mimeType:i}=b1(r)||{},l=globalThis._parseImageNode;return y1(l),await l(r,i)}async function QM(r,e,i){e=e||{};const u=(e.image||{}).type||"auto",{url:m}=i||{},y=eP(u);let T;switch(y){case"imagebitmap":T=await ZM(r,e,m);break;case"image":T=await x1(r,e,m);break;case"data":T=await JM(r);break;default:y1(!1)}return u==="data"&&(T=BM(T)),T}function eP(r){switch(r){case"auto":case"data":return DM();default:return OM(r),r}}const tP=["png","jpg","jpeg","gif","webp","bmp","ico","svg"],iP=["image/png","image/jpeg","image/gif","image/webp","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],rP={image:{type:"auto",decode:!0}},nP={id:"image",module:"images",name:"Images",version:CM,mimeTypes:iP,extensions:tP,parse:QM,tests:[r=>!!b1(new DataView(r))],options:rP},Ii=new Dh({id:"deck"});let Ig={};function sP(r){Ig=r}function Qr(r,e,i,l){Ii.level>0&&Ig[r]&&Ig[r].call(null,e,i,l)}function oP(r){const e=r[0],i=r[r.length-1];return e==="{"&&i==="}"||e==="["&&i==="]"}const aP={id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:oP,parseTextSync:JSON.parse},xh="8.8.21",Dd=globalThis.deck&&globalThis.deck.VERSION;if(Dd&&Dd!==xh)throw new Error("deck.gl - multiple versions detected: ".concat(Dd," vs ").concat(xh));Dd||(Ii.log(1,"deck.gl ".concat(xh))(),globalThis.deck={...globalThis.deck,VERSION:xh,version:xh,log:Ii,_registerLoggers:sP},nM([aP,[nP,{imagebitmap:{premultiplyAlpha:"none"}}]]));const lP=globalThis.deck,Ct=new Dh({id:"luma.gl"});function en(r,e){if(!r)throw new Error(e||"luma.gl: assertion failed.")}const cP="Invalid WebGLRenderingContext",uP="Requires WebGL2";function ap(r){return typeof WebGLRenderingContext<"u"&&r instanceof WebGLRenderingContext||typeof WebGL2RenderingContext<"u"&&r instanceof WebGL2RenderingContext?!0:!!(r&&Number.isFinite(r._version))}function ai(r){return typeof WebGL2RenderingContext<"u"&&r instanceof WebGL2RenderingContext?!0:!!(r&&r._version===2)}function hP(r){return ai(r)?r:null}function lp(r){return en(ap(r),cP),r}function Gr(r){return en(ai(r),uP),r}const gh={};function fP(r){globalThis.console&&globalThis.console.error&&globalThis.console.error(r)}function dP(r){globalThis.console&&globalThis.console.log&&globalThis.console.log(r)}function pP(r,e){gh[r]=!0,fP(e)}function mP(r){const e=r.getError;r.getError=function(){let l;do l=e.apply(r),l!==0&&(gh[l]=!0);while(l!==0);for(l in gh)if(gh[l])return delete gh[l],parseInt(l,10);return 0}}const Bh=function r(e){const i=e.gl;this.ext=e,this.isAlive=!0,this.hasBeenBound=!1,this.elementArrayBuffer=null,this.attribs=new Array(e.maxVertexAttribs);for(let l=0;l<this.attribs.length;l++){const u=new r.VertexAttrib(i);this.attribs[l]=u}this.maxAttrib=0};Bh.VertexAttrib=function(e){this.enabled=!1,this.buffer=null,this.size=4,this.type=5126,this.normalized=!1,this.stride=16,this.offset=0,this.cached="",this.recache()};Bh.VertexAttrib.prototype.recache=function(){this.cached=[this.size,this.type,this.normalized,this.stride,this.offset].join(":")};const dl=function(e){const i=this;this.gl=e,mP(e);const l=this.original={getParameter:e.getParameter,enableVertexAttribArray:e.enableVertexAttribArray,disableVertexAttribArray:e.disableVertexAttribArray,bindBuffer:e.bindBuffer,getVertexAttrib:e.getVertexAttrib,vertexAttribPointer:e.vertexAttribPointer};e.getParameter=function(m){return m===i.VERTEX_ARRAY_BINDING_OES?i.currentVertexArrayObject===i.defaultVertexArrayObject?null:i.currentVertexArrayObject:l.getParameter.apply(this,arguments)},e.enableVertexAttribArray=function(m){const y=i.currentVertexArrayObject;y.maxAttrib=Math.max(y.maxAttrib,m);const T=y.attribs[m];return T.enabled=!0,l.enableVertexAttribArray.apply(this,arguments)},e.disableVertexAttribArray=function(m){const y=i.currentVertexArrayObject;y.maxAttrib=Math.max(y.maxAttrib,m);const T=y.attribs[m];return T.enabled=!1,l.disableVertexAttribArray.apply(this,arguments)},e.bindBuffer=function(m,y){switch(m){case 34962:i.currentArrayBuffer=y;break;case 34963:i.currentVertexArrayObject.elementArrayBuffer=y;break}return l.bindBuffer.apply(this,arguments)},e.getVertexAttrib=function(m,y){const a=i.currentVertexArrayObject.attribs[m];switch(y){case 34975:return a.buffer;case 34338:return a.enabled;case 34339:return a.size;case 34340:return a.stride;case 34341:return a.type;case 34922:return a.normalized;default:return l.getVertexAttrib.apply(this,arguments)}},e.vertexAttribPointer=function(m,y,T,a,P,D){const N=i.currentVertexArrayObject;N.maxAttrib=Math.max(N.maxAttrib,m);const F=N.attribs[m];return F.buffer=i.currentArrayBuffer,F.size=y,F.type=T,F.normalized=a,F.stride=P,F.offset=D,F.recache(),l.vertexAttribPointer.apply(this,arguments)},e.instrumentExtension&&e.instrumentExtension(this,"OES_vertex_array_object"),e.canvas&&e.canvas.addEventListener("webglcontextrestored",()=>{dP("OESVertexArrayObject emulation library context restored"),i.reset_()},!0),this.reset_()};dl.prototype.VERTEX_ARRAY_BINDING_OES=34229;dl.prototype.reset_=function(){if(this.vertexArrayObjects!==void 0)for(let l=0;l<this.vertexArrayObjects.length;++l)this.vertexArrayObjects.isAlive=!1;const i=this.gl;this.maxVertexAttribs=i.getParameter(34921),this.defaultVertexArrayObject=new Bh(this),this.currentVertexArrayObject=null,this.currentArrayBuffer=null,this.vertexArrayObjects=[this.defaultVertexArrayObject],this.bindVertexArrayOES(null)};dl.prototype.createVertexArrayOES=function(){const e=new Bh(this);return this.vertexArrayObjects.push(e),e};dl.prototype.deleteVertexArrayOES=function(e){e.isAlive=!1,this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(e),1),this.currentVertexArrayObject===e&&this.bindVertexArrayOES(null)};dl.prototype.isVertexArrayOES=function(e){return!!(e&&e instanceof Bh&&e.hasBeenBound&&e.ext===this)};dl.prototype.bindVertexArrayOES=function(e){const i=this.gl;if(e&&!e.isAlive){pP(1282,"bindVertexArrayOES: attempt to bind deleted arrayObject");return}const l=this.original,u=this.currentVertexArrayObject;this.currentVertexArrayObject=e||this.defaultVertexArrayObject,this.currentVertexArrayObject.hasBeenBound=!0;const m=this.currentVertexArrayObject;if(u===m)return;(!u||m.elementArrayBuffer!==u.elementArrayBuffer)&&l.bindBuffer.call(i,34963,m.elementArrayBuffer);let y=this.currentArrayBuffer;const T=Math.max(u?u.maxAttrib:0,m.maxAttrib);for(let a=0;a<=T;a++){const P=m.attribs[a],D=u?u.attribs[a]:null;if((!u||P.enabled!==D.enabled)&&(P.enabled?l.enableVertexAttribArray.call(i,a):l.disableVertexAttribArray.call(i,a)),P.enabled){let N=!1;(!u||P.buffer!==D.buffer)&&(y!==P.buffer&&(l.bindBuffer.call(i,34962,P.buffer),y=P.buffer),N=!0),(N||P.cached!==D.cached)&&l.vertexAttribPointer.call(i,a,P.size,P.type,P.normalized,P.stride,P.offset)}}this.currentArrayBuffer!==y&&l.bindBuffer.call(i,34962,this.currentArrayBuffer)};function gP(r){if(typeof r.createVertexArray=="function")return;const e=r.getSupportedExtensions;r.getSupportedExtensions=function(){const u=e.call(this)||[];return u.indexOf("OES_vertex_array_object")<0&&u.push("OES_vertex_array_object"),u};const i=r.getExtension;r.getExtension=function(u){const m=i.call(this,u);return m||(u!=="OES_vertex_array_object"?null:(r.__OESVertexArrayObject||(this.__OESVertexArrayObject=new dl(this)),this.__OESVertexArrayObject))}}const U0="OES_element_index",j0="WEBGL_draw_buffers",_P="EXT_disjoint_timer_query",yP="EXT_disjoint_timer_query_webgl2",vP="EXT_texture_filter_anisotropic",V0="WEBGL_debug_renderer_info",xP=35723,bP=4352,wP=36795,TP=34047,EP=37445,SP=37446,zi=r=>ai(r)?void 0:0,AP={3074:r=>ai(r)?void 0:36064,[xP]:r=>ai(r)?void 0:bP,35977:zi,32937:zi,[wP]:(r,e)=>{const i=ai(r)?r.getExtension(yP):r.getExtension(_P);return i&&i.GPU_DISJOINT_EXT?e(i.GPU_DISJOINT_EXT):0},[EP]:(r,e)=>{const i=r.getExtension(V0);return e(i&&i.UNMASKED_VENDOR_WEBGL||7936)},[SP]:(r,e)=>{const i=r.getExtension(V0);return e(i&&i.UNMASKED_RENDERER_WEBGL||7937)},[TP]:(r,e)=>{const i=r.luma.extensions[vP];return i?e(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1},32883:zi,35071:zi,37447:zi,36063:(r,e)=>{if(!ai(r)){const i=r.getExtension(j0);return i?e(i.MAX_COLOR_ATTACHMENTS_WEBGL):0}},35379:zi,35374:zi,35377:zi,34852:r=>{if(!ai(r)){const e=r.getExtension(j0);return e?e.MAX_DRAW_BUFFERS_WEBGL:0}},36203:r=>r.getExtension(U0)?2147483647:65535,33001:r=>r.getExtension(U0)?16777216:65535,33e3:r=>16777216,37157:zi,35373:zi,35657:zi,36183:zi,37137:zi,34045:zi,35978:zi,35979:zi,35968:zi,35376:zi,35375:zi,35659:zi,37154:zi,35371:zi,35658:zi,35076:zi,35077:zi,35380:zi};function MP(r,e,i){const l=AP[i],u=typeof l=="function"?l(r,e,i):l;return u!==void 0?u:e(i)}const PP="OES_vertex_array_object",w1="ANGLE_instanced_arrays",IP="WEBGL_draw_buffers",CP="EXT_disjoint_timer_query",LP="EXT_texture_filter_anisotropic",kP="VertexArray requires WebGL2 or OES_vertex_array_object extension";function RP(r,e){return{webgl2:ai(r),ext:r.getExtension(e)}}const T1={[PP]:{meta:{suffix:"OES"},createVertexArray:()=>{en(!1,kP)},deleteVertexArray:()=>{},bindVertexArray:()=>{},isVertexArray:()=>!1},[w1]:{meta:{suffix:"ANGLE"},vertexAttribDivisor(r,e){en(e===0,"WebGL instanced rendering not supported")},drawElementsInstanced:()=>{},drawArraysInstanced:()=>{}},[IP]:{meta:{suffix:"WEBGL"},drawBuffers:()=>{en(!1)}},[CP]:{meta:{suffix:"EXT"},createQuery:()=>{en(!1)},deleteQuery:()=>{en(!1)},beginQuery:()=>{en(!1)},endQuery:()=>{},getQuery(r,e){return this.getQueryObject(r,e)},getQueryParameter(r,e){return this.getQueryObject(r,e)},getQueryObject:()=>{}}},Hm={readBuffer:(r,e,i)=>{ai(r)&&e(i)},getVertexAttrib:(r,e,i,l)=>{const{webgl2:u,ext:m}=RP(r,w1);let y;switch(l){case 35069:y=u?void 0:!1;break;case 35070:y=!u&&!m?0:void 0;break}return y!==void 0?y:e(i,l)},getProgramParameter:(r,e,i,l)=>{if(!ai(r))switch(l){case 35967:return 35981;case 35971:return 0;case 35382:return 0}return e(i,l)},getInternalformatParameter:(r,e,i,l,u)=>{if(!ai(r))switch(u){case 32937:return new Int32Array([0])}return r.getInternalformatParameter(i,l,u)},getTexParameter(r,e,i,l){switch(l){case 34046:const{extensions:u}=r.luma,m=u[LP];l=m&&m.TEXTURE_MAX_ANISOTROPY_EXT||34046;break}return e(i,l)},getParameter:MP,hint(r,e,i,l){return e(i,l)}};function OP(r){r.luma=r.luma||{};const{luma:e}=r;return e.polyfilled||(gP(r),DP(r),BP(r,T1),zP(r,{target:e,target2:r}),e.polyfilled=!0),r}globalThis.polyfillContext=OP;function DP(r){r.luma.extensions={};const e=r.getSupportedExtensions()||[];for(const i of e)r.luma[i]=r.getExtension(i)}function zP(r,e){let{target:i,target2:l}=e;Object.keys(Hm).forEach(u=>{if(typeof Hm[u]=="function"){const m=r[u]?r[u].bind(r):()=>{},y=Hm[u].bind(null,r,m);i[u]=y,l[u]=y}})}function BP(r,e){for(const i of Object.getOwnPropertyNames(e))i!=="overrides"&&FP(r,{extension:i,target:r.luma,target2:r})}function FP(r,e){let{extension:i,target:l,target2:u}=e;const m=T1[i];en(m);const{meta:y={}}=m,{suffix:T=""}=y,a=r.getExtension(i);for(const P of Object.keys(m)){const D="".concat(P).concat(T);let N=null;P==="meta"||typeof r[P]=="function"||(a&&typeof a[D]=="function"?N=function(){return a[D](...arguments)}:typeof m[P]=="function"&&(N=m[P].bind(l))),N&&(l[P]=N,u[P]=N)}}const l_={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,36006:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],3333:4,3317:4,37440:!1,37441:!1,37443:37444,35723:4352,36010:null,35977:!1,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},ia=(r,e,i)=>e?r.enable(i):r.disable(i),G0=(r,e,i)=>r.hint(i,e),Tn=(r,e,i)=>r.pixelStorei(i,e),NP=(r,e)=>{const i=ai(r)?36009:36160;return r.bindFramebuffer(i,e)},UP=(r,e)=>r.bindFramebuffer(36008,e);function hh(r){return Array.isArray(r)||ArrayBuffer.isView(r)}const jP={3042:ia,32773:(r,e)=>r.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(r,e)=>r.clearColor(...e),3107:(r,e)=>r.colorMask(...e),2884:ia,2885:(r,e)=>r.cullFace(e),2929:ia,2931:(r,e)=>r.clearDepth(e),2932:(r,e)=>r.depthFunc(e),2928:(r,e)=>r.depthRange(...e),2930:(r,e)=>r.depthMask(e),3024:ia,35723:G0,36006:NP,2886:(r,e)=>r.frontFace(e),33170:G0,2849:(r,e)=>r.lineWidth(e),32823:ia,32824:"polygonOffset",10752:"polygonOffset",35977:ia,32938:"sampleCoverage",32939:"sampleCoverage",3089:ia,3088:(r,e)=>r.scissor(...e),2960:ia,2961:(r,e)=>r.clearStencil(e),2968:(r,e)=>r.stencilMaskSeparate(1028,e),36005:(r,e)=>r.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(r,e)=>r.viewport(...e),3333:Tn,3317:Tn,37440:Tn,37441:Tn,37443:Tn,3330:Tn,3332:Tn,3331:Tn,36010:UP,3314:Tn,32878:Tn,3316:Tn,3315:Tn,32877:Tn,framebuffer:(r,e)=>{const i=e&&"handle"in e?e.handle:e;return r.bindFramebuffer(36160,i)},blend:(r,e)=>e?r.enable(3042):r.disable(3042),blendColor:(r,e)=>r.blendColor(...e),blendEquation:(r,e)=>{e=hh(e)?e:[e,e],r.blendEquationSeparate(...e)},blendFunc:(r,e)=>{e=hh(e)&&e.length===2?[...e,...e]:e,r.blendFuncSeparate(...e)},clearColor:(r,e)=>r.clearColor(...e),clearDepth:(r,e)=>r.clearDepth(e),clearStencil:(r,e)=>r.clearStencil(e),colorMask:(r,e)=>r.colorMask(...e),cull:(r,e)=>e?r.enable(2884):r.disable(2884),cullFace:(r,e)=>r.cullFace(e),depthTest:(r,e)=>e?r.enable(2929):r.disable(2929),depthFunc:(r,e)=>r.depthFunc(e),depthMask:(r,e)=>r.depthMask(e),depthRange:(r,e)=>r.depthRange(...e),dither:(r,e)=>e?r.enable(3024):r.disable(3024),derivativeHint:(r,e)=>{r.hint(35723,e)},frontFace:(r,e)=>r.frontFace(e),mipmapHint:(r,e)=>r.hint(33170,e),lineWidth:(r,e)=>r.lineWidth(e),polygonOffsetFill:(r,e)=>e?r.enable(32823):r.disable(32823),polygonOffset:(r,e)=>r.polygonOffset(...e),sampleCoverage:(r,e)=>r.sampleCoverage(...e),scissorTest:(r,e)=>e?r.enable(3089):r.disable(3089),scissor:(r,e)=>r.scissor(...e),stencilTest:(r,e)=>e?r.enable(2960):r.disable(2960),stencilMask:(r,e)=>{e=hh(e)?e:[e,e];const[i,l]=e;r.stencilMaskSeparate(1028,i),r.stencilMaskSeparate(1029,l)},stencilFunc:(r,e)=>{e=hh(e)&&e.length===3?[...e,...e]:e;const[i,l,u,m,y,T]=e;r.stencilFuncSeparate(1028,i,l,u),r.stencilFuncSeparate(1029,m,y,T)},stencilOp:(r,e)=>{e=hh(e)&&e.length===3?[...e,...e]:e;const[i,l,u,m,y,T]=e;r.stencilOpSeparate(1028,i,l,u),r.stencilOpSeparate(1029,m,y,T)},viewport:(r,e)=>r.viewport(...e)};function Hi(r,e,i){return e[r]!==void 0?e[r]:i[r]}const VP={blendEquation:(r,e,i)=>r.blendEquationSeparate(Hi(32777,e,i),Hi(34877,e,i)),blendFunc:(r,e,i)=>r.blendFuncSeparate(Hi(32969,e,i),Hi(32968,e,i),Hi(32971,e,i),Hi(32970,e,i)),polygonOffset:(r,e,i)=>r.polygonOffset(Hi(32824,e,i),Hi(10752,e,i)),sampleCoverage:(r,e,i)=>r.sampleCoverage(Hi(32938,e,i),Hi(32939,e,i)),stencilFuncFront:(r,e,i)=>r.stencilFuncSeparate(1028,Hi(2962,e,i),Hi(2967,e,i),Hi(2963,e,i)),stencilFuncBack:(r,e,i)=>r.stencilFuncSeparate(1029,Hi(34816,e,i),Hi(36003,e,i),Hi(36004,e,i)),stencilOpFront:(r,e,i)=>r.stencilOpSeparate(1028,Hi(2964,e,i),Hi(2965,e,i),Hi(2966,e,i)),stencilOpBack:(r,e,i)=>r.stencilOpSeparate(1029,Hi(34817,e,i),Hi(34818,e,i),Hi(34819,e,i))},Z0={enable:(r,e)=>r({[e]:!0}),disable:(r,e)=>r({[e]:!1}),pixelStorei:(r,e,i)=>r({[e]:i}),hint:(r,e,i)=>r({[e]:i}),bindFramebuffer:(r,e,i)=>{switch(e){case 36160:return r({36006:i,36010:i});case 36009:return r({36006:i});case 36008:return r({36010:i});default:return null}},blendColor:(r,e,i,l,u)=>r({32773:new Float32Array([e,i,l,u])}),blendEquation:(r,e)=>r({32777:e,34877:e}),blendEquationSeparate:(r,e,i)=>r({32777:e,34877:i}),blendFunc:(r,e,i)=>r({32969:e,32968:i,32971:e,32970:i}),blendFuncSeparate:(r,e,i,l,u)=>r({32969:e,32968:i,32971:l,32970:u}),clearColor:(r,e,i,l,u)=>r({3106:new Float32Array([e,i,l,u])}),clearDepth:(r,e)=>r({2931:e}),clearStencil:(r,e)=>r({2961:e}),colorMask:(r,e,i,l,u)=>r({3107:[e,i,l,u]}),cullFace:(r,e)=>r({2885:e}),depthFunc:(r,e)=>r({2932:e}),depthRange:(r,e,i)=>r({2928:new Float32Array([e,i])}),depthMask:(r,e)=>r({2930:e}),frontFace:(r,e)=>r({2886:e}),lineWidth:(r,e)=>r({2849:e}),polygonOffset:(r,e,i)=>r({32824:e,10752:i}),sampleCoverage:(r,e,i)=>r({32938:e,32939:i}),scissor:(r,e,i,l,u)=>r({3088:new Int32Array([e,i,l,u])}),stencilMask:(r,e)=>r({2968:e,36005:e}),stencilMaskSeparate:(r,e,i)=>r({[e===1028?2968:36005]:i}),stencilFunc:(r,e,i,l)=>r({2962:e,2967:i,2963:l,34816:e,36003:i,36004:l}),stencilFuncSeparate:(r,e,i,l,u)=>r({[e===1028?2962:34816]:i,[e===1028?2967:36003]:l,[e===1028?2963:36004]:u}),stencilOp:(r,e,i,l)=>r({2964:e,2965:i,2966:l,34817:e,34818:i,34819:l}),stencilOpSeparate:(r,e,i,l,u)=>r({[e===1028?2964:34817]:i,[e===1028?2965:34818]:l,[e===1028?2966:34819]:u}),viewport:(r,e,i,l,u)=>r({2978:[e,i,l,u]})},Rs=(r,e)=>r.isEnabled(e),$0={3042:Rs,2884:Rs,2929:Rs,3024:Rs,32823:Rs,32926:Rs,32928:Rs,3089:Rs,2960:Rs,35977:Rs};function E1(r){for(const e in r)return!1;return!0}function GP(r,e){if(r===e)return!0;const i=Array.isArray(r)||ArrayBuffer.isView(r),l=Array.isArray(e)||ArrayBuffer.isView(e);if(i&&l&&r.length===e.length){for(let u=0;u<r.length;++u)if(r[u]!==e[u])return!1;return!0}return!1}function W0(r,e){const i=r[e].bind(r);r[e]=function(){const u=arguments.length<=0?void 0:arguments[0];return u in r.state.cache?r.state.enable?r.state.cache[u]:i(...arguments):i(...arguments)},Object.defineProperty(r[e],"name",{value:"".concat(e,"-from-cache"),configurable:!1})}function ZP(r,e,i){const l=r[e].bind(r);r[e]=function(){for(var m=arguments.length,y=new Array(m),T=0;T<m;T++)y[T]=arguments[T];const{valueChanged:a,oldValue:P}=i(r.state._updateCache,...y);return a&&l(...y),P},Object.defineProperty(r[e],"name",{value:"".concat(e,"-to-cache"),configurable:!1})}function $P(r){const e=r.useProgram.bind(r);r.useProgram=function(l){r.state.program!==l&&(e(l),r.state.program=l)}}class WP{constructor(e){let{copyState:i=!1,log:l=()=>{}}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.program=null,this.stateStack=[],this.enable=!0,this.cache=i?XP(e):Object.assign({},l_),this.log=l,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(){this.stateStack.push({})}pop(){en(this.stateStack.length>0);const e=this.stateStack[this.stateStack.length-1];wo(this.gl,e),this.stateStack.pop()}_updateCache(e){let i=!1,l;const u=this.stateStack.length>0&&this.stateStack[this.stateStack.length-1];for(const m in e){en(m!==void 0);const y=e[m],T=this.cache[m];GP(y,T)||(i=!0,l=T,u&&!(m in u)&&(u[m]=T),this.cache[m]=y)}return{valueChanged:i,oldValue:l}}}function S1(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{enable:i=!0,copyState:l}=e;if(en(l!==void 0),!r.state){const{polyfillContext:u}=globalThis;u&&u(r),r.state=new WP(r,{copyState:l}),$P(r);for(const m in Z0){const y=Z0[m];ZP(r,m,y)}W0(r,"getParameter"),W0(r,"isEnabled")}return r.state.enable=i,r}function qP(r){r.state||S1(r,{copyState:!1}),r.state.push()}function q0(r){en(r.state),r.state.pop()}function wo(r,e){if(en(ap(r),"setParameters requires a WebGL context"),E1(e))return;const i={};for(const u in e){const m=Number(u),y=jP[u];y&&(typeof y=="string"?i[y]=!0:y(r,e[u],m))}const l=r.state&&r.state.cache;if(l)for(const u in i){const m=VP[u];m(r,e,l)}}function XP(r,e){if(e=e||l_,typeof e=="number"){const u=e,m=$0[u];return m?m(r,u):r.getParameter(u)}const i=Array.isArray(e)?e:Object.keys(e),l={};for(const u of i){const m=$0[u];l[u]=m?m(r,Number(u)):r.getParameter(Number(u))}return l}function HP(r){wo(r,l_)}function Vn(r,e,i){if(E1(e))return i(r);const{nocatch:l=!0}=e;qP(r),wo(r,e);let u;if(l)u=i(r),q0(r);else try{u=i(r)}finally{q0(r)}return u}function Mc(r){const{luma:e}=r;if(r.canvas&&e){const{clientWidth:i}=e.canvasSizeInfo;return i?r.drawingBufferWidth/i:1}return 1}function Ym(r,e){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;const l=Mc(r),u=r.drawingBufferWidth,m=r.drawingBufferHeight;return KP(e,l,u,m,i)}function YP(r){const e=typeof window>"u"?1:window.devicePixelRatio||1;return Number.isFinite(r)?r<=0?1:r:r?e:1}function KP(r,e,i,l,u){const m=X0(r[0],e,i);let y=H0(r[1],e,l,u),T=X0(r[0]+1,e,i);const a=T===i-1?T:T-1;T=H0(r[1]+1,e,l,u);let P;return u?(T=T===0?T:T+1,P=y,y=T):P=T===l-1?T:T-1,{x:m,y,width:Math.max(a-m+1,1),height:Math.max(P-y+1,1)}}function X0(r,e,i){return Math.min(Math.round(r*e),i-1)}function H0(r,e,i,l){return l?Math.max(0,i-1-Math.round(r*e)):Math.min(Math.round(r*e),i-1)}const c_=Eo(),JP=c_&&typeof document<"u",A1={webgl2:!0,webgl1:!0,throwOnError:!0,manageState:!0,canvas:null,debug:!1,width:800,height:600};function M1(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};en(c_,`createGLContext only available in the browser.
Create your own headless context or use 'createHeadlessContext' from @luma.gl/test-utils`),r=Object.assign({},A1,r);const{width:e,height:i}=r;function l(T){if(r.throwOnError)throw new Error(T);return console.error(T),null}r.onError=l;let u;const{canvas:m}=r,y=iI({canvas:m,width:e,height:i,onError:l});return u=tI(y,r),u?(u=u_(u,r),rI(u),u):null}function u_(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!r||r._instrumented)return r;r._version=r._version||nI(r),r.luma=r.luma||{},r.luma.canvasSizeInfo=r.luma.canvasSizeInfo||{},e=Object.assign({},A1,e);const{manageState:i,debug:l}=e;return i&&S1(r,{copyState:!1,log:function(){for(var u=arguments.length,m=new Array(u),y=0;y<u;y++)m[y]=arguments[y];return Ct.log(1,...m)()}}),c_&&l&&(globalThis.makeDebugContext?(r=globalThis.makeDebugContext(r,e),Ct.level=Math.max(Ct.level,1)):Ct.warn('WebGL debug mode not activated. import "@luma.gl/debug" to enable.')()),r._instrumented=!0,r}function QP(r){const e=r.getParameter(7936),i=r.getParameter(7937),l=r.getExtension("WEBGL_debug_renderer_info"),u=l&&r.getParameter(l.UNMASKED_VENDOR_WEBGL||7936),m=l&&r.getParameter(l.UNMASKED_RENDERER_WEBGL||7937);return{vendor:u||e,renderer:m||i,vendorMasked:e,rendererMasked:i,version:r.getParameter(7938),shadingLanguageVersion:r.getParameter(35724)}}function eI(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(r.canvas){const l=YP(e.useDevicePixels);sI(r,l,e);return}const i=r.getExtension("STACKGL_resize_drawingbuffer");i&&"width"in e&&"height"in e&&i.resize(e.width,e.height)}function tI(r,e){const{onError:i}=e;let l=null;const u=a=>l=a.statusMessage||l;r.addEventListener("webglcontextcreationerror",u,!1);const{webgl1:m=!0,webgl2:y=!0}=e;let T=null;return y&&(T=T||r.getContext("webgl2",e),T=T||r.getContext("experimental-webgl2",e)),m&&(T=T||r.getContext("webgl",e),T=T||r.getContext("experimental-webgl",e)),r.removeEventListener("webglcontextcreationerror",u,!1),T?(e.onContextLost&&r.addEventListener("webglcontextlost",e.onContextLost,!1),e.onContextRestored&&r.addEventListener("webglcontextrestored",e.onContextRestored,!1),T):i("Failed to create ".concat(y&&!m?"WebGL2":"WebGL"," context: ").concat(l||"Unknown error"))}function iI(r){let{canvas:e,width:i=800,height:l=600,onError:u}=r,m;return typeof e=="string"?(JP&&document.readyState==="complete"||u("createGLContext called on canvas '".concat(e,"' before page was loaded")),m=document.getElementById(e)):e?m=e:(m=document.createElement("canvas"),m.id="lumagl-canvas",m.style.width=Number.isFinite(i)?"".concat(i,"px"):"100%",m.style.height=Number.isFinite(l)?"".concat(l,"px"):"100%",document.body.insertBefore(m,document.body.firstChild)),m}function rI(r){const e=ai(r)?"WebGL2":"WebGL1",i=QP(r),l=i?"(".concat(i.vendor,",").concat(i.renderer,")"):"",u=r.debug?" debug":"";Ct.info(1,"".concat(e).concat(u," context ").concat(l))()}function nI(r){return typeof WebGL2RenderingContext<"u"&&r instanceof WebGL2RenderingContext?2:1}function sI(r,e,i){let l="width"in i?i.width:r.canvas.clientWidth,u="height"in i?i.height:r.canvas.clientHeight;(!l||!u)&&(Ct.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,l=r.canvas.width||1,u=r.canvas.height||1),r.luma=r.luma||{},r.luma.canvasSizeInfo=r.luma.canvasSizeInfo||{};const m=r.luma.canvasSizeInfo;if(m.clientWidth!==l||m.clientHeight!==u||m.devicePixelRatio!==e){let y=e;const T=Math.floor(l*y),a=Math.floor(u*y);r.canvas.width=T,r.canvas.height=a,(r.drawingBufferWidth!==T||r.drawingBufferHeight!==a)&&(Ct.warn("Device pixel ratio clamped")(),y=Math.min(r.drawingBufferWidth/l,r.drawingBufferHeight/u),r.canvas.width=Math.floor(l*y),r.canvas.height=Math.floor(u*y)),Object.assign(r.luma.canvasSizeInfo,{clientWidth:l,clientHeight:u,devicePixelRatio:e})}}const bh="8.5.18",oI="set luma.log.level=1 (or higher) to trace rendering";class aI{constructor(){this.stats=new Map}get(e){return this.stats.has(e)||this.stats.set(e,new r_({id:e})),this.stats.get(e)}}const ol=new aI;if(globalThis.luma&&globalThis.luma.VERSION!==bh)throw new Error("luma.gl - multiple VERSIONs detected: ".concat(globalThis.luma.VERSION," vs ").concat(bh));globalThis.luma||(Eo()&&Ct.log(1,"luma.gl ".concat(bh," - ").concat(oI))(),globalThis.luma=globalThis.luma||{VERSION:bh,version:bh,log:Ct,stats:ol,globals:{modules:{},nodeIO:{}}});function lI(r){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(r):setTimeout(r,1e3/60)}function cI(r){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(r):clearTimeout(r)}function xt(r,e){if(!r)throw new Error(e||"luma.gl: assertion failed.")}function Km(r,e){if(typeof e!="string")return e;const i=Number(e);if(!isNaN(i))return i;e=e.replace(/^.*\./,"");const l=r[e];return xt(l!==void 0,"Accessing undefined constant GL.".concat(e)),l}function la(r,e){e=Number(e);for(const i in r)if(r[i]===e)return"GL.".concat(i);return String(e)}const Jm={};function ca(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"id";Jm[r]=Jm[r]||1;const e=Jm[r]++;return"".concat(r,"-").concat(e)}function Y0(r){return xt(typeof r=="number","Input must be a number"),r&&(r&r-1)===0}function Pc(r){let e=!0;for(const i in r){e=!1;break}return e}function P1(r,e,i,l){const u="See luma.gl ".concat(i," Upgrade Guide at https://luma.gl/docs/upgrade-guide"),m=Object.getPrototypeOf(r);l.forEach(y=>{m.methodName||(m[y]=()=>{throw Ct.removed("Calling removed method ".concat(e,".").concat(y,": "),u)(),new Error(y)})})}const dc="Resource subclass must define virtual methods";let So=class{get[Symbol.toStringTag](){return"Resource"}constructor(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};lp(e);const{id:l,userData:u={}}=i;this.gl=e,this.gl2=e,this.id=l||ca(this[Symbol.toStringTag]),this.userData=u,this._bound=!1,this._handle=i.handle,this._handle===void 0&&(this._handle=this._createHandle()),this.byteLength=0,this._addStats()}toString(){return"".concat(this[Symbol.toStringTag]||this.constructor.name,"(").concat(this.id,")")}get handle(){return this._handle}delete(){let{deleteChildren:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const i=this._handle&&this._deleteHandle(this._handle);return this._handle&&this._removeStats(),this._handle=null,i&&e&&i.filter(Boolean).forEach(l=>l.delete()),this}bind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.handle;if(typeof e!="function")return this._bindHandle(e),this;let i;return this._bound?i=e():(this._bindHandle(this.handle),this._bound=!0,i=e(),this._bound=!1,this._bindHandle(null)),i}unbind(){this.bind(null)}getParameter(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};e=Km(this.gl,e),xt(e);const u=(this.constructor.PARAMETERS||{})[e];if(u){const m=ai(this.gl);if(!((!("webgl2"in u)||m)&&(!("extension"in u)||this.gl.getExtension(u.extension)))){const T=u.webgl1,a="webgl2"in u?u.webgl2:u.webgl1;return m?a:T}}return this._getParameter(e,i)}getParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{parameters:i,keys:l}=e,u=this.constructor.PARAMETERS||{},m=ai(this.gl),y={},T=i||Object.keys(u);for(const a of T){const P=u[a];if(P&&(!("webgl2"in P)||m)&&(!("extension"in P)||this.gl.getExtension(P.extension))){const N=l?la(this.gl,a):a;y[N]=this.getParameter(a,e),l&&P.type==="GLenum"&&(y[N]=la(this.gl,y[N]))}}return y}setParameter(e,i){e=Km(this.gl,e),xt(e);const u=(this.constructor.PARAMETERS||{})[e];if(u){const m=ai(this.gl);if(!((!("webgl2"in u)||m)&&(!("extension"in u)||this.gl.getExtension(u.extension))))throw new Error("Parameter not available on this platform");u.type==="GLenum"&&(i=Km(i))}return this._setParameter(e,i),this}setParameters(e){for(const i in e)this.setParameter(i,e[i]);return this}stubRemovedMethods(e,i,l){return P1(this,e,i,l)}initialize(e){}_createHandle(){throw new Error(dc)}_deleteHandle(){throw new Error(dc)}_bindHandle(e){throw new Error(dc)}_getOptsFromHandle(){throw new Error(dc)}_getParameter(e,i){throw new Error(dc)}_setParameter(e,i){throw new Error(dc)}_context(){return this.gl.luma=this.gl.luma||{},this.gl.luma}_addStats(){const e=this[Symbol.toStringTag],i=ol.get("Resource Counts");i.get("Resources Created").incrementCount(),i.get("".concat(e,"s Created")).incrementCount(),i.get("".concat(e,"s Active")).incrementCount()}_removeStats(){const e=this[Symbol.toStringTag];ol.get("Resource Counts").get("".concat(e,"s Active")).decrementCount()}_trackAllocatedMemory(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag];this._trackAllocatedMemoryForContext(e,i),this._trackAllocatedMemoryForContext(e,i,this.gl.canvas&&this.gl.canvas.id),this.byteLength=e}_trackAllocatedMemoryForContext(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag],l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";const u=ol.get("Memory Usage".concat(l));u.get("GPU Memory").addCount(e),u.get("".concat(i," Memory")).addCount(e)}_trackDeallocatedMemory(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag];this._trackDeallocatedMemoryForContext(e),this._trackDeallocatedMemoryForContext(e,this.gl.canvas&&this.gl.canvas.id),this.byteLength=0}_trackDeallocatedMemoryForContext(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag],i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";const l=ol.get("Memory Usage".concat(i));l.get("GPU Memory").subtractCount(this.byteLength),l.get("".concat(e," Memory")).subtractCount(this.byteLength)}};const uI="Failed to deduce GL constant from typed array";function Cg(r){switch(ArrayBuffer.isView(r)?r.constructor:r){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(uI)}}function Sh(r){let{clamped:e=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};switch(r){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return e?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function hI(r){let{data:e,width:i,height:l,bytesPerPixel:u=4,temp:m}=r;const y=i*u;m=m||new Uint8Array(y);for(let T=0;T<l/2;++T){const a=T*y,P=(l-T-1)*y;m.set(e.subarray(a,a+y)),e.copyWithin(a,P,P+y),e.set(m,P)}}function fI(r){let{data:e,width:i,height:l}=r;const u=Math.round(i/2),m=Math.round(l/2),y=new Uint8Array(u*m*4);for(let T=0;T<m;T++)for(let a=0;a<u;a++)for(let P=0;P<4;P++)y[(T*u+a)*4+P]=e[(T*2*i+a*2)*4+P];return{data:y,width:u,height:m}}function Lg(r,e,i){const{removedProps:l={},deprecatedProps:u={},replacedProps:m={}}=i;for(const T in l)if(T in e){const P=l[T]?"".concat(r,".").concat(l[T]):"N/A";Ct.removed("".concat(r,".").concat(T),P)()}for(const T in u)if(T in e){const a=u[T];Ct.deprecated("".concat(r,".").concat(T),"".concat(r,".").concat(a))()}let y=null;for(const T in m)if(T in e){const a=m[T];Ct.deprecated("".concat(r,".").concat(T),"".concat(r,".").concat(a))(),y=y||Object.assign({},e),y[a]=e[T],delete y[T]}return y||e}const dI={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},pI={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}};class Mn{static getBytesPerElement(e){return Sh(e.type||5126).BYTES_PER_ELEMENT}static getBytesPerVertex(e){return xt(e.size),Sh(e.type||5126).BYTES_PER_ELEMENT*e.size}static resolve(){for(var e=arguments.length,i=new Array(e),l=0;l<e;l++)i[l]=arguments[l];return new Mn(dI,...i)}constructor(){for(var e=arguments.length,i=new Array(e),l=0;l<e;l++)i[l]=arguments[l];i.forEach(u=>this._assign(u)),Object.freeze(this)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return Mn.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return Mn.getBytesPerVertex(this)}_assign(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e=Lg("Accessor",e,pI),e.type!==void 0&&(this.type=e.type,(e.type===5124||e.type===5125)&&(this.integer=!0)),e.size!==void 0&&(this.size=e.size),e.offset!==void 0&&(this.offset=e.offset),e.stride!==void 0&&(this.stride=e.stride),e.normalized!==void 0&&(this.normalized=e.normalized),e.integer!==void 0&&(this.integer=e.integer),e.divisor!==void 0&&(this.divisor=e.divisor),e.buffer!==void 0&&(this.buffer=e.buffer),e.index!==void 0&&(typeof e.index=="boolean"?this.index=e.index?1:0:this.index=e.index),e.instanced!==void 0&&(this.divisor=e.instanced?1:0),e.isInstanced!==void 0&&(this.divisor=e.isInstanced?1:0),this}}const K0=10,I1={offset:"accessor.offset",stride:"accessor.stride",type:"accessor.type",size:"accessor.size",divisor:"accessor.divisor",normalized:"accessor.normalized",integer:"accessor.integer",instanced:"accessor.divisor",isInstanced:"accessor.divisor"},mI={removedProps:{},replacedProps:{bytes:"byteLength"},deprecatedProps:I1},gI={removedProps:I1};class Oi extends So{get[Symbol.toStringTag](){return"Buffer"}constructor(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,i),this.stubRemovedMethods("Buffer","v6.0",["layout","setLayout","getIndexedParameter"]),this.target=i.target||(this.gl.webgl2?36662:34962),this.initialize(i),Object.seal(this)}getElementCount(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/Mn.getBytesPerElement(e))}getVertexCount(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/Mn.getBytesPerVertex(e))}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return ArrayBuffer.isView(e)&&(e={data:e}),Number.isFinite(e)&&(e={byteLength:e}),e=Lg("Buffer",e,mI),this.usage=e.usage||35044,this.debugData=null,this.setAccessor(Object.assign({},e,e.accessor)),e.data?this._setData(e.data,e.offset,e.byteLength):this._setByteLength(e.byteLength||0),this}setProps(e){return e=Lg("Buffer",e,gI),"accessor"in e&&this.setAccessor(e.accessor),this}setAccessor(e){return e=Object.assign({},e),delete e.buffer,this.accessor=new Mn(e),this}reallocate(e){return e>this.byteLength?(this._setByteLength(e),!0):(this.bytesUsed=e,!1)}setData(e){return this.initialize(e)}subData(e){ArrayBuffer.isView(e)&&(e={data:e});const{data:i,offset:l=0,srcOffset:u=0}=e,m=e.byteLength||e.length;xt(i);const y=this.gl.webgl2?36663:this.target;return this.gl.bindBuffer(y,this.handle),u!==0||m!==void 0?(Gr(this.gl),this.gl.bufferSubData(this.target,l,i,u,m)):this.gl.bufferSubData(y,l,i),this.gl.bindBuffer(y,null),this.debugData=null,this._inferType(i),this}copyData(e){let{sourceBuffer:i,readOffset:l=0,writeOffset:u=0,size:m}=e;const{gl:y}=this;return Gr(y),y.bindBuffer(36662,i.handle),y.bindBuffer(36663,this.handle),y.copyBufferSubData(36662,36663,l,u,m),y.bindBuffer(36662,null),y.bindBuffer(36663,null),this.debugData=null,this}getData(){let{dstData:e=null,srcByteOffset:i=0,dstOffset:l=0,length:u=0}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Gr(this.gl);const m=Sh(this.accessor.type||5126,{clamped:!1}),y=this._getAvailableElementCount(i),T=l;let a,P;e?(P=e.length,a=P-T):(a=Math.min(y,u||y),P=T+a);const D=Math.min(y,a);return u=u||D,xt(u<=D),e=e||new m(P),this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,i,e,l,u),this.gl.bindBuffer(36662,null),e}bind(){let{target:e=this.target,index:i=this.accessor&&this.accessor.index,offset:l=0,size:u}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e===35345||e===35982?u!==void 0?this.gl.bindBufferRange(e,i,this.handle,l,u):(xt(l===0),this.gl.bindBufferBase(e,i,this.handle)):this.gl.bindBuffer(e,this.handle),this}unbind(){let{target:e=this.target,index:i=this.accessor&&this.accessor.index}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e===35345||e===35982?this.gl.bindBufferBase(e,i,null):this.gl.bindBuffer(e,null),this}getDebugData(){return this.debugData?{data:this.debugData,changed:!1}:(this.debugData=this.getData({length:Math.min(K0,this.byteLength)}),{data:this.debugData,changed:!0})}invalidateDebugData(){this.debugData=null}_setData(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:e.byteLength+i;xt(ArrayBuffer.isView(e)),this._trackDeallocatedMemory();const u=this._getTarget();this.gl.bindBuffer(u,this.handle),this.gl.bufferData(u,l,this.usage),this.gl.bufferSubData(u,i,e),this.gl.bindBuffer(u,null),this.debugData=e.slice(0,K0),this.bytesUsed=l,this._trackAllocatedMemory(l);const m=Cg(e);return xt(m),this.setAccessor(new Mn(this.accessor,{type:m})),this}_setByteLength(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.usage;xt(e>=0),this._trackDeallocatedMemory();let l=e;e===0&&(l=new Float32Array(0));const u=this._getTarget();return this.gl.bindBuffer(u,this.handle),this.gl.bufferData(u,l,i),this.gl.bindBuffer(u,null),this.usage=i,this.debugData=null,this.bytesUsed=e,this._trackAllocatedMemory(e),this}_getTarget(){return this.gl.webgl2?36663:this.target}_getAvailableElementCount(e){const i=Sh(this.accessor.type||5126,{clamped:!1}),l=e/i.BYTES_PER_ELEMENT;return this.getElementCount()-l}_inferType(e){this.accessor.type||this.setAccessor(new Mn(this.accessor,{type:Cg(e)}))}_createHandle(){return this.gl.createBuffer()}_deleteHandle(){this.gl.deleteBuffer(this.handle),this._trackDeallocatedMemory()}_getParameter(e){this.gl.bindBuffer(this.target,this.handle);const i=this.gl.getBufferParameter(this.target,e);return this.gl.bindBuffer(this.target,null),i}get type(){return Ct.deprecated("Buffer.type","Buffer.accessor.type")(),this.accessor.type}get bytes(){return Ct.deprecated("Buffer.bytes","Buffer.byteLength")(),this.byteLength}setByteLength(e){return Ct.deprecated("setByteLength","reallocate")(),this.reallocate(e)}updateAccessor(e){return Ct.deprecated("updateAccessor(...)","setAccessor(new Accessor(buffer.accessor, ...)")(),this.accessor=new Mn(this.accessor,e),this}}const h_={6407:{dataFormat:6407,types:[5121,33635]},6408:{dataFormat:6408,types:[5121,32819,32820]},6406:{dataFormat:6406,types:[5121]},6409:{dataFormat:6409,types:[5121]},6410:{dataFormat:6410,types:[5121]},33326:{dataFormat:6403,types:[5126],gl2:!0},33328:{dataFormat:33319,types:[5126],gl2:!0},34837:{dataFormat:6407,types:[5126],gl2:!0},34836:{dataFormat:6408,types:[5126],gl2:!0}},C1={6403:1,36244:1,33319:2,33320:2,6407:3,36248:3,6408:4,36249:4,6402:1,34041:1,6406:1,6409:1,6410:2},L1={5126:4,5125:4,5124:4,5123:2,5122:2,5131:2,5120:1,5121:1};function _I(r,e){const i=h_[e];if(!i)return!1;if(i.gl1===void 0&&i.gl2===void 0)return!0;const l=ai(r)&&i.gl2||i.gl1;return typeof l=="string"?r.getExtension(l):l}function yI(r,e){const i=h_[e];switch(i&&i.types[0]){case 5126:return r.getExtension("OES_texture_float_linear");case 5131:return r.getExtension("OES_texture_half_float_linear");default:return!0}}const vI=[9729,9728],J0=globalThis.WebGLBuffer||function(){};class cl extends So{get[Symbol.toStringTag](){return"Texture"}static isSupported(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{format:l,linearFiltering:u}=i;let m=!0;return l&&(m=m&&_I(e,l),m=m&&(!u||yI(e,l))),m}constructor(e,i){const{id:l=ca("texture"),handle:u,target:m}=i;super(e,{id:l,handle:u}),this.target=m,this.textureUnit=void 0,this.loaded=!1,this.width=void 0,this.height=void 0,this.depth=void 0,this.format=void 0,this.type=void 0,this.dataFormat=void 0,this.border=void 0,this.textureUnit=void 0,this.mipmaps=void 0}toString(){return"Texture(".concat(this.id,",").concat(this.width,"x").concat(this.height,")")}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=e.data;if(i instanceof Promise)return i.then(Ce=>this.initialize(Object.assign({},e,{pixels:Ce,data:Ce}))),this;const l=typeof HTMLVideoElement<"u"&&i instanceof HTMLVideoElement;if(l&&i.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,i.addEventListener("loadeddata",()=>this.initialize(e)),this;const{pixels:u=null,format:m=6408,border:y=0,recreate:T=!1,parameters:a={},pixelStore:P={},textureUnit:D=void 0}=e;i||(i=u);let{width:N,height:F,dataFormat:W,type:oe,compressed:me=!1,mipmaps:fe=!0}=e;const{depth:Ee=0}=e;return{width:N,height:F,compressed:me,dataFormat:W,type:oe}=this._deduceParameters({format:m,type:oe,dataFormat:W,compressed:me,data:i,width:N,height:F}),this.width=N,this.height=F,this.depth=Ee,this.format=m,this.type=oe,this.dataFormat=W,this.border=y,this.textureUnit=D,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),fe&&this._isNPOT()&&(Ct.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),fe=!1,this._updateForNPOT(a)),this.mipmaps=fe,this.setImageData({data:i,width:N,height:F,depth:Ee,format:m,type:oe,dataFormat:W,border:y,mipmaps:fe,parameters:P,compressed:me}),fe&&this.generateMipmap(),this.setParameters(a),T&&(this.data=i),l&&(this._video={video:i,parameters:a,lastTime:i.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?i.currentTime:-1}),this}update(){if(this._video){const{video:e,parameters:i,lastTime:l}=this._video;if(l===e.currentTime||e.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:e,parameters:i}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=e.currentTime}}resize(e){let{height:i,width:l,mipmaps:u=!1}=e;return l!==this.width||i!==this.height?this.initialize({width:l,height:i,format:this.format,type:this.type,dataFormat:this.dataFormat,border:this.border,mipmaps:u}):this}generateMipmap(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isNPOT()?(Ct.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),this):(this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),Vn(this.gl,e,()=>{this.gl.generateMipmap(this.target)}),this.gl.bindTexture(this.target,null),this)}setImageData(e){this._trackDeallocatedMemory("Texture");const{target:i=this.target,pixels:l=null,level:u=0,format:m=this.format,border:y=this.border,offset:T=0,parameters:a={}}=e;let{data:P=null,type:D=this.type,width:N=this.width,height:F=this.height,dataFormat:W=this.dataFormat,compressed:oe=!1}=e;P||(P=l),{type:D,dataFormat:W,compressed:oe,width:N,height:F}=this._deduceParameters({format:m,type:D,dataFormat:W,compressed:oe,data:P,width:N,height:F});const{gl:me}=this;me.bindTexture(this.target,this.handle);let fe=null;({data:P,dataType:fe}=this._getDataType({data:P,compressed:oe}));let Ee,Ce=0;if(Vn(this.gl,a,()=>{switch(fe){case"null":me.texImage2D(i,u,m,N,F,y,W,D,P);break;case"typed-array":me.texImage2D(i,u,m,N,F,y,W,D,P,T);break;case"buffer":Ee=Gr(me),Ee.bindBuffer(35052,P.handle||P),Ee.texImage2D(i,u,m,N,F,y,W,D,T),Ee.bindBuffer(35052,null);break;case"browser-object":ai(me)?me.texImage2D(i,u,m,N,F,y,W,D,P):me.texImage2D(i,u,m,W,D,P);break;case"compressed":for(const[ke,$e]of P.entries())me.compressedTexImage2D(i,ke,$e.format,$e.width,$e.height,y,$e.data),Ce+=$e.levelSize;break;default:xt(!1,"Unknown image data type")}}),fe==="compressed")this._trackAllocatedMemory(Ce,"Texture");else if(P&&P.byteLength)this._trackAllocatedMemory(P.byteLength,"Texture");else{const ke=C1[this.dataFormat]||4,$e=L1[this.type]||1;this._trackAllocatedMemory(this.width*this.height*ke*$e,"Texture")}return this.loaded=!0,this}setSubImageData(e){let{target:i=this.target,pixels:l=null,data:u=null,x:m=0,y=0,width:T=this.width,height:a=this.height,level:P=0,format:D=this.format,type:N=this.type,dataFormat:F=this.dataFormat,compressed:W=!1,offset:oe=0,border:me=this.border,parameters:fe={}}=e;if({type:N,dataFormat:F,compressed:W,width:T,height:a}=this._deduceParameters({format:D,type:N,dataFormat:F,compressed:W,data:u,width:T,height:a}),xt(this.depth===0,"texSubImage not supported for 3D textures"),u||(u=l),u&&u.data){const Ee=u;u=Ee.data,T=Ee.shape[0],a=Ee.shape[1]}u instanceof Oi&&(u=u.handle),this.gl.bindTexture(this.target,this.handle),Vn(this.gl,fe,()=>{if(W)this.gl.compressedTexSubImage2D(i,P,m,y,T,a,D,u);else if(u===null)this.gl.texSubImage2D(i,P,m,y,T,a,F,N,null);else if(ArrayBuffer.isView(u))this.gl.texSubImage2D(i,P,m,y,T,a,F,N,u,oe);else if(u instanceof J0){const Ee=Gr(this.gl);Ee.bindBuffer(35052,u),Ee.texSubImage2D(i,P,m,y,T,a,F,N,oe),Ee.bindBuffer(35052,null)}else ai(this.gl)?Gr(this.gl).texSubImage2D(i,P,m,y,T,a,F,N,u):this.gl.texSubImage2D(i,P,m,y,F,N,u)}),this.gl.bindTexture(this.target,null)}copyFramebuffer(){return Ct.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit;const{gl:i}=this;return e!==void 0&&(this.textureUnit=e,i.activeTexture(33984+e)),i.bindTexture(this.target,this.handle),e}unbind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit;const{gl:i}=this;return e!==void 0&&(this.textureUnit=e,i.activeTexture(33984+e)),i.bindTexture(this.target,null),e}_getDataType(e){let{data:i,compressed:l=!1}=e;return l?{data:i,dataType:"compressed"}:i===null?{data:i,dataType:"null"}:ArrayBuffer.isView(i)?{data:i,dataType:"typed-array"}:i instanceof Oi?{data:i.handle,dataType:"buffer"}:i instanceof J0?{data:i,dataType:"buffer"}:{data:i,dataType:"browser-object"}}_deduceParameters(e){const{format:i,data:l}=e;let{width:u,height:m,dataFormat:y,type:T,compressed:a}=e;const P=h_[i];return y=y||P&&P.dataFormat,T=T||P&&P.types[0],a=a||P&&P.compressed,{width:u,height:m}=this._deduceImageSize(l,u,m),{dataFormat:y,type:T,compressed:a,width:u,height:m,format:i,data:l}}_deduceImageSize(e,i,l){let u;return typeof ImageData<"u"&&e instanceof ImageData?u={width:e.width,height:e.height}:typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement?u={width:e.naturalWidth,height:e.naturalHeight}:typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement?u={width:e.width,height:e.height}:typeof ImageBitmap<"u"&&e instanceof ImageBitmap?u={width:e.width,height:e.height}:typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement?u={width:e.videoWidth,height:e.videoHeight}:e?u={width:i,height:l}:u={width:i>=0?i:1,height:l>=0?l:1},xt(u,"Could not deduced texture size"),xt(i===void 0||u.width===i,"Deduced texture width does not match supplied width"),xt(l===void 0||u.height===l,"Deduced texture height does not match supplied height"),u}_createHandle(){return this.gl.createTexture()}_deleteHandle(){this.gl.deleteTexture(this.handle),this._trackDeallocatedMemory("Texture")}_getParameter(e){switch(e){case 4096:return this.width;case 4097:return this.height;default:this.gl.bindTexture(this.target,this.handle);const i=this.gl.getTexParameter(this.target,e);return this.gl.bindTexture(this.target,null),i}}_setParameter(e,i){switch(this.gl.bindTexture(this.target,this.handle),i=this._getNPOTParam(e,i),e){case 33082:case 33083:this.gl.texParameterf(this.handle,e,i);break;case 4096:case 4097:xt(!1);break;default:this.gl.texParameteri(this.target,e,i);break}return this.gl.bindTexture(this.target,null),this}_isNPOT(){return ai(this.gl)||!this.width||!this.height?!1:!Y0(this.width)||!Y0(this.height)}_updateForNPOT(e){e[this.gl.TEXTURE_MIN_FILTER]===void 0&&(e[this.gl.TEXTURE_MIN_FILTER]=this.gl.LINEAR),e[this.gl.TEXTURE_WRAP_S]===void 0&&(e[this.gl.TEXTURE_WRAP_S]=this.gl.CLAMP_TO_EDGE),e[this.gl.TEXTURE_WRAP_T]===void 0&&(e[this.gl.TEXTURE_WRAP_T]=this.gl.CLAMP_TO_EDGE)}_getNPOTParam(e,i){if(this._isNPOT())switch(e){case 10241:vI.indexOf(i)===-1&&(i=9729);break;case 10242:case 10243:i!==33071&&(i=33071);break}return i}}let xI="";function bI(r,e){return xt(typeof r=="string"),r=xI+r,new Promise((i,l)=>{try{const u=new Image;u.onload=()=>i(u),u.onerror=()=>l(new Error("Could not load image ".concat(r,"."))),u.crossOrigin=e&&e.crossOrigin||"anonymous",u.src=r}catch(u){l(u)}})}class In extends cl{get[Symbol.toStringTag](){return"Texture2D"}static isSupported(e,i){return cl.isSupported(e,i)}constructor(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};lp(e),(i instanceof Promise||typeof i=="string")&&(i={data:i}),typeof i.data=="string"&&(i=Object.assign({},i,{data:bI(i.data)})),super(e,Object.assign({},i,{target:3553})),this.initialize(i),Object.seal(this)}}const kg=[34069,34070,34071,34072,34073,34074];class k1 extends cl{get[Symbol.toStringTag](){return"TextureCube"}constructor(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};lp(e),super(e,Object.assign({},i,{target:34067})),this.initialize(i),Object.seal(this)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{mipmaps:i=!0,parameters:l={}}=e;return this.opts=e,this.setCubeMapImageData(e).then(()=>{this.loaded=!0,i&&this.generateMipmap(e),this.setParameters(l)}),this}subImage(e){let{face:i,data:l,x:u=0,y:m=0,mipmapLevel:y=0}=e;return this._subImage({target:i,data:l,x:u,y:m,mipmapLevel:y})}async setCubeMapImageData(e){let{width:i,height:l,pixels:u,data:m,border:y=0,format:T=6408,type:a=5121}=e;const{gl:P}=this,D=u||m,N=await Promise.all(kg.map(F=>{const W=D[F];return Promise.all(Array.isArray(W)?W:[W])}));this.bind(),kg.forEach((F,W)=>{N[W].length>1&&this.opts.mipmaps!==!1&&Ct.warn("".concat(this.id," has mipmap and multiple LODs."))(),N[W].forEach((oe,me)=>{i&&l?P.texImage2D(F,me,T,i,l,y,T,a,oe):P.texImage2D(F,me,T,T,a,oe)})}),this.unbind()}setImageDataForFace(e){const{face:i,width:l,height:u,pixels:m,data:y,border:T=0,format:a=6408,type:P=5121}=e,{gl:D}=this,N=m||y;return this.bind(),N instanceof Promise?N.then(F=>this.setImageDataForFace(Object.assign({},e,{face:i,data:F,pixels:F}))):this.width||this.height?D.texImage2D(i,0,a,l,u,T,a,P,N):D.texImage2D(i,0,a,a,P,N),this}}k1.FACES=kg;class wI extends cl{get[Symbol.toStringTag](){return"Texture3D"}static isSupported(e){return ai(e)}constructor(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Gr(e),i=Object.assign({depth:1},i,{target:32879,unpackFlipY:!1}),super(e,i),this.initialize(i),Object.seal(this)}setImageData(e){let{level:i=0,dataFormat:l=6408,width:u,height:m,depth:y=1,border:T=0,format:a,type:P=5121,offset:D=0,data:N,parameters:F={}}=e;if(this._trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle),Vn(this.gl,F,()=>{ArrayBuffer.isView(N)&&this.gl.texImage3D(this.target,i,l,u,m,y,T,a,P,N),N instanceof Oi&&(this.gl.bindBuffer(35052,N.handle),this.gl.texImage3D(this.target,i,l,u,m,y,T,a,P,D))}),N&&N.byteLength)this._trackAllocatedMemory(N.byteLength,"Texture");else{const W=C1[this.dataFormat]||4,oe=L1[this.type]||1;this._trackAllocatedMemory(this.width*this.height*this.depth*W*oe,"Texture")}return this.loaded=!0,this}}const tl="EXT_color_buffer_float",Q0={33189:{bpp:2},33190:{gl2:!0,bpp:3},36012:{gl2:!0,bpp:4},36168:{bpp:1},34041:{bpp:4},35056:{gl2:!0,bpp:4},36013:{gl2:!0,bpp:5},32854:{bpp:2},36194:{bpp:2},32855:{bpp:2},33321:{gl2:!0,bpp:1},33330:{gl2:!0,bpp:1},33329:{gl2:!0,bpp:1},33332:{gl2:!0,bpp:2},33331:{gl2:!0,bpp:2},33334:{gl2:!0,bpp:4},33333:{gl2:!0,bpp:4},33323:{gl2:!0,bpp:2},33336:{gl2:!0,bpp:2},33335:{gl2:!0,bpp:2},33338:{gl2:!0,bpp:4},33337:{gl2:!0,bpp:4},33340:{gl2:!0,bpp:8},33339:{gl2:!0,bpp:8},32849:{gl2:!0,bpp:3},32856:{gl2:!0,bpp:4},32857:{gl2:!0,bpp:4},36220:{gl2:!0,bpp:4},36238:{gl2:!0,bpp:4},36975:{gl2:!0,bpp:4},36214:{gl2:!0,bpp:8},36232:{gl2:!0,bpp:8},36226:{gl2:!0,bpp:16},36208:{gl2:!0,bpp:16},33325:{gl2:tl,bpp:2},33327:{gl2:tl,bpp:4},34842:{gl2:tl,bpp:8},33326:{gl2:tl,bpp:4},33328:{gl2:tl,bpp:8},34836:{gl2:tl,bpp:16},35898:{gl2:tl,bpp:4}};function TI(r,e,i){const l=i[e];if(!l)return!1;const u=ai(r)&&l.gl2||l.gl1;return typeof u=="string"?r.getExtension(u):u}class xc extends So{get[Symbol.toStringTag](){return"Renderbuffer"}static isSupported(e){let{format:i}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{format:null};return!i||TI(e,i,Q0)}static getSamplesForFormat(e,i){let{format:l}=i;return e.getInternalformatParameter(36161,l,32937)}constructor(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,i),this.initialize(i),Object.seal(this)}initialize(e){let{format:i,width:l=1,height:u=1,samples:m=0}=e;return xt(i,"Needs format"),this._trackDeallocatedMemory(),this.gl.bindRenderbuffer(36161,this.handle),m!==0&&ai(this.gl)?this.gl.renderbufferStorageMultisample(36161,m,i,l,u):this.gl.renderbufferStorage(36161,i,l,u),this.format=i,this.width=l,this.height=u,this.samples=m,this._trackAllocatedMemory(this.width*this.height*(this.samples||1)*Q0[this.format].bpp),this}resize(e){let{width:i,height:l}=e;return i!==this.width||l!==this.height?this.initialize({width:i,height:l,format:this.format,samples:this.samples}):this}_createHandle(){return this.gl.createRenderbuffer()}_deleteHandle(){this.gl.deleteRenderbuffer(this.handle),this._trackDeallocatedMemory()}_bindHandle(e){this.gl.bindRenderbuffer(36161,e)}_syncHandle(e){this.format=this.getParameter(36164),this.width=this.getParameter(36162),this.height=this.getParameter(36163),this.samples=this.getParameter(36011)}_getParameter(e){return this.gl.bindRenderbuffer(36161,this.handle),this.gl.getRenderbufferParameter(36161,e)}}const EI=256,SI=1024,AI=16384,ex=6144,tx=6145,ix=6146,rx=34041,R1="clear: bad arguments";function f_(r){let{framebuffer:e=null,color:i=null,depth:l=null,stencil:u=null}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const m={};e&&(m.framebuffer=e);let y=0;i&&(y|=AI,i!==!0&&(m.clearColor=i)),l&&(y|=EI,l!==!0&&(m.clearDepth=l)),u&&(y|=SI,l!==!0&&(m.clearStencil=l)),xt(y!==0,R1),Vn(r,m,()=>{r.clear(y)})}function MI(r){let{framebuffer:e=null,buffer:i=ex,drawBuffer:l=0,value:u=[0,0,0,0]}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Gr(r),Vn(r,{framebuffer:e},()=>{switch(i){case ex:switch(u.constructor){case Int32Array:r.clearBufferiv(i,l,u);break;case Uint32Array:r.clearBufferuiv(i,l,u);break;case Float32Array:default:r.clearBufferfv(i,l,u)}break;case tx:r.clearBufferfv(tx,0,[u]);break;case ix:r.clearBufferiv(ix,0,[u]);break;case rx:const[m,y]=u;r.clearBufferfi(rx,0,m,y);break;default:xt(!1,R1)}})}function PI(r){switch(r){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return xt(!1),0}}function cp(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{sourceX:i=0,sourceY:l=0,sourceFormat:u=6408}=e;let{sourceAttachment:m=36064,target:y=null,sourceWidth:T,sourceHeight:a,sourceType:P}=e;const{framebuffer:D,deleteFramebuffer:N}=O1(r);xt(D);const{gl:F,handle:W,attachments:oe}=D;T=T||D.width,a=a||D.height,m===36064&&W===null&&(m=1028),xt(oe[m]),P=P||oe[m].type,y=II(y,P,u,T,a),P=P||Cg(y);const me=F.bindFramebuffer(36160,W);return F.readPixels(i,l,T,a,u,P,y),F.bindFramebuffer(36160,me||null),N&&D.delete(),y}function nx(r){let{sourceAttachment:e=36064,targetMaxHeight:i=Number.MAX_SAFE_INTEGER}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},l=cp(r,{sourceAttachment:e}),{width:u,height:m}=r;for(;m>i;)({data:l,width:u,height:m}=fI({data:l,width:u,height:m}));hI({data:l,width:u,height:m});const y=document.createElement("canvas");y.width=u,y.height=m;const T=y.getContext("2d"),a=T.createImageData(u,m);return a.data.set(l),T.putImageData(a,0,0),y.toDataURL()}function SF(r,e){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{sourceX:l=0,sourceY:u=0,targetMipmaplevel:m=0,targetInternalFormat:y=6408}=i;let{targetX:T,targetY:a,targetZ:P,width:D,height:N}=i;const{framebuffer:F,deleteFramebuffer:W}=O1(r);xt(F);const{gl:oe,handle:me}=F,fe=typeof T<"u"||typeof a<"u"||typeof P<"u";T=T||0,a=a||0,P=P||0;const Ee=oe.bindFramebuffer(36160,me);xt(e);let Ce=null;if(e instanceof cl&&(Ce=e,D=Number.isFinite(D)?D:Ce.width,N=Number.isFinite(N)?N:Ce.height,Ce.bind(0),e=Ce.target),!fe)oe.copyTexImage2D(e,m,y,l,u,D,N,0);else switch(e){case 3553:case 34067:oe.copyTexSubImage2D(e,m,T,a,l,u,D,N);break;case 35866:case 32879:Gr(oe).copyTexSubImage3D(e,m,T,a,P,l,u,D,N);break}return Ce&&Ce.unbind(),oe.bindFramebuffer(36160,Ee||null),W&&F.delete(),Ce}function O1(r){return r instanceof tr?{framebuffer:r,deleteFramebuffer:!1}:{framebuffer:NI(r),deleteFramebuffer:!0}}function II(r,e,i,l,u){if(r)return r;e=e||5121;const m=Sh(e,{clamped:!1}),y=PI(i);return new m(l*u*y)}const Vi={WEBGL2:"WEBGL2",VERTEX_ARRAY_OBJECT:"VERTEX_ARRAY_OBJECT",TIMER_QUERY:"TIMER_QUERY",INSTANCED_RENDERING:"INSTANCED_RENDERING",MULTIPLE_RENDER_TARGETS:"MULTIPLE_RENDER_TARGETS",ELEMENT_INDEX_UINT32:"ELEMENT_INDEX_UINT32",BLEND_EQUATION_MINMAX:"BLEND_EQUATION_MINMAX",FLOAT_BLEND:"FLOAT_BLEND",COLOR_ENCODING_SRGB:"COLOR_ENCODING_SRGB",TEXTURE_DEPTH:"TEXTURE_DEPTH",TEXTURE_FLOAT:"TEXTURE_FLOAT",TEXTURE_HALF_FLOAT:"TEXTURE_HALF_FLOAT",TEXTURE_FILTER_LINEAR_FLOAT:"TEXTURE_FILTER_LINEAR_FLOAT",TEXTURE_FILTER_LINEAR_HALF_FLOAT:"TEXTURE_FILTER_LINEAR_HALF_FLOAT",TEXTURE_FILTER_ANISOTROPIC:"TEXTURE_FILTER_ANISOTROPIC",COLOR_ATTACHMENT_RGBA32F:"COLOR_ATTACHMENT_RGBA32F",COLOR_ATTACHMENT_FLOAT:"COLOR_ATTACHMENT_FLOAT",COLOR_ATTACHMENT_HALF_FLOAT:"COLOR_ATTACHMENT_HALF_FLOAT",GLSL_FRAG_DATA:"GLSL_FRAG_DATA",GLSL_FRAG_DEPTH:"GLSL_FRAG_DEPTH",GLSL_DERIVATIVES:"GLSL_DERIVATIVES",GLSL_TEXTURE_LOD:"GLSL_TEXTURE_LOD"};function CI(r){const e=new In(r,{format:6408,type:5126,dataFormat:6408}),i=new tr(r,{id:"test-framebuffer",check:!1,attachments:{36064:e}}),l=i.getStatus();return e.delete(),i.delete(),l===36053}const D1={[Vi.WEBGL2]:[!1,!0],[Vi.VERTEX_ARRAY_OBJECT]:["OES_vertex_array_object",!0],[Vi.TIMER_QUERY]:["EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2"],[Vi.INSTANCED_RENDERING]:["ANGLE_instanced_arrays",!0],[Vi.MULTIPLE_RENDER_TARGETS]:["WEBGL_draw_buffers",!0],[Vi.ELEMENT_INDEX_UINT32]:["OES_element_index_uint",!0],[Vi.BLEND_EQUATION_MINMAX]:["EXT_blend_minmax",!0],[Vi.FLOAT_BLEND]:["EXT_float_blend"],[Vi.COLOR_ENCODING_SRGB]:["EXT_sRGB",!0],[Vi.TEXTURE_DEPTH]:["WEBGL_depth_texture",!0],[Vi.TEXTURE_FLOAT]:["OES_texture_float",!0],[Vi.TEXTURE_HALF_FLOAT]:["OES_texture_half_float",!0],[Vi.TEXTURE_FILTER_LINEAR_FLOAT]:["OES_texture_float_linear"],[Vi.TEXTURE_FILTER_LINEAR_HALF_FLOAT]:["OES_texture_half_float_linear"],[Vi.TEXTURE_FILTER_ANISOTROPIC]:["EXT_texture_filter_anisotropic"],[Vi.COLOR_ATTACHMENT_RGBA32F]:[CI,"EXT_color_buffer_float"],[Vi.COLOR_ATTACHMENT_FLOAT]:[!1,"EXT_color_buffer_float"],[Vi.COLOR_ATTACHMENT_HALF_FLOAT]:["EXT_color_buffer_half_float"],[Vi.GLSL_FRAG_DATA]:["WEBGL_draw_buffers",!0],[Vi.GLSL_FRAG_DEPTH]:["EXT_frag_depth",!0],[Vi.GLSL_DERIVATIVES]:["OES_standard_derivatives",!0],[Vi.GLSL_TEXTURE_LOD]:["EXT_shader_texture_lod",!0]},LI=2;function kI(r,e){return z1(r,e)}function z1(r,e){return e=Array.isArray(e)?e:[e],e.every(i=>B1(r,i))}function RI(r){r.luma=r.luma||{},r.luma.caps=r.luma.caps||{};for(const e in D1)r.luma.caps[e]===void 0&&(r.luma.caps[e]=B1(r,e));return r.luma.caps}function B1(r,e){return r.luma=r.luma||{},r.luma.caps=r.luma.caps||{},r.luma.caps[e]===void 0&&(r.luma.caps[e]=OI(r,e)),r.luma.caps[e]||Ct.log(LI,"Feature: ".concat(e," not supported"))(),r.luma.caps[e]}function OI(r,e){const i=D1[e];xt(i,e);let l;const u=ai(r)&&i[1]||i[0];if(typeof u=="function")l=u(r);else if(Array.isArray(u)){l=!0;for(const m of u)l=l&&!!r.getExtension(m)}else typeof u=="string"?l=!!r.getExtension(u):typeof u=="boolean"?l=u:xt(!1);return l}const sx="Multiple render targets not supported";class tr extends So{get[Symbol.toStringTag](){return"Framebuffer"}static isSupported(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{colorBufferFloat:l,colorBufferHalfFloat:u}=i;let m=!0;return l&&(m=!!(e.getExtension("EXT_color_buffer_float")||e.getExtension("WEBGL_color_buffer_float")||e.getExtension("OES_texture_float"))),u&&(m=m&&!!(e.getExtension("EXT_color_buffer_float")||e.getExtension("EXT_color_buffer_half_float"))),m}static getDefaultFramebuffer(e){return e.luma=e.luma||{},e.luma.defaultFramebuffer=e.luma.defaultFramebuffer||new tr(e,{id:"default-framebuffer",handle:null,attachments:{}}),e.luma.defaultFramebuffer}get MAX_COLOR_ATTACHMENTS(){const e=Gr(this.gl);return e.getParameter(e.MAX_COLOR_ATTACHMENTS)}get MAX_DRAW_BUFFERS(){const e=Gr(this.gl);return e.getParameter(e.MAX_DRAW_BUFFERS)}constructor(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,i),this.width=null,this.height=null,this.attachments={},this.readBuffer=36064,this.drawBuffers=[36064],this.ownResources=[],this.initialize(i),Object.seal(this)}get color(){return this.attachments[36064]||null}get texture(){return this.attachments[36064]||null}get depth(){return this.attachments[36096]||this.attachments[33306]||null}get stencil(){return this.attachments[36128]||this.attachments[33306]||null}initialize(e){let{width:i=1,height:l=1,attachments:u=null,color:m=!0,depth:y=!0,stencil:T=!1,check:a=!0,readBuffer:P=void 0,drawBuffers:D=void 0}=e;if(xt(i>=0&&l>=0,"Width and height need to be integers"),this.width=i,this.height=l,u)for(const N in u){const F=u[N];(Array.isArray(F)?F[0]:F).resize({width:i,height:l})}else u=this._createDefaultAttachments(m,y,T,i,l);this.update({clearAttachments:!0,attachments:u,readBuffer:P,drawBuffers:D}),u&&a&&this.checkStatus()}delete(){for(const e of this.ownResources)e.delete();return super.delete(),this}update(e){let{attachments:i={},readBuffer:l,drawBuffers:u,clearAttachments:m=!1,resizeAttachments:y=!0}=e;this.attach(i,{clearAttachments:m,resizeAttachments:y});const{gl:T}=this,a=T.bindFramebuffer(36160,this.handle);return l&&this._setReadBuffer(l),u&&this._setDrawBuffers(u),T.bindFramebuffer(36160,a||null),this}resize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{width:i,height:l}=e;if(this.handle===null)return xt(i===void 0&&l===void 0),this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;i===void 0&&(i=this.gl.drawingBufferWidth),l===void 0&&(l=this.gl.drawingBufferHeight),i!==this.width&&l!==this.height&&Ct.log(2,"Resizing framebuffer ".concat(this.id," to ").concat(i,"x").concat(l))();for(const u in this.attachments)this.attachments[u].resize({width:i,height:l});return this.width=i,this.height=l,this}attach(e){let{clearAttachments:i=!1,resizeAttachments:l=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const u={};i&&Object.keys(this.attachments).forEach(y=>{u[y]=null}),Object.assign(u,e);const m=this.gl.bindFramebuffer(36160,this.handle);for(const y in u){xt(y!==void 0,"Misspelled framebuffer binding point?");const T=Number(y),a=u[T];let P=a;if(!P)this._unattach(T);else if(P instanceof xc)this._attachRenderbuffer({attachment:T,renderbuffer:P});else if(Array.isArray(a)){const[D,N=0,F=0]=a;P=D,this._attachTexture({attachment:T,texture:D,layer:N,level:F})}else this._attachTexture({attachment:T,texture:P,layer:0,level:0});l&&P&&P.resize({width:this.width,height:this.height})}this.gl.bindFramebuffer(36160,m||null),Object.assign(this.attachments,e),Object.keys(this.attachments).filter(y=>!this.attachments[y]).forEach(y=>{delete this.attachments[y]})}checkStatus(){const e=this.getStatus();if(e!==36053)throw new Error(zI(e));return this}getStatus(){const{gl:e}=this,i=e.bindFramebuffer(36160,this.handle),l=e.checkFramebufferStatus(36160);return e.bindFramebuffer(36160,i||null),l}clear(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{color:i,depth:l,stencil:u,drawBuffers:m=[]}=e,y=this.gl.bindFramebuffer(36160,this.handle);return(i||l||u)&&f_(this.gl,{color:i,depth:l,stencil:u}),m.forEach((T,a)=>{MI(this.gl,{drawBuffer:a,value:T})}),this.gl.bindFramebuffer(36160,y||null),this}readPixels(){return Ct.error("Framebuffer.readPixels() is no logner supported, use readPixelsToArray(framebuffer)")(),null}readPixelsToBuffer(){return Ct.error("Framebuffer.readPixelsToBuffer()is no logner supported, use readPixelsToBuffer(framebuffer)")(),null}copyToDataUrl(){return Ct.error("Framebuffer.copyToDataUrl() is no logner supported, use copyToDataUrl(framebuffer)")(),null}copyToImage(){return Ct.error("Framebuffer.copyToImage() is no logner supported, use copyToImage(framebuffer)")(),null}copyToTexture(){return Ct.error("Framebuffer.copyToTexture({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}blit(){return Ct.error("Framebuffer.blit({...}) is no logner supported, use blit(source, target, opts)")(),null}invalidate(e){let{attachments:i=[],x:l=0,y:u=0,width:m,height:y}=e;const T=Gr(this.gl),a=T.bindFramebuffer(36008,this.handle);return l===0&&u===0&&m===void 0&&y===void 0?T.invalidateFramebuffer(36008,i):T.invalidateFramebuffer(36008,i,l,u,m,y),T.bindFramebuffer(36008,a),this}getAttachmentParameter(e,i,l){let u=this._getAttachmentParameterFallback(i);return u===null&&(this.gl.bindFramebuffer(36160,this.handle),u=this.gl.getFramebufferAttachmentParameter(36160,e,i),this.gl.bindFramebuffer(36160,null)),l&&u>1e3&&(u=la(this.gl,u)),u}getAttachmentParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:36064,i=arguments.length>1?arguments[1]:void 0,l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.constructor.ATTACHMENT_PARAMETERS||[];const u={};for(const m of l){const y=i?la(this.gl,m):m;u[y]=this.getAttachmentParameter(e,m,i)}return u}getParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;const i=Object.keys(this.attachments),l={};for(const u of i){const m=Number(u),y=e?la(this.gl,m):m;l[y]=this.getAttachmentParameters(m,e)}return l}show(){return typeof window<"u"&&window.open(nx(this),"luma-debug-texture"),this}log(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if(e>Ct.level||typeof window>"u")return this;i=i||"Framebuffer ".concat(this.id);const l=nx(this,{targetMaxHeight:100});return Ct.image({logLevel:e,message:i,image:l},i)(),this}bind(){let{target:e=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(e,this.handle),this}unbind(){let{target:e=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(e,null),this}_createDefaultAttachments(e,i,l,u,m){let y=null;return e&&(y=y||{},y[36064]=new In(this.gl,{id:"".concat(this.id,"-color0"),pixels:null,format:6408,type:5121,width:u,height:m,mipmaps:!1,parameters:{10241:9729,10240:9729,10242:33071,10243:33071}}),this.ownResources.push(y[36064])),i&&l?(y=y||{},y[33306]=new xc(this.gl,{id:"".concat(this.id,"-depth-stencil"),format:35056,width:u,height:111}),this.ownResources.push(y[33306])):i?(y=y||{},y[36096]=new xc(this.gl,{id:"".concat(this.id,"-depth"),format:33189,width:u,height:m}),this.ownResources.push(y[36096])):l&&xt(!1),y}_unattach(e){const i=this.attachments[e];i&&(i instanceof xc?this.gl.framebufferRenderbuffer(36160,e,36161,null):this.gl.framebufferTexture2D(36160,e,3553,null,0),delete this.attachments[e])}_attachRenderbuffer(e){let{attachment:i=36064,renderbuffer:l}=e;const{gl:u}=this;u.framebufferRenderbuffer(36160,i,36161,l.handle),this.attachments[i]=l}_attachTexture(e){let{attachment:i=36064,texture:l,layer:u,level:m}=e;const{gl:y}=this;switch(y.bindTexture(l.target,l.handle),l.target){case 35866:case 32879:Gr(y).framebufferTextureLayer(36160,i,l.target,m,u);break;case 34067:const a=DI(u);y.framebufferTexture2D(36160,i,a,l.handle,m);break;case 3553:y.framebufferTexture2D(36160,i,3553,l.handle,m);break;default:xt(!1,"Illegal texture type")}y.bindTexture(l.target,null),this.attachments[i]=l}_setReadBuffer(e){const i=hP(this.gl);i?i.readBuffer(e):xt(e===36064||e===1029,sx),this.readBuffer=e}_setDrawBuffers(e){const{gl:i}=this,l=Gr(i);if(l)l.drawBuffers(e);else{const u=i.getExtension("WEBGL_draw_buffers");u?u.drawBuffersWEBGL(e):xt(e.length===1&&(e[0]===36064||e[0]===1029),sx)}this.drawBuffers=e}_getAttachmentParameterFallback(e){const i=RI(this.gl);switch(e){case 36052:return i.WEBGL2?null:0;case 33298:case 33299:case 33300:case 33301:case 33302:case 33303:return i.WEBGL2?null:8;case 33297:return i.WEBGL2?null:5125;case 33296:return!i.WEBGL2&&!i.EXT_sRGB?9729:null;default:return null}}_createHandle(){return this.gl.createFramebuffer()}_deleteHandle(){this.gl.deleteFramebuffer(this.handle)}_bindHandle(e){return this.gl.bindFramebuffer(36160,e)}}function DI(r){return r<34069?r+34069:r}function zI(r){return(tr.STATUS||{})[r]||"Framebuffer error ".concat(r)}const BI=[36049,36048,33296,33298,33299,33300,33301,33302,33303];tr.ATTACHMENT_PARAMETERS=BI;function FI(r,e){xt(r instanceof In||r instanceof k1||r instanceof wI);const i=r.constructor,{gl:l,width:u,height:m,format:y,type:T,dataFormat:a,border:P,mipmaps:D}=r,N=Object.assign({width:u,height:m,format:y,type:T,dataFormat:a,border:P,mipmaps:D},e);return new i(l,N)}function NI(r,e){const{gl:i,width:l,height:u,id:m}=r;return new tr(i,Object.assign({},e,{id:"framebuffer-for-".concat(m),width:l,height:u,attachments:{36064:r}}))}function zd(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"unnamed";const i=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/,l=r.match(i);return l?l[1]:e}const UI=35632,jI=35633;function VI(r){switch(r){case UI:return"fragment";case jI:return"vertex";default:return"unknown type"}}function GI(r,e,i,l){const u=r.split(/\r?\n/),m={},y={},T=l||zd(e)||"(unnamed)",a="".concat(VI(i)," shader ").concat(T);for(let D=0;D<u.length;D++){const N=u[D];if(N.length<=1)continue;const F=N.split(":"),W=F[0],oe=parseInt(F[2],10);if(isNaN(oe))throw new Error("GLSL compilation error in ".concat(a,": ").concat(r));W!=="WARNING"?m[oe]=N:y[oe]=N}const P=ZI(e);return{shaderName:a,errors:ox(m,P),warnings:ox(y,P)}}function ox(r,e){let i="";for(let l=0;l<e.length;l++){const u=e[l];if(!(!r[l+3]&&!r[l+2]&&!r[l+1])&&(i+="".concat(u,`
`),r[l+1])){const m=r[l+1],y=m.split(":",3),T=y[0],a=parseInt(y[1],10)||0,P=m.substring(y.join(":").length+1).trim();i+=F1("^^^ ".concat(T,": ").concat(P,`

`),a)}}return i}function ZI(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:": ";const l=r.split(/\r?\n/),u=String(l.length+e-1).length;return l.map((m,y)=>{const T=String(y+e),a=T.length;return F1(T,u-a)+i+m})}function F1(r,e){let i="";for(let l=0;l<e;++l)i+=" ";return"".concat(i).concat(r)}function N1(r){let e=100;const i=r.match(/[^\s]+/g);if(i.length>=2&&i[0]==="#version"){const l=parseInt(i[1],10);Number.isFinite(l)&&(e=l)}return e}const $I="Shader: GLSL source code must be a JavaScript string";class Ah extends So{get[Symbol.toStringTag](){return"Shader"}static getTypeName(e){switch(e){case 35633:return"vertex-shader";case 35632:return"fragment-shader";default:return xt(!1),"unknown"}}constructor(e,i){lp(e),xt(typeof i.source=="string",$I);const l=zd(i.source,null)||i.id||ca("unnamed ".concat(Ah.getTypeName(i.shaderType)));super(e,{id:l}),this.shaderType=i.shaderType,this.source=i.source,this.initialize(i)}initialize(e){let{source:i}=e;const l=zd(i,null);l&&(this.id=ca(l)),this._compile(i)}getParameter(e){return this.gl.getShaderParameter(this.handle,e)}toString(){return"".concat(Ah.getTypeName(this.shaderType),":").concat(this.id)}getName(){return zd(this.source)||"unnamed-shader"}getSource(){return this.gl.getShaderSource(this.handle)}getTranslatedSource(){const e=this.gl.getExtension("WEBGL_debug_shaders");return e?e.getTranslatedShaderSource(this.handle):"No translated source available. WEBGL_debug_shaders not implemented"}_compile(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.source;if(e.startsWith("#version ")||(e=`#version 100
`.concat(e)),this.source=e,this.gl.shaderSource(this.handle,this.source),this.gl.compileShader(this.handle),!this.getParameter(35713)){const l=this.gl.getShaderInfoLog(this.handle),{shaderName:u,errors:m,warnings:y}=GI(l,this.source,this.shaderType,this.id);throw Ct.error("GLSL compilation errors in ".concat(u,`
`).concat(m))(),Ct.warn("GLSL compilation warnings in ".concat(u,`
`).concat(y))(),new Error("GLSL compilation errors in ".concat(u))}}_deleteHandle(){this.gl.deleteShader(this.handle)}_getOptsFromHandle(){return{type:this.getParameter(35663),source:this.getSource()}}}class Qm extends Ah{get[Symbol.toStringTag](){return"VertexShader"}constructor(e,i){typeof i=="string"&&(i={source:i}),super(e,Object.assign({},i,{shaderType:35633}))}_createHandle(){return this.gl.createShader(35633)}}class eg extends Ah{get[Symbol.toStringTag](){return"FragmentShader"}constructor(e,i){typeof i=="string"&&(i={source:i}),super(e,Object.assign({},i,{shaderType:35632}))}_createHandle(){return this.gl.createShader(35632)}}const WI={5126:Fi.bind(null,"uniform1fv",En,1,Vr),35664:Fi.bind(null,"uniform2fv",En,2,Vr),35665:Fi.bind(null,"uniform3fv",En,3,Vr),35666:Fi.bind(null,"uniform4fv",En,4,Vr),5124:Fi.bind(null,"uniform1iv",ra,1,Vr),35667:Fi.bind(null,"uniform2iv",ra,2,Vr),35668:Fi.bind(null,"uniform3iv",ra,3,Vr),35669:Fi.bind(null,"uniform4iv",ra,4,Vr),35670:Fi.bind(null,"uniform1iv",ra,1,Vr),35671:Fi.bind(null,"uniform2iv",ra,2,Vr),35672:Fi.bind(null,"uniform3iv",ra,3,Vr),35673:Fi.bind(null,"uniform4iv",ra,4,Vr),35674:Fi.bind(null,"uniformMatrix2fv",En,4,po),35675:Fi.bind(null,"uniformMatrix3fv",En,9,po),35676:Fi.bind(null,"uniformMatrix4fv",En,16,po),35678:Lr,35680:Lr,5125:Fi.bind(null,"uniform1uiv",vd,1,Vr),36294:Fi.bind(null,"uniform2uiv",vd,2,Vr),36295:Fi.bind(null,"uniform3uiv",vd,3,Vr),36296:Fi.bind(null,"uniform4uiv",vd,4,Vr),35685:Fi.bind(null,"uniformMatrix2x3fv",En,6,po),35686:Fi.bind(null,"uniformMatrix2x4fv",En,8,po),35687:Fi.bind(null,"uniformMatrix3x2fv",En,6,po),35688:Fi.bind(null,"uniformMatrix3x4fv",En,12,po),35689:Fi.bind(null,"uniformMatrix4x2fv",En,8,po),35690:Fi.bind(null,"uniformMatrix4x3fv",En,12,po),35678:Lr,35680:Lr,35679:Lr,35682:Lr,36289:Lr,36292:Lr,36293:Lr,36298:Lr,36299:Lr,36300:Lr,36303:Lr,36306:Lr,36307:Lr,36308:Lr,36311:Lr},qI={},XI={},HI={},ax=[0];function d_(r,e,i,l){e===1&&typeof r=="boolean"&&(r=r?1:0),Number.isFinite(r)&&(ax[0]=r,r=ax);const u=r.length;if(u%e&&Ct.warn("Uniform size should be multiples of ".concat(e),r)(),r instanceof i)return r;let m=l[u];m||(m=new i(u),l[u]=m);for(let y=0;y<u;y++)m[y]=r[y];return m}function En(r,e){return d_(r,e,Float32Array,qI)}function ra(r,e){return d_(r,e,Int32Array,XI)}function vd(r,e){return d_(r,e,Uint32Array,HI)}function lx(r,e,i){const l=WI[i.type];if(!l)throw new Error("Unknown GLSL uniform type ".concat(i.type));return l().bind(null,r,e)}function YI(r){if(r[r.length-1]!=="]")return{name:r,length:1,isArray:!1};const e=/([^[]*)(\[[0-9]+\])?/,i=r.match(e);if(!i||i.length<2)throw new Error("Failed to parse GLSL uniform name ".concat(r));return{name:i[1],length:i[2]||1,isArray:!!i[2]}}function KI(r,e,i){for(const l in r){const u=r[l];if((!i||!!i[l])&&!JI(u))throw e=e?"".concat(e," "):"",console.error("".concat(e," Bad uniform ").concat(l),u),new Error("".concat(e," Bad uniform ").concat(l))}return!0}function JI(r){return Array.isArray(r)||ArrayBuffer.isView(r)?eC(r):isFinite(r)||r===!0||r===!1||r instanceof cl||r instanceof xc?!0:r instanceof tr?!!r.texture:!1}function QI(r,e,i){if(Array.isArray(i)||ArrayBuffer.isView(i))if(r[e]){const l=r[e];for(let u=0,m=i.length;u<m;++u)l[u]=i[u]}else r[e]=i.slice();else r[e]=i}function eC(r){if(r.length===0)return!1;const e=Math.min(r.length,16);for(let i=0;i<e;++i)if(!Number.isFinite(r[i]))return!1;return!0}function Lr(){let r=null;return(e,i,l)=>{const u=r!==l;return u&&(e.uniform1i(i,l),r=l),u}}function Fi(r,e,i,l){let u=null,m=null;return(y,T,a)=>{const P=e(a,i),D=P.length;let N=!1;if(u===null)u=new Float32Array(D),m=D,N=!0;else{xt(m===D,"Uniform length cannot change.");for(let F=0;F<D;++F)if(P[F]!==u[F]){N=!0;break}}return N&&(l(y,r,T,P),u.set(P)),N}}function Vr(r,e,i,l){r[e](i,l)}function po(r,e,i,l){r[e](i,!1,l)}const tC=5120,iC=5121,rC=5122,nC=5123,cx=0,xd=1,sC=2,oC=3,bd=4,aC=5,lC=6,fr=5126,cC=35664,uC=35665,hC=35666,fh=5124,fC=35667,dC=35668,pC=35669,dh=5125,mC=36294,gC=36295,_C=36296,yC=35670,vC=35671,xC=35672,bC=35673,wC=35674,TC=35675,EC=35676,SC=35685,AC=35686,MC=35687,PC=35688,IC=35689,CC=35690,Rg={[fr]:[fr,1,"float"],[cC]:[fr,2,"vec2"],[uC]:[fr,3,"vec3"],[hC]:[fr,4,"vec4"],[fh]:[fh,1,"int"],[fC]:[fh,2,"ivec2"],[dC]:[fh,3,"ivec3"],[pC]:[fh,4,"ivec4"],[dh]:[dh,1,"uint"],[mC]:[dh,2,"uvec2"],[gC]:[dh,3,"uvec3"],[_C]:[dh,4,"uvec4"],[yC]:[fr,1,"bool"],[vC]:[fr,2,"bvec2"],[xC]:[fr,3,"bvec3"],[bC]:[fr,4,"bvec4"],[wC]:[fr,8,"mat2"],[SC]:[fr,8,"mat2x3"],[AC]:[fr,8,"mat2x4"],[TC]:[fr,12,"mat3"],[MC]:[fr,12,"mat3x2"],[PC]:[fr,12,"mat3x4"],[EC]:[fr,16,"mat4"],[IC]:[fr,16,"mat4x2"],[CC]:[fr,16,"mat4x3"]};function LC(r){switch(r){case cx:return cx;case xd:return xd;case oC:return xd;case sC:return xd;case bd:return bd;case aC:return bd;case lC:return bd;default:return xt(!1),0}}function ux(r){const e=Rg[r];if(!e)return null;const[i,l]=e;return{type:i,components:l}}function U1(r,e){switch(r){case tC:case iC:case rC:case nC:r=fr;break}for(const i in Rg){const[l,u,m]=Rg[i];if(l===r&&u===e)return{glType:i,name:m}}return null}class kC{constructor(e){this.id=e.id,this.attributeInfos=[],this.attributeInfosByName={},this.attributeInfosByLocation=[],this.varyingInfos=[],this.varyingInfosByName={},Object.seal(this),this._readAttributesFromProgram(e),this._readVaryingsFromProgram(e)}getAttributeInfo(e){const i=Number(e);return Number.isFinite(i)?this.attributeInfosByLocation[i]:this.attributeInfosByName[e]||null}getAttributeLocation(e){const i=this.getAttributeInfo(e);return i?i.location:-1}getAttributeAccessor(e){const i=this.getAttributeInfo(e);return i?i.accessor:null}getVaryingInfo(e){const i=Number(e);return Number.isFinite(i)?this.varyingInfos[i]:this.varyingInfosByName[e]||null}getVaryingIndex(e){const i=this.getVaryingInfo();return i?i.location:-1}getVaryingAccessor(e){const i=this.getVaryingInfo();return i?i.accessor:null}_readAttributesFromProgram(e){const{gl:i}=e,l=i.getProgramParameter(e.handle,35721);for(let u=0;u<l;u++){const{name:m,type:y,size:T}=i.getActiveAttrib(e.handle,u),a=i.getAttribLocation(e.handle,m);a>=0&&this._addAttribute(a,m,y,T)}this.attributeInfos.sort((u,m)=>u.location-m.location)}_readVaryingsFromProgram(e){const{gl:i}=e;if(!ai(i))return;const l=i.getProgramParameter(e.handle,35971);for(let u=0;u<l;u++){const{name:m,type:y,size:T}=i.getTransformFeedbackVarying(e.handle,u);this._addVarying(u,m,y,T)}this.varyingInfos.sort((u,m)=>u.location-m.location)}_addAttribute(e,i,l,u){const{type:m,components:y}=ux(l),T={type:m,size:u*y};this._inferProperties(e,i,T);const a={location:e,name:i,accessor:new Mn(T)};this.attributeInfos.push(a),this.attributeInfosByLocation[e]=a,this.attributeInfosByName[a.name]=a}_inferProperties(e,i,l){/instance/i.test(i)&&(l.divisor=1)}_addVarying(e,i,l,u){const{type:m,components:y}=ux(l),T=new Mn({type:m,size:u*y}),a={location:e,name:i,accessor:T};this.varyingInfos.push(a),this.varyingInfosByName[a.name]=a}}const hx=4,RC=35981,OC=["setVertexArray","setAttributes","setBuffers","unsetBuffers","use","getUniformCount","getUniformInfo","getUniformLocation","getUniformValue","getVarying","getFragDataLocation","getAttachedShaders","getAttributeCount","getAttributeLocation","getAttributeInfo"];class j1 extends So{get[Symbol.toStringTag](){return"Program"}constructor(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,i),this.stubRemovedMethods("Program","v6.0",OC),this._isCached=!1,this.initialize(i),Object.seal(this),this._setId(i.id)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{hash:i,vs:l,fs:u,varyings:m,bufferMode:y=RC}=e;return this.hash=i||"",this.vs=typeof l=="string"?new Qm(this.gl,{id:"".concat(e.id,"-vs"),source:l}):l,this.fs=typeof u=="string"?new eg(this.gl,{id:"".concat(e.id,"-fs"),source:u}):u,xt(this.vs instanceof Qm),xt(this.fs instanceof eg),this.uniforms={},this._textureUniforms={},m&&m.length>0&&(Gr(this.gl),this.varyings=m,this.gl2.transformFeedbackVaryings(this.handle,m,y)),this._compileAndLink(),this._readUniformLocationsFromLinkedProgram(),this.configuration=new kC(this),this.setProps(e)}delete(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isCached?this:super.delete(e)}setProps(e){return"uniforms"in e&&this.setUniforms(e.uniforms),this}draw(e){let{logPriority:i,drawMode:l=4,vertexCount:u,offset:m=0,start:y,end:T,isIndexed:a=!1,indexType:P=5123,instanceCount:D=0,isInstanced:N=D>0,vertexArray:F=null,transformFeedback:W,framebuffer:oe,parameters:me={},uniforms:fe,samplers:Ee}=e;if((fe||Ee)&&(Ct.deprecated("Program.draw({uniforms})","Program.setUniforms(uniforms)")(),this.setUniforms(fe||{})),Ct.priority>=i){const Ce=oe?oe.id:"default",ke="mode=".concat(la(this.gl,l)," verts=").concat(u," ")+"instances=".concat(D," indexType=").concat(la(this.gl,P)," ")+"isInstanced=".concat(N," isIndexed=").concat(a," ")+"Framebuffer=".concat(Ce);Ct.log(i,ke)()}return xt(F),this.gl.useProgram(this.handle),!this._areTexturesRenderable()||u===0||N&&D===0?!1:(F.bindForDraw(u,D,()=>{if(oe!==void 0&&(me=Object.assign({},me,{framebuffer:oe})),W){const Ce=LC(l);W.begin(Ce)}this._bindTextures(),Vn(this.gl,me,()=>{a&&N?this.gl2.drawElementsInstanced(l,u,P,m,D):a&&ai(this.gl)&&!isNaN(y)&&!isNaN(T)?this.gl2.drawRangeElements(l,y,T,u,P,m):a?this.gl.drawElements(l,u,P,m):N?this.gl2.drawArraysInstanced(l,m,u,D):this.gl.drawArrays(l,m,u)}),W&&W.end()}),!0)}setUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Ct.priority>=2&&KI(e,this.id,this._uniformSetters),this.gl.useProgram(this.handle);for(const i in e){const l=e[i],u=this._uniformSetters[i];if(u){let m=l,y=!1;if(m instanceof tr&&(m=m.texture),m instanceof cl)if(y=this.uniforms[i]!==l,y){u.textureIndex===void 0&&(u.textureIndex=this._textureIndexCounter++);const T=m,{textureIndex:a}=u;T.bind(a),m=a,this._textureUniforms[i]=T}else m=u.textureIndex;else this._textureUniforms[i]&&delete this._textureUniforms[i];(u(m)||y)&&QI(this.uniforms,i,l)}}return this}_areTexturesRenderable(){let e=!0;for(const i in this._textureUniforms){const l=this._textureUniforms[i];l.update(),e=e&&l.loaded}return e}_bindTextures(){for(const e in this._textureUniforms){const i=this._uniformSetters[e].textureIndex;this._textureUniforms[e].bind(i)}}_createHandle(){return this.gl.createProgram()}_deleteHandle(){this.gl.deleteProgram(this.handle)}_getOptionsFromHandle(e){const i=this.gl.getAttachedShaders(e),l={};for(const u of i)switch(this.gl.getShaderParameter(this.handle,35663)){case 35633:l.vs=new Qm({handle:u});break;case 35632:l.fs=new eg({handle:u});break}return l}_getParameter(e){return this.gl.getProgramParameter(this.handle,e)}_setId(e){if(!e){const i=this._getName();this.id=ca(i)}}_getName(){let e=this.vs.getName()||this.fs.getName();return e=e.replace(/shader/i,""),e=e?"".concat(e,"-program"):"program",e}_compileAndLink(){const{gl:e}=this;if(e.attachShader(this.handle,this.vs.handle),e.attachShader(this.handle,this.fs.handle),Ct.time(hx,"linkProgram for ".concat(this._getName()))(),e.linkProgram(this.handle),Ct.timeEnd(hx,"linkProgram for ".concat(this._getName()))(),e.debug||Ct.level>0){if(!e.getProgramParameter(this.handle,35714))throw new Error("Error linking: ".concat(e.getProgramInfoLog(this.handle)));if(e.validateProgram(this.handle),!e.getProgramParameter(this.handle,35715))throw new Error("Error validating: ".concat(e.getProgramInfoLog(this.handle)))}}_readUniformLocationsFromLinkedProgram(){const{gl:e}=this;this._uniformSetters={},this._uniformCount=this._getParameter(35718);for(let i=0;i<this._uniformCount;i++){const l=this.gl.getActiveUniform(this.handle,i),{name:u}=YI(l.name);let m=e.getUniformLocation(this.handle,u);if(this._uniformSetters[u]=lx(e,m,l),l.size>1)for(let y=0;y<l.size;y++)m=e.getUniformLocation(this.handle,"".concat(u,"[").concat(y,"]")),this._uniformSetters["".concat(u,"[").concat(y,"]")]=lx(e,m,l)}this._textureIndexCounter=0}getActiveUniforms(e,i){return this.gl2.getActiveUniforms(this.handle,e,i)}getUniformBlockIndex(e){return this.gl2.getUniformBlockIndex(this.handle,e)}getActiveUniformBlockParameter(e,i){return this.gl2.getActiveUniformBlockParameter(this.handle,e,i)}uniformBlockBinding(e,i){this.gl2.uniformBlockBinding(this.handle,e,i)}}const DC=34918,zC=34919,BC=35007,FC=36795,NC=35976,UC=35887,jC=36202;class Wd extends So{get[Symbol.toStringTag](){return"Query"}static isSupported(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];const l=ai(e),u=z1(e,Vi.TIMER_QUERY);let m=l||u;for(const y of i)switch(y){case"queries":m=m&&l;break;case"timers":m=m&&u;break;default:xt(!1)}return m}constructor(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,i),this.target=null,this._queryPending=!1,this._pollingPromise=null,Object.seal(this)}beginTimeElapsedQuery(){return this.begin(BC)}beginOcclusionQuery(){let{conservative:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.begin(e?jC:UC)}beginTransformFeedbackQuery(){return this.begin(NC)}begin(e){return this._queryPending?this:(this.target=e,this.gl2.beginQuery(this.target,this.handle),this)}end(){return this._queryPending?this:(this.target&&(this.gl2.endQuery(this.target),this.target=null,this._queryPending=!0),this)}isResultAvailable(){if(!this._queryPending)return!1;const e=this.gl2.getQueryParameter(this.handle,zC);return e&&(this._queryPending=!1),e}isTimerDisjoint(){return this.gl2.getParameter(FC)}getResult(){return this.gl2.getQueryParameter(this.handle,DC)}getTimerMilliseconds(){return this.getResult()/1e6}createPoll(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Number.POSITIVE_INFINITY;if(this._pollingPromise)return this._pollingPromise;let i=0;return this._pollingPromise=new Promise((l,u)=>{const m=()=>{this.isResultAvailable()?(l(this.getResult()),this._pollingPromise=null):i++>e?(u("Timed out"),this._pollingPromise=null):requestAnimationFrame(m)};requestAnimationFrame(m)}),this._pollingPromise}_createHandle(){return Wd.isSupported(this.gl)?this.gl2.createQuery():null}_deleteHandle(){this.gl2.deleteQuery(this.handle)}}class V1 extends So{get[Symbol.toStringTag](){return"TransformFeedback"}static isSupported(e){return ai(e)}constructor(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Gr(e),super(e,i),this.initialize(i),this.stubRemovedMethods("TransformFeedback","v6.0",["pause","resume"]),Object.seal(this)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.buffers={},this.unused={},this.configuration=null,this.bindOnUse=!0,Pc(this.buffers)||this.bind(()=>this._unbindBuffers()),this.setProps(e),this}setProps(e){"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"bindOnUse"in e&&(e=e.bindOnUse),"buffers"in e&&this.setBuffers(e.buffers)}setBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.bind(()=>{for(const i in e)this.setBuffer(i,e[i])}),this}setBuffer(e,i){const l=this._getVaryingIndex(e),{buffer:u,byteSize:m,byteOffset:y}=this._getBufferParams(i);return l<0?(this.unused[e]=u,Ct.warn("".concat(this.id," unused varying buffer ").concat(e))(),this):(this.buffers[l]=i,this.bindOnUse||this._bindBuffer(l,u,y,m),this)}begin(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return this.gl.bindTransformFeedback(36386,this.handle),this._bindBuffers(),this.gl.beginTransformFeedback(e),this}end(){return this.gl.endTransformFeedback(),this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null),this}_getBufferParams(e){let i,l,u;return e instanceof Oi?u=e:(u=e.buffer,l=e.byteSize,i=e.byteOffset),(i!==void 0||l!==void 0)&&(i=i||0,l=l||u.byteLength-i),{buffer:u,byteOffset:i,byteSize:l}}_getVaryingInfo(e){return this.configuration&&this.configuration.getVaryingInfo(e)}_getVaryingIndex(e){if(this.configuration)return this.configuration.getVaryingInfo(e).location;const i=Number(e);return Number.isFinite(i)?i:-1}_bindBuffers(){if(this.bindOnUse)for(const e in this.buffers){const{buffer:i,byteSize:l,byteOffset:u}=this._getBufferParams(this.buffers[e]);this._bindBuffer(e,i,u,l)}}_unbindBuffers(){if(this.bindOnUse)for(const e in this.buffers)this._bindBuffer(e,null)}_bindBuffer(e,i){let l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,u=arguments.length>3?arguments[3]:void 0;const m=i&&i.handle;return!m||u===void 0?this.gl.bindBufferBase(35982,e,m):this.gl.bindBufferRange(35982,e,m,l,u),this}_createHandle(){return this.gl.createTransformFeedback()}_deleteHandle(){this.gl.deleteTransformFeedback(this.handle)}_bindHandle(e){this.gl.bindTransformFeedback(36386,this.handle)}}let wd=null;function VC(r){return(!wd||wd.byteLength<r)&&(wd=new ArrayBuffer(r)),wd}function GC(r,e){const i=VC(r.BYTES_PER_ELEMENT*e);return new r(i,0,e)}function ZC(r){let{target:e,source:i,start:l=0,count:u=1}=r;const m=i.length,y=u*m;let T=0;for(let a=l;T<m;T++)e[a++]=i[T];for(;T<y;)T<y-T?(e.copyWithin(l+T,l,l+T),T*=2):(e.copyWithin(l+T,l,l+y-T),T=y);return e}const $C="elements must be GL.ELEMENT_ARRAY_BUFFER";class Sn extends So{get[Symbol.toStringTag](){return"VertexArrayObject"}static isSupported(e){return(arguments.length>1&&arguments[1]!==void 0?arguments[1]:{}).constantAttributeZero?ai(e)||a1()==="Chrome":!0}static getDefaultArray(e){return e.luma=e.luma||{},e.luma.defaultVertexArray||(e.luma.defaultVertexArray=new Sn(e,{handle:null,isDefaultArray:!0})),e.luma.defaultVertexArray}static getMaxAttributes(e){return Sn.MAX_ATTRIBUTES=Sn.MAX_ATTRIBUTES||e.getParameter(34921),Sn.MAX_ATTRIBUTES}static setConstant(e,i,l){switch(l.constructor){case Float32Array:Sn._setConstantFloatArray(e,i,l);break;case Int32Array:Sn._setConstantIntArray(e,i,l);break;case Uint32Array:Sn._setConstantUintArray(e,i,l);break;default:xt(!1)}}constructor(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const l=i.id||i.program&&i.program.id;super(e,Object.assign({},i,{id:l})),this.buffer=null,this.bufferValue=null,this.isDefaultArray=i.isDefaultArray||!1,this.gl2=e,this.initialize(i),Object.seal(this)}delete(){return super.delete(),this.buffer&&this.buffer.delete(),this}get MAX_ATTRIBUTES(){return Sn.getMaxAttributes(this.gl)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.setProps(e)}setProps(e){return this}setElementBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return xt(!e||e.target===34963,$C),this.bind(()=>{this.gl.bindBuffer(34963,e?e.handle:null)}),this}setBuffer(e,i,l){if(i.target===34963)return this.setElementBuffer(i,l);const{size:u,type:m,stride:y,offset:T,normalized:a,integer:P,divisor:D}=l,{gl:N,gl2:F}=this;return e=Number(e),this.bind(()=>{N.bindBuffer(34962,i.handle),P?(xt(ai(N)),F.vertexAttribIPointer(e,u,m,y,T)):N.vertexAttribPointer(e,u,m,a,y,T),N.enableVertexAttribArray(e),F.vertexAttribDivisor(e,D||0)}),this}enable(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return!i&&e===0&&!Sn.isSupported(this.gl,{constantAttributeZero:!0})||(e=Number(e),this.bind(()=>i?this.gl.enableVertexAttribArray(e):this.gl.disableVertexAttribArray(e))),this}getConstantBuffer(e,i){const l=this._normalizeConstantArrayValue(i),u=l.byteLength*e,m=l.length*e;let y=!this.buffer;if(this.buffer=this.buffer||new Oi(this.gl,u),y=y||this.buffer.reallocate(u),y=y||!this._compareConstantArrayValues(l,this.bufferValue),y){const T=GC(i.constructor,m);ZC({target:T,source:l,start:0,count:m}),this.buffer.subData(T),this.bufferValue=i}return this.buffer}_normalizeConstantArrayValue(e){return Array.isArray(e)?new Float32Array(e):e}_compareConstantArrayValues(e,i){if(!e||!i||e.length!==i.length||e.constructor!==i.constructor)return!1;for(let l=0;l<e.length;++l)if(e[l]!==i[l])return!1;return!0}static _setConstantFloatArray(e,i,l){switch(l.length){case 1:e.vertexAttrib1fv(i,l);break;case 2:e.vertexAttrib2fv(i,l);break;case 3:e.vertexAttrib3fv(i,l);break;case 4:e.vertexAttrib4fv(i,l);break;default:xt(!1)}}static _setConstantIntArray(e,i,l){switch(xt(ai(e)),l.length){case 1:e.vertexAttribI1iv(i,l);break;case 2:e.vertexAttribI2iv(i,l);break;case 3:e.vertexAttribI3iv(i,l);break;case 4:e.vertexAttribI4iv(i,l);break;default:xt(!1)}}static _setConstantUintArray(e,i,l){switch(xt(ai(e)),l.length){case 1:e.vertexAttribI1uiv(i,l);break;case 2:e.vertexAttribI2uiv(i,l);break;case 3:e.vertexAttribI3uiv(i,l);break;case 4:e.vertexAttribI4uiv(i,l);break;default:xt(!1)}}_createHandle(){return this.gl.createVertexArray()}_deleteHandle(e){return this.gl2.deleteVertexArray(e),[this.elements]}_bindHandle(e){this.gl2.bindVertexArray(e)}_getParameter(e,i){let{location:l}=i;return xt(Number.isFinite(l)),this.bind(()=>{switch(e){case 34373:return this.gl.getVertexAttribOffset(l,e);default:return this.gl.getVertexAttrib(l,e)}})}}const WC="VertexArray: attributes must be Buffers or constants (i.e. typed array)",qC=/^(.+)__LOCATION_([0-9]+)$/,XC=["setBuffers","setGeneric","clearBindings","setLocations","setGenericValues","setDivisor","enable","disable"];class HC{constructor(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const l=i.id||i.program&&i.program.id;this.id=l,this.gl=e,this.configuration=null,this.elements=null,this.elementsAccessor=null,this.values=null,this.accessors=null,this.unused=null,this.drawParams=null,this.buffer=null,this.attributes={},this.vertexArrayObject=new Sn(e),P1(this,"VertexArray","v6.0",XC),this.initialize(i),Object.seal(this)}delete(){this.buffer&&this.buffer.delete(),this.vertexArrayObject.delete()}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.reset(),this.configuration=null,this.bindOnUse=!1,this.setProps(e)}reset(){this.elements=null,this.elementsAccessor=null;const{MAX_ATTRIBUTES:e}=this.vertexArrayObject;return this.values=new Array(e).fill(null),this.accessors=new Array(e).fill(null),this.unused={},this.drawParams=null,this}setProps(e){return"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"attributes"in e&&this.setAttributes(e.attributes),"elements"in e&&this.setElementBuffer(e.elements),"bindOnUse"in e&&(e=e.bindOnUse),this}clearDrawParams(){this.drawParams=null}getDrawParams(){return this.drawParams=this.drawParams||this._updateDrawParams(),this.drawParams}setAttributes(e){return Object.assign(this.attributes,e),this.vertexArrayObject.bind(()=>{for(const i in e){const l=e[i];this._setAttribute(i,l)}this.gl.bindBuffer(34962,null)}),this}setElementBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.elements=e,this.elementsAccessor=i,this.clearDrawParams(),this.vertexArrayObject.setElementBuffer(e,i),this}setBuffer(e,i){let l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(i.target===34963)return this.setElementBuffer(i,l);const{location:u,accessor:m}=this._resolveLocationAndAccessor(e,i,i.accessor,l);return u>=0&&(this.values[u]=i,this.accessors[u]=m,this.clearDrawParams(),this.vertexArrayObject.setBuffer(u,i,m)),this}setConstant(e,i){let l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{location:u,accessor:m}=this._resolveLocationAndAccessor(e,i,Object.assign({size:i.length},l));return u>=0&&(i=this.vertexArrayObject._normalizeConstantArrayValue(i),this.values[u]=i,this.accessors[u]=m,this.clearDrawParams(),this.vertexArrayObject.enable(u,!1)),this}unbindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.vertexArrayObject.setElementBuffer(null),this.buffer=this.buffer||new Oi(this.gl,{accessor:{size:4}});for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++)this.values[e]instanceof Oi&&(this.gl.disableVertexAttribArray(e),this.gl.bindBuffer(34962,this.buffer.handle),this.gl.vertexAttribPointer(e,1,5126,!1,0,0))}),this}bindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.setElementBuffer(this.elements);for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++){const i=this.values[e];i instanceof Oi&&this.setBuffer(e,i)}}),this}bindForDraw(e,i,l){let u;return this.vertexArrayObject.bind(()=>{this._setConstantAttributes(e,i),u=l()}),u}_resolveLocationAndAccessor(e,i,l,u){const m={location:-1,accessor:null},{location:y,name:T}=this._getAttributeIndex(e);if(!Number.isFinite(y)||y<0)return this.unused[e]=i,Ct.once(3,()=>"unused value ".concat(e," in ").concat(this.id))(),m;const a=this._getAttributeInfo(T||y);if(!a)return m;const P=this.accessors[y]||{},D=Mn.resolve(a.accessor,P,l,u),{size:N,type:F}=D;return xt(Number.isFinite(N)&&Number.isFinite(F)),{location:y,accessor:D}}_getAttributeInfo(e){return this.configuration&&this.configuration.getAttributeInfo(e)}_getAttributeIndex(e){const i=Number(e);if(Number.isFinite(i))return{location:i};const l=qC.exec(e),u=l?l[1]:e,m=l?Number(l[2]):0;return this.configuration?{location:this.configuration.getAttributeLocation(u)+m,name:u}:{location:-1}}_setAttribute(e,i){if(i instanceof Oi)this.setBuffer(e,i);else if(Array.isArray(i)&&i.length&&i[0]instanceof Oi){const l=i[0],u=i[1];this.setBuffer(e,l,u)}else if(ArrayBuffer.isView(i)||Array.isArray(i)){const l=i;this.setConstant(e,l)}else if(i.buffer instanceof Oi){const l=i;this.setBuffer(e,l.buffer,l)}else throw new Error(WC)}_setConstantAttributes(e,i){const l=Math.max(e|0,i|0);let u=this.values[0];ArrayBuffer.isView(u)&&this._setConstantAttributeZero(u,l);for(let m=1;m<this.vertexArrayObject.MAX_ATTRIBUTES;m++)u=this.values[m],ArrayBuffer.isView(u)&&this._setConstantAttribute(m,u)}_setConstantAttributeZero(e,i){if(Sn.isSupported(this.gl,{constantAttributeZero:!0})){this._setConstantAttribute(0,e);return}const l=this.vertexArrayObject.getConstantBuffer(i,e);this.vertexArrayObject.setBuffer(0,l,this.accessors[0])}_setConstantAttribute(e,i){Sn.setConstant(this.gl,e,i)}_updateDrawParams(){const e={isIndexed:!1,isInstanced:!1,indexCount:1/0,vertexCount:1/0,instanceCount:1/0};for(let i=0;i<this.vertexArrayObject.MAX_ATTRIBUTES;i++)this._updateDrawParamsForLocation(e,i);return this.elements&&(e.elementCount=this.elements.getElementCount(this.elements.accessor),e.isIndexed=!0,e.indexType=this.elementsAccessor.type||this.elements.accessor.type,e.indexOffset=this.elementsAccessor.offset||0),e.indexCount===1/0&&(e.indexCount=0),e.vertexCount===1/0&&(e.vertexCount=0),e.instanceCount===1/0&&(e.instanceCount=0),e}_updateDrawParamsForLocation(e,i){const l=this.values[i],u=this.accessors[i];if(!l)return;const{divisor:m}=u,y=m>0;if(e.isInstanced=e.isInstanced||y,l instanceof Oi){const T=l;if(y){const a=T.getVertexCount(u);e.instanceCount=Math.min(e.instanceCount,a)}else{const a=T.getVertexCount(u);e.vertexCount=Math.min(e.vertexCount,a)}}}setElements(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Ct.deprecated("setElements","setElementBuffer")(),this.setElementBuffer(e,i)}}function YC(r,e){const{maxElts:i=16,size:l=1}=e;let u="[";for(let y=0;y<r.length&&y<i;++y)y>0&&(u+=",".concat(y%l===0?" ":"")),u+=Mh(r[y],e);const m=r.length>i?"...":"]";return"".concat(u).concat(m)}function Mh(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=1e-16,{isInteger:l=!1}=e;if(Array.isArray(r)||ArrayBuffer.isView(r))return YC(r,e);if(!Number.isFinite(r))return String(r);if(Math.abs(r)<i)return l?"0":"0.";if(l||Math.abs(r)>100&&Math.abs(r)<1e4)return r.toFixed(0);const u=r.toPrecision(2);return u.indexOf(".0")===u.length-2?u.slice(0,-1):u}function fx(r){let{header:e="Uniforms",program:i,uniforms:l,undefinedOnly:u=!1}=r;xt(i);const m=".*_.*",y=".*Matrix",T=i._uniformSetters,a={},P=Object.keys(T).sort();let D=0;for(const W of P)!W.match(m)&&!W.match(y)&&tg({table:a,header:e,uniforms:l,uniformName:W,undefinedOnly:u})&&D++;for(const W of P)W.match(y)&&tg({table:a,header:e,uniforms:l,uniformName:W,undefinedOnly:u})&&D++;for(const W of P)a[W]||tg({table:a,header:e,uniforms:l,uniformName:W,undefinedOnly:u})&&D++;let N=0;const F={};if(!u)for(const W in l){const oe=l[W];a[W]||(N++,F[W]={Type:"NOT USED: ".concat(oe),[e]:Mh(oe)})}return{table:a,count:D,unusedTable:F,unusedCount:N}}function tg(r){let{table:e,header:i,uniforms:l,uniformName:u,undefinedOnly:m}=r;const y=l[u],T=KC(y);return!m||!T?(e[u]={[i]:T?Mh(y):"N/A","Uniform Type":T?y:"NOT PROVIDED"},!0):!1}function KC(r){return r!=null}function JC(r){let{vertexArray:e,header:i="Attributes"}=r;if(!e.configuration)return{};const l={};e.elements&&(l.ELEMENT_ARRAY_BUFFER=dx(e,e.elements,null,i));const u=e.values;for(const m in u){const y=e._getAttributeInfo(m);if(y){let T="".concat(m,": ").concat(y.name);const a=e.accessors[y.location];a&&(T="".concat(m,": ").concat(QC(y.name,a))),l[T]=dx(e,u[m],a,i)}}return l}function dx(r,e,i,l){const{gl:u}=r;if(!e)return{[l]:"null","Format ":"N/A"};let m="NOT PROVIDED",y=1,T=0,a=0,P,D,N;if(i&&(m=i.type,y=i.size,m=String(m).replace("Array",""),P=m.indexOf("nt")!==-1),e instanceof Oi){const F=e,{data:W,changed:oe}=F.getDebugData();D=oe?"*":"",N=W,a=F.byteLength,T=a/W.BYTES_PER_ELEMENT/y;let me;if(i){const fe=i.divisor>0;me="".concat(fe?"I ":"P "," ").concat(T," (x").concat(y,"=").concat(a," bytes ").concat(la(u,m),")")}else P=!0,me="".concat(a," bytes");return{[l]:"".concat(D).concat(Mh(N,{size:y,isInteger:P})),"Format ":me}}return N=e,y=e.length,m=String(e.constructor.name).replace("Array",""),P=m.indexOf("nt")!==-1,{[l]:"".concat(Mh(N,{size:y,isInteger:P})," (constant)"),"Format ":"".concat(y,"x").concat(m," (constant)")}}function QC(r,e){const{type:i,size:l}=e,u=U1(i,l);return u?"".concat(r," (").concat(u.name,")"):r}function eL(r){const e={},i="Accessors for ".concat(r.id);for(const l of r.attributeInfos)if(l){const u=px(l);e["in ".concat(u)]={[i]:JSON.stringify(l.accessor)}}for(const l of r.varyingInfos)if(l){const u=px(l);e["out ".concat(u)]={[i]:JSON.stringify(l.accessor)}}return e}function px(r){const{type:e,size:i}=r.accessor,l=U1(e,i);return l?"".concat(l.name," ").concat(r.name):r.name}const mx=Eo()&&typeof document<"u";let tL=0;class iL{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{onCreateContext:i=fe=>M1(fe),onAddHTML:l=null,onInitialize:u=()=>{},onRender:m=()=>{},onFinalize:y=()=>{},onError:T,gl:a=null,glOptions:P={},debug:D=!1,createFramebuffer:N=!1,autoResizeViewport:F=!0,autoResizeDrawingBuffer:W=!0,stats:oe=ol.get("animation-loop-".concat(tL++))}=e;let{useDevicePixels:me=!0}=e;"useDevicePixelRatio"in e&&(Ct.deprecated("useDevicePixelRatio","useDevicePixels")(),me=e.useDevicePixelRatio),this.props={onCreateContext:i,onAddHTML:l,onInitialize:u,onRender:m,onFinalize:y,onError:T,gl:a,glOptions:P,debug:D,createFramebuffer:N},this.gl=a,this.needsRedraw=null,this.timeline=null,this.stats=oe,this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this._initialized=!1,this._running=!1,this._animationFrameId=null,this._nextFramePromise=null,this._resolveNextFrame=null,this._cpuStartTime=0,this.setProps({autoResizeViewport:F,autoResizeDrawingBuffer:W,useDevicePixels:me}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._pageLoadPromise=null,this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}delete(){this.stop(),this._setDisplay(null)}setNeedsRedraw(e){return xt(typeof e=="string"),this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.autoResizeViewport=e.autoResizeViewport),"autoResizeDrawingBuffer"in e&&(this.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer),"useDevicePixels"in e&&(this.useDevicePixels=e.useDevicePixels),this}start(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(this._running)return this;this._running=!0;const i=this._getPageLoadPromise().then(()=>!this._running||this._initialized?null:(this._createWebGLContext(e),this._createFramebuffer(),this._startEventHandling(),this._initializeCallbackData(),this._updateCallbackData(),this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._gpuTimeQuery=Wd.isSupported(this.gl,["timers"])?new Wd(this.gl):null,this._initialized=!0,this.onInitialize(this.animationProps))).then(l=>{this._running&&(this._addCallbackData(l||{}),l!==!1&&this._startLoop())});return this.props.onError&&i.catch(this.props.onError),this}redraw(){return this.isContextLost()?this:(this._beginTimers(),this._setupFrame(),this._updateCallbackData(),this._renderFrame(this.animationProps),this._clearNeedsRedraw(),this.offScreen&&this.gl.commit&&this.gl.commit(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endTimers(),this)}stop(){return this._running&&(this._finalizeCallbackData(),this._cancelAnimationFrame(this._animationFrameId),this._nextFramePromise=null,this._resolveNextFrame=null,this._animationFrameId=null,this._running=!1),this}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){return this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.gl.canvas.toDataURL()}isContextLost(){return this.gl.isContextLost()}onCreateContext(){return this.props.onCreateContext(...arguments)}onInitialize(){return this.props.onInitialize(...arguments)}onRender(){return this.props.onRender(...arguments)}onFinalize(){return this.props.onFinalize(...arguments)}getHTMLControlValue(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const l=document.getElementById(e);return l?Number(l.value):i}setViewParameters(){return Ct.removed("AnimationLoop.setViewParameters","AnimationLoop.setProps")(),this}_startLoop(){const e=()=>{this._running&&(this.redraw(),this._animationFrameId=this._requestAnimationFrame(e))};this._cancelAnimationFrame(this._animationFrameId),this._animationFrameId=this._requestAnimationFrame(e)}_getPageLoadPromise(){return this._pageLoadPromise||(this._pageLoadPromise=mx?new Promise((e,i)=>{if(mx&&document.readyState==="complete"){e(document);return}window.addEventListener("load",()=>{e(document)})}):Promise.resolve({})),this._pageLoadPromise}_setDisplay(e){this.display&&(this.display.delete(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_cancelAnimationFrame(e){return this.display&&this.display.cancelAnimationFrame?this.display.cancelAnimationFrame(e):cI(e)}_requestAnimationFrame(e){if(this._running)return this.display&&this.display.requestAnimationFrame?this.display.requestAnimationFrame(e):lI(e)}_renderFrame(){if(this.display){this.display._renderFrame(...arguments);return}this.onRender(...arguments)}_clearNeedsRedraw(){this.needsRedraw=null}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._resizeFramebuffer()}_initializeCallbackData(){this.animationProps={gl:this.gl,stop:this.stop,canvas:this.gl.canvas,framebuffer:this.framebuffer,useDevicePixels:this.useDevicePixels,needsRedraw:null,startTime:Date.now(),engineTime:0,tick:0,tock:0,time:0,_timeline:this.timeline,_loop:this,_animationLoop:this,_mousePosition:null}}_updateCallbackData(){const{width:e,height:i,aspect:l}=this._getSizeAndAspect();(e!==this.animationProps.width||i!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),l!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=i,this.animationProps.aspect=l,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime,this.animationProps._offScreen=this.offScreen}_finalizeCallbackData(){this.onFinalize(this.animationProps)}_addCallbackData(e){typeof e=="object"&&e!==null&&(this.animationProps=Object.assign({},this.animationProps,e))}_createWebGLContext(e){if(this.offScreen=e.canvas&&typeof OffscreenCanvas<"u"&&e.canvas instanceof OffscreenCanvas,e=Object.assign({},e,this.props.glOptions),this.gl=this.props.gl?u_(this.props.gl,e):this.onCreateContext(e),!ap(this.gl))throw new Error("AnimationLoop.onCreateContext - illegal context returned");HP(this.gl),this._createInfoDiv()}_createInfoDiv(){if(this.gl.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const i=document.createElement("div");i.style.position="absolute",i.style.left="10px",i.style.bottom="10px",i.style.width="300px",i.style.background="white",e.appendChild(this.gl.canvas),e.appendChild(i);const l=this.props.onAddHTML(i);l&&(i.innerHTML=l)}}_getSizeAndAspect(){const e=this.gl.drawingBufferWidth,i=this.gl.drawingBufferHeight;let l=1;const{canvas:u}=this.gl;return u&&u.clientHeight?l=u.clientWidth/u.clientHeight:e>0&&i>0&&(l=e/i),{width:e,height:i,aspect:l}}_resizeViewport(){this.autoResizeViewport&&this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){this.autoResizeDrawingBuffer&&eI(this.gl,{useDevicePixels:this.useDevicePixels})}_createFramebuffer(){this.props.createFramebuffer&&(this.framebuffer=new tr(this.gl))}_resizeFramebuffer(){this.framebuffer&&this.framebuffer.resize({width:this.gl.drawingBufferWidth,height:this.gl.drawingBufferHeight})}_beginTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this._gpuTimeQuery&&this._gpuTimeQuery.isResultAvailable()&&!this._gpuTimeQuery.isTimerDisjoint()&&this.stats.get("GPU Time").addTime(this._gpuTimeQuery.getTimerMilliseconds()),this._gpuTimeQuery&&this._gpuTimeQuery.beginTimeElapsedQuery(),this.cpuTime.timeStart()}_endTimers(){this.cpuTime.timeEnd(),this._gpuTimeQuery&&this._gpuTimeQuery.end()}_startEventHandling(){const{canvas:e}=this.gl;e&&(e.addEventListener("mousemove",this._onMousemove),e.addEventListener("mouseleave",this._onMouseleave))}_onMousemove(e){this.animationProps._mousePosition=[e.offsetX,e.offsetY]}_onMouseleave(e){this.animationProps._mousePosition=null}}const Fh="vs",p_="fs";function Pn(r,e){if(!r)throw new Error(e||"shadertools: assertion failed.")}const ig={number:{validate(r,e){return Number.isFinite(r)&&(!("max"in e)||r<=e.max)&&(!("min"in e)||r>=e.min)}},array:{validate(r,e){return Array.isArray(r)||ArrayBuffer.isView(r)}}};function rL(r){const e={};for(const i in r){const l=r[i],u=nL(l);e[i]=u}return e}function nL(r){let e=gx(r);return e==="object"?r?"type"in r?Object.assign({},r,ig[r.type]):"value"in r?(e=gx(r.value),Object.assign({type:e},r,ig[e])):{type:"object",value:r}:{type:"object",value:null}:Object.assign({type:e,value:r},ig[e])}function gx(r){return Array.isArray(r)||ArrayBuffer.isView(r)?"array":typeof r}const sL="vs",oL="fs";class _x{constructor(e){let{name:i,vs:l,fs:u,dependencies:m=[],uniforms:y,getUniforms:T,deprecations:a=[],defines:P={},inject:D={},vertexShader:N,fragmentShader:F}=e;Pn(typeof i=="string"),this.name=i,this.vs=l||N,this.fs=u||F,this.getModuleUniforms=T,this.dependencies=m,this.deprecations=this._parseDeprecationDefinitions(a),this.defines=P,this.injections=aL(D),y&&(this.uniforms=rL(y))}getModuleSource(e){let i;switch(e){case sL:i=this.vs||"";break;case oL:i=this.fs||"";break;default:Pn(!1)}return"#define MODULE_".concat(this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_"),`
`).concat(i,"// END MODULE_").concat(this.name,`

`)}getUniforms(e,i){return this.getModuleUniforms?this.getModuleUniforms(e,i):this.uniforms?this._defaultGetUniforms(e):{}}getDefines(){return this.defines}checkDeprecations(e,i){this.deprecations.forEach(l=>{l.regex.test(e)&&(l.deprecated?i.deprecated(l.old,l.new)():i.removed(l.old,l.new)())})}_parseDeprecationDefinitions(e){return e.forEach(i=>{switch(i.type){case"function":i.regex=new RegExp("\\b".concat(i.old,"\\("));break;default:i.regex=new RegExp("".concat(i.type," ").concat(i.old,";"))}}),e}_defaultGetUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const i={},l=this.uniforms;for(const u in l){const m=l[u];u in e&&!m.private?(m.validate&&Pn(m.validate(e[u],m),"".concat(this.name,": invalid ").concat(u)),i[u]=e[u]):i[u]=m.value}return i}}function aL(r){const e={vs:{},fs:{}};for(const i in r){let l=r[i];const u=i.slice(0,2);typeof l=="string"&&(l={order:0,injection:l}),e[u][i]=l}return e}function lL(r){return cL(Z1(r))}function cL(r){const e={},i={};return G1({modules:r,level:0,moduleMap:e,moduleDepth:i}),Object.keys(i).sort((l,u)=>i[u]-i[l]).map(l=>e[l])}function G1(r){let{modules:e,level:i,moduleMap:l,moduleDepth:u}=r;if(i>=5)throw new Error("Possible loop in shader dependency graph");for(const m of e)l[m.name]=m,(u[m.name]===void 0||u[m.name]<i)&&(u[m.name]=i);for(const m of e)m.dependencies&&G1({modules:m.dependencies,level:i+1,moduleMap:l,moduleDepth:u})}function Z1(r,e){return r.map(i=>(i instanceof _x||(Pn(typeof i!="string","Shader module use by name is deprecated. Import shader module '".concat(i,"' and use it directly.")),Pn(i.name,"shader module has no name"),i=new _x(i),i.dependencies=Z1(i.dependencies)),i))}function uL(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=typeof window<"u"?window.navigator||{}:{},i=r.userAgent||e.userAgent||"",l=i.indexOf("MSIE ")!==-1,u=i.indexOf("Trident/")!==-1;return l||u}const hL=7936,fL=7937,dL=7938,pL=35724,m_={GLSL_FRAG_DATA:["WEBGL_draw_buffers",!0],GLSL_FRAG_DEPTH:["EXT_frag_depth",!0],GLSL_DERIVATIVES:["OES_standard_derivatives",!0],GLSL_TEXTURE_LOD:["EXT_shader_texture_lod",!0]},sl={};Object.keys(m_).forEach(r=>{sl[r]=r});function mL(r){return typeof WebGL2RenderingContext<"u"&&r instanceof WebGL2RenderingContext?!0:!!(r&&r._version===2)}function gL(r){const e=r.getExtension("WEBGL_debug_renderer_info"),i=r.getParameter(e&&e.UNMASKED_VENDOR_WEBGL||hL),l=r.getParameter(e&&e.UNMASKED_RENDERER_WEBGL||fL);return{gpuVendor:_L(i,l),vendor:i,renderer:l,version:r.getParameter(dL),shadingLanguageVersion:r.getParameter(pL)}}function _L(r,e){return r.match(/NVIDIA/i)||e.match(/NVIDIA/i)?"NVIDIA":r.match(/INTEL/i)||e.match(/INTEL/i)?"INTEL":r.match(/AMD/i)||e.match(/AMD/i)||r.match(/ATI/i)||e.match(/ATI/i)?"AMD":"UNKNOWN GPU"}const rg={};function yx(r,e){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const l=m_[e];if(Pn(l,e),!uL(i))return!0;if(e in rg)return rg[e];const u=l[0],m=i.behavior||"enable",y="#extension GL_".concat(u," : ").concat(m,`
void main(void) {}`),T=r.createShader(35633);r.shaderSource(T,y),r.compileShader(T);const a=r.getShaderParameter(T,35713);return r.deleteShader(T),rg[e]=a,a}function yL(r,e){const i=m_[e];Pn(i,e);const l=mL(r)&&i[1]||i[0],u=typeof l=="string"?!!r.getExtension(l):l;return Pn(u===!1||u===!0),u}function Td(r,e){return e=Array.isArray(e)?e:[e],e.every(i=>yL(r,i))}function vL(r){switch(gL(r).gpuVendor.toLowerCase()){case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function xL(r,e,i){let l=`#if (__VERSION__ > 120)

# define FEATURE_GLSL_DERIVATIVES
# define FEATURE_GLSL_DRAW_BUFFERS
# define FEATURE_GLSL_FRAG_DEPTH
# define FEATURE_GLSL_TEXTURE_LOD

// DEPRECATED FLAGS, remove in v9
# define FRAG_DEPTH
# define DERIVATIVES
# define DRAW_BUFFERS
# define TEXTURE_LOD

#endif // __VERSION
`;return Td(r,sl.GLSL_FRAG_DEPTH)&&(l+=`
// FRAG_DEPTH => gl_FragDepth is available
#ifdef GL_EXT_frag_depth
#extension GL_EXT_frag_depth : enable
# define FEATURE_GLSL_FRAG_DEPTH
# define FRAG_DEPTH
# define gl_FragDepth gl_FragDepthEXT
#endif
`),Td(r,sl.GLSL_DERIVATIVES)&&yx(r,sl.GLSL_DERIVATIVES)&&(l+=`
// DERIVATIVES => dxdF, dxdY and fwidth are available
#ifdef GL_OES_standard_derivatives
#extension GL_OES_standard_derivatives : enable
# define FEATURE_GLSL_DERIVATIVES
# define DERIVATIVES
#endif
`),Td(r,sl.GLSL_FRAG_DATA)&&yx(r,sl.GLSL_FRAG_DATA,{behavior:"require"})&&(l+=`
// DRAW_BUFFERS => gl_FragData[] is available
#ifdef GL_EXT_draw_buffers
#extension GL_EXT_draw_buffers : require
#define FEATURE_GLSL_DRAW_BUFFERS
#define DRAW_BUFFERS
#endif
`),Td(r,sl.GLSL_TEXTURE_LOD)&&(l+=`// TEXTURE_LOD => texture2DLod etc are available
#ifdef GL_EXT_shader_texture_lod
#extension GL_EXT_shader_texture_lod : enable

# define FEATURE_GLSL_TEXTURE_LOD
# define TEXTURE_LOD

#endif
`),l}const bL=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,wL=`#ifdef MODULE_MATERIAL
  gl_FragColor = material_filterColor(gl_FragColor);
#endif

#ifdef MODULE_LIGHTING
  gl_FragColor = lighting_filterColor(gl_FragColor);
#endif

#ifdef MODULE_FOG
  gl_FragColor = fog_filterColor(gl_FragColor);
#endif

#ifdef MODULE_PICKING
  gl_FragColor = picking_filterHighlightColor(gl_FragColor);
  gl_FragColor = picking_filterPickingColor(gl_FragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,TL={[Fh]:bL,[p_]:wL},Bd="__LUMA_INJECT_DECLARATIONS__",vx=/void\s+main\s*\([^)]*\)\s*\{\n?/,xx=/}\n?[^{}]*$/,ng=[];function bx(r,e,i){let l=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const u=e===Fh;for(const m in i){const y=i[m];y.sort((a,P)=>a.order-P.order),ng.length=y.length;for(let a=0,P=y.length;a<P;++a)ng[a]=y[a].injection;const T="".concat(ng.join(`
`),`
`);switch(m){case"vs:#decl":u&&(r=r.replace(Bd,T));break;case"vs:#main-start":u&&(r=r.replace(vx,a=>a+T));break;case"vs:#main-end":u&&(r=r.replace(xx,a=>T+a));break;case"fs:#decl":u||(r=r.replace(Bd,T));break;case"fs:#main-start":u||(r=r.replace(vx,a=>a+T));break;case"fs:#main-end":u||(r=r.replace(xx,a=>T+a));break;default:r=r.replace(m,a=>a+T)}}return r=r.replace(Bd,""),l&&(r=r.replace(/\}\s*$/,m=>m+TL[e])),r}function Og(r){const e={};return Pn(Array.isArray(r)&&r.length>1),r.forEach(i=>{for(const l in i)e[l]=e[l]?"".concat(e[l],`
`).concat(i[l]):i[l]}),e}function Ic(r){return new RegExp("\\b".concat(r,"[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)"),"g")}const $1=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],EL=[...$1,[Ic("attribute"),"in $1"],[Ic("varying"),"out $1"]],SL=[...$1,[Ic("varying"),"in $1"]],W1=[[/^#version[ \t]+300[ \t]+es/,"#version 100"],[/\btexture(2D|2DProj|Cube)Lod\(/g,"texture$1LodEXT("],[/\btexture\(/g,"texture2D("],[/\btextureLod\(/g,"texture2DLodEXT("]],AL=[...W1,[Ic("in"),"attribute $1"],[Ic("out"),"varying $1"]],ML=[...W1,[Ic("in"),"varying $1"]],Dg="gl_FragColor",zg=/\bout[ \t]+vec4[ \t]+(\w+)[ \t]*;\n?/,PL=/void\s+main\s*\([^)]*\)\s*\{\n?/;function IL(r,e,i){switch(e){case 300:return i?qd(r,EL):CL(r);case 100:return i?qd(r,AL):LL(r);default:throw new Error("unknown GLSL version ".concat(e))}}function qd(r,e){for(const[i,l]of e)r=r.replace(i,l);return r}function CL(r){r=qd(r,SL);const e=r.match(zg);if(e){const i=e[1];r=r.replace(new RegExp("\\b".concat(Dg,"\\b"),"g"),i)}else{const i="fragmentColor";r=r.replace(PL,l=>"out vec4 ".concat(i,`;
`).concat(l)).replace(new RegExp("\\b".concat(Dg,"\\b"),"g"),i)}return r}function LL(r){r=qd(r,ML);const e=r.match(zg);if(e){const i=e[1];r=r.replace(zg,"").replace(new RegExp("\\b".concat(i,"\\b"),"g"),Dg)}return r}const kL=`

`.concat(Bd,`

`),q1={[Fh]:"vertex",[p_]:"fragment"},RL=`precision highp float;

`;function OL(r,e){const{vs:i,fs:l}=e,u=lL(e.modules||[]);return{gl:r,vs:wx(r,Object.assign({},e,{source:i,type:Fh,modules:u})),fs:wx(r,Object.assign({},e,{source:l,type:p_,modules:u})),getUniforms:DL(u)}}function wx(r,e){let{id:i,source:l,type:u,modules:m,defines:y={},hookFunctions:T=[],inject:a={},transpileToGLSL100:P=!1,prologue:D=!0,log:N}=e;Pn(typeof l=="string","shader source must be a string");const F=u===Fh,W=l.split(`
`);let oe=100,me="",fe=l;W[0].indexOf("#version ")===0?(oe=300,me=W[0],fe=W.slice(1).join(`
`)):me="#version ".concat(oe);const Ee={};m.forEach(ot=>{Object.assign(Ee,ot.getDefines())}),Object.assign(Ee,y);let Ce=D?"".concat(me,`
`).concat(BL({id:i,source:l,type:u}),`
`).concat(zL({type:u}),`
`).concat(vL(r),`
`).concat(xL(r),`
`).concat(FL(Ee),`
`).concat(F?"":RL,`
`):"".concat(me,`
`);const ke=UL(T),$e={},Ve={},Re={};for(const ot in a){const bt=typeof a[ot]=="string"?{injection:a[ot],order:0}:a[ot],mt=ot.match(/^(v|f)s:(#)?([\w-]+)$/);if(mt){const Mt=mt[2],gt=mt[3];Mt?gt==="decl"?Ve[ot]=[bt]:Re[ot]=[bt]:$e[ot]=[bt]}else Re[ot]=[bt]}for(const ot of m){N&&ot.checkDeprecations(fe,N);const bt=ot.getModuleSource(u,oe);Ce+=bt;const mt=ot.injections[u];for(const Mt in mt){const gt=Mt.match(/^(v|f)s:#([\w-]+)$/);if(gt){const Xt=gt[2]==="decl"?Ve:Re;Xt[Mt]=Xt[Mt]||[],Xt[Mt].push(mt[Mt])}else $e[Mt]=$e[Mt]||[],$e[Mt].push(mt[Mt])}}return Ce+=kL,Ce=bx(Ce,u,Ve),Ce+=NL(ke[u],$e),Ce+=fe,Ce=bx(Ce,u,Re),Ce=IL(Ce,P?100:oe,F),Ce}function DL(r){return function(i){const l={};for(const u of r){const m=u.getUniforms(i,l);Object.assign(l,m)}return l}}function zL(r){let{type:e}=r;return`
#define SHADER_TYPE_`.concat(q1[e].toUpperCase(),`
`)}function BL(r){let{id:e,source:i,type:l}=r;return e&&typeof e=="string"&&i.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME `.concat(e,"_").concat(q1[l],`

`):""}function FL(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=0,i="";for(const l in r){e===0&&(i+=`
// APPLICATION DEFINES
`),e++;const u=r[l];(u||Number.isFinite(u))&&(i+="#define ".concat(l.toUpperCase()," ").concat(r[l],`
`))}return e===0&&(i+=`
`),i}function NL(r,e){let i="";for(const l in r){const u=r[l];if(i+="void ".concat(u.signature,` {
`),u.header&&(i+="  ".concat(u.header)),e[l]){const m=e[l];m.sort((y,T)=>y.order-T.order);for(const y of m)i+="  ".concat(y.injection,`
`)}u.footer&&(i+="  ".concat(u.footer)),i+=`}
`}return i}function UL(r){const e={vs:{},fs:{}};return r.forEach(i=>{let l;typeof i!="string"?(l=i,i=l.hook):l={},i=i.trim();const[u,m]=i.split(":"),y=i.replace(/\(.+/,"");e[u][y]=Object.assign(l,{signature:m})}),e}const jL="void main() {gl_FragColor = vec4(0);}",X1=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,VL=`#version 300 es
`.concat(X1);function H1(r,e){e=Array.isArray(e)?e:[e];const i=r.replace(/^\s+/,"").split(/\s+/),[l,u,m]=i;if(!e.includes(l)||!u||!m)return null;const y=m.split(";")[0];return{qualifier:l,type:u,name:y}}function Y1(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{version:e=100,input:i,inputType:l,output:u}=r;if(!i)return e===300?VL:e>300?"#version ".concat(e,`
`).concat(X1):jL;const m=$L(i,l);return e>=300?"#version ".concat(e," ").concat(e===300?"es":"",`
in `).concat(l," ").concat(i,`;
out vec4 `).concat(u,`;
void main() {
  `).concat(u," = ").concat(m,`;
}`):"varying ".concat(l," ").concat(i,`;
void main() {
  gl_FragColor = `).concat(m,`;
}`)}function GL(r){switch(r){case"float":return"x";case"vec2":return"xy";case"vec3":return"xyz";case"vec4":return"xyzw";default:return Pn(!1),null}}function ZL(r){switch(r){case"float":return 1;case"vec2":return 2;case"vec3":return 3;case"vec4":return 4;default:return Pn(!1),null}}function $L(r,e){switch(e){case"float":return"vec4(".concat(r,", 0.0, 0.0, 1.0)");case"vec2":return"vec4(".concat(r,", 0.0, 1.0)");case"vec3":return"vec4(".concat(r,", 1.0)");case"vec4":return r;default:return Pn(!1),null}}const WL=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,qL={name:"fp32",vs:WL,fs:null};function Tx(r,e){if(!r)throw new Error("math.gl assertion ".concat(e))}const Gn={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0};function XL(r,{precision:e=Gn.precision}={}){return r=HL(r),"".concat(parseFloat(r.toPrecision(e)))}function Cc(r){return Array.isArray(r)||ArrayBuffer.isView(r)&&!(r instanceof DataView)}function Rr(r,e,i){return KL(r,l=>Math.max(e,Math.min(i,l)))}function Xd(r,e,i){return Cc(r)?r.map((l,u)=>Xd(l,e[u],i)):i*e+(1-i)*r}function Lc(r,e,i){const l=Gn.EPSILON;try{if(r===e)return!0;if(Cc(r)&&Cc(e)){if(r.length!==e.length)return!1;for(let u=0;u<r.length;++u)if(!Lc(r[u],e[u]))return!1;return!0}return r&&r.equals?r.equals(e):e&&e.equals?e.equals(r):typeof r=="number"&&typeof e=="number"?Math.abs(r-e)<=Gn.EPSILON*Math.max(1,Math.abs(r),Math.abs(e)):!1}finally{Gn.EPSILON=l}}function HL(r){return Math.round(r/Gn.EPSILON)*Gn.EPSILON}function YL(r){return r.clone?r.clone():new Array(r.length)}function KL(r,e,i){if(Cc(r)){const l=r;i=i||YL(l);for(let u=0;u<i.length&&u<l.length;++u)i[u]=e(r[u],u,i);return i}return e(r)}function JL(r){function e(){var i=Reflect.construct(r,Array.from(arguments));return Object.setPrototypeOf(i,Object.getPrototypeOf(this)),i}return e.prototype=Object.create(r.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(e,r):e.__proto__=r,e}class K1 extends JL(Array){clone(){return new this.constructor().copy(this)}fromArray(e,i=0){for(let l=0;l<this.ELEMENTS;++l)this[l]=e[l+i];return this.check()}toArray(e=[],i=0){for(let l=0;l<this.ELEMENTS;++l)e[i+l]=this[l];return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:Cc(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(Gn)}formatString(e){let i="";for(let l=0;l<this.ELEMENTS;++l)i+=(l>0?", ":"")+XL(this[l],e);return"".concat(e.printTypes?this.constructor.name:"","[").concat(i,"]")}equals(e){if(!e||this.length!==e.length)return!1;for(let i=0;i<this.ELEMENTS;++i)if(!Lc(this[i],e[i]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let i=0;i<this.ELEMENTS;++i)if(this[i]!==e[i])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,i,l){if(l===void 0)return this.lerp(this,e,i);for(let u=0;u<this.ELEMENTS;++u){const m=e[u];this[u]=m+l*(i[u]-m)}return this.check()}min(e){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(e[i],this[i]);return this.check()}max(e){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.max(e[i],this[i]);return this.check()}clamp(e,i){for(let l=0;l<this.ELEMENTS;++l)this[l]=Math.min(Math.max(this[l],e[l]),i[l]);return this.check()}add(...e){for(const i of e)for(let l=0;l<this.ELEMENTS;++l)this[l]+=i[l];return this.check()}subtract(...e){for(const i of e)for(let l=0;l<this.ELEMENTS;++l)this[l]-=i[l];return this.check()}scale(e){if(typeof e=="number")for(let i=0;i<this.ELEMENTS;++i)this[i]*=e;else for(let i=0;i<this.ELEMENTS&&i<e.length;++i)this[i]*=e[i];return this.check()}multiplyByScalar(e){for(let i=0;i<this.ELEMENTS;++i)this[i]*=e;return this.check()}check(){if(Gn.debug&&!this.validate())throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}validate(){let e=this.length===this.ELEMENTS;for(let i=0;i<this.ELEMENTS;++i)e=e&&Number.isFinite(this[i]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let i=0;i<this.ELEMENTS;++i)this[i]=e;return this.check()}addScalar(e){for(let i=0;i<this.ELEMENTS;++i)this[i]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let i=0;i<this.ELEMENTS;++i)this[i]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,i){for(let l=0;l<this.ELEMENTS;++l)this[l]=Math.min(Math.max(this[l],e),i);return this.check()}get elements(){return this}}function QL(r,e){if(r.length!==e)return!1;for(let i=0;i<r.length;++i)if(!Number.isFinite(r[i]))return!1;return!0}function An(r){if(!Number.isFinite(r))throw new Error("Invalid number ".concat(r));return r}function sg(r,e,i=""){if(Gn.debug&&!QL(r,e))throw new Error("math.gl: ".concat(i," some fields set to invalid numbers'"));return r}class ek extends K1{get x(){return this[0]}set x(e){this[0]=An(e)}get y(){return this[1]}set y(e){this[1]=An(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let i=0;i<this.ELEMENTS;++i)e+=this[i]*this[i];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let i=0;for(let l=0;l<this.ELEMENTS;++l){const u=this[l]-e[l];i+=u*u}return An(i)}dot(e){let i=0;for(let l=0;l<this.ELEMENTS;++l)i+=this[l]*e[l];return An(i)}normalize(){const e=this.magnitude();if(e!==0)for(let i=0;i<this.ELEMENTS;++i)this[i]/=e;return this.check()}multiply(...e){for(const i of e)for(let l=0;l<this.ELEMENTS;++l)this[l]*=i[l];return this.check()}divide(...e){for(const i of e)for(let l=0;l<this.ELEMENTS;++l)this[l]/=i[l];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return Tx(e>=0&&e<this.ELEMENTS,"index is out of range"),An(this[e])}setComponent(e,i){return Tx(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=i,this.check()}addVectors(e,i){return this.copy(e).add(i)}subVectors(e,i){return this.copy(e).subtract(i)}multiplyVectors(e,i){return this.copy(e).multiply(i)}addScaledVector(e,i){return this.add(new this.constructor(e).multiplyScalar(i))}}var er=1e-6,kc=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var r=0,e=arguments.length;e--;)r+=arguments[e]*arguments[e];return Math.sqrt(r)});function tk(){var r=new kc(2);return kc!=Float32Array&&(r[0]=0,r[1]=0),r}function ul(r,e,i){return r[0]=e[0]+i[0],r[1]=e[1]+i[1],r}function ik(r,e,i){return r[0]=e[0]-i[0],r[1]=e[1]-i[1],r}function rk(r,e,i){return r[0]=e[0]*i,r[1]=e[1]*i,r}function nk(r){var e=r[0],i=r[1];return Math.hypot(e,i)}function g_(r,e){return r[0]=-e[0],r[1]=-e[1],r}function J1(r,e,i,l){var u=e[0],m=e[1];return r[0]=u+l*(i[0]-u),r[1]=m+l*(i[1]-m),r}function sk(r,e,i){var l=e[0],u=e[1];return r[0]=i[0]*l+i[4]*u+i[12],r[1]=i[1]*l+i[5]*u+i[13],r}var ok=ik;(function(){var r=tk();return function(e,i,l,u,m,y){var T,a;for(i||(i=2),l||(l=0),u?a=Math.min(u*i+l,e.length):a=e.length,T=l;T<a;T+=i)r[0]=e[T],r[1]=e[T+1],m(r,r,y),e[T]=r[0],e[T+1]=r[1];return e}})();function ak(r,e,i){const l=e[0],u=e[1],m=i[3]*l+i[7]*u||1;return r[0]=(i[0]*l+i[4]*u)/m,r[1]=(i[1]*l+i[5]*u)/m,r}function Q1(r,e,i){const l=e[0],u=e[1],m=e[2],y=i[3]*l+i[7]*u+i[11]*m||1;return r[0]=(i[0]*l+i[4]*u+i[8]*m)/y,r[1]=(i[1]*l+i[5]*u+i[9]*m)/y,r[2]=(i[2]*l+i[6]*u+i[10]*m)/y,r}function lk(r,e,i){const l=e[0],u=e[1];return r[0]=i[0]*l+i[2]*u,r[1]=i[1]*l+i[3]*u,r[2]=e[2],r}function ck(){var r=new kc(3);return kc!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function uk(r,e,i){return r[0]=e[0]+i[0],r[1]=e[1]+i[1],r[2]=e[2]+i[2],r}function hk(r,e,i){return r[0]=e[0]-i[0],r[1]=e[1]-i[1],r[2]=e[2]-i[2],r}function fk(r,e,i){return r[0]=e[0]*i[0],r[1]=e[1]*i[1],r[2]=e[2]*i[2],r}function dk(r,e){var i=e[0]-r[0],l=e[1]-r[1],u=e[2]-r[2];return Math.hypot(i,l,u)}function pk(r,e){return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r}function mk(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]}function gk(r,e,i){var l=e[0],u=e[1],m=e[2],y=i[0],T=i[1],a=i[2];return r[0]=u*a-m*T,r[1]=m*y-l*a,r[2]=l*T-u*y,r}function ew(r,e,i){var l=e[0],u=e[1],m=e[2],y=i[3]*l+i[7]*u+i[11]*m+i[15];return y=y||1,r[0]=(i[0]*l+i[4]*u+i[8]*m+i[12])/y,r[1]=(i[1]*l+i[5]*u+i[9]*m+i[13])/y,r[2]=(i[2]*l+i[6]*u+i[10]*m+i[14])/y,r}function _k(r,e,i){var l=e[0],u=e[1],m=e[2];return r[0]=l*i[0]+u*i[3]+m*i[6],r[1]=l*i[1]+u*i[4]+m*i[7],r[2]=l*i[2]+u*i[5]+m*i[8],r}function yk(r,e,i){var l=i[0],u=i[1],m=i[2],y=i[3],T=e[0],a=e[1],P=e[2],D=u*P-m*a,N=m*T-l*P,F=l*a-u*T,W=u*F-m*N,oe=m*D-l*F,me=l*N-u*D,fe=y*2;return D*=fe,N*=fe,F*=fe,W*=2,oe*=2,me*=2,r[0]=T+D+W,r[1]=a+N+oe,r[2]=P+F+me,r}function vk(r,e,i,l){var u=[],m=[];return u[0]=e[0]-i[0],u[1]=e[1]-i[1],u[2]=e[2]-i[2],m[0]=u[0],m[1]=u[1]*Math.cos(l)-u[2]*Math.sin(l),m[2]=u[1]*Math.sin(l)+u[2]*Math.cos(l),r[0]=m[0]+i[0],r[1]=m[1]+i[1],r[2]=m[2]+i[2],r}function xk(r,e,i,l){var u=[],m=[];return u[0]=e[0]-i[0],u[1]=e[1]-i[1],u[2]=e[2]-i[2],m[0]=u[2]*Math.sin(l)+u[0]*Math.cos(l),m[1]=u[1],m[2]=u[2]*Math.cos(l)-u[0]*Math.sin(l),r[0]=m[0]+i[0],r[1]=m[1]+i[1],r[2]=m[2]+i[2],r}function bk(r,e,i,l){var u=[],m=[];return u[0]=e[0]-i[0],u[1]=e[1]-i[1],u[2]=e[2]-i[2],m[0]=u[0]*Math.cos(l)-u[1]*Math.sin(l),m[1]=u[0]*Math.sin(l)+u[1]*Math.cos(l),m[2]=u[2],r[0]=m[0]+i[0],r[1]=m[1]+i[1],r[2]=m[2]+i[2],r}function wk(r,e){var i=r[0],l=r[1],u=r[2],m=e[0],y=e[1],T=e[2],a=Math.sqrt(i*i+l*l+u*u),P=Math.sqrt(m*m+y*y+T*T),D=a*P,N=D&&mk(r,e)/D;return Math.acos(Math.min(Math.max(N,-1),1))}var Tk=hk,Ek=fk,AF=dk;(function(){var r=ck();return function(e,i,l,u,m,y){var T,a;for(i||(i=3),l||(l=0),u?a=Math.min(u*i+l,e.length):a=e.length,T=l;T<a;T+=i)r[0]=e[T],r[1]=e[T+1],r[2]=e[T+2],m(r,r,y),e[T]=r[0],e[T+1]=r[1],e[T+2]=r[2];return e}})();const og=[0,0,0];let Ed;class js extends ek{static get ZERO(){return Ed||(Ed=new js(0,0,0),Object.freeze(Ed)),Ed}constructor(e=0,i=0,l=0){super(-0,-0,-0),arguments.length===1&&Cc(e)?this.copy(e):(Gn.debug&&(An(e),An(i),An(l)),this[0]=e,this[1]=i,this[2]=l)}set(e,i,l){return this[0]=e,this[1]=i,this[2]=l,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return Gn.debug&&(An(e.x),An(e.y),An(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=An(e)}angle(e){return wk(this,e)}cross(e){return gk(this,this,e),this.check()}rotateX({radians:e,origin:i=og}){return vk(this,this,i,e),this.check()}rotateY({radians:e,origin:i=og}){return xk(this,this,i,e),this.check()}rotateZ({radians:e,origin:i=og}){return bk(this,this,i,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return ew(this,this,e),this.check()}transformAsVector(e){return Q1(this,this,e),this.check()}transformByMatrix3(e){return _k(this,this,e),this.check()}transformByMatrix2(e){return lk(this,this,e),this.check()}transformByQuaternion(e){return yk(this,this,e),this.check()}}class Sk extends K1{toString(){let e="[";if(Gn.printRowMajor){e+="row-major:";for(let i=0;i<this.RANK;++i)for(let l=0;l<this.RANK;++l)e+=" ".concat(this[l*this.RANK+i])}else{e+="column-major:";for(let i=0;i<this.ELEMENTS;++i)e+=" ".concat(this[i])}return e+="]",e}getElementIndex(e,i){return i*this.RANK+e}getElement(e,i){return this[i*this.RANK+e]}setElement(e,i,l){return this[i*this.RANK+e]=An(l),this}getColumn(e,i=new Array(this.RANK).fill(-0)){const l=e*this.RANK;for(let u=0;u<this.RANK;++u)i[u]=this[l+u];return i}setColumn(e,i){const l=e*this.RANK;for(let u=0;u<this.RANK;++u)this[l+u]=i[u];return this}}function Ak(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function Mk(r,e){if(r===e){var i=e[1],l=e[2],u=e[3],m=e[6],y=e[7],T=e[11];r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=i,r[6]=e[9],r[7]=e[13],r[8]=l,r[9]=m,r[11]=e[14],r[12]=u,r[13]=y,r[14]=T}else r[0]=e[0],r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=e[1],r[5]=e[5],r[6]=e[9],r[7]=e[13],r[8]=e[2],r[9]=e[6],r[10]=e[10],r[11]=e[14],r[12]=e[3],r[13]=e[7],r[14]=e[11],r[15]=e[15];return r}function Hd(r,e){var i=e[0],l=e[1],u=e[2],m=e[3],y=e[4],T=e[5],a=e[6],P=e[7],D=e[8],N=e[9],F=e[10],W=e[11],oe=e[12],me=e[13],fe=e[14],Ee=e[15],Ce=i*T-l*y,ke=i*a-u*y,$e=i*P-m*y,Ve=l*a-u*T,Re=l*P-m*T,ot=u*P-m*a,bt=D*me-N*oe,mt=D*fe-F*oe,Mt=D*Ee-W*oe,gt=N*fe-F*me,Ht=N*Ee-W*me,Xt=F*Ee-W*fe,jt=Ce*Xt-ke*Ht+$e*gt+Ve*Mt-Re*mt+ot*bt;return jt?(jt=1/jt,r[0]=(T*Xt-a*Ht+P*gt)*jt,r[1]=(u*Ht-l*Xt-m*gt)*jt,r[2]=(me*ot-fe*Re+Ee*Ve)*jt,r[3]=(F*Re-N*ot-W*Ve)*jt,r[4]=(a*Mt-y*Xt-P*mt)*jt,r[5]=(i*Xt-u*Mt+m*mt)*jt,r[6]=(fe*$e-oe*ot-Ee*ke)*jt,r[7]=(D*ot-F*$e+W*ke)*jt,r[8]=(y*Ht-T*Mt+P*bt)*jt,r[9]=(l*Mt-i*Ht-m*bt)*jt,r[10]=(oe*Re-me*$e+Ee*Ce)*jt,r[11]=(N*$e-D*Re-W*Ce)*jt,r[12]=(T*mt-y*gt-a*bt)*jt,r[13]=(i*gt-l*mt+u*bt)*jt,r[14]=(me*ke-oe*Ve-fe*Ce)*jt,r[15]=(D*Ve-N*ke+F*Ce)*jt,r):null}function Pk(r){var e=r[0],i=r[1],l=r[2],u=r[3],m=r[4],y=r[5],T=r[6],a=r[7],P=r[8],D=r[9],N=r[10],F=r[11],W=r[12],oe=r[13],me=r[14],fe=r[15],Ee=e*y-i*m,Ce=e*T-l*m,ke=e*a-u*m,$e=i*T-l*y,Ve=i*a-u*y,Re=l*a-u*T,ot=P*oe-D*W,bt=P*me-N*W,mt=P*fe-F*W,Mt=D*me-N*oe,gt=D*fe-F*oe,Ht=N*fe-F*me;return Ee*Ht-Ce*gt+ke*Mt+$e*mt-Ve*bt+Re*ot}function Ns(r,e,i){var l=e[0],u=e[1],m=e[2],y=e[3],T=e[4],a=e[5],P=e[6],D=e[7],N=e[8],F=e[9],W=e[10],oe=e[11],me=e[12],fe=e[13],Ee=e[14],Ce=e[15],ke=i[0],$e=i[1],Ve=i[2],Re=i[3];return r[0]=ke*l+$e*T+Ve*N+Re*me,r[1]=ke*u+$e*a+Ve*F+Re*fe,r[2]=ke*m+$e*P+Ve*W+Re*Ee,r[3]=ke*y+$e*D+Ve*oe+Re*Ce,ke=i[4],$e=i[5],Ve=i[6],Re=i[7],r[4]=ke*l+$e*T+Ve*N+Re*me,r[5]=ke*u+$e*a+Ve*F+Re*fe,r[6]=ke*m+$e*P+Ve*W+Re*Ee,r[7]=ke*y+$e*D+Ve*oe+Re*Ce,ke=i[8],$e=i[9],Ve=i[10],Re=i[11],r[8]=ke*l+$e*T+Ve*N+Re*me,r[9]=ke*u+$e*a+Ve*F+Re*fe,r[10]=ke*m+$e*P+Ve*W+Re*Ee,r[11]=ke*y+$e*D+Ve*oe+Re*Ce,ke=i[12],$e=i[13],Ve=i[14],Re=i[15],r[12]=ke*l+$e*T+Ve*N+Re*me,r[13]=ke*u+$e*a+Ve*F+Re*fe,r[14]=ke*m+$e*P+Ve*W+Re*Ee,r[15]=ke*y+$e*D+Ve*oe+Re*Ce,r}function Ph(r,e,i){var l=i[0],u=i[1],m=i[2],y,T,a,P,D,N,F,W,oe,me,fe,Ee;return e===r?(r[12]=e[0]*l+e[4]*u+e[8]*m+e[12],r[13]=e[1]*l+e[5]*u+e[9]*m+e[13],r[14]=e[2]*l+e[6]*u+e[10]*m+e[14],r[15]=e[3]*l+e[7]*u+e[11]*m+e[15]):(y=e[0],T=e[1],a=e[2],P=e[3],D=e[4],N=e[5],F=e[6],W=e[7],oe=e[8],me=e[9],fe=e[10],Ee=e[11],r[0]=y,r[1]=T,r[2]=a,r[3]=P,r[4]=D,r[5]=N,r[6]=F,r[7]=W,r[8]=oe,r[9]=me,r[10]=fe,r[11]=Ee,r[12]=y*l+D*u+oe*m+e[12],r[13]=T*l+N*u+me*m+e[13],r[14]=a*l+F*u+fe*m+e[14],r[15]=P*l+W*u+Ee*m+e[15]),r}function up(r,e,i){var l=i[0],u=i[1],m=i[2];return r[0]=e[0]*l,r[1]=e[1]*l,r[2]=e[2]*l,r[3]=e[3]*l,r[4]=e[4]*u,r[5]=e[5]*u,r[6]=e[6]*u,r[7]=e[7]*u,r[8]=e[8]*m,r[9]=e[9]*m,r[10]=e[10]*m,r[11]=e[11]*m,r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r}function Ik(r,e,i,l){var u=l[0],m=l[1],y=l[2],T=Math.hypot(u,m,y),a,P,D,N,F,W,oe,me,fe,Ee,Ce,ke,$e,Ve,Re,ot,bt,mt,Mt,gt,Ht,Xt,jt,Ki;return T<er?null:(T=1/T,u*=T,m*=T,y*=T,a=Math.sin(i),P=Math.cos(i),D=1-P,N=e[0],F=e[1],W=e[2],oe=e[3],me=e[4],fe=e[5],Ee=e[6],Ce=e[7],ke=e[8],$e=e[9],Ve=e[10],Re=e[11],ot=u*u*D+P,bt=m*u*D+y*a,mt=y*u*D-m*a,Mt=u*m*D-y*a,gt=m*m*D+P,Ht=y*m*D+u*a,Xt=u*y*D+m*a,jt=m*y*D-u*a,Ki=y*y*D+P,r[0]=N*ot+me*bt+ke*mt,r[1]=F*ot+fe*bt+$e*mt,r[2]=W*ot+Ee*bt+Ve*mt,r[3]=oe*ot+Ce*bt+Re*mt,r[4]=N*Mt+me*gt+ke*Ht,r[5]=F*Mt+fe*gt+$e*Ht,r[6]=W*Mt+Ee*gt+Ve*Ht,r[7]=oe*Mt+Ce*gt+Re*Ht,r[8]=N*Xt+me*jt+ke*Ki,r[9]=F*Xt+fe*jt+$e*Ki,r[10]=W*Xt+Ee*jt+Ve*Ki,r[11]=oe*Xt+Ce*jt+Re*Ki,e!==r&&(r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r)}function tw(r,e,i){var l=Math.sin(i),u=Math.cos(i),m=e[4],y=e[5],T=e[6],a=e[7],P=e[8],D=e[9],N=e[10],F=e[11];return e!==r&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[4]=m*u+P*l,r[5]=y*u+D*l,r[6]=T*u+N*l,r[7]=a*u+F*l,r[8]=P*u-m*l,r[9]=D*u-y*l,r[10]=N*u-T*l,r[11]=F*u-a*l,r}function Ck(r,e,i){var l=Math.sin(i),u=Math.cos(i),m=e[0],y=e[1],T=e[2],a=e[3],P=e[8],D=e[9],N=e[10],F=e[11];return e!==r&&(r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=m*u-P*l,r[1]=y*u-D*l,r[2]=T*u-N*l,r[3]=a*u-F*l,r[8]=m*l+P*u,r[9]=y*l+D*u,r[10]=T*l+N*u,r[11]=a*l+F*u,r}function iw(r,e,i){var l=Math.sin(i),u=Math.cos(i),m=e[0],y=e[1],T=e[2],a=e[3],P=e[4],D=e[5],N=e[6],F=e[7];return e!==r&&(r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=m*u+P*l,r[1]=y*u+D*l,r[2]=T*u+N*l,r[3]=a*u+F*l,r[4]=P*u-m*l,r[5]=D*u-y*l,r[6]=N*u-T*l,r[7]=F*u-a*l,r}function Lk(r,e){var i=e[0],l=e[1],u=e[2],m=e[3],y=i+i,T=l+l,a=u+u,P=i*y,D=l*y,N=l*T,F=u*y,W=u*T,oe=u*a,me=m*y,fe=m*T,Ee=m*a;return r[0]=1-N-oe,r[1]=D+Ee,r[2]=F-fe,r[3]=0,r[4]=D-Ee,r[5]=1-P-oe,r[6]=W+me,r[7]=0,r[8]=F+fe,r[9]=W-me,r[10]=1-P-N,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function kk(r,e,i,l,u,m,y){var T=1/(i-e),a=1/(u-l),P=1/(m-y);return r[0]=m*2*T,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=m*2*a,r[6]=0,r[7]=0,r[8]=(i+e)*T,r[9]=(u+l)*a,r[10]=(y+m)*P,r[11]=-1,r[12]=0,r[13]=0,r[14]=y*m*2*P,r[15]=0,r}function Rk(r,e,i,l,u){var m=1/Math.tan(e/2),y;return r[0]=m/i,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=m,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,u!=null&&u!==1/0?(y=1/(l-u),r[10]=(u+l)*y,r[14]=2*u*l*y):(r[10]=-1,r[14]=-2*l),r}var rw=Rk;function Ok(r,e,i,l,u,m,y){var T=1/(e-i),a=1/(l-u),P=1/(m-y);return r[0]=-2*T,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*a,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*P,r[11]=0,r[12]=(e+i)*T,r[13]=(u+l)*a,r[14]=(y+m)*P,r[15]=1,r}var Dk=Ok;function zk(r,e,i,l){var u,m,y,T,a,P,D,N,F,W,oe=e[0],me=e[1],fe=e[2],Ee=l[0],Ce=l[1],ke=l[2],$e=i[0],Ve=i[1],Re=i[2];return Math.abs(oe-$e)<er&&Math.abs(me-Ve)<er&&Math.abs(fe-Re)<er?Ak(r):(D=oe-$e,N=me-Ve,F=fe-Re,W=1/Math.hypot(D,N,F),D*=W,N*=W,F*=W,u=Ce*F-ke*N,m=ke*D-Ee*F,y=Ee*N-Ce*D,W=Math.hypot(u,m,y),W?(W=1/W,u*=W,m*=W,y*=W):(u=0,m=0,y=0),T=N*y-F*m,a=F*u-D*y,P=D*m-N*u,W=Math.hypot(T,a,P),W?(W=1/W,T*=W,a*=W,P*=W):(T=0,a=0,P=0),r[0]=u,r[1]=T,r[2]=D,r[3]=0,r[4]=m,r[5]=a,r[6]=N,r[7]=0,r[8]=y,r[9]=P,r[10]=F,r[11]=0,r[12]=-(u*oe+m*me+y*fe),r[13]=-(T*oe+a*me+P*fe),r[14]=-(D*oe+N*me+F*fe),r[15]=1,r)}function Ex(r,e){var i=r[0],l=r[1],u=r[2],m=r[3],y=r[4],T=r[5],a=r[6],P=r[7],D=r[8],N=r[9],F=r[10],W=r[11],oe=r[12],me=r[13],fe=r[14],Ee=r[15],Ce=e[0],ke=e[1],$e=e[2],Ve=e[3],Re=e[4],ot=e[5],bt=e[6],mt=e[7],Mt=e[8],gt=e[9],Ht=e[10],Xt=e[11],jt=e[12],Ki=e[13],$n=e[14],Or=e[15];return Math.abs(i-Ce)<=er*Math.max(1,Math.abs(i),Math.abs(Ce))&&Math.abs(l-ke)<=er*Math.max(1,Math.abs(l),Math.abs(ke))&&Math.abs(u-$e)<=er*Math.max(1,Math.abs(u),Math.abs($e))&&Math.abs(m-Ve)<=er*Math.max(1,Math.abs(m),Math.abs(Ve))&&Math.abs(y-Re)<=er*Math.max(1,Math.abs(y),Math.abs(Re))&&Math.abs(T-ot)<=er*Math.max(1,Math.abs(T),Math.abs(ot))&&Math.abs(a-bt)<=er*Math.max(1,Math.abs(a),Math.abs(bt))&&Math.abs(P-mt)<=er*Math.max(1,Math.abs(P),Math.abs(mt))&&Math.abs(D-Mt)<=er*Math.max(1,Math.abs(D),Math.abs(Mt))&&Math.abs(N-gt)<=er*Math.max(1,Math.abs(N),Math.abs(gt))&&Math.abs(F-Ht)<=er*Math.max(1,Math.abs(F),Math.abs(Ht))&&Math.abs(W-Xt)<=er*Math.max(1,Math.abs(W),Math.abs(Xt))&&Math.abs(oe-jt)<=er*Math.max(1,Math.abs(oe),Math.abs(jt))&&Math.abs(me-Ki)<=er*Math.max(1,Math.abs(me),Math.abs(Ki))&&Math.abs(fe-$n)<=er*Math.max(1,Math.abs(fe),Math.abs($n))&&Math.abs(Ee-Or)<=er*Math.max(1,Math.abs(Ee),Math.abs(Or))}function Bk(){var r=new kc(4);return kc!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0,r[3]=0),r}function Fk(r,e,i){return r[0]=e[0]*i,r[1]=e[1]*i,r[2]=e[2]*i,r[3]=e[3]*i,r}function Nh(r,e,i){var l=e[0],u=e[1],m=e[2],y=e[3];return r[0]=i[0]*l+i[4]*u+i[8]*m+i[12]*y,r[1]=i[1]*l+i[5]*u+i[9]*m+i[13]*y,r[2]=i[2]*l+i[6]*u+i[10]*m+i[14]*y,r[3]=i[3]*l+i[7]*u+i[11]*m+i[15]*y,r}(function(){var r=Bk();return function(e,i,l,u,m,y){var T,a;for(i||(i=4),l||(l=0),u?a=Math.min(u*i+l,e.length):a=e.length,T=l;T<a;T+=i)r[0]=e[T],r[1]=e[T+1],r[2]=e[T+2],r[3]=e[T+3],m(r,r,y),e[T]=r[0],e[T+1]=r[1],e[T+2]=r[2],e[T+3]=r[3];return e}})();var Bg;(function(r){r[r.COL0ROW0=0]="COL0ROW0",r[r.COL0ROW1=1]="COL0ROW1",r[r.COL0ROW2=2]="COL0ROW2",r[r.COL0ROW3=3]="COL0ROW3",r[r.COL1ROW0=4]="COL1ROW0",r[r.COL1ROW1=5]="COL1ROW1",r[r.COL1ROW2=6]="COL1ROW2",r[r.COL1ROW3=7]="COL1ROW3",r[r.COL2ROW0=8]="COL2ROW0",r[r.COL2ROW1=9]="COL2ROW1",r[r.COL2ROW2=10]="COL2ROW2",r[r.COL2ROW3=11]="COL2ROW3",r[r.COL3ROW0=12]="COL3ROW0",r[r.COL3ROW1=13]="COL3ROW1",r[r.COL3ROW2=14]="COL3ROW2",r[r.COL3ROW3=15]="COL3ROW3"})(Bg||(Bg={}));const Nk=45*Math.PI/180,Uk=1,ag=.1,lg=500,jk=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class Zn extends Sk{static get IDENTITY(){return Gk()}static get ZERO(){return Vk()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return Bg}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,i,l,u,m,y,T,a,P,D,N,F,W,oe,me,fe){return this[0]=e,this[1]=i,this[2]=l,this[3]=u,this[4]=m,this[5]=y,this[6]=T,this[7]=a,this[8]=P,this[9]=D,this[10]=N,this[11]=F,this[12]=W,this[13]=oe,this[14]=me,this[15]=fe,this.check()}setRowMajor(e,i,l,u,m,y,T,a,P,D,N,F,W,oe,me,fe){return this[0]=e,this[1]=m,this[2]=P,this[3]=W,this[4]=i,this[5]=y,this[6]=D,this[7]=oe,this[8]=l,this[9]=T,this[10]=N,this[11]=me,this[12]=u,this[13]=a,this[14]=F,this[15]=fe,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(jk)}fromObject(e){return this.check()}fromQuaternion(e){return Lk(this,e),this.check()}frustum(e){const{left:i,right:l,bottom:u,top:m,near:y=ag,far:T=lg}=e;return T===1/0?Zk(this,i,l,u,m,y):kk(this,i,l,u,m,y,T),this.check()}lookAt(e){const{eye:i,center:l=[0,0,0],up:u=[0,1,0]}=e;return zk(this,i,l,u),this.check()}ortho(e){const{left:i,right:l,bottom:u,top:m,near:y=ag,far:T=lg}=e;return Dk(this,i,l,u,m,y,T),this.check()}orthographic(e){const{fovy:i=Nk,aspect:l=Uk,focalDistance:u=1,near:m=ag,far:y=lg}=e;Sx(i);const T=i/2,a=u*Math.tan(T),P=a*l;return this.ortho({left:-P,right:P,bottom:-a,top:a,near:m,far:y})}perspective(e){const{fovy:i=45*Math.PI/180,aspect:l=1,near:u=.1,far:m=500}=e;return Sx(i),rw(this,i,l,u,m),this.check()}determinant(){return Pk(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,i){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],i=i||[-0,-0,-0];const l=this.getScale(i),u=1/l[0],m=1/l[1],y=1/l[2];return e[0]=this[0]*u,e[1]=this[1]*m,e[2]=this[2]*y,e[3]=0,e[4]=this[4]*u,e[5]=this[5]*m,e[6]=this[6]*y,e[7]=0,e[8]=this[8]*u,e[9]=this[9]*m,e[10]=this[10]*y,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,i){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],i=i||[-0,-0,-0];const l=this.getScale(i),u=1/l[0],m=1/l[1],y=1/l[2];return e[0]=this[0]*u,e[1]=this[1]*m,e[2]=this[2]*y,e[3]=this[4]*u,e[4]=this[5]*m,e[5]=this[6]*y,e[6]=this[8]*u,e[7]=this[9]*m,e[8]=this[10]*y,e}transpose(){return Mk(this,this),this.check()}invert(){return Hd(this,this),this.check()}multiplyLeft(e){return Ns(this,e,this),this.check()}multiplyRight(e){return Ns(this,this,e),this.check()}rotateX(e){return tw(this,this,e),this.check()}rotateY(e){return Ck(this,this,e),this.check()}rotateZ(e){return iw(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,i){return Ik(this,this,e,i),this.check()}scale(e){return up(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return Ph(this,this,e),this.check()}transform(e,i){return e.length===4?(i=Nh(i||[-0,-0,-0,-0],e,this),sg(i,4),i):this.transformAsPoint(e,i)}transformAsPoint(e,i){const{length:l}=e;let u;switch(l){case 2:u=sk(i||[-0,-0],e,this);break;case 3:u=ew(i||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return sg(u,e.length),u}transformAsVector(e,i){let l;switch(e.length){case 2:l=ak(i||[-0,-0],e,this);break;case 3:l=Q1(i||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return sg(l,e.length),l}transformPoint(e,i){return this.transformAsPoint(e,i)}transformVector(e,i){return this.transformAsPoint(e,i)}transformDirection(e,i){return this.transformAsVector(e,i)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,i,l){return this.identity().translate([e,i,l])}}let Sd,Ad;function Vk(){return Sd||(Sd=new Zn([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(Sd)),Sd}function Gk(){return Ad||(Ad=new Zn,Object.freeze(Ad)),Ad}function Sx(r){if(r>Math.PI*2)throw Error("expected radians")}function Zk(r,e,i,l,u,m){const y=2*m/(i-e),T=2*m/(u-l),a=(i+e)/(i-e),P=(u+l)/(u-l),D=-1,N=-1,F=-2*m;return r[0]=y,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=T,r[6]=0,r[7]=0,r[8]=a,r[9]=P,r[10]=D,r[11]=N,r[12]=0,r[13]=0,r[14]=F,r[15]=0,r}const $k=new Uint8Array([0,255,255,255]),Wk={pickingSelectedColor:null,pickingHighlightColor:$k,pickingActive:!1,pickingAttribute:!1};function qk(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Wk;const e={};if(r.pickingSelectedColor!==void 0)if(!r.pickingSelectedColor)e.picking_uSelectedColorValid=0;else{const i=r.pickingSelectedColor.slice(0,3);e.picking_uSelectedColorValid=1,e.picking_uSelectedColor=i}if(r.pickingHighlightColor){const i=Array.from(r.pickingHighlightColor,l=>l/255);Number.isFinite(i[3])||(i[3]=1),e.picking_uHighlightColor=i}return r.pickingActive!==void 0&&(e.picking_uActive=!!r.pickingActive,e.picking_uAttribute=!!r.pickingAttribute),e}const Xk=`uniform bool picking_uActive;
uniform bool picking_uAttribute;
uniform vec3 picking_uSelectedColor;
uniform bool picking_uSelectedColorValid;

out vec4 picking_vRGBcolor_Avalid;

const float COLOR_SCALE = 1. / 255.;

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.001;
}

bool isVertexPicked(vec3 vertexColor) {
  return
    picking_uSelectedColorValid &&
    !picking_isColorValid(abs(vertexColor - picking_uSelectedColor));
}

void picking_setPickingColor(vec3 pickingColor) {
  if (picking_uActive) {
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!picking_uAttribute) {
      picking_vRGBcolor_Avalid.rgb = pickingColor * COLOR_SCALE;
    }
  } else {
    picking_vRGBcolor_Avalid.a = float(isVertexPicked(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.r = value;
  }
}
void picking_setPickingAttribute(vec2 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}
void picking_setPickingAttribute(vec3 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,Hk=`uniform bool picking_uActive;
uniform vec3 picking_uSelectedColor;
uniform vec4 picking_uHighlightColor;

in vec4 picking_vRGBcolor_Avalid;
vec4 picking_filterHighlightColor(vec4 color) {
  if (picking_uActive) {
    return color;
  }
  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    float highLightAlpha = picking_uHighlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking_uHighlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}
vec4 picking_filterPickingColor(vec4 color) {
  if (picking_uActive) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}
vec4 picking_filterColor(vec4 color) {
  vec4 highightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highightColor);
}

`,Yk={name:"picking",vs:Xk,fs:Hk,getUniforms:qk},Kk=`attribute float transform_elementID;
vec2 transform_getPixelSizeHalf(vec2 size) {
  return vec2(1.) / (2. * size);
}

vec2 transform_getPixelIndices(vec2 texSize, vec2 pixelSizeHalf) {
  float yIndex = floor((transform_elementID / texSize[0]) + pixelSizeHalf[1]);
  float xIndex = transform_elementID - (yIndex * texSize[0]);
  return vec2(xIndex, yIndex);
}
vec2 transform_getTexCoord(vec2 size) {
  vec2 pixelSizeHalf = transform_getPixelSizeHalf(size);
  vec2 indices = transform_getPixelIndices(size, pixelSizeHalf);
  vec2 coord = indices / size + pixelSizeHalf;
  return coord;
}
vec2 transform_getPos(vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec2 pos = (texCoord * (2.0, 2.0)) - (1., 1.);
  return pos;
}
vec4 transform_getInput(sampler2D texSampler, vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec4 textureColor = texture2D(texSampler, texCoord);
  return textureColor;
}
`,Jk={name:"transform",vs:Kk,fs:null};class Uh{static getDefaultProgramManager(e){return e.luma=e.luma||{},e.luma.defaultProgramManager=e.luma.defaultProgramManager||new Uh(e),e.luma.defaultProgramManager}constructor(e){this.gl=e,this._programCache={},this._getUniforms={},this._registeredModules={},this._hookFunctions=[],this._defaultModules=[],this._hashes={},this._hashCounter=0,this.stateHash=0,this._useCounts={}}addDefaultModule(e){this._defaultModules.find(i=>i.name===e.name)||this._defaultModules.push(e),this.stateHash++}removeDefaultModule(e){const i=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(l=>l.name!==i),this.stateHash++}addShaderHook(e,i){i&&(e=Object.assign(i,{hook:e})),this._hookFunctions.push(e),this.stateHash++}get(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{vs:i="",fs:l="",defines:u={},inject:m={},varyings:y=[],bufferMode:T=35981,transpileToGLSL100:a=!1}=e,P=this._getModuleList(e.modules),D=this._getHash(i),N=this._getHash(l),F=P.map(ke=>this._getHash(ke.name)).sort(),W=y.map(ke=>this._getHash(ke)),oe=Object.keys(u).sort(),me=Object.keys(m).sort(),fe=[],Ee=[];for(const ke of oe)fe.push(this._getHash(ke)),fe.push(this._getHash(u[ke]));for(const ke of me)Ee.push(this._getHash(ke)),Ee.push(this._getHash(m[ke]));const Ce="".concat(D,"/").concat(N,"D").concat(fe.join("/"),"M").concat(F.join("/"),"I").concat(Ee.join("/"),"V").concat(W.join("/"),"H").concat(this.stateHash,"B").concat(T).concat(a?"T":"");if(!this._programCache[Ce]){const ke=OL(this.gl,{vs:i,fs:l,modules:P,inject:m,defines:u,hookFunctions:this._hookFunctions,transpileToGLSL100:a});this._programCache[Ce]=new j1(this.gl,{hash:Ce,vs:ke.vs,fs:ke.fs,varyings:y,bufferMode:T}),this._getUniforms[Ce]=ke.getUniforms||($e=>{}),this._useCounts[Ce]=0}return this._useCounts[Ce]++,this._programCache[Ce]}getUniforms(e){return this._getUniforms[e.hash]||null}release(e){const i=e.hash;this._useCounts[i]--,this._useCounts[i]===0&&(this._programCache[i].delete(),delete this._programCache[i],delete this._getUniforms[i],delete this._useCounts[i])}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}_getModuleList(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const i=new Array(this._defaultModules.length+e.length),l={};let u=0;for(let m=0,y=this._defaultModules.length;m<y;++m){const T=this._defaultModules[m],a=T.name;i[u++]=T,l[a]=!0}for(let m=0,y=e.length;m<y;++m){const T=e[m],a=T.name;l[a]||(i[u++]=T,l[a]=!0)}return i.length=u,i}}const Qk={POSITION:"positions",NORMAL:"normals",COLOR_0:"colors",TEXCOORD_0:"texCoords",TEXCOORD_1:"texCoords1",TEXCOORD_2:"texCoords2"};function e3(r,e,i){const l={};let u=e.indices;for(const m in e.attributes){const y=e.attributes[m],T=t3(m);if(m==="indices")u=y;else if(y.constant)l[T]=y.value;else{const a=y.value,P={...y};delete P.value,l[T]=[new Oi(r,a),P],i3(m,P)}}if(u){const m=u.value||u;xt(m instanceof Uint16Array||m instanceof Uint32Array,'attribute array for "indices" must be of integer type');const y={size:1,isIndexed:u.isIndexed===void 0?!0:u.isIndexed};l.indices=[new Oi(r,{data:m,target:34963}),y]}return l}function t3(r,e){const{attributeMap:i=Qk}={};return i&&i[r]||r}function i3(r,e){let i;switch(r){case"texCoords":case"texCoord1":case"texCoord2":case"texCoord3":i="uvs";break;case"vertices":case"positions":case"normals":case"pickingColors":i="vectors";break}switch(i){case"vectors":e.size=e.size||3;break;case"uvs":e.size=e.size||2;break}xt(Number.isFinite(e.size),"attribute ".concat(r," needs size"))}const pc=2,r3=1e4,n3="Model needs drawMode and vertexCount",Ax=()=>{},s3={};class o3{constructor(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{id:l=ca("model")}=i;xt(ap(e)),this.id=l,this.gl=e,this.id=i.id||ca("Model"),this.lastLogTime=0,this.animated=!1,this.initialize(i)}initialize(e){this.props={},this.programManager=e.programManager||Uh.getDefaultProgramManager(this.gl),this._programManagerState=-1,this._managedProgram=!1;const{program:i=null,vs:l,fs:u,modules:m,defines:y,inject:T,varyings:a,bufferMode:P,transpileToGLSL100:D}=e;this.programProps={program:i,vs:l,fs:u,modules:m,defines:y,inject:T,varyings:a,bufferMode:P,transpileToGLSL100:D},this.program=null,this.vertexArray=null,this._programDirty=!0,this.userData={},this.needsRedraw=!0,this._attributes={},this.attributes={},this.uniforms={},this.pickable=!0,this._checkProgram(),this.setUniforms(Object.assign({},this.getModuleUniforms(e.moduleSettings))),this.drawMode=e.drawMode!==void 0?e.drawMode:4,this.vertexCount=e.vertexCount||0,this.geometryBuffers={},this.isInstanced=e.isInstanced||e.instanced||e.instanceCount>0,this._setModelProps(e),this.geometry={},xt(this.drawMode!==void 0&&Number.isFinite(this.vertexCount),n3)}setProps(e){this._setModelProps(e)}delete(){for(const e in this._attributes)this._attributes[e]!==this.attributes[e]&&this._attributes[e].delete();this._managedProgram&&(this.programManager.release(this.program),this._managedProgram=!1),this.vertexArray.delete(),this._deleteGeometryBuffers()}getDrawMode(){return this.drawMode}getVertexCount(){return this.vertexCount}getInstanceCount(){return this.instanceCount}getAttributes(){return this.attributes}getProgram(){return this.program}setProgram(e){const{program:i,vs:l,fs:u,modules:m,defines:y,inject:T,varyings:a,bufferMode:P,transpileToGLSL100:D}=e;this.programProps={program:i,vs:l,fs:u,modules:m,defines:y,inject:T,varyings:a,bufferMode:P,transpileToGLSL100:D},this._programDirty=!0}getUniforms(){return this.uniforms}setDrawMode(e){return this.drawMode=e,this}setVertexCount(e){return xt(Number.isFinite(e)),this.vertexCount=e,this}setInstanceCount(e){return xt(Number.isFinite(e)),this.instanceCount=e,this}setGeometry(e){return this.drawMode=e.drawMode,this.vertexCount=e.getVertexCount(),this._deleteGeometryBuffers(),this.geometryBuffers=e3(this.gl,e),this.vertexArray.setAttributes(this.geometryBuffers),this}setAttributes(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(Pc(e))return this;const i={};for(const l in e){const u=e[l];i[l]=u.getValue?u.getValue():u}return this.vertexArray.setAttributes(i),this}setUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Object.assign(this.uniforms,e),this}getModuleUniforms(e){this._checkProgram();const i=this.programManager.getUniforms(this.program);return i?i(e):{}}updateModuleSettings(e){const i=this.getModuleUniforms(e||{});return this.setUniforms(i)}clear(e){return f_(this.program.gl,e),this}draw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._checkProgram();const{moduleSettings:i=null,framebuffer:l,uniforms:u={},attributes:m={},transformFeedback:y=this.transformFeedback,parameters:T={},vertexArray:a=this.vertexArray}=e;this.setAttributes(m),this.updateModuleSettings(i),this.setUniforms(u);let P;Ct.priority>=pc&&(P=this._logDrawCallStart(pc));const D=this.vertexArray.getDrawParams(),{isIndexed:N=D.isIndexed,indexType:F=D.indexType,indexOffset:W=D.indexOffset,vertexArrayInstanced:oe=D.isInstanced}=this.props;oe&&!this.isInstanced&&Ct.warn("Found instanced attributes on non-instanced model",this.id)();const{isInstanced:me,instanceCount:fe}=this,{onBeforeRender:Ee=Ax,onAfterRender:Ce=Ax}=this.props;Ee(),this.program.setUniforms(this.uniforms);const ke=this.program.draw(Object.assign(s3,e,{logPriority:P,uniforms:null,framebuffer:l,parameters:T,drawMode:this.getDrawMode(),vertexCount:this.getVertexCount(),vertexArray:a,transformFeedback:y,isIndexed:N,indexType:F,isInstanced:me,instanceCount:fe,offset:N?W:0}));return Ce(),Ct.priority>=pc&&this._logDrawCallEnd(P,a,l),ke}transform(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{discard:i=!0,feedbackBuffers:l,unbindModels:u=[]}=e;let{parameters:m}=e;l&&this._setFeedbackBuffers(l),i&&(m=Object.assign({},m,{35977:i})),u.forEach(y=>y.vertexArray.unbindBuffers());try{this.draw(Object.assign({},e,{parameters:m}))}finally{u.forEach(y=>y.vertexArray.bindBuffers())}return this}render(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Ct.warn("Model.render() is deprecated. Use Model.setUniforms() and Model.draw()")(),this.setUniforms(e).draw()}_setModelProps(e){Object.assign(this.props,e),"uniforms"in e&&this.setUniforms(e.uniforms),"pickable"in e&&(this.pickable=e.pickable),"instanceCount"in e&&(this.instanceCount=e.instanceCount),"geometry"in e&&this.setGeometry(e.geometry),"attributes"in e&&this.setAttributes(e.attributes),"_feedbackBuffers"in e&&this._setFeedbackBuffers(e._feedbackBuffers)}_checkProgram(){if(!(this._programDirty||this.programManager.stateHash!==this._programManagerState))return;let{program:i}=this.programProps;if(i)this._managedProgram=!1;else{const{vs:l,fs:u,modules:m,inject:y,defines:T,varyings:a,bufferMode:P,transpileToGLSL100:D}=this.programProps;i=this.programManager.get({vs:l,fs:u,modules:m,inject:y,defines:T,varyings:a,bufferMode:P,transpileToGLSL100:D}),this.program&&this._managedProgram&&this.programManager.release(this.program),this._programManagerState=this.programManager.stateHash,this._managedProgram=!0}xt(i instanceof j1,"Model needs a program"),this._programDirty=!1,i!==this.program&&(this.program=i,this.vertexArray?this.vertexArray.setProps({program:this.program,attributes:this.vertexArray.attributes}):this.vertexArray=new HC(this.gl,{program:this.program}),this.setUniforms(Object.assign({},this.getModuleUniforms())))}_deleteGeometryBuffers(){for(const e in this.geometryBuffers){const i=this.geometryBuffers[e][0]||this.geometryBuffers[e];i instanceof Oi&&i.delete()}}_setAnimationProps(e){this.animated&&xt(e,"Model.draw(): animated uniforms but no animationProps")}_setFeedbackBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(Pc(e))return this;const{gl:i}=this.program;return this.transformFeedback=this.transformFeedback||new V1(i,{program:this.program}),this.transformFeedback.setBuffers(e),this}_logDrawCallStart(e){const i=e>3?0:r3;if(!(Date.now()-this.lastLogTime<i))return this.lastLogTime=Date.now(),Ct.group(pc,">>> DRAWING MODEL ".concat(this.id),{collapsed:Ct.level<=2})(),e}_logDrawCallEnd(e,i,l,u){if(e===void 0)return;const m=JC({vertexArray:i,header:"".concat(this.id," attributes"),attributes:this._attributes}),{table:y,unusedTable:T,unusedCount:a}=fx({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,l)}),{table:P,count:D}=fx({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,l),undefinedOnly:!0});D>0&&Ct.log("MISSING UNIFORMS",Object.keys(P))(),a>0&&Ct.log("UNUSED UNIFORMS",Object.keys(T))();const N=eL(this.vertexArray.configuration);Ct.table(e,m)(),Ct.table(e,y)(),Ct.table(e+1,N)(),u&&u.log({logLevel:pc,message:"Rendered to ".concat(u.id)}),Ct.groupEnd(pc)()}}class a3{constructor(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.currentIndex=0,this.feedbackMap={},this.varyings=null,this.bindings=[],this.resources={},this._initialize(i),Object.seal(this)}setupResources(e){for(const i of this.bindings)this._setupTransformFeedback(i,e)}updateModelProps(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{varyings:i}=this;return i.length>0&&(e=Object.assign({},e,{varyings:i})),e}getDrawOptions(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const i=this.bindings[this.currentIndex],{sourceBuffers:l,transformFeedback:u}=i;return{attributes:Object.assign({},l,e.attributes),transformFeedback:u}}swap(){return this.feedbackMap?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(e)}getBuffer(e){const{feedbackBuffers:i}=this.bindings[this.currentIndex],l=e?i[e]:null;return l?l instanceof Oi?l:l.buffer:null}getData(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{varyingName:i}=e,l=this.getBuffer(i);return l?l.getData():null}delete(){for(const e in this.resources)this.resources[e].delete()}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(e),this.varyings=e.varyings||Object.keys(this.bindings[this.currentIndex].feedbackBuffers),this.varyings.length>0&&xt(ai(this.gl))}_getFeedbackBuffers(e){const{sourceBuffers:i={}}=e,l={};if(this.bindings[this.currentIndex]&&Object.assign(l,this.bindings[this.currentIndex].feedbackBuffers),this.feedbackMap)for(const u in this.feedbackMap){const m=this.feedbackMap[u];u in i&&(l[m]=u)}Object.assign(l,e.feedbackBuffers);for(const u in l){const m=l[u];if(typeof m=="string"){const y=i[m],{byteLength:T,usage:a,accessor:P}=y;l[u]=this._createNewBuffer(u,{byteLength:T,usage:a,accessor:P})}}return l}_setupBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:i=null}=e;Object.assign(this.feedbackMap,e.feedbackMap);const l=this._getFeedbackBuffers(e);this._updateBindings({sourceBuffers:i,feedbackBuffers:l})}_setupTransformFeedback(e,i){let{model:l}=i;const{program:u}=l;e.transformFeedback=new V1(this.gl,{program:u,buffers:e.feedbackBuffers})}_updateBindings(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this.feedbackMap){const{sourceBuffers:i,feedbackBuffers:l}=this._swapBuffers(this.bindings[this.currentIndex]),u=this._getNextIndex();this.bindings[u]=this._updateBinding(this.bindings[u],{sourceBuffers:i,feedbackBuffers:l})}}_updateBinding(e,i){return e?(Object.assign(e.sourceBuffers,i.sourceBuffers),Object.assign(e.feedbackBuffers,i.feedbackBuffers),e.transformFeedback&&e.transformFeedback.setBuffers(e.feedbackBuffers),e):{sourceBuffers:Object.assign({},i.sourceBuffers),feedbackBuffers:Object.assign({},i.feedbackBuffers)}}_swapBuffers(e){if(!this.feedbackMap)return null;const i=Object.assign({},e.sourceBuffers),l=Object.assign({},e.feedbackBuffers);for(const u in this.feedbackMap){const m=this.feedbackMap[u];i[u]=e.feedbackBuffers[m],l[m]=e.sourceBuffers[u],xt(l[m]instanceof Oi)}return{sourceBuffers:i,feedbackBuffers:l}}_createNewBuffer(e,i){const l=new Oi(this.gl,i);return this.resources[e]&&this.resources[e].delete(),this.resources[e]=l,l}_getNextIndex(){return(this.currentIndex+1)%2}}const l3="transform_uSampler_",Yd="transform_uSize_",Mx="transform_position";function c3(r){let{vs:e,sourceTextureMap:i,targetTextureVarying:l,targetTexture:u}=r,y=Object.keys(i).length,T=null;const a={};let P=e,D={};if(y>0||l){const N=P.split(`
`),F=N.slice();if(N.forEach((W,oe,me)=>{if(y>0){const fe=p3(W,i);if(fe){const{updatedLine:Ee,inject:Ce}=fe;F[oe]=Ee,D=Og([D,Ce]),Object.assign(a,fe.samplerTextureMap),y--}}l&&!T&&(T=d3(W,l))}),l){xt(u);const W="".concat(Yd).concat(l),oe="uniform vec2 ".concat(W,`;
`),me="     vec2 ".concat(Mx," = transform_getPos(").concat(W,`);
     gl_Position = vec4(`).concat(Mx,`, 0, 1.);
`);D=Og([D,{"vs:#decl":oe,"vs:#main-start":me}])}P=F.join(`
`)}return{vs:P,targetTextureType:T,inject:D,samplerTextureMap:a}}function u3(r){let{sourceTextureMap:e,targetTextureVarying:i,targetTexture:l}=r;const u={};let m,y;i&&({width:m,height:y}=l,u["".concat(Yd).concat(i)]=[m,y]);for(const T in e)({width:m,height:y}=e[T]),u["".concat(Yd).concat(T)]=[m,y];return u}function h3(r){return H1(r,["attribute","in"])}function f3(r){const e="".concat(l3).concat(r),i="".concat(Yd).concat(r),l="  uniform sampler2D ".concat(e,`;
  uniform vec2 `).concat(i,";");return{samplerName:e,sizeName:i,uniformDeclerations:l}}function d3(r,e){const i=H1(r,["varying","out"]);return i&&i.name===e?i.type:null}function p3(r,e){const i={},l=h3(r);if(!l)return null;const{type:u,name:m}=l;if(m&&e[m]){const y="// ".concat(r," => Replaced by Transform with a sampler"),{samplerName:T,sizeName:a,uniformDeclerations:P}=f3(m),D=GL(u),N="  ".concat(u," ").concat(m," = transform_getInput(").concat(T,", ").concat(a,").").concat(D,`;
`);return i[T]=m,{updatedLine:y,inject:{"vs:#decl":P,"vs:#main-start":N},samplerTextureMap:i}}return null}const m3={10241:9728,10240:9728,10242:33071,10243:33071},g3="transform_output";class _3{constructor(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.id=this.currentIndex=0,this._swapTexture=null,this.targetTextureVarying=null,this.targetTextureType=null,this.samplerTextureMap=null,this.bindings=[],this.resources={},this._initialize(i),Object.seal(this)}updateModelProps(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const i=this._processVertexShader(e);return Object.assign({},e,i)}getDrawOptions(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:i,sourceTextures:l,framebuffer:u,targetTexture:m}=this.bindings[this.currentIndex],y=Object.assign({},i,e.attributes),T=Object.assign({},e.uniforms),a=Object.assign({},e.parameters);let P=e.discard;if(this.hasSourceTextures||this.hasTargetTexture){y.transform_elementID=this.elementIDBuffer;for(const N in this.samplerTextureMap){const F=this.samplerTextureMap[N];T[N]=l[F]}this._setSourceTextureParameters();const D=u3({sourceTextureMap:l,targetTextureVarying:this.targetTextureVarying,targetTexture:m});Object.assign(T,D)}return this.hasTargetTexture&&(P=!1,a.viewport=[0,0,u.width,u.height]),{attributes:y,framebuffer:u,uniforms:T,discard:P,parameters:a}}swap(){return this._swapTexture?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupTextures(e)}getTargetTexture(){const{targetTexture:e}=this.bindings[this.currentIndex];return e}getData(){let{packed:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{framebuffer:i}=this.bindings[this.currentIndex],l=cp(i);if(!e)return l;const u=l.constructor,m=ZL(this.targetTextureType),y=new u(l.length*m/4);let T=0;for(let a=0;a<l.length;a+=4)for(let P=0;P<m;P++)y[T++]=l[a+P];return y}getFramebuffer(){return this.bindings[this.currentIndex].framebuffer}delete(){this.ownTexture&&this.ownTexture.delete(),this.elementIDBuffer&&this.elementIDBuffer.delete()}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{_targetTextureVarying:i,_swapTexture:l}=e;this._swapTexture=l,this.targetTextureVarying=i,this.hasTargetTexture=i,this._setupTextures(e)}_createTargetTexture(e){const{sourceTextures:i,textureOrReference:l}=e;if(l instanceof In)return l;const u=i[l];return u?(this._targetRefTexName=l,this._createNewTexture(u)):null}_setupTextures(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:i,_sourceTextures:l={},_targetTexture:u}=e,m=this._createTargetTexture({sourceTextures:l,textureOrReference:u});this.hasSourceTextures=this.hasSourceTextures||l&&Object.keys(l).length>0,this._updateBindings({sourceBuffers:i,sourceTextures:l,targetTexture:m}),"elementCount"in e&&this._updateElementIDBuffer(e.elementCount)}_updateElementIDBuffer(e){if(typeof e!="number"||this.elementCount>=e)return;const i=new Float32Array(e);i.forEach((l,u,m)=>{m[u]=u}),this.elementIDBuffer?this.elementIDBuffer.setData({data:i}):this.elementIDBuffer=new Oi(this.gl,{data:i,accessor:{size:1}}),this.elementCount=e}_updateBindings(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this._swapTexture){const{sourceTextures:i,targetTexture:l}=this._swapTextures(this.bindings[this.currentIndex]),u=this._getNextIndex();this.bindings[u]=this._updateBinding(this.bindings[u],{sourceTextures:i,targetTexture:l})}}_updateBinding(e,i){const{sourceBuffers:l,sourceTextures:u,targetTexture:m}=i;if(e||(e={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(e.sourceTextures,u),Object.assign(e.sourceBuffers,l),m){e.targetTexture=m;const{width:y,height:T}=m,{framebuffer:a}=e;a?(a.update({attachments:{36064:m},resizeAttachments:!1}),a.resize({width:y,height:T})):e.framebuffer=new tr(this.gl,{id:"transform-framebuffer",width:y,height:T,attachments:{36064:m}})}return e}_setSourceTextureParameters(){const e=this.currentIndex,{sourceTextures:i}=this.bindings[e];for(const l in i)i[l].setParameters(m3)}_swapTextures(e){if(!this._swapTexture)return null;const i=Object.assign({},e.sourceTextures);i[this._swapTexture]=e.targetTexture;const l=e.sourceTextures[this._swapTexture];return{sourceTextures:i,targetTexture:l}}_createNewTexture(e){const i=FI(e,{parameters:{10241:9728,10240:9728,10242:33071,10243:33071},pixelStore:{37440:!1}});return this.ownTexture&&this.ownTexture.delete(),this.ownTexture=i,i}_getNextIndex(){return(this.currentIndex+1)%2}_processVertexShader(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceTextures:i,targetTexture:l}=this.bindings[this.currentIndex],{vs:u,uniforms:m,targetTextureType:y,inject:T,samplerTextureMap:a}=c3({vs:e.vs,sourceTextureMap:i,targetTextureVarying:this.targetTextureVarying,targetTexture:l}),P=Og([e.inject||{},T]);this.targetTextureType=y,this.samplerTextureMap=a;const D=e._fs||Y1({version:N1(u),input:this.targetTextureVarying,inputType:y,output:g3}),N=this.hasSourceTextures||this.targetTextureVarying?[Jk].concat(e.modules||[]):e.modules;return{vs:u,fs:D,modules:N,uniforms:m,inject:P}}}class __{static isSupported(e){return ai(e)}constructor(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.model=null,this.elementCount=0,this.bufferTransform=null,this.textureTransform=null,this.elementIDBuffer=null,this._initialize(i),Object.seal(this)}delete(){const{model:e,bufferTransform:i,textureTransform:l}=this;e&&e.delete(),i&&i.delete(),l&&l.delete()}run(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{clearRenderTarget:i=!0}=e,l=this._updateDrawOptions(e);i&&l.framebuffer&&l.framebuffer.clear({color:!0}),this.model.transform(l)}swap(){let e=!1;const i=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const l of i)e=e||l.swap();xt(e,"Nothing to swap")}getBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return this.bufferTransform&&this.bufferTransform.getBuffer(e)}getData(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const i=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const l of i){const u=l.getData(e);if(u)return u}return null}getFramebuffer(){return this.textureTransform&&this.textureTransform.getFramebuffer()}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};"elementCount"in e&&this.model.setVertexCount(e.elementCount);const i=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const l of i)l.update(e)}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{gl:i}=this;this._buildResourceTransforms(i,e),e=this._updateModelProps(e),this.model=new o3(i,Object.assign({},e,{fs:e.fs||Y1({version:N1(e.vs)}),id:e.id||"transform-model",drawMode:e.drawMode||0,vertexCount:e.elementCount})),this.bufferTransform&&this.bufferTransform.setupResources({model:this.model})}_updateModelProps(e){let i=Object.assign({},e);const l=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const u of l)i=u.updateModelProps(i);return i}_buildResourceTransforms(e,i){y3(i)&&(this.bufferTransform=new a3(e,i)),v3(i)&&(this.textureTransform=new _3(e,i)),xt(this.bufferTransform||this.textureTransform,"must provide source/feedback buffers or source/target textures")}_updateDrawOptions(e){let i=Object.assign({},e);const l=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const u of l)i=Object.assign(i,u.getDrawOptions(i));return i}}function y3(r){return!!(!Pc(r.feedbackBuffers)||!Pc(r.feedbackMap)||r.varyings&&r.varyings.length>0)}function v3(r){return!!(!Pc(r._sourceTextures)||r._targetTexture||r._targetTextureVarying)}const Px={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class MF{static get DRAW_MODE(){return Px}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{id:i=ca("geometry"),drawMode:l=Px.TRIANGLES,attributes:u={},indices:m=null,vertexCount:y=null}=e;this.id=i,this.drawMode=l|0,this.attributes={},this.userData={},this._setAttributes(u,m),this.vertexCount=y||this._calculateVertexCount(this.attributes,this.indices)}get mode(){return this.drawMode}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return"Geometry ".concat(this.id," attribute ").concat(e)}_setAttributes(e,i){i&&(this.indices=ArrayBuffer.isView(i)?{value:i,size:1}:i);for(const l in e){let u=e[l];u=ArrayBuffer.isView(u)?{value:u}:u,xt(ArrayBuffer.isView(u.value),"".concat(this._print(l),": must be typed array or object with value as typed array")),(l==="POSITION"||l==="positions")&&!u.size&&(u.size=3),l==="indices"?(xt(!this.indices),this.indices=u):this.attributes[l]=u}return this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this}_calculateVertexCount(e,i){if(i)return i.value.length;let l=1/0;for(const u in e){const m=e[u],{value:y,size:T,constant:a}=m;!a&&y&&T>=1&&(l=Math.min(l,y.length/T))}return xt(Number.isFinite(l)),l}}let x3=1,b3=1;class nw{constructor(){this.time=0,this.channels=new Map,this.animations=new Map,this.playing=!1,this.lastEngineTime=-1}addChannel(e){const{delay:i=0,duration:l=Number.POSITIVE_INFINITY,rate:u=1,repeat:m=1}=e,y=x3++,T={time:0,delay:i,duration:l,rate:u,repeat:m};return this._setChannelTime(T,this.time),this.channels.set(y,T),y}removeChannel(e){this.channels.delete(e);for(const[i,l]of this.animations)l.channel===e&&this.detachAnimation(i)}isFinished(e){const i=this.channels.get(e);return i===void 0?!1:this.time>=i.delay+i.duration*i.repeat}getTime(e){if(e===void 0)return this.time;const i=this.channels.get(e);return i===void 0?-1:i.time}setTime(e){this.time=Math.max(0,e);const i=this.channels.values();for(const u of i)this._setChannelTime(u,this.time);const l=this.animations.values();for(const u of l){const{animation:m,channel:y}=u;m.setTime(this.getTime(y))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,i){const l=b3++;return this.animations.set(l,{animation:e,channel:i}),e.setTime(this.getTime(i)),l}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,i){const l=i-e.delay,u=e.duration*e.repeat;l>=u?e.time=e.duration*e.rate:(e.time=Math.max(0,l)%e.duration,e.time*=e.rate)}}const sw="#define SMOOTH_EDGE_RADIUS 0.5",w3=`
`.concat(sw,`

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`),T3=`
`.concat(sw,`

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`),E3={name:"geometry",vs:w3,fs:T3},Ti={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(Ti,"IDENTITY",{get:()=>(Ii.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const Bs={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},Ix={common:0,meters:1,pixels:2},Cx={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}},jh={DRAW:"draw",MASK:"mask"},S3=Object.keys(Ti).map(r=>"const int COORDINATE_SYSTEM_".concat(r," = ").concat(Ti[r],";")).join(""),A3=Object.keys(Bs).map(r=>"const int PROJECTION_MODE_".concat(r," = ").concat(Bs[r],";")).join(""),M3=Object.keys(Ix).map(r=>"const int UNIT_".concat(r.toUpperCase()," = ").concat(Ix[r],";")).join(""),P3="".concat(S3,`
`).concat(A3,`
`).concat(M3,`

uniform int project_uCoordinateSystem;
uniform int project_uProjectionMode;
uniform float project_uScale;
uniform bool project_uWrapLongitude;
uniform vec3 project_uCommonUnitsPerMeter;
uniform vec3 project_uCommonUnitsPerWorldUnit;
uniform vec3 project_uCommonUnitsPerWorldUnit2;
uniform vec4 project_uCenter;
uniform mat4 project_uModelMatrix;
uniform mat4 project_uViewProjectionMatrix;
uniform vec2 project_uViewportSize;
uniform float project_uDevicePixelRatio;
uniform float project_uFocalDistance;
uniform vec3 project_uCameraPosition;
uniform vec3 project_uCoordinateOrigin;
uniform vec3 project_uCommonOrigin;
uniform bool project_uPseudoMeters;

const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0; // meters
const float GLOBE_RADIUS = 256.0;

// returns an adjustment factor for uCommonUnitsPerMeter
float project_size_at_latitude(float lat) {
  float y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

float project_size() {
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR &&
    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
    project_uPseudoMeters == false) {

    // uCommonUnitsPerMeter in low-zoom Web Mercator is non-linear
    // Adjust by 1 / cos(latitude)
    // If geometry.position (vertex in common space) is populated, use it
    // Otherwise use geometry.worldPosition (anchor in world space)
    
    if (geometry.position.w == 0.0) {
      return project_size_at_latitude(geometry.worldPosition.y);
    }

    // latitude from common y: 2.0 * (atan(exp(y / TILE_SIZE * 2.0 * PI - PI)) - PI / 4.0)
    // Taylor series of 1 / cos(latitude)
    // Max error < 0.003
  
    float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    float y2 = y * y;
    float y4 = y2 * y2;
    float y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

float project_size_at_latitude(float meters, float lat) {
  return meters * project_uCommonUnitsPerMeter.z * project_size_at_latitude(lat);
}

//
// Scaling offsets - scales meters to "world distance"
// Note the scalar version of project_size is for scaling the z component only
//
float project_size(float meters) {
  return meters * project_uCommonUnitsPerMeter.z * project_size();
}

vec2 project_size(vec2 meters) {
  return meters * project_uCommonUnitsPerMeter.xy * project_size();
}

vec3 project_size(vec3 meters) {
  return meters * project_uCommonUnitsPerMeter * project_size();
}

vec4 project_size(vec4 meters) {
  return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);
}

// Get rotation matrix that aligns the z axis with the given up vector
// Find 3 unit vectors ux, uy, uz that are perpendicular to each other and uz == up
mat3 project_get_orientation_matrix(vec3 up) {
  vec3 uz = normalize(up);
  // Tangent on XY plane
  vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
  vec3 uy = cross(uz, ux);
  return mat3(ux, uy, uz);
}

bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    transform = project_get_orientation_matrix(commonPosition);
    return true;
  }
  return false;
}

//
// Projecting normal - transform deltas from current coordinate system to
// normals in the worldspace
//
vec3 project_normal(vec3 vector) {
  // Apply model matrix
  vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);
  vec3 n = normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);
  mat3 rotation;
  if (project_needs_rotation(geometry.position.xyz, rotation)) {
    n = rotation * n;
  }
  return n;
}

vec4 project_offset_(vec4 offset) {
  float dy = offset.y;
  vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;
  return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}

//
// Projecting positions - non-linear projection: lnglats => unit tile [0-1, 0-1]
//
vec2 project_mercator_(vec2 lnglat) {
  float x = lnglat.x;
  if (project_uWrapLongitude) {
    x = mod(x + 180., 360.0) - 180.;
  }
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

vec3 project_globe_(vec3 lnglatz) {
  float lambda = radians(lnglatz.x);
  float phi = radians(lnglatz.y);
  float cosPhi = cos(phi);
  float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;

  return vec3(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}

//
// Projects positions (defined by project_uCoordinateSystem) to common space (defined by project_uProjectionMode)
//
vec4 project_position(vec4 position, vec3 position64Low) {
  vec4 position_world = project_uModelMatrix * position;

  // Work around for a Mac+NVIDIA bug https://github.com/visgl/deck.gl/issues/4145
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_mercator_(position_world.xy),
        project_size_at_latitude(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world.xyz += project_uCoordinateOrigin;
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {
        // Too far from the projection center for offset mode to be accurate
        // Only use high parts
        return vec4(
          project_mercator_(position_world.xy) - project_uCommonOrigin.xy,
          project_size(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||
    (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
    (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
     project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    // Subtract high part of 64 bit value. Convert remainder to float32, preserving precision.
    position_world.xyz -= project_uCoordinateOrigin;
  }

  // Translation is already added to the high parts
  return project_offset_(position_world + project_uModelMatrix * vec4(position64Low, 0.0));
}

vec4 project_position(vec4 position) {
  return project_position(position, ZERO_64_LOW);
}

vec3 project_position(vec3 position, vec3 position64Low) {
  vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
  return projected_position.xyz;
}

vec3 project_position(vec3 position) {
  vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

vec2 project_position(vec2 position) {
  vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  return viewProjectionMatrix * position + center;
}

//
// Projects from common space coordinates to clip space.
// Uses project_uViewProjectionMatrix
//
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);
}

// Returns a clip space offset that corresponds to a given number of screen pixels
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;
  return offset * project_uFocalDistance;
}

float project_size_to_pixel(float meters) {
  return project_size(meters) * project_uScale;
}
float project_size_to_pixel(float size, int unit) {
  if (unit == UNIT_METERS) return project_size_to_pixel(size);
  if (unit == UNIT_COMMON) return size * project_uScale;
  // UNIT_PIXELS
  return size;
}
float project_pixel_size(float pixels) {
  return pixels / project_uScale;
}
vec2 project_pixel_size(vec2 pixels) {
  return pixels / project_uScale;
}
`);function I3(r,e){if(r===e)return!0;if(Array.isArray(r)){const i=r.length;if(!e||e.length!==i)return!1;for(let l=0;l<i;l++)if(r[l]!==e[l])return!1;return!0}return!1}function hp(r){let e={},i;return l=>{for(const u in l)if(!I3(l[u],e[u])){i=r(l),e=l;break}return i}}const Lx=[0,0,0,0],C3=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],ow=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],L3=[0,0,0],aw=[0,0,0],k3=hp(D3);function lw(r,e,i=aw){i.length<3&&(i=[i[0],i[1],0]);let l=i,u,m=!0;switch(e===Ti.LNGLAT_OFFSETS||e===Ti.METER_OFFSETS?u=i:u=r.isGeospatial?[Math.fround(r.longitude),Math.fround(r.latitude),0]:null,r.projectionMode){case Bs.WEB_MERCATOR:(e===Ti.LNGLAT||e===Ti.CARTESIAN)&&(u=[0,0,0],m=!1);break;case Bs.WEB_MERCATOR_AUTO_OFFSET:e===Ti.LNGLAT?l=u:e===Ti.CARTESIAN&&(l=[Math.fround(r.center[0]),Math.fround(r.center[1]),0],u=r.unprojectPosition(l),l[0]-=i[0],l[1]-=i[1],l[2]-=i[2]);break;case Bs.IDENTITY:l=r.position.map(Math.fround),l[2]=l[2]||0;break;case Bs.GLOBE:m=!1,u=null;break;default:m=!1}return{geospatialOrigin:u,shaderCoordinateOrigin:l,offsetMode:m}}function R3(r,e,i){const{viewMatrixUncentered:l,projectionMatrix:u}=r;let{viewMatrix:m,viewProjectionMatrix:y}=r,T=Lx,a=Lx,P=r.cameraPosition;const{geospatialOrigin:D,shaderCoordinateOrigin:N,offsetMode:F}=lw(r,e,i);return F&&(a=r.projectPosition(D||N),P=[P[0]-a[0],P[1]-a[1],P[2]-a[2]],a[3]=1,T=Nh([],a,y),m=l||m,y=Ns([],u,m),y=Ns([],y,C3)),{viewMatrix:m,viewProjectionMatrix:y,projectionCenter:T,originCommon:a,cameraPosCommon:P,shaderCoordinateOrigin:N,geospatialOrigin:D}}function O3({viewport:r,devicePixelRatio:e=1,modelMatrix:i=null,coordinateSystem:l=Ti.DEFAULT,coordinateOrigin:u=aw,autoWrapLongitude:m=!1}){l===Ti.DEFAULT&&(l=r.isGeospatial?Ti.LNGLAT:Ti.CARTESIAN);const y=k3({viewport:r,devicePixelRatio:e,coordinateSystem:l,coordinateOrigin:u});return y.project_uWrapLongitude=m,y.project_uModelMatrix=i||ow,y}function D3({viewport:r,devicePixelRatio:e,coordinateSystem:i,coordinateOrigin:l}){const{projectionCenter:u,viewProjectionMatrix:m,originCommon:y,cameraPosCommon:T,shaderCoordinateOrigin:a,geospatialOrigin:P}=R3(r,i,l),D=r.getDistanceScales(),N=[r.width*e,r.height*e],F=Nh([],[0,0,-r.focalDistance,1],r.projectionMatrix)[3]||1,W={project_uCoordinateSystem:i,project_uProjectionMode:r.projectionMode,project_uCoordinateOrigin:a,project_uCommonOrigin:y.slice(0,3),project_uCenter:u,project_uPseudoMeters:!!r._pseudoMeters,project_uViewportSize:N,project_uDevicePixelRatio:e,project_uFocalDistance:F,project_uCommonUnitsPerMeter:D.unitsPerMeter,project_uCommonUnitsPerWorldUnit:D.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:L3,project_uScale:r.scale,project_uWrapLongitude:!1,project_uViewProjectionMatrix:m,project_uModelMatrix:ow,project_uCameraPosition:T};if(P){const oe=r.getDistanceScales(P);switch(i){case Ti.METER_OFFSETS:W.project_uCommonUnitsPerWorldUnit=oe.unitsPerMeter,W.project_uCommonUnitsPerWorldUnit2=oe.unitsPerMeter2;break;case Ti.LNGLAT:case Ti.LNGLAT_OFFSETS:r._pseudoMeters||(W.project_uCommonUnitsPerMeter=oe.unitsPerMeter),W.project_uCommonUnitsPerWorldUnit=oe.unitsPerDegree,W.project_uCommonUnitsPerWorldUnit2=oe.unitsPerDegree2;break;case Ti.CARTESIAN:W.project_uCommonUnitsPerWorldUnit=[1,1,oe.unitsPerMeter[2]],W.project_uCommonUnitsPerWorldUnit2=[0,0,oe.unitsPerMeter2[2]];break}}return W}const z3={};function B3(r=z3){return"viewport"in r?O3(r):{}}const y_={name:"project",dependencies:[qL,E3],vs:P3,getUniforms:B3},F3=`
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,PF={name:"project32",dependencies:[y_],vs:F3};function Fd(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function wc(r,e){const i=Nh([],e,r);return Fk(i,i,1/i[3]),i}function kx(r,e){const i=r%e;return i<0?e+i:i}function N3(r,e,i){return i*e+(1-i)*r}function Fg(r,e,i){return r<e?e:r>i?i:r}function U3(r){return Math.log(r)*Math.LOG2E}const v_=Math.log2||U3;function To(r,e){if(!r)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const us=Math.PI,cw=us/4,hs=us/180,Ng=180/us,Ih=512,Ug=4003e4,Md=85.051129,uw=1.5;function jg(r){return Math.pow(2,r)}function hw(r){return v_(r)}function Fs(r){const[e,i]=r;To(Number.isFinite(e)),To(Number.isFinite(i)&&i>=-90&&i<=90,"invalid latitude");const l=e*hs,u=i*hs,m=Ih*(l+us)/(2*us),y=Ih*(us+Math.log(Math.tan(cw+u*.5)))/(2*us);return[m,y]}function Us(r){const[e,i]=r,l=e/Ih*(2*us)-us,u=2*(Math.atan(Math.exp(i/Ih*(2*us)-us))-cw);return[l*Ng,u*Ng]}function j3(r){const{latitude:e}=r;To(Number.isFinite(e));const i=Math.cos(e*hs);return hw(Ug*i)-9}function Kd(r){const{latitude:e,longitude:i,highPrecision:l=!1}=r;To(Number.isFinite(e)&&Number.isFinite(i));const u=Ih,m=Math.cos(e*hs),y=u/360,T=y/m,a=u/Ug/m,P={unitsPerMeter:[a,a,a],metersPerUnit:[1/a,1/a,1/a],unitsPerDegree:[y,T,a],degreesPerUnit:[1/y,1/T,1/a]};if(l){const D=hs*Math.tan(e*hs)/m,N=y*D/2,F=u/Ug*D,W=F/T*a;P.unitsPerDegree2=[0,N,F],P.unitsPerMeter2=[W,0,W]}return P}function fw(r,e){const[i,l,u]=r,[m,y,T]=e,{unitsPerMeter:a,unitsPerMeter2:P}=Kd({longitude:i,latitude:l,highPrecision:!0}),D=Fs(r);D[0]+=m*(a[0]+P[0]*y),D[1]+=y*(a[1]+P[1]*y);const N=Us(D),F=(u||0)+(T||0);return Number.isFinite(u)||Number.isFinite(T)?[N[0],N[1],F]:N}function dw(r){const{height:e,pitch:i,bearing:l,altitude:u,scale:m,center:y}=r,T=Fd();Ph(T,T,[0,0,-u]),tw(T,T,-i*hs),iw(T,T,l*hs);const a=m/e;return up(T,T,[a,a,a]),y&&Ph(T,T,pk([],y)),T}function pw(r){const{width:e,height:i,altitude:l,pitch:u=0,offset:m,center:y,scale:T,nearZMultiplier:a=1,farZMultiplier:P=1}=r;let{fovy:D=Rc(uw)}=r;l!==void 0&&(D=Rc(l));const N=D*hs,F=u*hs,W=x_(D);let oe=W;y&&(oe+=y[2]*T/Math.cos(F)/i);const me=N*(.5+(m?m[1]:0)/i),fe=Math.sin(me)*oe/Math.sin(Fg(Math.PI/2-F-me,.01,Math.PI-.01)),Ee=Math.sin(F)*fe+oe,Ce=oe*10,ke=Math.min(Ee*P,Ce);return{fov:N,aspect:e/i,focalDistance:W,near:a,far:ke}}function V3(r){const{fov:e,aspect:i,near:l,far:u}=pw(r);return rw([],e,i,l,u)}function Rc(r){return 2*Math.atan(.5/r)*Ng}function x_(r){return .5/Math.tan(.5*r*hs)}function b_(r,e){const[i,l,u=0]=r;return To(Number.isFinite(i)&&Number.isFinite(l)&&Number.isFinite(u)),wc(e,[i,l,u,1])}function Oc(r,e,i=0){const[l,u,m]=r;if(To(Number.isFinite(l)&&Number.isFinite(u),"invalid pixel coordinate"),Number.isFinite(m))return wc(e,[l,u,m,1]);const y=wc(e,[l,u,0,1]),T=wc(e,[l,u,1,1]),a=y[2],P=T[2],D=a===P?0:((i||0)-a)/(P-a);return J1([],y,T,D)}function w_(r){const{width:e,height:i,bounds:l,minExtent:u=0,maxZoom:m=24,offset:y=[0,0]}=r,[[T,a],[P,D]]=l,N=G3(r.padding),F=Fs([T,Fg(D,-Md,Md)]),W=Fs([P,Fg(a,-Md,Md)]),oe=[Math.max(Math.abs(W[0]-F[0]),u),Math.max(Math.abs(W[1]-F[1]),u)],me=[e-N.left-N.right-Math.abs(y[0])*2,i-N.top-N.bottom-Math.abs(y[1])*2];To(me[0]>0&&me[1]>0);const fe=me[0]/oe[0],Ee=me[1]/oe[1],Ce=(N.right-N.left)/2/fe,ke=(N.top-N.bottom)/2/Ee,$e=[(W[0]+F[0])/2+Ce,(W[1]+F[1])/2+ke],Ve=Us($e),Re=Math.min(m,v_(Math.abs(Math.min(fe,Ee))));return To(Number.isFinite(Re)),{longitude:Ve[0],latitude:Ve[1],zoom:Re}}function G3(r=0){return typeof r=="number"?{top:r,bottom:r,left:r,right:r}:(To(Number.isFinite(r.top)&&Number.isFinite(r.bottom)&&Number.isFinite(r.left)&&Number.isFinite(r.right)),r)}const Rx=Math.PI/180;function mw(r,e=0){const{width:i,height:l,unproject:u}=r,m={targetZ:e},y=u([0,l],m),T=u([i,l],m);let a,P;const D=r.fovy?.5*r.fovy*Rx:Math.atan(.5/r.altitude),N=(90-r.pitch)*Rx;return D>N-.01?(a=Ox(r,0,e),P=Ox(r,i,e)):(a=u([0,0],m),P=u([i,0],m)),[y,T,P,a]}function Ox(r,e,i){const{pixelUnprojectionMatrix:l}=r,u=wc(l,[e,0,1,1]),m=wc(l,[e,r.height,1,1]),T=(i*r.distanceScales.unitsPerMeter[2]-u[2])/(m[2]-u[2]),a=J1([],u,m,T),P=Us(a);return P.push(i),P}let ll=class Vg{constructor(e={width:1,height:1}){j(this,"latitude",void 0),j(this,"longitude",void 0),j(this,"zoom",void 0),j(this,"pitch",void 0),j(this,"bearing",void 0),j(this,"altitude",void 0),j(this,"fovy",void 0),j(this,"meterOffset",void 0),j(this,"center",void 0),j(this,"width",void 0),j(this,"height",void 0),j(this,"scale",void 0),j(this,"distanceScales",void 0),j(this,"viewMatrix",void 0),j(this,"projectionMatrix",void 0),j(this,"viewProjectionMatrix",void 0),j(this,"pixelProjectionMatrix",void 0),j(this,"pixelUnprojectionMatrix",void 0),j(this,"equals",Ee=>Ee instanceof Vg?Ee.width===this.width&&Ee.height===this.height&&Ex(Ee.projectionMatrix,this.projectionMatrix)&&Ex(Ee.viewMatrix,this.viewMatrix):!1),j(this,"project",(Ee,Ce={})=>{const{topLeft:ke=!0}=Ce,$e=this.projectPosition(Ee),Ve=b_($e,this.pixelProjectionMatrix),[Re,ot]=Ve,bt=ke?ot:this.height-ot;return Ee.length===2?[Re,bt]:[Re,bt,Ve[2]]}),j(this,"unproject",(Ee,Ce={})=>{const{topLeft:ke=!0,targetZ:$e=void 0}=Ce,[Ve,Re,ot]=Ee,bt=ke?Re:this.height-Re,mt=$e&&$e*this.distanceScales.unitsPerMeter[2],Mt=Oc([Ve,bt,ot],this.pixelUnprojectionMatrix,mt),[gt,Ht,Xt]=this.unprojectPosition(Mt);return Number.isFinite(ot)?[gt,Ht,Xt]:Number.isFinite($e)?[gt,Ht,$e]:[gt,Ht]}),j(this,"projectPosition",Ee=>{const[Ce,ke]=Fs(Ee),$e=(Ee[2]||0)*this.distanceScales.unitsPerMeter[2];return[Ce,ke,$e]}),j(this,"unprojectPosition",Ee=>{const[Ce,ke]=Us(Ee),$e=(Ee[2]||0)*this.distanceScales.metersPerUnit[2];return[Ce,ke,$e]});let{width:i,height:l,altitude:u=null,fovy:m=null}=e;const{latitude:y=0,longitude:T=0,zoom:a=0,pitch:P=0,bearing:D=0,position:N=null,nearZMultiplier:F=.02,farZMultiplier:W=1.01}=e;i=i||1,l=l||1,m===null&&u===null?(u=uw,m=Rc(u)):m===null?m=Rc(u):u===null&&(u=x_(m));const oe=jg(a);u=Math.max(.75,u);const me=Kd({longitude:T,latitude:y}),fe=Fs([T,y]);fe.push(0),N&&uk(fe,fe,Ek([],N,me.unitsPerMeter)),this.projectionMatrix=V3({width:i,height:l,scale:oe,center:fe,pitch:P,fovy:m,nearZMultiplier:F,farZMultiplier:W}),this.viewMatrix=dw({height:l,scale:oe,center:fe,pitch:P,bearing:D,altitude:u}),this.width=i,this.height=l,this.scale=oe,this.latitude=y,this.longitude=T,this.zoom=a,this.pitch=P,this.bearing=D,this.altitude=u,this.fovy=m,this.center=fe,this.meterOffset=N||[0,0,0],this.distanceScales=me,this._initMatrices(),Object.freeze(this)}_initMatrices(){const{width:e,height:i,projectionMatrix:l,viewMatrix:u}=this,m=Fd();Ns(m,m,l),Ns(m,m,u),this.viewProjectionMatrix=m;const y=Fd();up(y,y,[e/2,-i/2,1]),Ph(y,y,[1,-1,0]),Ns(y,y,m);const T=Hd(Fd(),y);if(!T)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=y,this.pixelUnprojectionMatrix=T}projectFlat(e){return Fs(e)}unprojectFlat(e){return Us(e)}getMapCenterByLngLatPosition({lngLat:e,pos:i}){const l=Oc(i,this.pixelUnprojectionMatrix),u=Fs(e),m=ul([],u,g_([],l)),y=ul([],this.center,m);return Us(y)}fitBounds(e,i={}){const{width:l,height:u}=this,{longitude:m,latitude:y,zoom:T}=w_(Object.assign({width:l,height:u,bounds:e},i));return new Vg({width:l,height:u,longitude:m,latitude:y,zoom:T})}getBounds(e){const i=this.getBoundingRegion(e),l=Math.min(...i.map(T=>T[0])),u=Math.max(...i.map(T=>T[0])),m=Math.min(...i.map(T=>T[1])),y=Math.max(...i.map(T=>T[1]));return[[l,m],[u,y]]}getBoundingRegion(e={}){return mw(this,e.z||0)}getLocationAtPoint({lngLat:e,pos:i}){return this.getMapCenterByLngLatPosition({lngLat:e,pos:i})}};const Dx=512;function gw(r){const{width:e,height:i,pitch:l=0}=r;let{longitude:u,latitude:m,zoom:y,bearing:T=0}=r;(u<-180||u>180)&&(u=kx(u+180,360)-180),(T<-180||T>180)&&(T=kx(T+180,360)-180);const a=v_(i/Dx);if(y<=a)y=a,m=0;else{const P=i/2/Math.pow(2,y),D=Us([0,P])[1];if(m<D)m=D;else{const N=Us([0,Dx-P])[1];m>N&&(m=N)}}return{width:e,height:i,longitude:u,latitude:m,zoom:y,pitch:l,bearing:T}}const _w=.01,Z3=["longitude","latitude","zoom"],yw={curve:1.414,speed:1.2};function $3(r,e,i,l){const{startZoom:u,startCenterXY:m,uDelta:y,w0:T,u1:a,S:P,rho:D,rho2:N,r0:F}=vw(r,e,l);if(a<_w){const $e={};for(const Ve of Z3){const Re=r[Ve],ot=e[Ve];$e[Ve]=N3(Re,ot,i)}return $e}const W=i*P,oe=Math.cosh(F)/Math.cosh(F+D*W),me=T*((Math.cosh(F)*Math.tanh(F+D*W)-Math.sinh(F))/N)/a,fe=1/oe,Ee=u+hw(fe),Ce=rk([],y,me);ul(Ce,Ce,m);const ke=Us(Ce);return{longitude:ke[0],latitude:ke[1],zoom:Ee}}function W3(r,e,i){const l={...yw,...i},{screenSpeed:u,speed:m,maxDuration:y}=l,{S:T,rho:a}=vw(r,e,l),P=1e3*T;let D;return Number.isFinite(u)?D=P/(u/a):D=P/m,Number.isFinite(y)&&D>y?0:D}function vw(r,e,i){i=Object.assign({},yw,i);const l=i.curve,u=r.zoom,m=[r.longitude,r.latitude],y=jg(u),T=e.zoom,a=[e.longitude,e.latitude],P=jg(T-u),D=Fs(m),N=Fs(a),F=ok([],N,D),W=Math.max(r.width,r.height),oe=W/P,me=nk(F)*y,fe=Math.max(me,_w),Ee=l*l,Ce=(oe*oe-W*W+Ee*Ee*fe*fe)/(2*W*Ee*fe),ke=(oe*oe-W*W-Ee*Ee*fe*fe)/(2*oe*Ee*fe),$e=Math.log(Math.sqrt(Ce*Ce+1)-Ce),Ve=Math.log(Math.sqrt(ke*ke+1)-ke),Re=(Ve-$e)/l;return{startZoom:u,startCenterXY:D,uDelta:F,w0:W,u1:me,S:Re,rho:l,rho2:Ee,r0:$e,r1:Ve}}const q3=`
const int max_lights = 2;
uniform mat4 shadow_uViewProjectionMatrices[max_lights];
uniform vec4 shadow_uProjectCenters[max_lights];
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform int shadow_uLightId;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  if (shadow_uDrawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);
  }
  if (shadow_uUseShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow_uLightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,X3=`
const int max_lights = 2;
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;
uniform vec4 shadow_uColor;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture2D(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow_uDrawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow_uUseShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow_uLightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,H3=hp(eR),Y3=hp(tR),K3=[0,0,0,1],J3=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function Q3(r,e){const[i,l,u]=r,m=Oc([i,l,u],e);return Number.isFinite(u)?m:[m[0],m[1],0]}function eR({viewport:r,center:e}){return new Zn(r.viewProjectionMatrix).invert().transform(e)}function tR({viewport:r,shadowMatrices:e}){const i=[],l=r.pixelUnprojectionMatrix,u=r.isGeospatial?void 0:1,m=[[0,0,u],[r.width,0,u],[0,r.height,u],[r.width,r.height,u],[0,0,-1],[r.width,0,-1],[0,r.height,-1],[r.width,r.height,-1]].map(y=>Q3(y,l));for(const y of e){const T=y.clone().translate(new js(r.center).negate()),a=m.map(D=>T.transform(D)),P=new Zn().ortho({left:Math.min(...a.map(D=>D[0])),right:Math.max(...a.map(D=>D[0])),bottom:Math.min(...a.map(D=>D[1])),top:Math.max(...a.map(D=>D[1])),near:Math.min(...a.map(D=>-D[2])),far:Math.max(...a.map(D=>-D[2]))});i.push(P.multiplyRight(y))}return i}function iR(r,e){const{shadowEnabled:i=!0}=r;if(!i||!r.shadowMatrices||!r.shadowMatrices.length)return{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1};const l={shadow_uDrawShadowMap:!!r.drawToShadowMap,shadow_uUseShadowMap:r.shadowMaps?r.shadowMaps.length>0:!1,shadow_uColor:r.shadowColor||K3,shadow_uLightId:r.shadowLightId||0,shadow_uLightCount:r.shadowMatrices.length},u=H3({viewport:r.viewport,center:e.project_uCenter}),m=[],y=Y3({shadowMatrices:r.shadowMatrices,viewport:r.viewport}).slice();for(let T=0;T<r.shadowMatrices.length;T++){const a=y[T],P=a.clone().translate(new js(r.viewport.center).negate());e.project_uCoordinateSystem===Ti.LNGLAT&&e.project_uProjectionMode===Bs.WEB_MERCATOR?(y[T]=P,m[T]=u):(y[T]=a.clone().multiplyRight(J3),m[T]=P.transform(u))}for(let T=0;T<y.length;T++)l["shadow_uViewProjectionMatrices[".concat(T,"]")]=y[T],l["shadow_uProjectCenters[".concat(T,"]")]=m[T],r.shadowMaps&&r.shadowMaps.length>0?l["shadow_uShadowMap".concat(T)]=r.shadowMaps[T]:l["shadow_uShadowMap".concat(T)]=r.dummyShadowMap;return l}const cg={name:"shadow",dependencies:[y_],vs:q3,fs:X3,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:(r={},e={})=>"viewport"in r&&(r.drawToShadowMap||r.shadowMaps&&r.shadowMaps.length>0)?iR(r,e):{}},IF={inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}},...Yk},rR=[y_],nR=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function sR(r){const e=Uh.getDefaultProgramManager(r);for(const i of rR)e.addDefaultModule(i);for(const i of nR)e.addShaderHook(i);return e}const oR=[255,255,255],aR=1;let lR=0;class cR{constructor(e={}){j(this,"id",void 0),j(this,"color",void 0),j(this,"intensity",void 0),j(this,"type","ambient");const{color:i=oR}=e,{intensity:l=aR}=e;this.id=e.id||"ambient-".concat(lR++),this.color=i,this.intensity=l}}const uR=[255,255,255],hR=1,fR=[0,0,-1];let dR=0;class zx{constructor(e={}){j(this,"id",void 0),j(this,"color",void 0),j(this,"intensity",void 0),j(this,"type","directional"),j(this,"direction",void 0),j(this,"shadow",void 0);const{color:i=uR}=e,{intensity:l=hR}=e,{direction:u=fR}=e,{_shadow:m=!1}=e;this.id=e.id||"directional-".concat(dR++),this.color=i,this.intensity=l,this.type="directional",this.direction=new js(u).normalize().toArray(),this.shadow=m}getProjectedLight(e){return this}}class pR{constructor(e,i={id:"pass"}){j(this,"id",void 0),j(this,"gl",void 0),j(this,"props",void 0);const{id:l}=i;this.id=l,this.gl=e,this.props={...i}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class fp extends pR{constructor(...e){super(...e),j(this,"_lastRenderIndex",-1)}render(e){const i=this.gl;return wo(i,{framebuffer:e.target}),this._drawLayers(e)}_drawLayers(e){const{target:i,moduleParameters:l,viewports:u,views:m,onViewportActive:y,clearStack:T=!0,clearCanvas:a=!0}=e;e.pass=e.pass||"unknown";const P=this.gl;a&&gR(P),T&&(this._lastRenderIndex=-1);const D=[];for(const N of u){const F=m&&m[N.id];y(N);const W=this._getDrawLayerParams(N,e),oe=N.subViewports||[N];for(const me of oe){const fe=this._drawLayersInViewport(P,{target:i,moduleParameters:l,viewport:me,view:F,pass:e.pass,layers:e.layers},W);D.push(fe)}}return D}_getDrawLayerParams(e,{layers:i,pass:l,layerFilter:u,cullRect:m,effects:y,moduleParameters:T}){const a=[],P=xw(this._lastRenderIndex+1),D={layer:i[0],viewport:e,isPicking:l.startsWith("picking"),renderPass:l,cullRect:m},N={};for(let F=0;F<i.length;F++){const W=i[F],oe=this._shouldDrawLayer(W,D,u,N),me={shouldDrawLayer:oe};oe&&(me.layerRenderIndex=P(W,oe),me.moduleParameters=this._getModuleParameters(W,y,l,T),me.layerParameters=this.getLayerParameters(W,F,e)),a[F]=me}return a}_drawLayersInViewport(e,{layers:i,moduleParameters:l,pass:u,target:m,viewport:y,view:T},a){const P=mR(e,{moduleParameters:l,target:m,viewport:y});if(T&&T.props.clear){const N=T.props.clear===!0?{color:!0,depth:!0}:T.props.clear;Vn(e,{scissorTest:!0,scissor:P},()=>f_(e,N))}const D={totalCount:i.length,visibleCount:0,compositeCount:0,pickableCount:0};wo(e,{viewport:P});for(let N=0;N<i.length;N++){const F=i[N],{shouldDrawLayer:W,layerRenderIndex:oe,moduleParameters:me,layerParameters:fe}=a[N];if(W&&F.props.pickable&&D.pickableCount++,F.isComposite)D.compositeCount++;else if(W){D.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,oe),me.viewport=y;try{F._drawLayer({moduleParameters:me,uniforms:{layerIndex:oe},parameters:fe})}catch(Ee){F.raiseError(Ee,"drawing ".concat(F," to ").concat(u))}}}return D}shouldDrawLayer(e){return!0}getModuleParameters(e,i){return null}getLayerParameters(e,i,l){return e.props.parameters}_shouldDrawLayer(e,i,l,u){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;i.layer=e;let y=e.parent;for(;y;){if(!y.props.visible||!y.filterSubLayer(i))return!1;i.layer=y,y=y.parent}if(l){const T=i.layer.id;if(T in u||(u[T]=l(i)),!u[T])return!1}return e.activateViewport(i.viewport),!0}_getModuleParameters(e,i,l,u){var m;const y=Object.assign(Object.create(((m=e.internalState)===null||m===void 0?void 0:m.propsInTransition)||e.props),{autoWrapLongitude:e.wrapLongitude,viewport:e.context.viewport,mousePosition:e.context.mousePosition,pickingActive:0,devicePixelRatio:Mc(this.gl)});if(i)for(const a of i){var T;Object.assign(y,(T=a.getModuleParameters)===null||T===void 0?void 0:T.call(a,e))}return Object.assign(y,this.getModuleParameters(e,i),u)}}function xw(r=0,e={}){const i={},l=(u,m)=>{const y=u.props._offset,T=u.id,a=u.parent&&u.parent.id;let P;if(a&&!(a in e)&&l(u.parent,!1),a in i){const D=i[a]=i[a]||xw(e[a],e);P=D(u,m),i[T]=D}else Number.isFinite(y)?(P=y+(e[a]||0),i[T]=null):P=r;return m&&P>=r&&(r=P+1),e[T]=P,P};return l}function mR(r,{moduleParameters:e,target:i,viewport:l}){const u=i&&i.id!=="default-framebuffer",m=e&&e.devicePixelRatio||Mc(r),y=u?i.height:r.drawingBufferHeight,T=l;return[T.x*m,y-(T.y+T.height)*m,T.width*m,T.height*m]}function gR(r){const e=r.drawingBufferWidth,i=r.drawingBufferHeight;wo(r,{viewport:[0,0,e,i]}),r.clear(16640)}class _R extends fp{constructor(e,i){super(e,i),j(this,"shadowMap",void 0),j(this,"depthBuffer",void 0),j(this,"fbo",void 0),this.shadowMap=new In(e,{width:1,height:1,parameters:{10241:9729,10240:9729,10242:33071,10243:33071}}),this.depthBuffer=new xc(e,{format:33189,width:1,height:1}),this.fbo=new tr(e,{id:"shadowmap",width:1,height:1,attachments:{36064:this.shadowMap,36096:this.depthBuffer}})}render(e){const i=this.fbo;Vn(this.gl,{depthRange:[0,1],depthTest:!0,blend:!1,clearColor:[1,1,1,1]},()=>{const l=e.viewports[0],u=Mc(this.gl),m=l.width*u,y=l.height*u;(m!==i.width||y!==i.height)&&i.resize({width:m,height:y}),super.render({...e,target:i,pass:"shadow"})})}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getModuleParameters(){return{drawToShadowMap:!0}}delete(){this.fbo&&(this.fbo.delete(),this.fbo=null),this.shadowMap&&(this.shadowMap.delete(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.delete(),this.depthBuffer=null)}}const yR={color:[255,255,255],intensity:1},Bx=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],vR=[0,0,0,200/255];class bw{constructor(e={}){j(this,"id","lighting-effect"),j(this,"props",null),j(this,"shadowColor",vR),j(this,"shadow",void 0),j(this,"ambientLight",null),j(this,"directionalLights",[]),j(this,"pointLights",[]),j(this,"shadowPasses",[]),j(this,"shadowMaps",[]),j(this,"dummyShadowMap",null),j(this,"programManager",void 0),j(this,"shadowMatrices",void 0);for(const i in e){const l=e[i];switch(l.type){case"ambient":this.ambientLight=l;break;case"directional":this.directionalLights.push(l);break;case"point":this.pointLights.push(l);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(i=>i.shadow)}preRender(e,{layers:i,layerFilter:l,viewports:u,onViewportActive:m,views:y}){if(this.shadow){this.shadowMatrices=this._calculateMatrices(),this.shadowPasses.length===0&&this._createShadowPasses(e),this.programManager||(this.programManager=Uh.getDefaultProgramManager(e),cg&&this.programManager.addDefaultModule(cg)),this.dummyShadowMap||(this.dummyShadowMap=new In(e,{width:1,height:1}));for(let T=0;T<this.shadowPasses.length;T++)this.shadowPasses[T].render({layers:i,layerFilter:l,viewports:u,onViewportActive:m,views:y,moduleParameters:{shadowLightId:T,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}getModuleParameters(e){const i=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return i.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(l=>l.getProjectedLight({layer:e})),pointLights:this.pointLights.map(l=>l.getProjectedLight({layer:e}))},i}cleanup(){for(const e of this.shadowPasses)e.delete();this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.delete(),this.dummyShadowMap=null),this.shadow&&this.programManager&&(this.programManager.removeDefaultModule(cg),this.programManager=null)}_calculateMatrices(){const e=[];for(const i of this.directionalLights){const l=new Zn().lookAt({eye:new js(i.direction).negate()});e.push(l)}return e}_createShadowPasses(e){for(let i=0;i<this.directionalLights.length;i++){const l=new _R(e);this.shadowPasses[i]=l,this.shadowMaps[i]=l.shadowMap}}_applyDefaultLights(){const{ambientLight:e,pointLights:i,directionalLights:l}=this;!e&&i.length===0&&l.length===0&&(this.ambientLight=new cR(yR),this.directionalLights.push(new zx(Bx[0]),new zx(Bx[1])))}}class xR{constructor(e={}){j(this,"_pool",[]),j(this,"opts",{overAlloc:2,poolSize:100}),this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,i,{size:l=1,type:u,padding:m=0,copy:y=!1,initialize:T=!1,maxCount:a}){const P=u||e&&e.constructor||Float32Array,D=i*l+m;if(ArrayBuffer.isView(e)){if(D<=e.length)return e;if(D*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new P(e.buffer,0,D)}let N=1/0;a&&(N=a*l+m);const F=this._allocate(P,D,T,N);return e&&y?F.set(e):T||F.fill(0,0,4),this._release(e),F}release(e){this._release(e)}_allocate(e,i,l,u){let m=Math.max(Math.ceil(i*this.opts.overAlloc),1);m>u&&(m=u);const y=this._pool,T=e.BYTES_PER_ELEMENT*m,a=y.findIndex(P=>P.byteLength>=T);if(a>=0){const P=new e(y.splice(a,1)[0],0,m);return l&&P.fill(0),P}return new e(m)}_release(e){if(!ArrayBuffer.isView(e))return;const i=this._pool,{buffer:l}=e,{byteLength:u}=l,m=i.findIndex(y=>y.byteLength>=u);m<0?i.push(l):(m>0||i.length<this.opts.poolSize)&&i.splice(m,0,l),i.length>this.opts.poolSize&&i.shift()}}const Ch=new xR;function _h(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function bR(r,e){const i=r%e;return i<0?e+i:i}function wR(r){return[r[12],r[13],r[14]]}function TR(r){return{left:mc(r[3]+r[0],r[7]+r[4],r[11]+r[8],r[15]+r[12]),right:mc(r[3]-r[0],r[7]-r[4],r[11]-r[8],r[15]-r[12]),bottom:mc(r[3]+r[1],r[7]+r[5],r[11]+r[9],r[15]+r[13]),top:mc(r[3]-r[1],r[7]-r[5],r[11]-r[9],r[15]-r[13]),near:mc(r[3]+r[2],r[7]+r[6],r[11]+r[10],r[15]+r[14]),far:mc(r[3]-r[2],r[7]-r[6],r[11]-r[10],r[15]-r[14])}}const Fx=new js;function mc(r,e,i,l){Fx.set(r,e,i);const u=Fx.len();return{distance:l/u,normal:new js(-r/u,-e/u,-i/u)}}function ER(r){return r-Math.fround(r)}let ph;function ug(r,e){const{size:i=1,startIndex:l=0}=e,u=e.endIndex!==void 0?e.endIndex:r.length,m=(u-l)/i;ph=Ch.allocate(ph,m,{type:Float32Array,size:i*2});let y=l,T=0;for(;y<u;){for(let a=0;a<i;a++){const P=r[y++];ph[T+a]=P,ph[T+a+i]=ER(P)}T+=i*2}return ph.subarray(0,m*i*2)}const SR=Math.PI/180,AR=_h(),Nx=[0,0,0],MR={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function PR({width:r,height:e,orthographic:i,fovyRadians:l,focalDistance:u,padding:m,near:y,far:T}){const a=r/e,P=i?new Zn().orthographic({fovy:l,aspect:a,focalDistance:u,near:y,far:T}):new Zn().perspective({fovy:l,aspect:a,near:y,far:T});if(m){const{left:D=0,right:N=0,top:F=0,bottom:W=0}=m,oe=Rr((D+r-N)/2,0,r)-r/2,me=Rr((F+e-W)/2,0,e)-e/2;P[8]-=oe*2/r,P[9]+=me*2/e}return P}class pl{constructor(e={}){j(this,"id",void 0),j(this,"x",void 0),j(this,"y",void 0),j(this,"width",void 0),j(this,"height",void 0),j(this,"padding",void 0),j(this,"isGeospatial",void 0),j(this,"zoom",void 0),j(this,"focalDistance",void 0),j(this,"position",void 0),j(this,"modelMatrix",void 0),j(this,"distanceScales",void 0),j(this,"scale",void 0),j(this,"center",void 0),j(this,"cameraPosition",void 0),j(this,"projectionMatrix",void 0),j(this,"viewMatrix",void 0),j(this,"viewMatrixUncentered",void 0),j(this,"viewMatrixInverse",void 0),j(this,"viewProjectionMatrix",void 0),j(this,"pixelProjectionMatrix",void 0),j(this,"pixelUnprojectionMatrix",void 0),j(this,"resolution",void 0),j(this,"_frustumPlanes",{}),this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||MR,this.focalDistance=e.focalDistance||1,this.position=e.position||Nx,this.modelMatrix=e.modelMatrix||null;const{longitude:i,latitude:l}=e;this.isGeospatial=Number.isFinite(l)&&Number.isFinite(i),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?Bs.WEB_MERCATOR:Bs.WEB_MERCATOR_AUTO_OFFSET:Bs.IDENTITY}equals(e){return e instanceof pl?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&Lc(e.projectionMatrix,this.projectionMatrix)&&Lc(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:i=!0}={}){const l=this.projectPosition(e),u=b_(l,this.pixelProjectionMatrix),[m,y]=u,T=i?y:this.height-y;return e.length===2?[m,T]:[m,T,u[2]]}unproject(e,{topLeft:i=!0,targetZ:l}={}){const[u,m,y]=e,T=i?m:this.height-m,a=l&&l*this.distanceScales.unitsPerMeter[2],P=Oc([u,T,y],this.pixelUnprojectionMatrix,a),[D,N,F]=this.unprojectPosition(P);return Number.isFinite(y)?[D,N,F]:Number.isFinite(l)?[D,N,l]:[D,N]}projectPosition(e){const[i,l]=this.projectFlat(e),u=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[i,l,u]}unprojectPosition(e){const[i,l]=this.unprojectFlat(e),u=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[i,l,u]}projectFlat(e){if(this.isGeospatial){const i=Fs(e);return i[1]=Rr(i[1],-318,830),i}return e}unprojectFlat(e){return this.isGeospatial?Us(e):e}getBounds(e={}){const i={targetZ:e.z||0},l=this.unproject([0,0],i),u=this.unproject([this.width,0],i),m=this.unproject([0,this.height],i),y=this.unproject([this.width,this.height],i);return[Math.min(l[0],u[0],m[0],y[0]),Math.min(l[1],u[1],m[1],y[1]),Math.max(l[0],u[0],m[0],y[0]),Math.max(l[1],u[1],m[1],y[1])]}getDistanceScales(e){return e?Kd({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:i,width:l=1,height:u=1}){return e<this.x+this.width&&this.x<e+l&&i<this.y+this.height&&this.y<i+u}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,TR(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,i){return null}_initProps(e){const i=e.longitude,l=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=j3({latitude:l})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||Kd({latitude:l,longitude:i}));const u=Math.pow(2,this.zoom);this.scale=u;const{position:m,modelMatrix:y}=e;let T=Nx;if(m&&(T=y?new Zn(y).transformAsVector(m,[]):m),this.isGeospatial){const a=this.projectPosition([i,l,0]);this.center=new js(T).scale(this.distanceScales.unitsPerMeter).add(a)}else this.center=this.projectPosition(T)}_initMatrices(e){const{viewMatrix:i=AR,projectionMatrix:l=null,orthographic:u=!1,fovyRadians:m,fovy:y=75,near:T=.1,far:a=1e3,padding:P=null,focalDistance:D=1}=e;this.viewMatrixUncentered=i,this.viewMatrix=new Zn().multiplyRight(i).translate(new js(this.center).negate()),this.projectionMatrix=l||PR({width:this.width,height:this.height,orthographic:u,fovyRadians:m||y*SR,focalDistance:D,padding:P,near:T,far:a});const N=_h();Ns(N,N,this.projectionMatrix),Ns(N,N,this.viewMatrix),this.viewProjectionMatrix=N,this.viewMatrixInverse=Hd([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=wR(this.viewMatrixInverse);const F=_h(),W=_h();up(F,F,[this.width/2,-this.height/2,1]),Ph(F,F,[1,-1,0]),Ns(W,F,this.viewProjectionMatrix),this.pixelProjectionMatrix=W,this.pixelUnprojectionMatrix=Hd(_h(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||Ii.warn("Pixel project matrix not invertible")()}}j(pl,"displayName","Viewport");const IR=512,CR=4003e4,LR=Math.PI/180;function Ux(r){const e=Math.cos(r*LR);return IR/CR/e}class ua extends pl{constructor(e={}){const{latitude:i=0,longitude:l=0,zoom:u=0,pitch:m=0,bearing:y=0,nearZMultiplier:T=.1,farZMultiplier:a=1.01,orthographic:P=!1,projectionMatrix:D,repeat:N=!1,worldOffset:F=0,legacyMeterSizes:W=!1}=e;let{width:oe,height:me,altitude:fe=1.5}=e;const Ee=Math.pow(2,u);oe=oe||1,me=me||1;let Ce,ke=null;D?(fe=D[5]/2,Ce=Rc(fe)):(e.fovy?(Ce=e.fovy,fe=x_(Ce)):Ce=Rc(fe),ke=pw({width:oe,height:me,pitch:m,fovy:Ce,nearZMultiplier:T,farZMultiplier:a}));let $e=dw({height:me,pitch:m,bearing:y,scale:Ee,altitude:fe});F&&($e=new Zn().translate([512*F,0,0]).multiplyLeft($e)),super({...e,width:oe,height:me,viewMatrix:$e,longitude:l,latitude:i,zoom:u,...ke,fovy:Ce,focalDistance:fe}),j(this,"longitude",void 0),j(this,"latitude",void 0),j(this,"pitch",void 0),j(this,"bearing",void 0),j(this,"altitude",void 0),j(this,"fovy",void 0),j(this,"orthographic",void 0),j(this,"_subViewports",void 0),j(this,"_pseudoMeters",void 0),this.latitude=i,this.longitude=l,this.zoom=u,this.pitch=m,this.bearing=y,this.altitude=fe,this.fovy=Ce,this.orthographic=P,this._subViewports=N?[]:null,this._pseudoMeters=W,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),i=Math.floor((e[0]+180)/360),l=Math.ceil((e[2]-180)/360);for(let u=i;u<=l;u++){const m=u?new ua({...this,worldOffset:u}):this;this._subViewports.push(m)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[i,l]=this.projectFlat(e),u=(e[2]||0)*Ux(e[1]);return[i,l,u]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[i,l]=this.unprojectFlat(e),u=(e[2]||0)/Ux(l);return[i,l,u]}addMetersToLngLat(e,i){return fw(e,i)}panByPosition(e,i){const l=Oc(i,this.pixelUnprojectionMatrix),u=this.projectFlat(e),m=ul([],u,g_([],l)),y=ul([],this.center,m),[T,a]=this.unprojectFlat(y);return{longitude:T,latitude:a}}getBounds(e={}){const i=mw(this,e.z||0);return[Math.min(i[0][0],i[1][0],i[2][0],i[3][0]),Math.min(i[0][1],i[1][1],i[2][1],i[3][1]),Math.max(i[0][0],i[1][0],i[2][0],i[3][0]),Math.max(i[0][1],i[1][1],i[2][1],i[3][1])]}fitBounds(e,i={}){const{width:l,height:u}=this,{longitude:m,latitude:y,zoom:T}=w_({width:l,height:u,bounds:e,...i});return new ua({width:l,height:u,longitude:m,latitude:y,zoom:T})}}j(ua,"displayName","WebMercatorViewport");function hg(r,e,i=!1){const l=e.projectPosition(r);if(i&&e instanceof ua){const[u,m,y=0]=r,T=e.getDistanceScales([u,m]);l[2]=y*T.unitsPerMeter[2]}return l}function kR(r){const{viewport:e,modelMatrix:i,coordinateOrigin:l}=r;let{coordinateSystem:u,fromCoordinateSystem:m,fromCoordinateOrigin:y}=r;return u===Ti.DEFAULT&&(u=e.isGeospatial?Ti.LNGLAT:Ti.CARTESIAN),m===void 0&&(m=u),y===void 0&&(y=l),{viewport:e,coordinateSystem:u,coordinateOrigin:l,modelMatrix:i,fromCoordinateSystem:m,fromCoordinateOrigin:y}}function ww(r,{viewport:e,modelMatrix:i,coordinateSystem:l,coordinateOrigin:u,offsetMode:m}){let[y,T,a=0]=r;switch(i&&([y,T,a]=Nh([],[y,T,a,1],i)),l){case Ti.LNGLAT:return hg([y,T,a],e,m);case Ti.LNGLAT_OFFSETS:return hg([y+u[0],T+u[1],a+(u[2]||0)],e,m);case Ti.METER_OFFSETS:return hg(fw(u,[y,T,a]),e,m);case Ti.CARTESIAN:default:return e.isGeospatial?[y+u[0],T+u[1],a+u[2]]:e.projectPosition([y,T,a])}}function RR(r,e){const{viewport:i,coordinateSystem:l,coordinateOrigin:u,modelMatrix:m,fromCoordinateSystem:y,fromCoordinateOrigin:T}=kR(e),{geospatialOrigin:a,shaderCoordinateOrigin:P,offsetMode:D}=lw(i,l,u),N=ww(r,{viewport:i,modelMatrix:m,coordinateSystem:y,coordinateOrigin:T,offsetMode:D});if(D){const F=i.projectPosition(a||P);Tk(N,N,F)}return N}const vc={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},Jd=Symbol.for("component"),Tc=Symbol.for("asyncPropDefaults"),hl=Symbol.for("asyncPropOriginal"),aa=Symbol.for("asyncPropResolved");function Tw(r,e=()=>!0){return Array.isArray(r)?Ew(r,e,[]):e(r)?[r]:[]}function Ew(r,e,i){let l=-1;for(;++l<r.length;){const u=r[l];Array.isArray(u)?Ew(u,e,i):e(u)&&i.push(u)}return i}function OR({target:r,source:e,start:i=0,count:l=1}){const u=e.length,m=l*u;let y=0;for(let T=i;y<u;y++)r[T++]=e[y];for(;y<m;)y<m-y?(r.copyWithin(i+y,i,i+y),y*=2):(r.copyWithin(i+y,i,i+m-y),y=m);return r}class DR{constructor(e,i,l){j(this,"id",void 0),j(this,"context",void 0),j(this,"isLoaded",void 0),j(this,"persistent",void 0),j(this,"_loadCount",0),j(this,"_subscribers",new Set),j(this,"_data",void 0),j(this,"_loader",void 0),j(this,"_error",void 0),j(this,"_content",void 0),this.id=e,this.context=l,this.setData(i)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,i){if(e===this._data&&!i)return;this._data=e;const l=++this._loadCount;let u=e;typeof e=="string"&&(u=Sg(e)),u instanceof Promise?(this.isLoaded=!1,this._loader=u.then(m=>{this._loadCount===l&&(this.isLoaded=!0,this._error=void 0,this._content=m)}).catch(m=>{this._loadCount===l&&(this.isLoaded=!0,this._error=m||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const m of this._subscribers)m.onChange(this.getData())}}class zR{constructor({gl:e,protocol:i}){j(this,"protocol",void 0),j(this,"_context",void 0),j(this,"_resources",void 0),j(this,"_consumers",void 0),j(this,"_pruneRequest",void 0),this.protocol=i||"resource://",this._context={gl:e,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:i,forceUpdate:l=!1,persistent:u=!0}){let m=this._resources[e];m?m.setData(i,l):(m=new DR(e,i,this._context),this._resources[e]=m),m.persistent=u}remove(e){const i=this._resources[e];i&&(i.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const i=this._consumers[e];if(i){for(const l in i){const u=i[l],m=this._resources[u.resourceId];m&&m.unsubscribe(u)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:i,consumerId:l,requestId:u="default"}){const{_resources:m,protocol:y}=this;e.startsWith(y)&&(e=e.replace(y,""),m[e]||this.add({resourceId:e,data:null,persistent:!1}));const T=m[e];if(this._track(l,u,T,i),T)return T.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,i,l,u){const m=this._consumers,y=m[e]=m[e]||{},T=y[i]||{},a=T.resourceId&&this._resources[T.resourceId];a&&(a.unsubscribe(T),this.prune()),l&&(y[i]=T,T.onChange=u,T.resourceId=l.id,l.subscribe(T))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const i=this._resources[e];!i.persistent&&!i.inUse()&&(i.delete(),delete this._resources[e])}}}const BR="layerManager.setLayers",FR="layerManager.activateViewport";class NR{constructor(e,{deck:i,stats:l,viewport:u,timeline:m}={}){j(this,"layers",void 0),j(this,"context",void 0),j(this,"resourceManager",void 0),j(this,"_lastRenderedLayers",[]),j(this,"_needsRedraw",!1),j(this,"_needsUpdate",!1),j(this,"_nextLayers",null),j(this,"_debug",!1),j(this,"activateViewport",y=>{Qr(FR,this,y),y&&(this.context.viewport=y)}),this.layers=[],this.resourceManager=new zR({gl:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,gl:e,deck:i,programManager:e&&sR(e),stats:l||new r_({id:"deck.gl"}),viewport:u||new pl({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:m||new nw,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let i=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const l of this.layers){const u=l.getNeedsRedraw(e);i=i||u}return i}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(i=>e.find(l=>i.id.indexOf(l)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,i){Qr(BR,this,i,e),this._lastRenderedLayers=e;const l=Tw(e,Boolean);for(const u of l)u.context=this.context;this._updateLayers(this.layers,l)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw("updating layers: ".concat(e)),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}_handleError(e,i,l){l.raiseError(i,"".concat(e," of ").concat(l))}_updateLayers(e,i){const l={};for(const y of e)l[y.id]?Ii.warn("Multiple old layers with same id ".concat(y.id))():l[y.id]=y;const u=[];this._updateSublayersRecursively(i,l,u),this._finalizeOldLayers(l);let m=!1;for(const y of u)if(y.hasUniformTransition()){m="Uniform transition in ".concat(y);break}this._needsUpdate=m,this.layers=u}_updateSublayersRecursively(e,i,l){for(const u of e){u.context=this.context;const m=i[u.id];m===null&&Ii.warn("Multiple new layers with same id ".concat(u.id))(),i[u.id]=null;let y=null;try{this._debug&&m!==u&&u.validateProps(),m?(this._transferLayerState(m,u),this._updateLayer(u)):this._initializeLayer(u),l.push(u),y=u.isComposite?u.getSubLayers():null}catch(T){this._handleError("matching",T,u)}y&&this._updateSublayersRecursively(y,i,l)}}_finalizeOldLayers(e){for(const i in e){const l=e[i];l&&this._finalizeLayer(l)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=vc.INITIALIZED}catch(i){this._handleError("initialization",i,e)}}_transferLayerState(e,i){i._transferState(e),i.lifecycle=vc.MATCHED,i!==e&&(e.lifecycle=vc.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(i){this._handleError("update",i,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||"finalized ".concat(e),e.lifecycle=vc.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=vc.FINALIZED}catch(i){this._handleError("finalization",i,e)}}}function Bc(r,e){if(r===e)return!0;if(!r||!e)return!1;for(const i in r){const l=r[i],u=e[i];if(!(l===u||Array.isArray(l)&&Array.isArray(u)&&Bc(l,u)))return!1}return!0}class UR{constructor(e){j(this,"width",void 0),j(this,"height",void 0),j(this,"views",void 0),j(this,"viewState",void 0),j(this,"controllers",void 0),j(this,"timeline",void 0),j(this,"_viewports",void 0),j(this,"_viewportMap",void 0),j(this,"_isUpdating",void 0),j(this,"_needsRedraw",void 0),j(this,"_needsUpdate",void 0),j(this,"_eventManager",void 0),j(this,"_eventCallbacks",void 0),this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const i=this.controllers[e];i&&i.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const i=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),i}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const i=this.controllers[e];i&&i.updateTransition()}}getViewports(e){return e?this._viewports.filter(i=>i.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(i=>{e[i.id]=i}),e}getView(e){return this.views.find(i=>i.id===e)}getViewState(e){const i=typeof e=="string"?this.getView(e):e,l=i&&this.viewState[i.getViewStateId()]||this.viewState;return i?i.filterViewState(l):l}getViewport(e){return this._viewportMap[e]}unproject(e,i){const l=this.getViewports(),u={x:e[0],y:e[1]};for(let m=l.length-1;m>=0;--m){const y=l[m];if(y.containsPixel(u)){const T=e.slice();return T[0]-=y.x,T[1]-=y.y,y.unproject(T,i)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,i){(e!==this.width||i!==this.height)&&(this.width=e,this.height=i,this.setNeedsUpdate("Size changed"))}_setViews(e){e=Tw(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!Bc(e,this.viewState)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):Ii.warn("missing `viewState` or `initialViewState`")()}_onViewStateChange(e,i){this._eventCallbacks.onViewStateChange&&this._eventCallbacks.onViewStateChange({...i,viewId:e})}_createController(e,i){const l=i.type;return new l({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._onViewStateChange.bind(this,i.id),onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:m=>{var y;return(y=this.getView(e.id))===null||y===void 0?void 0:y.makeViewport({viewState:m,width:this.width,height:this.height})}})}_updateController(e,i,l,u){const m=e.controller;if(m){const y={...i,...m,id:e.id,x:l.x,y:l.y,width:l.width,height:l.height};return u||(u=this._createController(e,y)),u&&u.setProps(y),u}return null}_rebuildViewports(){const{views:e}=this,i=this.controllers;this._viewports=[],this.controllers={};let l=!1;for(let u=e.length;u--;){const m=e[u],y=this.getViewState(m),T=m.makeViewport({viewState:y,width:this.width,height:this.height});let a=i[m.id];const P=!!m.controller;P&&!a&&(l=!0),(l||!P)&&a&&(a.finalize(),a=null),this.controllers[m.id]=this._updateController(m,y,T,a),this._viewports.unshift(T)}for(const u in i){const m=i[u];m&&!this.controllers[u]&&m.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,i){return e.length!==i.length?!0:e.some((l,u)=>!e[u].equals(i[u]))}}const jR=/([0-9]+\.?[0-9]*)(%|px)/;function na(r){switch(typeof r){case"number":return{position:r,relative:!1};case"string":const e=jR.exec(r);if(e&&e.length>=3){const i=e[2]==="%",l=parseFloat(e[1]);return{position:i?l/100:l,relative:i}}default:throw new Error("Could not parse position string ".concat(r))}}function sa(r,e){return r.relative?Math.round(r.position*e):r.position}function kr(r,e){if(!r)throw new Error(e||"deck.gl: assertion failed.")}class fl{constructor(e){j(this,"id",void 0),j(this,"viewportInstance",void 0),j(this,"_x",void 0),j(this,"_y",void 0),j(this,"_width",void 0),j(this,"_height",void 0),j(this,"_padding",void 0),j(this,"props",void 0);const{id:i,x:l=0,y:u=0,width:m="100%",height:y="100%",padding:T=null,viewportInstance:a}=e||{};kr(!a||a instanceof pl),this.viewportInstance=a,this.id=i||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=na(l),this._y=na(u),this._width=na(m),this._height=na(y),this._padding=T&&{left:na(T.left||0),right:na(T.right||0),top:na(T.top||0),bottom:na(T.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.viewportInstance?e.viewportInstance?this.viewportInstance.equals(e.viewportInstance):!1:this.ViewportType===e.ViewportType&&Bc(this.props,e.props)}makeViewport({width:e,height:i,viewState:l}){if(this.viewportInstance)return this.viewportInstance;l=this.filterViewState(l);const u=this.getDimensions({width:e,height:i});return new this.ViewportType({...l,...this.props,...u})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:e?.id||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const i={...e};for(const l in this.props.viewState)l!=="id"&&(i[l]=this.props.viewState[l]);return i}return e}getDimensions({width:e,height:i}){const l={x:sa(this._x,e),y:sa(this._y,i),width:sa(this._width,e),height:sa(this._height,i)};return this._padding&&(l.padding={left:sa(this._padding.left,e),top:sa(this._padding.top,i),right:sa(this._padding.right,e),bottom:sa(this._padding.bottom,i)}),l}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class Vh{constructor(e){j(this,"_inProgress",void 0),j(this,"_handle",void 0),j(this,"_timeline",void 0),j(this,"time",void 0),j(this,"settings",void 0),this._inProgress=!1,this._handle=null,this._timeline=e,this.time=0,this.settings={duration:0}}get inProgress(){return this._inProgress}start(e){var i,l;this.cancel(),this.settings=e,this._inProgress=!0,(i=(l=this.settings).onStart)===null||i===void 0||i.call(l,this)}end(){if(this._inProgress){var e,i;this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(e=(i=this.settings).onEnd)===null||e===void 0||e.call(i,this)}}cancel(){if(this._inProgress){var e,i;(e=(i=this.settings).onInterrupt)===null||e===void 0||e.call(i,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1}}update(){var e,i;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:l,settings:u}=this;this._handle=l.addChannel({delay:l.getTime(),duration:u.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(e=(i=this.settings).onUpdate)===null||e===void 0||e.call(i,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const jx=()=>{},Gg={BREAK:1,SNAP_TO_END:2,IGNORE:3},VR=r=>r,GR=Gg.BREAK;let ZR=class{constructor(e){j(this,"getControllerState",void 0),j(this,"props",void 0),j(this,"propsInTransition",void 0),j(this,"transition",void 0),j(this,"onViewStateChange",void 0),j(this,"onStateChange",void 0),j(this,"_onTransitionUpdate",i=>{const{time:l,settings:{interpolator:u,startProps:m,endProps:y,duration:T,easing:a}}=i,P=a(l/T),D=u.interpolateProps(m,y,P);this.propsInTransition=this.getControllerState({...this.props,...D}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})}),this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new Vh(e.timeline),this.onViewStateChange=e.onViewStateChange||jx,this.onStateChange=e.onStateChange||jx}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let i=!1;const l=this.props;if(this.props=e,!l||this._shouldIgnoreViewportChange(l,e))return!1;if(this._isTransitionEnabled(e)){let u=l;if(this.transition.inProgress){const{interruption:m,endProps:y}=this.transition.settings;u={...l,...m===Gg.SNAP_TO_END?y:this.propsInTransition||l}}this._triggerTransition(u,e),i=!0}else this.transition.cancel();return i}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:i,transitionInterpolator:l}=e;return(i>0||i==="auto")&&!!l}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,i){return this.transition.inProgress?this.transition.settings.interruption===Gg.IGNORE||this._isUpdateDueToCurrentTransition(i):this._isTransitionEnabled(i)?i.transitionInterpolator.arePropsEqual(e,i):!0}_triggerTransition(e,i){const l=this.getControllerState(e),u=this.getControllerState(i).shortestPathFrom(l),m=i.transitionInterpolator,y=m.getDuration?m.getDuration(e,i):i.transitionDuration;if(y===0)return;const T=m.initializeProps(e,u);this.propsInTransition={};const a={duration:y,easing:i.transitionEasing||VR,interpolator:m,interruption:i.transitionInterruption||GR,startProps:T.start,endProps:T.end,onStart:i.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(i.onTransitionInterrupt),onEnd:this._onTransitionEnd(i.onTransitionEnd)};this.transition.start(a),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return i=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e?.(i)}}},$R=class{constructor(e){j(this,"_propsToCompare",void 0),j(this,"_propsToExtract",void 0),j(this,"_requiredProps",void 0);const{compare:i,extract:l,required:u}=e;this._propsToCompare=i,this._propsToExtract=l||i,this._requiredProps=u}arePropsEqual(e,i){for(const l of this._propsToCompare)if(!(l in e)||!(l in i)||!Lc(e[l],i[l]))return!1;return!0}initializeProps(e,i){const l={},u={};for(const m of this._propsToExtract)(m in e||m in i)&&(l[m]=e[m],u[m]=i[m]);return this._checkRequiredProps(l),this._checkRequiredProps(u),{start:l,end:u}}getDuration(e,i){return i.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(i=>{const l=e[i];kr(Number.isFinite(l)||Array.isArray(l),"".concat(i," is required for transition"))})}};const WR=["longitude","latitude","zoom","bearing","pitch"],qR=["longitude","latitude","zoom"];let T_=class extends $R{constructor(e={}){const i=Array.isArray(e)?e:e.transitionProps,l=Array.isArray(e)?{}:e;l.transitionProps=Array.isArray(i)?{compare:i,required:i}:i||{compare:WR,required:qR},super(l.transitionProps),j(this,"opts",void 0),this.opts=l}initializeProps(e,i){const l=super.initializeProps(e,i),{makeViewport:u,around:m}=this.opts;if(u&&m){const y=u(e),T=u(i),a=y.unproject(m);l.start.around=m,Object.assign(l.end,{around:T.project(a),aroundPosition:a,width:i.width,height:i.height})}return l}interpolateProps(e,i,l){const u={};for(const m of this._propsToExtract)u[m]=Xd(e[m]||0,i[m]||0,l);if(i.aroundPosition&&this.opts.makeViewport){const m=this.opts.makeViewport({...i,...u});Object.assign(u,m.panByPosition(i.aroundPosition,Xd(e.around,i.around,l)))}return u}};const oa={transitionDuration:0},XR=300,Pd=r=>1-(1-r)*(1-r),gc={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},il={};class Sw{constructor(e){j(this,"props",void 0),j(this,"state",{}),j(this,"transitionManager",void 0),j(this,"eventManager",void 0),j(this,"onViewStateChange",void 0),j(this,"onStateChange",void 0),j(this,"makeViewport",void 0),j(this,"_controllerState",void 0),j(this,"_events",{}),j(this,"_interactionState",{isDragging:!1}),j(this,"_customEvents",[]),j(this,"_eventStartBlocked",null),j(this,"_panMove",!1),j(this,"invertPan",!1),j(this,"dragMode","rotate"),j(this,"inertia",0),j(this,"scrollZoom",!0),j(this,"dragPan",!0),j(this,"dragRotate",!0),j(this,"doubleClickZoom",!0),j(this,"touchZoom",!0),j(this,"touchRotate",!1),j(this,"keyboard",!0),this.transitionManager=new ZR({...e,getControllerState:i=>new this.ControllerState(i),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){for(const i in this._events)if(this._events[i]){var e;(e=this.eventManager)===null||e===void 0||e.off(i,this.handleEvent)}this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const i=this._eventStartBlocked;switch(e.type){case"panstart":return i?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return i?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"tripanstart":return i?!1:this._onTriplePanStart(e);case"tripanmove":return this._onTriplePan(e);case"tripanend":return this._onTriplePanEnd(e);case"doubletap":return this._onDoubleTap(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:i,y:l}=this.props,{offsetCenter:u}=e;return[u.x-i,u.y-l]}isPointInBounds(e,i){const{width:l,height:u}=this.props;if(i&&i.handled)return!1;const m=e[0]>=0&&e[0]<=l&&e[1]>=0&&e[1]<=u;return m&&i&&i.stopPropagation(),m}isFunctionKeyPressed(e){const{srcEvent:i}=e;return!!(i.metaKey||i.altKey||i.ctrlKey||i.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const i=setTimeout(()=>{this._eventStartBlocked===i&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=i}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:i}=e;this.inertia=Number.isFinite(i)?i:i===!0?XR:0;const{scrollZoom:l=!0,dragPan:u=!0,dragRotate:m=!0,doubleClickZoom:y=!0,touchZoom:T=!0,touchRotate:a=!1,keyboard:P=!0}=e,D=!!this.onViewStateChange;this.toggleEvents(gc.WHEEL,D&&l),this.toggleEvents(gc.PAN,D&&(u||m)),this.toggleEvents(gc.PINCH,D&&(T||a)),this.toggleEvents(gc.TRIPLE_PAN,D&&a),this.toggleEvents(gc.DOUBLE_TAP,D&&y),this.toggleEvents(gc.KEYBOARD,D&&P),this.scrollZoom=l,this.dragPan=u,this.dragRotate=m,this.doubleClickZoom=y,this.touchZoom=T,this.touchRotate=a,this.keyboard=P}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,i){this.eventManager&&e.forEach(l=>{this._events[l]!==i&&(this._events[l]=i,i?this.eventManager.on(l,this.handleEvent):this.eventManager.off(l,this.handleEvent))})}updateViewport(e,i=null,l={}){const u={...e.getViewportProps(),...i},m=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(l),m){const y=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:u,interactionState:this._interactionState,oldViewState:y})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const i=this.getCenter(e);if(!this.isPointInBounds(i,e))return!1;let l=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(l=!l);const u=this.controllerState[l?"panStart":"rotateStart"]({pos:i});return this._panMove=l,this.updateViewport(u,oa,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const i=this.getCenter(e),l=this.controllerState.pan({pos:i});return this.updateViewport(l,oa,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:i}=this;if(this.dragPan&&i&&e.velocity){const l=this.getCenter(e),u=[l[0]+e.velocityX*i/2,l[1]+e.velocityY*i/2],m=this.controllerState.pan({pos:u}).panEnd();this.updateViewport(m,{...this._getTransitionProps(),transitionDuration:i,transitionEasing:Pd},{isDragging:!1,isPanning:!0})}else{const l=this.controllerState.panEnd();this.updateViewport(l,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const i=this.getCenter(e),l=this.controllerState.rotate({pos:i});return this.updateViewport(l,oa,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:i}=this;if(this.dragRotate&&i&&e.velocity){const l=this.getCenter(e),u=[l[0]+e.velocityX*i/2,l[1]+e.velocityY*i/2],m=this.controllerState.rotate({pos:u}).rotateEnd();this.updateViewport(m,{...this._getTransitionProps(),transitionDuration:i,transitionEasing:Pd},{isDragging:!1,isRotating:!0})}else{const l=this.controllerState.rotateEnd();this.updateViewport(l,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;e.srcEvent.preventDefault();const i=this.getCenter(e);if(!this.isPointInBounds(i,e))return!1;const{speed:l=.01,smooth:u=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:m}=e;let y=2/(1+Math.exp(-Math.abs(m*l)));m<0&&y!==0&&(y=1/y);const T=this.controllerState.zoom({pos:i,scale:y});return this.updateViewport(T,{...this._getTransitionProps({around:i}),transitionDuration:u?250:1},{isZooming:!0,isPanning:!0}),!0}_onTriplePanStart(e){const i=this.getCenter(e);if(!this.isPointInBounds(i,e))return!1;const l=this.controllerState.rotateStart({pos:i});return this.updateViewport(l,oa,{isDragging:!0}),!0}_onTriplePan(e){if(!this.touchRotate||!this.isDragging())return!1;const i=this.getCenter(e);i[0]-=e.deltaX;const l=this.controllerState.rotate({pos:i});return this.updateViewport(l,oa,{isDragging:!0,isRotating:!0}),!0}_onTriplePanEnd(e){if(!this.isDragging())return!1;const{inertia:i}=this;if(this.touchRotate&&i&&e.velocityY){const l=this.getCenter(e),u=[l[0],l[1]+=e.velocityY*i/2],m=this.controllerState.rotate({pos:u});this.updateViewport(m,{...this._getTransitionProps(),transitionDuration:i,transitionEasing:Pd},{isDragging:!1,isRotating:!0}),this.blockEvents(i)}else{const l=this.controllerState.rotateEnd();this.updateViewport(l,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const i=this.getCenter(e);if(!this.isPointInBounds(i,e))return!1;const l=this.controllerState.zoomStart({pos:i}).rotateStart({pos:i});return il._startPinchRotation=e.rotation,il._lastPinchEvent=e,this.updateViewport(l,oa,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let i=this.controllerState;if(this.touchZoom){const{scale:l}=e,u=this.getCenter(e);i=i.zoom({pos:u,scale:l})}if(this.touchRotate){const{rotation:l}=e;i=i.rotate({deltaAngleX:il._startPinchRotation-l})}return this.updateViewport(i,oa,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),il._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:i}=this,{_lastPinchEvent:l}=il;if(this.touchZoom&&i&&l&&e.scale!==l.scale){const u=this.getCenter(e);let m=this.controllerState.rotateEnd();const y=Math.log2(e.scale),T=(y-Math.log2(l.scale))/(e.deltaTime-l.deltaTime),a=Math.pow(2,y+T*i/2);m=m.zoom({pos:u,scale:a}).zoomEnd(),this.updateViewport(m,{...this._getTransitionProps({around:u}),transitionDuration:i,transitionEasing:Pd},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(i)}else{const u=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(u,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return il._startPinchRotation=null,il._lastPinchEvent=null,!0}_onDoubleTap(e){if(!this.doubleClickZoom)return!1;const i=this.getCenter(e);if(!this.isPointInBounds(i,e))return!1;const l=this.isFunctionKeyPressed(e),u=this.controllerState.zoom({pos:i,scale:l?.5:2});return this.updateViewport(u,this._getTransitionProps({around:i}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const i=this.isFunctionKeyPressed(e),{zoomSpeed:l,moveSpeed:u,rotateSpeedX:m,rotateSpeedY:y}=this.keyboard===!0?{}:this.keyboard,{controllerState:T}=this;let a;const P={};switch(e.srcEvent.code){case"Minus":a=i?T.zoomOut(l).zoomOut(l):T.zoomOut(l),P.isZooming=!0;break;case"Equal":a=i?T.zoomIn(l).zoomIn(l):T.zoomIn(l),P.isZooming=!0;break;case"ArrowLeft":i?(a=T.rotateLeft(m),P.isRotating=!0):(a=T.moveLeft(u),P.isPanning=!0);break;case"ArrowRight":i?(a=T.rotateRight(m),P.isRotating=!0):(a=T.moveRight(u),P.isPanning=!0);break;case"ArrowUp":i?(a=T.rotateUp(y),P.isRotating=!0):(a=T.moveUp(u),P.isPanning=!0);break;case"ArrowDown":i?(a=T.rotateDown(y),P.isRotating=!0):(a=T.moveDown(u),P.isPanning=!0);break;default:return!1}return this.updateViewport(a,this._getTransitionProps(),P),!0}_getTransitionProps(e){const{transition:i}=this;return!i||!i.transitionInterpolator?oa:e?{...i,transitionInterpolator:new T_({...e,...i.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:i}}class Aw{constructor(e,i){j(this,"_viewportProps",void 0),j(this,"_state",void 0),this._viewportProps=this.applyConstraints(e),this._state=i}getViewportProps(){return this._viewportProps}getState(){return this._state}}const Vx=5,HR=1.2;let YR=class extends Aw{constructor(e){const{width:i,height:l,latitude:u,longitude:m,zoom:y,bearing:T=0,pitch:a=0,altitude:P=1.5,position:D=[0,0,0],maxZoom:N=20,minZoom:F=0,maxPitch:W=60,minPitch:oe=0,startPanLngLat:me,startZoomLngLat:fe,startRotatePos:Ee,startBearing:Ce,startPitch:ke,startZoom:$e,normalize:Ve=!0}=e;kr(Number.isFinite(m)),kr(Number.isFinite(u)),kr(Number.isFinite(y)),super({width:i,height:l,latitude:u,longitude:m,zoom:y,bearing:T,pitch:a,altitude:P,maxZoom:N,minZoom:F,maxPitch:W,minPitch:oe,normalize:Ve,position:D},{startPanLngLat:me,startZoomLngLat:fe,startRotatePos:Ee,startBearing:Ce,startPitch:ke,startZoom:$e}),j(this,"makeViewport",void 0),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:i}){const l=this.getState().startPanLngLat||this._unproject(i);if(!l)return this;const m=this.makeViewport(this.getViewportProps()).panByPosition(l,e);return this._getUpdatedState(m)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:i=0,deltaAngleY:l=0}){const{startRotatePos:u,startBearing:m,startPitch:y}=this.getState();if(!u||m===void 0||y===void 0)return this;let T;return e?T=this._getNewRotation(e,u,y,m):T={bearing:m+i,pitch:y+l},this._getUpdatedState(T)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:i,scale:l}){let{startZoom:u,startZoomLngLat:m}=this.getState();if(m||(u=this.getViewportProps().zoom,m=this._unproject(i)||this._unproject(e)),!m)return this;const{maxZoom:y,minZoom:T}=this.getViewportProps();let a=u+Math.log2(l);a=Rr(a,T,y);const P=this.makeViewport({...this.getViewportProps(),zoom:a});return this._getUpdatedState({zoom:a,...P.panByPosition(m,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const i=e.getViewportProps(),l={...this.getViewportProps()},{bearing:u,longitude:m}=l;return Math.abs(u-i.bearing)>180&&(l.bearing=u<0?u+360:u-360),Math.abs(m-i.longitude)>180&&(l.longitude=m<0?m+360:m-360),l}applyConstraints(e){const{maxZoom:i,minZoom:l,zoom:u}=e;e.zoom=Rr(u,l,i);const{maxPitch:m,minPitch:y,pitch:T}=e;e.pitch=Rr(T,y,m);const{normalize:a=!0}=e;return a&&Object.assign(e,gw(e)),e}_zoomFromCenter(e){const{width:i,height:l}=this.getViewportProps();return this.zoom({pos:[i/2,l/2],scale:e})}_panFromCenter(e){const{width:i,height:l}=this.getViewportProps();return this.pan({startPos:[i/2,l/2],pos:[i/2+e[0],l/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const i=this.makeViewport(this.getViewportProps());return e&&i.unproject(e)}_getNewRotation(e,i,l,u){const m=e[0]-i[0],y=e[1]-i[1],T=e[1],a=i[1],{width:P,height:D}=this.getViewportProps(),N=m/P;let F=0;y>0?Math.abs(D-a)>Vx&&(F=y/(a-D)*HR):y<0&&a>Vx&&(F=1-T/a),F=Rr(F,-1,1);const{minPitch:W,maxPitch:oe}=this.getViewportProps(),me=u+180*N;let fe=l;return F>0?fe=l+F*(oe-l):F<0&&(fe=l-F*(W-l)),{pitch:fe,bearing:me}}},KR=class extends Sw{constructor(...e){super(...e),j(this,"ControllerState",YR),j(this,"transition",{transitionDuration:300,transitionInterpolator:new T_({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})}),j(this,"dragMode","pan")}setProps(e){e.position=e.position||[0,0,0];const i=this.props;super.setProps(e),(!i||i.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}};class Mw extends fl{get ViewportType(){return ua}get ControllerType(){return KR}}j(Mw,"displayName","MapView");class JR extends fp{constructor(e,i){super(e,i),j(this,"maskMap",void 0),j(this,"fbo",void 0);const{mapSize:l=2048}=i;this.maskMap=new In(e,{width:l,height:l,parameters:{10241:9729,10240:9729,10242:33071,10243:33071}}),this.fbo=new tr(e,{id:"maskmap",width:l,height:l,attachments:{36064:this.maskMap}})}render(e){const i=this.gl,l=[!1,!1,!1,!1];return l[e.channel]=!0,Vn(i,{clearColor:[255,255,255,255],blend:!0,blendFunc:[0,1],blendEquation:32778,colorMask:l,depthTest:!1},()=>super.render({...e,target:this.fbo,pass:"mask"}))}shouldDrawLayer(e){return e.props.operation===jh.MASK}delete(){this.fbo.delete(),this.maskMap.delete()}}const QR=new Zn().lookAt({eye:[0,0,1]});function eO({width:r,height:e,near:i,far:l,padding:u}){let m=-r/2,y=r/2,T=-e/2,a=e/2;if(u){const{left:P=0,right:D=0,top:N=0,bottom:F=0}=u,W=Rr((P+r-D)/2,0,r)-r/2,oe=Rr((N+e-F)/2,0,e)-e/2;m-=W,y-=W,T+=oe,a+=oe}return new Zn().ortho({left:m,right:y,bottom:T,top:a,near:i,far:l})}class tO extends pl{constructor(e){const{width:i,height:l,near:u=.1,far:m=1e3,zoom:y=0,target:T=[0,0,0],padding:a=null,flipY:P=!0}=e,D=Array.isArray(y)?y[0]:y,N=Array.isArray(y)?y[1]:y,F=Math.min(D,N),W=Math.pow(2,F);let oe;if(D!==N){const me=Math.pow(2,D),fe=Math.pow(2,N);oe={unitsPerMeter:[me/W,fe/W,1],metersPerUnit:[W/me,W/fe,1]}}super({...e,longitude:void 0,position:T,viewMatrix:QR.clone().scale([W,W*(P?-1:1),W]),projectionMatrix:eO({width:i||1,height:l||1,padding:a,near:u,far:m}),zoom:F,distanceScales:oe})}projectFlat([e,i]){const{unitsPerMeter:l}=this.distanceScales;return[e*l[0],i*l[1]]}unprojectFlat([e,i]){const{metersPerUnit:l}=this.distanceScales;return[e*l[0],i*l[1]]}panByPosition(e,i){const l=Oc(i,this.pixelUnprojectionMatrix),u=this.projectFlat(e),m=ul([],u,g_([],l)),y=ul([],this.center,m);return{target:this.unprojectFlat(y)}}}class iO extends Aw{constructor(e){const{width:i,height:l,rotationX:u=0,rotationOrbit:m=0,target:y=[0,0,0],zoom:T=0,minRotationX:a=-90,maxRotationX:P=90,minZoom:D=-1/0,maxZoom:N=1/0,startPanPosition:F,startRotatePos:W,startRotationX:oe,startRotationOrbit:me,startZoomPosition:fe,startZoom:Ee}=e;super({width:i,height:l,rotationX:u,rotationOrbit:m,target:y,zoom:T,minRotationX:a,maxRotationX:P,minZoom:D,maxZoom:N},{startPanPosition:F,startRotatePos:W,startRotationX:oe,startRotationOrbit:me,startZoomPosition:fe,startZoom:Ee}),j(this,"makeViewport",void 0),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanPosition:this._unproject(e)})}pan({pos:e,startPosition:i}){const l=this.getState().startPanPosition||i;if(!l)return this;const m=this.makeViewport(this.getViewportProps()).panByPosition(l,e);return this._getUpdatedState(m)}panEnd(){return this._getUpdatedState({startPanPosition:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startRotationX:this.getViewportProps().rotationX,startRotationOrbit:this.getViewportProps().rotationOrbit})}rotate({pos:e,deltaAngleX:i=0,deltaAngleY:l=0}){const{startRotatePos:u,startRotationX:m,startRotationOrbit:y}=this.getState(),{width:T,height:a}=this.getViewportProps();if(!u||m===void 0||y===void 0)return this;let P;if(e){let D=(e[0]-u[0])/T;const N=(e[1]-u[1])/a;(m<-90||m>90)&&(D*=-1),P={rotationX:m+N*180,rotationOrbit:y+D*180}}else P={rotationX:m+l,rotationOrbit:y+i};return this._getUpdatedState(P)}rotateEnd(){return this._getUpdatedState({startRotationX:null,startRotationOrbit:null})}shortestPathFrom(e){const i=e.getViewportProps(),l={...this.getViewportProps()},{rotationOrbit:u}=l;return Math.abs(u-i.rotationOrbit)>180&&(l.rotationOrbit=u<0?u+360:u-360),l}zoomStart({pos:e}){return this._getUpdatedState({startZoomPosition:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:i,scale:l}){let{startZoom:u,startZoomPosition:m}=this.getState();if(m||(u=this.getViewportProps().zoom,m=this._unproject(i)||this._unproject(e)),!m)return this;const y=this._calculateNewZoom({scale:l,startZoom:u}),T=this.makeViewport({...this.getViewportProps(),zoom:y});return this._getUpdatedState({zoom:y,...T.panByPosition(m,e)})}zoomEnd(){return this._getUpdatedState({startZoomPosition:null,startZoom:null})}zoomIn(e=2){return this._getUpdatedState({zoom:this._calculateNewZoom({scale:e})})}zoomOut(e=2){return this._getUpdatedState({zoom:this._calculateNewZoom({scale:1/e})})}moveLeft(e=50){return this._panFromCenter([-e,0])}moveRight(e=50){return this._panFromCenter([e,0])}moveUp(e=50){return this._panFromCenter([0,-e])}moveDown(e=50){return this._panFromCenter([0,e])}rotateLeft(e=15){return this._getUpdatedState({rotationOrbit:this.getViewportProps().rotationOrbit-e})}rotateRight(e=15){return this._getUpdatedState({rotationOrbit:this.getViewportProps().rotationOrbit+e})}rotateUp(e=10){return this._getUpdatedState({rotationX:this.getViewportProps().rotationX-e})}rotateDown(e=10){return this._getUpdatedState({rotationX:this.getViewportProps().rotationX+e})}_unproject(e){const i=this.makeViewport(this.getViewportProps());return e&&i.unproject(e)}_calculateNewZoom({scale:e,startZoom:i}){const{maxZoom:l,minZoom:u}=this.getViewportProps();i===void 0&&(i=this.getViewportProps().zoom);const m=i+Math.log2(e);return Rr(m,u,l)}_panFromCenter(e){const{width:i,height:l,target:u}=this.getViewportProps();return this.pan({startPosition:u,pos:[i/2+e[0],l/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}applyConstraints(e){const{maxZoom:i,minZoom:l,zoom:u,maxRotationX:m,minRotationX:y,rotationOrbit:T}=e;return e.zoom=Array.isArray(u)?[Rr(u[0],l,i),Rr(u[1],l,i)]:Rr(u,l,i),e.rotationX=Rr(e.rotationX,y,m),(T<-180||T>180)&&(e.rotationOrbit=bR(T+180,360)-180),e}}class rO extends iO{constructor(e){super(e),j(this,"zoomAxis",void 0),this.zoomAxis=e.zoomAxis||"all"}_calculateNewZoom({scale:e,startZoom:i}){const{maxZoom:l,minZoom:u}=this.getViewportProps();i===void 0&&(i=this.getViewportProps().zoom);let m=Math.log2(e);if(Array.isArray(i)){let[y,T]=i;switch(this.zoomAxis){case"X":y=Rr(y+m,u,l);break;case"Y":T=Rr(T+m,u,l);break;default:let a=Math.min(y+m,T+m);a<u&&(m+=u-a),a=Math.max(y+m,T+m),a>l&&(m+=l-a),y+=m,T+=m}return[y,T]}return Rr(i+m,u,l)}}class nO extends Sw{constructor(...e){super(...e),j(this,"ControllerState",rO),j(this,"transition",{transitionDuration:300,transitionInterpolator:new T_(["target","zoom"])}),j(this,"dragMode","pan")}_onPanRotate(){return!1}}class Pw extends fl{get ViewportType(){return tO}get ControllerType(){return nO}}j(Pw,"displayName","OrthographicView");function sO({layers:r,viewport:e}){let i=null;for(const m of r){const y=m.getBounds();y&&(i?(i[0]=Math.min(i[0],y[0][0]),i[1]=Math.min(i[1],y[0][1]),i[2]=Math.max(i[2],y[1][0]),i[3]=Math.max(i[3],y[1][1])):i=[y[0][0],y[0][1],y[1][0],y[1][1]])}const l=e.getBounds();if(!i)return l;const u=aO(l);return i[2]-i[0]<u[2]-u[0]||i[3]-i[1]<u[3]-u[1]||(i[0]=Math.max(i[0],u[0]),i[1]=Math.max(i[1],u[1]),i[2]=Math.min(i[2],u[2]),i[3]=Math.min(i[3],u[3])),i}function oO({bounds:r,viewport:e,width:i,height:l}){if(r[2]<=r[0]||r[3]<=r[1])return null;const u=1;if(i-=u*2,l-=u*2,e instanceof ua){const{longitude:T,latitude:a,zoom:P}=w_({width:i,height:l,bounds:[[r[0],r[1]],[r[2],r[3]]],maxZoom:20});return new ua({longitude:T,latitude:a,zoom:P,x:u,y:u,width:i,height:l})}const m=[(r[0]+r[2])/2,(r[1]+r[3])/2,0],y=Math.min(20,i/(r[2]-r[0]),l/(r[3]-r[1]));return new Pw({x:u,y:u}).makeViewport({width:i,height:l,viewState:{target:m,zoom:Math.log2(y)}})}function aO(r){const e={x:r[2]-r[0],y:r[3]-r[1]},i={x:r[0]+.5*e.x,y:r[1]+.5*e.y};return[i.x-e.x,i.y-e.y,i.x+e.x,i.y+e.y]}class lO{constructor(){j(this,"id","mask-effect"),j(this,"props",null),j(this,"useInPicking",!0),j(this,"dummyMaskMap",void 0),j(this,"channels",[]),j(this,"masks",null),j(this,"maskPass",void 0),j(this,"maskMap",void 0),j(this,"lastViewport",void 0)}preRender(e,{layers:i,layerFilter:l,viewports:u,onViewportActive:m,views:y}){this.dummyMaskMap||(this.dummyMaskMap=new In(e,{width:1,height:1}));const T=i.filter(N=>N.props.visible&&N.props.operation===jh.MASK);if(T.length===0){this.masks=null,this.channels.length=0;return}this.masks={},this.maskPass||(this.maskPass=new JR(e,{id:"default-mask"}),this.maskMap=this.maskPass.maskMap);const a=this._sortMaskChannels(T),P=u[0],D=!this.lastViewport||!this.lastViewport.equals(P);for(const N in a)this._renderChannel(a[N],{layerFilter:l,onViewportActive:m,views:y,viewport:P,viewportChanged:D})}_renderChannel(e,{layerFilter:i,onViewportActive:l,views:u,viewport:m,viewportChanged:y}){const T=this.channels[e.index];if(!T)return;const a=e===T||T.layers.length!==e.layers.length||e.layerBounds.some((P,D)=>P!==T.layerBounds[D]);if(e.bounds=T.bounds,e.maskBounds=T.maskBounds,this.channels[e.index]=e,(a||y)&&(this.lastViewport=m,e.bounds=sO({layers:e.layers,viewport:m}),a||!Lc(e.bounds,T.bounds))){const{maskPass:P,maskMap:D}=this,N=oO({bounds:e.bounds,viewport:m,width:D.width,height:D.height});e.maskBounds=N?N.getBounds():[0,0,1,1],P.render({pass:"mask",channel:e.index,layers:e.layers,layerFilter:i,viewports:N?[N]:[],onViewportActive:l,views:u,moduleParameters:{devicePixelRatio:1}})}this.masks[e.id]={index:e.index,bounds:e.maskBounds,coordinateOrigin:e.coordinateOrigin,coordinateSystem:e.coordinateSystem}}_sortMaskChannels(e){const i={};let l=0;for(const u of e){const{id:m}=u.root;let y=i[m];if(!y){if(++l>4){Ii.warn("Too many mask layers. The max supported is 4")();continue}y={id:m,index:this.channels.findIndex(T=>T?.id===m),layers:[],layerBounds:[],coordinateOrigin:u.root.props.coordinateOrigin,coordinateSystem:u.root.props.coordinateSystem},i[m]=y}y.layers.push(u),y.layerBounds.push(u.getBounds())}for(let u=0;u<4;u++){const m=this.channels[u];(!m||!(m.id in i))&&(this.channels[u]=null)}for(const u in i){const m=i[u];m.index<0&&(m.index=this.channels.findIndex(y=>!y),this.channels[m.index]=m)}return i}getModuleParameters(){return{maskMap:this.masks?this.maskMap:this.dummyMaskMap,maskChannels:this.masks}}cleanup(){this.dummyMaskMap&&(this.dummyMaskMap.delete(),this.dummyMaskMap=void 0),this.maskPass&&(this.maskPass.delete(),this.maskPass=void 0,this.maskMap=void 0),this.lastViewport=void 0,this.masks=null,this.channels.length=0}}const cO=new bw;class uO{constructor(){j(this,"effects",void 0),j(this,"_internalEffects",void 0),j(this,"_needsRedraw",void 0),this.effects=[],this._internalEffects=[],this._needsRedraw="Initial render",this.setEffects()}setProps(e){"effects"in e&&(e.effects.length!==this.effects.length||!Bc(e.effects,this.effects))&&(this.setEffects(e.effects),this._needsRedraw="effects changed")}needsRedraw(e={clearRedrawFlags:!1}){const i=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),i}getEffects(){return this._internalEffects}finalize(){this.cleanup()}setEffects(e=[]){this.cleanup(),this.effects=e,this._internalEffects=e.slice(),this._internalEffects.push(new lO),e.some(i=>i instanceof bw)||this._internalEffects.push(cO)}cleanup(){for(const e of this.effects)e.cleanup();for(const e of this._internalEffects)e.cleanup();this.effects.length=0,this._internalEffects.length=0}}class hO extends fp{shouldDrawLayer(e){return e.props.operation===jh.DRAW}}const Gx={blendFunc:[1,0,32771,0],blendEquation:32774};class Iw extends fp{constructor(...e){super(...e),j(this,"pickZ",void 0),j(this,"_colors",null)}render(e){return e.pickingFBO?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:i,views:l,viewports:u,onViewportActive:m,pickingFBO:y,deviceRect:{x:T,y:a,width:P,height:D},cullRect:N,effects:F,pass:W="picking",pickZ:oe}){const me=this.gl;this.pickZ=oe;const fe=oe?null:{byLayer:new Map,byAlpha:[]};this._colors=fe;const Ee=Vn(me,{scissorTest:!0,scissor:[T,a,P,D],clearColor:[0,0,0,0],depthMask:!0,depthTest:!0,depthRange:[0,1],colorMask:[!0,!0,!0,!0],...Gx,blend:!oe},()=>super.render({target:y,layers:e,layerFilter:i,views:l,viewports:u,onViewportActive:m,cullRect:N,effects:F?.filter(ke=>ke.useInPicking),pass:W}));return this._colors=null,{decodePickingColor:fe&&dO.bind(null,fe),stats:Ee}}shouldDrawLayer(e){return e.props.pickable&&e.props.operation===jh.DRAW}getModuleParameters(){return{pickingActive:1,pickingAttribute:this.pickZ,lightSources:{}}}getLayerParameters(e,i,l){const u={...e.props.parameters};return this._colors?(Object.assign(u,Gx),u.blend=!0,u.blendColor=fO(this._colors,e,l)):u.blend=!1,u}}function fO(r,e,i){const{byLayer:l,byAlpha:u}=r;let m,y=l.get(e);return y?(y.viewports.push(i),m=y.a):(m=l.size+1,m<=255?(y={a:m,layer:e,viewports:[i]},l.set(e,y),u[m]=y):(Ii.warn("Too many pickable layers, only picking the first 255")(),m=0)),[0,0,0,m/255]}function dO(r,e){const i=r.byAlpha[e[3]];return i&&{pickedLayer:i.layer,pickedViewports:i.viewports,pickedObjectIndex:i.layer.decodePickingColor(e)}}const pO="deckRenderer.renderLayers";class mO{constructor(e){this.gl=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new hO(e),this.pickLayersPass=new Iw(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){"layerFilter"in e&&this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),"drawPickingColors"in e&&this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){const i=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass;e.layerFilter=e.layerFilter||this.layerFilter,e.effects=e.effects||[],e.target=e.target||tr.getDefaultFramebuffer(this.gl),this._preRender(e.effects,e);const l=this.lastPostProcessEffect?this.renderBuffers[0]:e.target,u=i.render({...e,target:l});this._postRender(e.effects,e),this.renderCount++,Qr(pO,this,u,e)}needsRedraw(e={clearRedrawFlags:!1}){const i=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),i}finalize(){const{renderBuffers:e}=this;for(const i of e)i.delete();e.length=0}_preRender(e,i){let l=null;for(const u of e)u.preRender(this.gl,i),u.postRender&&(l=u);l&&this._resizeRenderBuffers(),this.lastPostProcessEffect=l}_resizeRenderBuffers(){const{renderBuffers:e}=this;e.length===0&&e.push(new tr(this.gl),new tr(this.gl));for(const i of e)i.resize()}_postRender(e,i){const{renderBuffers:l}=this,u={inputBuffer:l[0],swapBuffer:l[1],target:null};for(const m of e)if(m.postRender){if(m===this.lastPostProcessEffect){u.target=i.target,m.postRender(this.gl,u);break}const y=m.postRender(this.gl,u);u.inputBuffer=y,u.swapBuffer=y===l[0]?l[1]:l[0]}}}const gO={pickedColor:null,pickedObjectIndex:-1};function _O({pickedColors:r,decodePickingColor:e,deviceX:i,deviceY:l,deviceRadius:u,deviceRect:m}){const{x:y,y:T,width:a,height:P}=m;let D=u*u,N=-1,F=0;for(let W=0;W<P;W++){const oe=W+T-l,me=oe*oe;if(me>D)F+=4*a;else for(let fe=0;fe<a;fe++){if(r[F+3]-1>=0){const Ce=fe+y-i,ke=Ce*Ce+me;ke<=D&&(D=ke,N=F)}F+=4}}if(N>=0){const W=r.slice(N,N+4),oe=e(W);if(oe){const me=Math.floor(N/4/a),fe=N/4-me*a;return{...oe,pickedColor:W,pickedX:y+fe,pickedY:T+me}}Ii.error("Picked non-existent layer. Is picking buffer corrupt?")()}return gO}function yO({pickedColors:r,decodePickingColor:e}){const i=new Map;if(r){for(let l=0;l<r.length;l+=4)if(r[l+3]-1>=0){const m=r.slice(l,l+4),y=m.join(",");if(!i.has(y)){const T=e(m);T?i.set(y,{...T,color:m}):Ii.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(i.values())}function Cw({pickInfo:r,viewports:e,pixelRatio:i,x:l,y:u,z:m}){let y=e[0];e.length>1&&(y=xO(r?.pickedViewports||e,{x:l,y:u}));let T;if(y){const a=[l-y.x,u-y.y];m!==void 0&&(a[2]=m),T=y.unproject(a)}return{color:null,layer:null,viewport:y,index:-1,picked:!1,x:l,y:u,pixel:[l,u],coordinate:T,devicePixel:r&&"pickedX"in r?[r.pickedX,r.pickedY]:void 0,pixelRatio:i}}function vO(r){const{pickInfo:e,lastPickedInfo:i,mode:l,layers:u}=r,{pickedColor:m,pickedLayer:y,pickedObjectIndex:T}=e,a=y?[y]:[];if(l==="hover"){const N=i.index,F=i.layerId,W=y?y.props.id:null;if(W!==F||T!==N){if(W!==F){const oe=u.find(me=>me.props.id===F);oe&&a.unshift(oe)}i.layerId=W,i.index=T,i.info=null}}const P=Cw(r),D=new Map;return D.set(null,P),a.forEach(N=>{let F={...P};N===y&&(F.color=m,F.index=T,F.picked=!0),F=Lw({layer:N,info:F,mode:l});const W=F.layer;N===y&&l==="hover"&&(i.info=F),D.set(W.id,F),l==="hover"&&W.updateAutoHighlight(F)}),D}function Lw({layer:r,info:e,mode:i}){for(;r&&e;){const l=e.layer||null;e.sourceLayer=l,e.layer=r,e=r.getPickingInfo({info:e,mode:i,sourceLayer:l}),r=r.parent}return e}function xO(r,e){for(let i=r.length-1;i>=0;i--){const l=r[i];if(l.containsPixel(e))return l}return r[0]}class bO{constructor(e){j(this,"gl",void 0),j(this,"pickingFBO",void 0),j(this,"depthFBO",void 0),j(this,"pickLayersPass",void 0),j(this,"layerFilter",void 0),j(this,"lastPickedInfo",void 0),j(this,"_pickable",!0),this.gl=e,this.pickLayersPass=new Iw(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.delete(),this.depthFBO&&(this.depthFBO.color.delete(),this.depthFBO.delete())}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:i,layers:l,viewports:u},m=this.lastPickedInfo.info){const y=m&&m.layer&&m.layer.id,T=m&&m.viewport&&m.viewport.id,a=y?l.find(F=>F.id===y):null,P=T&&u.find(F=>F.id===T)||u[0],D=P&&P.unproject([e-P.x,i-P.y]);return{...m,...{x:e,y:i,viewport:P,coordinate:D,layer:a}}}_resizeBuffer(){var e,i;const{gl:l}=this;if(!this.pickingFBO&&(this.pickingFBO=new tr(l),tr.isSupported(l,{colorBufferFloat:!0}))){const u=new tr(l);u.attach({36064:new In(l,{format:ai(l)?34836:6408,type:5126})}),this.depthFBO=u}(e=this.pickingFBO)===null||e===void 0||e.resize({width:l.canvas.width,height:l.canvas.height}),(i=this.depthFBO)===null||i===void 0||i.resize({width:l.canvas.width,height:l.canvas.height})}_getPickable(e){if(this._pickable===!1)return null;const i=e.filter(l=>l.isPickable()&&!l.isComposite);return i.length?i:null}_pickClosestObject({layers:e,views:i,viewports:l,x:u,y:m,radius:y=0,depth:T=1,mode:a="query",unproject3D:P,onViewportActive:D,effects:N}){const F=this._getPickable(e),W=Mc(this.gl);if(!F)return{result:[],emptyInfo:Cw({viewports:l,x:u,y:m,pixelRatio:W})};this._resizeBuffer();const oe=Ym(this.gl,[u,m],!0),me=[oe.x+Math.floor(oe.width/2),oe.y+Math.floor(oe.height/2)],fe=Math.round(y*W),{width:Ee,height:Ce}=this.pickingFBO,ke=this._getPickingRect({deviceX:me[0],deviceY:me[1],deviceRadius:fe,deviceWidth:Ee,deviceHeight:Ce}),$e={x:u-y,y:m-y,width:y*2+1,height:y*2+1};let Ve;const Re=[],ot=new Set;for(let bt=0;bt<T;bt++){let mt;if(ke){const gt=this._drawAndSample({layers:F,views:i,viewports:l,onViewportActive:D,deviceRect:ke,cullRect:$e,effects:N,pass:"picking:".concat(a)});mt=_O({...gt,deviceX:me[0],deviceY:me[1],deviceRadius:fe,deviceRect:ke})}else mt={pickedColor:null,pickedObjectIndex:-1};let Mt;mt.pickedLayer&&P&&this.depthFBO&&(Mt=this._drawAndSample({layers:[mt.pickedLayer],views:i,viewports:l,onViewportActive:D,deviceRect:{x:mt.pickedX,y:mt.pickedY,width:1,height:1},cullRect:$e,effects:N,pass:"picking:".concat(a,":z")},!0).pickedColors[0]),mt.pickedLayer&&bt+1<T&&(ot.add(mt.pickedLayer),mt.pickedLayer.disablePickingIndex(mt.pickedObjectIndex)),Ve=vO({pickInfo:mt,lastPickedInfo:this.lastPickedInfo,mode:a,layers:F,viewports:l,x:u,y:m,z:Mt,pixelRatio:W});for(const gt of Ve.values())gt.layer&&Re.push(gt);if(!mt.pickedColor)break}for(const bt of ot)bt.restorePickingColors();return{result:Re,emptyInfo:Ve.get(null)}}_pickVisibleObjects({layers:e,views:i,viewports:l,x:u,y:m,width:y=1,height:T=1,mode:a="query",maxObjects:P=null,onViewportActive:D,effects:N}){const F=this._getPickable(e);if(!F)return[];this._resizeBuffer();const W=Mc(this.gl),oe=Ym(this.gl,[u,m],!0),me=oe.x,fe=oe.y+oe.height,Ee=Ym(this.gl,[u+y,m+T],!0),Ce=Ee.x+Ee.width,ke=Ee.y,$e={x:me,y:ke,width:Ce-me,height:fe-ke},Ve=this._drawAndSample({layers:F,views:i,viewports:l,onViewportActive:D,deviceRect:$e,cullRect:{x:u,y:m,width:y,height:T},effects:N,pass:"picking:".concat(a)}),Re=yO(Ve),ot=new Map,bt=Number.isFinite(P);for(let mt=0;mt<Re.length&&!(bt&&P&&ot.size>=P);mt++){const Mt=Re[mt];let gt={color:Mt.pickedColor,layer:null,index:Mt.pickedObjectIndex,picked:!0,x:u,y:m,pixelRatio:W};gt=Lw({layer:Mt.pickedLayer,info:gt,mode:a}),ot.has(gt.object)||ot.set(gt.object,gt)}return Array.from(ot.values())}_drawAndSample({layers:e,views:i,viewports:l,onViewportActive:u,deviceRect:m,cullRect:y,effects:T,pass:a},P=!1){const D=P?this.depthFBO:this.pickingFBO,{decodePickingColor:N}=this.pickLayersPass.render({layers:e,layerFilter:this.layerFilter,views:i,viewports:l,onViewportActive:u,pickingFBO:D,deviceRect:m,cullRect:y,effects:T,pass:a,pickZ:P}),{x:F,y:W,width:oe,height:me}=m,fe=new(P?Float32Array:Uint8Array)(oe*me*4);return cp(D,{sourceX:F,sourceY:W,sourceWidth:oe,sourceHeight:me,target:fe}),{pickedColors:fe,decodePickingColor:N}}_getPickingRect({deviceX:e,deviceY:i,deviceRadius:l,deviceWidth:u,deviceHeight:m}){const y=Math.max(0,e-l),T=Math.max(0,i-l),a=Math.min(u,e+l+1)-y,P=Math.min(m,i+l+1)-T;return a<=0||P<=0?null:{x:y,y:T,width:a,height:P}}}const wO={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class TO{constructor(e){j(this,"el",null),j(this,"isVisible",!1);const i=e.parentElement;i&&(this.el=document.createElement("div"),this.el.className="deck-tooltip",Object.assign(this.el.style,wO),i.appendChild(this.el))}setTooltip(e,i,l){const u=this.el;if(u){if(typeof e=="string")u.innerText=e;else if(e)e.text&&(u.innerText=e.text),e.html&&(u.innerHTML=e.html),e.className&&(u.className=e.className),Object.assign(u.style,e.style);else{this.isVisible=!1,u.style.display="none";return}this.isVisible=!0,u.style.display="block",u.style.transform="translate(".concat(i,"px, ").concat(l,"px)")}}remove(){this.el&&(this.el.remove(),this.el=null)}}var kw={exports:{}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */(function(r){(function(e,i,l,u){var m=["","webkit","Moz","MS","ms","o"],y=i.createElement("div"),T="function",a=Math.round,P=Math.abs,D=Date.now;function N($,Q,ce){return setTimeout(ke($,ce),Q)}function F($,Q,ce){return Array.isArray($)?(W($,ce[Q],ce),!0):!1}function W($,Q,ce){var De;if($)if($.forEach)$.forEach(Q,ce);else if($.length!==u)for(De=0;De<$.length;)Q.call(ce,$[De],De,$),De++;else for(De in $)$.hasOwnProperty(De)&&Q.call(ce,$[De],De,$)}function oe($,Q,ce){var De="DEPRECATED METHOD: "+Q+`
`+ce+` AT 
`;return function(){var tt=new Error("get-stack-trace"),dt=tt&&tt.stack?tt.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Rt=e.console&&(e.console.warn||e.console.log);return Rt&&Rt.call(e.console,De,dt),$.apply(this,arguments)}}var me;typeof Object.assign!="function"?me=function(Q){if(Q===u||Q===null)throw new TypeError("Cannot convert undefined or null to object");for(var ce=Object(Q),De=1;De<arguments.length;De++){var tt=arguments[De];if(tt!==u&&tt!==null)for(var dt in tt)tt.hasOwnProperty(dt)&&(ce[dt]=tt[dt])}return ce}:me=Object.assign;var fe=oe(function(Q,ce,De){for(var tt=Object.keys(ce),dt=0;dt<tt.length;)(!De||De&&Q[tt[dt]]===u)&&(Q[tt[dt]]=ce[tt[dt]]),dt++;return Q},"extend","Use `assign`."),Ee=oe(function(Q,ce){return fe(Q,ce,!0)},"merge","Use `assign`.");function Ce($,Q,ce){var De=Q.prototype,tt;tt=$.prototype=Object.create(De),tt.constructor=$,tt._super=De,ce&&me(tt,ce)}function ke($,Q){return function(){return $.apply(Q,arguments)}}function $e($,Q){return typeof $==T?$.apply(Q&&Q[0]||u,Q):$}function Ve($,Q){return $===u?Q:$}function Re($,Q,ce){W(Mt(Q),function(De){$.addEventListener(De,ce,!1)})}function ot($,Q,ce){W(Mt(Q),function(De){$.removeEventListener(De,ce,!1)})}function bt($,Q){for(;$;){if($==Q)return!0;$=$.parentNode}return!1}function mt($,Q){return $.indexOf(Q)>-1}function Mt($){return $.trim().split(/\s+/g)}function gt($,Q,ce){if($.indexOf&&!ce)return $.indexOf(Q);for(var De=0;De<$.length;){if(ce&&$[De][ce]==Q||!ce&&$[De]===Q)return De;De++}return-1}function Ht($){return Array.prototype.slice.call($,0)}function Xt($,Q,ce){for(var De=[],tt=[],dt=0;dt<$.length;){var Rt=$[dt][Q];gt(tt,Rt)<0&&De.push($[dt]),tt[dt]=Rt,dt++}return De=De.sort(function(Si,Kt){return Si[Q]>Kt[Q]}),De}function jt($,Q){for(var ce,De,tt=Q[0].toUpperCase()+Q.slice(1),dt=0;dt<m.length;){if(ce=m[dt],De=ce?ce+tt:Q,De in $)return De;dt++}return u}var Ki=1;function $n(){return Ki++}function Or($){var Q=$.ownerDocument||$;return Q.defaultView||Q.parentWindow||e}var ds=/mobile|tablet|ip(ad|hone|od)|android/i,Zr="ontouchstart"in e,Wn=jt(e,"PointerEvent")!==u,Dr=Zr&&ds.test(navigator.userAgent),hn="touch",Ci="pen",$i="mouse",fn="kinect",wr=25,Li=1,rr=2,yi=4,Wi=8,zr=1,Cn=2,$r=4,Wr=8,$t=16,qi=Cn|$r,Tr=Wr|$t,qr=qi|Tr,Er=["x","y"],dn=["clientX","clientY"];function Dt($,Q){var ce=this;this.manager=$,this.callback=Q,this.element=$.element,this.target=$.options.inputTarget,this.domHandler=function(De){$e($.options.enable,[$])&&ce.handler(De)},this.init()}Dt.prototype={handler:function(){},init:function(){this.evEl&&Re(this.element,this.evEl,this.domHandler),this.evTarget&&Re(this.target,this.evTarget,this.domHandler),this.evWin&&Re(Or(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&ot(this.element,this.evEl,this.domHandler),this.evTarget&&ot(this.target,this.evTarget,this.domHandler),this.evWin&&ot(Or(this.element),this.evWin,this.domHandler)}};function Ln($){var Q,ce=$.options.inputClass;return ce?Q=ce:Wn?Q=rn:Dr?Q=V:Zr?Q=Se:Q=kn,new Q($,pn)}function pn($,Q,ce){var De=ce.pointers.length,tt=ce.changedPointers.length,dt=Q&Li&&De-tt===0,Rt=Q&(yi|Wi)&&De-tt===0;ce.isFirst=!!dt,ce.isFinal=!!Rt,dt&&($.session={}),ce.eventType=Q,mn($,ce),$.emit("hammer.input",ce),$.recognize(ce),$.session.prevInput=ce}function mn($,Q){var ce=$.session,De=Q.pointers,tt=De.length;ce.firstInput||(ce.firstInput=ms(Q)),tt>1&&!ce.firstMultiple?ce.firstMultiple=ms(Q):tt===1&&(ce.firstMultiple=!1);var dt=ce.firstInput,Rt=ce.firstMultiple,Ui=Rt?Rt.center:dt.center,Si=Q.center=gs(De);Q.timeStamp=D(),Q.deltaTime=Q.timeStamp-dt.timeStamp,Q.angle=_s(Ui,Si),Q.distance=tn(Ui,Si),qn(ce,Q),Q.offsetDirection=Xr(Q.deltaX,Q.deltaY);var Kt=dr(Q.deltaTime,Q.deltaX,Q.deltaY);Q.overallVelocityX=Kt.x,Q.overallVelocityY=Kt.y,Q.overallVelocity=P(Kt.x)>P(Kt.y)?Kt.x:Kt.y,Q.scale=Rt?gn(Rt.pointers,De):1,Q.rotation=Rt?Sr(Rt.pointers,De):0,Q.maxPointers=ce.prevInput?Q.pointers.length>ce.prevInput.maxPointers?Q.pointers.length:ce.prevInput.maxPointers:Q.pointers.length,ps(ce,Q);var mr=$.element;bt(Q.srcEvent.target,mr)&&(mr=Q.srcEvent.target),Q.target=mr}function qn($,Q){var ce=Q.center,De=$.offsetDelta||{},tt=$.prevDelta||{},dt=$.prevInput||{};(Q.eventType===Li||dt.eventType===yi)&&(tt=$.prevDelta={x:dt.deltaX||0,y:dt.deltaY||0},De=$.offsetDelta={x:ce.x,y:ce.y}),Q.deltaX=tt.x+(ce.x-De.x),Q.deltaY=tt.y+(ce.y-De.y)}function ps($,Q){var ce=$.lastInterval||Q,De=Q.timeStamp-ce.timeStamp,tt,dt,Rt,Ui;if(Q.eventType!=Wi&&(De>wr||ce.velocity===u)){var Si=Q.deltaX-ce.deltaX,Kt=Q.deltaY-ce.deltaY,mr=dr(De,Si,Kt);dt=mr.x,Rt=mr.y,tt=P(mr.x)>P(mr.y)?mr.x:mr.y,Ui=Xr(Si,Kt),$.lastInterval=Q}else tt=ce.velocity,dt=ce.velocityX,Rt=ce.velocityY,Ui=ce.direction;Q.velocity=tt,Q.velocityX=dt,Q.velocityY=Rt,Q.direction=Ui}function ms($){for(var Q=[],ce=0;ce<$.pointers.length;)Q[ce]={clientX:a($.pointers[ce].clientX),clientY:a($.pointers[ce].clientY)},ce++;return{timeStamp:D(),pointers:Q,center:gs(Q),deltaX:$.deltaX,deltaY:$.deltaY}}function gs($){var Q=$.length;if(Q===1)return{x:a($[0].clientX),y:a($[0].clientY)};for(var ce=0,De=0,tt=0;tt<Q;)ce+=$[tt].clientX,De+=$[tt].clientY,tt++;return{x:a(ce/Q),y:a(De/Q)}}function dr($,Q,ce){return{x:Q/$||0,y:ce/$||0}}function Xr($,Q){return $===Q?zr:P($)>=P(Q)?$<0?Cn:$r:Q<0?Wr:$t}function tn($,Q,ce){ce||(ce=Er);var De=Q[ce[0]]-$[ce[0]],tt=Q[ce[1]]-$[ce[1]];return Math.sqrt(De*De+tt*tt)}function _s($,Q,ce){ce||(ce=Er);var De=Q[ce[0]]-$[ce[0]],tt=Q[ce[1]]-$[ce[1]];return Math.atan2(tt,De)*180/Math.PI}function Sr($,Q){return _s(Q[1],Q[0],dn)+_s($[1],$[0],dn)}function gn($,Q){return tn(Q[0],Q[1],dn)/tn($[0],$[1],dn)}var Ao={mousedown:Li,mousemove:rr,mouseup:yi},Gs="mousedown",Zs="mousemove mouseup";function kn(){this.evEl=Gs,this.evWin=Zs,this.pressed=!1,Dt.apply(this,arguments)}Ce(kn,Dt,{handler:function(Q){var ce=Ao[Q.type];ce&Li&&Q.button===0&&(this.pressed=!0),ce&rr&&Q.which!==1&&(ce=yi),this.pressed&&(ce&yi&&(this.pressed=!1),this.callback(this.manager,ce,{pointers:[Q],changedPointers:[Q],pointerType:$i,srcEvent:Q}))}});var $s={pointerdown:Li,pointermove:rr,pointerup:yi,pointercancel:Wi,pointerout:Wi},Mo={2:hn,3:Ci,4:$i,5:fn},Ws="pointerdown",Po="pointermove pointerup pointercancel";e.MSPointerEvent&&!e.PointerEvent&&(Ws="MSPointerDown",Po="MSPointerMove MSPointerUp MSPointerCancel");function rn(){this.evEl=Ws,this.evWin=Po,Dt.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}Ce(rn,Dt,{handler:function(Q){var ce=this.store,De=!1,tt=Q.type.toLowerCase().replace("ms",""),dt=$s[tt],Rt=Mo[Q.pointerType]||Q.pointerType,Ui=Rt==hn,Si=gt(ce,Q.pointerId,"pointerId");dt&Li&&(Q.button===0||Ui)?Si<0&&(ce.push(Q),Si=ce.length-1):dt&(yi|Wi)&&(De=!0),!(Si<0)&&(ce[Si]=Q,this.callback(this.manager,dt,{pointers:ce,changedPointers:[Q],pointerType:Rt,srcEvent:Q}),De&&ce.splice(Si,1))}});var _n={touchstart:Li,touchmove:rr,touchend:yi,touchcancel:Wi},ys="touchstart",Io="touchstart touchmove touchend touchcancel";function nr(){this.evTarget=ys,this.evWin=Io,this.started=!1,Dt.apply(this,arguments)}Ce(nr,Dt,{handler:function(Q){var ce=_n[Q.type];if(ce===Li&&(this.started=!0),!!this.started){var De=qs.call(this,Q,ce);ce&(yi|Wi)&&De[0].length-De[1].length===0&&(this.started=!1),this.callback(this.manager,ce,{pointers:De[0],changedPointers:De[1],pointerType:hn,srcEvent:Q})}}});function qs($,Q){var ce=Ht($.touches),De=Ht($.changedTouches);return Q&(yi|Wi)&&(ce=Xt(ce.concat(De),"identifier")),[ce,De]}var ie={touchstart:Li,touchmove:rr,touchend:yi,touchcancel:Wi},B="touchstart touchmove touchend touchcancel";function V(){this.evTarget=B,this.targetIds={},Dt.apply(this,arguments)}Ce(V,Dt,{handler:function(Q){var ce=ie[Q.type],De=te.call(this,Q,ce);De&&this.callback(this.manager,ce,{pointers:De[0],changedPointers:De[1],pointerType:hn,srcEvent:Q})}});function te($,Q){var ce=Ht($.touches),De=this.targetIds;if(Q&(Li|rr)&&ce.length===1)return De[ce[0].identifier]=!0,[ce,ce];var tt,dt,Rt=Ht($.changedTouches),Ui=[],Si=this.target;if(dt=ce.filter(function(Kt){return bt(Kt.target,Si)}),Q===Li)for(tt=0;tt<dt.length;)De[dt[tt].identifier]=!0,tt++;for(tt=0;tt<Rt.length;)De[Rt[tt].identifier]&&Ui.push(Rt[tt]),Q&(yi|Wi)&&delete De[Rt[tt].identifier],tt++;if(Ui.length)return[Xt(dt.concat(Ui),"identifier"),Ui]}var ae=2500,ye=25;function Se(){Dt.apply(this,arguments);var $=ke(this.handler,this);this.touch=new V(this.manager,$),this.mouse=new kn(this.manager,$),this.primaryTouch=null,this.lastTouches=[]}Ce(Se,Dt,{handler:function(Q,ce,De){var tt=De.pointerType==hn,dt=De.pointerType==$i;if(!(dt&&De.sourceCapabilities&&De.sourceCapabilities.firesTouchEvents)){if(tt)Te.call(this,ce,De);else if(dt&&Me.call(this,De))return;this.callback(Q,ce,De)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function Te($,Q){$&Li?(this.primaryTouch=Q.changedPointers[0].identifier,be.call(this,Q)):$&(yi|Wi)&&be.call(this,Q)}function be($){var Q=$.changedPointers[0];if(Q.identifier===this.primaryTouch){var ce={x:Q.clientX,y:Q.clientY};this.lastTouches.push(ce);var De=this.lastTouches,tt=function(){var dt=De.indexOf(ce);dt>-1&&De.splice(dt,1)};setTimeout(tt,ae)}}function Me($){for(var Q=$.srcEvent.clientX,ce=$.srcEvent.clientY,De=0;De<this.lastTouches.length;De++){var tt=this.lastTouches[De],dt=Math.abs(Q-tt.x),Rt=Math.abs(ce-tt.y);if(dt<=ye&&Rt<=ye)return!0}return!1}var Xe=jt(y.style,"touchAction"),lt=Xe!==u,Ke="compute",Tt="auto",Et="manipulation",_t="none",Pt="pan-x",Bt="pan-y",Jt=St();function ri($,Q){this.manager=$,this.set(Q)}ri.prototype={set:function($){$==Ke&&($=this.compute()),lt&&this.manager.element.style&&Jt[$]&&(this.manager.element.style[Xe]=$),this.actions=$.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var $=[];return W(this.manager.recognizers,function(Q){$e(Q.options.enable,[Q])&&($=$.concat(Q.getTouchAction()))}),ni($.join(" "))},preventDefaults:function($){var Q=$.srcEvent,ce=$.offsetDirection;if(this.manager.session.prevented){Q.preventDefault();return}var De=this.actions,tt=mt(De,_t)&&!Jt[_t],dt=mt(De,Bt)&&!Jt[Bt],Rt=mt(De,Pt)&&!Jt[Pt];if(tt){var Ui=$.pointers.length===1,Si=$.distance<2,Kt=$.deltaTime<250;if(Ui&&Si&&Kt)return}if(!(Rt&&dt)&&(tt||dt&&ce&qi||Rt&&ce&Tr))return this.preventSrc(Q)},preventSrc:function($){this.manager.session.prevented=!0,$.preventDefault()}};function ni($){if(mt($,_t))return _t;var Q=mt($,Pt),ce=mt($,Bt);return Q&&ce?_t:Q||ce?Q?Pt:Bt:mt($,Et)?Et:Tt}function St(){if(!lt)return!1;var $={},Q=e.CSS&&e.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(ce){$[ce]=Q?e.CSS.supports("touch-action",ce):!0}),$}var Fe=1,Ei=2,ci=4,sr=8,Br=sr,or=16,Ar=32;function yn($){this.options=me({},this.defaults,$||{}),this.id=$n(),this.manager=null,this.options.enable=Ve(this.options.enable,!0),this.state=Fe,this.simultaneous={},this.requireFail=[]}yn.prototype={defaults:{},set:function($){return me(this.options,$),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function($){if(F($,"recognizeWith",this))return this;var Q=this.simultaneous;return $=Nt($,this),Q[$.id]||(Q[$.id]=$,$.recognizeWith(this)),this},dropRecognizeWith:function($){return F($,"dropRecognizeWith",this)?this:($=Nt($,this),delete this.simultaneous[$.id],this)},requireFailure:function($){if(F($,"requireFailure",this))return this;var Q=this.requireFail;return $=Nt($,this),gt(Q,$)===-1&&(Q.push($),$.requireFailure(this)),this},dropRequireFailure:function($){if(F($,"dropRequireFailure",this))return this;$=Nt($,this);var Q=gt(this.requireFail,$);return Q>-1&&this.requireFail.splice(Q,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function($){return!!this.simultaneous[$.id]},emit:function($){var Q=this,ce=this.state;function De(tt){Q.manager.emit(tt,$)}ce<sr&&De(Q.options.event+Xn(ce)),De(Q.options.event),$.additionalEvent&&De($.additionalEvent),ce>=sr&&De(Q.options.event+Xn(ce))},tryEmit:function($){if(this.canEmit())return this.emit($);this.state=Ar},canEmit:function(){for(var $=0;$<this.requireFail.length;){if(!(this.requireFail[$].state&(Ar|Fe)))return!1;$++}return!0},recognize:function($){var Q=me({},$);if(!$e(this.options.enable,[this,Q])){this.reset(),this.state=Ar;return}this.state&(Br|or|Ar)&&(this.state=Fe),this.state=this.process(Q),this.state&(Ei|ci|sr|or)&&this.tryEmit(Q)},process:function($){},getTouchAction:function(){},reset:function(){}};function Xn($){return $&or?"cancel":$&sr?"end":$&ci?"move":$&Ei?"start":""}function ct($){return $==$t?"down":$==Wr?"up":$==Cn?"left":$==$r?"right":""}function Nt($,Q){var ce=Q.manager;return ce?ce.get($):$}function Lt(){yn.apply(this,arguments)}Ce(Lt,yn,{defaults:{pointers:1},attrTest:function($){var Q=this.options.pointers;return Q===0||$.pointers.length===Q},process:function($){var Q=this.state,ce=$.eventType,De=Q&(Ei|ci),tt=this.attrTest($);return De&&(ce&Wi||!tt)?Q|or:De||tt?ce&yi?Q|sr:Q&Ei?Q|ci:Ei:Ar}});function pr(){Lt.apply(this,arguments),this.pX=null,this.pY=null}Ce(pr,Lt,{defaults:{event:"pan",threshold:10,pointers:1,direction:qr},getTouchAction:function(){var $=this.options.direction,Q=[];return $&qi&&Q.push(Bt),$&Tr&&Q.push(Pt),Q},directionTest:function($){var Q=this.options,ce=!0,De=$.distance,tt=$.direction,dt=$.deltaX,Rt=$.deltaY;return tt&Q.direction||(Q.direction&qi?(tt=dt===0?zr:dt<0?Cn:$r,ce=dt!=this.pX,De=Math.abs($.deltaX)):(tt=Rt===0?zr:Rt<0?Wr:$t,ce=Rt!=this.pY,De=Math.abs($.deltaY))),$.direction=tt,ce&&De>Q.threshold&&tt&Q.direction},attrTest:function($){return Lt.prototype.attrTest.call(this,$)&&(this.state&Ei||!(this.state&Ei)&&this.directionTest($))},emit:function($){this.pX=$.deltaX,this.pY=$.deltaY;var Q=ct($.direction);Q&&($.additionalEvent=this.options.event+Q),this._super.emit.call(this,$)}});function Mr(){Lt.apply(this,arguments)}Ce(Mr,Lt,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[_t]},attrTest:function($){return this._super.attrTest.call(this,$)&&(Math.abs($.scale-1)>this.options.threshold||this.state&Ei)},emit:function($){if($.scale!==1){var Q=$.scale<1?"in":"out";$.additionalEvent=this.options.event+Q}this._super.emit.call(this,$)}});function zt(){yn.apply(this,arguments),this._timer=null,this._input=null}Ce(zt,yn,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Tt]},process:function($){var Q=this.options,ce=$.pointers.length===Q.pointers,De=$.distance<Q.threshold,tt=$.deltaTime>Q.time;if(this._input=$,!De||!ce||$.eventType&(yi|Wi)&&!tt)this.reset();else if($.eventType&Li)this.reset(),this._timer=N(function(){this.state=Br,this.tryEmit()},Q.time,this);else if($.eventType&yi)return Br;return Ar},reset:function(){clearTimeout(this._timer)},emit:function($){this.state===Br&&($&&$.eventType&yi?this.manager.emit(this.options.event+"up",$):(this._input.timeStamp=D(),this.manager.emit(this.options.event,this._input)))}});function Hn(){Lt.apply(this,arguments)}Ce(Hn,Lt,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[_t]},attrTest:function($){return this._super.attrTest.call(this,$)&&(Math.abs($.rotation)>this.options.threshold||this.state&Ei)}});function Yn(){Lt.apply(this,arguments)}Ce(Yn,Lt,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:qi|Tr,pointers:1},getTouchAction:function(){return pr.prototype.getTouchAction.call(this)},attrTest:function($){var Q=this.options.direction,ce;return Q&(qi|Tr)?ce=$.overallVelocity:Q&qi?ce=$.overallVelocityX:Q&Tr&&(ce=$.overallVelocityY),this._super.attrTest.call(this,$)&&Q&$.offsetDirection&&$.distance>this.options.threshold&&$.maxPointers==this.options.pointers&&P(ce)>this.options.velocity&&$.eventType&yi},emit:function($){var Q=ct($.offsetDirection);Q&&this.manager.emit(this.options.event+Q,$),this.manager.emit(this.options.event,$)}});function Rn(){yn.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}Ce(Rn,yn,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Et]},process:function($){var Q=this.options,ce=$.pointers.length===Q.pointers,De=$.distance<Q.threshold,tt=$.deltaTime<Q.time;if(this.reset(),$.eventType&Li&&this.count===0)return this.failTimeout();if(De&&tt&&ce){if($.eventType!=yi)return this.failTimeout();var dt=this.pTime?$.timeStamp-this.pTime<Q.interval:!0,Rt=!this.pCenter||tn(this.pCenter,$.center)<Q.posThreshold;this.pTime=$.timeStamp,this.pCenter=$.center,!Rt||!dt?this.count=1:this.count+=1,this._input=$;var Ui=this.count%Q.taps;if(Ui===0)return this.hasRequireFailures()?(this._timer=N(function(){this.state=Br,this.tryEmit()},Q.interval,this),Ei):Br}return Ar},failTimeout:function(){return this._timer=N(function(){this.state=Ar},this.options.interval,this),Ar},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==Br&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function Ni($,Q){return Q=Q||{},Q.recognizers=Ve(Q.recognizers,Ni.defaults.preset),new On($,Q)}Ni.VERSION="2.0.7",Ni.defaults={domEvents:!1,touchAction:Ke,enable:!0,inputTarget:null,inputClass:null,preset:[[Hn,{enable:!1}],[Mr,{enable:!1},["rotate"]],[Yn,{direction:qi}],[pr,{direction:qi},["swipe"]],[Rn],[Rn,{event:"doubletap",taps:2},["tap"]],[zt]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var vi=1,_a=2;function On($,Q){this.options=me({},Ni.defaults,Q||{}),this.options.inputTarget=this.options.inputTarget||$,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=$,this.input=Ln(this),this.touchAction=new ri(this,this.options.touchAction),Xs(this,!0),W(this.options.recognizers,function(ce){var De=this.add(new ce[0](ce[1]));ce[2]&&De.recognizeWith(ce[2]),ce[3]&&De.requireFailure(ce[3])},this)}On.prototype={set:function($){return me(this.options,$),$.touchAction&&this.touchAction.update(),$.inputTarget&&(this.input.destroy(),this.input.target=$.inputTarget,this.input.init()),this},stop:function($){this.session.stopped=$?_a:vi},recognize:function($){var Q=this.session;if(!Q.stopped){this.touchAction.preventDefaults($);var ce,De=this.recognizers,tt=Q.curRecognizer;(!tt||tt&&tt.state&Br)&&(tt=Q.curRecognizer=null);for(var dt=0;dt<De.length;)ce=De[dt],Q.stopped!==_a&&(!tt||ce==tt||ce.canRecognizeWith(tt))?ce.recognize($):ce.reset(),!tt&&ce.state&(Ei|ci|sr)&&(tt=Q.curRecognizer=ce),dt++}},get:function($){if($ instanceof yn)return $;for(var Q=this.recognizers,ce=0;ce<Q.length;ce++)if(Q[ce].options.event==$)return Q[ce];return null},add:function($){if(F($,"add",this))return this;var Q=this.get($.options.event);return Q&&this.remove(Q),this.recognizers.push($),$.manager=this,this.touchAction.update(),$},remove:function($){if(F($,"remove",this))return this;if($=this.get($),$){var Q=this.recognizers,ce=gt(Q,$);ce!==-1&&(Q.splice(ce,1),this.touchAction.update())}return this},on:function($,Q){if($!==u&&Q!==u){var ce=this.handlers;return W(Mt($),function(De){ce[De]=ce[De]||[],ce[De].push(Q)}),this}},off:function($,Q){if($!==u){var ce=this.handlers;return W(Mt($),function(De){Q?ce[De]&&ce[De].splice(gt(ce[De],Q),1):delete ce[De]}),this}},emit:function($,Q){this.options.domEvents&&Dn($,Q);var ce=this.handlers[$]&&this.handlers[$].slice();if(!(!ce||!ce.length)){Q.type=$,Q.preventDefault=function(){Q.srcEvent.preventDefault()};for(var De=0;De<ce.length;)ce[De](Q),De++}},destroy:function(){this.element&&Xs(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function Xs($,Q){var ce=$.element;if(ce.style){var De;W($.options.cssProps,function(tt,dt){De=jt(ce.style,dt),Q?($.oldCssProps[De]=ce.style[De],ce.style[De]=tt):ce.style[De]=$.oldCssProps[De]||""}),Q||($.oldCssProps={})}}function Dn($,Q){var ce=i.createEvent("Event");ce.initEvent($,!0,!0),ce.gesture=Q,Q.target.dispatchEvent(ce)}me(Ni,{INPUT_START:Li,INPUT_MOVE:rr,INPUT_END:yi,INPUT_CANCEL:Wi,STATE_POSSIBLE:Fe,STATE_BEGAN:Ei,STATE_CHANGED:ci,STATE_ENDED:sr,STATE_RECOGNIZED:Br,STATE_CANCELLED:or,STATE_FAILED:Ar,DIRECTION_NONE:zr,DIRECTION_LEFT:Cn,DIRECTION_RIGHT:$r,DIRECTION_UP:Wr,DIRECTION_DOWN:$t,DIRECTION_HORIZONTAL:qi,DIRECTION_VERTICAL:Tr,DIRECTION_ALL:qr,Manager:On,Input:Dt,TouchAction:ri,TouchInput:V,MouseInput:kn,PointerEventInput:rn,TouchMouseInput:Se,SingleTouchInput:nr,Recognizer:yn,AttrRecognizer:Lt,Tap:Rn,Pan:pr,Swipe:Yn,Pinch:Mr,Rotate:Hn,Press:zt,on:Re,off:ot,each:W,merge:Ee,extend:fe,assign:me,inherit:Ce,bindFn:ke,prefixed:jt});var ya=typeof e<"u"?e:typeof self<"u"?self:{};ya.Hammer=Ni,r.exports?r.exports=Ni:e[l]=Ni})(window,document,"Hammer")})(kw);var Gh=kw.exports;const EO=i_(Gh),Os=RS({__proto__:null,default:EO},[Gh]),Rw=1,Ow=2,Zg=4,SO={mousedown:Rw,mousemove:Ow,mouseup:Zg};function AO(r,e){for(let i=0;i<r.length;i++)if(e(r[i]))return!0;return!1}function MO(r){const e=r.prototype.handler;r.prototype.handler=function(l){const u=this.store;l.button>0&&l.type==="pointerdown"&&(AO(u,m=>m.pointerId===l.pointerId)||u.push(l)),e.call(this,l)}}function PO(r){r.prototype.handler=function(i){let l=SO[i.type];l&Rw&&i.button>=0&&(this.pressed=!0),l&Ow&&i.which===0&&(l=Zg),this.pressed&&(l&Zg&&(this.pressed=!1),this.callback(this.manager,l,{pointers:[i],changedPointers:[i],pointerType:"mouse",srcEvent:i}))}}MO(Gh.PointerEventInput);PO(Gh.MouseInput);const IO=Gh.Manager;class dp{constructor(e,i,l){this.element=e,this.callback=i,this.options={enable:!0,...l}}}const CO=Os?[[Os.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[Os.Rotate,{enable:!1}],[Os.Pinch,{enable:!1}],[Os.Swipe,{enable:!1}],[Os.Pan,{threshold:0,enable:!1}],[Os.Press,{enable:!1}],[Os.Tap,{event:"doubletap",taps:2,enable:!1}],[Os.Tap,{event:"anytap",enable:!1}],[Os.Tap,{enable:!1}]]:null,Zx={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},LO={doubletap:["tap"]},kO={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},E_={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},RO={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},$x={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},OO=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",bc=typeof window<"u"?window:global;let $g=!1;try{const r={get passive(){return $g=!0,!0}};bc.addEventListener("test",null,r),bc.removeEventListener("test",null)}catch{$g=!1}const DO=OO.indexOf("firefox")!==-1,{WHEEL_EVENTS:zO}=E_,Wx="wheel",qx=4.000244140625,BO=40,FO=.25;class NO extends dp{constructor(e,i,l){super(e,i,l),this.handleEvent=u=>{if(!this.options.enable)return;let m=u.deltaY;bc.WheelEvent&&(DO&&u.deltaMode===bc.WheelEvent.DOM_DELTA_PIXEL&&(m/=bc.devicePixelRatio),u.deltaMode===bc.WheelEvent.DOM_DELTA_LINE&&(m*=BO)),m!==0&&m%qx===0&&(m=Math.floor(m/qx)),u.shiftKey&&m&&(m=m*FO),this.callback({type:Wx,center:{x:u.clientX,y:u.clientY},delta:-m,srcEvent:u,pointerType:"mouse",target:u.target})},this.events=(this.options.events||[]).concat(zO),this.events.forEach(u=>e.addEventListener(u,this.handleEvent,$g?{passive:!1}:!1))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,i){e===Wx&&(this.options.enable=i)}}const{MOUSE_EVENTS:UO}=E_,Xx="pointermove",Hx="pointerover",Yx="pointerout",Kx="pointerenter",Jx="pointerleave";class jO extends dp{constructor(e,i,l){super(e,i,l),this.handleEvent=m=>{this.handleOverEvent(m),this.handleOutEvent(m),this.handleEnterEvent(m),this.handleLeaveEvent(m),this.handleMoveEvent(m)},this.pressed=!1;const{enable:u}=this.options;this.enableMoveEvent=u,this.enableLeaveEvent=u,this.enableEnterEvent=u,this.enableOutEvent=u,this.enableOverEvent=u,this.events=(this.options.events||[]).concat(UO),this.events.forEach(m=>e.addEventListener(m,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,i){e===Xx&&(this.enableMoveEvent=i),e===Hx&&(this.enableOverEvent=i),e===Yx&&(this.enableOutEvent=i),e===Kx&&(this.enableEnterEvent=i),e===Jx&&(this.enableLeaveEvent=i)}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit(Hx,e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit(Yx,e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit(Kx,e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit(Jx,e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.which===0&&(this.pressed=!1),this.pressed||this._emit(Xx,e);break;case"mouseup":this.pressed=!1;break}}_emit(e,i){this.callback({type:e,center:{x:i.clientX,y:i.clientY},srcEvent:i,pointerType:"mouse",target:i.target})}}const{KEY_EVENTS:VO}=E_,Qx="keydown",eb="keyup";class GO extends dp{constructor(e,i,l){super(e,i,l),this.handleEvent=u=>{const m=u.target||u.srcElement;m.tagName==="INPUT"&&m.type==="text"||m.tagName==="TEXTAREA"||(this.enableDownEvent&&u.type==="keydown"&&this.callback({type:Qx,srcEvent:u,key:u.key,target:u.target}),this.enableUpEvent&&u.type==="keyup"&&this.callback({type:eb,srcEvent:u,key:u.key,target:u.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=(this.options.events||[]).concat(VO),e.tabIndex=this.options.tabIndex||0,e.style.outline="none",this.events.forEach(u=>e.addEventListener(u,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,i){e===Qx&&(this.enableDownEvent=i),e===eb&&(this.enableUpEvent=i)}}const tb="contextmenu";class ZO extends dp{constructor(e,i,l){super(e,i,l),this.handleEvent=u=>{this.options.enable&&this.callback({type:tb,center:{x:u.clientX,y:u.clientY},srcEvent:u,pointerType:"mouse",target:u.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,i){e===tb&&(this.options.enable=i)}}const Wg=1,Qd=2,qg=4,$O={pointerdown:Wg,pointermove:Qd,pointerup:qg,mousedown:Wg,mousemove:Qd,mouseup:qg},WO=1,qO=2,XO=3,HO=0,YO=1,KO=2,JO=1,QO=2,eD=4;function tD(r){const e=$O[r.srcEvent.type];if(!e)return null;const{buttons:i,button:l,which:u}=r.srcEvent;let m=!1,y=!1,T=!1;return e===qg||e===Qd&&!Number.isFinite(i)?(m=u===WO,y=u===qO,T=u===XO):e===Qd?(m=!!(i&JO),y=!!(i&eD),T=!!(i&QO)):e===Wg&&(m=l===HO,y=l===YO,T=l===KO),{leftButton:m,middleButton:y,rightButton:T}}function iD(r,e){const i=r.center;if(!i)return null;const l=e.getBoundingClientRect(),u=l.width/e.offsetWidth||1,m=l.height/e.offsetHeight||1,y={x:(i.x-l.left-e.clientLeft)/u,y:(i.y-l.top-e.clientTop)/m};return{center:i,offsetCenter:y}}const fg={srcElement:"root",priority:0};class rD{constructor(e){this.handleEvent=i=>{if(this.isEmpty())return;const l=this._normalizeEvent(i);let u=i.srcEvent.target;for(;u&&u!==l.rootElement;){if(this._emit(l,u),l.handled)return;u=u.parentNode}this._emit(l,"root")},this.eventManager=e,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,i,l,u=!1,m=!1){const{handlers:y,handlersByElement:T}=this;let a=fg;typeof l=="string"||l&&l.addEventListener?a={...fg,srcElement:l}:l&&(a={...fg,...l});let P=T.get(a.srcElement);P||(P=[],T.set(a.srcElement,P));const D={type:e,handler:i,srcElement:a.srcElement,priority:a.priority};u&&(D.once=!0),m&&(D.passive=!0),y.push(D),this._active=this._active||!D.passive;let N=P.length-1;for(;N>=0&&!(P[N].priority>=D.priority);)N--;P.splice(N+1,0,D)}remove(e,i){const{handlers:l,handlersByElement:u}=this;for(let m=l.length-1;m>=0;m--){const y=l[m];if(y.type===e&&y.handler===i){l.splice(m,1);const T=u.get(y.srcElement);T.splice(T.indexOf(y),1),T.length===0&&u.delete(y.srcElement)}}this._active=l.some(m=>!m.passive)}_emit(e,i){const l=this.handlersByElement.get(i);if(l){let u=!1;const m=()=>{e.handled=!0},y=()=>{e.handled=!0,u=!0},T=[];for(let a=0;a<l.length;a++){const{type:P,handler:D,once:N}=l[a];if(D({...e,type:P,stopPropagation:m,stopImmediatePropagation:y}),N&&T.push(l[a]),u)break}for(let a=0;a<T.length;a++){const{type:P,handler:D}=T[a];this.remove(P,D)}}}_normalizeEvent(e){const i=this.eventManager.getElement();return{...e,...tD(e),...iD(e,i),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:i}}}const nD={events:null,recognizers:null,recognizerOptions:{},Manager:IO,touchAction:"none",tabIndex:0};class Dw{constructor(e=null,i){this._onBasicInput=u=>{const{srcEvent:m}=u,y=kO[m.type];y&&this.manager.emit(y,u)},this._onOtherEvent=u=>{this.manager.emit(u.type,u)},this.options={...nD,...i},this.events=new Map,this.setElement(e);const{events:l}=this.options;l&&this.on(l)}getElement(){return this.element}setElement(e){if(this.element&&this.destroy(),this.element=e,!e)return;const{options:i}=this,l=i.Manager;this.manager=new l(e,{touchAction:i.touchAction,recognizers:i.recognizers||CO}).on("hammer.input",this._onBasicInput),i.recognizers||Object.keys(Zx).forEach(u=>{const m=this.manager.get(u);m&&Zx[u].forEach(y=>{m.recognizeWith(y)})});for(const u in i.recognizerOptions){const m=this.manager.get(u);if(m){const y=i.recognizerOptions[u];delete y.enable,m.set(y)}}this.wheelInput=new NO(e,this._onOtherEvent,{enable:!1}),this.moveInput=new jO(e,this._onOtherEvent,{enable:!1}),this.keyInput=new GO(e,this._onOtherEvent,{enable:!1,tabIndex:i.tabIndex}),this.contextmenuInput=new ZO(e,this._onOtherEvent,{enable:!1});for(const[u,m]of this.events)m.isEmpty()||(this._toggleRecognizer(m.recognizerName,!0),this.manager.on(u,m.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(e,i,l){this._addEventHandler(e,i,l,!1)}once(e,i,l){this._addEventHandler(e,i,l,!0)}watch(e,i,l){this._addEventHandler(e,i,l,!1,!0)}off(e,i){this._removeEventHandler(e,i)}_toggleRecognizer(e,i){const{manager:l}=this;if(!l)return;const u=l.get(e);if(u&&u.options.enable!==i){u.set({enable:i});const m=LO[e];m&&!this.options.recognizers&&m.forEach(y=>{const T=l.get(y);i?(T.requireFailure(e),u.dropRequireFailure(y)):T.dropRequireFailure(e)})}this.wheelInput.enableEventType(e,i),this.moveInput.enableEventType(e,i),this.keyInput.enableEventType(e,i),this.contextmenuInput.enableEventType(e,i)}_addEventHandler(e,i,l,u,m){if(typeof e!="string"){l=i;for(const D in e)this._addEventHandler(D,e[D],l,u,m);return}const{manager:y,events:T}=this,a=$x[e]||e;let P=T.get(a);P||(P=new rD(this),T.set(a,P),P.recognizerName=RO[a]||a,y&&y.on(a,P.handleEvent)),P.add(e,i,l,u,m),P.isEmpty()||this._toggleRecognizer(P.recognizerName,!0)}_removeEventHandler(e,i){if(typeof e!="string"){for(const y in e)this._removeEventHandler(y,e[y]);return}const{events:l}=this,u=$x[e]||e,m=l.get(u);if(m&&(m.remove(e,i),m.isEmpty())){const{recognizerName:y}=m;let T=!1;for(const a of l.values())if(a.recognizerName===y&&!a.isEmpty()){T=!0;break}T||this._toggleRecognizer(y,!1)}}}function rl(){}const sD=({isDragging:r})=>r?"grabbing":"grab",zw={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,glOptions:{},parameters:{},parent:null,gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,onWebGLInitialized:rl,onResize:rl,onViewStateChange:rl,onInteractionStateChange:rl,onBeforeRender:rl,onAfterRender:rl,onLoad:rl,onError:r=>Ii.error(r.message)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:sD,getTooltip:null,debug:!1,drawPickingColors:!1};class pp{constructor(e){j(this,"props",void 0),j(this,"width",0),j(this,"height",0),j(this,"userData",{}),j(this,"canvas",null),j(this,"viewManager",null),j(this,"layerManager",null),j(this,"effectManager",null),j(this,"deckRenderer",null),j(this,"deckPicker",null),j(this,"eventManager",null),j(this,"tooltip",null),j(this,"metrics",void 0),j(this,"animationLoop",void 0),j(this,"stats",void 0),j(this,"viewState",void 0),j(this,"cursorState",void 0),j(this,"_needsRedraw",void 0),j(this,"_pickRequest",void 0),j(this,"_lastPointerDownInfo",null),j(this,"_metricsCounter",void 0),j(this,"_onPointerMove",i=>{const{_pickRequest:l}=this;if(i.type==="pointerleave")l.x=-1,l.y=-1,l.radius=0;else{if(i.leftButton||i.rightButton)return;{const u=i.offsetCenter;if(!u)return;l.x=u.x,l.y=u.y,l.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:l.x,y:l.y}),l.event=i}),j(this,"_onEvent",i=>{const l=Cx[i.type],u=i.offsetCenter;if(!l||!u||!this.layerManager)return;const m=this.layerManager.getLayers(),y=this.deckPicker.getLastPickedObject({x:u.x,y:u.y,layers:m,viewports:this.getViewports(u)},this._lastPointerDownInfo),{layer:T}=y,a=T&&(T[l.handler]||T.props[l.handler]),P=this.props[l.handler];let D=!1;a&&(D=a.call(T,y,i)),!D&&P&&P(y,i)}),j(this,"_onPointerDown",i=>{const l=i.offsetCenter,u=this._pick("pickObject","pickObject Time",{x:l.x,y:l.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=u.result[0]||u.emptyInfo}),this.props={...zw,...e},e=this.props,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this.cursorState={isHovering:!1,isDragging:!1},e.viewState&&e.initialViewState&&Ii.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),a1()==="IE"&&Ii.warn("IE 11 is not supported")(),this.viewState=e.initialViewState,e.gl||typeof document<"u"&&(this.canvas=this._createCanvas(e)),this.animationLoop=this._createAnimationLoop(e),this.stats=new r_({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this.setProps(e),e._typedArrayManagerProps&&Ch.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){var e,i,l,u,m,y,T;if(this.animationLoop.stop(),this.animationLoop=null,this._lastPointerDownInfo=null,(e=this.layerManager)===null||e===void 0||e.finalize(),this.layerManager=null,(i=this.viewManager)===null||i===void 0||i.finalize(),this.viewManager=null,(l=this.effectManager)===null||l===void 0||l.finalize(),this.effectManager=null,(u=this.deckRenderer)===null||u===void 0||u.finalize(),this.deckRenderer=null,(m=this.deckPicker)===null||m===void 0||m.finalize(),this.deckPicker=null,(y=this.eventManager)===null||y===void 0||y.destroy(),this.eventManager=null,(T=this.tooltip)===null||T===void 0||T.remove(),this.tooltip=null,!this.props.canvas&&!this.props.gl&&this.canvas){var a;(a=this.canvas.parentElement)===null||a===void 0||a.removeChild(this.canvas),this.canvas=null}}setProps(e){this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&Ii.removed("onLayerHover","onHover")(),"onLayerClick"in e&&Ii.removed("onLayerClick","onClick")(),e.initialViewState&&!Bc(this.props.initialViewState,e.initialViewState)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const i=Object.create(this.props);Object.assign(i,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop.setProps(i),this.layerManager&&(this.viewManager.setProps(i),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(i),this.effectManager.setProps(i),this.deckRenderer.setProps(i),this.deckPicker.setProps(i)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let i=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const l=this.viewManager.needsRedraw(e),u=this.layerManager.needsRedraw(e),m=this.effectManager.needsRedraw(e),y=this.deckRenderer.needsRedraw(e);return i=i||l||u||m||y,i}redraw(e){if(!this.layerManager)return;let i=this.needsRedraw({clearRedrawFlags:!0});i=e||i,i&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(i):this._drawLayers(i))}get isInitialized(){return this.viewManager!==null}getViews(){return kr(this.viewManager),this.viewManager.views}getViewports(e){return kr(this.viewManager),this.viewManager.getViewports(e)}pickObject(e){const i=this._pick("pickObject","pickObject Time",e).result;return i.length?i[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,i=!1){for(const l in e)this.layerManager.resourceManager.add({resourceId:l,data:e[l],forceUpdate:i})}_removeResources(e){for(const i of e)this.layerManager.resourceManager.remove(i)}_pick(e,i,l){kr(this.deckPicker);const{stats:u}=this;u.get("Pick Count").incrementCount(),u.get(i).timeStart();const m=this.deckPicker[e]({layers:this.layerManager.getLayers(l),views:this.viewManager.getViews(),viewports:this.getViewports(l),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...l});return u.get(i).timeEnd(),m}_createCanvas(e){let i=e.canvas;return typeof i=="string"&&(i=document.getElementById(i),kr(i)),i||(i=document.createElement("canvas"),i.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(i)),Object.assign(i.style,e.style),i}_setCanvasSize(e){if(!this.canvas)return;const{width:i,height:l}=e;if(i||i===0){const m=Number.isFinite(i)?"".concat(i,"px"):i;this.canvas.style.width=m}if(l||l===0){var u;const m=Number.isFinite(l)?"".concat(l,"px"):l;this.canvas.style.position=((u=e.style)===null||u===void 0?void 0:u.position)||"absolute",this.canvas.style.height=m}}_updateCanvasSize(){const{canvas:e}=this;if(!e)return;const i=e.clientWidth||e.width,l=e.clientHeight||e.height;if(i!==this.width||l!==this.height){var u;this.width=i,this.height=l,(u=this.viewManager)===null||u===void 0||u.setProps({width:i,height:l}),this.props.onResize({width:i,height:l})}}_createAnimationLoop(e){const{width:i,height:l,gl:u,glOptions:m,debug:y,onError:T,onBeforeRender:a,onAfterRender:P,useDevicePixels:D}=e;return new iL({width:i,height:l,useDevicePixels:D,autoResizeViewport:!1,gl:u,onCreateContext:N=>M1({...m,...N,canvas:this.canvas,debug:y,onContextLost:()=>this._onContextLost()}),onInitialize:N=>this._setGLContext(N.gl),onRender:this._onRenderFrame.bind(this),onBeforeRender:a,onAfterRender:P,onError:T})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){let e=this.props.views||[new Mw({id:"default-view"})];return e=Array.isArray(e)?e:[e],e.length&&this.props.controller&&(e[0].props.controller=this.props.controller),e}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){const{_pickRequest:e}=this;if(e.event){const{result:l,emptyInfo:u}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=l.length>0;let m=u,y=!1;for(const T of l){var i;m=T,y=((i=T.layer)===null||i===void 0?void 0:i.onHover(T,e.event))||y}if(!y&&this.props.onHover&&this.props.onHover(m,e.event),this.props.getTooltip&&this.tooltip){const T=this.props.getTooltip(m);this.tooltip.setTooltip(T,m.x,m.y)}e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setGLContext(e){if(this.layerManager)return;this.canvas||(this.canvas=e.canvas,u_(e,{enable:!0,copyState:!0})),this.tooltip=new TO(this.canvas),wo(e,{blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onWebGLInitialized(e);const i=new nw;i.play(),this.animationLoop.attachTimeline(i),this.eventManager=new Dw(this.props.parent||e.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const u in Cx)this.eventManager.on(u,this._onEvent);this.viewManager=new UR({timeline:i,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const l=this.viewManager.getViewports()[0];this.layerManager=new NR(e,{deck:this,stats:this.stats,viewport:l,timeline:i}),this.effectManager=new uO,this.deckRenderer=new mO(e),this.deckPicker=new bO(e),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,i){const{gl:l}=this.layerManager.context;wo(l,this.props.parameters),this.props.onBeforeRender({gl:l}),this.deckRenderer.renderLayers({target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",redrawReason:e,effects:this.effectManager.getEffects(),...i}),this.props.onAfterRender({gl:l})}_onRenderFrame(e){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),Ii.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.tooltip.isVisible&&this.viewManager.needsRedraw()&&this.tooltip.setTooltip(null),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const i=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:i},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const i=this.animationLoop.stats;e.get("GPU Time").addTime(i.get("GPU Time").lastTiming),e.get("CPU Time").addTime(i.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:i}=this;e.fps=i.get("frameRate").getHz(),e.setPropsTime=i.get("setProps Time").time,e.updateAttributesTime=i.get("Update Attributes").time,e.framesRedrawn=i.get("Redraw Count").count,e.pickTime=i.get("pickObject Time").time+i.get("pickMultipleObjects Time").time+i.get("pickObjects Time").time,e.pickCount=i.get("Pick Count").count,e.gpuTime=i.get("GPU Time").time,e.cpuTime=i.get("CPU Time").time,e.gpuTimePerFrame=i.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=i.get("CPU Time").getAverageTime();const l=ol.get("Memory Usage");e.bufferMemory=l.get("Buffer Memory").count,e.textureMemory=l.get("Texture Memory").count,e.renderbufferMemory=l.get("Renderbuffer Memory").count,e.gpuMemory=l.get("GPU Memory").count}}j(pp,"defaultProps",zw);j(pp,"VERSION",lP.VERSION);class dg{constructor(e,i){j(this,"opts",void 0),j(this,"source",void 0),this.opts=i,this.source=e}get value(){return this.source.value}getValue(){const e=this.source.getBuffer(),i=this.getAccessor();if(e)return[e,i];const{value:l}=this.source,{size:u}=i;let m=l;if(l&&l.length!==u){m=new Float32Array(u);const y=i.elementOffset||0;for(let T=0;T<u;++T)m[T]=l[y+T]}return m}getAccessor(){return{...this.source.getAccessor(),...this.opts}}}function oD(r){switch(r){case 5126:return Float32Array;case 5130:return Float64Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return Uint8ClampedArray;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Unknown GL type")}}function Nd(r){return r.stride||r.size*r.bytesPerElement}function Bw(r,e){e.offset&&Ii.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const i=Nd(r),l=e.vertexOffset!==void 0?e.vertexOffset:r.vertexOffset||0,u=e.elementOffset||0,m=l*i+u*r.bytesPerElement+(r.offset||0);return{...e,offset:m,stride:i}}function aD(r,e){const i=Bw(r,e);return{high:i,low:{...i,offset:i.offset+r.size*4}}}class lD{constructor(e,i,l){j(this,"gl",void 0),j(this,"id",void 0),j(this,"size",void 0),j(this,"settings",void 0),j(this,"value",void 0),j(this,"doublePrecision",void 0),j(this,"_buffer",void 0),j(this,"state",void 0),this.gl=e,this.id=i.id||"",this.size=i.size||1;const u=i.logicalType||i.type,m=u===5130;let{defaultValue:y}=i;y=Number.isFinite(y)?[y]:y||new Array(this.size).fill(0);let T;m?T=5126:!u&&i.isIndexed?T=e&&kI(e,Vi.ELEMENT_INDEX_UINT32)?5125:5123:T=u||5126;let a=oD(u||T||5126);this.doublePrecision=m,m&&i.fp64===!1&&(a=Float32Array),this.value=null,this.settings={...i,defaultType:a,defaultValue:y,logicalType:u,type:T,size:this.size,bytesPerElement:a.BYTES_PER_ELEMENT},this.state={...l,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1},this._buffer=null}get isConstant(){return this.state.constant}get buffer(){if(!this._buffer){const{isIndexed:e,type:i}=this.settings;this._buffer=new Oi(this.gl,{id:this.id,target:e?34963:34962,accessor:{type:i}})}return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*Nd(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),Ch.release(this.state.allocatedValue)}getShaderAttributes(e,i){if(this.doublePrecision){const l={},u=this.value instanceof Float64Array,m=aD(this.getAccessor(),i||{});return l[e]=new dg(this,m.high),l["".concat(e,"64Low")]=u?new dg(this,m.low):new Float32Array(this.size),l}if(i){const l=Bw(this.getAccessor(),i);return{[e]:new dg(this,l)}}return{[e]:this}}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(){return this.state.constant?this.value:[this.getBuffer(),this.getAccessor()]}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const i=Array.from(this.value);e=[i,i]}else{const{value:i,numInstances:l,size:u}=this,m=l*u;if(i&&m&&i.length>=m){const y=new Array(u).fill(1/0),T=new Array(u).fill(-1/0);for(let a=0;a<m;)for(let P=0;P<u;P++){const D=i[a++];D<y[P]&&(y[P]=D),D>T[P]&&(T[P]=D)}e=[y,T]}}return this.state.bounds=e,e}setData(e){const{state:i}=this;let l;ArrayBuffer.isView(e)?l={value:e}:e instanceof Oi?l={buffer:e}:l=e;const u={...this.settings,...l};if(i.bufferAccessor=u,i.bounds=null,l.constant){let m=l.value;if(m=this._normalizeValue(m,[],0),this.settings.normalized&&(m=this.normalizeConstant(m)),!(!i.constant||!this._areValuesEqual(m,this.value)))return!1;i.externalBuffer=null,i.constant=!0,this.value=m}else if(l.buffer){const m=l.buffer;i.externalBuffer=m,i.constant=!1,this.value=l.value||null;const y=l.value instanceof Float64Array;u.type=l.type||m.accessor.type,u.bytesPerElement=m.accessor.BYTES_PER_ELEMENT*(y?2:1),u.stride=Nd(u)}else if(l.value){this._checkExternalBuffer(l);let m=l.value;i.externalBuffer=null,i.constant=!1,this.value=m,u.bytesPerElement=m.BYTES_PER_ELEMENT,u.stride=Nd(u);const{buffer:y,byteOffset:T}=this;this.doublePrecision&&m instanceof Float64Array&&(m=ug(m,u));const a=m.byteLength+T+u.stride*2;y.byteLength<a&&y.reallocate(a),y.setAccessor(null),y.subData({data:m,offset:T}),u.type=l.type||y.accessor.type}return!0}updateSubBuffer(e={}){this.state.bounds=null;const i=this.value,{startOffset:l=0,endOffset:u}=e;this.buffer.subData({data:this.doublePrecision&&i instanceof Float64Array?ug(i,{size:this.size,startIndex:l,endIndex:u}):i.subarray(l,u),offset:l*i.BYTES_PER_ELEMENT+this.byteOffset})}allocate(e,i=!1){const{state:l}=this,u=l.allocatedValue,m=Ch.allocate(u,e+1,{size:this.size,type:this.settings.defaultType,copy:i});this.value=m;const{buffer:y,byteOffset:T}=this;return y.byteLength<m.byteLength+T&&(y.reallocate(m.byteLength+T),i&&u&&y.subData({data:u instanceof Float64Array?ug(u,this):u,offset:T})),l.allocatedValue=m,l.constant=!1,l.externalBuffer=null,l.bufferAccessor=this.settings,!0}_checkExternalBuffer(e){const{value:i}=e;if(!ArrayBuffer.isView(i))throw new Error("Attribute ".concat(this.id," value is not TypedArray"));const l=this.settings.defaultType;let u=!1;if(this.doublePrecision&&(u=i.BYTES_PER_ELEMENT<4),u)throw new Error("Attribute ".concat(this.id," does not support ").concat(i.constructor.name));!(i instanceof l)&&this.settings.normalized&&!("normalized"in e)&&Ii.warn("Attribute ".concat(this.id," is normalized"))()}normalizeConstant(e){switch(this.settings.type){case 5120:return new Float32Array(e).map(i=>(i+128)/255*2-1);case 5122:return new Float32Array(e).map(i=>(i+32768)/65535*2-1);case 5121:return new Float32Array(e).map(i=>i/255);case 5123:return new Float32Array(e).map(i=>i/65535);default:return e}}_normalizeValue(e,i,l){const{defaultValue:u,size:m}=this.settings;if(Number.isFinite(e))return i[l]=e,i;if(!e)return i[l]=u[0],i;switch(m){case 4:i[l+3]=Number.isFinite(e[3])?e[3]:u[3];case 3:i[l+2]=Number.isFinite(e[2])?e[2]:u[2];case 2:i[l+1]=Number.isFinite(e[1])?e[1]:u[1];case 1:i[l+0]=Number.isFinite(e[0])?e[0]:u[0];break;default:let y=m;for(;--y>=0;)i[l+y]=Number.isFinite(e[y])?e[y]:u[y]}return i}_areValuesEqual(e,i){if(!e||!i)return!1;const{size:l}=this;for(let u=0;u<l;u++)if(e[u]!==i[u])return!1;return!0}}const ib=[],rb=[];function cD(r,e=0,i=1/0){let l=ib;const u={index:-1,data:r,target:[]};return r?typeof r[Symbol.iterator]=="function"?l=r:r.length>0&&(rb.length=r.length,l=rb):l=ib,(e>0||Number.isFinite(i))&&(l=(Array.isArray(l)?l:Array.from(l)).slice(e,i),u.index=e-1),{iterable:l,objectInfo:u}}function Fw(r){return r&&r[Symbol.asyncIterator]}function uD(r,e){const{size:i,stride:l,offset:u,startIndices:m,nested:y}=e,T=r.BYTES_PER_ELEMENT,a=l?l/T:i,P=u?u/T:0,D=Math.floor((r.length-P)/a);return(N,{index:F,target:W})=>{if(!m){const Ee=F*a+P;for(let Ce=0;Ce<i;Ce++)W[Ce]=r[Ee+Ce];return W}const oe=m[F],me=m[F+1]||D;let fe;if(y){fe=new Array(me-oe);for(let Ee=oe;Ee<me;Ee++){const Ce=Ee*a+P;W=new Array(i);for(let ke=0;ke<i;ke++)W[ke]=r[Ce+ke];fe[Ee-oe]=W}}else if(a===i)fe=r.subarray(oe*i+P,me*i+P);else{fe=new r.constructor((me-oe)*i);let Ee=0;for(let Ce=oe;Ce<me;Ce++){const ke=Ce*a+P;for(let $e=0;$e<i;$e++)fe[Ee++]=r[ke+$e]}}return fe}}const hD=[],Ud=[[0,1/0]];function fD(r,e){if(r===Ud||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return r;const i=[],l=r.length;let u=0;for(let m=0;m<l;m++){const y=r[m];y[1]<e[0]?(i.push(y),u=m+1):y[0]>e[1]?i.push(y):e=[Math.min(y[0],e[0]),Math.max(y[1],e[1])]}return i.splice(u,0,e),i}function pg(r){const{source:e,target:i,start:l=0,size:u,getData:m}=r,y=r.end||i.length,T=e.length,a=y-l;if(T>a){i.set(e.subarray(0,a),l);return}if(i.set(e,l),!m)return;let P=T;for(;P<a;){const D=m(P,e);for(let N=0;N<u;N++)i[l+P]=D[N]||0,P++}}function dD({source:r,target:e,size:i,getData:l,sourceStartIndices:u,targetStartIndices:m}){if(!Array.isArray(m))return pg({source:r,target:e,size:i,getData:l}),e;let y=0,T=0;const a=l&&((D,N)=>l(D+T,N)),P=Math.min(u.length,m.length);for(let D=1;D<P;D++){const N=u[D]*i,F=m[D]*i;pg({source:r.subarray(y,N),target:e,start:T,end:F,size:i,getData:a}),y=N,T=F}return T<e.length&&pg({source:[],target:e,start:T,size:i,getData:a}),e}const pD={interpolation:{duration:0,easing:r=>r},spring:{stiffness:.05,damping:.5}};function Nw(r,e){if(!r)return null;Number.isFinite(r)&&(r={type:"interpolation",duration:r});const i=r.type||"interpolation";return{...pD[i],...e,...r,type:i}}function Uw(r,e){const i=e.getBuffer();return i?[i,{divisor:0,size:e.size,normalized:e.settings.normalized}]:e.value}function jw(r){switch(r){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error('No defined attribute type for size "'.concat(r,'"'))}}function Vw(r){r.push(r.shift())}function S_(r,e){const{doublePrecision:i,settings:l,value:u,size:m}=r,y=i&&u instanceof Float64Array?2:1;return(l.noAlloc?u.length:e*m)*y}function Gw({buffer:r,numInstances:e,attribute:i,fromLength:l,fromStartIndices:u,getData:m=y=>y}){const y=i.doublePrecision&&i.value instanceof Float64Array?2:1,T=i.size*y,a=i.byteOffset,P=i.startIndices,D=u&&P,N=S_(i,e),F=i.isConstant;if(!D&&l>=N)return;const W=F?i.value:i.getBuffer().getData({srcByteOffset:a});if(i.settings.normalized&&!F){const Ee=m;m=(Ce,ke)=>i.normalizeConstant(Ee(Ce,ke))}const oe=F?(Ee,Ce)=>m(W,Ce):(Ee,Ce)=>m(W.subarray(Ee,Ee+T),Ce),me=r.getData({length:l}),fe=new Float32Array(N);dD({source:me,target:fe,sourceStartIndices:u,targetStartIndices:P,size:T,getData:oe}),r.byteLength<fe.byteLength+a&&r.reallocate(fe.byteLength+a),r.subData({data:fe,offset:a})}class A_ extends lD{constructor(e,i){super(e,i,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,updateRanges:Ud}),j(this,"constant",!1),this.settings.update=i.update||(i.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const i=this.state.needsRedraw;return this.state.needsRedraw=i&&!e,i}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:i}=this.settings,l=this.settings.transition,u=Array.isArray(i)?e[i.find(m=>e[m])]:e[i];return Nw(u,l)}setNeedsUpdate(e=this.id,i){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),i){const{startRow:l=0,endRow:u=1/0}=i;this.state.updateRanges=fD(this.state.updateRanges,[l,u])}else this.state.updateRanges=Ud}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=hD}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:i,settings:l}=this;return l.noAlloc?!1:l.update?(super.allocate(e,i.updateRanges!==Ud),!0):!1}updateBuffer({numInstances:e,data:i,props:l,context:u}){if(!this.needsUpdate())return!1;const{state:{updateRanges:m},settings:{update:y,noAlloc:T}}=this;let a=!0;if(y){for(const[P,D]of m)y.call(u,this,{data:i,startRow:P,endRow:D,props:l,numInstances:e});if(this.value)if(this.constant||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[P,D]of m){const N=Number.isFinite(P)?this.getVertexOffset(P):0,F=Number.isFinite(D)?this.getVertexOffset(D):T||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:N,endOffset:F})}this._checkAttributeArray()}else a=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),a}setConstantValue(e){return e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:i}=this;return e?(this.clearNeedsUpdate(),i.lastExternalBuffer===e||(i.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(i.lastExternalBuffer=null,!1)}setBinaryValue(e,i=null){const{state:l,settings:u}=this;if(!e)return l.binaryValue=null,l.binaryAccessor=null,!1;if(u.noAlloc)return!1;if(l.binaryValue===e)return this.clearNeedsUpdate(),!0;if(l.binaryValue=e,this.setNeedsRedraw(),u.transform||i!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const y=e;kr(ArrayBuffer.isView(y.value),"invalid ".concat(u.accessor));const T=!!y.size&&y.size!==this.size;return l.binaryAccessor=uD(y.value,{size:y.size||this.size,stride:y.stride,offset:y.offset,startIndices:i,nested:T}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:i}=this;return(i?e<i.length?i[e]:this.numInstances:e)*this.size}getShaderAttributes(){const e=this.settings.shaderAttributes||{[this.id]:null},i={};for(const l in e)Object.assign(i,super.getShaderAttributes(l,e[l]));return i}_autoUpdater(e,{data:i,startRow:l,endRow:u,props:m,numInstances:y}){if(e.constant)return;const{settings:T,state:a,value:P,size:D,startIndices:N}=e,{accessor:F,transform:W}=T,oe=a.binaryAccessor||(typeof F=="function"?F:m[F]);kr(typeof oe=="function",'accessor "'.concat(F,'" is not a function'));let me=e.getVertexOffset(l);const{iterable:fe,objectInfo:Ee}=cD(i,l,u);for(const Ce of fe){Ee.index++;let ke=oe(Ce,Ee);if(W&&(ke=W.call(this,ke)),N){const $e=(Ee.index<N.length-1?N[Ee.index+1]:y)-N[Ee.index];if(ke&&Array.isArray(ke[0])){let Ve=me;for(const Re of ke)e._normalizeValue(Re,P,Ve),Ve+=D}else ke&&ke.length>D?P.set(ke,me):(e._normalizeValue(ke,Ee.target,0),OR({target:P,source:Ee.target,start:me,count:$e}));me+=$e*D}else e._normalizeValue(ke,P,me),me+=D}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error("Attribute ".concat(this.id," missing update or accessor"))}_checkAttributeArray(){const{value:e}=this,i=Math.min(4,this.size);if(e&&e.length>=i){let l=!0;switch(i){case 4:l=l&&Number.isFinite(e[3]);case 3:l=l&&Number.isFinite(e[2]);case 2:l=l&&Number.isFinite(e[1]);case 1:l=l&&Number.isFinite(e[0]);break;default:l=!1}if(!l)throw new Error("Illegal attribute generated for ".concat(this.id))}}}class mD{constructor({gl:e,attribute:i,timeline:l}){j(this,"gl",void 0),j(this,"type","interpolation"),j(this,"attributeInTransition",void 0),j(this,"settings",void 0),j(this,"attribute",void 0),j(this,"transition",void 0),j(this,"currentStartIndices",void 0),j(this,"currentLength",void 0),j(this,"transform",void 0),j(this,"buffers",void 0),this.gl=e,this.transition=new Vh(l),this.attribute=i,this.attributeInTransition=new A_(e,i.settings),this.currentStartIndices=i.startIndices,this.currentLength=0,this.transform=_D(e,i);const u={byteLength:0,usage:35050};this.buffers=[new Oi(e,u),new Oi(e,u)]}get inProgress(){return this.transition.inProgress}start(e,i){if(e.duration<=0){this.transition.cancel();return}this.settings=e;const{gl:l,buffers:u,attribute:m}=this;Vw(u);const y={numInstances:i,attribute:m,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter};for(const T of u)Gw({buffer:T,...y});this.currentStartIndices=m.startIndices,this.currentLength=S_(m,i),this.attributeInTransition.setData({buffer:u[1],value:m.value}),this.transition.start(e),this.transform.update({elementCount:Math.floor(this.currentLength/m.size),sourceBuffers:{aFrom:u[0],aTo:Uw(l,m)},feedbackBuffers:{vCurrent:u[1]}})}update(){const e=this.transition.update();if(e){const{duration:i,easing:l}=this.settings,{time:u}=this.transition;let m=u/i;l&&(m=l(m)),this.transform.run({uniforms:{time:m}})}return e}cancel(){this.transition.cancel(),this.transform.delete();for(const e of this.buffers)e.delete();this.buffers.length=0}}const gD=`
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
attribute ATTRIBUTE_TYPE aFrom;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, time);
  gl_Position = vec4(0.0);
}
`;function _D(r,e){const i=jw(e.size);return new __(r,{vs:gD,defines:{ATTRIBUTE_TYPE:i},varyings:["vCurrent"]})}class yD{constructor({gl:e,attribute:i,timeline:l}){j(this,"gl",void 0),j(this,"type","spring"),j(this,"attributeInTransition",void 0),j(this,"settings",void 0),j(this,"attribute",void 0),j(this,"transition",void 0),j(this,"currentStartIndices",void 0),j(this,"currentLength",void 0),j(this,"texture",void 0),j(this,"framebuffer",void 0),j(this,"transform",void 0),j(this,"buffers",void 0),this.gl=e,this.type="spring",this.transition=new Vh(l),this.attribute=i,this.attributeInTransition=new A_(e,{...i.settings,normalized:!1}),this.currentStartIndices=i.startIndices,this.currentLength=0,this.texture=xD(e),this.framebuffer=bD(e,this.texture),this.transform=vD(e,i,this.framebuffer);const u={byteLength:0,usage:35050};this.buffers=[new Oi(e,u),new Oi(e,u),new Oi(e,u)]}get inProgress(){return this.transition.inProgress}start(e,i){const{gl:l,buffers:u,attribute:m}=this,y={numInstances:i,attribute:m,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter};for(const T of u)Gw({buffer:T,...y});this.settings=e,this.currentStartIndices=m.startIndices,this.currentLength=S_(m,i),this.attributeInTransition.setData({buffer:u[1],value:m.value}),this.transition.start({...e,duration:1/0}),this.transform.update({elementCount:Math.floor(this.currentLength/m.size),sourceBuffers:{aTo:Uw(l,m)}})}update(){const{buffers:e,transform:i,framebuffer:l,transition:u}=this;if(!u.update())return!1;const y=this.settings;return i.update({sourceBuffers:{aPrev:e[0],aCur:e[1]},feedbackBuffers:{vNext:e[2]}}),i.run({framebuffer:l,discard:!1,clearRenderTarget:!0,uniforms:{stiffness:y.stiffness,damping:y.damping},parameters:{depthTest:!1,blend:!0,viewport:[0,0,1,1],blendFunc:[1,1],blendEquation:[32776,32776]}}),Vw(e),this.attributeInTransition.setData({buffer:e[1],value:this.attribute.value}),cp(l)[0]>0||u.end(),!0}cancel(){this.transition.cancel(),this.transform.delete();for(const e of this.buffers)e.delete();this.buffers.length=0,this.texture.delete(),this.framebuffer.delete()}}function vD(r,e,i){const l=jw(e.size);return new __(r,{framebuffer:i,vs:`
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

uniform float stiffness;
uniform float damping;
attribute ATTRIBUTE_TYPE aPrev;
attribute ATTRIBUTE_TYPE aCur;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vNext;
varying float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE spring = delta * stiffness;
  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;
  return spring + damper + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,fs:`
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

varying float vIsTransitioningFlag;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  gl_FragColor = vec4(1.0);
}`,defines:{ATTRIBUTE_TYPE:l},varyings:["vNext"]})}function xD(r){return new In(r,{data:new Uint8Array(4),format:6408,type:5121,border:0,mipmaps:!1,dataFormat:6408,width:1,height:1})}function bD(r,e){return new tr(r,{id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,attachments:{36064:e}})}const wD={interpolation:mD,spring:yD};class TD{constructor(e,{id:i,timeline:l}){j(this,"id",void 0),j(this,"isSupported",void 0),j(this,"gl",void 0),j(this,"timeline",void 0),j(this,"transitions",void 0),j(this,"needsRedraw",void 0),j(this,"numInstances",void 0),this.id=i,this.gl=e,this.timeline=l,this.transitions={},this.needsRedraw=!1,this.numInstances=1,this.isSupported=__.isSupported(e)}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:i,numInstances:l}){this.numInstances=l||1;for(const u in e){const m=e[u],y=m.getTransitionSetting(i);y&&this._updateAttribute(u,m,y)}for(const u in this.transitions){const m=e[u];(!m||!m.getTransitionSetting(i))&&this._removeTransition(u)}}hasAttribute(e){const i=this.transitions[e];return i&&i.inProgress}getAttributes(){const e={};for(const i in this.transitions){const l=this.transitions[i];l.inProgress&&(e[i]=l.attributeInTransition)}return e}run(){if(!this.isSupported||this.numInstances===0)return!1;for(const i in this.transitions)this.transitions[i].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].cancel(),delete this.transitions[e]}_updateAttribute(e,i,l){const u=this.transitions[e];let m=!u||u.type!==l.type;if(m){if(!this.isSupported){Ii.warn("WebGL2 not supported by this browser. Transition for ".concat(e," is disabled."))();return}u&&this._removeTransition(e);const y=wD[l.type];y?this.transitions[e]=new y({attribute:i,timeline:this.timeline,gl:this.gl}):(Ii.error("unsupported transition type '".concat(l.type,"'"))(),m=!1)}(m||i.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(l,this.numInstances))}}const nb="attributeManager.invalidate",ED="attributeManager.updateStart",SD="attributeManager.updateEnd",AD="attribute.updateStart",MD="attribute.allocate",PD="attribute.updateEnd";class ID{constructor(e,{id:i="attribute-manager",stats:l,timeline:u}={}){j(this,"id",void 0),j(this,"gl",void 0),j(this,"attributes",void 0),j(this,"updateTriggers",void 0),j(this,"needsRedraw",void 0),j(this,"userData",void 0),j(this,"stats",void 0),j(this,"attributeTransitionManager",void 0),this.id=i,this.gl=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=l,this.attributeTransitionManager=new TD(e,{id:"".concat(i,"-transitions"),timeline:u}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const i=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,i&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{instanced:1})}remove(e){for(const i of e)this.attributes[i]!==void 0&&(this.attributes[i].delete(),delete this.attributes[i])}invalidate(e,i){const l=this._invalidateTrigger(e,i);Qr(nb,this,e,l)}invalidateAll(e){for(const i in this.attributes)this.attributes[i].setNeedsUpdate(i,e);Qr(nb,this,"all")}update({data:e,numInstances:i,startIndices:l=null,transitions:u,props:m={},buffers:y={},context:T={}}){let a=!1;Qr(ED,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const P in this.attributes){const D=this.attributes[P],N=D.settings.accessor;D.startIndices=l,D.numInstances=i,m[P]&&Ii.removed("props.".concat(P),"data.attributes.".concat(P))(),D.setExternalBuffer(y[P])||D.setBinaryValue(typeof N=="string"?y[N]:void 0,e.startIndices)||typeof N=="string"&&!y[N]&&D.setConstantValue(m[N])||D.needsUpdate()&&(a=!0,this._updateAttribute({attribute:D,numInstances:i,data:e,props:m,context:T})),this.needsRedraw=this.needsRedraw||D.needsRedraw()}a&&Qr(SD,this,i),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:i,transitions:u})}updateTransition(){const{attributeTransitionManager:e}=this,i=e.run();return this.needsRedraw=this.needsRedraw||i,i}getAttributes(){return this.attributes}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:i,attributeTransitionManager:l}=this,u={...l.getAttributes()};for(const m in i){const y=i[m];y.needsRedraw(e)&&!l.hasAttribute(m)&&(u[m]=y)}return u}getShaderAttributes(e,i={}){e||(e=this.getAttributes());const l={};for(const u in e)i[u]||Object.assign(l,e[u].getShaderAttributes());return l}_add(e,i={}){for(const l in e){const u=e[l];this.attributes[l]=this._createAttribute(l,u,i)}this._mapUpdateTriggersToAttributes()}_createAttribute(e,i,l){const u={...i,id:e,size:i.isIndexed&&1||i.size||1,divisor:l.instanced?1:i.divisor||0};return new A_(this.gl,u)}_mapUpdateTriggersToAttributes(){const e={};for(const i in this.attributes)this.attributes[i].getUpdateTriggers().forEach(u=>{e[u]||(e[u]=[]),e[u].push(i)});this.updateTriggers=e}_invalidateTrigger(e,i){const{attributes:l,updateTriggers:u}=this,m=u[e];return m&&m.forEach(y=>{const T=l[y];T&&T.setNeedsUpdate(T.id,i)}),m}_updateAttribute(e){const{attribute:i,numInstances:l}=e;if(Qr(AD,i),i.constant){i.setConstantValue(i.value);return}i.allocate(l)&&Qr(MD,i,l),i.updateBuffer(e)&&(this.needsRedraw=!0,Qr(PD,i,l))}}class CD extends Vh{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:i,toValue:l,duration:u,easing:m}}=this,y=m(e/u);this._value=Xd(i,l,y)}}const sb=1e-5;function ob(r,e,i,l,u){const m=e-r,T=(i-e)*u,a=-m*l;return T+a+m+e}function LD(r,e,i,l,u){if(Array.isArray(i)){const m=[];for(let y=0;y<i.length;y++)m[y]=ob(r[y],e[y],i[y],l,u);return m}return ob(r,e,i,l,u)}function ab(r,e){if(Array.isArray(r)){let i=0;for(let l=0;l<r.length;l++){const u=r[l]-e[l];i+=u*u}return Math.sqrt(i)}return Math.abs(r-e)}class kD extends Vh{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:i,damping:l,stiffness:u}=this.settings,{_prevValue:m=e,_currValue:y=e}=this;let T=LD(m,y,i,l,u);const a=ab(T,i),P=ab(T,y);a<sb&&P<sb&&(T=i,this.end()),this._prevValue=y,this._currValue=T}}const RD={interpolation:CD,spring:kD};class OD{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,i,l,u){const{transitions:m}=this;if(m.has(e)){const a=m.get(e),{value:P=a.settings.fromValue}=a;i=P,this.remove(e)}if(u=Nw(u),!u)return;const y=RD[u.type];if(!y){Ii.error("unsupported transition type '".concat(u.type,"'"))();return}const T=new y(this.timeline);T.start({...u,fromValue:i,toValue:l}),m.set(e,T)}remove(e){const{transitions:i}=this;i.has(e)&&(i.get(e).cancel(),i.delete(e))}update(){const e={};for(const[i,l]of this.transitions)l.update(),e[i]=l.value,l.inProgress||this.remove(i);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function DD(r){const e=M_(r);for(const i in e){const l=e[i],{validate:u}=l;if(u&&!u(r[i],l))throw new Error("Invalid prop ".concat(i,": ").concat(r[i]))}}function zD(r,e){const i=Zw({newProps:r,oldProps:e,propTypes:M_(r),ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),l=FD(r,e);let u=!1;return l||(u=ND(r,e)),{dataChanged:l,propsChanged:i,updateTriggersChanged:u,extensionsChanged:UD(r,e),transitionsChanged:BD(r,e)}}function BD(r,e){if(!r.transitions)return!1;const i={},l=M_(r);let u=!1;for(const m in r.transitions){const y=l[m],T=y&&y.type;(T==="number"||T==="color"||T==="array")&&Xg(r[m],e[m],y)&&(i[m]=!0,u=!0)}return u?i:!1}function Zw({newProps:r,oldProps:e,ignoreProps:i={},propTypes:l={},triggerName:u="props"}){if(e===r)return!1;if(typeof r!="object"||r===null||typeof e!="object"||e===null)return"".concat(u," changed shallowly");for(const m of Object.keys(r))if(!(m in i)){if(!(m in e))return"".concat(u,".").concat(m," added");const y=Xg(r[m],e[m],l[m]);if(y)return"".concat(u,".").concat(m," ").concat(y)}for(const m of Object.keys(e))if(!(m in i)){if(!(m in r))return"".concat(u,".").concat(m," dropped");if(!Object.hasOwnProperty.call(r,m)){const y=Xg(r[m],e[m],l[m]);if(y)return"".concat(u,".").concat(m," ").concat(y)}}return!1}function Xg(r,e,i){let l=i&&i.equal;return l&&!l(r,e,i)||!l&&(l=r&&e&&r.equals,l&&!l.call(r,e))?"changed deeply":!l&&e!==r?"changed shallowly":null}function FD(r,e){if(e===null)return"oldProps is null, initial diff";let i=!1;const{dataComparator:l,_dataDiff:u}=r;return l?l(r.data,e.data)||(i="Data comparator detected a change"):r.data!==e.data&&(i="A new data container was supplied"),i&&u&&(i=u(r.data,e.data)||i),i}function ND(r,e){if(e===null)return{all:!0};if("all"in r.updateTriggers&&lb(r,e,"all"))return{all:!0};const i={};let l=!1;for(const u in r.updateTriggers)u!=="all"&&lb(r,e,u)&&(i[u]=!0,l=!0);return l?i:!1}function UD(r,e){if(e===null)return!0;const i=e.extensions,{extensions:l}=r;if(l===i)return!1;if(!i||!l||l.length!==i.length)return!0;for(let u=0;u<l.length;u++)if(!l[u].equals(i[u]))return!0;return!1}function lb(r,e,i){let l=r.updateTriggers[i];l=l??{};let u=e.updateTriggers[i];return u=u??{},Zw({oldProps:u,newProps:l,triggerName:i})}function M_(r){const e=r[Jd],i=e&&e.constructor;return i?i._propTypes:{}}const jD="count(): argument not an object",VD="count(): argument not a container";function GD(r){if(!$D(r))throw new Error(jD);if(typeof r.count=="function")return r.count();if(Number.isFinite(r.size))return r.size;if(Number.isFinite(r.length))return r.length;if(ZD(r))return Object.keys(r).length;throw new Error(VD)}function ZD(r){return r!==null&&typeof r=="object"&&r.constructor===Object}function $D(r){return r!==null&&typeof r=="object"}function WD(r,e){if(!e)return r;const i={...r,...e};if("defines"in e&&(i.defines={...r.defines,...e.defines}),"modules"in e&&(i.modules=(r.modules||[]).concat(e.modules),e.modules.some(l=>l.name==="project64"))){const l=i.modules.findIndex(u=>u.name==="project32");l>=0&&i.modules.splice(l,1)}if("inject"in e)if(!r.inject)i.inject=e.inject;else{const l={...r.inject};for(const u in e.inject)l[u]=(l[u]||"")+e.inject[u];i.inject=l}return i}const qD={10241:9987,10240:9729,10242:33071,10243:33071},Hg={};function XD(r,e){const i=r.context&&r.context.gl;if(!i||!e)return null;if(e instanceof In)return e;e.constructor&&e.constructor.name!=="Object"&&(e={data:e});let l=null;e.compressed&&(l={10241:e.data.length>1?9985:9729});const u=new In(i,{...e,parameters:{...qD,...l,...r.props.textureParameters}});return Hg[u.id]=!0,u}function HD(r){!r||!(r instanceof In)||Hg[r.id]&&(r.delete(),delete Hg[r.id])}const YD={boolean:{validate(r,e){return!0},equal(r,e,i){return!!r==!!e}},number:{validate(r,e){return Number.isFinite(r)&&(!("max"in e)||r<=e.max)&&(!("min"in e)||r>=e.min)}},color:{validate(r,e){return e.optional&&!r||Lh(r)&&(r.length===3||r.length===4)},equal(r,e,i){return mg(r,e)}},accessor:{validate(r,e){const i=ep(r);return i==="function"||i===ep(e.value)},equal(r,e,i){return typeof e=="function"?!0:mg(r,e)}},array:{validate(r,e){return e.optional&&!r||Lh(r)},equal(r,e,i){return i.compare?mg(r,e):r===e}},object:{equal(r,e,i){return i.compare?Bc(r,e):r===e}},function:{validate(r,e){return e.optional&&!r||typeof r=="function"},equal(r,e,i){return!i.compare||r===e}},data:{transform:(r,e,i)=>{const{dataTransform:l}=i.props;return l&&r?l(r):r}},image:{transform:(r,e,i)=>XD(i,r),release:r=>{HD(r)}}};function mg(r,e){if(r===e)return!0;if(!Lh(r)||!Lh(e))return!1;const i=r.length;if(i!==e.length)return!1;for(let l=0;l<i;l++)if(r[l]!==e[l])return!1;return!0}function KD(r){const e={},i={},l={};for(const[u,m]of Object.entries(r)){const y=m?.deprecatedFor;if(y)l[u]=Array.isArray(y)?y:[y];else{const T=JD(u,m);e[u]=T,i[u]=T.value}}return{propTypes:e,defaultProps:i,deprecatedProps:l}}function JD(r,e){switch(ep(e)){case"object":return mh(r,e);case"array":return mh(r,{type:"array",value:e,compare:!1});case"boolean":return mh(r,{type:"boolean",value:e});case"number":return mh(r,{type:"number",value:e});case"function":return mh(r,{type:"function",value:e,compare:!0});default:return{name:r,type:"unknown",value:e}}}function mh(r,e){return"type"in e?{name:r,...YD[e.type],...e}:"value"in e?{name:r,type:ep(e.value),...e}:{name:r,type:"object",value:e}}function Lh(r){return Array.isArray(r)||ArrayBuffer.isView(r)}function ep(r){return Lh(r)?"array":r===null?"null":typeof r}function QD(r,e){const i=$w(r.constructor),l=Object.create(i);l[Jd]=r,l[hl]={},l[aa]={};for(let u=0;u<e.length;++u){const m=e[u];for(const y in m)l[y]=m[y]}return Object.freeze(l),l}function $w(r){const e=tp(r,"_mergedDefaultProps");return e||(ez(r),r._mergedDefaultProps)}function ez(r){if(!r.prototype)return;const i=Object.getPrototypeOf(r),l=$w(i),u=tp(r,"defaultProps")||{},m=KD(u),y=tz(m.defaultProps,l,r),T={...i._propTypes,...m.propTypes};rz(y,T);const a={...i._deprecatedProps,...m.deprecatedProps};iz(y,a),r._mergedDefaultProps=y,r._propTypes=T,r._deprecatedProps=a}function tz(r,e,i){const l=Object.create(null);Object.assign(l,e,r);const u=sz(i);return delete r.id,Object.defineProperties(l,{id:{writable:!0,value:u}}),l}function iz(r,e){for(const i in e)Object.defineProperty(r,i,{enumerable:!1,set(l){const u="".concat(this.id,": ").concat(i);for(const m of e[i])Ww(this,m)||(this[m]=l);Ii.deprecated(u,e[i].join("/"))()}})}function rz(r,e){const i={},l={};for(const u in e){const m=e[u],{name:y,value:T}=m;m.async&&(i[y]=T,l[y]=nz(y))}r[Tc]=i,r[hl]={},Object.defineProperties(r,l)}function nz(r){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||Fw(e)?this[hl][r]=e:this[aa][r]=e},get(){if(this[aa]){if(r in this[aa])return this[aa][r]||this[Tc][r];if(r in this[hl]){const e=this[Jd]&&this[Jd].internalState;if(e&&e.hasAsyncProp(r))return e.getAsyncProp(r)||this[Tc][r]}}return this[Tc][r]}}}function Ww(r,e){return Object.prototype.hasOwnProperty.call(r,e)}function tp(r,e){return Ww(r,e)&&r[e]}function sz(r){const e=tp(r,"layerName")||tp(r,"componentName");return e||Ii.once(0,"".concat(r.name,".componentName not specified"))(),e||r.name}let oz=0;class P_{constructor(...e){j(this,"id",void 0),j(this,"props",void 0),j(this,"count",void 0),this.props=QD(this,e),this.id=this.props.id,this.count=oz++}clone(e){const{props:i}=this,l={};for(const u in i[Tc])u in i[aa]?l[u]=i[aa][u]:u in i[hl]&&(l[u]=i[hl][u]);return new this.constructor({...i,...l,...e})}}j(P_,"componentName","Component");j(P_,"defaultProps",{});const az=Object.freeze({});class lz{constructor(e){j(this,"component",void 0),j(this,"onAsyncPropUpdated",void 0),j(this,"asyncProps",void 0),j(this,"oldProps",void 0),j(this,"oldAsyncProps",void 0),this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const i=this.asyncProps[e];i&&i.type&&i.type.release&&i.type.release(i.resolvedValue,i.type,this.component)}}getOldProps(){return this.oldAsyncProps||this.oldProps||az}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component.props}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const i=this.asyncProps[e];return i&&i.resolvedValue}isAsyncPropLoading(e){if(e){const i=this.asyncProps[e];return!!(i&&i.pendingLoadCount>0&&i.pendingLoadCount!==i.resolvedLoadCount)}for(const i in this.asyncProps)if(this.isAsyncPropLoading(i))return!0;return!1}reloadAsyncProp(e,i){this._watchPromise(e,Promise.resolve(i))}setAsyncProps(e){const i=e[aa]||{},l=e[hl]||e,u=e[Tc]||{};for(const m in i){const y=i[m];this._createAsyncPropData(m,u[m]),this._updateAsyncProp(m,y),i[m]=this.getAsyncProp(m)}for(const m in l){const y=l[m];this._createAsyncPropData(m,u[m]),this._updateAsyncProp(m,y)}}_fetch(e,i){return null}_onResolve(e,i){}_onError(e,i){}_updateAsyncProp(e,i){if(this._didAsyncInputValueChange(e,i)){if(typeof i=="string"&&(i=this._fetch(e,i)),i instanceof Promise){this._watchPromise(e,i);return}if(Fw(i)){this._resolveAsyncIterable(e,i);return}this._setPropValue(e,i)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,i){const l=this.asyncProps[e];return i===l.resolvedValue||i===l.lastValue?!1:(l.lastValue=i,!0)}_setPropValue(e,i){this._freezeAsyncOldProps();const l=this.asyncProps[e];l&&(i=this._postProcessValue(l,i),l.resolvedValue=i,l.pendingLoadCount++,l.resolvedLoadCount=l.pendingLoadCount)}_setAsyncPropValue(e,i,l){const u=this.asyncProps[e];u&&l>=u.resolvedLoadCount&&i!==void 0&&(this._freezeAsyncOldProps(),u.resolvedValue=i,u.resolvedLoadCount=l,this.onAsyncPropUpdated(e,i))}_watchPromise(e,i){const l=this.asyncProps[e];if(l){l.pendingLoadCount++;const u=l.pendingLoadCount;i.then(m=>{m=this._postProcessValue(l,m),this._setAsyncPropValue(e,m,u),this._onResolve(e,m)}).catch(m=>{this._onError(e,m)})}}async _resolveAsyncIterable(e,i){if(e!=="data"){this._setPropValue(e,i);return}const l=this.asyncProps[e];if(!l)return;l.pendingLoadCount++;const u=l.pendingLoadCount;let m=[],y=0;for await(const T of i){const{dataTransform:a}=this.component.props;a?m=a(T,m):m=m.concat(T),Object.defineProperty(m,"__diff",{enumerable:!1,value:[{startRow:y,endRow:m.length}]}),y=m.length,this._setAsyncPropValue(e,m,u)}this._onResolve(e,m)}_postProcessValue(e,i){const l=e.type;return l&&(l.release&&l.release(e.resolvedValue,l,this.component),l.transform)?l.transform(i,l,this.component):i}_createAsyncPropData(e,i){if(!this.asyncProps[e]){const u=this.component&&this.component.constructor._propTypes;this.asyncProps[e]={type:u&&u[e],lastValue:null,resolvedValue:i,pendingLoadCount:0,resolvedLoadCount:0}}}}class cz extends lz{constructor({attributeManager:e,layer:i}){super(i),j(this,"attributeManager",void 0),j(this,"needsRedraw",void 0),j(this,"needsUpdate",void 0),j(this,"subLayers",void 0),j(this,"usesPickingColorCache",void 0),j(this,"changeFlags",void 0),j(this,"viewport",void 0),j(this,"uniformTransitions",void 0),j(this,"propsInTransition",void 0),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}set layer(e){this.component=e}_fetch(e,i){const l=this.component.props.fetch;return l?l(i,{propName:e,layer:this.layer}):super._fetch(e,i)}_onResolve(e,i){const l=this.component.props.onDataLoad;e==="data"&&l&&l(i,{propName:e,layer:this.layer})}_onError(e,i){this.layer.raiseError(i,"loading ".concat(e," of ").concat(this.layer))}}const uz="layer.changeFlag",hz="layer.initialize",fz="layer.update",dz="layer.finalize",pz="layer.matched",cb=2**24-1,mz=Object.freeze([]),gz=hp(({oldViewport:r,viewport:e})=>r.equals(e));let Ds=new Uint8ClampedArray(0);const _z={data:{type:"data",value:mz,async:!0},dataComparator:{type:"function",value:null,compare:!1,optional:!0},_dataDiff:{type:"function",value:r=>r&&r.__diff,compare:!1,optional:!0},dataTransform:{type:"function",value:null,compare:!1,optional:!0},onDataLoad:{type:"function",value:null,compare:!1,optional:!0},onError:{type:"function",value:null,compare:!1,optional:!0},fetch:{type:"function",value:(r,{propName:e,layer:i,loaders:l,loadOptions:u,signal:m})=>{const{resourceManager:y}=i.context;if(u=u||i.getLoadOptions(),l=l||i.props.loaders,m){var T;u={...u,fetch:{...(T=u)===null||T===void 0?void 0:T.fetch,signal:m}}}let a=y.contains(r);return!a&&!u&&(y.add({resourceId:r,data:Sg(r,l),persistent:!1}),a=!0),a?y.subscribe({resourceId:r,onChange:P=>{var D;return(D=i.internalState)===null||D===void 0?void 0:D.reloadAsyncProp(e,P)},consumerId:i.id,requestId:e}):Sg(r,l,u)},compare:!1},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:jh.DRAW,onHover:{type:"function",value:null,compare:!1,optional:!0},onClick:{type:"function",value:null,compare:!1,optional:!0},onDragStart:{type:"function",value:null,compare:!1,optional:!0},onDrag:{type:"function",value:null,compare:!1,optional:!0},onDragEnd:{type:"function",value:null,compare:!1,optional:!0},coordinateSystem:Ti.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,compare:!0},getPolygonOffset:{type:"function",value:({layerIndex:r})=>[0,-r*100],compare:!1},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class I_ extends P_{constructor(...e){super(...e),j(this,"internalState",null),j(this,"lifecycle",vc.NO_STATE),j(this,"context",void 0),j(this,"state",void 0),j(this,"parent",null)}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){const e=this.constructor.layerName||this.constructor.name;return"".concat(e,"({id: '").concat(this.props.id,"'})")}project(e){kr(this.internalState);const i=this.internalState.viewport||this.context.viewport,l=ww(e,{viewport:i,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[u,m,y]=b_(l,i.pixelProjectionMatrix);return e.length===2?[u,m]:[u,m,y]}unproject(e){return kr(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,i){kr(this.internalState);const l=this.internalState.viewport||this.context.viewport;return RR(e,{viewport:l,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...i})}get isComposite(){return!1}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){return this.state&&(this.state.models||this.state.model&&[this.state.model])||[]}setModuleParameters(e){for(const i of this.getModels())i.updateModuleSettings(e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===Ti.DEFAULT||e===Ti.LNGLAT||e===Ti.CARTESIAN}onHover(e,i){return this.props.onHover&&this.props.onHover(e,i)||!1}onClick(e,i){return this.props.onClick&&this.props.onClick(e,i)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,i=[]){return i[0]=e+1&255,i[1]=e+1>>8&255,i[2]=e+1>>8>>8&255,i}decodePickingColor(e){kr(e instanceof Uint8Array);const[i,l,u]=e;return i+l*256+u*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:GD(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var e;const i=this.getAttributeManager();if(!i)return null;const{positions:l,instancePositions:u}=i.attributes;return(e=l||u)===null||e===void 0?void 0:e.getBounds()}getShaders(e){for(const i of this.props.extensions)e=WD(e,i.getShaders.call(this,i));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const i=this.getAttributeManager(),{dataChanged:l}=e.changeFlags;if(l&&i)if(Array.isArray(l))for(const a of l)i.invalidateAll(a);else i.invalidateAll();const{props:u,oldProps:m}=e,y=Number.isInteger(m.highlightedObjectIndex)||m.pickable,T=Number.isInteger(u.highlightedObjectIndex)||u.pickable;if(y!==T&&i){const{pickingColors:a,instancePickingColors:P}=i.attributes,D=a||P;D&&(T&&D.constant&&(D.constant=!1,i.invalidate(D.id)),!D.value&&!T&&(D.constant=!0,D.value=[0,0,0]))}}finalizeState(e){for(const l of this.getModels())l.delete();const i=this.getAttributeManager();i&&i.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const i of this.getModels())i.draw(e)}getPickingInfo({info:e,mode:i,sourceLayer:l}){const{index:u}=e;return u>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[u]),e}raiseError(e,i){var l,u;if(i&&(e.message="".concat(i,": ").concat(e.message)),!((l=(u=this.props).onError)!==null&&l!==void 0&&l.call(u,e))){var m,y;(m=this.context)===null||m===void 0||(y=m.onError)===null||y===void 0||y.call(m,e,this)}}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var e;return((e=this.internalState)===null||e===void 0?void 0:e.uniformTransitions.active)||!1}activateViewport(e){if(!this.internalState)return;const i=this.internalState.viewport;this.internalState.viewport=e,(!i||!gz({oldViewport:i,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const i=this.getAttributeManager();i&&(e==="all"?i.invalidateAll():i.invalidate(e))}updateAttributes(e){for(const i of this.getModels())this._setModelAttributes(i,e)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const i=this.props,l=this.getNumInstances(),u=this.getStartIndices();e.update({data:i.data,numInstances:l,startIndices:u,props:i,transitions:i.transitions,buffers:i.data.attributes,context:this});const m=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(m)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const i=e.update(),l=Object.create(this.props);for(const u in i)Object.defineProperty(l,u,{value:i[u]});return l}return this.props}calculateInstancePickingColors(e,{numInstances:i}){if(e.constant)return;const l=Math.floor(Ds.length/3);if(this.internalState.usesPickingColorCache=!0,l<i){i>cb&&Ii.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),Ds=Ch.allocate(Ds,i,{size:3,copy:!0,maxCount:Math.max(i,cb)});const u=Math.floor(Ds.length/3),m=[];for(let y=l;y<u;y++)this.encodePickingColor(y,m),Ds[y*3+0]=m[0],Ds[y*3+1]=m[1],Ds[y*3+2]=m[2]}e.value=Ds.subarray(0,i*3)}_setModelAttributes(e,i){const l=this.getAttributeManager(),u=e.userData.excludeAttributes||{},m=l.getShaderAttributes(i,u);e.setAttributes(m)}disablePickingIndex(e){this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:i,instancePickingColors:l}=this.getAttributeManager().attributes,u=i||l;if(!u)return;const m=u.getVertexOffset(e),y=u.getVertexOffset(e+1);u.buffer.subData({data:new Uint8Array(y-m),offset:m})}restorePickingColors(){const{pickingColors:e,instancePickingColors:i}=this.getAttributeManager().attributes,l=e||i;l&&(this.internalState.usesPickingColorCache&&l.value.buffer!==Ds.buffer&&(l.value=Ds.subarray(0,l.value.length)),l.updateSubBuffer({startOffset:0}))}_initialize(){kr(!this.internalState),kr(Number.isFinite(this.props.coordinateSystem)),Qr(hz,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new cz({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(Ii.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.layer=this,this.internalState.uniformTransitions=new OD(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const i of this.props.extensions)i.initializeState.call(this,this.context,i);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){Qr(pz,this,this===e);const{state:i,internalState:l}=e;this!==e&&(this.internalState=l,this.internalState.layer=this,this.state=i,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(Qr(fz,this,e),!e)return;const i=this.props,l=this.context,u=this.internalState,m=l.viewport,y=this._updateUniformTransition();u.propsInTransition=y,l.viewport=u.viewport||m,this.props=y;try{const T=this._getUpdateParams(),a=this.getModels();if(l.gl)this.updateState(T);else try{this.updateState(T)}catch{}for(const D of this.props.extensions)D.updateState.call(this,T,D);const P=this.getModels()[0]!==a[0];this._postUpdate(T,P)}finally{l.viewport=m,this.props=i,this._clearChangeFlags(),u.needsUpdate=!1,u.resetOldProps()}}_finalize(){Qr(dz,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,e)}_drawLayer({moduleParameters:e=null,uniforms:i={},parameters:l={}}){this._updateAttributeTransition();const u=this.props,m=this.context;this.props=this.internalState.propsInTransition||u;const y=this.props.opacity;i.opacity=Math.pow(y,1/2.2);try{e&&this.setModuleParameters(e);const{getPolygonOffset:T}=this.props,a=T&&T(i)||[0,0];wo(m.gl,{polygonOffset:a}),Vn(m.gl,l,()=>{const P={moduleParameters:e,uniforms:i,parameters:l,context:m};for(const D of this.props.extensions)D.draw.call(this,P,D);this.draw(P)})}finally{this.props=u}}getChangeFlags(){var e;return(e=this.internalState)===null||e===void 0?void 0:e.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:i}=this.internalState;for(const u in e)if(e[u]){let m=!1;switch(u){case"dataChanged":const y=e[u],T=i[u];y&&Array.isArray(T)&&(i.dataChanged=Array.isArray(y)?T.concat(y):y,m=!0);default:i[u]||(i[u]=e[u],m=!0)}m&&Qr(uz,this,u,e)}const l=!!(i.dataChanged||i.updateTriggersChanged||i.propsChanged||i.extensionsChanged);i.propsOrDataChanged=l,i.somethingChanged=l||i.viewportChanged||i.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,i){const l=zD(e,i);if(l.updateTriggersChanged)for(const m in l.updateTriggersChanged)l.updateTriggersChanged[m]&&this.invalidateAttribute(m);if(l.transitionsChanged)for(const m in l.transitionsChanged){var u;this.internalState.uniformTransitions.add(m,i[m],e[m],(u=e.transitions)===null||u===void 0?void 0:u[m])}return this.setChangeFlags(l)}validateProps(){DD(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const i={pickingSelectedColor:e.picked?e.color:null},{highlightColor:l}=this.props;e.picked&&typeof l=="function"&&(i.pickingHighlightColor=l(e)),this.setModuleParameters(i),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new ID(e.gl,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,i){const{props:l,oldProps:u}=e;this.setNeedsRedraw(),this._updateAttributes();const{model:m}=this.state;m?.setInstanceCount(this.getNumInstances());const{autoHighlight:y,highlightedObjectIndex:T,highlightColor:a}=l;if(i||u.autoHighlight!==y||u.highlightedObjectIndex!==T||u.highlightColor!==a){const P={};y||(P.pickingSelectedColor=null),Array.isArray(a)&&(P.pickingHighlightColor=a),Number.isInteger(T)&&(P.pickingSelectedColor=Number.isFinite(T)&&T>=0?this.encodePickingColor(T):null),this.setModuleParameters(P)}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let i=!1;i=i||this.internalState.needsRedraw&&this.id,this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags;const l=this.getAttributeManager(),u=l?l.getNeedsRedraw(e):!1;return i=i||u,i}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}j(I_,"defaultProps",_z);j(I_,"layerName","Layer");const yz=typeof window<"u"?je.useLayoutEffect:je.useEffect;function ip(r,e){for(;r;){if(r===e)return!0;r=Object.getPrototypeOf(r)}return!1}const vz={position:"absolute",zIndex:-1};function qw(r,e){if(typeof r=="function")return r(e);if(Array.isArray(r))return r.map(i=>qw(i,e));if(mp(r)){if(xz(r))return e.style=vz,je.cloneElement(r,e);if(bz(r))return je.cloneElement(r,e)}return r}function mp(r){return r&&typeof r=="object"&&"type"in r||!1}function xz(r){const e=r.type,i=e&&e.defaultProps;return i&&i.mapStyle}function bz(r){const e=r.type;return e&&e.deckGLViewProps}function Yg(r){if(typeof r=="function")return je.createElement(fl,{},r);if(Array.isArray(r))return r.map(Yg);if(mp(r)){if(r.type===je.Fragment)return Yg(r.props.children);if(ip(r.type,fl))return r}return r}function wz({children:r,layers:e=[],views:i=null}){const l=[],u=[],m={};return je.Children.forEach(Yg(r),y=>{if(mp(y)){const T=y.type;if(ip(T,I_)){const a=Tz(T,y.props);u.push(a)}else l.push(y);if(ip(T,fl)&&T!==fl&&y.props.id){const a=new T(y.props);m[a.id]=a}}else y&&l.push(y)}),Object.keys(m).length>0&&(Array.isArray(i)?i.forEach(y=>{m[y.id]=y}):i&&(m[i.id]=i),i=Object.values(m)),e=u.length>0?[...u,...e]:e,{layers:e,children:l,views:i}}function Tz(r,e){const i={},l=r.defaultProps||{};for(const u in e)l[u]!==e[u]&&(i[u]=e[u]);return new r(i)}function Ez({children:r,deck:e,ContextProvider:i}){const{viewManager:l}=e||{};if(!l||!l.views.length)return[];const u={},m=l.views[0].id;for(const y of r){let T=m,a=y;mp(y)&&ip(y.type,fl)&&(T=y.props.id||m,a=y.props.children);const P=l.getViewport(T),D=l.getViewState(T);if(P){D.padding=P.padding;const{x:N,y:F,width:W,height:oe}=P;a=qw(a,{x:N,y:F,width:W,height:oe,viewport:P,viewState:D}),u[T]||(u[T]={viewport:P,children:[]}),u[T].children.push(a)}}return Object.keys(u).map(y=>{const{viewport:T,children:a}=u[y],{x:P,y:D,width:N,height:F}=T,W={position:"absolute",left:P,top:D,width:N,height:F},oe="view-".concat(y),me=je.createElement("div",{key:oe,id:oe,style:W},...a);if(i){const fe={viewport:T,container:e.canvas.offsetParent,eventManager:e.eventManager,onViewStateChange:Ee=>{Ee.viewId=y,e._onViewStateChange(Ee)}};return je.createElement(i,{key:oe,value:fe},me)}return me})}const Sz={mixBlendMode:null};function Az({width:r,height:e,style:i}){const l={position:"absolute",zIndex:0,left:0,top:0,width:r,height:e},u={left:0,top:0};if(i)for(const m in i)m in Sz?u[m]=i[m]:l[m]=i[m];return{containerStyle:l,canvasStyle:u}}function Mz(r){return{get deck(){return r.deck},pickObject:e=>r.deck.pickObject(e),pickMultipleObjects:e=>r.deck.pickMultipleObjects(e),pickObjects:e=>r.deck.pickObjects(e)}}function Xw(r){r.redrawReason&&(r.deck._drawLayers(r.redrawReason),r.redrawReason=null)}function Pz(r,e,i){const l=new e({...i,_customRender:u=>{r.redrawReason=u;const m=l.getViewports();r.lastRenderedViewports!==m?r.forceUpdate():Xw(r)}});return l}const Iz=je.forwardRef((r,e)=>{const[i,l]=je.useState(0),m=je.useRef({control:null,version:i,forceUpdate:()=>l(Ve=>Ve+1)}).current,y=je.useRef(null),T=je.useRef(null),a=je.useMemo(()=>wz(r),[r.layers,r.views,r.children]);let P=!0;const D=Ve=>{var Re;return P&&r.viewState?(m.viewStateUpdateRequested=Ve,null):(m.viewStateUpdateRequested=null,(Re=r.onViewStateChange)===null||Re===void 0?void 0:Re.call(r,Ve))},N=Ve=>{if(P)m.interactionStateUpdateRequested=Ve;else{var Re;m.interactionStateUpdateRequested=null,(Re=r.onInteractionStateChange)===null||Re===void 0||Re.call(r,Ve)}},F=je.useMemo(()=>{const Ve={...r,style:null,width:"100%",height:"100%",parent:y.current,canvas:T.current,layers:a.layers,views:a.views,onViewStateChange:D,onInteractionStateChange:N};return delete Ve._customRender,m.deck&&m.deck.setProps(Ve),Ve},[r]);je.useEffect(()=>{const Ve=r.Deck||pp;return m.deck=Pz(m,Ve,{...F,parent:y.current,canvas:T.current}),()=>{var Re;return(Re=m.deck)===null||Re===void 0?void 0:Re.finalize()}},[]),yz(()=>{Xw(m);const{viewStateUpdateRequested:Ve,interactionStateUpdateRequested:Re}=m;Ve&&D(Ve),Re&&N(Re)}),je.useImperativeHandle(e,()=>Mz(m),[]);const W=m.deck&&m.deck.isInitialized?m.deck.getViewports():void 0,{ContextProvider:oe,width:me,height:fe,id:Ee,style:Ce}=r,{containerStyle:ke,canvasStyle:$e}=je.useMemo(()=>Az({width:me,height:fe,style:Ce}),[me,fe,Ce]);if(!m.viewStateUpdateRequested&&m.lastRenderedViewports===W||m.version!==i){m.lastRenderedViewports=W,m.version=i;const Ve=Ez({children:a.children,deck:m.deck,ContextProvider:oe}),Re=je.createElement("canvas",{key:"canvas",id:Ee||"deckgl-overlay",ref:T,style:$e});m.control=je.createElement("div",{id:"".concat(Ee||"deckgl","-wrapper"),ref:y,style:ke},[Re,Ve])}return P=!1,m.control});Iz.defaultProps=pp.defaultProps;function Kg(r,e){(e==null||e>r.length)&&(e=r.length);for(var i=0,l=Array(e);i<e;i++)l[i]=r[i];return l}function Cz(r){if(Array.isArray(r))return Kg(r)}function Lz(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function Hw(r,e){if(r){if(typeof r=="string")return Kg(r,e);var i={}.toString.call(r).slice(8,-1);return i==="Object"&&r.constructor&&(i=r.constructor.name),i==="Map"||i==="Set"?Array.from(r):i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?Kg(r,e):void 0}}function kz(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Rz(r){return Cz(r)||Lz(r)||Hw(r)||kz()}function Oz(r){if(Array.isArray(r))return r}function Dz(r,e){var i=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(i!=null){var l,u,m,y,T=[],a=!0,P=!1;try{if(m=(i=i.call(r)).next,e===0){if(Object(i)!==i)return;a=!1}else for(;!(a=(l=m.call(i)).done)&&(T.push(l.value),T.length!==e);a=!0);}catch(D){P=!0,u=D}finally{try{if(!a&&i.return!=null&&(y=i.return(),Object(y)!==y))return}finally{if(P)throw u}}return T}}function zz(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ir(r,e){return Oz(r)||Dz(r,e)||Hw(r,e)||zz()}function fa(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function Bz(r,e){for(var i=0;i<e.length;i++){var l=e[i];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(r,Gb(l.key),l)}}function da(r,e,i){return e&&Bz(r.prototype,e),Object.defineProperty(r,"prototype",{writable:!1}),r}var vo=typeof document<"u"?document:{};function ub(r,e){var i=Object.keys(r);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(r);e&&(l=l.filter(function(u){return Object.getOwnPropertyDescriptor(r,u).enumerable})),i.push.apply(i,l)}return i}function Id(r){for(var e=1;e<arguments.length;e++){var i=arguments[e]!=null?arguments[e]:{};e%2?ub(Object(i),!0).forEach(function(l){j(r,l,i[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(i)):ub(Object(i)).forEach(function(l){Object.defineProperty(r,l,Object.getOwnPropertyDescriptor(i,l))})}return r}function hb(r,e){var i;if(typeof Symbol>"u"||r[Symbol.iterator]==null){if(Array.isArray(r)||(i=Fz(r))||e){i&&(r=i);var l=0,u=function(){};return{s:u,n:function(){return l>=r.length?{done:!0}:{done:!1,value:r[l++]}},e:function(P){throw P},f:u}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var m=!0,y=!1,T;return{s:function(){i=r[Symbol.iterator]()},n:function(){var P=i.next();return m=P.done,P},e:function(P){y=!0,T=P},f:function(){try{!m&&i.return!=null&&i.return()}finally{if(y)throw T}}}}function Fz(r,e){if(r){if(typeof r=="string")return fb(r,e);var i=Object.prototype.toString.call(r).slice(8,-1);if(i==="Object"&&r.constructor&&(i=r.constructor.name),i==="Map"||i==="Set")return Array.from(r);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return fb(r,e)}}function fb(r,e){(e==null||e>r.length)&&(e=r.length);for(var i=0,l=new Array(e);i<e;i++)l[i]=r[i];return l}var Nz=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function gg(r){if(!r)return null;if(typeof r=="string")return r;r.toJS&&(r=r.toJS());var e={},i=hb(r.layers),l;try{for(i.s();!(l=i.n()).done;){var u=l.value;e[u.id]=u}}catch(y){i.e(y)}finally{i.f()}var m=r.layers.map(function(y){var T=e[y.ref],a=null;if("interactive"in y&&(a=Id({},y),delete a.interactive),T){a=a||Id({},y),delete a.ref;var P=hb(Nz),D;try{for(P.s();!(D=P.n()).done;){var N=D.value;N in T&&(a[N]=T[N])}}catch(F){P.e(F)}finally{P.f()}}return a||y});return Id(Id({},r),{},{layers:m})}var db=[];function Uz(){}function jz(r){r&&console.error(r.error)}var Yw={container:Pe.object,gl:Pe.object,mapboxApiAccessToken:Pe.string,mapboxApiUrl:Pe.string,attributionControl:Pe.bool,preserveDrawingBuffer:Pe.bool,reuseMaps:Pe.bool,transformRequest:Pe.func,mapOptions:Pe.object,mapStyle:Pe.oneOfType([Pe.string,Pe.object]),preventStyleDiffing:Pe.bool,visible:Pe.bool,asyncRender:Pe.bool,onLoad:Pe.func,onError:Pe.func,width:Pe.number,height:Pe.number,viewState:Pe.object,longitude:Pe.number,latitude:Pe.number,zoom:Pe.number,bearing:Pe.number,pitch:Pe.number,altitude:Pe.number},jd={container:vo.body,mapboxApiAccessToken:Vz(),mapboxApiUrl:"https://api.mapbox.com",preserveDrawingBuffer:!1,attributionControl:!0,reuseMaps:!1,mapOptions:{},mapStyle:"mapbox://styles/mapbox/light-v8",preventStyleDiffing:!1,visible:!0,asyncRender:!1,onLoad:Uz,onError:jz,width:0,height:0,longitude:0,latitude:0,zoom:0,bearing:0,pitch:0,altitude:1.5};function Vz(){var r=null;if(typeof window<"u"&&window.location){var e=window.location.search.match(/access_token=([^&\/]*)/);r=e&&e[1]}return!r&&typeof process<"u"&&(r=r||db.MapboxAccessToken||db.REACT_APP_MAPBOX_ACCESS_TOKEN),r||"no-token"}function pb(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"component";r.debug&&Pe.checkPropTypes(Yw,r,"prop",e)}var ml=function(){function r(e){var i=this;if(fa(this,r),j(this,"props",jd),j(this,"width",0),j(this,"height",0),j(this,"_fireLoadEvent",function(){i.props.onLoad({type:"load",target:i._map})}),j(this,"_handleError",function(l){i.props.onError(l)}),!e.mapboxgl)throw new Error("Mapbox not available");this.mapboxgl=e.mapboxgl,r.initialized||(r.initialized=!0,this._checkStyleSheet(this.mapboxgl.version)),this._initialize(e)}return da(r,[{key:"finalize",value:function(){return this._destroy(),this}},{key:"setProps",value:function(i){return this._update(this.props,i),this}},{key:"redraw",value:function(){var i=this._map;i.style&&(i._frame&&(i._frame.cancel(),i._frame=null),i._render())}},{key:"getMap",value:function(){return this._map}},{key:"_reuse",value:function(i){this._map=r.savedMap;var l=this._map.getContainer(),u=i.container;for(u.classList.add("mapboxgl-map");l.childNodes.length>0;)u.appendChild(l.childNodes[0]);this._map._container=u,r.savedMap=null,i.mapStyle&&this._map.setStyle(gg(i.mapStyle),{diff:!1}),this._map.isStyleLoaded()?this._fireLoadEvent():this._map.once("styledata",this._fireLoadEvent)}},{key:"_create",value:function(i){if(i.reuseMaps&&r.savedMap)this._reuse(i);else{if(i.gl){var l=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=function(){return HTMLCanvasElement.prototype.getContext=l,i.gl}}var u={container:i.container,center:[0,0],zoom:8,pitch:0,bearing:0,maxZoom:24,style:gg(i.mapStyle),interactive:!1,trackResize:!1,attributionControl:i.attributionControl,preserveDrawingBuffer:i.preserveDrawingBuffer};i.transformRequest&&(u.transformRequest=i.transformRequest),this._map=new this.mapboxgl.Map(Object.assign({},u,i.mapOptions)),this._map.once("load",this._fireLoadEvent),this._map.on("error",this._handleError)}return this}},{key:"_destroy",value:function(){this._map&&(this.props.reuseMaps&&!r.savedMap?(r.savedMap=this._map,this._map.off("load",this._fireLoadEvent),this._map.off("error",this._handleError),this._map.off("styledata",this._fireLoadEvent)):this._map.remove(),this._map=null)}},{key:"_initialize",value:function(i){var l=this;i=Object.assign({},jd,i),pb(i,"Mapbox"),this.mapboxgl.accessToken=i.mapboxApiAccessToken||jd.mapboxApiAccessToken,this.mapboxgl.baseApiUrl=i.mapboxApiUrl,this._create(i);var u=i,m=u.container;Object.defineProperty(m,"offsetWidth",{configurable:!0,get:function(){return l.width}}),Object.defineProperty(m,"clientWidth",{configurable:!0,get:function(){return l.width}}),Object.defineProperty(m,"offsetHeight",{configurable:!0,get:function(){return l.height}}),Object.defineProperty(m,"clientHeight",{configurable:!0,get:function(){return l.height}});var y=this._map.getCanvas();y&&(y.style.outline="none"),this._updateMapViewport({},i),this._updateMapSize({},i),this.props=i}},{key:"_update",value:function(i,l){if(this._map){l=Object.assign({},this.props,l),pb(l,"Mapbox");var u=this._updateMapViewport(i,l),m=this._updateMapSize(i,l);this._updateMapStyle(i,l),!l.asyncRender&&(u||m)&&this.redraw(),this.props=l}}},{key:"_updateMapStyle",value:function(i,l){var u=i.mapStyle!==l.mapStyle;u&&this._map.setStyle(gg(l.mapStyle),{diff:!l.preventStyleDiffing})}},{key:"_updateMapSize",value:function(i,l){var u=i.width!==l.width||i.height!==l.height;return u&&(this.width=l.width,this.height=l.height,this._map.resize()),u}},{key:"_updateMapViewport",value:function(i,l){var u=this._getViewState(i),m=this._getViewState(l),y=m.latitude!==u.latitude||m.longitude!==u.longitude||m.zoom!==u.zoom||m.pitch!==u.pitch||m.bearing!==u.bearing||m.altitude!==u.altitude;return y&&(this._map.jumpTo(this._viewStateToMapboxProps(m)),m.altitude!==u.altitude&&(this._map.transform.altitude=m.altitude)),y}},{key:"_getViewState",value:function(i){var l=i.viewState||i,u=l.longitude,m=l.latitude,y=l.zoom,T=l.pitch,a=T===void 0?0:T,P=l.bearing,D=P===void 0?0:P,N=l.altitude,F=N===void 0?1.5:N;return{longitude:u,latitude:m,zoom:y,pitch:a,bearing:D,altitude:F}}},{key:"_checkStyleSheet",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"0.47.0";if(!(typeof vo>"u"))try{var l=vo.createElement("div");l.className="mapboxgl-map",l.style.display="none",vo.body.appendChild(l);var u=window.getComputedStyle(l).position!=="static";if(!u){var m=vo.createElement("link");m.setAttribute("rel","stylesheet"),m.setAttribute("type","text/css"),m.setAttribute("href","https://api.tiles.mapbox.com/mapbox-gl-js/v".concat(i,"/mapbox-gl.css")),vo.head.appendChild(m)}}catch{}}},{key:"_viewStateToMapboxProps",value:function(i){return{center:[i.longitude,i.latitude],zoom:i.zoom,bearing:i.bearing,pitch:i.pitch}}}]),r}();j(ml,"initialized",!1);j(ml,"propTypes",Yw);j(ml,"defaultProps",jd);j(ml,"savedMap",null);var Kw={exports:{}};(function(r,e){var i=[];(function(l,u){r.exports=u()})(kS,function(){var l,u,m;function y(a,P){if(!l)l=P;else if(!u)u=P;else{var D="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+l+")(sharedChunk); ("+u+")(sharedChunk); self.onerror = null;",N={};l(N),m=P(N),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(m.workerUrl=window.URL.createObjectURL(new Blob([D],{type:"text/javascript"})))}}y(["exports"],function(a){var P=typeof self<"u"?self:{},D=N;function N(n,t,s,c){this.cx=3*n,this.bx=3*(s-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(c-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=c,this.p2x=s,this.p2y=c}N.prototype.sampleCurveX=function(n){return((this.ax*n+this.bx)*n+this.cx)*n},N.prototype.sampleCurveY=function(n){return((this.ay*n+this.by)*n+this.cy)*n},N.prototype.sampleCurveDerivativeX=function(n){return(3*this.ax*n+2*this.bx)*n+this.cx},N.prototype.solveCurveX=function(n,t){var s,c,f,p,_;for(t===void 0&&(t=1e-6),f=n,_=0;_<8;_++){if(p=this.sampleCurveX(f)-n,Math.abs(p)<t)return f;var v=this.sampleCurveDerivativeX(f);if(Math.abs(v)<1e-6)break;f-=p/v}if((f=n)<(s=0))return s;if(f>(c=1))return c;for(;s<c;){if(p=this.sampleCurveX(f),Math.abs(p-n)<t)return f;n>p?s=f:c=f,f=.5*(c-s)+s}return f},N.prototype.solve=function(n,t){return this.sampleCurveY(this.solveCurveX(n,t))};var F=W;function W(n,t){this.x=n,this.y=t}W.prototype={clone:function(){return new W(this.x,this.y)},add:function(n){return this.clone()._add(n)},sub:function(n){return this.clone()._sub(n)},multByPoint:function(n){return this.clone()._multByPoint(n)},divByPoint:function(n){return this.clone()._divByPoint(n)},mult:function(n){return this.clone()._mult(n)},div:function(n){return this.clone()._div(n)},rotate:function(n){return this.clone()._rotate(n)},rotateAround:function(n,t){return this.clone()._rotateAround(n,t)},matMult:function(n){return this.clone()._matMult(n)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(n){return this.x===n.x&&this.y===n.y},dist:function(n){return Math.sqrt(this.distSqr(n))},distSqr:function(n){var t=n.x-this.x,s=n.y-this.y;return t*t+s*s},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(n){return Math.atan2(this.y-n.y,this.x-n.x)},angleWith:function(n){return this.angleWithSep(n.x,n.y)},angleWithSep:function(n,t){return Math.atan2(this.x*t-this.y*n,this.x*n+this.y*t)},_matMult:function(n){var t=n[2]*this.x+n[3]*this.y;return this.x=n[0]*this.x+n[1]*this.y,this.y=t,this},_add:function(n){return this.x+=n.x,this.y+=n.y,this},_sub:function(n){return this.x-=n.x,this.y-=n.y,this},_mult:function(n){return this.x*=n,this.y*=n,this},_div:function(n){return this.x/=n,this.y/=n,this},_multByPoint:function(n){return this.x*=n.x,this.y*=n.y,this},_divByPoint:function(n){return this.x/=n.x,this.y/=n.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var n=this.y;return this.y=this.x,this.x=-n,this},_rotate:function(n){var t=Math.cos(n),s=Math.sin(n),c=s*this.x+t*this.y;return this.x=t*this.x-s*this.y,this.y=c,this},_rotateAround:function(n,t){var s=Math.cos(n),c=Math.sin(n),f=t.y+c*(this.x-t.x)+s*(this.y-t.y);return this.x=t.x+s*(this.x-t.x)-c*(this.y-t.y),this.y=f,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},W.convert=function(n){return n instanceof W?n:Array.isArray(n)?new W(n[0],n[1]):n};const oe=Math.PI/180,me=180/Math.PI;function fe(n){return n*oe}function Ee(n){return n*me}const Ce=[[0,0],[1,0],[1,1],[0,1]];function ke(n){if(n<=0)return 0;if(n>=1)return 1;const t=n*n,s=t*n;return 4*(n<.5?s:3*(n-t)+s-.75)}function $e(n,t,s,c){const f=new D(n,t,s,c);return function(p){return f.solve(p)}}const Ve=$e(.25,.1,.25,1);function Re(n,t,s){return Math.min(s,Math.max(t,n))}function ot(n,t,s){return(s=Re((s-n)/(t-n),0,1))*s*(3-2*s)}function bt(n,t,s){const c=s-t,f=((n-t)%c+c)%c+t;return f===t?s:f}function mt(n,t,s){if(!n.length)return s(null,[]);let c=n.length;const f=new Array(n.length);let p=null;n.forEach((_,v)=>{t(_,(w,E)=>{w&&(p=w),f[v]=E,--c==0&&s(p,f)})})}function Mt(n){const t=[];for(const s in n)t.push(n[s]);return t}function gt(n,...t){for(const s of t)for(const c in s)n[c]=s[c];return n}let Ht=1;function Xt(){return Ht++}function jt(){return function n(t){return t?(t^Math.random()*(16>>t/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,n)}()}function Ki(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function $n(n){return!!n&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(n)}function Or(n,t){n.forEach(s=>{t[s]&&(t[s]=t[s].bind(t))})}function ds(n,t){return n.indexOf(t,n.length-t.length)!==-1}function Zr(n,t,s){const c={};for(const f in n)c[f]=t.call(this,n[f],f,n);return c}function Wn(n,t,s){const c={};for(const f in n)t.call(s||this,n[f],f,n)&&(c[f]=n[f]);return c}function Dr(n){return Array.isArray(n)?n.map(Dr):typeof n=="object"&&n?Zr(n,Dr):n}const hn={};function Ci(n){hn[n]||(typeof console<"u"&&console.warn(n),hn[n]=!0)}function $i(n,t,s){return(s.y-n.y)*(t.x-n.x)>(t.y-n.y)*(s.x-n.x)}function fn(n){let t=0;for(let s,c,f=0,p=n.length,_=p-1;f<p;_=f++)s=n[f],c=n[_],t+=(c.x-s.x)*(s.y+c.y);return t}function wr(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Li(n){const t={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(s,c,f,p)=>{const _=f||p;return t[c]=!_||_.toLowerCase(),""}),t["max-age"]){const s=parseInt(t["max-age"],10);isNaN(s)?delete t["max-age"]:t["max-age"]=s}return t}let rr=null;function yi(n){if(rr==null){const t=n.navigator?n.navigator.userAgent:null;rr=!!n.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return rr}function Wi(n){try{const t=P[n];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch{return!1}}function zr(n,t){return[n[4*t],n[4*t+1],n[4*t+2],n[4*t+3]]}const Cn=P.performance;function $r(n){const t=n?n.url.toString():void 0;return Cn.getEntriesByName(t)}var Wr="2.10.0";let $t,qi,Tr,qr;const Er={now:()=>Tr!==void 0?Tr:P.performance.now(),setNow(n){Tr=n},restoreNow(){Tr=void 0},frame(n){const t=P.requestAnimationFrame(n);return{cancel:()=>P.cancelAnimationFrame(t)}},getImageData(n,t=0){const{width:s,height:c}=n;qr||(qr=P.document.createElement("canvas"));const f=qr.getContext("2d");if(!f)throw new Error("failed to create canvas 2d context");return(s>qr.width||c>qr.height)&&(qr.width=s,qr.height=c),f.clearRect(-t,-t,s+2*t,c+2*t),f.drawImage(n,0,0,s,c),f.getImageData(-t,-t,s+2*t,c+2*t)},resolveURL:n=>($t||($t=P.document.createElement("a")),$t.href=n,$t.href),get devicePixelRatio(){return P.devicePixelRatio},get prefersReducedMotion(){return!!P.matchMedia&&(qi==null&&(qi=P.matchMedia("(prefers-reduced-motion: reduce)")),qi.matches)}};let dn;const Dt={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(dn==null){const n=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{dn=i.API_URL_REGEX!=null?new RegExp(i.API_URL_REGEX):n}catch{dn=n}}return dn},get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},Ln={supported:!1,testSupport:function(n){!qn&&mn&&(ps?ms(n):pn=n)}};let pn,mn,qn=!1,ps=!1;function ms(n){const t=n.createTexture();n.bindTexture(n.TEXTURE_2D,t);try{if(n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,mn),n.isContextLost())return;Ln.supported=!0}catch{}n.deleteTexture(t),qn=!0}P.document&&(mn=P.document.createElement("img"),mn.onload=function(){pn&&ms(pn),pn=null,ps=!0},mn.onerror=function(){qn=!0,pn=null},mn.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const gs="01",dr="NO_ACCESS_TOKEN";function Xr(n){return n.indexOf("mapbox:")===0}function tn(n){return Dt.API_URL_REGEX.test(n)}const _s=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Sr(n){const t=n.match(_s);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function gn(n){const t=n.params.length?`?${n.params.join("&")}`:"";return`${n.protocol}://${n.authority}${n.path}${t}`}function Ao(n){if(!n)return null;const t=n.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(decodeURIComponent(P.atob(t[1]).split("").map(s=>"%"+("00"+s.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Gs{constructor(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const s=Ao(Dt.ACCESS_TOKEN);let c="";return c=s&&s.u?P.btoa(encodeURIComponent(s.u).replace(/%([0-9A-F]{2})/g,(f,p)=>String.fromCharCode(+("0x"+p)))):Dt.ACCESS_TOKEN||"",t?`mapbox.eventData.${t}:${c}`:`mapbox.eventData:${c}`}fetchEventData(){const t=Wi("localStorage"),s=this.getStorageKey(),c=this.getStorageKey("uuid");if(t)try{const f=P.localStorage.getItem(s);f&&(this.eventData=JSON.parse(f));const p=P.localStorage.getItem(c);p&&(this.anonId=p)}catch{Ci("Unable to read from LocalStorage")}}saveEventData(){const t=Wi("localStorage"),s=this.getStorageKey(),c=this.getStorageKey("uuid");if(t)try{P.localStorage.setItem(c,this.anonId),Object.keys(this.eventData).length>=1&&P.localStorage.setItem(s,JSON.stringify(this.eventData))}catch{Ci("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,s,c,f){if(!Dt.EVENTS_URL)return;const p=Sr(Dt.EVENTS_URL);p.params.push(`access_token=${f||Dt.ACCESS_TOKEN||""}`);const _={event:this.type,created:new Date(t).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:Wr,skuId:gs,userId:this.anonId},v=s?gt(_,s):_,w={url:gn(p),headers:{"Content-Type":"text/plain"},body:JSON.stringify([v])};this.pendingRequest=Xe(w,E=>{this.pendingRequest=null,c(E),this.saveEventData(),this.processRequests(f)})}queueRequest(t,s){this.queue.push(t),this.processRequests(s)}}const Zs=new class extends Gs{constructor(n){super("appUserTurnstile"),this._customAccessToken=n}postTurnstileEvent(n,t){Dt.EVENTS_URL&&Dt.ACCESS_TOKEN&&Array.isArray(n)&&n.some(s=>Xr(s)||tn(s))&&this.queueRequest(Date.now(),t)}processRequests(n){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=Ao(Dt.ACCESS_TOKEN),s=t?t.u:Dt.ACCESS_TOKEN;let c=s!==this.eventData.tokenU;$n(this.anonId)||(this.anonId=jt(),c=!0);const f=this.queue.shift();if(this.eventData.lastSuccess){const p=new Date(this.eventData.lastSuccess),_=new Date(f),v=(f-this.eventData.lastSuccess)/864e5;c=c||v>=1||v<-1||p.getDate()!==_.getDate()}else c=!0;c?this.postEvent(f,{"enabled.telemetry":!1},p=>{p||(this.eventData.lastSuccess=f,this.eventData.tokenU=s)},n):this.processRequests()}},kn=Zs.postTurnstileEvent.bind(Zs),$s=new class extends Gs{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(n,t,s,c){this.skuToken=t,this.errorCb=c,Dt.EVENTS_URL&&(s||Dt.ACCESS_TOKEN?this.queueRequest({id:n,timestamp:Date.now()},s):this.errorCb(new Error(dr)))}processRequests(n){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:s}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),$n(this.anonId)||(this.anonId=jt()),this.postEvent(s,{skuToken:this.skuToken},c=>{c?this.errorCb(c):t&&(this.success[t]=!0)},n))}},Mo=$s.postMapLoadEvent.bind($s),Ws=new class extends Gs{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(n,t,s,c){if(!Dt.API_URL||!Dt.SESSION_PATH)return;const f=Sr(Dt.API_URL+Dt.SESSION_PATH);f.params.push(`sku=${t||""}`),f.params.push(`access_token=${c||Dt.ACCESS_TOKEN||""}`);const p={url:gn(f),headers:{"Content-Type":"text/plain"}};this.pendingRequest=lt(p,_=>{this.pendingRequest=null,s(_),this.saveEventData(),this.processRequests(c)})}getSessionAPI(n,t,s,c){this.skuToken=t,this.errorCb=c,Dt.SESSION_PATH&&Dt.API_URL&&(s||Dt.ACCESS_TOKEN?this.queueRequest({id:n,timestamp:Date.now()},s):this.errorCb(new Error(dr)))}processRequests(n){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:s}=this.queue.shift();t&&this.success[t]||this.getSession(s,this.skuToken,c=>{c?this.errorCb(c):t&&(this.success[t]=!0)},n)}},Po=Ws.getSessionAPI.bind(Ws),rn=new Set;let _n,ys=500,Io=50,nr={};function qs(n){const t=V(n);let s,c;t&&t.forEach(p=>{const _=p.split("=");_[0]==="language"?s=_[1]:_[0]==="worldview"&&(c=_[1])});let f="mapbox-tiles";return s&&(f+=`-${s}`),c&&(f+=`-${c}`),f}function ie(){try{return P.caches}catch{}}function B(n){const t=ie();t&&!nr[n]&&(nr[n]=t.open(n))}function V(n){const t=n.indexOf("?");return t>0?n.slice(t+1).split("&"):[]}function te(n){const t=n.indexOf("?");if(t<0)return n;const s=V(n).filter(c=>{const f=c.split("=");return f[0]==="language"||f[0]==="worldview"});return s.length?`${n.slice(0,t)}?${s.join("&")}`:n.slice(0,t)}let ae=1/0;const ye={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(ye);class Se extends Error{constructor(t,s,c){s===401&&tn(c)&&(t+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(t),this.status=s,this.url=c}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Te=wr()?()=>self.worker&&self.worker.referrer:()=>(P.location.protocol==="blob:"?P.parent:P).location.href,be=function(n,t){if(!(/^file:/.test(s=n.url)||/^file:/.test(Te())&&!/^\w+:/.test(s))){if(P.fetch&&P.Request&&P.AbortController&&P.Request.prototype.hasOwnProperty("signal"))return function(c,f){const p=new P.AbortController,_=new P.Request(c.url,{method:c.method||"GET",body:c.body,credentials:c.credentials,headers:c.headers,referrer:Te(),signal:p.signal});let v=!1,w=!1;const E=(M=_.url).indexOf("sku=")>0&&tn(M);var M;c.type==="json"&&_.headers.set("Accept","application/json");const C=(O,z,G)=>{if(w)return;if(O&&O.message!=="SecurityError"&&Ci(O),z&&G)return L(z);const q=Date.now();P.fetch(_).then(re=>{if(re.ok){const he=E?re.clone():null;return L(re,he,q)}return f(new Se(re.statusText,re.status,c.url))}).catch(re=>{re.code!==20&&f(new Error(re.message))})},L=(O,z,G)=>{(c.type==="arrayBuffer"?O.arrayBuffer():c.type==="json"?O.json():O.text()).then(q=>{w||(z&&G&&function(re,he,se){const le=qs(re.url);if(B(le),!nr[le])return;const xe={status:he.status,statusText:he.statusText,headers:new P.Headers};he.headers.forEach((Le,Ne)=>xe.headers.set(Ne,Le));const de=Li(he.headers.get("Cache-Control")||"");if(de["no-store"])return;de["max-age"]&&xe.headers.set("Expires",new Date(se+1e3*de["max-age"]).toUTCString());const Oe=xe.headers.get("Expires");Oe&&(new Date(Oe).getTime()-se<42e4||function(Le,Ne){if(_n===void 0)try{new Response(new ReadableStream),_n=!0}catch{_n=!1}_n?Ne(Le.body):Le.blob().then(Ne)}(he,Le=>{const Ne=new P.Response(Le,xe);B(le),nr[le]&&nr[le].then(it=>it.put(te(re.url),Ne)).catch(it=>Ci(it.message))}))}(_,z,G),v=!0,f(null,q,O.headers.get("Cache-Control"),O.headers.get("Expires")))}).catch(q=>{w||f(new Error(q.message))})};return E?function(O,z){const G=qs(O.url);if(B(G),!nr[G])return z(null);const q=te(O.url);nr[G].then(re=>{re.match(q).then(he=>{const se=function(le){if(!le)return!1;const xe=new Date(le.headers.get("Expires")||0),de=Li(le.headers.get("Cache-Control")||"");return xe>Date.now()&&!de["no-cache"]}(he);re.delete(q),se&&re.put(q,he.clone()),z(null,he,se)}).catch(z)}).catch(z)}(_,C):C(null,null),{cancel:()=>{w=!0,v||p.abort()}}}(n,t);if(wr()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",n,t,void 0,!0)}var s;return function(c,f){const p=new P.XMLHttpRequest;p.open(c.method||"GET",c.url,!0),c.type==="arrayBuffer"&&(p.responseType="arraybuffer");for(const _ in c.headers)p.setRequestHeader(_,c.headers[_]);return c.type==="json"&&(p.responseType="text",p.setRequestHeader("Accept","application/json")),p.withCredentials=c.credentials==="include",p.onerror=()=>{f(new Error(p.statusText))},p.onload=()=>{if((p.status>=200&&p.status<300||p.status===0)&&p.response!==null){let _=p.response;if(c.type==="json")try{_=JSON.parse(p.response)}catch(v){return f(v)}f(null,_,p.getResponseHeader("Cache-Control"),p.getResponseHeader("Expires"))}else f(new Se(p.statusText,p.status,c.url))},p.send(c.body),{cancel:()=>p.abort()}}(n,t)},Me=function(n,t){return be(gt(n,{type:"arrayBuffer"}),t)},Xe=function(n,t){return be(gt(n,{method:"POST"}),t)},lt=function(n,t){return be(gt(n,{method:"GET"}),t)};function Ke(n){const t=P.document.createElement("a");return t.href=n,t.protocol===P.document.location.protocol&&t.host===P.document.location.host}const Tt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Et,_t;Et=[],_t=0;const Pt=function(n,t){if(Ln.supported&&(n.headers||(n.headers={}),n.headers.accept="image/webp,*/*"),_t>=Dt.MAX_PARALLEL_IMAGE_REQUESTS){const p={requestParameters:n,callback:t,cancelled:!1,cancel(){this.cancelled=!0}};return Et.push(p),p}_t++;let s=!1;const c=()=>{if(!s)for(s=!0,_t--;Et.length&&_t<Dt.MAX_PARALLEL_IMAGE_REQUESTS;){const p=Et.shift(),{requestParameters:_,callback:v,cancelled:w}=p;w||(p.cancel=Pt(_,v).cancel)}},f=Me(n,(p,_,v,w)=>{c(),p?t(p):_&&(P.createImageBitmap?function(E,M){const C=new P.Blob([new Uint8Array(E)],{type:"image/png"});P.createImageBitmap(C).then(L=>{M(null,L)}).catch(L=>{M(new Error(`Could not load image because of ${L.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(_,(E,M)=>t(E,M,v,w)):function(E,M){const C=new P.Image,L=P.URL;C.onload=()=>{M(null,C),L.revokeObjectURL(C.src),C.onload=null,P.requestAnimationFrame(()=>{C.src=Tt})},C.onerror=()=>M(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const O=new P.Blob([new Uint8Array(E)],{type:"image/png"});C.src=E.byteLength?L.createObjectURL(O):Tt}(_,(E,M)=>t(E,M,v,w)))});return{cancel:()=>{f.cancel(),c()}}};function Bt(n,t,s){s[n]&&s[n].indexOf(t)!==-1||(s[n]=s[n]||[],s[n].push(t))}function Jt(n,t,s){if(s&&s[n]){const c=s[n].indexOf(t);c!==-1&&s[n].splice(c,1)}}class ri{constructor(t,s={}){gt(this,s),this.type=t}}class ni extends ri{constructor(t,s={}){super("error",gt({error:t},s))}}class St{on(t,s){return this._listeners=this._listeners||{},Bt(t,s,this._listeners),this}off(t,s){return Jt(t,s,this._listeners),Jt(t,s,this._oneTimeListeners),this}once(t,s){return s?(this._oneTimeListeners=this._oneTimeListeners||{},Bt(t,s,this._oneTimeListeners),this):new Promise(c=>this.once(t,c))}fire(t,s){typeof t=="string"&&(t=new ri(t,s||{}));const c=t.type;if(this.listens(c)){t.target=this;const f=this._listeners&&this._listeners[c]?this._listeners[c].slice():[];for(const v of f)v.call(this,t);const p=this._oneTimeListeners&&this._oneTimeListeners[c]?this._oneTimeListeners[c].slice():[];for(const v of p)Jt(c,v,this._oneTimeListeners),v.call(this,t);const _=this._eventedParent;_&&(gt(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),_.fire(t))}else t instanceof ni&&console.error(t.error);return this}listens(t){return!!(this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t))}setEventedParent(t,s){return this._eventedParent=t,this._eventedParentData=s,this}}var Fe=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Ei(n,...t){for(const s of t)for(const c in s)n[c]=s[c];return n}function ci(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function sr(n){if(Array.isArray(n))return n.map(sr);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){const t={};for(const s in n)t[s]=sr(n[s]);return t}return ci(n)}class Br extends Error{constructor(t,s){super(s),this.message=s,this.key=t}}var or=Br;class Ar{constructor(t,s=[]){this.parent=t,this.bindings={};for(const[c,f]of s)this.bindings[c]=f}concat(t){return new Ar(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}var yn=Ar;const Xn={kind:"null"},ct={kind:"number"},Nt={kind:"string"},Lt={kind:"boolean"},pr={kind:"color"},Mr={kind:"object"},zt={kind:"value"},Hn={kind:"collator"},Yn={kind:"formatted"},Rn={kind:"resolvedImage"};function Ni(n,t){return{kind:"array",itemType:n,N:t}}function vi(n){if(n.kind==="array"){const t=vi(n.itemType);return typeof n.N=="number"?`array<${t}, ${n.N}>`:n.itemType.kind==="value"?"array":`array<${t}>`}return n.kind}const _a=[Xn,ct,Nt,Lt,pr,Yn,Mr,Ni(zt),Rn];function On(n,t){if(t.kind==="error")return null;if(n.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!On(n.itemType,t.itemType))&&(typeof n.N!="number"||n.N===t.N))return null}else{if(n.kind===t.kind)return null;if(n.kind==="value"){for(const s of _a)if(!On(s,t))return null}}return`Expected ${vi(n)} but found ${vi(t)} instead.`}function Xs(n,t){return t.some(s=>s.kind===n.kind)}function Dn(n,t){return t.some(s=>s==="null"?n===null:s==="array"?Array.isArray(n):s==="object"?n&&!Array.isArray(n)&&typeof n=="object":s===typeof n)}function ya(n){var t={exports:{}};return n(t,t.exports),t.exports}var $=ya(function(n,t){var s={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function c(v){return(v=Math.round(v))<0?0:v>255?255:v}function f(v){return c(v[v.length-1]==="%"?parseFloat(v)/100*255:parseInt(v))}function p(v){return(w=v[v.length-1]==="%"?parseFloat(v)/100:parseFloat(v))<0?0:w>1?1:w;var w}function _(v,w,E){return E<0?E+=1:E>1&&(E-=1),6*E<1?v+(w-v)*E*6:2*E<1?w:3*E<2?v+(w-v)*(2/3-E)*6:v}try{t.parseCSSColor=function(v){var w,E=v.replace(/ /g,"").toLowerCase();if(E in s)return s[E].slice();if(E[0]==="#")return E.length===4?(w=parseInt(E.substr(1),16))>=0&&w<=4095?[(3840&w)>>4|(3840&w)>>8,240&w|(240&w)>>4,15&w|(15&w)<<4,1]:null:E.length===7&&(w=parseInt(E.substr(1),16))>=0&&w<=16777215?[(16711680&w)>>16,(65280&w)>>8,255&w,1]:null;var M=E.indexOf("("),C=E.indexOf(")");if(M!==-1&&C+1===E.length){var L=E.substr(0,M),O=E.substr(M+1,C-(M+1)).split(","),z=1;switch(L){case"rgba":if(O.length!==4)return null;z=p(O.pop());case"rgb":return O.length!==3?null:[f(O[0]),f(O[1]),f(O[2]),z];case"hsla":if(O.length!==4)return null;z=p(O.pop());case"hsl":if(O.length!==3)return null;var G=(parseFloat(O[0])%360+360)%360/360,q=p(O[1]),re=p(O[2]),he=re<=.5?re*(q+1):re+q-re*q,se=2*re-he;return[c(255*_(se,he,G+1/3)),c(255*_(se,he,G)),c(255*_(se,he,G-1/3)),z];default:return null}}return null}}catch{}});class Q{constructor(t,s,c,f=1){this.r=t,this.g=s,this.b=c,this.a=f}static parse(t){if(!t)return;if(t instanceof Q)return t;if(typeof t!="string")return;const s=$.parseCSSColor(t);return s?new Q(s[0]/255*s[3],s[1]/255*s[3],s[2]/255*s[3],s[3]):void 0}toString(){const[t,s,c,f]=this.toArray();return`rgba(${Math.round(t)},${Math.round(s)},${Math.round(c)},${f})`}toArray(){const{r:t,g:s,b:c,a:f}=this;return f===0?[0,0,0,0]:[255*t/f,255*s/f,255*c/f,f]}toArray01(){const{r:t,g:s,b:c,a:f}=this;return f===0?[0,0,0,0]:[t/f,s/f,c/f,f]}toArray01PremultipliedAlpha(){const{r:t,g:s,b:c,a:f}=this;return[t,s,c,f]}}Q.black=new Q(0,0,0,1),Q.white=new Q(1,1,1,1),Q.transparent=new Q(0,0,0,0),Q.red=new Q(1,0,0,1),Q.blue=new Q(0,0,1,1);var ce=Q;class De{constructor(t,s,c){this.sensitivity=t?s?"variant":"case":s?"accent":"base",this.locale=c,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,s){return this.collator.compare(t,s)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class tt{constructor(t,s,c,f,p){this.text=t.normalize?t.normalize():t,this.image=s,this.scale=c,this.fontStack=f,this.textColor=p}}class dt{constructor(t){this.sections=t}static fromString(t){return new dt([new tt(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.name.length!==0)}static factory(t){return t instanceof dt?t:dt.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}serialize(){const t=["format"];for(const s of this.sections){if(s.image){t.push(["image",s.image.name]);continue}t.push(s.text);const c={};s.fontStack&&(c["text-font"]=["literal",s.fontStack.split(",")]),s.scale&&(c["font-scale"]=s.scale),s.textColor&&(c["text-color"]=["rgba"].concat(s.textColor.toArray())),t.push(c)}return t}}class Rt{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new Rt({name:t,available:!1}):null}serialize(){return["image",this.name]}}function Ui(n,t,s,c){return typeof n=="number"&&n>=0&&n<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof s=="number"&&s>=0&&s<=255?c===void 0||typeof c=="number"&&c>=0&&c<=1?null:`Invalid rgba value [${[n,t,s,c].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof c=="number"?[n,t,s,c]:[n,t,s]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Si(n){if(n===null||typeof n=="string"||typeof n=="boolean"||typeof n=="number"||n instanceof ce||n instanceof De||n instanceof dt||n instanceof Rt)return!0;if(Array.isArray(n)){for(const t of n)if(!Si(t))return!1;return!0}if(typeof n=="object"){for(const t in n)if(!Si(n[t]))return!1;return!0}return!1}function Kt(n){if(n===null)return Xn;if(typeof n=="string")return Nt;if(typeof n=="boolean")return Lt;if(typeof n=="number")return ct;if(n instanceof ce)return pr;if(n instanceof De)return Hn;if(n instanceof dt)return Yn;if(n instanceof Rt)return Rn;if(Array.isArray(n)){const t=n.length;let s;for(const c of n){const f=Kt(c);if(s){if(s===f)continue;s=zt;break}s=f}return Ni(s||zt,t)}return Mr}function mr(n){const t=typeof n;return n===null?"":t==="string"||t==="number"||t==="boolean"?String(n):n instanceof ce||n instanceof dt||n instanceof Rt?n.toString():JSON.stringify(n)}class Nc{constructor(t,s){this.type=t,this.value=s}static parse(t,s){if(t.length!==2)return s.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!Si(t[1]))return s.error("invalid value");const c=t[1];let f=Kt(c);const p=s.expectedType;return f.kind!=="array"||f.N!==0||!p||p.kind!=="array"||typeof p.N=="number"&&p.N!==0||(f=p),new Nc(f,c)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof ce?["rgba"].concat(this.value.toArray()):this.value instanceof dt?this.value.serialize():this.value}}var va=Nc,Ji=class{constructor(n){this.name="ExpressionEvaluationError",this.message=n}toJSON(){return this.message}};const xa={string:Nt,number:ct,boolean:Lt,object:Mr};class Uc{constructor(t,s){this.type=t,this.args=s}static parse(t,s){if(t.length<2)return s.error("Expected at least one argument.");let c,f=1;const p=t[0];if(p==="array"){let v,w;if(t.length>2){const E=t[1];if(typeof E!="string"||!(E in xa)||E==="object")return s.error('The item type argument of "array" must be one of string, number, boolean',1);v=xa[E],f++}else v=zt;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return s.error('The length argument to "array" must be a positive integer literal',2);w=t[2],f++}c=Ni(v,w)}else c=xa[p];const _=[];for(;f<t.length;f++){const v=s.parse(t[f],f,zt);if(!v)return null;_.push(v)}return new Uc(c,_)}evaluate(t){for(let s=0;s<this.args.length;s++){const c=this.args[s].evaluate(t);if(!On(this.type,Kt(c)))return c;if(s===this.args.length-1)throw new Ji(`Expected value to be of type ${vi(this.type)}, but found ${vi(Kt(c))} instead.`)}return null}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=this.type,s=[t.kind];if(t.kind==="array"){const c=t.itemType;if(c.kind==="string"||c.kind==="number"||c.kind==="boolean"){s.push(c.kind);const f=t.N;(typeof f=="number"||this.args.length>1)&&s.push(f)}}return s.concat(this.args.map(c=>c.serialize()))}}var nn=Uc;class ba{constructor(t){this.type=Yn,this.sections=t}static parse(t,s){if(t.length<2)return s.error("Expected at least one argument.");const c=t[1];if(!Array.isArray(c)&&typeof c=="object")return s.error("First argument must be an image or text section.");const f=[];let p=!1;for(let _=1;_<=t.length-1;++_){const v=t[_];if(p&&typeof v=="object"&&!Array.isArray(v)){p=!1;let w=null;if(v["font-scale"]&&(w=s.parse(v["font-scale"],1,ct),!w))return null;let E=null;if(v["text-font"]&&(E=s.parse(v["text-font"],1,Ni(Nt)),!E))return null;let M=null;if(v["text-color"]&&(M=s.parse(v["text-color"],1,pr),!M))return null;const C=f[f.length-1];C.scale=w,C.font=E,C.textColor=M}else{const w=s.parse(t[_],1,zt);if(!w)return null;const E=w.type.kind;if(E!=="string"&&E!=="value"&&E!=="null"&&E!=="resolvedImage")return s.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");p=!0,f.push({content:w,scale:null,font:null,textColor:null})}}return new ba(f)}evaluate(t){return new dt(this.sections.map(s=>{const c=s.content.evaluate(t);return Kt(c)===Rn?new tt("",c,null,null,null):new tt(mr(c),null,s.scale?s.scale.evaluate(t):null,s.font?s.font.evaluate(t).join(","):null,s.textColor?s.textColor.evaluate(t):null)}))}eachChild(t){for(const s of this.sections)t(s.content),s.scale&&t(s.scale),s.font&&t(s.font),s.textColor&&t(s.textColor)}outputDefined(){return!1}serialize(){const t=["format"];for(const s of this.sections){t.push(s.content.serialize());const c={};s.scale&&(c["font-scale"]=s.scale.serialize()),s.font&&(c["text-font"]=s.font.serialize()),s.textColor&&(c["text-color"]=s.textColor.serialize()),t.push(c)}return t}}class gl{constructor(t){this.type=Rn,this.input=t}static parse(t,s){if(t.length!==2)return s.error("Expected two arguments.");const c=s.parse(t[1],1,Nt);return c?new gl(c):s.error("No image name provided.")}evaluate(t){const s=this.input.evaluate(t),c=Rt.fromString(s);return c&&t.availableImages&&(c.available=t.availableImages.indexOf(s)>-1),c}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const _p={"to-boolean":Lt,"to-color":pr,"to-number":ct,"to-string":Nt};class jc{constructor(t,s){this.type=t,this.args=s}static parse(t,s){if(t.length<2)return s.error("Expected at least one argument.");const c=t[0];if((c==="to-boolean"||c==="to-string")&&t.length!==2)return s.error("Expected one argument.");const f=_p[c],p=[];for(let _=1;_<t.length;_++){const v=s.parse(t[_],_,zt);if(!v)return null;p.push(v)}return new jc(f,p)}evaluate(t){if(this.type.kind==="boolean")return!!this.args[0].evaluate(t);if(this.type.kind==="color"){let s,c;for(const f of this.args){if(s=f.evaluate(t),c=null,s instanceof ce)return s;if(typeof s=="string"){const p=t.parseColor(s);if(p)return p}else if(Array.isArray(s)&&(c=s.length<3||s.length>4?`Invalid rbga value ${JSON.stringify(s)}: expected an array containing either three or four numeric values.`:Ui(s[0],s[1],s[2],s[3]),!c))return new ce(s[0]/255,s[1]/255,s[2]/255,s[3])}throw new Ji(c||`Could not parse color from value '${typeof s=="string"?s:String(JSON.stringify(s))}'`)}if(this.type.kind==="number"){let s=null;for(const c of this.args){if(s=c.evaluate(t),s===null)return 0;const f=Number(s);if(!isNaN(f))return f}throw new Ji(`Could not convert ${JSON.stringify(s)} to number.`)}return this.type.kind==="formatted"?dt.fromString(mr(this.args[0].evaluate(t))):this.type.kind==="resolvedImage"?Rt.fromString(mr(this.args[0].evaluate(t))):mr(this.args[0].evaluate(t))}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){if(this.type.kind==="formatted")return new ba([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new gl(this.args[0]).serialize();const t=[`to-${this.type.kind}`];return this.eachChild(s=>{t.push(s.serialize())}),t}}var Co=jc;const yp=["Unknown","Point","LineString","Polygon"];var Zh=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?yp[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const n=this.featureDistanceData.center,t=this.featureDistanceData.scale,{x:s,y:c}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(s*t-n[0])+this.featureDistanceData.bearing[1]*(c*t-n[1])}return 0}parseColor(n){let t=this._parseColorCache[n];return t||(t=this._parseColorCache[n]=ce.parse(n)),t}};class Hs{constructor(t,s,c,f){this.name=t,this.type=s,this._evaluate=c,this.args=f}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(t=>t.serialize()))}static parse(t,s){const c=t[0],f=Hs.definitions[c];if(!f)return s.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0);const p=Array.isArray(f)?f[0]:f.type,_=Array.isArray(f)?[[f[1],f[2]]]:f.overloads,v=_.filter(([E])=>!Array.isArray(E)||E.length===t.length-1);let w=null;for(const[E,M]of v){w=new Ks(s.registry,s.path,null,s.scope);const C=[];let L=!1;for(let O=1;O<t.length;O++){const z=t[O],G=Array.isArray(E)?E[O-1]:E.type,q=w.parse(z,1+C.length,G);if(!q){L=!0;break}C.push(q)}if(!L)if(Array.isArray(E)&&E.length!==C.length)w.error(`Expected ${E.length} arguments, but found ${C.length} instead.`);else{for(let O=0;O<C.length;O++){const z=Array.isArray(E)?E[O]:E.type,G=C[O];w.concat(O+1).checkSubtype(z,G.type)}if(w.errors.length===0)return new Hs(c,p,M,C)}}if(v.length===1)s.errors.push(...w.errors);else{const E=(v.length?v:_).map(([C])=>{return L=C,Array.isArray(L)?`(${L.map(vi).join(", ")})`:`(${vi(L.type)}...)`;var L}).join(" | "),M=[];for(let C=1;C<t.length;C++){const L=s.parse(t[C],1+M.length);if(!L)return null;M.push(vi(L.type))}s.error(`Expected arguments of type ${E}, but found (${M.join(", ")}) instead.`)}return null}static register(t,s){Hs.definitions=s;for(const c in s)t[c]=Hs}}var vn=Hs;class _l{constructor(t,s,c){this.type=Hn,this.locale=c,this.caseSensitive=t,this.diacriticSensitive=s}static parse(t,s){if(t.length!==2)return s.error("Expected one argument.");const c=t[1];if(typeof c!="object"||Array.isArray(c))return s.error("Collator options argument must be an object.");const f=s.parse(c["case-sensitive"]!==void 0&&c["case-sensitive"],1,Lt);if(!f)return null;const p=s.parse(c["diacritic-sensitive"]!==void 0&&c["diacritic-sensitive"],1,Lt);if(!p)return null;let _=null;return c.locale&&(_=s.parse(c.locale,1,Nt),!_)?null:new _l(f,p,_)}evaluate(t){return new De(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}serialize(){const t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]}}const vs=8192;function Vc(n,t){n[0]=Math.min(n[0],t[0]),n[1]=Math.min(n[1],t[1]),n[2]=Math.max(n[2],t[0]),n[3]=Math.max(n[3],t[1])}function yl(n,t){return!(n[0]<=t[0]||n[2]>=t[2]||n[1]<=t[1]||n[3]>=t[3])}function vp(n,t){const s=(180+n[0])/360,c=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,f=Math.pow(2,t.z);return[Math.round(s*f*vs),Math.round(c*f*vs)]}function xp(n,t,s){const c=n[0]-t[0],f=n[1]-t[1],p=n[0]-s[0],_=n[1]-s[1];return c*_-p*f==0&&c*p<=0&&f*_<=0}function vl(n,t){let s=!1;for(let _=0,v=t.length;_<v;_++){const w=t[_];for(let E=0,M=w.length;E<M-1;E++){if(xp(n,w[E],w[E+1]))return!1;(f=w[E])[1]>(c=n)[1]!=(p=w[E+1])[1]>c[1]&&c[0]<(p[0]-f[0])*(c[1]-f[1])/(p[1]-f[1])+f[0]&&(s=!s)}}var c,f,p;return s}function xl(n,t){for(let s=0;s<t.length;s++)if(vl(n,t[s]))return!0;return!1}function $h(n,t,s,c){const f=c[0]-s[0],p=c[1]-s[1],_=(n[0]-s[0])*p-f*(n[1]-s[1]),v=(t[0]-s[0])*p-f*(t[1]-s[1]);return _>0&&v<0||_<0&&v>0}function bp(n,t,s){for(const E of s)for(let M=0;M<E.length-1;++M)if((v=[(_=E[M+1])[0]-(p=E[M])[0],_[1]-p[1]])[0]*(w=[(f=t)[0]-(c=n)[0],f[1]-c[1]])[1]-v[1]*w[0]!=0&&$h(c,f,p,_)&&$h(p,_,c,f))return!0;var c,f,p,_,v,w;return!1}function Wh(n,t){for(let s=0;s<n.length;++s)if(!vl(n[s],t))return!1;for(let s=0;s<n.length-1;++s)if(bp(n[s],n[s+1],t))return!1;return!0}function wp(n,t){for(let s=0;s<t.length;s++)if(Wh(n,t[s]))return!0;return!1}function sn(n,t,s){const c=[];for(let f=0;f<n.length;f++){const p=[];for(let _=0;_<n[f].length;_++){const v=vp(n[f][_],s);Vc(t,v),p.push(v)}c.push(p)}return c}function Gc(n,t,s){const c=[];for(let f=0;f<n.length;f++){const p=sn(n[f],t,s);c.push(p)}return c}function Zc(n,t,s,c){if(n[0]<s[0]||n[0]>s[2]){const f=.5*c;let p=n[0]-s[0]>f?-c:s[0]-n[0]>f?c:0;p===0&&(p=n[0]-s[2]>f?-c:s[2]-n[0]>f?c:0),n[0]+=p}Vc(t,n)}function $c(n,t,s,c){const f=Math.pow(2,c.z)*vs,p=[c.x*vs,c.y*vs],_=[];if(!n)return _;for(const v of n)for(const w of v){const E=[w.x+p[0],w.y+p[1]];Zc(E,t,s,f),_.push(E)}return _}function Wc(n,t,s,c){const f=Math.pow(2,c.z)*vs,p=[c.x*vs,c.y*vs],_=[];if(!n)return _;for(const w of n){const E=[];for(const M of w){const C=[M.x+p[0],M.y+p[1]];Vc(t,C),E.push(C)}_.push(E)}if(t[2]-t[0]<=f/2){(v=t)[0]=v[1]=1/0,v[2]=v[3]=-1/0;for(const w of _)for(const E of w)Zc(E,t,s,f)}var v;return _}class Lo{constructor(t,s){this.type=Lt,this.geojson=t,this.geometries=s}static parse(t,s){if(t.length!==2)return s.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Si(t[1])){const c=t[1];if(c.type==="FeatureCollection")for(let f=0;f<c.features.length;++f){const p=c.features[f].geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new Lo(c,c.features[f].geometry)}else if(c.type==="Feature"){const f=c.geometry.type;if(f==="Polygon"||f==="MultiPolygon")return new Lo(c,c.geometry)}else if(c.type==="Polygon"||c.type==="MultiPolygon")return new Lo(c,c)}return s.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(s,c){const f=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],_=s.canonicalID();if(!_)return!1;if(c.type==="Polygon"){const v=sn(c.coordinates,p,_),w=$c(s.geometry(),f,p,_);if(!yl(f,p))return!1;for(const E of w)if(!vl(E,v))return!1}if(c.type==="MultiPolygon"){const v=Gc(c.coordinates,p,_),w=$c(s.geometry(),f,p,_);if(!yl(f,p))return!1;for(const E of w)if(!xl(E,v))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(s,c){const f=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],_=s.canonicalID();if(!_)return!1;if(c.type==="Polygon"){const v=sn(c.coordinates,p,_),w=Wc(s.geometry(),f,p,_);if(!yl(f,p))return!1;for(const E of w)if(!Wh(E,v))return!1}if(c.type==="MultiPolygon"){const v=Gc(c.coordinates,p,_),w=Wc(s.geometry(),f,p,_);if(!yl(f,p))return!1;for(const E of w)if(!wp(E,v))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var bl=Lo;function Ys(n){if(n instanceof vn&&(n.name==="get"&&n.args.length===1||n.name==="feature-state"||n.name==="has"&&n.args.length===1||n.name==="properties"||n.name==="geometry-type"||n.name==="id"||/^filter-/.test(n.name))||n instanceof bl)return!1;let t=!0;return n.eachChild(s=>{t&&!Ys(s)&&(t=!1)}),t}function xs(n){if(n instanceof vn&&n.name==="feature-state")return!1;let t=!0;return n.eachChild(s=>{t&&!xs(s)&&(t=!1)}),t}function wa(n,t){if(n instanceof vn&&t.indexOf(n.name)>=0)return!1;let s=!0;return n.eachChild(c=>{s&&!wa(c,t)&&(s=!1)}),s}class wl{constructor(t,s){this.type=s.type,this.name=t,this.boundExpression=s}static parse(t,s){if(t.length!==2||typeof t[1]!="string")return s.error("'var' expression requires exactly one string literal argument.");const c=t[1];return s.scope.has(c)?new wl(c,s.scope.get(c)):s.error(`Unknown variable "${c}". Make sure "${c}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var Tl=wl;class El{constructor(t,s=[],c,f=new yn,p=[]){this.registry=t,this.path=s,this.key=s.map(_=>`[${_}]`).join(""),this.scope=f,this.errors=p,this.expectedType=c}parse(t,s,c,f,p={}){return s?this.concat(s,c,f)._parse(t,p):this._parse(t,p)}_parse(t,s){function c(f,p,_){return _==="assert"?new nn(p,[f]):_==="coerce"?new Co(p,[f]):f}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const f=t[0];if(typeof f!="string")return this.error(`Expression name must be a string, but found ${typeof f} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const p=this.registry[f];if(p){let _=p.parse(t,this);if(!_)return null;if(this.expectedType){const v=this.expectedType,w=_.type;if(v.kind!=="string"&&v.kind!=="number"&&v.kind!=="boolean"&&v.kind!=="object"&&v.kind!=="array"||w.kind!=="value")if(v.kind!=="color"&&v.kind!=="formatted"&&v.kind!=="resolvedImage"||w.kind!=="value"&&w.kind!=="string"){if(this.checkSubtype(v,w))return null}else _=c(_,v,s.typeAnnotation||"coerce");else _=c(_,v,s.typeAnnotation||"assert")}if(!(_ instanceof va)&&_.type.kind!=="resolvedImage"&&ii(_)){const v=new Zh;try{_=new va(_.type,_.evaluate(v))}catch(w){return this.error(w.message),null}}return _}return this.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,s,c){const f=typeof t=="number"?this.path.concat(t):this.path,p=c?this.scope.concat(c):this.scope;return new El(this.registry,f,s||null,p,this.errors)}error(t,...s){const c=`${this.key}${s.map(f=>`[${f}]`).join("")}`;this.errors.push(new or(c,t))}checkSubtype(t,s){const c=On(t,s);return c&&this.error(c),c}}var Ks=El;function ii(n){if(n instanceof Tl)return ii(n.boundExpression);if(n instanceof vn&&n.name==="error"||n instanceof _l||n instanceof bl)return!1;const t=n instanceof Co||n instanceof nn;let s=!0;return n.eachChild(c=>{s=t?s&&ii(c):s&&c instanceof va}),!!s&&Ys(n)&&wa(n,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Sl(n,t){const s=n.length-1;let c,f,p=0,_=s,v=0;for(;p<=_;)if(v=Math.floor((p+_)/2),c=n[v],f=n[v+1],c<=t){if(v===s||t<f)return v;p=v+1}else{if(!(c>t))throw new Ji("Input is not a number.");_=v-1}return 0}class qc{constructor(t,s,c){this.type=t,this.input=s,this.labels=[],this.outputs=[];for(const[f,p]of c)this.labels.push(f),this.outputs.push(p)}static parse(t,s){if(t.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return s.error("Expected an even number of arguments.");const c=s.parse(t[1],1,ct);if(!c)return null;const f=[];let p=null;s.expectedType&&s.expectedType.kind!=="value"&&(p=s.expectedType);for(let _=1;_<t.length;_+=2){const v=_===1?-1/0:t[_],w=t[_+1],E=_,M=_+1;if(typeof v!="number")return s.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',E);if(f.length&&f[f.length-1][0]>=v)return s.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',E);const C=s.parse(w,M,p);if(!C)return null;p=p||C.type,f.push([v,C])}return new qc(p,c,f)}evaluate(t){const s=this.labels,c=this.outputs;if(s.length===1)return c[0].evaluate(t);const f=this.input.evaluate(t);if(f<=s[0])return c[0].evaluate(t);const p=s.length;return f>=s[p-1]?c[p-1].evaluate(t):c[Sl(s,f)].evaluate(t)}eachChild(t){t(this.input);for(const s of this.outputs)t(s)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){const t=["step",this.input.serialize()];for(let s=0;s<this.labels.length;s++)s>0&&t.push(this.labels[s]),t.push(this.outputs[s].serialize());return t}}var Xc=qc;function Qt(n,t,s){return n*(1-s)+t*s}function ko(n,t,s){return n.map((c,f)=>Qt(c,t[f],s))}var Ta=Object.freeze({__proto__:null,number:Qt,color:function(n,t,s){return new ce(Qt(n.r,t.r,s),Qt(n.g,t.g,s),Qt(n.b,t.b,s),Qt(n.a,t.a,s))},array:ko});const Hc=.95047,Yc=1.08883,Kc=4/29,bs=6/29,Ea=3*bs*bs,Tp=Math.PI/180,Jc=180/Math.PI;function Al(n){return n>.008856451679035631?Math.pow(n,1/3):n/Ea+Kc}function Qc(n){return n>bs?n*n*n:Ea*(n-Kc)}function eu(n){return 255*(n<=.0031308?12.92*n:1.055*Math.pow(n,1/2.4)-.055)}function Ml(n){return(n/=255)<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function qh(n){const t=Ml(n.r),s=Ml(n.g),c=Ml(n.b),f=Al((.4124564*t+.3575761*s+.1804375*c)/Hc),p=Al((.2126729*t+.7151522*s+.072175*c)/1);return{l:116*p-16,a:500*(f-p),b:200*(p-Al((.0193339*t+.119192*s+.9503041*c)/Yc)),alpha:n.a}}function tu(n){let t=(n.l+16)/116,s=isNaN(n.a)?t:t+n.a/500,c=isNaN(n.b)?t:t-n.b/200;return t=1*Qc(t),s=Hc*Qc(s),c=Yc*Qc(c),new ce(eu(3.2404542*s-1.5371385*t-.4985314*c),eu(-.969266*s+1.8760108*t+.041556*c),eu(.0556434*s-.2040259*t+1.0572252*c),n.alpha)}function Xh(n,t,s){const c=t-n;return n+s*(c>180||c<-180?c-360*Math.round(c/360):c)}const Sa={forward:qh,reverse:tu,interpolate:function(n,t,s){return{l:Qt(n.l,t.l,s),a:Qt(n.a,t.a,s),b:Qt(n.b,t.b,s),alpha:Qt(n.alpha,t.alpha,s)}}},Ro={forward:function(n){const{l:t,a:s,b:c}=qh(n),f=Math.atan2(c,s)*Jc;return{h:f<0?f+360:f,c:Math.sqrt(s*s+c*c),l:t,alpha:n.a}},reverse:function(n){const t=n.h*Tp,s=n.c;return tu({l:n.l,a:Math.cos(t)*s,b:Math.sin(t)*s,alpha:n.alpha})},interpolate:function(n,t,s){return{h:Xh(n.h,t.h,s),c:Qt(n.c,t.c,s),l:Qt(n.l,t.l,s),alpha:Qt(n.alpha,t.alpha,s)}}};var Hh=Object.freeze({__proto__:null,lab:Sa,hcl:Ro});class Aa{constructor(t,s,c,f,p){this.type=t,this.operator=s,this.interpolation=c,this.input=f,this.labels=[],this.outputs=[];for(const[_,v]of p)this.labels.push(_),this.outputs.push(v)}static interpolationFactor(t,s,c,f){let p=0;if(t.name==="exponential")p=Pl(s,t.base,c,f);else if(t.name==="linear")p=Pl(s,1,c,f);else if(t.name==="cubic-bezier"){const _=t.controlPoints;p=new D(_[0],_[1],_[2],_[3]).solve(Pl(s,1,c,f))}return p}static parse(t,s){let[c,f,p,..._]=t;if(!Array.isArray(f)||f.length===0)return s.error("Expected an interpolation type expression.",1);if(f[0]==="linear")f={name:"linear"};else if(f[0]==="exponential"){const E=f[1];if(typeof E!="number")return s.error("Exponential interpolation requires a numeric base.",1,1);f={name:"exponential",base:E}}else{if(f[0]!=="cubic-bezier")return s.error(`Unknown interpolation type ${String(f[0])}`,1,0);{const E=f.slice(1);if(E.length!==4||E.some(M=>typeof M!="number"||M<0||M>1))return s.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);f={name:"cubic-bezier",controlPoints:E}}}if(t.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return s.error("Expected an even number of arguments.");if(p=s.parse(p,2,ct),!p)return null;const v=[];let w=null;c==="interpolate-hcl"||c==="interpolate-lab"?w=pr:s.expectedType&&s.expectedType.kind!=="value"&&(w=s.expectedType);for(let E=0;E<_.length;E+=2){const M=_[E],C=_[E+1],L=E+3,O=E+4;if(typeof M!="number")return s.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',L);if(v.length&&v[v.length-1][0]>=M)return s.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',L);const z=s.parse(C,O,w);if(!z)return null;w=w||z.type,v.push([M,z])}return w.kind==="number"||w.kind==="color"||w.kind==="array"&&w.itemType.kind==="number"&&typeof w.N=="number"?new Aa(w,c,f,p,v):s.error(`Type ${vi(w)} is not interpolatable.`)}evaluate(t){const s=this.labels,c=this.outputs;if(s.length===1)return c[0].evaluate(t);const f=this.input.evaluate(t);if(f<=s[0])return c[0].evaluate(t);const p=s.length;if(f>=s[p-1])return c[p-1].evaluate(t);const _=Sl(s,f),v=Aa.interpolationFactor(this.interpolation,f,s[_],s[_+1]),w=c[_].evaluate(t),E=c[_+1].evaluate(t);return this.operator==="interpolate"?Ta[this.type.kind.toLowerCase()](w,E,v):this.operator==="interpolate-hcl"?Ro.reverse(Ro.interpolate(Ro.forward(w),Ro.forward(E),v)):Sa.reverse(Sa.interpolate(Sa.forward(w),Sa.forward(E),v))}eachChild(t){t(this.input);for(const s of this.outputs)t(s)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){let t;t=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const s=[this.operator,t,this.input.serialize()];for(let c=0;c<this.labels.length;c++)s.push(this.labels[c],this.outputs[c].serialize());return s}}function Pl(n,t,s,c){const f=c-s,p=n-s;return f===0?0:t===1?p/f:(Math.pow(t,p)-1)/(Math.pow(t,f)-1)}var zn=Aa;class iu{constructor(t,s){this.type=t,this.args=s}static parse(t,s){if(t.length<2)return s.error("Expectected at least one argument.");let c=null;const f=s.expectedType;f&&f.kind!=="value"&&(c=f);const p=[];for(const v of t.slice(1)){const w=s.parse(v,1+p.length,c,void 0,{typeAnnotation:"omit"});if(!w)return null;c=c||w.type,p.push(w)}const _=f&&p.some(v=>On(f,v.type));return new iu(_?zt:c,p)}evaluate(t){let s,c=null,f=0;for(const p of this.args){if(f++,c=p.evaluate(t),c&&c instanceof Rt&&!c.available&&(s||(s=c),c=null,f===this.args.length))return s;if(c!==null)break}return c}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=["coalesce"];return this.eachChild(s=>{t.push(s.serialize())}),t}}var Yh=iu;class ru{constructor(t,s){this.type=s.type,this.bindings=[].concat(t),this.result=s}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const s of this.bindings)t(s[1]);t(this.result)}static parse(t,s){if(t.length<4)return s.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const c=[];for(let p=1;p<t.length-1;p+=2){const _=t[p];if(typeof _!="string")return s.error(`Expected string, but found ${typeof _} instead.`,p);if(/[^a-zA-Z0-9_]/.test(_))return s.error("Variable names must contain only alphanumeric characters or '_'.",p);const v=s.parse(t[p+1],p+1);if(!v)return null;c.push([_,v])}const f=s.parse(t[t.length-1],t.length-1,s.expectedType,c);return f?new ru(c,f):null}outputDefined(){return this.result.outputDefined()}serialize(){const t=["let"];for(const[s,c]of this.bindings)t.push(s,c.serialize());return t.push(this.result.serialize()),t}}var Kh=ru;class nu{constructor(t,s,c){this.type=t,this.index=s,this.input=c}static parse(t,s){if(t.length!==3)return s.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const c=s.parse(t[1],1,ct),f=s.parse(t[2],2,Ni(s.expectedType||zt));return c&&f?new nu(f.type.itemType,c,f):null}evaluate(t){const s=this.index.evaluate(t),c=this.input.evaluate(t);if(s<0)throw new Ji(`Array index out of bounds: ${s} < 0.`);if(s>=c.length)throw new Ji(`Array index out of bounds: ${s} > ${c.length-1}.`);if(s!==Math.floor(s))throw new Ji(`Array index must be an integer, but found ${s} instead.`);return c[s]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Jh=nu;class su{constructor(t,s){this.type=Lt,this.needle=t,this.haystack=s}static parse(t,s){if(t.length!==3)return s.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const c=s.parse(t[1],1,zt),f=s.parse(t[2],2,zt);return c&&f?Xs(c.type,[Lt,Nt,ct,Xn,zt])?new su(c,f):s.error(`Expected first argument to be of type boolean, string, number or null, but found ${vi(c.type)} instead`):null}evaluate(t){const s=this.needle.evaluate(t),c=this.haystack.evaluate(t);if(c==null)return!1;if(!Dn(s,["boolean","string","number","null"]))throw new Ji(`Expected first argument to be of type boolean, string, number or null, but found ${vi(Kt(s))} instead.`);if(!Dn(c,["string","array"]))throw new Ji(`Expected second argument to be of type array or string, but found ${vi(Kt(c))} instead.`);return c.indexOf(s)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var Ep=su;class Il{constructor(t,s,c){this.type=ct,this.needle=t,this.haystack=s,this.fromIndex=c}static parse(t,s){if(t.length<=2||t.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const c=s.parse(t[1],1,zt),f=s.parse(t[2],2,zt);if(!c||!f)return null;if(!Xs(c.type,[Lt,Nt,ct,Xn,zt]))return s.error(`Expected first argument to be of type boolean, string, number or null, but found ${vi(c.type)} instead`);if(t.length===4){const p=s.parse(t[3],3,ct);return p?new Il(c,f,p):null}return new Il(c,f)}evaluate(t){const s=this.needle.evaluate(t),c=this.haystack.evaluate(t);if(!Dn(s,["boolean","string","number","null"]))throw new Ji(`Expected first argument to be of type boolean, string, number or null, but found ${vi(Kt(s))} instead.`);if(!Dn(c,["string","array"]))throw new Ji(`Expected second argument to be of type array or string, but found ${vi(Kt(c))} instead.`);if(this.fromIndex){const f=this.fromIndex.evaluate(t);return c.indexOf(s,f)}return c.indexOf(s)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var Sp=Il;class Cl{constructor(t,s,c,f,p,_){this.inputType=t,this.type=s,this.input=c,this.cases=f,this.outputs=p,this.otherwise=_}static parse(t,s){if(t.length<5)return s.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return s.error("Expected an even number of arguments.");let c,f;s.expectedType&&s.expectedType.kind!=="value"&&(f=s.expectedType);const p={},_=[];for(let E=2;E<t.length-1;E+=2){let M=t[E];const C=t[E+1];Array.isArray(M)||(M=[M]);const L=s.concat(E);if(M.length===0)return L.error("Expected at least one branch label.");for(const z of M){if(typeof z!="number"&&typeof z!="string")return L.error("Branch labels must be numbers or strings.");if(typeof z=="number"&&Math.abs(z)>Number.MAX_SAFE_INTEGER)return L.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof z=="number"&&Math.floor(z)!==z)return L.error("Numeric branch labels must be integer values.");if(c){if(L.checkSubtype(c,Kt(z)))return null}else c=Kt(z);if(p[String(z)]!==void 0)return L.error("Branch labels must be unique.");p[String(z)]=_.length}const O=s.parse(C,E,f);if(!O)return null;f=f||O.type,_.push(O)}const v=s.parse(t[1],1,zt);if(!v)return null;const w=s.parse(t[t.length-1],t.length-1,f);return w?v.type.kind!=="value"&&s.concat(1).checkSubtype(c,v.type)?null:new Cl(c,f,v,p,_,w):null}evaluate(t){const s=this.input.evaluate(t);return(Kt(s)===this.inputType&&this.outputs[this.cases[s]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["match",this.input.serialize()],s=Object.keys(this.cases).sort(),c=[],f={};for(const _ of s){const v=f[this.cases[_]];v===void 0?(f[this.cases[_]]=c.length,c.push([this.cases[_],[_]])):c[v][1].push(_)}const p=_=>this.inputType.kind==="number"?Number(_):_;for(const[_,v]of c)t.push(v.length===1?p(v[0]):v.map(p)),t.push(this.outputs[_].serialize());return t.push(this.otherwise.serialize()),t}}var Qh=Cl;class Ll{constructor(t,s,c){this.type=t,this.branches=s,this.otherwise=c}static parse(t,s){if(t.length<4)return s.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return s.error("Expected an odd number of arguments.");let c;s.expectedType&&s.expectedType.kind!=="value"&&(c=s.expectedType);const f=[];for(let _=1;_<t.length-1;_+=2){const v=s.parse(t[_],_,Lt);if(!v)return null;const w=s.parse(t[_+1],_+1,c);if(!w)return null;f.push([v,w]),c=c||w.type}const p=s.parse(t[t.length-1],t.length-1,c);return p?new Ll(c,f,p):null}evaluate(t){for(const[s,c]of this.branches)if(s.evaluate(t))return c.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[s,c]of this.branches)t(s),t(c);t(this.otherwise)}outputDefined(){return this.branches.every(([t,s])=>s.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["case"];return this.eachChild(s=>{t.push(s.serialize())}),t}}var Ap=Ll;class kl{constructor(t,s,c,f){this.type=t,this.input=s,this.beginIndex=c,this.endIndex=f}static parse(t,s){if(t.length<=2||t.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const c=s.parse(t[1],1,zt),f=s.parse(t[2],2,ct);if(!c||!f)return null;if(!Xs(c.type,[Ni(zt),Nt,zt]))return s.error(`Expected first argument to be of type array or string, but found ${vi(c.type)} instead`);if(t.length===4){const p=s.parse(t[3],3,ct);return p?new kl(c.type,c,f,p):null}return new kl(c.type,c,f)}evaluate(t){const s=this.input.evaluate(t),c=this.beginIndex.evaluate(t);if(!Dn(s,["string","array"]))throw new Ji(`Expected first argument to be of type array or string, but found ${vi(Kt(s))} instead.`);if(this.endIndex){const f=this.endIndex.evaluate(t);return s.slice(c,f)}return s.slice(c)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var ef=kl;function ou(n,t){return n==="=="||n==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function au(n,t,s,c){return c.compare(t,s)===0}function Oo(n,t,s){const c=n!=="=="&&n!=="!=";return class Jw{constructor(p,_,v){this.type=Lt,this.lhs=p,this.rhs=_,this.collator=v,this.hasUntypedArgument=p.type.kind==="value"||_.type.kind==="value"}static parse(p,_){if(p.length!==3&&p.length!==4)return _.error("Expected two or three arguments.");const v=p[0];let w=_.parse(p[1],1,zt);if(!w)return null;if(!ou(v,w.type))return _.concat(1).error(`"${v}" comparisons are not supported for type '${vi(w.type)}'.`);let E=_.parse(p[2],2,zt);if(!E)return null;if(!ou(v,E.type))return _.concat(2).error(`"${v}" comparisons are not supported for type '${vi(E.type)}'.`);if(w.type.kind!==E.type.kind&&w.type.kind!=="value"&&E.type.kind!=="value")return _.error(`Cannot compare types '${vi(w.type)}' and '${vi(E.type)}'.`);c&&(w.type.kind==="value"&&E.type.kind!=="value"?w=new nn(E.type,[w]):w.type.kind!=="value"&&E.type.kind==="value"&&(E=new nn(w.type,[E])));let M=null;if(p.length===4){if(w.type.kind!=="string"&&E.type.kind!=="string"&&w.type.kind!=="value"&&E.type.kind!=="value")return _.error("Cannot use collator to compare non-string types.");if(M=_.parse(p[3],3,Hn),!M)return null}return new Jw(w,E,M)}evaluate(p){const _=this.lhs.evaluate(p),v=this.rhs.evaluate(p);if(c&&this.hasUntypedArgument){const w=Kt(_),E=Kt(v);if(w.kind!==E.kind||w.kind!=="string"&&w.kind!=="number")throw new Ji(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${w.kind}, ${E.kind}) instead.`)}if(this.collator&&!c&&this.hasUntypedArgument){const w=Kt(_),E=Kt(v);if(w.kind!=="string"||E.kind!=="string")return t(p,_,v)}return this.collator?s(p,_,v,this.collator.evaluate(p)):t(p,_,v)}eachChild(p){p(this.lhs),p(this.rhs),this.collator&&p(this.collator)}outputDefined(){return!0}serialize(){const p=[n];return this.eachChild(_=>{p.push(_.serialize())}),p}}}const Mp=Oo("==",function(n,t,s){return t===s},au),Pp=Oo("!=",function(n,t,s){return t!==s},function(n,t,s,c){return!au(0,t,s,c)}),Ip=Oo("<",function(n,t,s){return t<s},function(n,t,s,c){return c.compare(t,s)<0}),Rl=Oo(">",function(n,t,s){return t>s},function(n,t,s,c){return c.compare(t,s)>0}),tf=Oo("<=",function(n,t,s){return t<=s},function(n,t,s,c){return c.compare(t,s)<=0}),rf=Oo(">=",function(n,t,s){return t>=s},function(n,t,s,c){return c.compare(t,s)>=0});class lu{constructor(t,s,c,f,p,_){this.type=Nt,this.number=t,this.locale=s,this.currency=c,this.unit=f,this.minFractionDigits=p,this.maxFractionDigits=_}static parse(t,s){if(t.length!==3)return s.error("Expected two arguments.");const c=s.parse(t[1],1,ct);if(!c)return null;const f=t[2];if(typeof f!="object"||Array.isArray(f))return s.error("NumberFormat options argument must be an object.");let p=null;if(f.locale&&(p=s.parse(f.locale,1,Nt),!p))return null;let _=null;if(f.currency&&(_=s.parse(f.currency,1,Nt),!_))return null;let v=null;if(f.unit&&(v=s.parse(f.unit,1,Nt),!v))return null;let w=null;if(f["min-fraction-digits"]&&(w=s.parse(f["min-fraction-digits"],1,ct),!w))return null;let E=null;return f["max-fraction-digits"]&&(E=s.parse(f["max-fraction-digits"],1,ct),!E)?null:new lu(c,p,_,v,w,E)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(t):void 0,unit:this.unit?this.unit.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.unit&&t(this.unit),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.unit&&(t.unit=this.unit.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]}}class cu{constructor(t){this.type=ct,this.input=t}static parse(t,s){if(t.length!==2)return s.error(`Expected 1 argument, but found ${t.length-1} instead.`);const c=s.parse(t[1],1);return c?c.type.kind!=="array"&&c.type.kind!=="string"&&c.type.kind!=="value"?s.error(`Expected argument of type string or array, but found ${vi(c.type)} instead.`):new cu(c):null}evaluate(t){const s=this.input.evaluate(t);if(typeof s=="string"||Array.isArray(s))return s.length;throw new Ji(`Expected value to be of type string or array, but found ${vi(Kt(s))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){const t=["length"];return this.eachChild(s=>{t.push(s.serialize())}),t}}const nf={"==":Mp,"!=":Pp,">":Rl,"<":Ip,">=":rf,"<=":tf,array:nn,at:Jh,boolean:nn,case:Ap,coalesce:Yh,collator:_l,format:ba,image:gl,in:Ep,"index-of":Sp,interpolate:zn,"interpolate-hcl":zn,"interpolate-lab":zn,length:cu,let:Kh,literal:va,match:Qh,number:nn,"number-format":lu,object:nn,slice:ef,step:Xc,string:nn,"to-boolean":Co,"to-color":Co,"to-number":Co,"to-string":Co,var:Tl,within:bl};function uu(n,[t,s,c,f]){t=t.evaluate(n),s=s.evaluate(n),c=c.evaluate(n);const p=f?f.evaluate(n):1,_=Ui(t,s,c,p);if(_)throw new Ji(_);return new ce(t/255*p,s/255*p,c/255*p,p)}function hu(n,t){return n in t}function Ol(n,t){const s=t[n];return s===void 0?null:s}function Kn(n){return{type:n}}vn.register(nf,{error:[{kind:"error"},[Nt],(n,[t])=>{throw new Ji(t.evaluate(n))}],typeof:[Nt,[zt],(n,[t])=>vi(Kt(t.evaluate(n)))],"to-rgba":[Ni(ct,4),[pr],(n,[t])=>t.evaluate(n).toArray()],rgb:[pr,[ct,ct,ct],uu],rgba:[pr,[ct,ct,ct,ct],uu],has:{type:Lt,overloads:[[[Nt],(n,[t])=>hu(t.evaluate(n),n.properties())],[[Nt,Mr],(n,[t,s])=>hu(t.evaluate(n),s.evaluate(n))]]},get:{type:zt,overloads:[[[Nt],(n,[t])=>Ol(t.evaluate(n),n.properties())],[[Nt,Mr],(n,[t,s])=>Ol(t.evaluate(n),s.evaluate(n))]]},"feature-state":[zt,[Nt],(n,[t])=>Ol(t.evaluate(n),n.featureState||{})],properties:[Mr,[],n=>n.properties()],"geometry-type":[Nt,[],n=>n.geometryType()],id:[zt,[],n=>n.id()],zoom:[ct,[],n=>n.globals.zoom],pitch:[ct,[],n=>n.globals.pitch||0],"distance-from-center":[ct,[],n=>n.distanceFromCenter()],"heatmap-density":[ct,[],n=>n.globals.heatmapDensity||0],"line-progress":[ct,[],n=>n.globals.lineProgress||0],"sky-radial-progress":[ct,[],n=>n.globals.skyRadialProgress||0],accumulated:[zt,[],n=>n.globals.accumulated===void 0?null:n.globals.accumulated],"+":[ct,Kn(ct),(n,t)=>{let s=0;for(const c of t)s+=c.evaluate(n);return s}],"*":[ct,Kn(ct),(n,t)=>{let s=1;for(const c of t)s*=c.evaluate(n);return s}],"-":{type:ct,overloads:[[[ct,ct],(n,[t,s])=>t.evaluate(n)-s.evaluate(n)],[[ct],(n,[t])=>-t.evaluate(n)]]},"/":[ct,[ct,ct],(n,[t,s])=>t.evaluate(n)/s.evaluate(n)],"%":[ct,[ct,ct],(n,[t,s])=>t.evaluate(n)%s.evaluate(n)],ln2:[ct,[],()=>Math.LN2],pi:[ct,[],()=>Math.PI],e:[ct,[],()=>Math.E],"^":[ct,[ct,ct],(n,[t,s])=>Math.pow(t.evaluate(n),s.evaluate(n))],sqrt:[ct,[ct],(n,[t])=>Math.sqrt(t.evaluate(n))],log10:[ct,[ct],(n,[t])=>Math.log(t.evaluate(n))/Math.LN10],ln:[ct,[ct],(n,[t])=>Math.log(t.evaluate(n))],log2:[ct,[ct],(n,[t])=>Math.log(t.evaluate(n))/Math.LN2],sin:[ct,[ct],(n,[t])=>Math.sin(t.evaluate(n))],cos:[ct,[ct],(n,[t])=>Math.cos(t.evaluate(n))],tan:[ct,[ct],(n,[t])=>Math.tan(t.evaluate(n))],asin:[ct,[ct],(n,[t])=>Math.asin(t.evaluate(n))],acos:[ct,[ct],(n,[t])=>Math.acos(t.evaluate(n))],atan:[ct,[ct],(n,[t])=>Math.atan(t.evaluate(n))],min:[ct,Kn(ct),(n,t)=>Math.min(...t.map(s=>s.evaluate(n)))],max:[ct,Kn(ct),(n,t)=>Math.max(...t.map(s=>s.evaluate(n)))],abs:[ct,[ct],(n,[t])=>Math.abs(t.evaluate(n))],round:[ct,[ct],(n,[t])=>{const s=t.evaluate(n);return s<0?-Math.round(-s):Math.round(s)}],floor:[ct,[ct],(n,[t])=>Math.floor(t.evaluate(n))],ceil:[ct,[ct],(n,[t])=>Math.ceil(t.evaluate(n))],"filter-==":[Lt,[Nt,zt],(n,[t,s])=>n.properties()[t.value]===s.value],"filter-id-==":[Lt,[zt],(n,[t])=>n.id()===t.value],"filter-type-==":[Lt,[Nt],(n,[t])=>n.geometryType()===t.value],"filter-<":[Lt,[Nt,zt],(n,[t,s])=>{const c=n.properties()[t.value],f=s.value;return typeof c==typeof f&&c<f}],"filter-id-<":[Lt,[zt],(n,[t])=>{const s=n.id(),c=t.value;return typeof s==typeof c&&s<c}],"filter->":[Lt,[Nt,zt],(n,[t,s])=>{const c=n.properties()[t.value],f=s.value;return typeof c==typeof f&&c>f}],"filter-id->":[Lt,[zt],(n,[t])=>{const s=n.id(),c=t.value;return typeof s==typeof c&&s>c}],"filter-<=":[Lt,[Nt,zt],(n,[t,s])=>{const c=n.properties()[t.value],f=s.value;return typeof c==typeof f&&c<=f}],"filter-id-<=":[Lt,[zt],(n,[t])=>{const s=n.id(),c=t.value;return typeof s==typeof c&&s<=c}],"filter->=":[Lt,[Nt,zt],(n,[t,s])=>{const c=n.properties()[t.value],f=s.value;return typeof c==typeof f&&c>=f}],"filter-id->=":[Lt,[zt],(n,[t])=>{const s=n.id(),c=t.value;return typeof s==typeof c&&s>=c}],"filter-has":[Lt,[zt],(n,[t])=>t.value in n.properties()],"filter-has-id":[Lt,[],n=>n.id()!==null&&n.id()!==void 0],"filter-type-in":[Lt,[Ni(Nt)],(n,[t])=>t.value.indexOf(n.geometryType())>=0],"filter-id-in":[Lt,[Ni(zt)],(n,[t])=>t.value.indexOf(n.id())>=0],"filter-in-small":[Lt,[Nt,Ni(zt)],(n,[t,s])=>s.value.indexOf(n.properties()[t.value])>=0],"filter-in-large":[Lt,[Nt,Ni(zt)],(n,[t,s])=>function(c,f,p,_){for(;p<=_;){const v=p+_>>1;if(f[v]===c)return!0;f[v]>c?_=v-1:p=v+1}return!1}(n.properties()[t.value],s.value,0,s.value.length-1)],all:{type:Lt,overloads:[[[Lt,Lt],(n,[t,s])=>t.evaluate(n)&&s.evaluate(n)],[Kn(Lt),(n,t)=>{for(const s of t)if(!s.evaluate(n))return!1;return!0}]]},any:{type:Lt,overloads:[[[Lt,Lt],(n,[t,s])=>t.evaluate(n)||s.evaluate(n)],[Kn(Lt),(n,t)=>{for(const s of t)if(s.evaluate(n))return!0;return!1}]]},"!":[Lt,[Lt],(n,[t])=>!t.evaluate(n)],"is-supported-script":[Lt,[Nt],(n,[t])=>{const s=n.globals&&n.globals.isSupportedScript;return!s||s(t.evaluate(n))}],upcase:[Nt,[Nt],(n,[t])=>t.evaluate(n).toUpperCase()],downcase:[Nt,[Nt],(n,[t])=>t.evaluate(n).toLowerCase()],concat:[Nt,Kn(zt),(n,t)=>t.map(s=>mr(s.evaluate(n))).join("")],"resolved-locale":[Nt,[Hn],(n,[t])=>t.evaluate(n).resolvedLocale()]});var Ma=nf;function sf(n){return{result:"success",value:n}}function Do(n){return{result:"error",value:n}}function zo(n){return n["property-type"]==="data-driven"||n["property-type"]==="cross-faded-data-driven"}function of(n){return!!n.expression&&n.expression.parameters.indexOf("zoom")>-1}function fu(n){return!!n.expression&&n.expression.interpolated}function si(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":n===null?"null":typeof n}function Pa(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)}function af(n){return n}function Ia(n,t){const s=t.type==="color",c=n.stops&&typeof n.stops[0][0]=="object",f=c||!(c||n.property!==void 0),p=n.type||(fu(t)?"exponential":"interval");if(s&&((n=Ei({},n)).stops&&(n.stops=n.stops.map(E=>[E[0],ce.parse(E[1])])),n.default=ce.parse(n.default?n.default:t.default)),n.colorSpace&&n.colorSpace!=="rgb"&&!Hh[n.colorSpace])throw new Error(`Unknown color space: ${n.colorSpace}`);let _,v,w;if(p==="exponential")_=du;else if(p==="interval")_=ws;else if(p==="categorical"){_=Cp,v=Object.create(null);for(const E of n.stops)v[E[0]]=E[1];w=typeof n.stops[0][0]}else{if(p!=="identity")throw new Error(`Unknown function type "${p}"`);_=Bo}if(c){const E={},M=[];for(let O=0;O<n.stops.length;O++){const z=n.stops[O],G=z[0].zoom;E[G]===void 0&&(E[G]={zoom:G,type:n.type,property:n.property,default:n.default,stops:[]},M.push(G)),E[G].stops.push([z[0].value,z[1]])}const C=[];for(const O of M)C.push([E[O].zoom,Ia(E[O],t)]);const L={name:"linear"};return{kind:"composite",interpolationType:L,interpolationFactor:zn.interpolationFactor.bind(void 0,L),zoomStops:C.map(O=>O[0]),evaluate:({zoom:O},z)=>du({stops:C,base:n.base},t,O).evaluate(O,z)}}if(f){const E=p==="exponential"?{name:"exponential",base:n.base!==void 0?n.base:1}:null;return{kind:"camera",interpolationType:E,interpolationFactor:zn.interpolationFactor.bind(void 0,E),zoomStops:n.stops.map(M=>M[0]),evaluate:({zoom:M})=>_(n,t,M,v,w)}}return{kind:"source",evaluate(E,M){const C=M&&M.properties?M.properties[n.property]:void 0;return C===void 0?Ca(n.default,t.default):_(n,t,C,v,w)}}}function Ca(n,t,s){return n!==void 0?n:t!==void 0?t:s!==void 0?s:void 0}function Cp(n,t,s,c,f){return Ca(typeof s===f?c[s]:void 0,n.default,t.default)}function ws(n,t,s){if(si(s)!=="number")return Ca(n.default,t.default);const c=n.stops.length;if(c===1||s<=n.stops[0][0])return n.stops[0][1];if(s>=n.stops[c-1][0])return n.stops[c-1][1];const f=Sl(n.stops.map(p=>p[0]),s);return n.stops[f][1]}function du(n,t,s){const c=n.base!==void 0?n.base:1;if(si(s)!=="number")return Ca(n.default,t.default);const f=n.stops.length;if(f===1||s<=n.stops[0][0])return n.stops[0][1];if(s>=n.stops[f-1][0])return n.stops[f-1][1];const p=Sl(n.stops.map(M=>M[0]),s),_=function(M,C,L,O){const z=O-L,G=M-L;return z===0?0:C===1?G/z:(Math.pow(C,G)-1)/(Math.pow(C,z)-1)}(s,c,n.stops[p][0],n.stops[p+1][0]),v=n.stops[p][1],w=n.stops[p+1][1];let E=Ta[t.type]||af;if(n.colorSpace&&n.colorSpace!=="rgb"){const M=Hh[n.colorSpace];E=(C,L)=>M.reverse(M.interpolate(M.forward(C),M.forward(L),_))}return typeof v.evaluate=="function"?{evaluate(...M){const C=v.evaluate.apply(void 0,M),L=w.evaluate.apply(void 0,M);if(C!==void 0&&L!==void 0)return E(C,L,_)}}:E(v,w,_)}function Bo(n,t,s){return t.type==="color"?s=ce.parse(s):t.type==="formatted"?s=dt.fromString(s.toString()):t.type==="resolvedImage"?s=Rt.fromString(s.toString()):si(s)===t.type||t.type==="enum"&&t.values[s]||(s=void 0),Ca(s,n.default,t.default)}class pu{constructor(t,s){this.expression=t,this._warningHistory={},this._evaluator=new Zh,this._defaultValue=s?function(c){return c.type==="color"&&(Pa(c.default)||Array.isArray(c.default))?new ce(0,0,0,0):c.type==="color"?ce.parse(c.default)||null:c.default===void 0?null:c.default}(s):null,this._enumValues=s&&s.type==="enum"?s.values:null}evaluateWithoutErrorHandling(t,s,c,f,p,_,v,w){return this._evaluator.globals=t,this._evaluator.feature=s,this._evaluator.featureState=c,this._evaluator.canonical=f||null,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=_,this._evaluator.featureTileCoord=v||null,this._evaluator.featureDistanceData=w||null,this.expression.evaluate(this._evaluator)}evaluate(t,s,c,f,p,_,v,w){this._evaluator.globals=t,this._evaluator.feature=s||null,this._evaluator.featureState=c||null,this._evaluator.canonical=f||null,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=_||null,this._evaluator.featureTileCoord=v||null,this._evaluator.featureDistanceData=w||null;try{const E=this.expression.evaluate(this._evaluator);if(E==null||typeof E=="number"&&E!=E)return this._defaultValue;if(this._enumValues&&!(E in this._enumValues))throw new Ji(`Expected value to be one of ${Object.keys(this._enumValues).map(M=>JSON.stringify(M)).join(", ")}, but found ${JSON.stringify(E)} instead.`);return E}catch(E){return this._warningHistory[E.message]||(this._warningHistory[E.message]=!0,typeof console<"u"&&console.warn(E.message)),this._defaultValue}}}function Dl(n){return Array.isArray(n)&&n.length>0&&typeof n[0]=="string"&&n[0]in Ma}function Fo(n,t){const s=new Ks(Ma,[],t?function(f){const p={color:pr,string:Nt,number:ct,enum:Nt,boolean:Lt,formatted:Yn,resolvedImage:Rn};return f.type==="array"?Ni(p[f.value]||zt,f.length):p[f.type]}(t):void 0),c=s.parse(n,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return c?sf(new pu(c,t)):Do(s.errors)}class mu{constructor(t,s){this.kind=t,this._styleExpression=s,this.isStateDependent=t!=="constant"&&!xs(s.expression)}evaluateWithoutErrorHandling(t,s,c,f,p,_){return this._styleExpression.evaluateWithoutErrorHandling(t,s,c,f,p,_)}evaluate(t,s,c,f,p,_){return this._styleExpression.evaluate(t,s,c,f,p,_)}}class La{constructor(t,s,c,f){this.kind=t,this.zoomStops=c,this._styleExpression=s,this.isStateDependent=t!=="camera"&&!xs(s.expression),this.interpolationType=f}evaluateWithoutErrorHandling(t,s,c,f,p,_){return this._styleExpression.evaluateWithoutErrorHandling(t,s,c,f,p,_)}evaluate(t,s,c,f,p,_){return this._styleExpression.evaluate(t,s,c,f,p,_)}interpolationFactor(t,s,c){return this.interpolationType?zn.interpolationFactor(this.interpolationType,t,s,c):0}}function gu(n,t){if((n=Fo(n,t)).result==="error")return n;const s=n.value.expression,c=Ys(s);if(!c&&!zo(t))return Do([new or("","data expressions not supported")]);const f=wa(s,["zoom","pitch","distance-from-center"]);if(!f&&!of(t))return Do([new or("","zoom expressions not supported")]);const p=Uo(s);return p||f?p instanceof or?Do([p]):p instanceof zn&&!fu(t)?Do([new or("",'"interpolate" expressions cannot be used with this property')]):sf(p?new La(c?"camera":"composite",n.value,p.labels,p instanceof zn?p.interpolation:void 0):new mu(c?"constant":"source",n.value)):Do([new or("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class No{constructor(t,s){this._parameters=t,this._specification=s,Ei(this,Ia(this._parameters,this._specification))}static deserialize(t){return new No(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function Uo(n){let t=null;if(n instanceof Kh)t=Uo(n.result);else if(n instanceof Yh){for(const s of n.args)if(t=Uo(s),t)break}else(n instanceof Xc||n instanceof zn)&&n.input instanceof vn&&n.input.name==="zoom"&&(t=n);return t instanceof or||n.eachChild(s=>{const c=Uo(s);c instanceof or?t=c:!t&&c?t=new or("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&c&&t!==c&&(t=new or("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}class ht{constructor(t,s,c,f){this.message=(t?`${t}: `:"")+c,f&&(this.identifier=f),s!=null&&s.__line__&&(this.line=s.__line__)}}function Hr(n){const t=n.key,s=n.value,c=n.valueSpec||{},f=n.objectElementValidators||{},p=n.style,_=n.styleSpec;let v=[];const w=si(s);if(w!=="object")return[new ht(t,s,`object expected, ${w} found`)];for(const E in s){const M=E.split(".")[0],C=c[M]||c["*"];let L;f[M]?L=f[M]:c[M]?L=ar:f["*"]?L=f["*"]:c["*"]&&(L=ar),L?v=v.concat(L({key:(t&&`${t}.`)+E,value:s[E],valueSpec:C,style:p,styleSpec:_,object:s,objectKey:E},s)):v.push(new ht(t,s[E],`unknown property "${E}"`))}for(const E in c)f[E]||c[E].required&&c[E].default===void 0&&s[E]===void 0&&v.push(new ht(t,s,`missing required property "${E}"`));return v}function _u(n){const t=n.value,s=n.valueSpec,c=n.style,f=n.styleSpec,p=n.key,_=n.arrayElementValidator||ar;if(si(t)!=="array")return[new ht(p,t,`array expected, ${si(t)} found`)];if(s.length&&t.length!==s.length)return[new ht(p,t,`array length ${s.length} expected, length ${t.length} found`)];if(s["min-length"]&&t.length<s["min-length"])return[new ht(p,t,`array length at least ${s["min-length"]} expected, length ${t.length} found`)];let v={type:s.value,values:s.values,minimum:s.minimum,maximum:s.maximum,function:void 0};f.$version<7&&(v.function=s.function),si(s.value)==="object"&&(v=s.value);let w=[];for(let E=0;E<t.length;E++)w=w.concat(_({array:t,arrayIndex:E,value:t[E],valueSpec:v,style:c,styleSpec:f,key:`${p}[${E}]`}));return w}function yu(n){const t=n.key,s=n.value,c=n.valueSpec;let f=si(s);if(f==="number"&&s!=s&&(f="NaN"),f!=="number")return[new ht(t,s,`number expected, ${f} found`)];if("minimum"in c){let p=c.minimum;if(si(c.minimum)==="array"&&(p=c.minimum[n.arrayIndex]),s<p)return[new ht(t,s,`${s} is less than the minimum value ${p}`)]}if("maximum"in c){let p=c.maximum;if(si(c.maximum)==="array"&&(p=c.maximum[n.arrayIndex]),s>p)return[new ht(t,s,`${s} is greater than the maximum value ${p}`)]}return[]}function ka(n){const t=n.valueSpec,s=ci(n.value.type);let c,f,p,_={};const v=s!=="categorical"&&n.value.property===void 0,w=!v,E=si(n.value.stops)==="array"&&si(n.value.stops[0])==="array"&&si(n.value.stops[0][0])==="object",M=Hr({key:n.key,value:n.value,valueSpec:n.styleSpec.function,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{stops:function(O){if(s==="identity")return[new ht(O.key,O.value,'identity function may not have a "stops" property')];let z=[];const G=O.value;return z=z.concat(_u({key:O.key,value:G,valueSpec:O.valueSpec,style:O.style,styleSpec:O.styleSpec,arrayElementValidator:C})),si(G)==="array"&&G.length===0&&z.push(new ht(O.key,G,"array must have at least one stop")),z},default:function(O){return ar({key:O.key,value:O.value,valueSpec:t,style:O.style,styleSpec:O.styleSpec})}}});return s==="identity"&&v&&M.push(new ht(n.key,n.value,'missing required property "property"')),s==="identity"||n.value.stops||M.push(new ht(n.key,n.value,'missing required property "stops"')),s==="exponential"&&n.valueSpec.expression&&!fu(n.valueSpec)&&M.push(new ht(n.key,n.value,"exponential functions not supported")),n.styleSpec.$version>=8&&(w&&!zo(n.valueSpec)?M.push(new ht(n.key,n.value,"property functions not supported")):v&&!of(n.valueSpec)&&M.push(new ht(n.key,n.value,"zoom functions not supported"))),s!=="categorical"&&!E||n.value.property!==void 0||M.push(new ht(n.key,n.value,'"property" property is required')),M;function C(O){let z=[];const G=O.value,q=O.key;if(si(G)!=="array")return[new ht(q,G,`array expected, ${si(G)} found`)];if(G.length!==2)return[new ht(q,G,`array length 2 expected, length ${G.length} found`)];if(E){if(si(G[0])!=="object")return[new ht(q,G,`object expected, ${si(G[0])} found`)];if(G[0].zoom===void 0)return[new ht(q,G,"object stop key must have zoom")];if(G[0].value===void 0)return[new ht(q,G,"object stop key must have value")];const re=ci(G[0].zoom);if(typeof re!="number")return[new ht(q,G[0].zoom,"stop zoom values must be numbers")];if(p&&p>re)return[new ht(q,G[0].zoom,"stop zoom values must appear in ascending order")];re!==p&&(p=re,f=void 0,_={}),z=z.concat(Hr({key:`${q}[0]`,value:G[0],valueSpec:{zoom:{}},style:O.style,styleSpec:O.styleSpec,objectElementValidators:{zoom:yu,value:L}}))}else z=z.concat(L({key:`${q}[0]`,value:G[0],valueSpec:{},style:O.style,styleSpec:O.styleSpec},G));return Dl(sr(G[1]))?z.concat([new ht(`${q}[1]`,G[1],"expressions are not allowed in function stops.")]):z.concat(ar({key:`${q}[1]`,value:G[1],valueSpec:t,style:O.style,styleSpec:O.styleSpec}))}function L(O,z){const G=si(O.value),q=ci(O.value),re=O.value!==null?O.value:z;if(c){if(G!==c)return[new ht(O.key,re,`${G} stop domain type must match previous stop domain type ${c}`)]}else c=G;if(G!=="number"&&G!=="string"&&G!=="boolean"&&typeof q!="number"&&typeof q!="string"&&typeof q!="boolean")return[new ht(O.key,re,"stop domain value must be a number, string, or boolean")];if(G!=="number"&&s!=="categorical"){let he=`number expected, ${G} found`;return zo(t)&&s===void 0&&(he+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ht(O.key,re,he)]}return s!=="categorical"||G!=="number"||typeof q=="number"&&isFinite(q)&&Math.floor(q)===q?s!=="categorical"&&G==="number"&&typeof q=="number"&&typeof f=="number"&&f!==void 0&&q<f?[new ht(O.key,re,"stop domain values must appear in ascending order")]:(f=q,s==="categorical"&&q in _?[new ht(O.key,re,"stop domain values must be unique")]:(_[q]=!0,[])):[new ht(O.key,re,`integer expected, found ${String(q)}`)]}}function xn(n){const t=(n.expressionContext==="property"?gu:Fo)(sr(n.value),n.valueSpec);if(t.result==="error")return t.value.map(c=>new ht(`${n.key}${c.key}`,n.value,c.message));const s=t.value.expression||t.value._styleExpression.expression;if(n.expressionContext==="property"&&n.propertyKey==="text-font"&&!s.outputDefined())return[new ht(n.key,n.value,`Invalid data expression for "${n.propertyKey}". Output values must be contained as literals within the expression.`)];if(n.expressionContext==="property"&&n.propertyType==="layout"&&!xs(s))return[new ht(n.key,n.value,'"feature-state" data expressions are not supported with layout properties.')];if(n.expressionContext==="filter")return vu(s,n);if(n.expressionContext&&n.expressionContext.indexOf("cluster")===0){if(!wa(s,["zoom","feature-state"]))return[new ht(n.key,n.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(n.expressionContext==="cluster-initial"&&!Ys(s))return[new ht(n.key,n.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function vu(n,t){const s=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(const f of t.valueSpec.expression.parameters)s.delete(f);if(s.size===0)return[];const c=[];return n instanceof vn&&s.has(n.name)?[new ht(t.key,t.value,`["${n.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(n.eachChild(f=>{c.push(...vu(f,t))}),c)}function Ra(n){const t=n.key,s=n.value,c=n.valueSpec,f=[];return Array.isArray(c.values)?c.values.indexOf(ci(s))===-1&&f.push(new ht(t,s,`expected one of [${c.values.join(", ")}], ${JSON.stringify(s)} found`)):Object.keys(c.values).indexOf(ci(s))===-1&&f.push(new ht(t,s,`expected one of [${Object.keys(c.values).join(", ")}], ${JSON.stringify(s)} found`)),f}function Oa(n){if(n===!0||n===!1)return!0;if(!Array.isArray(n)||n.length===0)return!1;switch(n[0]){case"has":return n.length>=2&&n[1]!=="$id"&&n[1]!=="$type";case"in":return n.length>=3&&(typeof n[1]!="string"||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return n.length!==3||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const t of n.slice(1))if(!Oa(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}function Da(n,t="fill"){if(n==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Oa(n)||(n=zl(n));const s=n;let c=!0;try{c=function(E){if(!Jn(E))return E;let M=sr(E);return xu(M),M=lf(M),M}(s)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(s,null,2)}
        `)}const f=Fe[`filter_${t}`],p=Fo(c,f);let _=null;if(p.result==="error")throw new Error(p.value.map(E=>`${E.key}: ${E.message}`).join(", "));_=(E,M,C)=>p.value.evaluate(E,M,{},C);let v=null,w=null;if(c!==s){const E=Fo(s,f);if(E.result==="error")throw new Error(E.value.map(M=>`${M.key}: ${M.message}`).join(", "));v=(M,C,L,O,z)=>E.value.evaluate(M,C,{},L,void 0,void 0,O,z),w=!Ys(E.value.expression)}return _=_,{filter:_,dynamicFilter:v||void 0,needGeometry:cf(c),needFeature:!!w}}function lf(n){if(!Array.isArray(n))return n;const t=function(s){if(Lp.has(s[0])){for(let c=1;c<s.length;c++)if(Jn(s[c]))return!0}return s}(n);return t===!0?t:t.map(s=>lf(s))}function xu(n){let t=!1;const s=[];if(n[0]==="case"){for(let c=1;c<n.length-1;c+=2)t=t||Jn(n[c]),s.push(n[c+1]);s.push(n[n.length-1])}else if(n[0]==="match"){t=t||Jn(n[1]);for(let c=2;c<n.length-1;c+=2)s.push(n[c+1]);s.push(n[n.length-1])}else if(n[0]==="step"){t=t||Jn(n[1]);for(let c=1;c<n.length-1;c+=2)s.push(n[c+1])}t&&(n.length=0,n.push("any",...s));for(let c=1;c<n.length;c++)xu(n[c])}function Jn(n){if(!Array.isArray(n))return!1;if((t=n[0])==="pitch"||t==="distance-from-center")return!0;var t;for(let s=1;s<n.length;s++)if(Jn(n[s]))return!0;return!1}const Lp=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function kp(n,t){return n<t?-1:n>t?1:0}function cf(n){if(!Array.isArray(n))return!1;if(n[0]==="within")return!0;for(let t=1;t<n.length;t++)if(cf(n[t]))return!0;return!1}function zl(n){if(!n)return!0;const t=n[0];return n.length<=1?t!=="any":t==="=="?bu(n[1],n[2],"=="):t==="!="?gr(bu(n[1],n[2],"==")):t==="<"||t===">"||t==="<="||t===">="?bu(n[1],n[2],t):t==="any"?(s=n.slice(1),["any"].concat(s.map(zl))):t==="all"?["all"].concat(n.slice(1).map(zl)):t==="none"?["all"].concat(n.slice(1).map(zl).map(gr)):t==="in"?za(n[1],n.slice(2)):t==="!in"?gr(za(n[1],n.slice(2))):t==="has"?Ba(n[1]):t==="!has"?gr(Ba(n[1])):t!=="within"||n;var s}function bu(n,t,s){switch(n){case"$type":return[`filter-type-${s}`,t];case"$id":return[`filter-id-${s}`,t];default:return[`filter-${s}`,n,t]}}function za(n,t){if(t.length===0)return!1;switch(n){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(s=>typeof s!=typeof t[0])?["filter-in-large",n,["literal",t.sort(kp)]]:["filter-in-small",n,["literal",t]]}}function Ba(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function gr(n){return["!",n]}function jo(n){return Oa(sr(n.value))?xn(Ei({},n,{expressionContext:"filter",valueSpec:n.styleSpec[`filter_${n.layerType||"fill"}`]})):uf(n)}function uf(n){const t=n.value,s=n.key;if(si(t)!=="array")return[new ht(s,t,`array expected, ${si(t)} found`)];const c=n.styleSpec;let f,p=[];if(t.length<1)return[new ht(s,t,"filter array must have at least 1 element")];switch(p=p.concat(Ra({key:`${s}[0]`,value:t[0],valueSpec:c.filter_operator,style:n.style,styleSpec:n.styleSpec})),ci(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&ci(t[1])==="$type"&&p.push(new ht(s,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&p.push(new ht(s,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(f=si(t[1]),f!=="string"&&p.push(new ht(`${s}[1]`,t[1],`string expected, ${f} found`)));for(let _=2;_<t.length;_++)f=si(t[_]),ci(t[1])==="$type"?p=p.concat(Ra({key:`${s}[${_}]`,value:t[_],valueSpec:c.geometry_type,style:n.style,styleSpec:n.styleSpec})):f!=="string"&&f!=="number"&&f!=="boolean"&&p.push(new ht(`${s}[${_}]`,t[_],`string, number, or boolean expected, ${f} found`));break;case"any":case"all":case"none":for(let _=1;_<t.length;_++)p=p.concat(uf({key:`${s}[${_}]`,value:t[_],style:n.style,styleSpec:n.styleSpec}));break;case"has":case"!has":f=si(t[1]),t.length!==2?p.push(new ht(s,t,`filter array for "${t[0]}" operator must have 2 elements`)):f!=="string"&&p.push(new ht(`${s}[1]`,t[1],`string expected, ${f} found`));break;case"within":f=si(t[1]),t.length!==2?p.push(new ht(s,t,`filter array for "${t[0]}" operator must have 2 elements`)):f!=="object"&&p.push(new ht(`${s}[1]`,t[1],`object expected, ${f} found`))}return p}function hf(n,t){const s=n.key,c=n.style,f=n.styleSpec,p=n.value,_=n.objectKey,v=f[`${t}_${n.layerType}`];if(!v)return[];const w=_.match(/^(.*)-transition$/);if(t==="paint"&&w&&v[w[1]]&&v[w[1]].transition)return ar({key:s,value:p,valueSpec:f.transition,style:c,styleSpec:f});const E=n.valueSpec||v[_];if(!E)return[new ht(s,p,`unknown property "${_}"`)];let M;if(si(p)==="string"&&zo(E)&&!E.tokens&&(M=/^{([^}]+)}$/.exec(p)))return[new ht(s,p,`"${_}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(M[1])} }\`.`)];const C=[];return n.layerType==="symbol"&&(_==="text-field"&&c&&!c.glyphs&&C.push(new ht(s,p,'use of "text-field" requires a style "glyphs" property')),_==="text-font"&&Pa(sr(p))&&ci(p.type)==="identity"&&C.push(new ht(s,p,'"text-font" does not support identity functions'))),C.concat(ar({key:n.key,value:p,valueSpec:E,style:c,styleSpec:f,expressionContext:"property",propertyType:t,propertyKey:_}))}function ff(n){return hf(n,"paint")}function df(n){return hf(n,"layout")}function Bl(n){let t=[];const s=n.value,c=n.key,f=n.style,p=n.styleSpec;s.type||s.ref||t.push(new ht(c,s,'either "type" or "ref" is required'));let _=ci(s.type);const v=ci(s.ref);if(s.id){const w=ci(s.id);for(let E=0;E<n.arrayIndex;E++){const M=f.layers[E];ci(M.id)===w&&t.push(new ht(c,s.id,`duplicate layer id "${s.id}", previously used at line ${M.id.__line__}`))}}if("ref"in s){let w;["type","source","source-layer","filter","layout"].forEach(E=>{E in s&&t.push(new ht(c,s[E],`"${E}" is prohibited for ref layers`))}),f.layers.forEach(E=>{ci(E.id)===v&&(w=E)}),w?w.ref?t.push(new ht(c,s.ref,"ref cannot reference another ref layer")):_=ci(w.type):typeof v=="string"&&t.push(new ht(c,s.ref,`ref layer "${v}" not found`))}else if(_!=="background"&&_!=="sky")if(s.source){const w=f.sources&&f.sources[s.source],E=w&&ci(w.type);w?E==="vector"&&_==="raster"?t.push(new ht(c,s.source,`layer "${s.id}" requires a raster source`)):E==="raster"&&_!=="raster"?t.push(new ht(c,s.source,`layer "${s.id}" requires a vector source`)):E!=="vector"||s["source-layer"]?E==="raster-dem"&&_!=="hillshade"?t.push(new ht(c,s.source,"raster-dem source can only be used with layer type 'hillshade'.")):_!=="line"||!s.paint||!s.paint["line-gradient"]&&!s.paint["line-trim-offset"]||E==="geojson"&&w.lineMetrics||t.push(new ht(c,s,`layer "${s.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new ht(c,s,`layer "${s.id}" must specify a "source-layer"`)):t.push(new ht(c,s.source,`source "${s.source}" not found`))}else t.push(new ht(c,s,'missing required property "source"'));return t=t.concat(Hr({key:c,value:s,valueSpec:p.layer,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{"*":()=>[],type:()=>ar({key:`${c}.type`,value:s.type,valueSpec:p.layer.type,style:n.style,styleSpec:n.styleSpec,object:s,objectKey:"type"}),filter:w=>jo(Ei({layerType:_},w)),layout:w=>Hr({layer:s,key:w.key,value:w.value,valueSpec:{},style:w.style,styleSpec:w.styleSpec,objectElementValidators:{"*":E=>df(Ei({layerType:_},E))}}),paint:w=>Hr({layer:s,key:w.key,value:w.value,valueSpec:{},style:w.style,styleSpec:w.styleSpec,objectElementValidators:{"*":E=>ff(Ei({layerType:_},E))}})}})),t}function Vo(n){const t=n.value,s=n.key,c=si(t);return c!=="string"?[new ht(s,t,`string expected, ${c} found`)]:[]}const Fl={promoteId:function({key:n,value:t}){if(si(t)==="string")return Vo({key:n,value:t});{const s=[];for(const c in t)s.push(...Vo({key:`${n}.${c}`,value:t[c]}));return s}}};function pf(n){const t=n.value,s=n.key,c=n.styleSpec,f=n.style;if(!t.type)return[new ht(s,t,'"type" is required')];const p=ci(t.type);let _;switch(p){case"vector":case"raster":case"raster-dem":return _=Hr({key:s,value:t,valueSpec:c[`source_${p.replace("-","_")}`],style:n.style,styleSpec:c,objectElementValidators:Fl}),_;case"geojson":if(_=Hr({key:s,value:t,valueSpec:c.source_geojson,style:f,styleSpec:c,objectElementValidators:Fl}),t.cluster)for(const v in t.clusterProperties){const[w,E]=t.clusterProperties[v],M=typeof w=="string"?[w,["accumulated"],["get",v]]:w;_.push(...xn({key:`${s}.${v}.map`,value:E,expressionContext:"cluster-map"})),_.push(...xn({key:`${s}.${v}.reduce`,value:M,expressionContext:"cluster-reduce"}))}return _;case"video":return Hr({key:s,value:t,valueSpec:c.source_video,style:f,styleSpec:c});case"image":return Hr({key:s,value:t,valueSpec:c.source_image,style:f,styleSpec:c});case"canvas":return[new ht(s,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ra({key:`${s}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:f,styleSpec:c})}}function mf(n){const t=n.value,s=n.styleSpec,c=s.light,f=n.style;let p=[];const _=si(t);if(t===void 0)return p;if(_!=="object")return p=p.concat([new ht("light",t,`object expected, ${_} found`)]),p;for(const v in t){const w=v.match(/^(.*)-transition$/);p=p.concat(w&&c[w[1]]&&c[w[1]].transition?ar({key:v,value:t[v],valueSpec:s.transition,style:f,styleSpec:s}):c[v]?ar({key:v,value:t[v],valueSpec:c[v],style:f,styleSpec:s}):[new ht(v,t[v],`unknown property "${v}"`)])}return p}function Nl(n){const t=n.value,s=n.key,c=n.style,f=n.styleSpec,p=f.terrain;let _=[];const v=si(t);if(t===void 0)return _;if(v!=="object")return _=_.concat([new ht("terrain",t,`object expected, ${v} found`)]),_;for(const w in t){const E=w.match(/^(.*)-transition$/);_=_.concat(E&&p[E[1]]&&p[E[1]].transition?ar({key:w,value:t[w],valueSpec:f.transition,style:c,styleSpec:f}):p[w]?ar({key:w,value:t[w],valueSpec:p[w],style:c,styleSpec:f}):[new ht(w,t[w],`unknown property "${w}"`)])}if(t.source){const w=c.sources&&c.sources[t.source],E=w&&ci(w.type);w?E!=="raster-dem"&&_.push(new ht(s,t.source,`terrain cannot be used with a source of type ${String(E)}, it only be used with a "raster-dem" source type`)):_.push(new ht(s,t.source,`source "${t.source}" not found`))}else _.push(new ht(s,t,'terrain is missing required property "source"'));return _}function gf(n){const t=n.value,s=n.style,c=n.styleSpec,f=c.fog;let p=[];const _=si(t);if(t===void 0)return p;if(_!=="object")return p=p.concat([new ht("fog",t,`object expected, ${_} found`)]),p;for(const v in t){const w=v.match(/^(.*)-transition$/);p=p.concat(w&&f[w[1]]&&f[w[1]].transition?ar({key:v,value:t[v],valueSpec:c.transition,style:s,styleSpec:c}):f[v]?ar({key:v,value:t[v],valueSpec:f[v],style:s,styleSpec:c}):[new ht(v,t[v],`unknown property "${v}"`)])}return p}const wu={"*":()=>[],array:_u,boolean:function(n){const t=n.value,s=n.key,c=si(t);return c!=="boolean"?[new ht(s,t,`boolean expected, ${c} found`)]:[]},number:yu,color:function(n){const t=n.key,s=n.value,c=si(s);return c!=="string"?[new ht(t,s,`color expected, ${c} found`)]:$.parseCSSColor(s)===null?[new ht(t,s,`color expected, "${s}" found`)]:[]},enum:Ra,filter:jo,function:ka,layer:Bl,object:Hr,source:pf,light:mf,terrain:Nl,fog:gf,string:Vo,formatted:function(n){return Vo(n).length===0?[]:xn(n)},resolvedImage:function(n){return Vo(n).length===0?[]:xn(n)},projection:function(n){const t=n.value,s=n.styleSpec,c=s.projection,f=n.style;let p=[];const _=si(t);if(_==="object")for(const v in t)p=p.concat(ar({key:v,value:t[v],valueSpec:c[v],style:f,styleSpec:s}));else _!=="string"&&(p=p.concat([new ht("projection",t,`object or string expected, ${_} found`)]));return p}};function ar(n){const t=n.value,s=n.valueSpec,c=n.styleSpec;return s.expression&&Pa(ci(t))?ka(n):s.expression&&Dl(sr(t))?xn(n):s.type&&wu[s.type]?wu[s.type](n):Hr(Ei({},n,{valueSpec:s.type?c[s.type]:s}))}function Rp(n){const t=n.value,s=n.key,c=Vo(n);return c.length||(t.indexOf("{fontstack}")===-1&&c.push(new ht(s,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&c.push(new ht(s,t,'"glyphs" url must include a "{range}" token'))),c}function Ul(n,t=Fe){return Qn(ar({key:"",value:n,valueSpec:t.$root,styleSpec:t,style:n,objectElementValidators:{glyphs:Rp,"*":()=>[]}}))}const jl=n=>Qn(ff(n)),_f=n=>Qn(df(n));function Qn(n){return n.slice().sort((t,s)=>t.line&&s.line?t.line-s.line:0)}function Tu(n,t){let s=!1;if(t&&t.length)for(const c of t)n.fire(new ni(new Error(c.message))),s=!0;return s}var Go=on;function on(n,t,s){var c=this.cells=[];if(n instanceof ArrayBuffer){this.arrayBuffer=n;var f=new Int32Array(this.arrayBuffer);n=f[0],this.d=(t=f[1])+2*(s=f[2]);for(var p=0;p<this.d*this.d;p++){var _=f[3+p],v=f[3+p+1];c.push(_===v?null:f.subarray(_,v))}var w=f[3+c.length+1];this.keys=f.subarray(f[3+c.length],w),this.bboxes=f.subarray(w),this.insert=this._insertReadonly}else{this.d=t+2*s;for(var E=0;E<this.d*this.d;E++)c.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=n,this.padding=s,this.scale=t/n,this.uid=0;var M=s/t*n;this.min=-M,this.max=n+M}on.prototype.insert=function(n,t,s,c,f){this._forEachCell(t,s,c,f,this._insertCell,this.uid++),this.keys.push(n),this.bboxes.push(t),this.bboxes.push(s),this.bboxes.push(c),this.bboxes.push(f)},on.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},on.prototype._insertCell=function(n,t,s,c,f,p){this.cells[f].push(p)},on.prototype.query=function(n,t,s,c,f){var p=this.min,_=this.max;if(n<=p&&t<=p&&_<=s&&_<=c&&!f)return Array.prototype.slice.call(this.keys);var v=[];return this._forEachCell(n,t,s,c,this._queryCell,v,{},f),v},on.prototype._queryCell=function(n,t,s,c,f,p,_,v){var w=this.cells[f];if(w!==null)for(var E=this.keys,M=this.bboxes,C=0;C<w.length;C++){var L=w[C];if(_[L]===void 0){var O=4*L;(v?v(M[O+0],M[O+1],M[O+2],M[O+3]):n<=M[O+2]&&t<=M[O+3]&&s>=M[O+0]&&c>=M[O+1])?(_[L]=!0,p.push(E[L])):_[L]=!1}}},on.prototype._forEachCell=function(n,t,s,c,f,p,_,v){for(var w=this._convertToCellCoord(n),E=this._convertToCellCoord(t),M=this._convertToCellCoord(s),C=this._convertToCellCoord(c),L=w;L<=M;L++)for(var O=E;O<=C;O++){var z=this.d*O+L;if((!v||v(this._convertFromCellCoord(L),this._convertFromCellCoord(O),this._convertFromCellCoord(L+1),this._convertFromCellCoord(O+1)))&&f.call(this,n,t,s,c,z,p,_,v))return}},on.prototype._convertFromCellCoord=function(n){return(n-this.padding)/this.scale},on.prototype._convertToCellCoord=function(n){return Math.max(0,Math.min(this.d-1,Math.floor(n*this.scale)+this.padding))},on.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var n=this.cells,t=3+this.cells.length+1+1,s=0,c=0;c<this.cells.length;c++)s+=this.cells[c].length;var f=new Int32Array(t+s+this.keys.length+this.bboxes.length);f[0]=this.extent,f[1]=this.n,f[2]=this.padding;for(var p=t,_=0;_<n.length;_++){var v=n[_];f[3+_]=p,f.set(v,p),p+=v.length}return f[3+n.length]=p,f.set(this.keys,p),f[3+n.length+1]=p+=this.keys.length,f.set(this.bboxes,p),p+=this.bboxes.length,f.buffer};const Vl={};function pt(n,t,s={}){Object.defineProperty(n,"_classRegistryKey",{value:t,writeable:!1}),Vl[t]={klass:n,omit:s.omit||[]}}pt(Object,"Object"),Go.serialize=function(n,t){const s=n.toArrayBuffer();return t&&t.push(s),{buffer:s}},Go.deserialize=function(n){return new Go(n.buffer)},Object.defineProperty(Go,"name",{value:"Grid"}),pt(Go,"Grid"),pt(ce,"Color"),pt(Error,"Error"),pt(Se,"AJAXError"),pt(Rt,"ResolvedImage"),pt(No,"StylePropertyFunction"),pt(pu,"StyleExpression",{omit:["_evaluator"]}),pt(La,"ZoomDependentExpression"),pt(mu,"ZoomConstantExpression"),pt(vn,"CompoundExpression",{omit:["_evaluate"]});for(const n in Ma)Vl[Ma[n]._classRegistryKey]||pt(Ma[n],`Expression${n}`);function yf(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}function vf(n){return P.ImageBitmap&&n instanceof P.ImageBitmap}function Zo(n,t){if(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp)return n;if(yf(n)||vf(n))return t&&t.push(n),n;if(ArrayBuffer.isView(n)){const s=n;return t&&t.push(s.buffer),s}if(n instanceof P.ImageData)return t&&t.push(n.data.buffer),n;if(Array.isArray(n)){const s=[];for(const c of n)s.push(Zo(c,t));return s}if(typeof n=="object"){const s=n.constructor,c=s._classRegistryKey;if(!c)throw new Error(`can't serialize object of unregistered class ${c}`);const f=s.serialize?s.serialize(n,t):{};if(!s.serialize){for(const p in n)n.hasOwnProperty(p)&&(Vl[c].omit.indexOf(p)>=0||(f[p]=Zo(n[p],t)));n instanceof Error&&(f.message=n.message)}if(f.$name)throw new Error("$name property is reserved for worker serialization logic.");return c!=="Object"&&(f.$name=c),f}throw new Error("can't serialize object of type "+typeof n)}function Fa(n){if(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||yf(n)||vf(n)||ArrayBuffer.isView(n)||n instanceof P.ImageData)return n;if(Array.isArray(n))return n.map(Fa);if(typeof n=="object"){const t=n.$name||"Object",{klass:s}=Vl[t];if(!s)throw new Error(`can't deserialize unregistered class ${t}`);if(s.deserialize)return s.deserialize(n);const c=Object.create(s.prototype);for(const f of Object.keys(n))f!=="$name"&&(c[f]=Fa(n[f]));return c}throw new Error("can't deserialize object of type "+typeof n)}class xf{constructor(){this.first=!0}update(t,s){const c=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=c,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=c,!0):(this.lastFloorZoom>c?(this.lastIntegerZoom=c+1,this.lastIntegerZoomTime=s):this.lastFloorZoom<c&&(this.lastIntegerZoom=c,this.lastIntegerZoomTime=s),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=c,!0))}}const bf=n=>n>=1536&&n<=1791,wf=n=>n>=1872&&n<=1919,Tf=n=>n>=2208&&n<=2303,Ef=n=>n>=11904&&n<=12031,Sf=n=>n>=12032&&n<=12255,Na=n=>n>=12272&&n<=12287,Gl=n=>n>=12288&&n<=12351,Eu=n=>n>=12352&&n<=12447,Js=n=>n>=12448&&n<=12543,Af=n=>n>=12544&&n<=12591,Su=n=>n>=12704&&n<=12735,Mf=n=>n>=12736&&n<=12783,Au=n=>n>=12784&&n<=12799,Mu=n=>n>=12800&&n<=13055,Pu=n=>n>=13056&&n<=13311,Iu=n=>n>=13312&&n<=19903,Ua=n=>n>=19968&&n<=40959,Zl=n=>n>=40960&&n<=42127,Pf=n=>n>=42128&&n<=42191,If=n=>n>=44032&&n<=55215,Cf=n=>n>=63744&&n<=64255,ja=n=>n>=64336&&n<=65023,Lf=n=>n>=65040&&n<=65055,Cu=n=>n>=65072&&n<=65103,kf=n=>n>=65104&&n<=65135,Lu=n=>n>=65136&&n<=65279,ku=n=>n>=65280&&n<=65519;function $l(n){for(const t of n)if(Wl(t.charCodeAt(0)))return!0;return!1}function Op(n){for(const t of n)if(!Dp(t.charCodeAt(0)))return!1;return!0}function Dp(n){return!(bf(n)||wf(n)||Tf(n)||ja(n)||Lu(n))}function Wl(n){return!(n!==746&&n!==747&&(n<4352||!(Su(n)||Af(n)||Cu(n)&&!(n>=65097&&n<=65103)||Cf(n)||Pu(n)||Ef(n)||Mf(n)||!(!Gl(n)||n>=12296&&n<=12305||n>=12308&&n<=12319||n===12336)||Iu(n)||Ua(n)||Mu(n)||(t=>t>=12592&&t<=12687)(n)||(t=>t>=43360&&t<=43391)(n)||(t=>t>=55216&&t<=55295)(n)||(t=>t>=4352&&t<=4607)(n)||If(n)||Eu(n)||Na(n)||(t=>t>=12688&&t<=12703)(n)||Sf(n)||Au(n)||Js(n)&&n!==12540||!(!ku(n)||n===65288||n===65289||n===65293||n>=65306&&n<=65310||n===65339||n===65341||n===65343||n>=65371&&n<=65503||n===65507||n>=65512&&n<=65519)||!(!kf(n)||n>=65112&&n<=65118||n>=65123&&n<=65126)||(t=>t>=5120&&t<=5759)(n)||(t=>t>=6320&&t<=6399)(n)||Lf(n)||(t=>t>=19904&&t<=19967)(n)||Zl(n)||Pf(n))))}function Va(n){return!(Wl(n)||function(t){return!!((s=>s>=128&&s<=255)(t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||(s=>s>=8192&&s<=8303)(t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||(s=>s>=8448&&s<=8527)(t)||(s=>s>=8528&&s<=8591)(t)||(s=>s>=8960&&s<=9215)(t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||(s=>s>=9216&&s<=9279)(t)&&t!==9251||(s=>s>=9280&&s<=9311)(t)||(s=>s>=9312&&s<=9471)(t)||(s=>s>=9632&&s<=9727)(t)||(s=>s>=9728&&s<=9983)(t)&&!(t>=9754&&t<=9759)||(s=>s>=11008&&s<=11263)(t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||Gl(t)||Js(t)||(s=>s>=57344&&s<=63743)(t)||Cu(t)||kf(t)||ku(t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(n))}function d(n){return n>=1424&&n<=2303||ja(n)||Lu(n)}function o(n,t){return!(!t&&d(n)||n>=2304&&n<=3583||n>=3840&&n<=4255||(s=>s>=6016&&s<=6143)(n))}function h(n){for(const t of n)if(d(t.charCodeAt(0)))return!0;return!1}const g="deferred",x="loading",b="loaded";let S=null,A="unavailable",I=null;const k=function(n){n&&typeof n=="string"&&n.indexOf("NetworkError")>-1&&(A="error"),S&&S(n)};function R(){U.fire(new ri("pluginStateChange",{pluginStatus:A,pluginURL:I}))}const U=new St,Z=function(){return A},J=function(){if(A!==g||!I)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");A=x,R(),I&&Me({url:I},n=>{n?k(n):(A=b,R())})},H={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>A===b||H.applyArabicShaping!=null,isLoading:()=>A===x,setState(n){A=n.pluginStatus,I=n.pluginURL},isParsed:()=>H.applyArabicShaping!=null&&H.processBidirectionalText!=null&&H.processStyledBidirectionalText!=null,getPluginURL:()=>I};class Y{constructor(t,s){this.zoom=t,s?(this.now=s.now,this.fadeDuration=s.fadeDuration,this.zoomHistory=s.zoomHistory,this.transition=s.transition,this.pitch=s.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new xf,this.transition={},this.pitch=0)}isSupportedScript(t){return function(s,c){for(const f of s)if(!o(f.charCodeAt(0),c))return!1;return!0}(t,H.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,s=t-Math.floor(t),c=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:s+(1-s)*c}:{fromScale:.5,toScale:1,t:1-(1-c)*s}}}class K{constructor(t,s){this.property=t,this.value=s,this.expression=function(c,f){if(Pa(c))return new No(c,f);if(Dl(c)){const p=gu(c,f);if(p.result==="error")throw new Error(p.value.map(_=>`${_.key}: ${_.message}`).join(", "));return p.value}{let p=c;return typeof c=="string"&&f.type==="color"&&(p=ce.parse(c)),{kind:"constant",evaluate:()=>p}}}(s===void 0?t.specification.default:s,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,s,c){return this.property.possiblyEvaluate(this,t,s,c)}}class X{constructor(t){this.property=t,this.value=new K(t,void 0)}transitioned(t,s){return new ee(this.property,this.value,s,gt({},t.transition,this.transition),t.now)}untransitioned(){return new ee(this.property,this.value,null,{},0)}}class ne{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return Dr(this._values[t].value.value)}setValue(t,s){this._values.hasOwnProperty(t)||(this._values[t]=new X(this._values[t].property)),this._values[t].value=new K(this._values[t].property,s===null?void 0:Dr(s))}getTransition(t){return Dr(this._values[t].transition)}setTransition(t,s){this._values.hasOwnProperty(t)||(this._values[t]=new X(this._values[t].property)),this._values[t].transition=Dr(s)||void 0}serialize(){const t={};for(const s of Object.keys(this._values)){const c=this.getValue(s);c!==void 0&&(t[s]=c);const f=this.getTransition(s);f!==void 0&&(t[`${s}-transition`]=f)}return t}transitioned(t,s){const c=new ve(this._properties);for(const f of Object.keys(this._values))c._values[f]=this._values[f].transitioned(t,s._values[f]);return c}untransitioned(){const t=new ve(this._properties);for(const s of Object.keys(this._values))t._values[s]=this._values[s].untransitioned();return t}}class ee{constructor(t,s,c,f,p){const _=f.delay||0,v=f.duration||0;p=p||0,this.property=t,this.value=s,this.begin=p+_,this.end=this.begin+v,t.specification.transition&&(f.delay||f.duration)&&(this.prior=c)}possiblyEvaluate(t,s,c){const f=t.now||0,p=this.value.possiblyEvaluate(t,s,c),_=this.prior;if(_){if(f>this.end)return this.prior=null,p;if(this.value.isDataDriven())return this.prior=null,p;if(f<this.begin)return _.possiblyEvaluate(t,s,c);{const v=(f-this.begin)/(this.end-this.begin);return this.property.interpolate(_.possiblyEvaluate(t,s,c),p,ke(v))}}return p}}class ve{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,s,c){const f=new _e(this._properties);for(const p of Object.keys(this._values))f._values[p]=this._values[p].possiblyEvaluate(t,s,c);return f}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class ge{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}getValue(t){return Dr(this._values[t].value)}setValue(t,s){this._values[t]=new K(this._values[t].property,s===null?void 0:Dr(s))}serialize(){const t={};for(const s of Object.keys(this._values)){const c=this.getValue(s);c!==void 0&&(t[s]=c)}return t}possiblyEvaluate(t,s,c){const f=new _e(this._properties);for(const p of Object.keys(this._values))f._values[p]=this._values[p].possiblyEvaluate(t,s,c);return f}}class ue{constructor(t,s,c){this.property=t,this.value=s,this.parameters=c}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,s,c,f){return this.property.evaluate(this.value,this.parameters,t,s,c,f)}}class _e{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class pe{constructor(t){this.specification=t}possiblyEvaluate(t,s){return t.expression.evaluate(s)}interpolate(t,s,c){const f=Ta[this.specification.type];return f?f(t,s,c):t}}class we{constructor(t,s){this.specification=t,this.overrides=s}possiblyEvaluate(t,s,c,f){return new ue(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(s,null,{},c,f)}:t.expression,s)}interpolate(t,s,c){if(t.value.kind!=="constant"||s.value.kind!=="constant")return t;if(t.value.value===void 0||s.value.value===void 0)return new ue(this,{kind:"constant",value:void 0},t.parameters);const f=Ta[this.specification.type];return f?new ue(this,{kind:"constant",value:f(t.value.value,s.value.value,c)},t.parameters):t}evaluate(t,s,c,f,p,_){return t.kind==="constant"?t.value:t.evaluate(s,c,f,p,_)}}class Ie extends we{possiblyEvaluate(t,s,c,f){if(t.value===void 0)return new ue(this,{kind:"constant",value:void 0},s);if(t.expression.kind==="constant"){const p=t.expression.evaluate(s,null,{},c,f),_=t.property.specification.type==="resolvedImage"&&typeof p!="string"?p.name:p,v=this._calculate(_,_,_,s);return new ue(this,{kind:"constant",value:v},s)}if(t.expression.kind==="camera"){const p=this._calculate(t.expression.evaluate({zoom:s.zoom-1}),t.expression.evaluate({zoom:s.zoom}),t.expression.evaluate({zoom:s.zoom+1}),s);return new ue(this,{kind:"constant",value:p},s)}return new ue(this,t.expression,s)}evaluate(t,s,c,f,p,_){if(t.kind==="source"){const v=t.evaluate(s,c,f,p,_);return this._calculate(v,v,v,s)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(s.zoom)-1},c,f),t.evaluate({zoom:Math.floor(s.zoom)},c,f),t.evaluate({zoom:Math.floor(s.zoom)+1},c,f),s):t.value}_calculate(t,s,c,f){return f.zoom>f.zoomHistory.lastIntegerZoom?{from:t,to:s,other:c}:{from:c,to:s,other:t}}interpolate(t){return t}}class Je{constructor(t){this.specification=t}possiblyEvaluate(t,s,c,f){if(t.value!==void 0){if(t.expression.kind==="constant"){const p=t.expression.evaluate(s,null,{},c,f);return this._calculate(p,p,p,s)}return this._calculate(t.expression.evaluate(new Y(Math.floor(s.zoom-1),s)),t.expression.evaluate(new Y(Math.floor(s.zoom),s)),t.expression.evaluate(new Y(Math.floor(s.zoom+1),s)),s)}}_calculate(t,s,c,f){return f.zoom>f.zoomHistory.lastIntegerZoom?{from:t,to:s}:{from:c,to:s}}interpolate(t){return t}}class Ae{constructor(t){this.specification=t}possiblyEvaluate(t,s,c,f){return!!t.expression.evaluate(s,null,{},c,f)}interpolate(){return!1}}class Ue{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const s=new Y(0,{});for(const c in t){const f=t[c];f.specification.overridable&&this.overridableProperties.push(c);const p=this.defaultPropertyValues[c]=new K(f,void 0),_=this.defaultTransitionablePropertyValues[c]=new X(f);this.defaultTransitioningPropertyValues[c]=_.untransitioned(),this.defaultPossiblyEvaluatedValues[c]=p.possiblyEvaluate(s)}}}function qe(n,t){return 256*(n=Re(Math.floor(n),0,255))+Re(Math.floor(t),0,255)}pt(we,"DataDrivenProperty"),pt(pe,"DataConstantProperty"),pt(Ie,"CrossFadedDataDrivenProperty"),pt(Je,"CrossFadedProperty"),pt(Ae,"ColorRampProperty");const rt={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Be{constructor(t,s){this._structArray=t,this._pos1=s*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class et{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,s){return t._trim(),s&&(t.isTransferred=!0,s.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const s=Object.create(this.prototype);return s.arrayBuffer=t.arrayBuffer,s.length=t.length,s.capacity=t.arrayBuffer.byteLength/s.bytesPerElement,s._refreshViews(),s}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const s=this.uint8;this._refreshViews(),s&&this.uint8.set(s)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function We(n,t=1){let s=0,c=0;return{members:n.map(f=>{const p=rt[f.type].BYTES_PER_ELEMENT,_=s=at(s,Math.max(t,p)),v=f.components||1;return c=Math.max(c,p),s+=p*v,{name:f.name,type:f.type,components:v,offset:_}}),size:at(s,Math.max(c,t)),alignment:t}}function at(n,t){return Math.ceil(n/t)*t}class st extends et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s){const c=this.length;return this.resize(c+1),this.emplace(c,t,s)}emplace(t,s,c){const f=2*t;return this.int16[f+0]=s,this.int16[f+1]=c,t}}st.prototype.bytesPerElement=4,pt(st,"StructArrayLayout2i4");class yt extends et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,c){const f=this.length;return this.resize(f+1),this.emplace(f,t,s,c)}emplace(t,s,c,f){const p=3*t;return this.int16[p+0]=s,this.int16[p+1]=c,this.int16[p+2]=f,t}}yt.prototype.bytesPerElement=6,pt(yt,"StructArrayLayout3i6");class At extends et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,c,f){const p=this.length;return this.resize(p+1),this.emplace(p,t,s,c,f)}emplace(t,s,c,f,p){const _=4*t;return this.int16[_+0]=s,this.int16[_+1]=c,this.int16[_+2]=f,this.int16[_+3]=p,t}}At.prototype.bytesPerElement=8,pt(At,"StructArrayLayout4i8");class kt extends et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,c,f,p,_,v){const w=this.length;return this.resize(w+1),this.emplace(w,t,s,c,f,p,_,v)}emplace(t,s,c,f,p,_,v,w){const E=6*t,M=12*t,C=3*t;return this.int16[E+0]=s,this.int16[E+1]=c,this.uint8[M+4]=f,this.uint8[M+5]=p,this.uint8[M+6]=_,this.uint8[M+7]=v,this.float32[C+2]=w,t}}kt.prototype.bytesPerElement=12,pt(kt,"StructArrayLayout2i4ub1f12");class Wt extends et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,c,f){const p=this.length;return this.resize(p+1),this.emplace(p,t,s,c,f)}emplace(t,s,c,f,p){const _=4*t;return this.float32[_+0]=s,this.float32[_+1]=c,this.float32[_+2]=f,this.float32[_+3]=p,t}}Wt.prototype.bytesPerElement=16,pt(Wt,"StructArrayLayout4f16");class vt extends et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,c,f,p,_,v,w,E,M){const C=this.length;return this.resize(C+1),this.emplace(C,t,s,c,f,p,_,v,w,E,M)}emplace(t,s,c,f,p,_,v,w,E,M,C){const L=10*t;return this.uint16[L+0]=s,this.uint16[L+1]=c,this.uint16[L+2]=f,this.uint16[L+3]=p,this.uint16[L+4]=_,this.uint16[L+5]=v,this.uint16[L+6]=w,this.uint16[L+7]=E,this.uint16[L+8]=M,this.uint16[L+9]=C,t}}vt.prototype.bytesPerElement=20,pt(vt,"StructArrayLayout10ui20");class Ft extends et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,c,f,p,_,v,w){const E=this.length;return this.resize(E+1),this.emplace(E,t,s,c,f,p,_,v,w)}emplace(t,s,c,f,p,_,v,w,E){const M=8*t;return this.uint16[M+0]=s,this.uint16[M+1]=c,this.uint16[M+2]=f,this.uint16[M+3]=p,this.uint16[M+4]=_,this.uint16[M+5]=v,this.uint16[M+6]=w,this.uint16[M+7]=E,t}}Ft.prototype.bytesPerElement=16,pt(Ft,"StructArrayLayout8ui16");class ei extends et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,c,f,p,_){const v=this.length;return this.resize(v+1),this.emplace(v,t,s,c,f,p,_)}emplace(t,s,c,f,p,_,v){const w=6*t;return this.int16[w+0]=s,this.int16[w+1]=c,this.int16[w+2]=f,this.int16[w+3]=p,this.int16[w+4]=_,this.int16[w+5]=v,t}}ei.prototype.bytesPerElement=12,pt(ei,"StructArrayLayout6i12");class xi extends et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,c,f,p,_,v,w,E,M,C,L){const O=this.length;return this.resize(O+1),this.emplace(O,t,s,c,f,p,_,v,w,E,M,C,L)}emplace(t,s,c,f,p,_,v,w,E,M,C,L,O){const z=12*t;return this.int16[z+0]=s,this.int16[z+1]=c,this.int16[z+2]=f,this.int16[z+3]=p,this.uint16[z+4]=_,this.uint16[z+5]=v,this.uint16[z+6]=w,this.uint16[z+7]=E,this.int16[z+8]=M,this.int16[z+9]=C,this.int16[z+10]=L,this.int16[z+11]=O,t}}xi.prototype.bytesPerElement=24,pt(xi,"StructArrayLayout4i4ui4i24");class Di extends et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,c,f,p,_){const v=this.length;return this.resize(v+1),this.emplace(v,t,s,c,f,p,_)}emplace(t,s,c,f,p,_,v){const w=10*t,E=5*t;return this.int16[w+0]=s,this.int16[w+1]=c,this.int16[w+2]=f,this.float32[E+2]=p,this.float32[E+3]=_,this.float32[E+4]=v,t}}Di.prototype.bytesPerElement=20,pt(Di,"StructArrayLayout3i3f20");class ui extends et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const s=this.length;return this.resize(s+1),this.emplace(s,t)}emplace(t,s){return this.uint32[1*t+0]=s,t}}ui.prototype.bytesPerElement=4,pt(ui,"StructArrayLayout1ul4");class lr extends et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,c,f,p,_,v,w,E,M,C,L,O){const z=this.length;return this.resize(z+1),this.emplace(z,t,s,c,f,p,_,v,w,E,M,C,L,O)}emplace(t,s,c,f,p,_,v,w,E,M,C,L,O,z){const G=20*t,q=10*t;return this.int16[G+0]=s,this.int16[G+1]=c,this.int16[G+2]=f,this.int16[G+3]=p,this.int16[G+4]=_,this.float32[q+3]=v,this.float32[q+4]=w,this.float32[q+5]=E,this.float32[q+6]=M,this.int16[G+14]=C,this.uint32[q+8]=L,this.uint16[G+18]=O,this.uint16[G+19]=z,t}}lr.prototype.bytesPerElement=40,pt(lr,"StructArrayLayout5i4f1i1ul2ui40");class bn extends et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,c,f,p,_,v){const w=this.length;return this.resize(w+1),this.emplace(w,t,s,c,f,p,_,v)}emplace(t,s,c,f,p,_,v,w){const E=8*t;return this.int16[E+0]=s,this.int16[E+1]=c,this.int16[E+2]=f,this.int16[E+4]=p,this.int16[E+5]=_,this.int16[E+6]=v,this.int16[E+7]=w,t}}bn.prototype.bytesPerElement=16,pt(bn,"StructArrayLayout3i2i2i16");class es extends et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,c,f,p){const _=this.length;return this.resize(_+1),this.emplace(_,t,s,c,f,p)}emplace(t,s,c,f,p,_){const v=4*t,w=8*t;return this.float32[v+0]=s,this.float32[v+1]=c,this.float32[v+2]=f,this.int16[w+6]=p,this.int16[w+7]=_,t}}es.prototype.bytesPerElement=16,pt(es,"StructArrayLayout2f1f2i16");class bi extends et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,c,f){const p=this.length;return this.resize(p+1),this.emplace(p,t,s,c,f)}emplace(t,s,c,f,p){const _=12*t,v=3*t;return this.uint8[_+0]=s,this.uint8[_+1]=c,this.float32[v+1]=f,this.float32[v+2]=p,t}}bi.prototype.bytesPerElement=12,pt(bi,"StructArrayLayout2ub2f12");class Ai extends et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,c){const f=this.length;return this.resize(f+1),this.emplace(f,t,s,c)}emplace(t,s,c,f){const p=3*t;return this.float32[p+0]=s,this.float32[p+1]=c,this.float32[p+2]=f,t}}Ai.prototype.bytesPerElement=12,pt(Ai,"StructArrayLayout3f12");class Zt extends et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,c){const f=this.length;return this.resize(f+1),this.emplace(f,t,s,c)}emplace(t,s,c,f){const p=3*t;return this.uint16[p+0]=s,this.uint16[p+1]=c,this.uint16[p+2]=f,t}}Zt.prototype.bytesPerElement=6,pt(Zt,"StructArrayLayout3ui6");class Gi extends et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,s,c,f,p,_,v,w,E,M,C,L,O,z,G,q,re,he,se,le,xe){const de=this.length;return this.resize(de+1),this.emplace(de,t,s,c,f,p,_,v,w,E,M,C,L,O,z,G,q,re,he,se,le,xe)}emplace(t,s,c,f,p,_,v,w,E,M,C,L,O,z,G,q,re,he,se,le,xe,de){const Oe=30*t,Le=15*t,Ne=60*t;return this.int16[Oe+0]=s,this.int16[Oe+1]=c,this.int16[Oe+2]=f,this.float32[Le+2]=p,this.float32[Le+3]=_,this.uint16[Oe+8]=v,this.uint16[Oe+9]=w,this.uint32[Le+5]=E,this.uint32[Le+6]=M,this.uint32[Le+7]=C,this.uint16[Oe+16]=L,this.uint16[Oe+17]=O,this.uint16[Oe+18]=z,this.float32[Le+10]=G,this.float32[Le+11]=q,this.uint8[Ne+48]=re,this.uint8[Ne+49]=he,this.uint8[Ne+50]=se,this.uint32[Le+13]=le,this.int16[Oe+28]=xe,this.uint8[Ne+58]=de,t}}Gi.prototype.bytesPerElement=60,pt(Gi,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class _r extends et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,s,c,f,p,_,v,w,E,M,C,L,O,z,G,q,re,he,se,le,xe,de,Oe,Le,Ne,it,ze,Ge,He,Ze){const Qe=this.length;return this.resize(Qe+1),this.emplace(Qe,t,s,c,f,p,_,v,w,E,M,C,L,O,z,G,q,re,he,se,le,xe,de,Oe,Le,Ne,it,ze,Ge,He,Ze)}emplace(t,s,c,f,p,_,v,w,E,M,C,L,O,z,G,q,re,he,se,le,xe,de,Oe,Le,Ne,it,ze,Ge,He,Ze,Qe){const Ye=38*t,ut=19*t;return this.int16[Ye+0]=s,this.int16[Ye+1]=c,this.int16[Ye+2]=f,this.float32[ut+2]=p,this.float32[ut+3]=_,this.int16[Ye+8]=v,this.int16[Ye+9]=w,this.int16[Ye+10]=E,this.int16[Ye+11]=M,this.int16[Ye+12]=C,this.int16[Ye+13]=L,this.uint16[Ye+14]=O,this.uint16[Ye+15]=z,this.uint16[Ye+16]=G,this.uint16[Ye+17]=q,this.uint16[Ye+18]=re,this.uint16[Ye+19]=he,this.uint16[Ye+20]=se,this.uint16[Ye+21]=le,this.uint16[Ye+22]=xe,this.uint16[Ye+23]=de,this.uint16[Ye+24]=Oe,this.uint16[Ye+25]=Le,this.uint16[Ye+26]=Ne,this.uint16[Ye+27]=it,this.uint16[Ye+28]=ze,this.uint32[ut+15]=Ge,this.float32[ut+16]=He,this.float32[ut+17]=Ze,this.float32[ut+18]=Qe,t}}_r.prototype.bytesPerElement=76,pt(_r,"StructArrayLayout3i2f6i15ui1ul3f76");class pi extends et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const s=this.length;return this.resize(s+1),this.emplace(s,t)}emplace(t,s){return this.float32[1*t+0]=s,t}}pi.prototype.bytesPerElement=4,pt(pi,"StructArrayLayout1f4");class yr extends et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,c,f,p){const _=this.length;return this.resize(_+1),this.emplace(_,t,s,c,f,p)}emplace(t,s,c,f,p,_){const v=5*t;return this.float32[v+0]=s,this.float32[v+1]=c,this.float32[v+2]=f,this.float32[v+3]=p,this.float32[v+4]=_,t}}yr.prototype.bytesPerElement=20,pt(yr,"StructArrayLayout5f20");class Qs extends et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,c,f){const p=this.length;return this.resize(p+1),this.emplace(p,t,s,c,f)}emplace(t,s,c,f,p){const _=6*t;return this.uint32[3*t+0]=s,this.uint16[_+2]=c,this.uint16[_+3]=f,this.uint16[_+4]=p,t}}Qs.prototype.bytesPerElement=12,pt(Qs,"StructArrayLayout1ul3ui12");class Pr extends et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s){const c=this.length;return this.resize(c+1),this.emplace(c,t,s)}emplace(t,s,c){const f=2*t;return this.uint16[f+0]=s,this.uint16[f+1]=c,t}}Pr.prototype.bytesPerElement=4,pt(Pr,"StructArrayLayout2ui4");class eo extends et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const s=this.length;return this.resize(s+1),this.emplace(s,t)}emplace(t,s){return this.uint16[1*t+0]=s,t}}eo.prototype.bytesPerElement=2,pt(eo,"StructArrayLayout1ui2");class to extends et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s){const c=this.length;return this.resize(c+1),this.emplace(c,t,s)}emplace(t,s,c){const f=2*t;return this.float32[f+0]=s,this.float32[f+1]=c,t}}to.prototype.bytesPerElement=8,pt(to,"StructArrayLayout2f8");class io extends Be{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}io.prototype.size=12;class Ir extends ei{get(t){return new io(this,t)}}pt(Ir,"FillExtrusionExtArray");class ro extends Be{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}ro.prototype.size=40;class Ts extends lr{get(t){return new ro(this,t)}}pt(Ts,"CollisionBoxArray");class Ga extends Be{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(t){this._structArray.uint8[this._pos1+49]=t}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(t){this._structArray.uint8[this._pos1+50]=t}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(t){this._structArray.uint32[this._pos4+13]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(t){this._structArray.uint8[this._pos1+58]=t}}Ga.prototype.size=60;class Z_ extends Gi{get(t){return new Ga(this,t)}}pt(Z_,"PlacedSymbolArray");class $_ extends Be{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(t){this._structArray.uint32[this._pos4+15]=t}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}$_.prototype.size=76;class W_ extends _r{get(t){return new $_(this,t)}}pt(W_,"SymbolInstanceArray");class q_ extends pi{getoffsetX(t){return this.float32[1*t+0]}}pt(q_,"GlyphOffsetArray");class X_ extends yt{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}pt(X_,"SymbolLineVertexArray");class H_ extends Be{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}H_.prototype.size=12;class Y_ extends Qs{get(t){return new H_(this,t)}}pt(Y_,"FeatureIndexArray");class K_ extends Be{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}K_.prototype.size=4;class J_ extends Pr{get(t){return new K_(this,t)}}pt(J_,"FillExtrusionCentroidArray");class Q_ extends Be{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}Q_.prototype.size=12;class ey extends ei{get(t){return new Q_(this,t)}}pt(ey,"CircleGlobeExtArray");const aT=We([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),lT=We([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var ty=ya(function(n){n.exports=function(t,s){var c,f,p,_,v,w,E,M;for(f=t.length-(c=3&t.length),p=s,v=3432918353,w=461845907,M=0;M<f;)E=255&t.charCodeAt(M)|(255&t.charCodeAt(++M))<<8|(255&t.charCodeAt(++M))<<16|(255&t.charCodeAt(++M))<<24,++M,p=27492+(65535&(_=5*(65535&(p=(p^=E=(65535&(E=(E=(65535&E)*v+(((E>>>16)*v&65535)<<16)&4294967295)<<15|E>>>17))*w+(((E>>>16)*w&65535)<<16)&4294967295)<<13|p>>>19))+((5*(p>>>16)&65535)<<16)&4294967295))+((58964+(_>>>16)&65535)<<16);switch(E=0,c){case 3:E^=(255&t.charCodeAt(M+2))<<16;case 2:E^=(255&t.charCodeAt(M+1))<<8;case 1:p^=E=(65535&(E=(E=(65535&(E^=255&t.charCodeAt(M)))*v+(((E>>>16)*v&65535)<<16)&4294967295)<<15|E>>>17))*w+(((E>>>16)*w&65535)<<16)&4294967295}return p^=t.length,p=2246822507*(65535&(p^=p>>>16))+((2246822507*(p>>>16)&65535)<<16)&4294967295,p=3266489909*(65535&(p^=p>>>13))+((3266489909*(p>>>16)&65535)<<16)&4294967295,(p^=p>>>16)>>>0}}),cT=ya(function(n){n.exports=function(t,s){for(var c,f=t.length,p=s^f,_=0;f>=4;)c=1540483477*(65535&(c=255&t.charCodeAt(_)|(255&t.charCodeAt(++_))<<8|(255&t.charCodeAt(++_))<<16|(255&t.charCodeAt(++_))<<24))+((1540483477*(c>>>16)&65535)<<16),p=1540483477*(65535&p)+((1540483477*(p>>>16)&65535)<<16)^(c=1540483477*(65535&(c^=c>>>24))+((1540483477*(c>>>16)&65535)<<16)),f-=4,++_;switch(f){case 3:p^=(255&t.charCodeAt(_+2))<<16;case 2:p^=(255&t.charCodeAt(_+1))<<8;case 1:p=1540483477*(65535&(p^=255&t.charCodeAt(_)))+((1540483477*(p>>>16)&65535)<<16)}return p=1540483477*(65535&(p^=p>>>13))+((1540483477*(p>>>16)&65535)<<16),(p^=p>>>15)>>>0}}),Ru=ty,uT=cT;Ru.murmur3=ty,Ru.murmur2=uT;class Rf{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,s,c,f){this.ids.push(iy(t)),this.positions.push(s,c,f)}getPositions(t){const s=iy(t);let c=0,f=this.ids.length-1;for(;c<f;){const _=c+f>>1;this.ids[_]>=s?f=_:c=_+1}const p=[];for(;this.ids[c]===s;)p.push({index:this.positions[3*c],start:this.positions[3*c+1],end:this.positions[3*c+2]}),c++;return p}static serialize(t,s){const c=new Float64Array(t.ids),f=new Uint32Array(t.positions);return zp(c,f,0,c.length-1),s&&s.push(c.buffer,f.buffer),{ids:c,positions:f}}static deserialize(t){const s=new Rf;return s.ids=t.ids,s.positions=t.positions,s.indexed=!0,s}}function iy(n){const t=+n;return!isNaN(t)&&Number.MIN_SAFE_INTEGER<=t&&t<=Number.MAX_SAFE_INTEGER?t:Ru(String(n))}function zp(n,t,s,c){for(;s<c;){const f=n[s+c>>1];let p=s-1,_=c+1;for(;;){do p++;while(n[p]<f);do _--;while(n[_]>f);if(p>=_)break;Of(n,p,_),Of(t,3*p,3*_),Of(t,3*p+1,3*_+1),Of(t,3*p+2,3*_+2)}_-s<c-_?(zp(n,t,s,_),s=_+1):(zp(n,t,_+1,c),c=_)}}function Of(n,t,s){const c=n[t];n[t]=n[s],n[s]=c}pt(Rf,"FeaturePositionMap");class no{constructor(t){this.gl=t.gl,this.initialized=!1}fetchUniformLocation(t,s){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(t,s),this.initialized=!0),!!this.location}}class Df extends no{constructor(t){super(t),this.current=0}set(t,s,c){this.fetchUniformLocation(t,s)&&this.current!==c&&(this.current=c,this.gl.uniform1f(this.location,c))}}class ry extends no{constructor(t){super(t),this.current=[0,0,0,0]}set(t,s,c){this.fetchUniformLocation(t,s)&&(c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]&&c[3]===this.current[3]||(this.current=c,this.gl.uniform4f(this.location,c[0],c[1],c[2],c[3])))}}class ny extends no{constructor(t){super(t),this.current=ce.transparent}set(t,s,c){this.fetchUniformLocation(t,s)&&(c.r===this.current.r&&c.g===this.current.g&&c.b===this.current.b&&c.a===this.current.a||(this.current=c,this.gl.uniform4f(this.location,c.r,c.g,c.b,c.a)))}}const hT=new Float32Array(16),fT=new Float32Array(9),dT=new Float32Array(4);function Bp(n){return[qe(255*n.r,255*n.g),qe(255*n.b,255*n.a)]}class Ou{constructor(t,s,c){this.value=t,this.uniformNames=s.map(f=>`u_${f}`),this.type=c}setUniform(t,s,c,f,p){s.set(t,p,f.constantOr(this.value))}getBinding(t,s){return this.type==="color"?new ny(t):new Df(t)}}class ql{constructor(t,s){this.uniformNames=s.map(c=>`u_${c}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,s){this.pixelRatioFrom=s.pixelRatio||1,this.pixelRatioTo=t.pixelRatio||1,this.patternFrom=s.tl.concat(s.br),this.patternTo=t.tl.concat(t.br)}setUniform(t,s,c,f,p){const _=p==="u_pattern_to"||p==="u_dash_to"?this.patternTo:p==="u_pattern_from"||p==="u_dash_from"?this.patternFrom:p==="u_pixel_ratio_to"?this.pixelRatioTo:p==="u_pixel_ratio_from"?this.pixelRatioFrom:null;_&&s.set(t,p,_)}getBinding(t,s){return s==="u_pattern_from"||s==="u_pattern_to"||s==="u_dash_from"||s==="u_dash_to"?new ry(t):new Df(t)}}class so{constructor(t,s,c,f){this.expression=t,this.type=c,this.maxValue=0,this.paintVertexAttributes=s.map(p=>({name:`a_${p}`,type:"Float32",components:c==="color"?2:1,offset:0})),this.paintVertexArray=new f}populatePaintArray(t,s,c,f,p,_){const v=this.paintVertexArray.length,w=this.expression.evaluate(new Y(0),s,{},p,f,_);this.paintVertexArray.resize(t),this._setPaintValue(v,t,w)}updatePaintArray(t,s,c,f,p){const _=this.expression.evaluate({zoom:0},c,f,void 0,p);this._setPaintValue(t,s,_)}_setPaintValue(t,s,c){if(this.type==="color"){const f=Bp(c);for(let p=t;p<s;p++)this.paintVertexArray.emplace(p,f[0],f[1])}else{for(let f=t;f<s;f++)this.paintVertexArray.emplace(f,c);this.maxValue=Math.max(this.maxValue,Math.abs(c))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ts{constructor(t,s,c,f,p,_){this.expression=t,this.uniformNames=s.map(v=>`u_${v}_t`),this.type=c,this.useIntegerZoom=f,this.zoom=p,this.maxValue=0,this.paintVertexAttributes=s.map(v=>({name:`a_${v}`,type:"Float32",components:c==="color"?4:2,offset:0})),this.paintVertexArray=new _}populatePaintArray(t,s,c,f,p,_){const v=this.expression.evaluate(new Y(this.zoom),s,{},p,f,_),w=this.expression.evaluate(new Y(this.zoom+1),s,{},p,f,_),E=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(E,t,v,w)}updatePaintArray(t,s,c,f,p){const _=this.expression.evaluate({zoom:this.zoom},c,f,void 0,p),v=this.expression.evaluate({zoom:this.zoom+1},c,f,void 0,p);this._setPaintValue(t,s,_,v)}_setPaintValue(t,s,c,f){if(this.type==="color"){const p=Bp(c),_=Bp(f);for(let v=t;v<s;v++)this.paintVertexArray.emplace(v,p[0],p[1],_[0],_[1])}else{for(let p=t;p<s;p++)this.paintVertexArray.emplace(p,c,f);this.maxValue=Math.max(this.maxValue,Math.abs(c),Math.abs(f))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,s,c,f,p){const _=this.useIntegerZoom?Math.floor(c.zoom):c.zoom,v=Re(this.expression.interpolationFactor(_,this.zoom,this.zoom+1),0,1);s.set(t,p,v)}getBinding(t,s){return new Df(t)}}class $o{constructor(t,s,c,f,p,_,v){this.expression=t,this.type=c,this.useIntegerZoom=f,this.zoom=p,this.layerId=v,this.paintVertexAttributes=(c==="array"?lT:aT).members;for(let w=0;w<s.length;++w);this.zoomInPaintVertexArray=new _,this.zoomOutPaintVertexArray=new _}populatePaintArray(t,s,c){const f=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(f,t,s.patterns&&s.patterns[this.layerId],c)}updatePaintArray(t,s,c,f,p,_){this._setPaintValues(t,s,c.patterns&&c.patterns[this.layerId],_)}_setPaintValues(t,s,c,f){if(!f||!c)return;const{min:p,mid:_,max:v}=c,w=f[p],E=f[_],M=f[v];if(w&&E&&M)for(let C=t;C<s;C++)this._setPaintValue(this.zoomInPaintVertexArray,C,E,w),this._setPaintValue(this.zoomOutPaintVertexArray,C,E,M)}_setPaintValue(t,s,c,f){t.emplace(s,c.tl[0],c.tl[1],c.br[0],c.br[1],f.tl[0],f.tl[1],f.br[0],f.br[1],c.pixelRatio,f.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Wo{constructor(t,s,c=()=>!0){this.binders={},this._buffers=[];const f=[];for(const p in t.paint._values){if(!c(p))continue;const _=t.paint.get(p);if(!(_ instanceof ue&&zo(_.property.specification)))continue;const v=mT(p,t.type),w=_.value,E=_.property.specification.type,M=_.property.useIntegerZoom,C=_.property.specification["property-type"],L=C==="cross-faded"||C==="cross-faded-data-driven",O=String(p)==="line-dasharray"&&t.layout.get("line-cap").value.kind!=="constant";if(w.kind!=="constant"||O)if(w.kind==="source"||O||L){const z=sy(p,E,"source");this.binders[p]=L?new $o(w,v,E,M,s,z,t.id):new so(w,v,E,z),f.push(`/a_${p}`)}else{const z=sy(p,E,"composite");this.binders[p]=new ts(w,v,E,M,s,z),f.push(`/z_${p}`)}else this.binders[p]=L?new ql(w.value,v):new Ou(w.value,v,E),f.push(`/u_${p}`)}this.cacheKey=f.sort().join("")}getMaxValue(t){const s=this.binders[t];return s instanceof so||s instanceof ts?s.maxValue:0}populatePaintArrays(t,s,c,f,p,_){for(const v in this.binders){const w=this.binders[v];(w instanceof so||w instanceof ts||w instanceof $o)&&w.populatePaintArray(t,s,c,f,p,_)}}setConstantPatternPositions(t,s){for(const c in this.binders){const f=this.binders[c];f instanceof ql&&f.setConstantPatternPositions(t,s)}}updatePaintArrays(t,s,c,f,p,_){let v=!1;for(const w in t){const E=s.getPositions(w);for(const M of E){const C=c.feature(M.index);for(const L in this.binders){const O=this.binders[L];if((O instanceof so||O instanceof ts||O instanceof $o)&&O.expression.isStateDependent===!0){const z=f.paint.get(L);O.expression=z.value,O.updatePaintArray(M.start,M.end,C,t[w],p,_),v=!0}}}}return v}defines(){const t=[];for(const s in this.binders){const c=this.binders[s];(c instanceof Ou||c instanceof ql)&&t.push(...c.uniformNames.map(f=>`#define HAS_UNIFORM_${f}`))}return t}getBinderAttributes(){const t=[];for(const s in this.binders){const c=this.binders[s];if(c instanceof so||c instanceof ts||c instanceof $o)for(let f=0;f<c.paintVertexAttributes.length;f++)t.push(c.paintVertexAttributes[f].name)}return t}getBinderUniforms(){const t=[];for(const s in this.binders){const c=this.binders[s];if(c instanceof Ou||c instanceof ql||c instanceof ts)for(const f of c.uniformNames)t.push(f)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t){const s=[];for(const c in this.binders){const f=this.binders[c];if(f instanceof Ou||f instanceof ql||f instanceof ts)for(const p of f.uniformNames)s.push({name:p,property:c,binding:f.getBinding(t,p)})}return s}setUniforms(t,s,c,f,p){for(const{name:_,property:v,binding:w}of c)this.binders[v].setUniform(t,w,p,f.get(v),_)}updatePaintBuffers(t){this._buffers=[];for(const s in this.binders){const c=this.binders[s];if(t&&c instanceof $o){const f=t.fromScale===2?c.zoomInPaintVertexBuffer:c.zoomOutPaintVertexBuffer;f&&this._buffers.push(f)}else(c instanceof so||c instanceof ts)&&c.paintVertexBuffer&&this._buffers.push(c.paintVertexBuffer)}}upload(t){for(const s in this.binders){const c=this.binders[s];(c instanceof so||c instanceof ts||c instanceof $o)&&c.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const s=this.binders[t];(s instanceof so||s instanceof ts||s instanceof $o)&&s.destroy()}}}class Za{constructor(t,s,c=()=>!0){this.programConfigurations={};for(const f of t)this.programConfigurations[f.id]=new Wo(f,s,c);this.needsUpload=!1,this._featureMap=new Rf,this._bufferOffset=0}populatePaintArrays(t,s,c,f,p,_,v){for(const w in this.programConfigurations)this.programConfigurations[w].populatePaintArrays(t,s,f,p,_,v);s.id!==void 0&&this._featureMap.add(s.id,c,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,s,c,f,p){for(const _ of c)this.needsUpload=this.programConfigurations[_.id].updatePaintArrays(t,this._featureMap,s,_,f,p)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const s in this.programConfigurations)this.programConfigurations[s].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}const pT={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function mT(n,t){return pT[n]||[n.replace(`${t}-`,"").replace(/-/g,"_")]}const gT={"line-pattern":{source:vt,composite:vt},"fill-pattern":{source:vt,composite:vt},"fill-extrusion-pattern":{source:vt,composite:vt},"line-dasharray":{source:Ft,composite:Ft}},_T={color:{source:to,composite:Wt},number:{source:pi,composite:to}};function sy(n,t,s){const c=gT[n];return c&&c[s]||_T[t][s]}pt(Ou,"ConstantBinder"),pt(ql,"CrossFadedConstantBinder"),pt(so,"SourceExpressionBinder"),pt($o,"CrossFadedCompositeBinder"),pt(ts,"CompositeExpressionBinder"),pt(Wo,"ProgramConfiguration",{omit:["_buffers"]}),pt(Za,"ProgramConfigurationSet");const zf="-transition";class is extends St{constructor(t,s){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,t.type!=="custom"&&(this.metadata=(t=t).metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&t.type!=="sky"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),s.layout&&(this._unevaluatedLayout=new ge(s.layout)),s.paint)){this._transitionablePaint=new ne(s.paint);for(const c in t.paint)this.setPaintProperty(c,t.paint[c],{validate:!1});for(const c in t.layout)this.setLayoutProperty(c,t.layout[c],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new _e(s.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,s,c={}){s!=null&&this._validate(_f,`layers.${this.id}.layout.${t}`,t,s,c)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,s):this.visibility=s)}getPaintProperty(t){return ds(t,zf)?this._transitionablePaint.getTransition(t.slice(0,-zf.length)):this._transitionablePaint.getValue(t)}setPaintProperty(t,s,c={}){if(s!=null&&this._validate(jl,`layers.${this.id}.paint.${t}`,t,s,c))return!1;if(ds(t,zf))return this._transitionablePaint.setTransition(t.slice(0,-zf.length),s||void 0),!1;{const f=this._transitionablePaint._values[t],p=f.property.specification["property-type"]==="cross-faded-data-driven",_=f.value.isDataDriven(),v=f.value;this._transitionablePaint.setValue(t,s),this._handleSpecialPaintPropertyUpdate(t);const w=this._transitionablePaint._values[t].value;return w.isDataDriven()||_||p||this._handleOverridablePaintPropertyUpdate(t,v,w)}}_handleSpecialPaintPropertyUpdate(t){}getProgramIds(){return null}getProgramConfiguration(t){return null}_handleOverridablePaintPropertyUpdate(t,s,c){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,s){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,s)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,s)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),Wn(t,(s,c)=>!(s===void 0||c==="layout"&&!Object.keys(s).length||c==="paint"&&!Object.keys(s).length))}_validate(t,s,c,f,p={}){return(!p||p.validate!==!1)&&Tu(this,t.call(Ul,{key:s,layerType:this.type,objectKey:c,value:f,styleSpec:Fe,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const s=this.paint.get(t);if(s instanceof ue&&zo(s.property.specification)&&(s.value.kind==="source"||s.value.kind==="composite")&&s.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Da(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const yT=We([{name:"a_pos",components:2,type:"Int16"}],4),vT=We([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Xi{constructor(t=[]){this.segments=t}prepareSegment(t,s,c,f){let p=this.segments[this.segments.length-1];return t>Xi.MAX_VERTEX_ARRAY_LENGTH&&Ci(`Max vertices per segment is ${Xi.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!p||p.vertexLength+t>Xi.MAX_VERTEX_ARRAY_LENGTH||p.sortKey!==f)&&(p={vertexOffset:s.length,primitiveOffset:c.length,vertexLength:0,primitiveLength:0},f!==void 0&&(p.sortKey=f),this.segments.push(p)),p}get(){return this.segments}destroy(){for(const t of this.segments)for(const s in t.vaos)t.vaos[s].destroy()}static simpleSegment(t,s,c,f){return new Xi([{vertexOffset:t,primitiveOffset:s,vertexLength:c,primitiveLength:f,vaos:{},sortKey:0}])}}Xi.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,pt(Xi,"SegmentVector");var It=8192;class qo{constructor(t,s){t&&(s?this.setSouthWest(t).setNorthEast(s):t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))}setNorthEast(t){return this._ne=t instanceof li?new li(t.lng,t.lat):li.convert(t),this}setSouthWest(t){return this._sw=t instanceof li?new li(t.lng,t.lat):li.convert(t),this}extend(t){const s=this._sw,c=this._ne;let f,p;if(t instanceof li)f=t,p=t;else{if(!(t instanceof qo))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(qo.convert(t)):this.extend(li.convert(t)):this;if(f=t._sw,p=t._ne,!f||!p)return this}return s||c?(s.lng=Math.min(f.lng,s.lng),s.lat=Math.min(f.lat,s.lat),c.lng=Math.max(p.lng,c.lng),c.lat=Math.max(p.lat,c.lat)):(this._sw=new li(f.lng,f.lat),this._ne=new li(p.lng,p.lat)),this}getCenter(){return new li((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new li(this.getWest(),this.getNorth())}getSouthEast(){return new li(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:s,lat:c}=li.convert(t);let f=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(f=this._sw.lng>=s&&s>=this._ne.lng),this._sw.lat<=c&&c<=this._ne.lat&&f}static convert(t){return!t||t instanceof qo?t:new qo(t)}}const Fp=63710088e-1;class li{constructor(t,s){if(isNaN(t)||isNaN(s))throw new Error(`Invalid LngLat object: (${t}, ${s})`);if(this.lng=+t,this.lat=+s,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new li(bt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const s=Math.PI/180,c=this.lat*s,f=t.lat*s,p=Math.sin(c)*Math.sin(f)+Math.cos(c)*Math.cos(f)*Math.cos((t.lng-this.lng)*s);return Fp*Math.acos(Math.min(p,1))}toBounds(t=0){const s=360*t/40075017,c=s/Math.cos(Math.PI/180*this.lat);return new qo(new li(this.lng-c,this.lat-s),new li(this.lng+c,this.lat+s))}static convert(t){if(t instanceof li)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new li(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new li(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const oy=2*Math.PI*Fp;function Np(n){return oy*Math.cos(n*Math.PI/180)}function Es(n){return(180+n)/360}function oo(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function Bn(n,t){return n/Np(t)}function Fn(n){return 360*n-180}function vr(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}function ay(n,t){return n*Np(vr(t))}const Ss=85.051129;function ly(n){return 1/Math.cos(n*Math.PI/180)}class Xl{constructor(t,s,c=0){this.x=+t,this.y=+s,this.z=+c}static fromLngLat(t,s=0){const c=li.convert(t);return new Xl(Es(c.lng),oo(c.lat),Bn(s,c.lat))}toLngLat(){return new li(Fn(this.x),vr(this.y))}toAltitude(){return ay(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/oy*ly(vr(this.y))}}function Up(n,t,s,c,f,p,_,v,w){const E=(t+c)/2,M=(s+f)/2,C=new F(E,M);v(C),function(L,O,z,G,q,re){const he=z-q,se=G-re;return Math.abs((G-O)*he-(z-L)*se)/Math.hypot(he,se)}(C.x,C.y,p.x,p.y,_.x,_.y)>=w?(Up(n,t,s,E,M,p,C,v,w),Up(n,E,M,c,f,C,_,v,w)):n.push(_)}function cy(n,t,s){let c=n[0],f=c.x,p=c.y;t(c);const _=[c];for(let v=1;v<n.length;v++){const w=n[v],{x:E,y:M}=w;t(w),Up(_,f,p,E,M,c,w,t,s),f=E,p=M,c=w}return _}function jp(n,t,s,c,f){if(f(t,s)){const p=t.add(s).mult(.5);c(p),jp(n,t,p,c,f),jp(n,p,s,c,f)}else n.push(s)}function xT(n,t,s){let c=n[0];const f=[c];for(let p=1;p<n.length;p++){const _=n[p];jp(f,c,_,t,s),c=_}return f}const Vp=Math.pow(2,14)-1,uy=-Vp-1;function bT(n,t){const s=Math.round(n.x*t),c=Math.round(n.y*t);return n.x=Re(s,uy,Vp),n.y=Re(c,uy,Vp),(s<n.x||s>n.x+1||c<n.y||c>n.y+1)&&Ci("Geometry exceeds allowed extent, reduce your vector tile buffer size"),n}function ao(n,t,s){const c=n.loadGeometry(),f=n.extent,p=It/f;if(t&&s&&s.projection.isReprojectedInTileSpace){const _=1<<t.z,{scale:v,x:w,y:E,projection:M}=s,C=L=>{const O=Fn((t.x+L.x/f)/_),z=vr((t.y+L.y/f)/_),G=M.project(O,z);L.x=(G.x*v-w)*f,L.y=(G.y*v-E)*f};for(let L=0;L<c.length;L++)if(n.type!==1)c[L]=cy(c[L],C,1);else{const O=[];for(const z of c[L])z.x<0||z.x>=f||z.y<0||z.y>=f||(C(z),O.push(z));c[L]=O}}for(const _ of c)for(const v of _)bT(v,p);return c}function $a(n,t){return{type:n.type,id:n.id,properties:n.properties,geometry:t?ao(n):[]}}function Bf(n,t,s,c,f){n.emplaceBack(2*t+(c+1)/2,2*s+(f+1)/2)}function Ff(n,t,s){n.emplaceBack(t.x,t.y,t.z,s[0]*16384,s[1]*16384,s[2]*16384)}class Gp{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.id),this.index=t.index,this.hasPattern=!1,this.projection=t.projection,this.layoutVertexArray=new st,this.indexArray=new Zt,this.segments=new Xi,this.programConfigurations=new Za(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(t,s,c,f){const p=this.layers[0],_=[];let v=null;p.type==="circle"&&(v=p.layout.get("circle-sort-key"));for(const{feature:E,id:M,index:C,sourceLayerIndex:L}of t){const O=this.layers[0]._featureFilter.needGeometry,z=$a(E,O);if(!this.layers[0]._featureFilter.filter(new Y(this.zoom),z,c))continue;const G=v?v.evaluate(z,{},c):void 0,q={id:M,properties:E.properties,type:E.type,sourceLayerIndex:L,index:C,geometry:O?z.geometry:ao(E,c,f),patterns:{},sortKey:G};_.push(q)}v&&_.sort((E,M)=>E.sortKey-M.sortKey);let w=null;f.projection.name==="globe"&&(this.globeExtVertexArray=new ey,w=f.projection);for(const E of _){const{geometry:M,index:C,sourceLayerIndex:L}=E,O=t[C].feature;this.addFeature(E,M,C,s.availableImages,c,w),s.featureIndex.insert(O,M,C,L,this.index)}}update(t,s,c,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,s,this.stateDependentLayers,c,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,yT.members),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,vT.members))),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(t,s,c,f,p,_){for(const v of s)for(const w of v){const E=w.x,M=w.y;if(E<0||E>=It||M<0||M>=It)continue;if(_){const O=_.projectTilePoint(E,M,p),z=_.upVector(p,E,M),G=this.globeExtVertexArray;Ff(G,O,z),Ff(G,O,z),Ff(G,O,z),Ff(G,O,z)}const C=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),L=C.vertexLength;Bf(this.layoutVertexArray,E,M,-1,-1),Bf(this.layoutVertexArray,E,M,1,-1),Bf(this.layoutVertexArray,E,M,1,1),Bf(this.layoutVertexArray,E,M,-1,1),this.indexArray.emplaceBack(L,L+1,L+2),this.indexArray.emplaceBack(L,L+2,L+3),C.vertexLength+=4,C.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,c,{},f,p)}}function hy(n,t){for(let s=0;s<n.length;s++)if(Wa(t,n[s]))return!0;for(let s=0;s<t.length;s++)if(Wa(n,t[s]))return!0;return!!Zp(n,t)}function wT(n,t,s){return!!Wa(n,t)||!!$p(t,n,s)}function fy(n,t){if(n.length===1)return py(t,n[0]);for(let s=0;s<t.length;s++){const c=t[s];for(let f=0;f<c.length;f++)if(Wa(n,c[f]))return!0}for(let s=0;s<n.length;s++)if(py(t,n[s]))return!0;for(let s=0;s<t.length;s++)if(Zp(n,t[s]))return!0;return!1}function TT(n,t,s){if(n.length>1){if(Zp(n,t))return!0;for(let c=0;c<t.length;c++)if($p(t[c],n,s))return!0}for(let c=0;c<n.length;c++)if($p(n[c],t,s))return!0;return!1}function Zp(n,t){if(n.length===0||t.length===0)return!1;for(let s=0;s<n.length-1;s++){const c=n[s],f=n[s+1];for(let p=0;p<t.length-1;p++)if(ET(c,f,t[p],t[p+1]))return!0}return!1}function ET(n,t,s,c){return $i(n,s,c)!==$i(t,s,c)&&$i(n,t,s)!==$i(n,t,c)}function $p(n,t,s){const c=s*s;if(t.length===1)return n.distSqr(t[0])<c;for(let f=1;f<t.length;f++)if(dy(n,t[f-1],t[f])<c)return!0;return!1}function dy(n,t,s){const c=t.distSqr(s);if(c===0)return n.distSqr(t);const f=((n.x-t.x)*(s.x-t.x)+(n.y-t.y)*(s.y-t.y))/c;return n.distSqr(f<0?t:f>1?s:s.sub(t)._mult(f)._add(t))}function py(n,t){let s,c,f,p=!1;for(let _=0;_<n.length;_++){s=n[_];for(let v=0,w=s.length-1;v<s.length;w=v++)c=s[v],f=s[w],c.y>t.y!=f.y>t.y&&t.x<(f.x-c.x)*(t.y-c.y)/(f.y-c.y)+c.x&&(p=!p)}return p}function Wa(n,t){let s=!1;for(let c=0,f=n.length-1;c<n.length;f=c++){const p=n[c],_=n[f];p.y>t.y!=_.y>t.y&&t.x<(_.x-p.x)*(t.y-p.y)/(_.y-p.y)+p.x&&(s=!s)}return s}function my(n,t,s,c,f){for(const _ of n)if(t<=_.x&&s<=_.y&&c>=_.x&&f>=_.y)return!0;const p=[new F(t,s),new F(t,f),new F(c,f),new F(c,s)];if(n.length>2){for(const _ of p)if(Wa(n,_))return!0}for(let _=0;_<n.length-1;_++)if(ST(n[_],n[_+1],p))return!0;return!1}function ST(n,t,s){const c=s[0],f=s[2];if(n.x<c.x&&t.x<c.x||n.x>f.x&&t.x>f.x||n.y<c.y&&t.y<c.y||n.y>f.y&&t.y>f.y)return!1;const p=$i(n,t,s[0]);return p!==$i(n,t,s[1])||p!==$i(n,t,s[2])||p!==$i(n,t,s[3])}function Hl(n,t,s){const c=t.paint.get(n).value;return c.kind==="constant"?c.value:s.programConfigurations.get(t.id).getMaxValue(n)}function Nf(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function gy(n,t,s,c,f){if(!t[0]&&!t[1])return n;const p=F.convert(t)._mult(f);s==="viewport"&&p._rotate(-c);const _=[];for(let v=0;v<n.length;v++)_.push(n[v].sub(p));return _}function _y(n,t,s,c){const f=F.convert(n)._mult(c);return t==="viewport"&&f._rotate(-s),f}pt(Gp,"CircleBucket",{omit:["layers"]});const AT=new Ue({"circle-sort-key":new we(Fe.layout_circle["circle-sort-key"])});var MT={paint:new Ue({"circle-radius":new we(Fe.paint_circle["circle-radius"]),"circle-color":new we(Fe.paint_circle["circle-color"]),"circle-blur":new we(Fe.paint_circle["circle-blur"]),"circle-opacity":new we(Fe.paint_circle["circle-opacity"]),"circle-translate":new pe(Fe.paint_circle["circle-translate"]),"circle-translate-anchor":new pe(Fe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new pe(Fe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new pe(Fe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new we(Fe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new we(Fe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new we(Fe.paint_circle["circle-stroke-opacity"])}),layout:AT},Uf=1e-6,an=typeof Float32Array<"u"?Float32Array:Array;function yy(){var n=new an(9);return an!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function As(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function Wp(n,t){var s=t[0],c=t[1],f=t[2],p=t[3],_=t[4],v=t[5],w=t[6],E=t[7],M=t[8],C=t[9],L=t[10],O=t[11],z=t[12],G=t[13],q=t[14],re=t[15],he=s*v-c*_,se=s*w-f*_,le=s*E-p*_,xe=c*w-f*v,de=c*E-p*v,Oe=f*E-p*w,Le=M*G-C*z,Ne=M*q-L*z,it=M*re-O*z,ze=C*q-L*G,Ge=C*re-O*G,He=L*re-O*q,Ze=he*He-se*Ge+le*ze+xe*it-de*Ne+Oe*Le;return Ze?(n[0]=(v*He-w*Ge+E*ze)*(Ze=1/Ze),n[1]=(f*Ge-c*He-p*ze)*Ze,n[2]=(G*Oe-q*de+re*xe)*Ze,n[3]=(L*de-C*Oe-O*xe)*Ze,n[4]=(w*it-_*He-E*Ne)*Ze,n[5]=(s*He-f*it+p*Ne)*Ze,n[6]=(q*le-z*Oe-re*se)*Ze,n[7]=(M*Oe-L*le+O*se)*Ze,n[8]=(_*Ge-v*it+E*Le)*Ze,n[9]=(c*it-s*Ge-p*Le)*Ze,n[10]=(z*de-G*le+re*he)*Ze,n[11]=(C*le-M*de-O*he)*Ze,n[12]=(v*Ne-_*ze-w*Le)*Ze,n[13]=(s*ze-c*Ne+f*Le)*Ze,n[14]=(G*se-z*xe-q*he)*Ze,n[15]=(M*xe-C*se+L*he)*Ze,n):null}function Yl(n,t,s){var c=t[0],f=t[1],p=t[2],_=t[3],v=t[4],w=t[5],E=t[6],M=t[7],C=t[8],L=t[9],O=t[10],z=t[11],G=t[12],q=t[13],re=t[14],he=t[15],se=s[0],le=s[1],xe=s[2],de=s[3];return n[0]=se*c+le*v+xe*C+de*G,n[1]=se*f+le*w+xe*L+de*q,n[2]=se*p+le*E+xe*O+de*re,n[3]=se*_+le*M+xe*z+de*he,n[4]=(se=s[4])*c+(le=s[5])*v+(xe=s[6])*C+(de=s[7])*G,n[5]=se*f+le*w+xe*L+de*q,n[6]=se*p+le*E+xe*O+de*re,n[7]=se*_+le*M+xe*z+de*he,n[8]=(se=s[8])*c+(le=s[9])*v+(xe=s[10])*C+(de=s[11])*G,n[9]=se*f+le*w+xe*L+de*q,n[10]=se*p+le*E+xe*O+de*re,n[11]=se*_+le*M+xe*z+de*he,n[12]=(se=s[12])*c+(le=s[13])*v+(xe=s[14])*C+(de=s[15])*G,n[13]=se*f+le*w+xe*L+de*q,n[14]=se*p+le*E+xe*O+de*re,n[15]=se*_+le*M+xe*z+de*he,n}function Du(n,t,s){var c,f,p,_,v,w,E,M,C,L,O,z,G=s[0],q=s[1],re=s[2];return t===n?(n[12]=t[0]*G+t[4]*q+t[8]*re+t[12],n[13]=t[1]*G+t[5]*q+t[9]*re+t[13],n[14]=t[2]*G+t[6]*q+t[10]*re+t[14],n[15]=t[3]*G+t[7]*q+t[11]*re+t[15]):(f=t[1],p=t[2],_=t[3],v=t[4],w=t[5],E=t[6],M=t[7],C=t[8],L=t[9],O=t[10],z=t[11],n[0]=c=t[0],n[1]=f,n[2]=p,n[3]=_,n[4]=v,n[5]=w,n[6]=E,n[7]=M,n[8]=C,n[9]=L,n[10]=O,n[11]=z,n[12]=c*G+v*q+C*re+t[12],n[13]=f*G+w*q+L*re+t[13],n[14]=p*G+E*q+O*re+t[14],n[15]=_*G+M*q+z*re+t[15]),n}function qa(n,t,s){var c=s[0],f=s[1],p=s[2];return n[0]=t[0]*c,n[1]=t[1]*c,n[2]=t[2]*c,n[3]=t[3]*c,n[4]=t[4]*f,n[5]=t[5]*f,n[6]=t[6]*f,n[7]=t[7]*f,n[8]=t[8]*p,n[9]=t[9]*p,n[10]=t[10]*p,n[11]=t[11]*p,n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n}function qp(n,t,s){var c=Math.sin(s),f=Math.cos(s),p=t[4],_=t[5],v=t[6],w=t[7],E=t[8],M=t[9],C=t[10],L=t[11];return t!==n&&(n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[4]=p*f+E*c,n[5]=_*f+M*c,n[6]=v*f+C*c,n[7]=w*f+L*c,n[8]=E*f-p*c,n[9]=M*f-_*c,n[10]=C*f-v*c,n[11]=L*f-w*c,n}function jf(n,t,s){var c=Math.sin(s),f=Math.cos(s),p=t[0],_=t[1],v=t[2],w=t[3],E=t[8],M=t[9],C=t[10],L=t[11];return t!==n&&(n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[0]=p*f-E*c,n[1]=_*f-M*c,n[2]=v*f-C*c,n[3]=w*f-L*c,n[8]=p*c+E*f,n[9]=_*c+M*f,n[10]=v*c+C*f,n[11]=w*c+L*f,n}function vy(n,t){return n[0]=t[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=t[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=t[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function xy(n,t,s){var c,f,p,_=s[0],v=s[1],w=s[2],E=Math.hypot(_,v,w);return E<Uf?null:(_*=E=1/E,v*=E,w*=E,c=Math.sin(t),f=Math.cos(t),n[0]=_*_*(p=1-f)+f,n[1]=v*_*p+w*c,n[2]=w*_*p-v*c,n[3]=0,n[4]=_*v*p-w*c,n[5]=v*v*p+f,n[6]=w*v*p+_*c,n[7]=0,n[8]=_*w*p+v*c,n[9]=v*w*p-_*c,n[10]=w*w*p+f,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n)}Math.hypot||(Math.hypot=function(){for(var n=0,t=arguments.length;t--;)n+=arguments[t]*arguments[t];return Math.sqrt(n)});var PT=Yl;function Xp(){var n=new an(3);return an!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function by(n){var t=new an(3);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t}function zu(n){return Math.hypot(n[0],n[1],n[2])}function Kl(n,t,s){var c=new an(3);return c[0]=n,c[1]=t,c[2]=s,c}function Xo(n,t,s){return n[0]=t[0]+s[0],n[1]=t[1]+s[1],n[2]=t[2]+s[2],n}function Hp(n,t,s){return n[0]=t[0]-s[0],n[1]=t[1]-s[1],n[2]=t[2]-s[2],n}function wy(n,t,s){return n[0]=t[0]*s[0],n[1]=t[1]*s[1],n[2]=t[2]*s[2],n}function Yp(n,t,s){return n[0]=Math.min(t[0],s[0]),n[1]=Math.min(t[1],s[1]),n[2]=Math.min(t[2],s[2]),n}function Kp(n,t,s){return n[0]=Math.max(t[0],s[0]),n[1]=Math.max(t[1],s[1]),n[2]=Math.max(t[2],s[2]),n}function rs(n,t,s){return n[0]=t[0]*s,n[1]=t[1]*s,n[2]=t[2]*s,n}function Vf(n,t,s,c){return n[0]=t[0]+s[0]*c,n[1]=t[1]+s[1]*c,n[2]=t[2]+s[2]*c,n}function Fr(n,t){var s=t[0],c=t[1],f=t[2],p=s*s+c*c+f*f;return p>0&&(p=1/Math.sqrt(p)),n[0]=t[0]*p,n[1]=t[1]*p,n[2]=t[2]*p,n}function Nn(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]}function Jp(n,t,s){var c=t[0],f=t[1],p=t[2],_=s[0],v=s[1],w=s[2];return n[0]=f*w-p*v,n[1]=p*_-c*w,n[2]=c*v-f*_,n}function Yi(n,t,s){var c=t[0],f=t[1],p=t[2],_=s[3]*c+s[7]*f+s[11]*p+s[15];return n[0]=(s[0]*c+s[4]*f+s[8]*p+s[12])/(_=_||1),n[1]=(s[1]*c+s[5]*f+s[9]*p+s[13])/_,n[2]=(s[2]*c+s[6]*f+s[10]*p+s[14])/_,n}function Ty(n,t,s){var c=s[0],f=s[1],p=s[2],_=t[0],v=t[1],w=t[2],E=f*w-p*v,M=p*_-c*w,C=c*v-f*_,L=f*C-p*M,O=p*E-c*C,z=c*M-f*E,G=2*s[3];return M*=G,C*=G,O*=2,z*=2,n[0]=_+(E*=G)+(L*=2),n[1]=v+M+O,n[2]=w+C+z,n}var Bu,ns=Hp,IT=wy,CT=zu;function Ey(n,t,s){return n[0]=t[0]*s,n[1]=t[1]*s,n[2]=t[2]*s,n[3]=t[3]*s,n}function Xa(n,t,s){var c=t[0],f=t[1],p=t[2],_=t[3];return n[0]=s[0]*c+s[4]*f+s[8]*p+s[12]*_,n[1]=s[1]*c+s[5]*f+s[9]*p+s[13]*_,n[2]=s[2]*c+s[6]*f+s[10]*p+s[14]*_,n[3]=s[3]*c+s[7]*f+s[11]*p+s[15]*_,n}function Sy(){var n=new an(4);return an!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function Ay(n){return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n}function My(n,t,s){s*=.5;var c=t[0],f=t[1],p=t[2],_=t[3],v=Math.sin(s),w=Math.cos(s);return n[0]=c*w+_*v,n[1]=f*w+p*v,n[2]=p*w-f*v,n[3]=_*w-c*v,n}function Py(n,t,s){s*=.5;var c=t[0],f=t[1],p=t[2],_=t[3],v=Math.sin(s),w=Math.cos(s);return n[0]=c*w-p*v,n[1]=f*w+_*v,n[2]=p*w+c*v,n[3]=_*w-f*v,n}Xp(),Bu=new an(4),an!=Float32Array&&(Bu[0]=0,Bu[1]=0,Bu[2]=0,Bu[3]=0),Xp(),Kl(1,0,0),Kl(0,1,0),Sy(),Sy(),yy();class Qp{constructor(t,s){this.pos=t,this.dir=s}intersectsPlane(t,s,c){const f=Nn(s,this.dir);if(Math.abs(f)<1e-6)return!1;const p=((t[0]-this.pos[0])*s[0]+(t[1]-this.pos[1])*s[1]+(t[2]-this.pos[2])*s[2])/f;return c[0]=this.pos[0]+this.dir[0]*p,c[1]=this.pos[1]+this.dir[1]*p,c[2]=this.pos[2]+this.dir[2]*p,!0}closestPointOnSphere(t,s,c){if(function(O,z){var G=O[0],q=O[1],re=O[2],he=z[0],se=z[1],le=z[2];return Math.abs(G-he)<=Uf*Math.max(1,Math.abs(G),Math.abs(he))&&Math.abs(q-se)<=Uf*Math.max(1,Math.abs(q),Math.abs(se))&&Math.abs(re-le)<=Uf*Math.max(1,Math.abs(re),Math.abs(le))}(this.pos,t)||s===0)return c[0]=c[1]=c[2]=0,!1;const[f,p,_]=this.dir,v=this.pos[0]-t[0],w=this.pos[1]-t[1],E=this.pos[2]-t[2],M=f*f+p*p+_*_,C=2*(v*f+w*p+E*_),L=C*C-4*M*(v*v+w*w+E*E-s*s);if(L<0){const O=Math.max(-C/2,0),z=v+f*O,G=w+p*O,q=E+_*O,re=Math.hypot(z,G,q);return c[0]=z*s/re,c[1]=G*s/re,c[2]=q*s/re,!1}{const O=(-C-Math.sqrt(L))/(2*M);if(O<0){const z=Math.hypot(v,w,E);return c[0]=v*s/z,c[1]=w*s/z,c[2]=E*s/z,!1}return c[0]=v+f*O,c[1]=w+p*O,c[2]=E+_*O,!0}}}class em{constructor(t,s,c,f,p){this.TL=t,this.TR=s,this.BR=c,this.BL=f,this.horizon=p}static fromInvProjectionMatrix(t,s,c){const f=[-1,1,1],p=[1,1,1],_=[1,-1,1],v=[-1,-1,1],w=Yi(f,f,t),E=Yi(p,p,t),M=Yi(_,_,t),C=Yi(v,v,t);return new em(w,E,M,C,s/c)}}class tm{constructor(t,s){this.points=t,this.planes=s}static fromInvProjectionMatrix(t,s,c,f){const p=Math.pow(2,c),_=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(w=>{const E=Xa([],w,t),M=1/E[3]/s*p;return function(C,L,O){return C[0]=L[0]*O[0],C[1]=L[1]*O[1],C[2]=L[2]*O[2],C[3]=L[3]*O[3],C}(E,E,[M,M,f?1/E[3]:M,M])}),v=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(w=>{const E=Fr([],Jp([],ns([],_[w[0]],_[w[1]]),ns([],_[w[2]],_[w[1]]))),M=-Nn(E,_[w[1]]);return E.concat(M)});return new tm(_,v)}}class Yr{static fromPoints(t){const s=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],c=[Number.MIN_VALUE,Number.MIN_VALUE,Number.MIN_VALUE];for(const f of t)s[0]=Math.min(s[0],f[0]),s[1]=Math.min(s[1],f[1]),s[2]=Math.min(s[2],f[2]),c[0]=Math.max(c[0],f[0]),c[1]=Math.max(c[1],f[1]),c[2]=Math.max(c[2],f[2]);return new Yr(s,c)}constructor(t,s){this.min=t,this.max=s,this.center=rs([],Xo([],this.min,this.max),.5)}quadrant(t){const s=[t%2==0,t<2],c=by(this.min),f=by(this.max);for(let p=0;p<s.length;p++)c[p]=s[p]?this.min[p]:this.center[p],f[p]=s[p]?this.center[p]:this.max[p];return f[2]=this.max[2],new Yr(c,f)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}distanceZ(t){return Math.max(Math.min(this.max[2],t[2]),this.min[2])-t[2]}getCorners(){const t=this.min,s=this.max;return[[t[0],t[1],t[2]],[s[0],t[1],t[2]],[s[0],s[1],t[2]],[t[0],s[1],t[2]],[t[0],t[1],s[2]],[s[0],t[1],s[2]],[s[0],s[1],s[2]],[t[0],s[1],s[2]]]}intersects(t){const s=this.getCorners();let c=!0;for(let f=0;f<t.planes.length;f++){const p=t.planes[f];let _=0;for(let v=0;v<s.length;v++)_+=Nn(p,s[v])+p[3]>=0;if(_===0)return 0;_!==s.length&&(c=!1)}if(c)return 2;for(let f=0;f<3;f++){let p=Number.MAX_VALUE,_=-Number.MAX_VALUE;for(let v=0;v<t.points.length;v++){const w=t.points[v][f]-this.min[f];p=Math.min(p,w),_=Math.max(_,w)}if(_<0||p>this.max[f]-this.min[f])return 0}return 1}}function Iy(n,t,s,c,f,p,_,v,w){if(p&&n.queryGeometry.isAboveHorizon)return!1;p&&(w*=n.pixelToTileUnitsFactor);const E=n.tileID.canonical,M=s.projection.upVectorScale(E,s.center.lat,s.worldSize).metersToTile;for(const C of t)for(const L of C){const O=L.add(v),z=f&&s.elevation?s.elevation.exaggeration()*f.getElevationAt(O.x,O.y,!0):0,G=s.projection.projectTilePoint(O.x,O.y,E);if(z>0){const se=s.projection.upVector(E,O.x,O.y);G.x+=se[0]*M*z,G.y+=se[1]*M*z,G.z+=se[2]*M*z}const q=p?O:LT(G.x,G.y,G.z,c),re=p?n.tilespaceRays.map(se=>RT(se,z)):n.queryGeometry.screenGeometry,he=Xa([],[G.x,G.y,G.z,1],c);if(!_&&p?w*=he[3]/s.cameraToCenterDistance:_&&!p&&(w*=s.cameraToCenterDistance/he[3]),p){const se=vr((L.y/It+E.y)/(1<<E.z));w/=s.projection.pixelsPerMeter(se,1)/Bn(1,se)}if(wT(re,q,w))return!0}return!1}function LT(n,t,s,c){const f=Xa([],[n,t,s,1],c);return new F(f[0]/f[3],f[1]/f[3])}const Cy=Kl(0,0,0),kT=Kl(0,0,1);function RT(n,t){const s=Xp();return Cy[2]=t,n.intersectsPlane(Cy,kT,s),new F(s[0],s[1])}class Ly extends Gp{}function ky(n,{width:t,height:s},c,f){if(f){if(f instanceof Uint8ClampedArray)f=new Uint8Array(f.buffer);else if(f.length!==t*s*c)throw new RangeError("mismatched image size")}else f=new Uint8Array(t*s*c);return n.width=t,n.height=s,n.data=f,n}function Ry(n,t,s){const{width:c,height:f}=t;c===n.width&&f===n.height||(im(n,t,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,c),height:Math.min(n.height,f)},s),n.width=c,n.height=f,n.data=t.data)}function im(n,t,s,c,f,p){if(f.width===0||f.height===0)return t;if(f.width>n.width||f.height>n.height||s.x>n.width-f.width||s.y>n.height-f.height)throw new RangeError("out of range source coordinates for image copy");if(f.width>t.width||f.height>t.height||c.x>t.width-f.width||c.y>t.height-f.height)throw new RangeError("out of range destination coordinates for image copy");const _=n.data,v=t.data;for(let w=0;w<f.height;w++){const E=((s.y+w)*n.width+s.x)*p,M=((c.y+w)*t.width+c.x)*p;for(let C=0;C<f.width*p;C++)v[M+C]=_[E+C]}return t}pt(Ly,"HeatmapBucket",{omit:["layers"]});class lo{constructor(t,s){ky(this,t,1,s)}resize(t){Ry(this,new lo(t),1)}clone(){return new lo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,s,c,f,p){im(t,s,c,f,p,1)}}class ln{constructor(t,s){ky(this,t,4,s)}resize(t){Ry(this,new ln(t),4)}replace(t,s){s?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new ln({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,s,c,f,p){im(t,s,c,f,p,4)}}pt(lo,"AlphaImage"),pt(ln,"RGBAImage");var OT={paint:new Ue({"heatmap-radius":new we(Fe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new we(Fe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new pe(Fe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Ae(Fe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new pe(Fe.paint_heatmap["heatmap-opacity"])})};function rm(n){const t={},s=n.resolution||256,c=n.clips?n.clips.length:1,f=n.image||new ln({width:s,height:c}),p=(_,v,w)=>{t[n.evaluationKey]=w;const E=n.expression.evaluate(t);f.data[_+v+0]=Math.floor(255*E.r/E.a),f.data[_+v+1]=Math.floor(255*E.g/E.a),f.data[_+v+2]=Math.floor(255*E.b/E.a),f.data[_+v+3]=Math.floor(255*E.a)};if(n.clips)for(let _=0,v=0;_<c;++_,v+=4*s)for(let w=0,E=0;w<s;w++,E+=4){const M=w/(s-1),{start:C,end:L}=n.clips[_];p(v,E,C*(1-M)+L*M)}else for(let _=0,v=0;_<s;_++,v+=4)p(0,v,_/(s-1));return f}var DT={paint:new Ue({"hillshade-illumination-direction":new pe(Fe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new pe(Fe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new pe(Fe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new pe(Fe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new pe(Fe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new pe(Fe.paint_hillshade["hillshade-accent-color"])})};const zT=We([{name:"a_pos",components:2,type:"Int16"}],4),{members:BT}=zT;var Gf=Zf,FT=Zf;function Zf(n,t,s){s=s||2;var c,f,p,_,v,w,E,M=t&&t.length,C=M?t[0]*s:n.length,L=Oy(n,0,C,s,!0),O=[];if(!L||L.next===L.prev)return O;if(M&&(L=function(G,q,re,he){var se,le,xe,de=[];for(se=0,le=q.length;se<le;se++)(xe=Oy(G,q[se]*he,se<le-1?q[se+1]*he:G.length,he,!1))===xe.next&&(xe.steiner=!0),de.push(WT(xe));for(de.sort(GT),se=0;se<de.length;se++)re=ZT(de[se],re);return re}(n,t,L,s)),n.length>80*s){c=p=n[0],f=_=n[1];for(var z=s;z<C;z+=s)(v=n[z])<c&&(c=v),(w=n[z+1])<f&&(f=w),v>p&&(p=v),w>_&&(_=w);E=(E=Math.max(p-c,_-f))!==0?32767/E:0}return Fu(L,O,s,c,f,E,0),O}function Oy(n,t,s,c,f){var p,_;if(f===om(n,t,s,c)>0)for(p=t;p<s;p+=c)_=By(p,n[p],n[p+1],_);else for(p=s-c;p>=t;p-=c)_=By(p,n[p],n[p+1],_);return _&&$f(_,_.next)&&(Uu(_),_=_.next),_}function Ha(n,t){if(!n)return n;t||(t=n);var s,c=n;do if(s=!1,c.steiner||!$f(c,c.next)&&Zi(c.prev,c,c.next)!==0)c=c.next;else{if(Uu(c),(c=t=c.prev)===c.next)break;s=!0}while(s||c!==t);return t}function Fu(n,t,s,c,f,p,_){if(n){!_&&p&&function(M,C,L,O){var z=M;do z.z===0&&(z.z=nm(z.x,z.y,C,L,O)),z.prevZ=z.prev,z.nextZ=z.next,z=z.next;while(z!==M);z.prevZ.nextZ=null,z.prevZ=null,function(G){var q,re,he,se,le,xe,de,Oe,Le=1;do{for(re=G,G=null,le=null,xe=0;re;){for(xe++,he=re,de=0,q=0;q<Le&&(de++,he=he.nextZ);q++);for(Oe=Le;de>0||Oe>0&&he;)de!==0&&(Oe===0||!he||re.z<=he.z)?(se=re,re=re.nextZ,de--):(se=he,he=he.nextZ,Oe--),le?le.nextZ=se:G=se,se.prevZ=le,le=se;re=he}le.nextZ=null,Le*=2}while(xe>1)}(z)}(n,c,f,p);for(var v,w,E=n;n.prev!==n.next;)if(v=n.prev,w=n.next,p?UT(n,c,f,p):NT(n))t.push(v.i/s|0),t.push(n.i/s|0),t.push(w.i/s|0),Uu(n),n=w.next,E=w.next;else if((n=w)===E){_?_===1?Fu(n=jT(Ha(n),t,s),t,s,c,f,p,2):_===2&&VT(n,t,s,c,f,p):Fu(Ha(n),t,s,c,f,p,1);break}}}function NT(n){var t=n.prev,s=n,c=n.next;if(Zi(t,s,c)>=0)return!1;for(var f=t.x,p=s.x,_=c.x,v=t.y,w=s.y,E=c.y,M=f<p?f<_?f:_:p<_?p:_,C=v<w?v<E?v:E:w<E?w:E,L=f>p?f>_?f:_:p>_?p:_,O=v>w?v>E?v:E:w>E?w:E,z=c.next;z!==t;){if(z.x>=M&&z.x<=L&&z.y>=C&&z.y<=O&&Jl(f,v,p,w,_,E,z.x,z.y)&&Zi(z.prev,z,z.next)>=0)return!1;z=z.next}return!0}function UT(n,t,s,c){var f=n.prev,p=n,_=n.next;if(Zi(f,p,_)>=0)return!1;for(var v=f.x,w=p.x,E=_.x,M=f.y,C=p.y,L=_.y,O=v<w?v<E?v:E:w<E?w:E,z=M<C?M<L?M:L:C<L?C:L,G=v>w?v>E?v:E:w>E?w:E,q=M>C?M>L?M:L:C>L?C:L,re=nm(O,z,t,s,c),he=nm(G,q,t,s,c),se=n.prevZ,le=n.nextZ;se&&se.z>=re&&le&&le.z<=he;){if(se.x>=O&&se.x<=G&&se.y>=z&&se.y<=q&&se!==f&&se!==_&&Jl(v,M,w,C,E,L,se.x,se.y)&&Zi(se.prev,se,se.next)>=0||(se=se.prevZ,le.x>=O&&le.x<=G&&le.y>=z&&le.y<=q&&le!==f&&le!==_&&Jl(v,M,w,C,E,L,le.x,le.y)&&Zi(le.prev,le,le.next)>=0))return!1;le=le.nextZ}for(;se&&se.z>=re;){if(se.x>=O&&se.x<=G&&se.y>=z&&se.y<=q&&se!==f&&se!==_&&Jl(v,M,w,C,E,L,se.x,se.y)&&Zi(se.prev,se,se.next)>=0)return!1;se=se.prevZ}for(;le&&le.z<=he;){if(le.x>=O&&le.x<=G&&le.y>=z&&le.y<=q&&le!==f&&le!==_&&Jl(v,M,w,C,E,L,le.x,le.y)&&Zi(le.prev,le,le.next)>=0)return!1;le=le.nextZ}return!0}function jT(n,t,s){var c=n;do{var f=c.prev,p=c.next.next;!$f(f,p)&&Dy(f,c,c.next,p)&&Nu(f,p)&&Nu(p,f)&&(t.push(f.i/s|0),t.push(c.i/s|0),t.push(p.i/s|0),Uu(c),Uu(c.next),c=n=p),c=c.next}while(c!==n);return Ha(c)}function VT(n,t,s,c,f,p){var _=n;do{for(var v=_.next.next;v!==_.prev;){if(_.i!==v.i&&qT(_,v)){var w=zy(_,v);return _=Ha(_,_.next),w=Ha(w,w.next),Fu(_,t,s,c,f,p,0),void Fu(w,t,s,c,f,p,0)}v=v.next}_=_.next}while(_!==n)}function GT(n,t){return n.x-t.x}function ZT(n,t){var s=function(f,p){var _,v=p,w=f.x,E=f.y,M=-1/0;do{if(E<=v.y&&E>=v.next.y&&v.next.y!==v.y){var C=v.x+(E-v.y)*(v.next.x-v.x)/(v.next.y-v.y);if(C<=w&&C>M&&(M=C,_=v.x<v.next.x?v:v.next,C===w))return _}v=v.next}while(v!==p);if(!_)return null;var L,O=_,z=_.x,G=_.y,q=1/0;v=_;do w>=v.x&&v.x>=z&&w!==v.x&&Jl(E<G?w:M,E,z,G,E<G?M:w,E,v.x,v.y)&&(L=Math.abs(E-v.y)/(w-v.x),Nu(v,f)&&(L<q||L===q&&(v.x>_.x||v.x===_.x&&$T(_,v)))&&(_=v,q=L)),v=v.next;while(v!==O);return _}(n,t);if(!s)return t;var c=zy(s,n);return Ha(c,c.next),Ha(s,s.next)}function $T(n,t){return Zi(n.prev,n,t.prev)<0&&Zi(t.next,n,n.next)<0}function nm(n,t,s,c,f){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-s)*f|0)|n<<8))|n<<4))|n<<2))|n<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-c)*f|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function WT(n){var t=n,s=n;do(t.x<s.x||t.x===s.x&&t.y<s.y)&&(s=t),t=t.next;while(t!==n);return s}function Jl(n,t,s,c,f,p,_,v){return(f-_)*(t-v)>=(n-_)*(p-v)&&(n-_)*(c-v)>=(s-_)*(t-v)&&(s-_)*(p-v)>=(f-_)*(c-v)}function qT(n,t){return n.next.i!==t.i&&n.prev.i!==t.i&&!function(s,c){var f=s;do{if(f.i!==s.i&&f.next.i!==s.i&&f.i!==c.i&&f.next.i!==c.i&&Dy(f,f.next,s,c))return!0;f=f.next}while(f!==s);return!1}(n,t)&&(Nu(n,t)&&Nu(t,n)&&function(s,c){var f=s,p=!1,_=(s.x+c.x)/2,v=(s.y+c.y)/2;do f.y>v!=f.next.y>v&&f.next.y!==f.y&&_<(f.next.x-f.x)*(v-f.y)/(f.next.y-f.y)+f.x&&(p=!p),f=f.next;while(f!==s);return p}(n,t)&&(Zi(n.prev,n,t.prev)||Zi(n,t.prev,t))||$f(n,t)&&Zi(n.prev,n,n.next)>0&&Zi(t.prev,t,t.next)>0)}function Zi(n,t,s){return(t.y-n.y)*(s.x-t.x)-(t.x-n.x)*(s.y-t.y)}function $f(n,t){return n.x===t.x&&n.y===t.y}function Dy(n,t,s,c){var f=qf(Zi(n,t,s)),p=qf(Zi(n,t,c)),_=qf(Zi(s,c,n)),v=qf(Zi(s,c,t));return f!==p&&_!==v||!(f!==0||!Wf(n,s,t))||!(p!==0||!Wf(n,c,t))||!(_!==0||!Wf(s,n,c))||!(v!==0||!Wf(s,t,c))}function Wf(n,t,s){return t.x<=Math.max(n.x,s.x)&&t.x>=Math.min(n.x,s.x)&&t.y<=Math.max(n.y,s.y)&&t.y>=Math.min(n.y,s.y)}function qf(n){return n>0?1:n<0?-1:0}function Nu(n,t){return Zi(n.prev,n,n.next)<0?Zi(n,t,n.next)>=0&&Zi(n,n.prev,t)>=0:Zi(n,t,n.prev)<0||Zi(n,n.next,t)<0}function zy(n,t){var s=new sm(n.i,n.x,n.y),c=new sm(t.i,t.x,t.y),f=n.next,p=t.prev;return n.next=t,t.prev=n,s.next=f,f.prev=s,c.next=s,s.prev=c,p.next=c,c.prev=p,c}function By(n,t,s,c){var f=new sm(n,t,s);return c?(f.next=c.next,f.prev=c,c.next.prev=f,c.next=f):(f.prev=f,f.next=f),f}function Uu(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function sm(n,t,s){this.i=n,this.x=t,this.y=s,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function om(n,t,s,c){for(var f=0,p=t,_=s-c;p<s;p+=c)f+=(n[_]-n[p])*(n[p+1]+n[_+1]),_=p;return f}function XT(n,t,s,c,f){Fy(n,t,s,c||n.length-1,f||HT)}function Fy(n,t,s,c,f){for(;c>s;){if(c-s>600){var p=c-s+1,_=t-s+1,v=Math.log(p),w=.5*Math.exp(2*v/3),E=.5*Math.sqrt(v*w*(p-w)/p)*(_-p/2<0?-1:1);Fy(n,t,Math.max(s,Math.floor(t-_*w/p+E)),Math.min(c,Math.floor(t+(p-_)*w/p+E)),f)}var M=n[t],C=s,L=c;for(ju(n,s,t),f(n[c],M)>0&&ju(n,s,c);C<L;){for(ju(n,C,L),C++,L--;f(n[C],M)<0;)C++;for(;f(n[L],M)>0;)L--}f(n[s],M)===0?ju(n,s,L):ju(n,++L,c),L<=t&&(s=L+1),t<=L&&(c=L-1)}}function ju(n,t,s){var c=n[t];n[t]=n[s],n[s]=c}function HT(n,t){return n<t?-1:n>t?1:0}function am(n,t){const s=n.length;if(s<=1)return[n];const c=[];let f,p;for(let _=0;_<s;_++){const v=fn(n[_]);v!==0&&(n[_].area=Math.abs(v),p===void 0&&(p=v<0),p===v<0?(f&&c.push(f),f=[n[_]]):f.push(n[_]))}if(f&&c.push(f),t>1)for(let _=0;_<c.length;_++)c[_].length<=t||(XT(c[_],t,1,c[_].length-1,YT),c[_]=c[_].slice(0,t));return c}function YT(n,t){return t.area-n.area}function lm(n,t,s){const c=s.patternDependencies;let f=!1;for(const p of t){const _=p.paint.get(`${n}-pattern`);_.isConstant()||(f=!0);const v=_.constantOr(null);v&&(f=!0,c[v.to]=!0,c[v.from]=!0)}return f}function cm(n,t,s,c,f){const p=f.patternDependencies;for(const _ of t){const v=_.paint.get(`${n}-pattern`).value;if(v.kind!=="constant"){let w=v.evaluate({zoom:c-1},s,{},f.availableImages),E=v.evaluate({zoom:c},s,{},f.availableImages),M=v.evaluate({zoom:c+1},s,{},f.availableImages);w=w&&w.name?w.name:w,E=E&&E.name?E.name:E,M=M&&M.name?M.name:M,p[w]=!0,p[E]=!0,p[M]=!0,s.patterns[_.id]={min:w,mid:E,max:M}}}return s}Zf.deviation=function(n,t,s,c){var f=t&&t.length,p=Math.abs(om(n,0,f?t[0]*s:n.length,s));if(f)for(var _=0,v=t.length;_<v;_++)p-=Math.abs(om(n,t[_]*s,_<v-1?t[_+1]*s:n.length,s));var w=0;for(_=0;_<c.length;_+=3){var E=c[_]*s,M=c[_+1]*s,C=c[_+2]*s;w+=Math.abs((n[E]-n[C])*(n[M+1]-n[E+1])-(n[E]-n[M])*(n[C+1]-n[E+1]))}return p===0&&w===0?0:Math.abs((w-p)/p)},Zf.flatten=function(n){for(var t=n[0][0].length,s={vertices:[],holes:[],dimensions:t},c=0,f=0;f<n.length;f++){for(var p=0;p<n[f].length;p++)for(var _=0;_<t;_++)s.vertices.push(n[f][p][_]);f>0&&s.holes.push(c+=n[f-1].length)}return s},Gf.default=FT;class Xf{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new st,this.indexArray=new Zt,this.indexArray2=new Pr,this.programConfigurations=new Za(t.layers,t.zoom),this.segments=new Xi,this.segments2=new Xi,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.projection=t.projection}populate(t,s,c,f){this.hasPattern=lm("fill",this.layers,s);const p=this.layers[0].layout.get("fill-sort-key"),_=[];for(const{feature:v,id:w,index:E,sourceLayerIndex:M}of t){const C=this.layers[0]._featureFilter.needGeometry,L=$a(v,C);if(!this.layers[0]._featureFilter.filter(new Y(this.zoom),L,c))continue;const O=p?p.evaluate(L,{},c,s.availableImages):void 0,z={id:w,properties:v.properties,type:v.type,sourceLayerIndex:M,index:E,geometry:C?L.geometry:ao(v,c,f),patterns:{},sortKey:O};_.push(z)}p&&_.sort((v,w)=>v.sortKey-w.sortKey);for(const v of _){const{geometry:w,index:E,sourceLayerIndex:M}=v;if(this.hasPattern){const C=cm("fill",this.layers,v,this.zoom,s);this.patternFeatures.push(C)}else this.addFeature(v,w,E,c,{},s.availableImages);s.featureIndex.insert(t[E].feature,w,E,M,this.index)}}update(t,s,c,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,s,this.stateDependentLayers,c,f)}addFeatures(t,s,c,f,p){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,s,c,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,BT),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,s,c,f,p,_=[]){for(const v of am(s,500)){let w=0;for(const z of v)w+=z.length;const E=this.segments.prepareSegment(w,this.layoutVertexArray,this.indexArray),M=E.vertexLength,C=[],L=[];for(const z of v){if(z.length===0)continue;z!==v[0]&&L.push(C.length/2);const G=this.segments2.prepareSegment(z.length,this.layoutVertexArray,this.indexArray2),q=G.vertexLength;this.layoutVertexArray.emplaceBack(z[0].x,z[0].y),this.indexArray2.emplaceBack(q+z.length-1,q),C.push(z[0].x),C.push(z[0].y);for(let re=1;re<z.length;re++)this.layoutVertexArray.emplaceBack(z[re].x,z[re].y),this.indexArray2.emplaceBack(q+re-1,q+re),C.push(z[re].x),C.push(z[re].y);G.vertexLength+=z.length,G.primitiveLength+=z.length}const O=Gf(C,L);for(let z=0;z<O.length;z+=3)this.indexArray.emplaceBack(M+O[z],M+O[z+1],M+O[z+2]);E.vertexLength+=w,E.primitiveLength+=O.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,c,p,_,f)}}pt(Xf,"FillBucket",{omit:["layers","patternFeatures"]});const KT=new Ue({"fill-sort-key":new we(Fe.layout_fill["fill-sort-key"])});var JT={paint:new Ue({"fill-antialias":new pe(Fe.paint_fill["fill-antialias"]),"fill-opacity":new we(Fe.paint_fill["fill-opacity"]),"fill-color":new we(Fe.paint_fill["fill-color"]),"fill-outline-color":new we(Fe.paint_fill["fill-outline-color"]),"fill-translate":new pe(Fe.paint_fill["fill-translate"]),"fill-translate-anchor":new pe(Fe.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ie(Fe.paint_fill["fill-pattern"])}),layout:KT};const QT=We([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),eE=We([{name:"a_centroid_pos",components:2,type:"Uint16"}]),tE=We([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:iE}=QT;var Ny=Ql;function Ql(n,t,s,c,f){this.properties={},this.extent=s,this.type=0,this._pbf=n,this._geometry=-1,this._keys=c,this._values=f,n.readFields(rE,this,t)}function rE(n,t,s){n==1?t.id=s.readVarint():n==2?function(c,f){for(var p=c.readVarint()+c.pos;c.pos<p;){var _=f._keys[c.readVarint()],v=f._values[c.readVarint()];f.properties[_]=v}}(s,t):n==3?t.type=s.readVarint():n==4&&(t._geometry=s.pos)}function nE(n){for(var t,s,c=0,f=0,p=n.length,_=p-1;f<p;_=f++)c+=((s=n[_]).x-(t=n[f]).x)*(t.y+s.y);return c}Ql.types=["Unknown","Point","LineString","Polygon"],Ql.prototype.loadGeometry=function(){var n=this._pbf;n.pos=this._geometry;for(var t,s=n.readVarint()+n.pos,c=1,f=0,p=0,_=0,v=[];n.pos<s;){if(f<=0){var w=n.readVarint();c=7&w,f=w>>3}if(f--,c===1||c===2)p+=n.readSVarint(),_+=n.readSVarint(),c===1&&(t&&v.push(t),t=[]),t.push(new F(p,_));else{if(c!==7)throw new Error("unknown command "+c);t&&t.push(t[0].clone())}}return t&&v.push(t),v},Ql.prototype.bbox=function(){var n=this._pbf;n.pos=this._geometry;for(var t=n.readVarint()+n.pos,s=1,c=0,f=0,p=0,_=1/0,v=-1/0,w=1/0,E=-1/0;n.pos<t;){if(c<=0){var M=n.readVarint();s=7&M,c=M>>3}if(c--,s===1||s===2)(f+=n.readSVarint())<_&&(_=f),f>v&&(v=f),(p+=n.readSVarint())<w&&(w=p),p>E&&(E=p);else if(s!==7)throw new Error("unknown command "+s)}return[_,w,v,E]},Ql.prototype.toGeoJSON=function(n,t,s){var c,f,p=this.extent*Math.pow(2,s),_=this.extent*n,v=this.extent*t,w=this.loadGeometry(),E=Ql.types[this.type];function M(O){for(var z=0;z<O.length;z++){var G=O[z];O[z]=[360*(G.x+_)/p-180,360/Math.PI*Math.atan(Math.exp((180-360*(G.y+v)/p)*Math.PI/180))-90]}}switch(this.type){case 1:var C=[];for(c=0;c<w.length;c++)C[c]=w[c][0];M(w=C);break;case 2:for(c=0;c<w.length;c++)M(w[c]);break;case 3:for(w=function(O){var z=O.length;if(z<=1)return[O];for(var G,q,re=[],he=0;he<z;he++){var se=nE(O[he]);se!==0&&(q===void 0&&(q=se<0),q===se<0?(G&&re.push(G),G=[O[he]]):G.push(O[he]))}return G&&re.push(G),re}(w),c=0;c<w.length;c++)for(f=0;f<w[c].length;f++)M(w[c][f])}w.length===1?w=w[0]:E="Multi"+E;var L={type:"Feature",geometry:{type:E,coordinates:w},properties:this.properties};return"id"in this&&(L.id=this.id),L};var Uy=jy;function jy(n,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=n,this._keys=[],this._values=[],this._features=[],n.readFields(sE,this,t),this.length=this._features.length}function sE(n,t,s){n===15?t.version=s.readVarint():n===1?t.name=s.readString():n===5?t.extent=s.readVarint():n===2?t._features.push(s.pos):n===3?t._keys.push(s.readString()):n===4&&t._values.push(function(c){for(var f=null,p=c.readVarint()+c.pos;c.pos<p;){var _=c.readVarint()>>3;f=_===1?c.readString():_===2?c.readFloat():_===3?c.readDouble():_===4?c.readVarint64():_===5?c.readVarint():_===6?c.readSVarint():_===7?c.readBoolean():null}return f}(s))}function oE(n,t,s){if(n===3){var c=new Uy(s,s.readVarint()+s.pos);c.length&&(t[c.name]=c)}}jy.prototype.feature=function(n){if(n<0||n>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[n];var t=this._pbf.readVarint()+this._pbf.pos;return new Ny(this._pbf,t,this.extent,this._keys,this._values)};var Ya={VectorTile:function(n,t){this.layers=n.readFields(oE,{},t)},VectorTileFeature:Ny,VectorTileLayer:Uy};function Hf(n,t,s,c){const f=[],p=c===0?(_,v,w,E,M,C)=>{_.push(new F(C,w+(C-v)/(E-v)*(M-w)))}:(_,v,w,E,M,C)=>{_.push(new F(v+(C-w)/(M-w)*(E-v),C))};for(const _ of n){const v=[];for(const w of _){if(w.length<=2)continue;const E=[];for(let L=0;L<w.length-1;L++){const O=w[L].x,z=w[L].y,G=w[L+1].x,q=w[L+1].y,re=c===0?O:z,he=c===0?G:q;re<t?he>t&&p(E,O,z,G,q,t):re>s?he<s&&p(E,O,z,G,q,s):E.push(w[L]),he<t&&re>=t&&p(E,O,z,G,q,t),he>s&&re<=s&&p(E,O,z,G,q,s)}let M=w[w.length-1];const C=c===0?M.x:M.y;C>=t&&C<=s&&E.push(M),E.length&&(M=E[E.length-1],E[0].x===M.x&&E[0].y===M.y||E.push(E[0]),v.push(E))}v.length&&f.push(v)}return f}const aE=Ya.VectorTileFeature.types,lE=Math.pow(2,13);function Vu(n,t,s,c,f,p,_,v){n.emplaceBack((t<<1)+_,(s<<1)+p,(Math.floor(c*lE)<<1)+f,Math.round(v))}function Gu(n,t,s){n.emplaceBack(t.x,t.y,t.z,s[0]*16384,s[1]*16384,s[2]*16384)}class Vy{constructor(){this.acc=new F(0,0),this.polyCount=[]}startRing(t){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new F(t.x,t.y),this.max=new F(t.x,t.y))}append(t,s){this.currentPolyCount.edges++,this.acc._add(t);const c=this.min,f=this.max;t.x<c.x?c.x=t.x:t.x>f.x&&(f.x=t.x),t.y<c.y?c.y=t.y:t.y>f.y&&(f.y=t.y),((t.x===0||t.x===It)&&t.x===s.x)!=((t.y===0||t.y===It)&&t.y===s.y)&&this.processBorderOverlap(t,s),s.x<0!=t.x<0&&this.addBorderIntersection(0,Qt(s.y,t.y,(0-s.x)/(t.x-s.x))),s.x>It!=t.x>It&&this.addBorderIntersection(1,Qt(s.y,t.y,(It-s.x)/(t.x-s.x))),s.y<0!=t.y<0&&this.addBorderIntersection(2,Qt(s.x,t.x,(0-s.y)/(t.y-s.y))),s.y>It!=t.y>It&&this.addBorderIntersection(3,Qt(s.x,t.x,(It-s.y)/(t.y-s.y)))}addBorderIntersection(t,s){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const c=this.borders[t];s<c[0]&&(c[0]=s),s>c[1]&&(c[1]=s)}processBorderOverlap(t,s){if(t.x===s.x){if(t.y===s.y)return;const c=t.x===0?0:1;this.addBorderIntersection(c,s.y),this.addBorderIntersection(c,t.y)}else{const c=t.y===0?2:3;this.addBorderIntersection(c,s.x),this.addBorderIntersection(c,t.x)}}centroid(){const t=this.polyCount.reduce((s,c)=>s+c.edges,0);return t!==0?this.acc.div(t)._round():new F(0,0)}span(){return new F(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((t,s)=>t+ +(s[0]!==Number.MAX_VALUE),0)}}class Zu{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.id),this.index=t.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=t.projection,this.layoutVertexArray=new At,this.centroidVertexArray=new J_,this.indexArray=new Zt,this.programConfigurations=new Za(t.layers,t.zoom),this.segments=new Xi,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.enableTerrain=t.enableTerrain}populate(t,s,c,f){this.features=[],this.hasPattern=lm("fill-extrusion",this.layers,s),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(p){const _=Math.exp(Math.PI*(1-p.y/(1<<p.z)*2));return 80150034*_/(_*_+1)/It/(1<<p.z)}(c),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:p,id:_,index:v,sourceLayerIndex:w}of t){const E=this.layers[0]._featureFilter.needGeometry,M=$a(p,E);if(!this.layers[0]._featureFilter.filter(new Y(this.zoom),M,c))continue;const C={id:_,sourceLayerIndex:w,index:v,geometry:E?M.geometry:ao(p,c,f),properties:p.properties,type:p.type,patterns:{}},L=this.layoutVertexArray.length;this.hasPattern?this.features.push(cm("fill-extrusion",this.layers,C,this.zoom,s)):this.addFeature(C,C.geometry,v,c,{},s.availableImages,f),s.featureIndex.insert(p,C.geometry,v,w,this.index,L)}this.sortBorders()}addFeatures(t,s,c,f,p){for(const _ of this.features){const{geometry:v}=_;this.addFeature(_,v,_.index,s,c,f,p)}this.sortBorders()}update(t,s,c,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,s,this.stateDependentLayers,c,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,iE),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=t.createVertexBuffer(this.layoutVertexExtArray,tE.members,!0))),this.programConfigurations.upload(t),this.uploaded=!0}uploadCentroid(t){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,eE.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,s,c,f,p,_,v){const w=[new F(0,0),new F(It,It)],E=v.projection,M=E.name==="globe",C=this.enableTerrain&&!M?new Vy:null,L=aE[t.type]==="Polygon";M&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Ir);const O=am(s,500);for(let re=O.length-1;re>=0;re--){const he=O[re];(he.length===0||(z=he[0]).every(se=>se.x<=0)||z.every(se=>se.x>=It)||z.every(se=>se.y<=0)||z.every(se=>se.y>=It))&&O.splice(re,1)}var z;let G;if(M)G=Hy(O,w,f);else{G=[];for(const re of O)G.push({polygon:re,bounds:w})}const q=L?this.edgeRadius:0;for(const{polygon:re,bounds:he}of G){let se=0,le=0;for(const de of re)L&&!de[0].equals(de[de.length-1])&&de.push(de[0]),le+=L?de.length-1:de.length;const xe=this.segments.prepareSegment((L?5:4)*le,this.layoutVertexArray,this.indexArray);if(L){const de=[],Oe=[];se=xe.vertexLength;for(const Ne of re){let it,ze;Ne.length&&Ne!==re[0]&&Oe.push(de.length/2),it=Ne[1].sub(Ne[0])._perp()._unit();for(let Ge=1;Ge<Ne.length;Ge++){const He=Ne[Ge],Ze=Ne[Ge===Ne.length-1?1:Ge+1];let{x:Qe,y:Ye}=He;if(q){ze=Ze.sub(He)._perp()._unit();const ut=it.add(ze)._unit(),Ut=q*Math.min(4,1/(it.x*ut.x+it.y*ut.y));Qe+=Ut*ut.x,Ye+=Ut*ut.y,it=ze}Vu(this.layoutVertexArray,Qe,Ye,0,0,1,1,0),xe.vertexLength++,de.push(He.x,He.y),M&&Gu(this.layoutVertexExtArray,E.projectTilePoint(Qe,Ye,f),E.upVector(f,Qe,Ye))}}const Le=Gf(de,Oe);for(let Ne=0;Ne<Le.length;Ne+=3)this.indexArray.emplaceBack(se+Le[Ne],se+Le[Ne+2],se+Le[Ne+1]),xe.primitiveLength++}for(const de of re){C&&de.length&&C.startRing(de[0]);let Oe,Le,Ne,it=de.length>4&&Wy(de[de.length-2],de[0],de[1]),ze=q?cE(de[de.length-2],de[0],de[1],q):0;Le=de[1].sub(de[0])._perp()._unit();for(let Ge=1,He=0;Ge<de.length;Ge++){let Ze=de[Ge-1],Qe=de[Ge];const Ye=de[Ge===de.length-1?1:Ge+1];if(C&&L&&C.currentPolyCount.top++,$y(Qe,Ze,he)){q&&(Le=Ye.sub(Qe)._perp()._unit());continue}C&&C.append(Qe,Ze);const ut=Qe.sub(Ze)._perp(),Ut=ut.x/(Math.abs(ut.x)+Math.abs(ut.y)),Vt=ut.y>0?1:0,wt=Ze.dist(Qe);if(He+wt>32768&&(He=0),q){Ne=Ye.sub(Qe)._perp()._unit();let ft=Zy(Ze,Qe,Ye,Gy(Le,Ne),q);isNaN(ft)&&(ft=0);const gi=Qe.sub(Ze)._unit();Ze=Ze.add(gi.mult(ze))._round(),Qe=Qe.add(gi.mult(-ft))._round(),ze=ft,Le=Ne}const nt=xe.vertexLength,qt=de.length>4&&Wy(Ze,Qe,Ye);let Ot=qy(He,it,!0);if(Vu(this.layoutVertexArray,Ze.x,Ze.y,Ut,Vt,0,0,Ot),Vu(this.layoutVertexArray,Ze.x,Ze.y,Ut,Vt,0,1,Ot),He+=wt,Ot=qy(He,qt,!1),it=qt,Vu(this.layoutVertexArray,Qe.x,Qe.y,Ut,Vt,0,0,Ot),Vu(this.layoutVertexArray,Qe.x,Qe.y,Ut,Vt,0,1,Ot),xe.vertexLength+=4,this.indexArray.emplaceBack(nt+0,nt+1,nt+2),this.indexArray.emplaceBack(nt+1,nt+3,nt+2),xe.primitiveLength+=2,q){const ft=se+(Ge===1?de.length-2:Ge-2),gi=Ge===1?se:ft+1;if(this.indexArray.emplaceBack(nt+1,ft,nt+3),this.indexArray.emplaceBack(ft,gi,nt+3),xe.primitiveLength+=2,Oe===void 0&&(Oe=nt),!$y(Ye,de[Ge],he)){const fi=Ge===de.length-1?Oe:xe.vertexLength;this.indexArray.emplaceBack(nt+2,nt+3,fi),this.indexArray.emplaceBack(nt+3,fi+1,fi),this.indexArray.emplaceBack(nt+3,gi,fi+1),xe.primitiveLength+=3}}if(M){const ft=this.layoutVertexExtArray,gi=E.projectTilePoint(Ze.x,Ze.y,f),fi=E.projectTilePoint(Qe.x,Qe.y,f),Mi=E.upVector(f,Ze.x,Ze.y),Gt=E.upVector(f,Qe.x,Qe.y);Gu(ft,gi,Mi),Gu(ft,gi,Mi),Gu(ft,fi,Gt),Gu(ft,fi,Gt)}}L&&(se+=de.length-1)}}if(C&&C.polyCount.length>0){if(C.borders){C.vertexArrayOffset=this.centroidVertexArray.length;const re=C.borders,he=this.featuresOnBorder.push(C)-1;for(let se=0;se<4;se++)re[se][0]!==Number.MAX_VALUE&&this.borders[se].push(he)}this.encodeCentroid(C.borders?void 0:C.centroid(),C)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,c,p,_,f)}sortBorders(){for(let t=0;t<4;t++)this.borders[t].sort((s,c)=>this.featuresOnBorder[s].borders[t][0]-this.featuresOnBorder[c].borders[t][0])}encodeCentroid(t,s,c=!0){let f,p;if(t)if(t.y!==0){const v=s.span()._mult(this.tileToMeter);f=(Math.max(t.x,1)<<3)+Math.min(7,Math.round(v.x/10)),p=(Math.max(t.y,1)<<3)+Math.min(7,Math.round(v.y/10))}else f=Math.ceil(7*(t.x+450)),p=0;else f=0,p=+c;let _=c?this.centroidVertexArray.length:s.vertexArrayOffset;for(const v of s.polyCount){c&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*v.edges+v.top);for(let w=0;w<v.top;w++)this.centroidVertexArray.emplace(_++,f,p);for(let w=0;w<2*v.edges;w++)this.centroidVertexArray.emplace(_++,0,p),this.centroidVertexArray.emplace(_++,f,p)}}}function Gy(n,t){const s=n.add(t)._unit();return n.x*s.x+n.y*s.y}function cE(n,t,s,c){const f=t.sub(n)._perp()._unit(),p=s.sub(t)._perp()._unit();return Zy(n,t,s,Gy(f,p),c)}function Zy(n,t,s,c,f){const p=Math.sqrt(1-c*c);return Math.min(n.dist(t)/3,t.dist(s)/3,f*p/c)}function $y(n,t,s){return n.x<s[0].x&&t.x<s[0].x||n.x>s[1].x&&t.x>s[1].x||n.y<s[0].y&&t.y<s[0].y||n.y>s[1].y&&t.y>s[1].y}function Wy(n,t,s){if(n.x<0||n.x>=It||t.x<0||t.x>=It||s.x<0||s.x>=It)return!1;const c=s.sub(t),f=c.perp(),p=n.sub(t);return(c.x*p.x+c.y*p.y)/Math.sqrt((c.x*c.x+c.y*c.y)*(p.x*p.x+p.y*p.y))>-.866&&f.x*p.x+f.y*p.y<0}function qy(n,t,s){const c=t?2|n:-3&n;return s?1|c:-2&c}function Xy(){const n=Math.PI/32,t=Math.tan(n),s=Fp;return s*Math.sqrt(1+2*t*t)-s}function Hy(n,t,s){const c=1<<s.z,f=Fn(s.x/c),p=Fn((s.x+1)/c),_=vr(s.y/c),v=vr((s.y+1)/c);return function(w,E,M,C,L=0,O){const z=[];if(!w.length||!M||!C)return z;const G=(de,Oe)=>{for(const Le of de)z.push({polygon:Le,bounds:Oe})},q=Math.ceil(Math.log2(M)),re=Math.ceil(Math.log2(C)),he=q-re,se=[];for(let de=0;de<Math.abs(he);de++)se.push(he>0?0:1);for(let de=0;de<Math.min(q,re);de++)se.push(0),se.push(1);let le=w;if(le=Hf(le,E[0].y-L,E[1].y+L,1),le=Hf(le,E[0].x-L,E[1].x+L,0),!le.length)return z;const xe=[];for(se.length?xe.push({polygons:le,bounds:E,depth:0}):G(le,E);xe.length;){const de=xe.pop(),Oe=de.depth,Le=se[Oe],Ne=de.bounds[0],it=de.bounds[1],ze=Le===0?Ne.x:Ne.y,Ge=Le===0?it.x:it.y,He=O?O(Le,ze,Ge):.5*(ze+Ge),Ze=Hf(de.polygons,ze-L,He+L,Le),Qe=Hf(de.polygons,He-L,Ge+L,Le);if(Ze.length){const Ye=[Ne,new F(Le===0?He:it.x,Le===1?He:it.y)];se.length>Oe+1?xe.push({polygons:Ze,bounds:Ye,depth:Oe+1}):G(Ze,Ye)}if(Qe.length){const Ye=[new F(Le===0?He:Ne.x,Le===1?He:Ne.y),it];se.length>Oe+1?xe.push({polygons:Qe,bounds:Ye,depth:Oe+1}):G(Qe,Ye)}}return z}(n,t,Math.ceil((p-f)/11.25),Math.ceil((_-v)/11.25),1,(w,E,M)=>{if(w===0)return .5*(E+M);{const C=vr((s.y+E/It)/c);return(oo(.5*(vr((s.y+M/It)/c)+C))*c-s.y)*It}})}pt(Zu,"FillExtrusionBucket",{omit:["layers","features"]}),pt(Vy,"PartMetadata");const uE=new Ue({"fill-extrusion-edge-radius":new pe(Fe["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var hE={paint:new Ue({"fill-extrusion-opacity":new pe(Fe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new we(Fe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new pe(Fe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new pe(Fe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ie(Fe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new we(Fe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new we(Fe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new pe(Fe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new pe(Fe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new pe(Fe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"])}),layout:uE};function Yy(n,t,s){var c=2*Math.PI*6378137/256/Math.pow(2,s);return[n*c-2*Math.PI*6378137/2,t*c-2*Math.PI*6378137/2]}class Yf{constructor(t,s,c){this.z=t,this.x=s,this.y=c,this.key=$u(0,t,t,s,c)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,s){const c=function(p,_,v){var w=Yy(256*p,256*(_=Math.pow(2,v)-_-1),v),E=Yy(256*(p+1),256*(_+1),v);return w[0]+","+w[1]+","+E[0]+","+E[1]}(this.x,this.y,this.z),f=function(p,_,v){let w,E="";for(let M=p;M>0;M--)w=1<<M-1,E+=(_&w?1:0)+(v&w?2:0);return E}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(s==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",f).replace("{bbox-epsg-3857}",c)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Ky{constructor(t,s){this.wrap=t,this.canonical=s,this.key=$u(t,s.z,s.z,s.x,s.y)}}class Nr{constructor(t,s,c,f,p){this.overscaledZ=t,this.wrap=s,this.canonical=new Yf(c,+f,+p),this.key=s===0&&t===c?this.canonical.key:$u(s,t,c,f,p)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){const s=this.canonical.z-t;return t>this.canonical.z?new Nr(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Nr(t,this.wrap,t,this.canonical.x>>s,this.canonical.y>>s)}calculateScaledKey(t,s=!0){if(this.overscaledZ===t&&s)return this.key;if(t>this.canonical.z)return $u(this.wrap*+s,t,this.canonical.z,this.canonical.x,this.canonical.y);{const c=this.canonical.z-t;return $u(this.wrap*+s,t,t,this.canonical.x>>c,this.canonical.y>>c)}}isChildOf(t){if(t.wrap!==this.wrap)return!1;const s=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>s&&t.canonical.y===this.canonical.y>>s}children(t){if(this.overscaledZ>=t)return[new Nr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const s=this.canonical.z+1,c=2*this.canonical.x,f=2*this.canonical.y;return[new Nr(s,this.wrap,s,c,f),new Nr(s,this.wrap,s,c+1,f),new Nr(s,this.wrap,s,c,f+1),new Nr(s,this.wrap,s,c+1,f+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new Nr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new Nr(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Ky(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function $u(n,t,s,c,f){const p=1<<Math.min(s,22);let _=p*(f%p)+c%p;return n&&s<22&&(_+=p*p*((n<0?-2*n-1:2*n)%(1<<2*(22-s)))),16*(32*_+s)+(t-s)}function Wu(n,t){return n.x*t.x+n.y*t.y}function Jy(n,t){if(n.length===1){let s=0;const c=t[s++];let f;for(;!f||c.equals(f);)if(f=t[s++],!f)return 1/0;for(;s<t.length;s++){const p=t[s],_=n[0],v=f.sub(c),w=p.sub(c),E=_.sub(c),M=Wu(v,v),C=Wu(v,w),L=Wu(w,w),O=Wu(E,v),z=Wu(E,w),G=M*L-C*C,q=(L*O-C*z)/G,re=(M*z-C*O)/G,he=c.z*(1-q-re)+f.z*q+p.z*re;if(isFinite(he))return he}return 1/0}{let s=1/0;for(const c of t)s=Math.min(s,c.z);return s}}function Kf(n){const t=new F(n[0],n[1]);return t.z=n[2],t}function Qy(n,t,s,c,f,p,_,v){const w=_*f.getElevationAt(n,t,!0,!0),E=p[0]!==0,M=E?p[1]===0?_*(p[0]/7-450):_*function(C,L,O){const z=Math.floor(L[0]/8),G=Math.floor(L[1]/8),q=10*(L[0]-8*z),re=10*(L[1]-8*G),he=C.getElevationAt(z,G,!0,!0),se=C.getMeterToDEM(O),le=Math.floor(.5*(q*se-1)),xe=Math.floor(.5*(re*se-1)),de=C.tileCoordToPixel(z,G),Oe=2*le+1,Le=2*xe+1,Ne=function(Qe,Ye,ut,Ut,Vt){return[Qe.getElevationAtPixel(Ye,ut,!0),Qe.getElevationAtPixel(Ye+Vt,ut,!0),Qe.getElevationAtPixel(Ye,ut+Vt,!0),Qe.getElevationAtPixel(Ye+Ut,ut+Vt,!0)]}(C,de.x-le,de.y-xe,Oe,Le),it=Math.abs(Ne[0]-Ne[1]),ze=Math.abs(Ne[2]-Ne[3]),Ge=Math.abs(Ne[0]-Ne[2])+Math.abs(Ne[1]-Ne[3]),He=Math.min(.25,.5*se*(it+ze)/Oe),Ze=Math.min(.25,.5*se*Ge/Le);return he+Math.max(He*q,Ze*re)}(f,p,v):w;return{base:w+(s===0)?-1:s,top:E?Math.max(M+c,w+s+2):w+c}}pt(Yf,"CanonicalTileID"),pt(Nr,"OverscaledTileID",{omit:["projMatrix"]});const fE=We([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:dE}=fE,pE=We([{name:"a_packed",components:4,type:"Float32"}]),{members:mE}=pE,gE=Ya.VectorTileFeature.types,_E=Math.cos(Math.PI/180*37.5);class Jf{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.id),this.index=t.index,this.projection=t.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(s=>{this.gradients[s.id]={}}),this.layoutVertexArray=new kt,this.layoutVertexArray2=new Wt,this.indexArray=new Zt,this.programConfigurations=new Za(t.layers,t.zoom),this.segments=new Xi,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(t,s,c,f){this.hasPattern=lm("line",this.layers,s);const p=this.layers[0].layout.get("line-sort-key"),_=[];for(const{feature:M,id:C,index:L,sourceLayerIndex:O}of t){const z=this.layers[0]._featureFilter.needGeometry,G=$a(M,z);if(!this.layers[0]._featureFilter.filter(new Y(this.zoom),G,c))continue;const q=p?p.evaluate(G,{},c):void 0,re={id:C,properties:M.properties,type:M.type,sourceLayerIndex:O,index:L,geometry:z?G.geometry:ao(M,c,f),patterns:{},sortKey:q};_.push(re)}p&&_.sort((M,C)=>M.sortKey-C.sortKey);const{lineAtlas:v,featureIndex:w}=s,E=this.addConstantDashes(v);for(const M of _){const{geometry:C,index:L,sourceLayerIndex:O}=M;if(E&&this.addFeatureDashes(M,v),this.hasPattern){const z=cm("line",this.layers,M,this.zoom,s);this.patternFeatures.push(z)}else this.addFeature(M,C,L,c,v.positions,s.availableImages);w.insert(t[L].feature,C,L,O,this.index)}}addConstantDashes(t){let s=!1;for(const c of this.layers){const f=c.paint.get("line-dasharray").value,p=c.layout.get("line-cap").value;if(f.kind!=="constant"||p.kind!=="constant")s=!0;else{const _=p.value,v=f.value;if(!v)continue;t.addDash(v.from,_),t.addDash(v.to,_),v.other&&t.addDash(v.other,_)}}return s}addFeatureDashes(t,s){const c=this.zoom;for(const f of this.layers){const p=f.paint.get("line-dasharray").value,_=f.layout.get("line-cap").value;if(p.kind==="constant"&&_.kind==="constant")continue;let v,w,E,M,C,L;if(p.kind==="constant"){const q=p.value;if(!q)continue;v=q.other||q.to,w=q.to,E=q.from}else v=p.evaluate({zoom:c-1},t),w=p.evaluate({zoom:c},t),E=p.evaluate({zoom:c+1},t);_.kind==="constant"?M=C=L=_.value:(M=_.evaluate({zoom:c-1},t),C=_.evaluate({zoom:c},t),L=_.evaluate({zoom:c+1},t)),s.addDash(v,M),s.addDash(w,C),s.addDash(E,L);const O=s.getKey(v,M),z=s.getKey(w,C),G=s.getKey(E,L);t.patterns[f.id]={min:O,mid:z,max:G}}}update(t,s,c,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,s,this.stateDependentLayers,c,f)}addFeatures(t,s,c,f,p){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,s,c,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,mE)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,dE),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,s,c,f,p,_){const v=this.layers[0].layout,w=v.get("line-join").evaluate(t,{}),E=v.get("line-cap").evaluate(t,{}),M=v.get("line-miter-limit"),C=v.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const L of s)this.addLine(L,t,w,E,M,C);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,c,p,_,f)}addLine(t,s,c,f,p,_){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let re=0;re<t.length-1;re++)this.totalDistance+=t[re].dist(t[re+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const v=gE[s.type]==="Polygon";let w=t.length;for(;w>=2&&t[w-1].equals(t[w-2]);)w--;let E=0;for(;E<w-1&&t[E].equals(t[E+1]);)E++;if(w<(v?3:2))return;c==="bevel"&&(p=1.05);const M=this.overscaling<=16?122880/(512*this.overscaling):0,C=this.segments.prepareSegment(10*w,this.layoutVertexArray,this.indexArray);let L,O,z,G,q;this.e1=this.e2=-1,v&&(L=t[w-2],q=t[E].sub(L)._unit()._perp());for(let re=E;re<w;re++){if(z=re===w-1?v?t[E+1]:void 0:t[re+1],z&&t[re].equals(z))continue;q&&(G=q),L&&(O=L),L=t[re],q=z?z.sub(L)._unit()._perp():G,G=G||q;let he=G.add(q);he.x===0&&he.y===0||he._unit();const se=G.x*q.x+G.y*q.y,le=he.x*q.x+he.y*q.y,xe=le!==0?1/le:1/0,de=2*Math.sqrt(2-2*le),Oe=le<_E&&O&&z,Le=G.x*q.y-G.y*q.x>0;if(Oe&&re>E){const ze=L.dist(O);if(ze>2*M){const Ge=L.sub(L.sub(O)._mult(M/ze)._round());this.updateDistance(O,Ge),this.addCurrentVertex(Ge,G,0,0,C),O=Ge}}const Ne=O&&z;let it=Ne?c:v?"butt":f;if(Ne&&it==="round"&&(xe<_?it="miter":xe<=2&&(it="fakeround")),it==="miter"&&xe>p&&(it="bevel"),it==="bevel"&&(xe>2&&(it="flipbevel"),xe<p&&(it="miter")),O&&this.updateDistance(O,L),it==="miter")he._mult(xe),this.addCurrentVertex(L,he,0,0,C);else if(it==="flipbevel"){if(xe>100)he=q.mult(-1);else{const ze=xe*G.add(q).mag()/G.sub(q).mag();he._perp()._mult(ze*(Le?-1:1))}this.addCurrentVertex(L,he,0,0,C),this.addCurrentVertex(L,he.mult(-1),0,0,C)}else if(it==="bevel"||it==="fakeround"){const ze=-Math.sqrt(xe*xe-1),Ge=Le?ze:0,He=Le?0:ze;if(O&&this.addCurrentVertex(L,G,Ge,He,C),it==="fakeround"){const Ze=Math.round(180*de/Math.PI/20);for(let Qe=1;Qe<Ze;Qe++){let Ye=Qe/Ze;if(Ye!==.5){const Ut=Ye-.5;Ye+=Ye*Ut*(Ye-1)*((1.0904+se*(se*(3.55645-1.43519*se)-3.2452))*Ut*Ut+(.848013+se*(.215638*se-1.06021)))}const ut=q.sub(G)._mult(Ye)._add(G)._unit()._mult(Le?-1:1);this.addHalfVertex(L,ut.x,ut.y,!1,Le,0,C)}}z&&this.addCurrentVertex(L,q,-Ge,-He,C)}else if(it==="butt")this.addCurrentVertex(L,he,0,0,C);else if(it==="square"){const ze=O?1:-1;O||this.addCurrentVertex(L,he,ze,ze,C),this.addCurrentVertex(L,he,0,0,C),O&&this.addCurrentVertex(L,he,ze,ze,C)}else it==="round"&&(O&&(this.addCurrentVertex(L,G,0,0,C),this.addCurrentVertex(L,G,1,1,C,!0)),z&&(this.addCurrentVertex(L,q,-1,-1,C,!0),this.addCurrentVertex(L,q,0,0,C)));if(Oe&&re<w-1){const ze=L.dist(z);if(ze>2*M){const Ge=L.add(z.sub(L)._mult(M/ze)._round());this.updateDistance(L,Ge),this.addCurrentVertex(Ge,q,0,0,C),L=Ge}}}}addCurrentVertex(t,s,c,f,p,_=!1){const v=s.y*f-s.x,w=-s.y-s.x*f;this.addHalfVertex(t,s.x+s.y*c,s.y-s.x*c,_,!1,c,p),this.addHalfVertex(t,v,w,_,!0,-f,p)}addHalfVertex({x:t,y:s},c,f,p,_,v,w){this.layoutVertexArray.emplaceBack((t<<1)+(p?1:0),(s<<1)+(_?1:0),Math.round(63*c)+128,Math.round(63*f)+128,1+(v===0?0:v<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const E=w.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,E),w.primitiveLength++),_?this.e2=E:this.e1=E}updateScaledDistance(){if(this.lineClips){const t=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=t*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(t,s){this.distance+=t.dist(s),this.updateScaledDistance()}}pt(Jf,"LineBucket",{omit:["layers","patternFeatures"]});const yE=new Ue({"line-cap":new we(Fe.layout_line["line-cap"]),"line-join":new we(Fe.layout_line["line-join"]),"line-miter-limit":new pe(Fe.layout_line["line-miter-limit"]),"line-round-limit":new pe(Fe.layout_line["line-round-limit"]),"line-sort-key":new we(Fe.layout_line["line-sort-key"])});var ev={paint:new Ue({"line-opacity":new we(Fe.paint_line["line-opacity"]),"line-color":new we(Fe.paint_line["line-color"]),"line-translate":new pe(Fe.paint_line["line-translate"]),"line-translate-anchor":new pe(Fe.paint_line["line-translate-anchor"]),"line-width":new we(Fe.paint_line["line-width"]),"line-gap-width":new we(Fe.paint_line["line-gap-width"]),"line-offset":new we(Fe.paint_line["line-offset"]),"line-blur":new we(Fe.paint_line["line-blur"]),"line-dasharray":new Ie(Fe.paint_line["line-dasharray"]),"line-pattern":new Ie(Fe.paint_line["line-pattern"]),"line-gradient":new Ae(Fe.paint_line["line-gradient"]),"line-trim-offset":new pe(Fe.paint_line["line-trim-offset"])}),layout:yE};const tv=new class extends we{possiblyEvaluate(n,t){return t=new Y(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,zoomHistory:t.zoomHistory,transition:t.transition}),super.possiblyEvaluate(n,t)}evaluate(n,t,s,c){return t=gt({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(n,t,s,c)}}(ev.paint.properties["line-width"].specification);function iv(n,t){return t>0?t+2*n:n}tv.useIntegerZoom=!0;const vE=We([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),xE=We([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),bE=We([{name:"a_projected_pos",components:4,type:"Float32"}],4);We([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const wE=We([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),TE=We([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);We([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const rv=We([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),EE=We([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);We([{name:"triangle",components:3,type:"Uint16"}]),We([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),We([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),We([{type:"Float32",name:"offsetX"}]),We([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var xr=24;const Ms=128;function um(n,t){const{expression:s}=t;if(s.kind==="constant")return{kind:"constant",layoutSize:s.evaluate(new Y(n+1))};if(s.kind==="source")return{kind:"source"};{const{zoomStops:c,interpolationType:f}=s;let p=0;for(;p<c.length&&c[p]<=n;)p++;p=Math.max(0,p-1);let _=p;for(;_<c.length&&c[_]<n+1;)_++;_=Math.min(c.length-1,_);const v=c[p],w=c[_];return s.kind==="composite"?{kind:"composite",minZoom:v,maxZoom:w,interpolationType:f}:{kind:"camera",minZoom:v,maxZoom:w,minSize:s.evaluate(new Y(v)),maxSize:s.evaluate(new Y(w)),interpolationType:f}}}function Qf(n,{uSize:t,uSizeT:s},{lowerSize:c,upperSize:f}){return n.kind==="source"?c/Ms:n.kind==="composite"?Qt(c/Ms,f/Ms,s):t}function ec(n,t){let s=0,c=0;if(n.kind==="constant")c=n.layoutSize;else if(n.kind!=="source"){const{interpolationType:f,minZoom:p,maxZoom:_}=n,v=f?Re(zn.interpolationFactor(f,t,p,_),0,1):0;n.kind==="camera"?c=Qt(n.minSize,n.maxSize,v):s=v}return{uSizeT:s,uSize:c}}var SE=Object.freeze({__proto__:null,getSizeData:um,evaluateSizeForFeature:Qf,evaluateSizeForZoom:ec,SIZE_PACK_FACTOR:Ms});function AE(n,t,s){return n.sections.forEach(c=>{c.text=function(f,p,_){const v=p.layout.get("text-transform").evaluate(_,{});return v==="uppercase"?f=f.toLocaleUpperCase():v==="lowercase"&&(f=f.toLocaleLowerCase()),H.applyArabicShaping&&(f=H.applyArabicShaping(f)),f}(c.text,t,s)}),n}const qu={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};function ME(n){return n==="︶"||n==="﹈"||n==="︸"||n==="﹄"||n==="﹂"||n==="︾"||n==="︼"||n==="︺"||n==="︘"||n==="﹀"||n==="︐"||n==="︓"||n==="︔"||n==="｀"||n==="￣"||n==="︑"||n==="︒"}function PE(n){return n==="︵"||n==="﹇"||n==="︷"||n==="﹃"||n==="﹁"||n==="︽"||n==="︻"||n==="︹"||n==="︗"||n==="︿"}var nv=function(n,t,s,c,f){var p,_,v=8*f-c-1,w=(1<<v)-1,E=w>>1,M=-7,C=f-1,L=-1,O=n[t+C];for(C+=L,p=O&(1<<-M)-1,O>>=-M,M+=v;M>0;p=256*p+n[t+C],C+=L,M-=8);for(_=p&(1<<-M)-1,p>>=-M,M+=c;M>0;_=256*_+n[t+C],C+=L,M-=8);if(p===0)p=1-E;else{if(p===w)return _?NaN:1/0*(O?-1:1);_+=Math.pow(2,c),p-=E}return(O?-1:1)*_*Math.pow(2,p-c)},sv=function(n,t,s,c,f,p){var _,v,w,E=8*p-f-1,M=(1<<E)-1,C=M>>1,L=f===23?Math.pow(2,-24)-Math.pow(2,-77):0,O=0,z=1,G=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(v=isNaN(t)?1:0,_=M):(_=Math.floor(Math.log(t)/Math.LN2),t*(w=Math.pow(2,-_))<1&&(_--,w*=2),(t+=_+C>=1?L/w:L*Math.pow(2,1-C))*w>=2&&(_++,w/=2),_+C>=M?(v=0,_=M):_+C>=1?(v=(t*w-1)*Math.pow(2,f),_+=C):(v=t*Math.pow(2,C-1)*Math.pow(2,f),_=0));f>=8;n[s+O]=255&v,O+=z,v/=256,f-=8);for(_=_<<f|v,E+=f;E>0;n[s+O]=255&_,O+=z,_/=256,E-=8);n[s+O-z]|=128*G},Xu=mi;function mi(n){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(n)?n:new Uint8Array(n||0),this.pos=0,this.type=0,this.length=this.buf.length}mi.Varint=0,mi.Fixed64=1,mi.Bytes=2,mi.Fixed32=5;var hm=4294967296,ov=1/hm,av=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function co(n){return n.type===mi.Bytes?n.readVarint()+n.pos:n.pos+1}function tc(n,t,s){return s?4294967296*t+(n>>>0):4294967296*(t>>>0)+(n>>>0)}function lv(n,t,s){var c=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));s.realloc(c);for(var f=s.pos-1;f>=n;f--)s.buf[f+c]=s.buf[f]}function IE(n,t){for(var s=0;s<n.length;s++)t.writeVarint(n[s])}function CE(n,t){for(var s=0;s<n.length;s++)t.writeSVarint(n[s])}function LE(n,t){for(var s=0;s<n.length;s++)t.writeFloat(n[s])}function kE(n,t){for(var s=0;s<n.length;s++)t.writeDouble(n[s])}function RE(n,t){for(var s=0;s<n.length;s++)t.writeBoolean(n[s])}function OE(n,t){for(var s=0;s<n.length;s++)t.writeFixed32(n[s])}function DE(n,t){for(var s=0;s<n.length;s++)t.writeSFixed32(n[s])}function zE(n,t){for(var s=0;s<n.length;s++)t.writeFixed64(n[s])}function BE(n,t){for(var s=0;s<n.length;s++)t.writeSFixed64(n[s])}function ed(n,t){return(n[t]|n[t+1]<<8|n[t+2]<<16)+16777216*n[t+3]}function ic(n,t,s){n[s]=t,n[s+1]=t>>>8,n[s+2]=t>>>16,n[s+3]=t>>>24}function cv(n,t){return(n[t]|n[t+1]<<8|n[t+2]<<16)+(n[t+3]<<24)}function FE(n,t,s){t.glyphs=[],n===1&&s.readMessage(NE,t)}function NE(n,t,s){if(n===3){const{id:c,bitmap:f,width:p,height:_,left:v,top:w,advance:E}=s.readMessage(UE,{});t.glyphs.push({id:c,bitmap:new lo({width:p+6,height:_+6},f),metrics:{width:p,height:_,left:v,top:w,advance:E}})}else n===4?t.ascender=s.readSVarint():n===5&&(t.descender=s.readSVarint())}function UE(n,t,s){n===1?t.id=s.readVarint():n===2?t.bitmap=s.readBytes():n===3?t.width=s.readVarint():n===4?t.height=s.readVarint():n===5?t.left=s.readSVarint():n===6?t.top=s.readSVarint():n===7&&(t.advance=s.readVarint())}function fm(n){let t=0,s=0;for(const _ of n)t+=_.w*_.h,s=Math.max(s,_.w);n.sort((_,v)=>v.h-_.h);const c=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),s),h:1/0}];let f=0,p=0;for(const _ of n)for(let v=c.length-1;v>=0;v--){const w=c[v];if(!(_.w>w.w||_.h>w.h)){if(_.x=w.x,_.y=w.y,p=Math.max(p,_.y+_.h),f=Math.max(f,_.x+_.w),_.w===w.w&&_.h===w.h){const E=c.pop();v<c.length&&(c[v]=E)}else _.h===w.h?(w.x+=_.w,w.w-=_.w):_.w===w.w?(w.y+=_.h,w.h-=_.h):(c.push({x:w.x+_.w,y:w.y,w:w.w-_.w,h:_.h}),w.y+=_.h,w.h-=_.h);break}}return{w:f,h:p,fill:t/(f*p)||0}}mi.prototype={destroy:function(){this.buf=null},readFields:function(n,t,s){for(s=s||this.length;this.pos<s;){var c=this.readVarint(),f=c>>3,p=this.pos;this.type=7&c,n(f,t,this),this.pos===p&&this.skip(c)}return t},readMessage:function(n,t){return this.readFields(n,t,this.readVarint()+this.pos)},readFixed32:function(){var n=ed(this.buf,this.pos);return this.pos+=4,n},readSFixed32:function(){var n=cv(this.buf,this.pos);return this.pos+=4,n},readFixed64:function(){var n=ed(this.buf,this.pos)+ed(this.buf,this.pos+4)*hm;return this.pos+=8,n},readSFixed64:function(){var n=ed(this.buf,this.pos)+cv(this.buf,this.pos+4)*hm;return this.pos+=8,n},readFloat:function(){var n=nv(this.buf,this.pos,!0,23,4);return this.pos+=4,n},readDouble:function(){var n=nv(this.buf,this.pos,!0,52,8);return this.pos+=8,n},readVarint:function(n){var t,s,c=this.buf;return t=127&(s=c[this.pos++]),s<128?t:(t|=(127&(s=c[this.pos++]))<<7,s<128?t:(t|=(127&(s=c[this.pos++]))<<14,s<128?t:(t|=(127&(s=c[this.pos++]))<<21,s<128?t:function(f,p,_){var v,w,E=_.buf;if(v=(112&(w=E[_.pos++]))>>4,w<128||(v|=(127&(w=E[_.pos++]))<<3,w<128)||(v|=(127&(w=E[_.pos++]))<<10,w<128)||(v|=(127&(w=E[_.pos++]))<<17,w<128)||(v|=(127&(w=E[_.pos++]))<<24,w<128)||(v|=(1&(w=E[_.pos++]))<<31,w<128))return tc(f,v,p);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(s=c[this.pos]))<<28,n,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var n=this.readVarint();return n%2==1?(n+1)/-2:n/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var n=this.readVarint()+this.pos,t=this.pos;return this.pos=n,n-t>=12&&av?function(s,c,f){return av.decode(s.subarray(c,f))}(this.buf,t,n):function(s,c,f){for(var p="",_=c;_<f;){var v,w,E,M=s[_],C=null,L=M>239?4:M>223?3:M>191?2:1;if(_+L>f)break;L===1?M<128&&(C=M):L===2?(192&(v=s[_+1]))==128&&(C=(31&M)<<6|63&v)<=127&&(C=null):L===3?(w=s[_+2],(192&(v=s[_+1]))==128&&(192&w)==128&&((C=(15&M)<<12|(63&v)<<6|63&w)<=2047||C>=55296&&C<=57343)&&(C=null)):L===4&&(w=s[_+2],E=s[_+3],(192&(v=s[_+1]))==128&&(192&w)==128&&(192&E)==128&&((C=(15&M)<<18|(63&v)<<12|(63&w)<<6|63&E)<=65535||C>=1114112)&&(C=null)),C===null?(C=65533,L=1):C>65535&&(C-=65536,p+=String.fromCharCode(C>>>10&1023|55296),C=56320|1023&C),p+=String.fromCharCode(C),_+=L}return p}(this.buf,t,n)},readBytes:function(){var n=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,n);return this.pos=n,t},readPackedVarint:function(n,t){if(this.type!==mi.Bytes)return n.push(this.readVarint(t));var s=co(this);for(n=n||[];this.pos<s;)n.push(this.readVarint(t));return n},readPackedSVarint:function(n){if(this.type!==mi.Bytes)return n.push(this.readSVarint());var t=co(this);for(n=n||[];this.pos<t;)n.push(this.readSVarint());return n},readPackedBoolean:function(n){if(this.type!==mi.Bytes)return n.push(this.readBoolean());var t=co(this);for(n=n||[];this.pos<t;)n.push(this.readBoolean());return n},readPackedFloat:function(n){if(this.type!==mi.Bytes)return n.push(this.readFloat());var t=co(this);for(n=n||[];this.pos<t;)n.push(this.readFloat());return n},readPackedDouble:function(n){if(this.type!==mi.Bytes)return n.push(this.readDouble());var t=co(this);for(n=n||[];this.pos<t;)n.push(this.readDouble());return n},readPackedFixed32:function(n){if(this.type!==mi.Bytes)return n.push(this.readFixed32());var t=co(this);for(n=n||[];this.pos<t;)n.push(this.readFixed32());return n},readPackedSFixed32:function(n){if(this.type!==mi.Bytes)return n.push(this.readSFixed32());var t=co(this);for(n=n||[];this.pos<t;)n.push(this.readSFixed32());return n},readPackedFixed64:function(n){if(this.type!==mi.Bytes)return n.push(this.readFixed64());var t=co(this);for(n=n||[];this.pos<t;)n.push(this.readFixed64());return n},readPackedSFixed64:function(n){if(this.type!==mi.Bytes)return n.push(this.readSFixed64());var t=co(this);for(n=n||[];this.pos<t;)n.push(this.readSFixed64());return n},skip:function(n){var t=7&n;if(t===mi.Varint)for(;this.buf[this.pos++]>127;);else if(t===mi.Bytes)this.pos=this.readVarint()+this.pos;else if(t===mi.Fixed32)this.pos+=4;else{if(t!==mi.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(n,t){this.writeVarint(n<<3|t)},realloc:function(n){for(var t=this.length||16;t<this.pos+n;)t*=2;if(t!==this.length){var s=new Uint8Array(t);s.set(this.buf),this.buf=s,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(n){this.realloc(4),ic(this.buf,n,this.pos),this.pos+=4},writeSFixed32:function(n){this.realloc(4),ic(this.buf,n,this.pos),this.pos+=4},writeFixed64:function(n){this.realloc(8),ic(this.buf,-1&n,this.pos),ic(this.buf,Math.floor(n*ov),this.pos+4),this.pos+=8},writeSFixed64:function(n){this.realloc(8),ic(this.buf,-1&n,this.pos),ic(this.buf,Math.floor(n*ov),this.pos+4),this.pos+=8},writeVarint:function(n){(n=+n||0)>268435455||n<0?function(t,s){var c,f;if(t>=0?(c=t%4294967296|0,f=t/4294967296|0):(f=~(-t/4294967296),4294967295^(c=~(-t%4294967296))?c=c+1|0:(c=0,f=f+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");s.realloc(10),function(p,_,v){v.buf[v.pos++]=127&p|128,p>>>=7,v.buf[v.pos++]=127&p|128,p>>>=7,v.buf[v.pos++]=127&p|128,p>>>=7,v.buf[v.pos++]=127&p|128,v.buf[v.pos]=127&(p>>>=7)}(c,0,s),function(p,_){var v=(7&p)<<4;_.buf[_.pos++]|=v|((p>>>=3)?128:0),p&&(_.buf[_.pos++]=127&p|((p>>>=7)?128:0),p&&(_.buf[_.pos++]=127&p|((p>>>=7)?128:0),p&&(_.buf[_.pos++]=127&p|((p>>>=7)?128:0),p&&(_.buf[_.pos++]=127&p|((p>>>=7)?128:0),p&&(_.buf[_.pos++]=127&p)))))}(f,s)}(n,this):(this.realloc(4),this.buf[this.pos++]=127&n|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=n>>>7&127))))},writeSVarint:function(n){this.writeVarint(n<0?2*-n-1:2*n)},writeBoolean:function(n){this.writeVarint(!!n)},writeString:function(n){n=String(n),this.realloc(4*n.length),this.pos++;var t=this.pos;this.pos=function(c,f,p){for(var _,v,w=0;w<f.length;w++){if((_=f.charCodeAt(w))>55295&&_<57344){if(!v){_>56319||w+1===f.length?(c[p++]=239,c[p++]=191,c[p++]=189):v=_;continue}if(_<56320){c[p++]=239,c[p++]=191,c[p++]=189,v=_;continue}_=v-55296<<10|_-56320|65536,v=null}else v&&(c[p++]=239,c[p++]=191,c[p++]=189,v=null);_<128?c[p++]=_:(_<2048?c[p++]=_>>6|192:(_<65536?c[p++]=_>>12|224:(c[p++]=_>>18|240,c[p++]=_>>12&63|128),c[p++]=_>>6&63|128),c[p++]=63&_|128)}return p}(this.buf,n,this.pos);var s=this.pos-t;s>=128&&lv(t,s,this),this.pos=t-1,this.writeVarint(s),this.pos+=s},writeFloat:function(n){this.realloc(4),sv(this.buf,n,this.pos,!0,23,4),this.pos+=4},writeDouble:function(n){this.realloc(8),sv(this.buf,n,this.pos,!0,52,8),this.pos+=8},writeBytes:function(n){var t=n.length;this.writeVarint(t),this.realloc(t);for(var s=0;s<t;s++)this.buf[this.pos++]=n[s]},writeRawMessage:function(n,t){this.pos++;var s=this.pos;n(t,this);var c=this.pos-s;c>=128&&lv(s,c,this),this.pos=s-1,this.writeVarint(c),this.pos+=c},writeMessage:function(n,t,s){this.writeTag(n,mi.Bytes),this.writeRawMessage(t,s)},writePackedVarint:function(n,t){t.length&&this.writeMessage(n,IE,t)},writePackedSVarint:function(n,t){t.length&&this.writeMessage(n,CE,t)},writePackedBoolean:function(n,t){t.length&&this.writeMessage(n,RE,t)},writePackedFloat:function(n,t){t.length&&this.writeMessage(n,LE,t)},writePackedDouble:function(n,t){t.length&&this.writeMessage(n,kE,t)},writePackedFixed32:function(n,t){t.length&&this.writeMessage(n,OE,t)},writePackedSFixed32:function(n,t){t.length&&this.writeMessage(n,DE,t)},writePackedFixed64:function(n,t){t.length&&this.writeMessage(n,zE,t)},writePackedSFixed64:function(n,t){t.length&&this.writeMessage(n,BE,t)},writeBytesField:function(n,t){this.writeTag(n,mi.Bytes),this.writeBytes(t)},writeFixed32Field:function(n,t){this.writeTag(n,mi.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(n,t){this.writeTag(n,mi.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(n,t){this.writeTag(n,mi.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(n,t){this.writeTag(n,mi.Fixed64),this.writeSFixed64(t)},writeVarintField:function(n,t){this.writeTag(n,mi.Varint),this.writeVarint(t)},writeSVarintField:function(n,t){this.writeTag(n,mi.Varint),this.writeSVarint(t)},writeStringField:function(n,t){this.writeTag(n,mi.Bytes),this.writeString(t)},writeFloatField:function(n,t){this.writeTag(n,mi.Fixed32),this.writeFloat(t)},writeDoubleField:function(n,t){this.writeTag(n,mi.Fixed64),this.writeDouble(t)},writeBooleanField:function(n,t){this.writeVarintField(n,!!t)}};class dm{constructor(t,{pixelRatio:s,version:c,stretchX:f,stretchY:p,content:_}){this.paddedRect=t,this.pixelRatio=s,this.stretchX=f,this.stretchY=p,this.content=_,this.version=c}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class uv{constructor(t,s){const c={},f={};this.haveRenderCallbacks=[];const p=[];this.addImages(t,c,p),this.addImages(s,f,p);const{w:_,h:v}=fm(p),w=new ln({width:_||1,height:v||1});for(const E in t){const M=t[E],C=c[E].paddedRect;ln.copy(M.data,w,{x:0,y:0},{x:C.x+1,y:C.y+1},M.data)}for(const E in s){const M=s[E],C=f[E].paddedRect,L=C.x+1,O=C.y+1,z=M.data.width,G=M.data.height;ln.copy(M.data,w,{x:0,y:0},{x:L,y:O},M.data),ln.copy(M.data,w,{x:0,y:G-1},{x:L,y:O-1},{width:z,height:1}),ln.copy(M.data,w,{x:0,y:0},{x:L,y:O+G},{width:z,height:1}),ln.copy(M.data,w,{x:z-1,y:0},{x:L-1,y:O},{width:1,height:G}),ln.copy(M.data,w,{x:0,y:0},{x:L+z,y:O},{width:1,height:G})}this.image=w,this.iconPositions=c,this.patternPositions=f}addImages(t,s,c){for(const f in t){const p=t[f],_={x:0,y:0,w:p.data.width+2,h:p.data.height+2};c.push(_),s[f]=new dm(_,p),p.hasRenderCallback&&this.haveRenderCallbacks.push(f)}}patchUpdatedImages(t,s){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(c=>t.hasImage(c)),t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const c in t.updatedImages)this.patchUpdatedImage(this.iconPositions[c],t.getImage(c),s),this.patchUpdatedImage(this.patternPositions[c],t.getImage(c),s)}patchUpdatedImage(t,s,c){if(!t||!s||t.version===s.version)return;t.version=s.version;const[f,p]=t.tl;c.update(s.data,void 0,{x:f,y:p})}}pt(dm,"ImagePosition"),pt(uv,"ImageAtlas");const wn={horizontal:1,vertical:2,horizontalOnly:3};class Hu{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,s){const c=new Hu;return c.scale=t||1,c.fontStack=s,c}static forImage(t){const s=new Hu;return s.imageName=t,s}}class rc{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,s){const c=new rc;for(let f=0;f<t.sections.length;f++){const p=t.sections[f];p.image?c.addImageSection(p):c.addTextSection(p,s)}return c}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSections(){return this.sections}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(t){this.text=function(s,c){let f="";for(let p=0;p<s.length;p++){const _=s.charCodeAt(p+1)||null,v=s.charCodeAt(p-1)||null;f+=!c&&(_&&Va(_)&&!qu[s[p+1]]||v&&Va(v)&&!qu[s[p-1]])||!qu[s[p]]?s[p]:qu[s[p]]}return f}(this.text,t)}trim(){let t=0;for(let c=0;c<this.text.length&&td[this.text.charCodeAt(c)];c++)t++;let s=this.text.length;for(let c=this.text.length-1;c>=0&&c>=t&&td[this.text.charCodeAt(c)];c--)s--;this.text=this.text.substring(t,s),this.sectionIndex=this.sectionIndex.slice(t,s)}substring(t,s){const c=new rc;return c.text=this.text.substring(t,s),c.sectionIndex=this.sectionIndex.slice(t,s),c.sections=this.sections,c}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,s)=>Math.max(t,this.sections[s].scale),0)}addTextSection(t,s){this.text+=t.text,this.sections.push(Hu.forText(t.scale,t.fontStack||s));const c=this.sections.length-1;for(let f=0;f<t.text.length;++f)this.sectionIndex.push(c)}addImageSection(t){const s=t.image?t.image.name:"";if(s.length===0)return void Ci("Can't add FormattedSection with an empty image.");const c=this.getNextImageSectionCharCode();c?(this.text+=String.fromCharCode(c),this.sections.push(Hu.forImage(s)),this.sectionIndex.push(this.sections.length-1)):Ci("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function pm(n,t,s,c,f,p,_,v,w,E,M,C,L,O,z,G){const q=rc.fromFeature(n,f);let re;C===wn.vertical&&q.verticalizePunctuation(L);const{processBidirectionalText:he,processStyledBidirectionalText:se}=H;if(he&&q.sections.length===1){re=[];const de=he(q.toString(),mm(q,E,p,t,c,O,z));for(const Oe of de){const Le=new rc;Le.text=Oe,Le.sections=q.sections;for(let Ne=0;Ne<Oe.length;Ne++)Le.sectionIndex.push(0);re.push(Le)}}else if(se){re=[];const de=se(q.text,q.sectionIndex,mm(q,E,p,t,c,O,z));for(const Oe of de){const Le=new rc;Le.text=Oe[0],Le.sectionIndex=Oe[1],Le.sections=q.sections,re.push(Le)}}else re=function(de,Oe){const Le=[],Ne=de.text;let it=0;for(const ze of Oe)Le.push(de.substring(it,ze)),it=ze;return it<Ne.length&&Le.push(de.substring(it,Ne.length)),Le}(q,mm(q,E,p,t,c,O,z));const le=[],xe={positionedLines:le,text:q.toString(),top:M[1],bottom:M[1],left:M[0],right:M[0],writingMode:C,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(de,Oe,Le,Ne,it,ze,Ge,He,Ze,Qe,Ye,ut){let Ut=0,Vt=0,wt=0;const nt=He==="right"?1:He==="left"?0:.5;let qt=!1;for(const Gt of it){const ti=Gt.getSections();for(const _i of ti){if(_i.imageName)continue;const di=Oe[_i.fontStack];if(di&&(qt=di.ascender!==void 0&&di.descender!==void 0,!qt))break}if(!qt)break}let Ot=0;for(const Gt of it){Gt.trim();const ti=Gt.getMaxScale(),_i=(ti-1)*xr,di={positionedGlyphs:[],lineOffset:0};de.positionedLines[Ot]=di;const hi=di.positionedGlyphs;let wi=0;if(!Gt.length()){Vt+=ze,++Ot;continue}let ki=0,cr=0;for(let Yt=0;Yt<Gt.length();Yt++){const Bi=Gt.getSection(Yt),Cr=Gt.getSectionIndex(Yt),oi=Gt.getCharCode(Yt);let Ri=Bi.scale,Ur=null,Pi=null,ji=null,ur=xr,Qi=0;const br=!(Ze===wn.horizontal||!Ye&&!Wl(oi)||Ye&&(td[oi]||(ft=oi,bf(ft)||wf(ft)||Tf(ft)||ja(ft)||Lu(ft))));if(Bi.imageName){const jr=Ne[Bi.imageName];if(!jr)continue;ji=Bi.imageName,de.iconsInText=de.iconsInText||!0,Pi=jr.paddedRect;const hr=jr.displaySize;Ri=Ri*xr/ut,Ur={width:hr[0],height:hr[1],left:1,top:-3,advance:br?hr[1]:hr[0],localGlyph:!1},Qi=qt?-Ur.height*Ri:ti*xr-17-hr[1]*Ri,ur=Ur.advance;const fo=(br?hr[0]:hr[1])*Ri-xr*ti;fo>0&&fo>wi&&(wi=fo)}else{const jr=Le[Bi.fontStack];if(!jr)continue;jr[oi]&&(Pi=jr[oi]);const hr=Oe[Bi.fontStack];if(!hr)continue;const fo=hr.glyphs[oi];if(!fo)continue;if(Ur=fo.metrics,ur=oi!==8203?xr:0,qt){const uc=hr.ascender!==void 0?Math.abs(hr.ascender):0,ah=hr.descender!==void 0?Math.abs(hr.descender):0,lh=(uc+ah)*Ri;ki<lh&&(ki=lh,cr=(uc-ah)/2*Ri),Qi=-uc*Ri}else Qi=(ti-Ri)*xr-17}br?(de.verticalizable=!0,hi.push({glyph:oi,imageName:ji,x:Ut,y:Vt+Qi,vertical:br,scale:Ri,localGlyph:Ur.localGlyph,fontStack:Bi.fontStack,sectionIndex:Cr,metrics:Ur,rect:Pi}),Ut+=ur*Ri+Qe):(hi.push({glyph:oi,imageName:ji,x:Ut,y:Vt+Qi,vertical:br,scale:Ri,localGlyph:Ur.localGlyph,fontStack:Bi.fontStack,sectionIndex:Cr,metrics:Ur,rect:Pi}),Ut+=Ur.advance*Ri+Qe)}hi.length!==0&&(wt=Math.max(Ut-Qe,wt),qt?mv(hi,nt,wi,cr,ze*ti/2):mv(hi,nt,wi,0,ze/2)),Ut=0;const Kr=ze*ti+wi;di.lineOffset=Math.max(wi,_i),Vt+=Kr,++Ot}var ft;const gi=Vt,{horizontalAlign:fi,verticalAlign:Mi}=gm(Ge);(function(Gt,ti,_i,di,hi,wi){const ki=(ti-_i)*hi,cr=-wi*di;for(const Kr of Gt)for(const Yt of Kr.positionedGlyphs)Yt.x+=ki,Yt.y+=cr})(de.positionedLines,nt,fi,Mi,wt,gi),de.top+=-Mi*gi,de.bottom=de.top+gi,de.left+=-fi*wt,de.right=de.left+wt,de.hasBaseline=qt}(xe,t,s,c,re,_,v,w,C,E,L,G),!function(de){for(const Oe of de)if(Oe.positionedGlyphs.length!==0)return!1;return!0}(le)&&xe}const td={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},jE={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function hv(n,t,s,c,f,p){if(t.imageName){const _=c[t.imageName];return _?_.displaySize[0]*t.scale*xr/p+f:0}{const _=s[t.fontStack],v=_&&_.glyphs[n];return v?v.metrics.advance*t.scale+f:0}}function fv(n,t,s,c){const f=Math.pow(n-t,2);return c?n<t?f/2:2*f:f+Math.abs(s)*s}function VE(n,t,s){let c=0;return n===10&&(c-=1e4),s&&(c+=150),n!==40&&n!==65288||(c+=50),t!==41&&t!==65289||(c+=50),c}function dv(n,t,s,c,f,p){let _=null,v=fv(t,s,f,p);for(const w of c){const E=fv(t-w.x,s,f,p)+w.badness;E<=v&&(_=w,v=E)}return{index:n,x:t,priorBreak:_,badness:v}}function pv(n){return n?pv(n.priorBreak).concat(n.index):[]}function mm(n,t,s,c,f,p,_){if(p!=="point")return[];if(!n)return[];const v=[],w=function(L,O,z,G,q,re){let he=0;for(let se=0;se<L.length();se++){const le=L.getSection(se);he+=hv(L.getCharCode(se),le,G,q,O,re)}return he/Math.max(1,Math.ceil(he/z))}(n,t,s,c,f,_),E=n.text.indexOf("​")>=0;let M=0;for(let L=0;L<n.length();L++){const O=n.getSection(L),z=n.getCharCode(L);if(td[z]||(M+=hv(z,O,c,f,t,_)),L<n.length()-1){const G=!((C=z)<11904||!(Su(C)||Af(C)||Cu(C)||Cf(C)||Pu(C)||Ef(C)||Mf(C)||Gl(C)||Iu(C)||Ua(C)||Mu(C)||ku(C)||Eu(C)||Na(C)||Sf(C)||Au(C)||Js(C)||Lf(C)||Pf(C)||Zl(C)));(jE[z]||G||O.imageName)&&v.push(dv(L+1,M,w,v,VE(z,n.getCharCode(L+1),G&&E),!1))}}var C;return pv(dv(n.length(),M,w,v,0,!0))}function gm(n){let t=.5,s=.5;switch(n){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":s=1;break;case"top":case"top-right":case"top-left":s=0}return{horizontalAlign:t,verticalAlign:s}}function mv(n,t,s,c,f){if(!(t||s||c||f))return;const p=n.length-1,_=n[p],v=(_.x+_.metrics.advance*_.scale)*t;for(let w=0;w<=p;w++)n[w].x-=v,n[w].y+=s+c+f}function GE(n,t,s){const{horizontalAlign:c,verticalAlign:f}=gm(s),p=t[0]-n.displaySize[0]*c,_=t[1]-n.displaySize[1]*f;return{image:n,top:_,bottom:_+n.displaySize[1],left:p,right:p+n.displaySize[0]}}function gv(n,t,s,c,f,p){const _=n.image;let v;if(_.content){const q=_.content,re=_.pixelRatio||1;v=[q[0]/re,q[1]/re,_.displaySize[0]-q[2]/re,_.displaySize[1]-q[3]/re]}const w=t.left*p,E=t.right*p;let M,C,L,O;s==="width"||s==="both"?(O=f[0]+w-c[3],C=f[0]+E+c[1]):(O=f[0]+(w+E-_.displaySize[0])/2,C=O+_.displaySize[0]);const z=t.top*p,G=t.bottom*p;return s==="height"||s==="both"?(M=f[1]+z-c[0],L=f[1]+G+c[2]):(M=f[1]+(z+G-_.displaySize[1])/2,L=M+_.displaySize[1]),{image:_,top:M,right:C,bottom:L,left:O,collisionPadding:v}}class uo extends F{constructor(t,s,c,f,p){super(t,s),this.angle=f,this.z=c,p!==void 0&&(this.segment=p)}clone(){return new uo(this.x,this.y,this.z,this.angle,this.segment)}}function _v(n,t,s,c,f){if(t.segment===void 0)return!0;let p=t,_=t.segment+1,v=0;for(;v>-s/2;){if(_--,_<0)return!1;v-=n[_].dist(p),p=n[_]}v+=n[_].dist(n[_+1]),_++;const w=[];let E=0;for(;v<s/2;){const M=n[_],C=n[_+1];if(!C)return!1;let L=n[_-1].angleTo(M)-M.angleTo(C);for(L=Math.abs((L+3*Math.PI)%(2*Math.PI)-Math.PI),w.push({distance:v,angleDelta:L}),E+=L;v-w[0].distance>c;)E-=w.shift().angleDelta;if(E>f)return!1;_++,v+=M.dist(C)}return!0}function yv(n){let t=0;for(let s=0;s<n.length-1;s++)t+=n[s].dist(n[s+1]);return t}function vv(n,t,s){return n?.6*t*s:0}function xv(n,t){return Math.max(n?n.right-n.left:0,t?t.right-t.left:0)}function ZE(n,t,s,c,f,p){const _=vv(s,f,p),v=xv(s,c)*p;let w=0;const E=yv(n)/2;for(let M=0;M<n.length-1;M++){const C=n[M],L=n[M+1],O=C.dist(L);if(w+O>E){const z=(E-w)/O,G=Qt(C.x,L.x,z),q=Qt(C.y,L.y,z),re=new uo(G,q,0,L.angleTo(C),M);return!_||_v(n,re,v,_,t)?re:void 0}w+=O}}function $E(n,t,s,c,f,p,_,v,w){const E=vv(c,p,_),M=xv(c,f),C=M*_,L=n[0].x===0||n[0].x===w||n[0].y===0||n[0].y===w;return t-C<t/4&&(t=C+t/4),bv(n,L?t/2*v%t:(M/2+2*p)*_*v%t,t,E,s,C,L,!1,w)}function bv(n,t,s,c,f,p,_,v,w){const E=p/2,M=yv(n);let C=0,L=t-s,O=[];for(let z=0;z<n.length-1;z++){const G=n[z],q=n[z+1],re=G.dist(q),he=q.angleTo(G);for(;L+s<C+re;){L+=s;const se=(L-C)/re,le=Qt(G.x,q.x,se),xe=Qt(G.y,q.y,se);if(le>=0&&le<w&&xe>=0&&xe<w&&L-E>=0&&L+E<=M){const de=new uo(le,xe,0,he,z);de._round(),c&&!_v(n,de,p,c,f)||O.push(de)}}C+=re}return v||O.length||_||(O=bv(n,C/2,s,c,f,p,_,!0,w)),O}function wv(n,t,s,c,f){const p=[];for(let _=0;_<n.length;_++){const v=n[_];let w;for(let E=0;E<v.length-1;E++){let M=v[E],C=v[E+1];M.x<t&&C.x<t||(M.x<t?M=new F(t,M.y+(t-M.x)/(C.x-M.x)*(C.y-M.y))._round():C.x<t&&(C=new F(t,M.y+(t-M.x)/(C.x-M.x)*(C.y-M.y))._round()),M.y<s&&C.y<s||(M.y<s?M=new F(M.x+(s-M.y)/(C.y-M.y)*(C.x-M.x),s)._round():C.y<s&&(C=new F(M.x+(s-M.y)/(C.y-M.y)*(C.x-M.x),s)._round()),M.x>=c&&C.x>=c||(M.x>=c?M=new F(c,M.y+(c-M.x)/(C.x-M.x)*(C.y-M.y))._round():C.x>=c&&(C=new F(c,M.y+(c-M.x)/(C.x-M.x)*(C.y-M.y))._round()),M.y>=f&&C.y>=f||(M.y>=f?M=new F(M.x+(f-M.y)/(C.y-M.y)*(C.x-M.x),f)._round():C.y>=f&&(C=new F(M.x+(f-M.y)/(C.y-M.y)*(C.x-M.x),f)._round()),w&&M.equals(w[w.length-1])||(w=[M],p.push(w)),w.push(C)))))}}return p}pt(uo,"Anchor");const Yu=1e20;function Tv(n,t,s,c,f,p,_,v,w){for(let E=t;E<t+c;E++)Ev(n,s*p+E,p,f,_,v,w);for(let E=s;E<s+f;E++)Ev(n,E*p+t,1,c,_,v,w)}function Ev(n,t,s,c,f,p,_){p[0]=0,_[0]=-Yu,_[1]=Yu,f[0]=n[t];for(let v=1,w=0,E=0;v<c;v++){f[v]=n[t+v*s];const M=v*v;do{const C=p[w];E=(f[v]-f[C]+M-C*C)/(v-C)/2}while(E<=_[w]&&--w>-1);w++,p[w]=v,_[w]=E,_[w+1]=Yu}for(let v=0,w=0;v<c;v++){for(;_[w+1]<v;)w++;const E=p[w],M=v-E;n[t+v*s]=f[E]+M*M}}const _m={none:0,ideographs:1,all:2};class nc{constructor(t,s,c){this.requestManager=t,this.localGlyphMode=s,this.localFontFamily=c,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(t){this.url=t}getGlyphs(t,s){const c=[];for(const f in t)for(const p of t[f])c.push({stack:f,id:p});mt(c,({stack:f,id:p},_)=>{let v=this.entries[f];v||(v=this.entries[f]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let w=v.glyphs[p];if(w!==void 0)return void _(null,{stack:f,id:p,glyph:w});if(w=this._tinySDF(v,f,p),w)return v.glyphs[p]=w,void _(null,{stack:f,id:p,glyph:w});const E=Math.floor(p/256);if(256*E>65535)return void _(new Error("glyphs > 65535 not supported"));if(v.ranges[E])return void _(null,{stack:f,id:p,glyph:w});let M=v.requests[E];M||(M=v.requests[E]=[],nc.loadGlyphRange(f,E,this.url,this.requestManager,(C,L)=>{if(L){v.ascender=L.ascender,v.descender=L.descender;for(const O in L.glyphs)this._doesCharSupportLocalGlyph(+O)||(v.glyphs[+O]=L.glyphs[+O]);v.ranges[E]=!0}for(const O of M)O(C,L);delete v.requests[E]})),M.push((C,L)=>{C?_(C):L&&_(null,{stack:f,id:p,glyph:L.glyphs[p]||null})})},(f,p)=>{if(f)s(f);else if(p){const _={};for(const{stack:v,id:w,glyph:E}of p)_[v]===void 0&&(_[v]={}),_[v].glyphs===void 0&&(_[v].glyphs={}),_[v].glyphs[w]=E&&{id:E.id,bitmap:E.bitmap.clone(),metrics:E.metrics},_[v].ascender=this.entries[v].ascender,_[v].descender=this.entries[v].descender;s(null,_)}})}_doesCharSupportLocalGlyph(t){return this.localGlyphMode!==_m.none&&(this.localGlyphMode===_m.all?!!this.localFontFamily:!!this.localFontFamily&&(Ua(t)||If(t)||Eu(t)||Js(t)||Gl(t)))}_tinySDF(t,s,c){const f=this.localFontFamily;if(!f||!this._doesCharSupportLocalGlyph(c))return;let p=t.tinySDF;if(!p){let G="400";/bold/i.test(s)?G="900":/medium/i.test(s)?G="500":/light/i.test(s)&&(G="200"),p=t.tinySDF=new nc.TinySDF({fontFamily:f,fontWeight:G,fontSize:48,buffer:6,radius:16}),p.fontWeight=G}if(this.localGlyphs[p.fontWeight][c])return this.localGlyphs[p.fontWeight][c];const _=String.fromCharCode(c),{data:v,width:w,height:E,glyphWidth:M,glyphHeight:C,glyphLeft:L,glyphTop:O,glyphAdvance:z}=p.draw(_);return this.localGlyphs[p.fontWeight][c]={id:c,bitmap:new lo({width:w,height:E},v),metrics:{width:M/2,height:C/2,left:L/2,top:O/2-27,advance:z/2,localGlyph:!0}}}}function Sv(n,t,s,c){const f=[],p=n.image,_=p.pixelRatio,v=p.paddedRect.w-2,w=p.paddedRect.h-2,E=n.right-n.left,M=n.bottom-n.top,C=p.stretchX||[[0,v]],L=p.stretchY||[[0,w]],O=(ze,Ge)=>ze+Ge[1]-Ge[0],z=C.reduce(O,0),G=L.reduce(O,0),q=v-z,re=w-G;let he=0,se=z,le=0,xe=G,de=0,Oe=q,Le=0,Ne=re;if(p.content&&c){const ze=p.content;he=id(C,0,ze[0]),le=id(L,0,ze[1]),se=id(C,ze[0],ze[2]),xe=id(L,ze[1],ze[3]),de=ze[0]-he,Le=ze[1]-le,Oe=ze[2]-ze[0]-se,Ne=ze[3]-ze[1]-xe}const it=(ze,Ge,He,Ze)=>{const Qe=rd(ze.stretch-he,se,E,n.left),Ye=nd(ze.fixed-de,Oe,ze.stretch,z),ut=rd(Ge.stretch-le,xe,M,n.top),Ut=nd(Ge.fixed-Le,Ne,Ge.stretch,G),Vt=rd(He.stretch-he,se,E,n.left),wt=nd(He.fixed-de,Oe,He.stretch,z),nt=rd(Ze.stretch-le,xe,M,n.top),qt=nd(Ze.fixed-Le,Ne,Ze.stretch,G),Ot=new F(Qe,ut),ft=new F(Vt,ut),gi=new F(Vt,nt),fi=new F(Qe,nt),Mi=new F(Ye/_,Ut/_),Gt=new F(wt/_,qt/_),ti=t*Math.PI/180;if(ti){const hi=Math.sin(ti),wi=Math.cos(ti),ki=[wi,-hi,hi,wi];Ot._matMult(ki),ft._matMult(ki),fi._matMult(ki),gi._matMult(ki)}const _i=ze.stretch+ze.fixed,di=Ge.stretch+Ge.fixed;return{tl:Ot,tr:ft,bl:fi,br:gi,tex:{x:p.paddedRect.x+1+_i,y:p.paddedRect.y+1+di,w:He.stretch+He.fixed-_i,h:Ze.stretch+Ze.fixed-di},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Mi,pixelOffsetBR:Gt,minFontScaleX:Oe/_/E,minFontScaleY:Ne/_/M,isSDF:s}};if(c&&(p.stretchX||p.stretchY)){const ze=Av(C,q,z),Ge=Av(L,re,G);for(let He=0;He<ze.length-1;He++){const Ze=ze[He],Qe=ze[He+1];for(let Ye=0;Ye<Ge.length-1;Ye++)f.push(it(Ze,Ge[Ye],Qe,Ge[Ye+1]))}}else f.push(it({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:v+1},{fixed:0,stretch:w+1}));return f}function id(n,t,s){let c=0;for(const f of n)c+=Math.max(t,Math.min(s,f[1]))-Math.max(t,Math.min(s,f[0]));return c}function Av(n,t,s){const c=[{fixed:-1,stretch:0}];for(const[f,p]of n){const _=c[c.length-1];c.push({fixed:f-_.stretch,stretch:_.stretch}),c.push({fixed:f-_.stretch,stretch:_.stretch+(p-f)})}return c.push({fixed:t+1,stretch:s}),c}function rd(n,t,s,c){return n/t*s+c}function nd(n,t,s,c){return n-t*s/c}function WE(n,t,s,c){const f=t+n.positionedLines[c].lineOffset;return c===0?s+f/2:s+(f+(t+n.positionedLines[c-1].lineOffset))/2}nc.loadGlyphRange=function(n,t,s,c,f){const p=256*t,_=p+255,v=c.transformRequest(c.normalizeGlyphsURL(s).replace("{fontstack}",n).replace("{range}",`${p}-${_}`),ye.Glyphs);Me(v,(w,E)=>{if(w)f(w);else if(E){const M={},C=function(L){return new Xu(L).readFields(FE,{})}(E);for(const L of C.glyphs)M[L.id]=L;f(null,{glyphs:M,ascender:C.ascender,descender:C.descender})}})},nc.TinySDF=class{constructor({fontSize:n=24,buffer:t=3,radius:s=8,cutoff:c=.25,fontFamily:f="sans-serif",fontWeight:p="normal",fontStyle:_="normal"}={}){this.buffer=t,this.cutoff=c,this.radius=s;const v=this.size=n+4*t,w=this._createCanvas(v),E=this.ctx=w.getContext("2d",{willReadFrequently:!0});E.font=`${_} ${p} ${n}px ${f}`,E.textBaseline="alphabetic",E.textAlign="left",E.fillStyle="black",this.gridOuter=new Float64Array(v*v),this.gridInner=new Float64Array(v*v),this.f=new Float64Array(v),this.z=new Float64Array(v+1),this.v=new Uint16Array(v)}_createCanvas(n){const t=document.createElement("canvas");return t.width=t.height=n,t}draw(n){const{width:t,actualBoundingBoxAscent:s,actualBoundingBoxDescent:c,actualBoundingBoxLeft:f,actualBoundingBoxRight:p}=this.ctx.measureText(n),_=Math.ceil(s),v=Math.min(this.size-this.buffer,Math.ceil(p-f)),w=Math.min(this.size-this.buffer,_+Math.ceil(c)),E=v+2*this.buffer,M=w+2*this.buffer,C=Math.max(E*M,0),L=new Uint8ClampedArray(C),O={data:L,width:E,height:M,glyphWidth:v,glyphHeight:w,glyphTop:_,glyphLeft:0,glyphAdvance:t};if(v===0||w===0)return O;const{ctx:z,buffer:G,gridInner:q,gridOuter:re}=this;z.clearRect(G,G,v,w),z.fillText(n,G,G+_);const he=z.getImageData(G,G,v,w);re.fill(Yu,0,C),q.fill(0,0,C);for(let se=0;se<w;se++)for(let le=0;le<v;le++){const xe=he.data[4*(se*v+le)+3]/255;if(xe===0)continue;const de=(se+G)*E+le+G;if(xe===1)re[de]=0,q[de]=Yu;else{const Oe=.5-xe;re[de]=Oe>0?Oe*Oe:0,q[de]=Oe<0?Oe*Oe:0}}Tv(re,0,0,E,M,E,this.f,this.v,this.z),Tv(q,G,G,v,w,E,this.f,this.v,this.z);for(let se=0;se<C;se++){const le=Math.sqrt(re[se])-Math.sqrt(q[se]);L[se]=Math.round(255-255*(le/this.radius+this.cutoff))}return O}};class qE{constructor(t=[],s=XE){if(this.data=t,this.length=this.data.length,this.compare=s,this.length>0)for(let c=(this.length>>1)-1;c>=0;c--)this._down(c)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const t=this.data[0],s=this.data.pop();return this.length--,this.length>0&&(this.data[0]=s,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:s,compare:c}=this,f=s[t];for(;t>0;){const p=t-1>>1,_=s[p];if(c(f,_)>=0)break;s[t]=_,t=p}s[t]=f}_down(t){const{data:s,compare:c}=this,f=this.length>>1,p=s[t];for(;t<f;){let _=1+(t<<1),v=s[_];const w=_+1;if(w<this.length&&c(s[w],v)<0&&(_=w,v=s[w]),c(v,p)>=0)break;s[t]=v,t=_}s[t]=p}}function XE(n,t){return n<t?-1:n>t?1:0}function HE(n,t=1,s=!1){let c=1/0,f=1/0,p=-1/0,_=-1/0;const v=n[0];for(let O=0;O<v.length;O++){const z=v[O];(!O||z.x<c)&&(c=z.x),(!O||z.y<f)&&(f=z.y),(!O||z.x>p)&&(p=z.x),(!O||z.y>_)&&(_=z.y)}const w=Math.min(p-c,_-f);let E=w/2;const M=new qE([],YE);if(w===0)return new F(c,f);for(let O=c;O<p;O+=w)for(let z=f;z<_;z+=w)M.push(new sc(O+E,z+E,E,n));let C=function(O){let z=0,G=0,q=0;const re=O[0];for(let he=0,se=re.length,le=se-1;he<se;le=he++){const xe=re[he],de=re[le],Oe=xe.x*de.y-de.x*xe.y;G+=(xe.x+de.x)*Oe,q+=(xe.y+de.y)*Oe,z+=3*Oe}return new sc(G/z,q/z,0,O)}(n),L=M.length;for(;M.length;){const O=M.pop();(O.d>C.d||!C.d)&&(C=O,s&&console.log("found best %d after %d probes",Math.round(1e4*O.d)/1e4,L)),O.max-C.d<=t||(E=O.h/2,M.push(new sc(O.p.x-E,O.p.y-E,E,n)),M.push(new sc(O.p.x+E,O.p.y-E,E,n)),M.push(new sc(O.p.x-E,O.p.y+E,E,n)),M.push(new sc(O.p.x+E,O.p.y+E,E,n)),L+=4)}return s&&(console.log(`num probes: ${L}`),console.log(`best distance: ${C.d}`)),C.p}function YE(n,t){return t.max-n.max}function sc(n,t,s,c){this.p=new F(n,t),this.h=s,this.d=function(f,p){let _=!1,v=1/0;for(let w=0;w<p.length;w++){const E=p[w];for(let M=0,C=E.length,L=C-1;M<C;L=M++){const O=E[M],z=E[L];O.y>f.y!=z.y>f.y&&f.x<(z.x-O.x)*(f.y-O.y)/(z.y-O.y)+O.x&&(_=!_),v=Math.min(v,dy(f,O,z))}}return(_?1:-1)*Math.sqrt(v)}(this.p,c),this.max=this.d+this.h*Math.SQRT2}const ym=Number.POSITIVE_INFINITY,KE=Math.sqrt(2);function Mv(n,t){return t[1]!==ym?function(s,c,f){let p=0,_=0;switch(c=Math.abs(c),f=Math.abs(f),s){case"top-right":case"top-left":case"top":_=f-7;break;case"bottom-right":case"bottom-left":case"bottom":_=7-f}switch(s){case"top-right":case"bottom-right":case"right":p=-c;break;case"top-left":case"bottom-left":case"left":p=c}return[p,_]}(n,t[0],t[1]):function(s,c){let f=0,p=0;c<0&&(c=0);const _=c/KE;switch(s){case"top-right":case"top-left":p=_-7;break;case"bottom-right":case"bottom-left":p=7-_;break;case"bottom":p=7-c;break;case"top":p=c-7}switch(s){case"top-right":case"bottom-right":f=-_;break;case"top-left":case"bottom-left":f=_;break;case"left":f=c;break;case"right":f=-c}return[f,p]}(n,t[0])}function JE(n,t,s,c,f,p,_,v,w,E){n.createArrays(),n.tilePixelRatio=It/(512*n.overscaling),n.compareText={},n.iconsNeedLinear=!1;const M=n.layers[0].layout,C=n.layers[0]._unevaluatedLayout._values,L={};if(n.textSizeData.kind==="composite"){const{minZoom:G,maxZoom:q}=n.textSizeData;L.compositeTextSizes=[C["text-size"].possiblyEvaluate(new Y(G),v),C["text-size"].possiblyEvaluate(new Y(q),v)]}if(n.iconSizeData.kind==="composite"){const{minZoom:G,maxZoom:q}=n.iconSizeData;L.compositeIconSizes=[C["icon-size"].possiblyEvaluate(new Y(G),v),C["icon-size"].possiblyEvaluate(new Y(q),v)]}L.layoutTextSize=C["text-size"].possiblyEvaluate(new Y(w+1),v),L.layoutIconSize=C["icon-size"].possiblyEvaluate(new Y(w+1),v),L.textMaxSize=C["text-size"].possiblyEvaluate(new Y(18),v);const O=M.get("text-rotation-alignment")==="map"&&M.get("symbol-placement")!=="point",z=M.get("text-size");for(const G of n.features){const q=M.get("text-font").evaluate(G,{},v).join(","),re=z.evaluate(G,{},v),he=L.layoutTextSize.evaluate(G,{},v),se=(L.layoutIconSize.evaluate(G,{},v),{horizontal:{},vertical:void 0}),le=G.text;let xe,de=[0,0];if(le){const Ne=le.toString(),it=M.get("text-letter-spacing").evaluate(G,{},v)*xr,ze=M.get("text-line-height").evaluate(G,{},v)*xr,Ge=Op(Ne)?it:0,He=M.get("text-anchor").evaluate(G,{},v),Ze=M.get("text-variable-anchor");if(!Ze){const wt=M.get("text-radial-offset").evaluate(G,{},v);de=wt?Mv(He,[wt*xr,ym]):M.get("text-offset").evaluate(G,{},v).map(nt=>nt*xr)}let Qe=O?"center":M.get("text-justify").evaluate(G,{},v);const Ye=M.get("symbol-placement"),ut=Ye==="point",Ut=Ye==="point"?M.get("text-max-width").evaluate(G,{},v)*xr:0,Vt=wt=>{n.allowVerticalPlacement&&$l(Ne)&&(se.vertical=pm(le,t,s,f,q,Ut,ze,He,wt,Ge,de,wn.vertical,!0,Ye,he,re))};if(!O&&Ze){const wt=Qe==="auto"?Ze.map(qt=>vm(qt)):[Qe];let nt=!1;for(let qt=0;qt<wt.length;qt++){const Ot=wt[qt];if(!se.horizontal[Ot])if(nt)se.horizontal[Ot]=se.horizontal[0];else{const ft=pm(le,t,s,f,q,Ut,ze,"center",Ot,Ge,de,wn.horizontal,!1,Ye,he,re);ft&&(se.horizontal[Ot]=ft,nt=ft.positionedLines.length===1)}}Vt("left")}else{if(Qe==="auto"&&(Qe=vm(He)),ut||M.get("text-writing-mode").indexOf("horizontal")>=0||!$l(Ne)){const wt=pm(le,t,s,f,q,Ut,ze,He,Qe,Ge,de,wn.horizontal,!1,Ye,he,re);wt&&(se.horizontal[Qe]=wt)}Vt(Ye==="point"?"left":Qe)}}let Oe=!1;if(G.icon&&G.icon.name){const Ne=c[G.icon.name];Ne&&(xe=GE(f[G.icon.name],M.get("icon-offset").evaluate(G,{},v),M.get("icon-anchor").evaluate(G,{},v)),Oe=Ne.sdf,n.sdfIcons===void 0?n.sdfIcons=Ne.sdf:n.sdfIcons!==Ne.sdf&&Ci("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ne.pixelRatio!==n.pixelRatio||M.get("icon-rotate").constantOr(1)!==0)&&(n.iconsNeedLinear=!0))}const Le=Iv(se.horizontal)||se.vertical;n.iconsInText||(n.iconsInText=!!Le&&Le.iconsInText),(Le||xe)&&QE(n,G,se,xe,c,L,he,0,de,Oe,_,v,E)}p&&n.generateCollisionDebugBuffers(w,n.collisionBoxArray)}function vm(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function QE(n,t,s,c,f,p,_,v,w,E,M,C,L){let O=p.textMaxSize.evaluate(t,{},C);O===void 0&&(O=_);const z=n.layers[0].layout,G=z.get("icon-offset").evaluate(t,{},C),q=Iv(s.horizontal)||s.vertical,re=L.name==="globe",he=_/24,se=n.tilePixelRatio*O/24,le=(Ge=n.overscaling,n.zoom>18&&Ge>2&&(Ge>>=1),Math.max(It/(512*Ge),1)*z.get("symbol-spacing")),xe=z.get("text-padding")*n.tilePixelRatio,de=z.get("icon-padding")*n.tilePixelRatio,Oe=fe(z.get("text-max-angle")),Le=z.get("text-rotation-alignment")==="map"&&z.get("symbol-placement")!=="point",Ne=z.get("icon-rotation-alignment")==="map"&&z.get("symbol-placement")!=="point",it=z.get("symbol-placement"),ze=le/2;var Ge;const He=z.get("icon-text-fit");let Ze;c&&He!=="none"&&(n.allowVerticalPlacement&&s.vertical&&(Ze=gv(c,s.vertical,He,z.get("icon-text-fit-padding"),G,he)),q&&(c=gv(c,q,He,z.get("icon-text-fit-padding"),G,he)));const Qe=(Ye,ut,Ut)=>{if(ut.x<0||ut.x>=It||ut.y<0||ut.y>=It)return;let Vt=null;if(re){const{x:wt,y:nt,z:qt}=L.projectTilePoint(ut.x,ut.y,Ut);Vt={anchor:new uo(wt,nt,qt,0,void 0),up:L.upVector(Ut,ut.x,ut.y)}}(function(wt,nt,qt,Ot,ft,gi,fi,Mi,Gt,ti,_i,di,hi,wi,ki,cr,Kr,Yt,Bi,Cr,oi,Ri,Ur,Pi,ji){const ur=wt.addToLineVertexArray(nt,Ot);let Qi,br,jr,hr,fo,uc,ah,lh=0,f0=0,d0=0,p0=0,zm=-1,Bm=-1;const ks={};let m0=Ru("");const Qa=qt?qt.anchor:nt;let Fm=0,Nm=0;if(Gt._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Fm,Nm]=Gt.layout.get("text-offset").evaluate(oi,{},ji).map(cn=>cn*xr):(Fm=Gt.layout.get("text-radial-offset").evaluate(oi,{},ji)*xr,Nm=ym),wt.allowVerticalPlacement&&ft.vertical){const cn=ft.vertical;if(ki)uc=xm(cn),Mi&&(ah=xm(Mi));else{const un=Gt.layout.get("text-rotate").evaluate(oi,{},ji)+90;jr=sd(ti,Qa,nt,_i,di,hi,cn,wi,un,cr),Mi&&(hr=sd(ti,Qa,nt,_i,di,hi,Mi,Yt,un))}}if(gi){const cn=Gt.layout.get("icon-rotate").evaluate(oi,{},ji),un=Gt.layout.get("icon-text-fit")!=="none",ch=Sv(gi,cn,Ur,un),jm=Mi?Sv(Mi,cn,Ur,un):void 0;br=sd(ti,Qa,nt,_i,di,hi,gi,Yt,cn),lh=4*ch.length;const g0=wt.iconSizeData;let el=null;g0.kind==="source"?(el=[Ms*Gt.layout.get("icon-size").evaluate(oi,{},ji)],el[0]>Ho&&Ci(`${wt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):g0.kind==="composite"&&(el=[Ms*Ri.compositeIconSizes[0].evaluate(oi,{},ji),Ms*Ri.compositeIconSizes[1].evaluate(oi,{},ji)],(el[0]>Ho||el[1]>Ho)&&Ci(`${wt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),wt.addSymbols(wt.icon,ch,el,Cr,Bi,oi,!1,qt,nt,ur.lineStartIndex,ur.lineLength,-1,Pi,ji),zm=wt.icon.placedSymbolArray.length-1,jm&&(f0=4*jm.length,wt.addSymbols(wt.icon,jm,el,Cr,Bi,oi,wn.vertical,qt,nt,ur.lineStartIndex,ur.lineLength,-1,Pi,ji),Bm=wt.icon.placedSymbolArray.length-1)}for(const cn in ft.horizontal){const un=ft.horizontal[cn];Qi||(m0=Ru(un.text),ki?fo=xm(un):Qi=sd(ti,Qa,nt,_i,di,hi,un,wi,Gt.layout.get("text-rotate").evaluate(oi,{},ji),cr));const ch=un.positionedLines.length===1;if(d0+=Pv(wt,qt,nt,un,fi,Gt,ki,oi,cr,ur,ft.vertical?wn.horizontal:wn.horizontalOnly,ch?Object.keys(ft.horizontal):[cn],ks,zm,Ri,Pi,ji),ch)break}ft.vertical&&(p0+=Pv(wt,qt,nt,ft.vertical,fi,Gt,ki,oi,cr,ur,wn.vertical,["vertical"],ks,Bm,Ri,Pi,ji));let ta=-1;const Um=(cn,un)=>cn?Math.max(cn,un):un;ta=Um(fo,ta),ta=Um(uc,ta),ta=Um(ah,ta);const LS=ta>-1?1:0;wt.glyphOffsetArray.length>=Ko.MAX_GLYPHS&&Ci("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),oi.sortKey!==void 0&&wt.addToSortKeyRanges(wt.symbolInstances.length,oi.sortKey),wt.symbolInstances.emplaceBack(Qa.x,Qa.y,Qa.z,nt.x,nt.y,ks.right>=0?ks.right:-1,ks.center>=0?ks.center:-1,ks.left>=0?ks.left:-1,ks.vertical>=0?ks.vertical:-1,zm,Bm,m0,Qi!==void 0?Qi:wt.collisionBoxArray.length,Qi!==void 0?Qi+1:wt.collisionBoxArray.length,jr!==void 0?jr:wt.collisionBoxArray.length,jr!==void 0?jr+1:wt.collisionBoxArray.length,br!==void 0?br:wt.collisionBoxArray.length,br!==void 0?br+1:wt.collisionBoxArray.length,hr||wt.collisionBoxArray.length,hr?hr+1:wt.collisionBoxArray.length,_i,d0,p0,lh,f0,LS,0,Fm,Nm,ta)})(n,ut,Vt,Ye,s,c,f,Ze,n.layers[0],n.collisionBoxArray,t.index,t.sourceLayerIndex,n.index,xe,Le,w,0,de,Ne,G,t,p,E,M,C)};if(it==="line")for(const Ye of wv(t.geometry,0,0,It,It)){const ut=$E(Ye,le,Oe,s.vertical||q,c,24,se,n.overscaling,It);for(const Ut of ut){const Vt=q;Vt&&eS(n,Vt.text,ze,Ut)||Qe(Ye,Ut,C)}}else if(it==="line-center"){for(const Ye of t.geometry)if(Ye.length>1){const ut=ZE(Ye,Oe,s.vertical||q,c,24,se);ut&&Qe(Ye,ut,C)}}else if(t.type==="Polygon")for(const Ye of am(t.geometry,0)){const ut=HE(Ye,16);Qe(Ye[0],new uo(ut.x,ut.y,0,0,void 0),C)}else if(t.type==="LineString")for(const Ye of t.geometry)Qe(Ye,new uo(Ye[0].x,Ye[0].y,0,0,void 0),C);else if(t.type==="Point")for(const Ye of t.geometry)for(const ut of Ye)Qe([ut],new uo(ut.x,ut.y,0,0,void 0),C)}const Ho=32640;function Pv(n,t,s,c,f,p,_,v,w,E,M,C,L,O,z,G,q){const re=function(le,xe,de,Oe,Le,Ne,it,ze){const Ge=[];if(xe.positionedLines.length===0)return Ge;const He=Oe.layout.get("text-rotate").evaluate(Ne,{})*Math.PI/180,Ze=function(Vt){const wt=Vt[0],nt=Vt[1],qt=wt*nt;return qt>0?[wt,-nt]:qt<0?[-wt,nt]:wt===0?[nt,wt]:[nt,-wt]}(de);let Qe=Math.abs(xe.top-xe.bottom);for(const Vt of xe.positionedLines)Qe-=Vt.lineOffset;const Ye=xe.positionedLines.length,ut=Qe/Ye;let Ut=xe.top-de[1];for(let Vt=0;Vt<Ye;++Vt){const wt=xe.positionedLines[Vt];Ut=WE(xe,ut,Ut,Vt);for(const nt of wt.positionedGlyphs){if(!nt.rect)continue;const qt=nt.rect||{};let Ot=4,ft=!0,gi=1,fi=0;if(nt.imageName){const Pi=it[nt.imageName];if(!Pi)continue;if(Pi.sdf){Ci("SDF images are not supported in formatted text and will be ignored.");continue}ft=!1,gi=Pi.pixelRatio,Ot=1/gi}const Mi=(Le||ze)&&nt.vertical,Gt=nt.metrics.advance*nt.scale/2,ti=nt.metrics,_i=nt.rect;if(_i===null)continue;ze&&xe.verticalizable&&(fi=nt.imageName?Gt-nt.metrics.width*nt.scale/2:0);const di=Le?[nt.x+Gt,nt.y]:[0,0];let hi=[0,0],wi=[0,0],ki=!1;Le||(Mi?(wi=[nt.x+Gt+Ze[0],nt.y+Ze[1]-fi],ki=!0):hi=[nt.x+Gt+de[0],nt.y+de[1]-fi]);const cr=_i.w*nt.scale/(gi*(nt.localGlyph?2:1)),Kr=_i.h*nt.scale/(gi*(nt.localGlyph?2:1));let Yt,Bi,Cr,oi;if(Mi){const Pi=nt.y-Ut,ji=new F(-Gt,Gt-Pi),ur=-Math.PI/2,Qi=new F(...wi);Yt=new F(-Gt+hi[0],hi[1]),Yt._rotateAround(ur,ji)._add(Qi),Yt.x+=-Pi+Gt,Yt.y-=(ti.left-Ot)*nt.scale;const br=nt.imageName?ti.advance*nt.scale:xr*nt.scale,jr=String.fromCharCode(nt.glyph);ME(jr)?Yt.x+=(1-Ot)*nt.scale:PE(jr)?Yt.x+=br-ti.height*nt.scale+(-Ot-1)*nt.scale:Yt.x+=nt.imageName||ti.width+2*Ot===_i.w&&ti.height+2*Ot===_i.h?(br-Kr)/2:(br-(ti.height+2*Ot)*nt.scale)/2,Bi=new F(Yt.x,Yt.y-cr),Cr=new F(Yt.x+Kr,Yt.y),oi=new F(Yt.x+Kr,Yt.y-cr)}else{const Pi=(ti.left-Ot)*nt.scale-Gt+hi[0],ji=(-ti.top-Ot)*nt.scale+hi[1],ur=Pi+cr,Qi=ji+Kr;Yt=new F(Pi,ji),Bi=new F(ur,ji),Cr=new F(Pi,Qi),oi=new F(ur,Qi)}if(He){let Pi;Pi=Le?new F(0,0):ki?new F(Ze[0],Ze[1]):new F(de[0],de[1]),Yt._rotateAround(He,Pi),Bi._rotateAround(He,Pi),Cr._rotateAround(He,Pi),oi._rotateAround(He,Pi)}const Ri=new F(0,0),Ur=new F(0,0);Ge.push({tl:Yt,tr:Bi,bl:Cr,br:oi,tex:qt,writingMode:xe.writingMode,glyphOffset:di,sectionIndex:nt.sectionIndex,isSDF:ft,pixelOffsetTL:Ri,pixelOffsetBR:Ur,minFontScaleX:0,minFontScaleY:0})}}return Ge}(0,c,w,p,_,v,f,n.allowVerticalPlacement),he=n.textSizeData;let se=null;he.kind==="source"?(se=[Ms*p.layout.get("text-size").evaluate(v,{},q)],se[0]>Ho&&Ci(`${n.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):he.kind==="composite"&&(se=[Ms*z.compositeTextSizes[0].evaluate(v,{},q),Ms*z.compositeTextSizes[1].evaluate(v,{},q)],(se[0]>Ho||se[1]>Ho)&&Ci(`${n.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),n.addSymbols(n.text,re,se,w,_,v,M,t,s,E.lineStartIndex,E.lineLength,O,G,q);for(const le of C)L[le]=n.text.placedSymbolArray.length-1;return 4*re.length}function Iv(n){for(const t in n)return n[t];return null}function sd(n,t,s,c,f,p,_,v,w,E){let M=_.top,C=_.bottom,L=_.left,O=_.right;const z=_.collisionPadding;if(z&&(L-=z[0],M-=z[1],O+=z[2],C+=z[3]),w){const G=new F(L,M),q=new F(O,M),re=new F(L,C),he=new F(O,C),se=fe(w);let le=new F(0,0);E&&(le=new F(E[0],E[1])),G._rotateAround(se,le),q._rotateAround(se,le),re._rotateAround(se,le),he._rotateAround(se,le),L=Math.min(G.x,q.x,re.x,he.x),O=Math.max(G.x,q.x,re.x,he.x),M=Math.min(G.y,q.y,re.y,he.y),C=Math.max(G.y,q.y,re.y,he.y)}return n.emplaceBack(t.x,t.y,t.z,s.x,s.y,L,M,O,C,v,c,f,p),n.length-1}function xm(n){n.collisionPadding&&(n.top-=n.collisionPadding[1],n.bottom+=n.collisionPadding[3]);const t=n.bottom-n.top;return t>0?Math.max(10,t):null}function eS(n,t,s,c){const f=n.compareText;if(t in f){const p=f[t];for(let _=p.length-1;_>=0;_--)if(c.dist(p[_])<s)return!0}else f[t]=[];return f[t].push(c),!1}const tS=We([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Cv}=tS,Lv=We([{name:"a_pos_3",components:3,type:"Int16"}]);var Ku=We([{name:"a_pos",type:"Int16",components:2}]);const ho=It/Math.PI/2,bm=2*Bn(1,0)*ho*Math.PI,oc=[64,32,16],ss=-ho,os=ho,iS=[new Yr([ss,ss,ss],[os,os,os]),new Yr([ss,ss,ss],[0,0,os]),new Yr([0,ss,ss],[os,0,os]),new Yr([ss,0,ss],[0,os,os]),new Yr([0,0,ss],[os,os,os])];function kv(n,t,s,c=!0){const f=rs([],n._camera.position,n.worldSize),p=[t,s,1,1];Xa(p,p,n.pixelMatrixInverse),Ey(p,p,1/p[3]);const _=Fr([],ns([],p,f)),v=n.globeMatrix,w=[v[12],v[13],v[14]],E=ns([],w,f),M=zu(E),C=Fr([],E),L=n.worldSize/(2*Math.PI),O=Nn(C,_),z=Math.asin(L/M);if(z<Math.acos(O)){if(!c)return null;const it=[],ze=[];rs(it,_,M/O),Fr(ze,ns(ze,it,E)),Fr(_,Xo(_,E,rs(_,ze,Math.tan(z)*M)))}const G=[];new Qp(f,_).closestPointOnSphere(w,L,G);const q=Fr([],zr(v,0)),re=Fr([],zr(v,1)),he=Fr([],zr(v,2)),se=Nn(q,G),le=Nn(re,G),xe=Nn(he,G),de=Ee(Math.asin(-le/L));let Oe=Ee(Math.atan2(se,xe));Oe=n.center.lng+function(it,ze){const Ge=(ze-it+180)%360-180;return Ge<-180?Ge+360:Ge}(n.center.lng,Oe);const Le=Es(Oe),Ne=Re(oo(de),0,1);return new Xl(Le,Ne)}class rS{constructor(t,s,c){this.a=ns([],t,c),this.b=ns([],s,c),this.center=c;const f=Fr([],this.a),p=Fr([],this.b);this.angle=Math.acos(Nn(f,p))}}function wm(n,t){if(n.angle===0)return null;let s;return s=n.a[t]===0?1/n.angle*.5*Math.PI:1/n.angle*Math.atan(n.b[t]/n.a[t]/Math.sin(n.angle)-1/Math.tan(n.angle)),s<0||s>1?null:function(c,f,p,_){const v=Math.sin(p);return c*(Math.sin((1-_)*p)/v)+f*(Math.sin(_*p)/v)}(n.a[t],n.b[t],n.angle,Re(s,0,1))+n.center[t]}function Ps(n){if(n.z<=1)return iS[n.z+2*n.y+n.x];const t=Tm(od(n));return Yr.fromPoints(t)}function Rv(n,t){const s=eh(t.zoom);if(s===0)return Ps(n);const c=od(n),f=Tm(c),p=Es(c.getWest())*t.worldSize,_=Es(c.getEast())*t.worldSize,v=oo(c.getNorth())*t.worldSize,w=oo(c.getSouth())*t.worldSize,E=[p,v,0],M=[_,v,0],C=[p,w,0],L=[_,w,0],O=Wp([],t.globeMatrix);return Yi(E,E,O),Yi(M,M,O),Yi(C,C,O),Yi(L,L,O),f[0]=ko(f[0],C,s),f[1]=ko(f[1],L,s),f[2]=ko(f[2],M,s),f[3]=ko(f[3],E,s),Yr.fromPoints(f)}function Ov(n,t,s,c,f){for(const p of s)Yi(p,p,c),rs(p,p,f),Yp(n,n,p),Kp(t,t,p)}function nS(n,t,s){const c=t/n.worldSize,f=Number.MAX_VALUE,p=[-f,-f,-f],_=[f,f,f],v=n.globeMatrix;if(s.z<=1)return Ov(_,p,Ps(s).getCorners(),v,c),new Yr(_,p);const w=od(s),E=Tm(w);if(Ov(_,p,E,v,c),w.contains(n.center)){p[2]=0;const Oe=n.point,Le=[Oe.x*c,Oe.y*c,0];return Yp(_,_,Le),Kp(p,p,Le),new Yr(_,p)}const M=[v[12]*c,v[13]*c,v[14]*c],C=w.getCenter(),L=Re(n.center.lat,-85.051129,Ss),O=Re(C.lat,-85.051129,Ss),z=Es(n.center.lng),G=oo(L);let q=z-Es(C.lng);const re=G-oo(O);q>.5?q-=1:q<-.5&&(q+=1);let he=0;Math.abs(q)>Math.abs(re)?he=q>=0?1:3:(he=re>=0?0:2,Vf(M,M,[v[4]*c,v[5]*c,v[6]*c],-Math.sin(fe(re>=0?w.getSouth():w.getNorth()))*ho));const se=E[he],le=E[(he+1)%4],xe=new rS(se,le,M),de=[wm(xe,0)||se[0],wm(xe,1)||se[1],wm(xe,2)||se[2]];return _[2]=Math.min(se[2],le[2]),Yp(_,_,de),Kp(p,p,de),new Yr(_,p)}function od({x:n,y:t,z:s}){const c=1/(1<<s),f=new li(Fn(n*c),vr((t+1)*c)),p=new li(Fn((n+1)*c),vr(t*c));return new qo(f,p)}function Tm(n){const t=fe(n.getNorth()),s=fe(n.getSouth()),c=Math.cos(t),f=Math.cos(s),p=Math.sin(t),_=Math.sin(s),v=n.getWest(),w=n.getEast();return[ac(f,_,v),ac(f,_,w),ac(c,p,w),ac(c,p,v)]}function ac(n,t,s,c=ho){return s=fe(s),[n*Math.sin(s)*c,-t*c,n*Math.cos(s)*c]}function ad(n,t,s){return ac(Math.cos(fe(n)),Math.sin(fe(n)),t,s)}function Ju(n,t,s,c){const f=1<<s.z,p=(n/It+s.x)/f;return ad(vr((t/It+s.y)/f),Fn(p),c)}function ld({min:n,max:t}){return 16383/Math.max(t[0]-n[0],t[1]-n[1],t[2]-n[2])}const Dv=new Float64Array(16);function Qu(n){const t=ld(n),s=vy(Dv,[t,t,t]);return Du(s,s,((c=[])[0]=-(f=n.min)[0],c[1]=-f[1],c[2]=-f[2],c));var c,f}function Em(n){const t=(c=n.min,(s=Dv)[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=c[0],s[13]=c[1],s[14]=c[2],s[15]=1,s);var s,c;const f=1/ld(n);return qa(t,t,[f,f,f])}function zv(n,t,s,c,f){const p=function(w){const E=It/(2*Math.PI);return w/(2*Math.PI)/E}(s),_=[n,t,-s/(2*Math.PI)],v=As(new Float64Array(16));return Du(v,v,_),qa(v,v,[p,p,p]),qp(v,v,fe(-f)),jf(v,v,fe(-c)),v}function eh(n){return ot(5,6,n)}function Bv(n,t){const s=ad(t.lat,t.lng);return p=(c=Hp([],function(O){const z=ad(O._center.lat,O._center.lng);let G=Jp([],Kl(0,1,0),z);const q=xy([],-O.angle,z);G=Yi(G,G,q),xy(q,-O._pitch,G);const re=Fr([],z);return rs(re,re,O.cameraToCenterDistance/O.pixelsPerMeter*bm),Yi(re,re,q),Xo([],z,re)}(n),s))[0],_=c[1],v=c[2],w=(f=s)[0],E=f[1],M=f[2],L=(C=Math.sqrt(p*p+_*_+v*v)*Math.sqrt(w*w+E*E+M*M))&&Nn(c,f)/C,Math.acos(Math.min(Math.max(L,-1),1));var c,f,p,_,v,w,E,M,C,L}const Fv=fe(85),sS=Math.cos(Fv),oS=Math.sin(Fv);function Nv(n,t){const s=n.fovAboveCenter,c=n.elevation?n.elevation.getMinElevationBelowMSL()*t:0,f=(n._camera.position[2]*n.worldSize-c)/Math.cos(n._pitch),p=Math.sin(s)*f/Math.sin(Math.max(Math.PI/2-n._pitch-s,.01)),_=Math.sin(n._pitch)*p+f;return Math.min(1.01*_,f*(1/n._horizonShift))}function Ka(n,t){if(!t.isReprojectedInTileSpace)return{scale:1<<n.z,x:n.x,y:n.y,x2:n.x+1,y2:n.y+1,projection:t};const s=Math.pow(2,-n.z),c=n.x*s,f=(n.x+1)*s,p=n.y*s,_=(n.y+1)*s,v=Fn(c),w=Fn(f),E=vr(p),M=vr(_),C=t.project(v,E),L=t.project(w,E),O=t.project(w,M),z=t.project(v,M);let G=Math.min(C.x,L.x,O.x,z.x),q=Math.min(C.y,L.y,O.y,z.y),re=Math.max(C.x,L.x,O.x,z.x),he=Math.max(C.y,L.y,O.y,z.y);const se=s/16;function le(de,Oe,Le,Ne,it,ze){const Ge=(Le+it)/2,He=(Ne+ze)/2,Ze=t.project(Fn(Ge),vr(He)),Qe=Math.max(0,G-Ze.x,q-Ze.y,Ze.x-re,Ze.y-he);G=Math.min(G,Ze.x),re=Math.max(re,Ze.x),q=Math.min(q,Ze.y),he=Math.max(he,Ze.y),Qe>se&&(le(de,Ze,Le,Ne,Ge,He),le(Ze,Oe,Ge,He,it,ze))}le(C,L,c,p,f,p),le(L,O,f,p,f,_),le(O,z,f,_,c,_),le(z,C,c,_,c,p),G-=se,q-=se,re+=se,he+=se;const xe=1/Math.max(re-G,he-q);return{scale:xe,x:G*xe,y:q*xe,x2:re*xe,y2:he*xe,projection:t}}const aS=As(new Float32Array(16));class Yo{constructor(t){this.spec=t,this.name=t.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(t,s){return{x:0,y:0,z:0}}unproject(t,s){return new li(0,0)}projectTilePoint(t,s,c){return{x:t,y:s,z:0}}locationPoint(t,s,c=!0){return t._coordinatePoint(t.locationCoordinate(s),c)}pixelsPerMeter(t,s){return Bn(1,t)*s}pixelSpaceConversion(t,s,c){return 1}farthestPixelDistance(t){return Nv(t,t.pixelsPerMeter)}pointCoordinate(t,s,c,f){const p=t.horizonLineFromTop(!1),_=new F(s,Math.max(p,c));return t.rayIntersectionCoordinate(t.pointRayIntersection(_,f))}pointCoordinate3D(t,s,c){const f=new F(s,c);if(t.elevation)return t.elevation.pointCoordinate(f);{const p=this.pointCoordinate(t,f.x,f.y,0);return[p.x,p.y,p.z]}}isPointAboveHorizon(t,s){if(t.elevation)return!this.pointCoordinate3D(t,s.x,s.y);const c=t.horizonLineFromTop();return s.y<c}createInversionMatrix(t,s){return aS}createTileMatrix(t,s,c){let f,p,_;const v=c.canonical,w=As(new Float64Array(16));if(this.isReprojectedInTileSpace){const E=Ka(v,this);f=1,p=E.x+c.wrap*E.scale,_=E.y,qa(w,w,[f/E.scale,f/E.scale,t.pixelsPerMeter/s])}else f=s/t.zoomScale(v.z),p=(v.x+Math.pow(2,v.z)*c.wrap)*f,_=v.y*f;return Du(w,w,[p,_,0]),qa(w,w,[f/It,f/It,1]),w}upVector(t,s,c){return[0,0,1]}upVectorScale(t,s,c){return{metersToTile:1}}}class lS extends Yo{constructor(t){super(t),this.range=[4,7],this.center=t.center||[-96,37.5];const[s,c]=this.parallels=t.parallels||[29.5,45.5],f=Math.sin(fe(s));this.n=(f+Math.sin(fe(c)))/2,this.c=1+f*(2*this.n-f),this.r0=Math.sqrt(this.c)/this.n}project(t,s){const{n:c,c:f,r0:p}=this,_=fe(t-this.center[0]),v=fe(s),w=Math.sqrt(f-2*c*Math.sin(v))/c;return{x:w*Math.sin(_*c),y:w*Math.cos(_*c)-p,z:0}}unproject(t,s){const{n:c,c:f,r0:p}=this,_=p+s;let v=Math.atan2(t,Math.abs(_))*Math.sign(_);_*c<0&&(v-=Math.PI*Math.sign(t)*Math.sign(_));const w=fe(this.center[0])*c;v=bt(v,-Math.PI-w,Math.PI-w);const E=Ee(v/c)+this.center[0],M=Math.asin(Re((f-(t*t+_*_)*c*c)/(2*c),-1,1)),C=Re(Ee(M),-85.051129,Ss);return new li(E,C)}}const th=1.340264,ih=-.081106,rh=893e-6,nh=.003796,cd=Math.sqrt(3)/2;class cS extends Yo{project(t,s){s=s/180*Math.PI,t=t/180*Math.PI;const c=Math.asin(cd*Math.sin(s)),f=c*c,p=f*f*f;return{x:.5*(t*Math.cos(c)/(cd*(th+3*ih*f+p*(7*rh+9*nh*f)))/Math.PI+.5),y:1-.5*(c*(th+ih*f+p*(rh+nh*f))/Math.PI+1),z:0}}unproject(t,s){t=(2*t-.5)*Math.PI;let c=s=(2*(1-s)-1)*Math.PI,f=c*c,p=f*f*f;for(let M,C,L,O=0;O<12&&(C=c*(th+ih*f+p*(rh+nh*f))-s,L=th+3*ih*f+p*(7*rh+9*nh*f),M=C/L,c=Re(c-M,-Math.PI/3,Math.PI/3),f=c*c,p=f*f*f,!(Math.abs(M)<1e-12));++O);const _=cd*t*(th+3*ih*f+p*(7*rh+9*nh*f))/Math.cos(c),v=Math.asin(Math.sin(c)/cd),w=Re(180*_/Math.PI,-180,180),E=Re(180*v/Math.PI,-85.051129,Ss);return new li(w,E)}}class uS extends Yo{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0}project(t,s){return{x:.5+t/360,y:.5-s/360,z:0}}unproject(t,s){const c=360*(t-.5),f=Re(360*(.5-s),-85.051129,Ss);return new li(c,f)}}const lc=Math.PI/2;function ud(n){return Math.tan((lc+n)/2)}class hS extends Yo{constructor(t){super(t),this.center=t.center||[0,30];const[s,c]=this.parallels=t.parallels||[30,30],f=fe(s),p=fe(c),_=Math.cos(f);this.n=f===p?Math.sin(f):Math.log(_/Math.cos(p))/Math.log(ud(p)/ud(f)),this.f=_*Math.pow(ud(f),this.n)/this.n}project(t,s){s=fe(s),t=fe(t-this.center[0]);const c=1e-6,{n:f,f:p}=this;p>0?s<-lc+c&&(s=-lc+c):s>lc-c&&(s=lc-c);const _=p/Math.pow(ud(s),f),v=_*Math.sin(f*t),w=p-_*Math.cos(f*t);return{x:.5*(v/Math.PI+.5),y:1-.5*(w/Math.PI+.5),z:0}}unproject(t,s){t=(2*t-.5)*Math.PI,s=(2*(1-s)-.5)*Math.PI;const{n:c,f}=this,p=f-s,_=Math.sign(p),v=Math.sign(c)*Math.sqrt(t*t+p*p);let w=Math.atan2(t,Math.abs(p))*_;p*c<0&&(w-=Math.PI*Math.sign(t)*_);const E=Re(Ee(w/c)+this.center[0],-180,180),M=Re(Ee(2*Math.atan(Math.pow(f/v,1/c))-lc),-85.051129,Ss);return new li(E,M)}}class Uv extends Yo{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(t,s){return{x:Es(t),y:oo(s),z:0}}unproject(t,s){const c=Fn(t),f=vr(s);return new li(c,f)}}const jv=fe(Ss);class fS extends Yo{project(t,s){const c=(s=fe(s))*s,f=c*c;return{x:.5*((t=fe(t))*(.8707-.131979*c+f*(f*(.003971*c-.001529*f)-.013791))/Math.PI+.5),y:1-.5*(s*(1.007226+c*(.015085+f*(.028874*c-.044475-.005916*f)))/Math.PI+1),z:0}}unproject(t,s){t=(2*t-.5)*Math.PI;let c=s=(2*(1-s)-1)*Math.PI,f=25,p=0,_=c*c;do{_=c*c;const E=_*_;p=(c*(1.007226+_*(.015085+E*(.028874*_-.044475-.005916*E)))-s)/(1.007226+_*(.045255+E*(.259866*_-.311325-.005916*11*E))),c=Re(c-p,-jv,jv)}while(Math.abs(p)>1e-6&&--f>0);_=c*c;const v=Re(Ee(t/(.8707+_*(_*(_*_*_*(.003971-.001529*_)-.013791)-.131979))),-180,180),w=Ee(c);return new li(v,w)}}const Vv=fe(Ss);class dS extends Yo{project(t,s){s=fe(s),t=fe(t);const c=Math.cos(s),f=2/Math.PI,p=Math.acos(c*Math.cos(t/2)),_=Math.sin(p)/p,v=.5*(t*f+2*c*Math.sin(t/2)/_)||0,w=.5*(s+Math.sin(s)/_)||0;return{x:.5*(v/Math.PI+.5),y:1-.5*(w/Math.PI+1),z:0}}unproject(t,s){let c=t=(2*t-.5)*Math.PI,f=s=(2*(1-s)-1)*Math.PI,p=25;const _=1e-6;let v=0,w=0;do{const E=Math.cos(f),M=Math.sin(f),C=2*M*E,L=M*M,O=E*E,z=Math.cos(c/2),G=Math.sin(c/2),q=2*z*G,re=G*G,he=1-O*z*z,se=he?1/he:0,le=he?Math.acos(E*z)*Math.sqrt(1/he):0,xe=.5*(2*le*E*G+2*c/Math.PI)-t,de=.5*(le*M+f)-s,Oe=.5*se*(O*re+le*E*z*L)+1/Math.PI,Le=se*(q*C/4-le*M*G),Ne=.125*se*(C*G-le*M*O*q),it=.5*se*(L*z+le*re*E)+.5,ze=Le*Ne-it*Oe;v=(de*Le-xe*it)/ze,w=(xe*Ne-de*Oe)/ze,c=Re(c-v,-Math.PI,Math.PI),f=Re(f-w,-Vv,Vv)}while((Math.abs(v)>_||Math.abs(w)>_)&&--p>0);return new li(Ee(c),Ee(f))}}class Gv extends Yo{constructor(t){super(t),this.center=t.center||[0,0],this.parallels=t.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(fe(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(t,s){const{scale:c,cosPhi:f}=this;return{x:fe(t)*f*c+.5,y:-Math.sin(fe(s))/f*c+.5,z:0}}unproject(t,s){const{scale:c,cosPhi:f}=this,p=-(s-.5)/c,_=Re(Ee((t-.5)/c)/f,-180,180),v=Math.asin(Re(p*f,-1,1)),w=Re(Ee(v),-85.051129,Ss);return new li(_,w)}}class pS extends Uv{constructor(t){super(t),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug","custom"],this.range=[3,5]}projectTilePoint(t,s,c){const f=Ju(t,s,c);return Yi(f,f,Qu(Ps(c))),{x:f[0],y:f[1],z:f[2]}}locationPoint(t,s){const c=ad(s.lat,s.lng),f=Fr([],c),p=t.elevation?t.elevation.getAtPointOrZero(t.locationCoordinate(s),t._centerAltitude):t._centerAltitude;Vf(c,c,f,Bn(1,0)*It*p);const _=As(new Float64Array(16));return Yl(_,t.pixelMatrix,t.globeMatrix),Yi(c,c,_),new F(c[0],c[1])}pixelsPerMeter(t,s){return Bn(1,0)*s}pixelSpaceConversion(t,s,c){const f=Qt(Bn(1,45)*s,Bn(1,t)*s,c);return this.pixelsPerMeter(t,s)/f}createTileMatrix(t,s,c){const f=Em(Ps(c.canonical));return Yl(new Float64Array(16),t.globeMatrix,f)}createInversionMatrix(t,s){const{center:c}=t,f=Qu(Ps(s));return jf(f,f,fe(c.lng)),qp(f,f,fe(c.lat)),qa(f,f,[t._pixelsPerMercatorPixel,t._pixelsPerMercatorPixel,1]),Float32Array.from(f)}pointCoordinate(t,s,c,f){return kv(t,s,c,!0)||new Xl(0,0)}pointCoordinate3D(t,s,c){const f=this.pointCoordinate(t,s,c,0);return[f.x,f.y,f.z]}isPointAboveHorizon(t,s){return!kv(t,s.x,s.y,!1)}farthestPixelDistance(t){const s=function(f,p){const _=f.cameraToCenterDistance,v=f._centerAltitude*p,w=f._camera,E=f._camera.forward(),M=Xo([],rs([],E,-_),[0,0,v]),C=f.worldSize/(2*Math.PI),L=[0,0,-C],O=f.width/f.height,z=Math.tan(f.fovAboveCenter),G=rs([],w.up(),z),q=rs([],w.right(),z*O),re=Fr([],Xo([],Xo([],E,G),q)),he=[];let se;if(new Qp(M,re).closestPointOnSphere(L,C,he)){const le=Xo([],he,L),xe=ns([],le,M);se=Math.cos(f.fovAboveCenter)*zu(xe)}else{const le=ns([],M,L),xe=ns([],L,M);Fr(xe,xe);const de=zu(le)-C;se=Math.sqrt(de*(de+2*C));const Oe=Math.acos(se/(C+de))-Math.acos(Nn(E,xe));se*=Math.cos(Oe)}return 1.01*se}(t,this.pixelsPerMeter(t.center.lat,t.worldSize)),c=eh(t.zoom);if(c>0){const f=Nv(t,Bn(1,t.center.lat)*t.worldSize),p=t.worldSize/(2*Math.PI),_=Math.max(t.width,t.height)/t.worldSize*Math.PI;return Qt(s,f+p*(1-Math.cos(_)),Math.pow(c,10))}return s}upVector(t,s,c){return Ju(s,c,t,1)}upVectorScale(t){return{metersToTile:bm*ld(Ps(t))}}}function Zv(n){const t=n.parallels,s=!!t&&Math.abs(t[0]+t[1])<.01;switch(n.name){case"mercator":return new Uv(n);case"equirectangular":return new uS(n);case"naturalEarth":return new fS(n);case"equalEarth":return new cS(n);case"winkelTripel":return new dS(n);case"albers":return s?new Gv(n):new lS(n);case"lambertConformalConic":return s?new Gv(n):new hS(n);case"globe":return new pS(n)}throw new Error(`Invalid projection name: ${n.name}`)}const mS=Ya.VectorTileFeature.types,gS=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function hd(n,t,s,c,f,p,_,v,w,E,M,C,L){const O=v?Math.min(Ho,Math.round(v[0])):0,z=v?Math.min(Ho,Math.round(v[1])):0;n.emplaceBack(t,s,Math.round(32*c),Math.round(32*f),p,_,(O<<1)+(w?1:0),z,16*E,16*M,256*C,256*L)}function fd(n,t,s,c,f,p,_){n.emplaceBack(t,s,c,f,p,_)}function dd(n,t,s,c,f){n.emplaceBack(t,s,c,f),n.emplaceBack(t,s,c,f),n.emplaceBack(t,s,c,f),n.emplaceBack(t,s,c,f)}function _S(n){for(const t of n.sections)if(h(t.text))return!0;return!1}class Sm{constructor(t){this.layoutVertexArray=new xi,this.indexArray=new Zt,this.programConfigurations=t,this.segments=new Xi,this.dynamicLayoutVertexArray=new Wt,this.opacityVertexArray=new ui,this.placedSymbolArray=new Z_,this.globeExtVertexArray=new Di}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,s,c,f){this.isEmpty()||(c&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,vE.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,s),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,bE.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,gS,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,xE.members,!0)),this.opacityVertexBuffer.itemSize=1),(c||f)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}pt(Sm,"SymbolBuffers");class Am{constructor(t,s,c){this.layoutVertexArray=new t,this.layoutAttributes=s,this.indexArray=new c,this.segments=new Xi,this.collisionVertexArray=new bi,this.collisionVertexArrayExt=new Ai}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,wE.members,!0),this.collisionVertexBufferExt=t.createVertexBuffer(this.collisionVertexArrayExt,TE.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}pt(Am,"CollisionBuffers");class Ko{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(_=>_.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=As([]),this.placementViewportMatrix=As([]);const s=this.layers[0]._unevaluatedLayout._values;this.textSizeData=um(this.zoom,s["text-size"]),this.iconSizeData=um(this.zoom,s["icon-size"]);const c=this.layers[0].layout,f=c.get("symbol-sort-key"),p=c.get("symbol-z-order");this.canOverlap=c.get("text-allow-overlap")||c.get("icon-allow-overlap")||c.get("text-ignore-placement")||c.get("icon-ignore-placement"),this.sortFeaturesByKey=p!=="viewport-y"&&f.constantOr(1)!==void 0,this.sortFeaturesByY=(p==="viewport-y"||p==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=c.get("text-writing-mode").map(_=>wn[_]),this.stateDependentLayerIds=this.layers.filter(_=>_.isStateDependent()).map(_=>_.id),this.sourceID=t.sourceID,this.projection=t.projection}createArrays(){this.text=new Sm(new Za(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new Sm(new Za(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new q_,this.lineVertexArray=new X_,this.symbolInstances=new W_}calculateGlyphDependencies(t,s,c,f,p){for(let _=0;_<t.length;_++)if(s[t.charCodeAt(_)]=!0,f&&p){const v=qu[t.charAt(_)];v&&(s[v.charCodeAt(0)]=!0)}}populate(t,s,c,f){const p=this.layers[0],_=p.layout,v=this.projection.name==="globe",w=_.get("text-font"),E=_.get("text-field"),M=_.get("icon-image"),C=(E.value.kind!=="constant"||E.value.value instanceof dt&&!E.value.value.isEmpty()||E.value.value.toString().length>0)&&(w.value.kind!=="constant"||w.value.value.length>0),L=M.value.kind!=="constant"||!!M.value.value||Object.keys(M.parameters).length>0,O=_.get("symbol-sort-key");if(this.features=[],!C&&!L)return;const z=s.iconDependencies,G=s.glyphDependencies,q=s.availableImages,re=new Y(this.zoom);for(const{feature:he,id:se,index:le,sourceLayerIndex:xe}of t){const de=p._featureFilter.needGeometry,Oe=$a(he,de);if(!p._featureFilter.filter(re,Oe,c))continue;if(de||(Oe.geometry=ao(he,c,f)),v&&he.type!==1&&c.z<=5){const ze=Oe.geometry,Ge=.98078528056;for(let He=0;He<ze.length;He++)ze[He]=xT(ze[He],Ze=>Ze,(Ze,Qe)=>Nn(Ju(Ze.x,Ze.y,c,1),Ju(Qe.x,Qe.y,c,1))<Ge)}let Le,Ne;if(C){const ze=p.getValueAndResolveTokens("text-field",Oe,c,q),Ge=dt.factory(ze);_S(Ge)&&(this.hasRTLText=!0),(!this.hasRTLText||Z()==="unavailable"||this.hasRTLText&&H.isParsed())&&(Le=AE(Ge,p,Oe))}if(L){const ze=p.getValueAndResolveTokens("icon-image",Oe,c,q);Ne=ze instanceof Rt?ze:Rt.fromString(ze)}if(!Le&&!Ne)continue;const it=this.sortFeaturesByKey?O.evaluate(Oe,{},c):void 0;if(this.features.push({id:se,text:Le,icon:Ne,index:le,sourceLayerIndex:xe,geometry:Oe.geometry,properties:he.properties,type:mS[he.type],sortKey:it}),Ne&&(z[Ne.name]=!0),Le){const ze=w.evaluate(Oe,{},c).join(","),Ge=_.get("text-rotation-alignment")==="map"&&_.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(wn.vertical)>=0;for(const He of Le.sections)if(He.image)z[He.image.name]=!0;else{const Ze=$l(Le.toString()),Qe=He.fontStack||ze,Ye=G[Qe]=G[Qe]||{};this.calculateGlyphDependencies(He.text,Ye,Ge,this.allowVerticalPlacement,Ze)}}}_.get("symbol-placement")==="line"&&(this.features=function(he){const se={},le={},xe=[];let de=0;function Oe(ze){xe.push(he[ze]),de++}function Le(ze,Ge,He){const Ze=le[ze];return delete le[ze],le[Ge]=Ze,xe[Ze].geometry[0].pop(),xe[Ze].geometry[0]=xe[Ze].geometry[0].concat(He[0]),Ze}function Ne(ze,Ge,He){const Ze=se[Ge];return delete se[Ge],se[ze]=Ze,xe[Ze].geometry[0].shift(),xe[Ze].geometry[0]=He[0].concat(xe[Ze].geometry[0]),Ze}function it(ze,Ge,He){const Ze=He?Ge[0][Ge[0].length-1]:Ge[0][0];return`${ze}:${Ze.x}:${Ze.y}`}for(let ze=0;ze<he.length;ze++){const Ge=he[ze],He=Ge.geometry,Ze=Ge.text?Ge.text.toString():null;if(!Ze){Oe(ze);continue}const Qe=it(Ze,He),Ye=it(Ze,He,!0);if(Qe in le&&Ye in se&&le[Qe]!==se[Ye]){const ut=Ne(Qe,Ye,He),Ut=Le(Qe,Ye,xe[ut].geometry);delete se[Qe],delete le[Ye],le[it(Ze,xe[Ut].geometry,!0)]=Ut,xe[ut].geometry=null}else Qe in le?Le(Qe,Ye,He):Ye in se?Ne(Qe,Ye,He):(Oe(ze),se[Qe]=de-1,le[Ye]=de-1)}return xe.filter(ze=>ze.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((he,se)=>he.sortKey-se.sortKey)}update(t,s,c,f){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,s,this.layers,c,f),this.icon.programConfigurations.updatePaintArrays(t,s,this.layers,c,f))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=Zv(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,s){const c=this.lineVertexArray.length,f=t.segment;if(f!==void 0){let p=t.dist(s[f+1]),_=t.dist(s[f]);const v={};for(let w=f+1;w<s.length;w++)v[w]={x:s[w].x,y:s[w].y,tileUnitDistanceFromAnchor:p},w<s.length-1&&(p+=s[w+1].dist(s[w]));for(let w=f||0;w>=0;w--)v[w]={x:s[w].x,y:s[w].y,tileUnitDistanceFromAnchor:_},w>0&&(_+=s[w-1].dist(s[w]));for(let w=0;w<s.length;w++){const E=v[w];this.lineVertexArray.emplaceBack(E.x,E.y,E.tileUnitDistanceFromAnchor)}}return{lineStartIndex:c,lineLength:this.lineVertexArray.length-c}}addSymbols(t,s,c,f,p,_,v,w,E,M,C,L,O,z){const G=t.indexArray,q=t.layoutVertexArray,re=t.globeExtVertexArray,he=t.segments.prepareSegment(4*s.length,q,G,this.canOverlap?_.sortKey:void 0),se=this.glyphOffsetArray.length,le=he.vertexLength,xe=this.allowVerticalPlacement&&v===wn.vertical?Math.PI/2:0,de=_.text&&_.text.sections;for(let Le=0;Le<s.length;Le++){const{tl:Ne,tr:it,bl:ze,br:Ge,tex:He,pixelOffsetTL:Ze,pixelOffsetBR:Qe,minFontScaleX:Ye,minFontScaleY:ut,glyphOffset:Ut,isSDF:Vt,sectionIndex:wt}=s[Le],nt=he.vertexLength,qt=Ut[1];if(hd(q,E.x,E.y,Ne.x,qt+Ne.y,He.x,He.y,c,Vt,Ze.x,Ze.y,Ye,ut),hd(q,E.x,E.y,it.x,qt+it.y,He.x+He.w,He.y,c,Vt,Qe.x,Ze.y,Ye,ut),hd(q,E.x,E.y,ze.x,qt+ze.y,He.x,He.y+He.h,c,Vt,Ze.x,Qe.y,Ye,ut),hd(q,E.x,E.y,Ge.x,qt+Ge.y,He.x+He.w,He.y+He.h,c,Vt,Qe.x,Qe.y,Ye,ut),w){const Ot=w.anchor,ft=w.up;fd(re,Ot.x,Ot.y,Ot.z,ft[0],ft[1],ft[2]),fd(re,Ot.x,Ot.y,Ot.z,ft[0],ft[1],ft[2]),fd(re,Ot.x,Ot.y,Ot.z,ft[0],ft[1],ft[2]),fd(re,Ot.x,Ot.y,Ot.z,ft[0],ft[1],ft[2]),dd(t.dynamicLayoutVertexArray,Ot.x,Ot.y,Ot.z,xe)}else dd(t.dynamicLayoutVertexArray,E.x,E.y,E.z,xe);G.emplaceBack(nt,nt+1,nt+2),G.emplaceBack(nt+1,nt+2,nt+3),he.vertexLength+=4,he.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ut[0]),Le!==s.length-1&&wt===s[Le+1].sectionIndex||t.programConfigurations.populatePaintArrays(q.length,_,_.index,{},O,z,de&&de[wt])}const Oe=w?w.anchor:E;t.placedSymbolArray.emplaceBack(Oe.x,Oe.y,Oe.z,E.x,E.y,se,this.glyphOffsetArray.length-se,le,M,C,E.segment,c?c[0]:0,c?c[1]:0,f[0],f[1],v,0,!1,0,L,0)}_commitLayoutVertex(t,s,c,f,p,_,v){t.emplaceBack(s,c,f,p,_,Math.round(v.x),Math.round(v.y))}_addCollisionDebugVertices(t,s,c,f,p,_,v){const w=c.segments.prepareSegment(4,c.layoutVertexArray,c.indexArray),E=w.vertexLength,M=v.tileAnchorX,C=v.tileAnchorY;for(let O=0;O<4;O++)c.collisionVertexArray.emplaceBack(0,0,0,0);c.collisionVertexArrayExt.emplaceBack(s,-t.padding,-t.padding),c.collisionVertexArrayExt.emplaceBack(s,t.padding,-t.padding),c.collisionVertexArrayExt.emplaceBack(s,t.padding,t.padding),c.collisionVertexArrayExt.emplaceBack(s,-t.padding,t.padding),this._commitLayoutVertex(c.layoutVertexArray,f,p,_,M,C,new F(t.x1,t.y1)),this._commitLayoutVertex(c.layoutVertexArray,f,p,_,M,C,new F(t.x2,t.y1)),this._commitLayoutVertex(c.layoutVertexArray,f,p,_,M,C,new F(t.x2,t.y2)),this._commitLayoutVertex(c.layoutVertexArray,f,p,_,M,C,new F(t.x1,t.y2)),w.vertexLength+=4;const L=c.indexArray;L.emplaceBack(E,E+1),L.emplaceBack(E+1,E+2),L.emplaceBack(E+2,E+3),L.emplaceBack(E+3,E),w.primitiveLength+=4}_addTextDebugCollisionBoxes(t,s,c,f,p,_){for(let v=f;v<p;v++){const w=c.get(v),E=this.getSymbolInstanceTextSize(t,_,s,v);this._addCollisionDebugVertices(w,E,this.textCollisionBox,w.projectedAnchorX,w.projectedAnchorY,w.projectedAnchorZ,_)}}_addIconDebugCollisionBoxes(t,s,c,f,p,_){for(let v=f;v<p;v++){const w=c.get(v),E=this.getSymbolInstanceIconSize(t,s,v);this._addCollisionDebugVertices(w,E,this.iconCollisionBox,w.projectedAnchorX,w.projectedAnchorY,w.projectedAnchorZ,_)}}generateCollisionDebugBuffers(t,s){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Am(bn,rv.members,Pr),this.iconCollisionBox=new Am(bn,rv.members,Pr);const c=ec(this.iconSizeData,t),f=ec(this.textSizeData,t);for(let p=0;p<this.symbolInstances.length;p++){const _=this.symbolInstances.get(p);this._addTextDebugCollisionBoxes(f,t,s,_.textBoxStartIndex,_.textBoxEndIndex,_),this._addTextDebugCollisionBoxes(f,t,s,_.verticalTextBoxStartIndex,_.verticalTextBoxEndIndex,_),this._addIconDebugCollisionBoxes(c,t,s,_.iconBoxStartIndex,_.iconBoxEndIndex,_),this._addIconDebugCollisionBoxes(c,t,s,_.verticalIconBoxStartIndex,_.verticalIconBoxEndIndex,_)}}getSymbolInstanceTextSize(t,s,c,f){const p=this.text.placedSymbolArray.get(s.rightJustifiedTextSymbolIndex>=0?s.rightJustifiedTextSymbolIndex:s.centerJustifiedTextSymbolIndex>=0?s.centerJustifiedTextSymbolIndex:s.leftJustifiedTextSymbolIndex>=0?s.leftJustifiedTextSymbolIndex:s.verticalPlacedTextSymbolIndex>=0?s.verticalPlacedTextSymbolIndex:f),_=Qf(this.textSizeData,t,p)/xr;return this.tilePixelRatio*_}getSymbolInstanceIconSize(t,s,c){const f=this.icon.placedSymbolArray.get(c),p=Qf(this.iconSizeData,t,f);return this.tilePixelRatio*p}_commitDebugCollisionVertexUpdate(t,s,c){t.emplaceBack(s,-c,-c),t.emplaceBack(s,c,-c),t.emplaceBack(s,c,c),t.emplaceBack(s,-c,c)}_updateTextDebugCollisionBoxes(t,s,c,f,p,_){for(let v=f;v<p;v++){const w=c.get(v),E=this.getSymbolInstanceTextSize(t,_,s,v);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,E,w.padding)}}_updateIconDebugCollisionBoxes(t,s,c,f,p){for(let _=f;_<p;_++){const v=c.get(_),w=this.getSymbolInstanceIconSize(t,s,_);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,w,v.padding)}}updateCollisionDebugBuffers(t,s){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const c=ec(this.iconSizeData,t),f=ec(this.textSizeData,t);for(let p=0;p<this.symbolInstances.length;p++){const _=this.symbolInstances.get(p);this._updateTextDebugCollisionBoxes(f,t,s,_.textBoxStartIndex,_.textBoxEndIndex,_),this._updateTextDebugCollisionBoxes(f,t,s,_.verticalTextBoxStartIndex,_.verticalTextBoxEndIndex,_),this._updateIconDebugCollisionBoxes(c,t,s,_.iconBoxStartIndex,_.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(c,t,s,_.verticalIconBoxStartIndex,_.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(t,s,c,f,p,_,v,w,E){const M={};for(let C=s;C<c;C++){const L=t.get(C);M.textBox={x1:L.x1,y1:L.y1,x2:L.x2,y2:L.y2,padding:L.padding,projectedAnchorX:L.projectedAnchorX,projectedAnchorY:L.projectedAnchorY,projectedAnchorZ:L.projectedAnchorZ,tileAnchorX:L.tileAnchorX,tileAnchorY:L.tileAnchorY},M.textFeatureIndex=L.featureIndex;break}for(let C=f;C<p;C++){const L=t.get(C);M.verticalTextBox={x1:L.x1,y1:L.y1,x2:L.x2,y2:L.y2,padding:L.padding,projectedAnchorX:L.projectedAnchorX,projectedAnchorY:L.projectedAnchorY,projectedAnchorZ:L.projectedAnchorZ,tileAnchorX:L.tileAnchorX,tileAnchorY:L.tileAnchorY},M.verticalTextFeatureIndex=L.featureIndex;break}for(let C=_;C<v;C++){const L=t.get(C);M.iconBox={x1:L.x1,y1:L.y1,x2:L.x2,y2:L.y2,padding:L.padding,projectedAnchorX:L.projectedAnchorX,projectedAnchorY:L.projectedAnchorY,projectedAnchorZ:L.projectedAnchorZ,tileAnchorX:L.tileAnchorX,tileAnchorY:L.tileAnchorY},M.iconFeatureIndex=L.featureIndex;break}for(let C=w;C<E;C++){const L=t.get(C);M.verticalIconBox={x1:L.x1,y1:L.y1,x2:L.x2,y2:L.y2,padding:L.padding,projectedAnchorX:L.projectedAnchorX,projectedAnchorY:L.projectedAnchorY,projectedAnchorZ:L.projectedAnchorZ,tileAnchorX:L.tileAnchorX,tileAnchorY:L.tileAnchorY},M.verticalIconFeatureIndex=L.featureIndex;break}return M}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let s=0;s<this.symbolInstances.length;s++){const c=this.symbolInstances.get(s);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,c.textBoxStartIndex,c.textBoxEndIndex,c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c.iconBoxStartIndex,c.iconBoxEndIndex,c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,s){const c=t.placedSymbolArray.get(s),f=c.vertexStartIndex+4*c.numGlyphs;for(let p=c.vertexStartIndex;p<f;p+=4)t.indexArray.emplaceBack(p,p+1,p+2),t.indexArray.emplaceBack(p+1,p+2,p+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const s=Math.sin(t),c=Math.cos(t),f=[],p=[],_=[];for(let v=0;v<this.symbolInstances.length;++v){_.push(v);const w=this.symbolInstances.get(v);f.push(0|Math.round(s*w.tileAnchorX+c*w.tileAnchorY)),p.push(w.featureIndex)}return _.sort((v,w)=>f[v]-f[w]||p[w]-p[v]),_}addToSortKeyRanges(t,s){const c=this.sortKeyRanges[this.sortKeyRanges.length-1];c&&c.sortKey===s?c.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:s,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const s of this.symbolInstanceIndexes){const c=this.symbolInstances.get(s);this.featureSortOrder.push(c.featureIndex),[c.rightJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.leftJustifiedTextSymbolIndex].forEach((f,p,_)=>{f>=0&&_.indexOf(f)===p&&this.addIndicesForPlacedSymbol(this.text,f)}),c.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,c.verticalPlacedTextSymbolIndex),c.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,c.placedIconSymbolIndex),c.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,c.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}pt(Ko,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Ko.MAX_GLYPHS=65535,Ko.addDynamicAttributes=dd;const yS=new Ue({"symbol-placement":new pe(Fe.layout_symbol["symbol-placement"]),"symbol-spacing":new pe(Fe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new pe(Fe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new we(Fe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new pe(Fe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new pe(Fe.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new pe(Fe.layout_symbol["icon-ignore-placement"]),"icon-optional":new pe(Fe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new pe(Fe.layout_symbol["icon-rotation-alignment"]),"icon-size":new we(Fe.layout_symbol["icon-size"]),"icon-text-fit":new pe(Fe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new pe(Fe.layout_symbol["icon-text-fit-padding"]),"icon-image":new we(Fe.layout_symbol["icon-image"]),"icon-rotate":new we(Fe.layout_symbol["icon-rotate"]),"icon-padding":new pe(Fe.layout_symbol["icon-padding"]),"icon-keep-upright":new pe(Fe.layout_symbol["icon-keep-upright"]),"icon-offset":new we(Fe.layout_symbol["icon-offset"]),"icon-anchor":new we(Fe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new pe(Fe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new pe(Fe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new pe(Fe.layout_symbol["text-rotation-alignment"]),"text-field":new we(Fe.layout_symbol["text-field"]),"text-font":new we(Fe.layout_symbol["text-font"]),"text-size":new we(Fe.layout_symbol["text-size"]),"text-max-width":new we(Fe.layout_symbol["text-max-width"]),"text-line-height":new we(Fe.layout_symbol["text-line-height"]),"text-letter-spacing":new we(Fe.layout_symbol["text-letter-spacing"]),"text-justify":new we(Fe.layout_symbol["text-justify"]),"text-radial-offset":new we(Fe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new pe(Fe.layout_symbol["text-variable-anchor"]),"text-anchor":new we(Fe.layout_symbol["text-anchor"]),"text-max-angle":new pe(Fe.layout_symbol["text-max-angle"]),"text-writing-mode":new pe(Fe.layout_symbol["text-writing-mode"]),"text-rotate":new we(Fe.layout_symbol["text-rotate"]),"text-padding":new pe(Fe.layout_symbol["text-padding"]),"text-keep-upright":new pe(Fe.layout_symbol["text-keep-upright"]),"text-transform":new we(Fe.layout_symbol["text-transform"]),"text-offset":new we(Fe.layout_symbol["text-offset"]),"text-allow-overlap":new pe(Fe.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new pe(Fe.layout_symbol["text-ignore-placement"]),"text-optional":new pe(Fe.layout_symbol["text-optional"])});var Mm={paint:new Ue({"icon-opacity":new we(Fe.paint_symbol["icon-opacity"]),"icon-color":new we(Fe.paint_symbol["icon-color"]),"icon-halo-color":new we(Fe.paint_symbol["icon-halo-color"]),"icon-halo-width":new we(Fe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new we(Fe.paint_symbol["icon-halo-blur"]),"icon-translate":new pe(Fe.paint_symbol["icon-translate"]),"icon-translate-anchor":new pe(Fe.paint_symbol["icon-translate-anchor"]),"text-opacity":new we(Fe.paint_symbol["text-opacity"]),"text-color":new we(Fe.paint_symbol["text-color"],{runtimeType:pr,getOverride:n=>n.textColor,hasOverride:n=>!!n.textColor}),"text-halo-color":new we(Fe.paint_symbol["text-halo-color"]),"text-halo-width":new we(Fe.paint_symbol["text-halo-width"]),"text-halo-blur":new we(Fe.paint_symbol["text-halo-blur"]),"text-translate":new pe(Fe.paint_symbol["text-translate"]),"text-translate-anchor":new pe(Fe.paint_symbol["text-translate-anchor"])}),layout:yS};class $v{constructor(t){this.type=t.property.overrides?t.property.overrides.runtimeType:Xn,this.defaultValue=t}evaluate(t){if(t.formattedSection){const s=this.defaultValue.property.overrides;if(s&&s.hasOverride(t.formattedSection))return s.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}pt($v,"FormatSectionOverride",{omit:["defaultValue"]});class pd extends is{constructor(t){super(t,Mm)}recalculate(t,s){super.recalculate(t,s),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const c=this.layout.get("text-writing-mode");if(c){const f=[];for(const p of c)f.indexOf(p)<0&&f.push(p);this.layout._values["text-writing-mode"]=f}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(t,s,c,f){const p=this.layout.get(t).evaluate(s,{},c,f),_=this._unevaluatedLayout._values[t];return _.isDataDriven()||Dl(_.value)||!p?p:function(v,w){return w.replace(/{([^{}]+)}/g,(E,M)=>M in v?String(v[M]):"")}(s.properties,p)}createBucket(t){return new Ko(t)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const t of Mm.paint.overridableProperties){if(!pd.hasPaintOverride(this.layout,t))continue;const s=this.paint.get(t),c=new $v(s),f=new pu(c,s.property.specification);let p=null;p=s.value.kind==="constant"||s.value.kind==="source"?new mu("source",f):new La("composite",f,s.value.zoomStops,s.value._interpolationType),this.paint._values[t]=new ue(s.property,p,s.parameters)}}_handleOverridablePaintPropertyUpdate(t,s,c){return!(!this.layout||s.isDataDriven()||c.isDataDriven())&&pd.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,s){const c=t.get("text-field"),f=Mm.paint.properties[s];let p=!1;const _=v=>{for(const w of v)if(f.overrides&&f.overrides.hasOverride(w))return void(p=!0)};if(c.value.kind==="constant"&&c.value.value instanceof dt)_(c.value.value.sections);else if(c.value.kind==="source"){const v=E=>{p||(E instanceof va&&Kt(E.value)===Yn?_(E.value.sections):E instanceof ba?_(E.sections):E.eachChild(v))},w=c.value;w._styleExpression&&v(w._styleExpression.expression)}return p}getProgramConfiguration(t){return new Wo(this,t)}}var vS={paint:new Ue({"background-color":new pe(Fe.paint_background["background-color"]),"background-pattern":new Je(Fe.paint_background["background-pattern"]),"background-opacity":new pe(Fe.paint_background["background-opacity"])})},xS={paint:new Ue({"raster-opacity":new pe(Fe.paint_raster["raster-opacity"]),"raster-hue-rotate":new pe(Fe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new pe(Fe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new pe(Fe.paint_raster["raster-brightness-max"]),"raster-saturation":new pe(Fe.paint_raster["raster-saturation"]),"raster-contrast":new pe(Fe.paint_raster["raster-contrast"]),"raster-resampling":new pe(Fe.paint_raster["raster-resampling"]),"raster-fade-duration":new pe(Fe.paint_raster["raster-fade-duration"])})};class bS extends is{constructor(t){super(t,{}),this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(t){this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl)}onRemove(t){this.implementation.onRemove&&this.implementation.onRemove(t,t.painter.context.gl)}}var wS={paint:new Ue({"sky-type":new pe(Fe.paint_sky["sky-type"]),"sky-atmosphere-sun":new pe(Fe.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new pe(Fe.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new pe(Fe.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new pe(Fe.paint_sky["sky-gradient-radius"]),"sky-gradient":new Ae(Fe.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new pe(Fe.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new pe(Fe.paint_sky["sky-atmosphere-color"]),"sky-opacity":new pe(Fe.paint_sky["sky-opacity"])})};function Pm(n,t,s){const c=[0,0,1],f=Ay([]);return Py(f,f,s?-fe(n)+Math.PI:fe(n)),My(f,f,-fe(t)),Ty(c,c,f),Fr(c,c)}const TS={circle:class extends is{constructor(n){super(n,MT)}createBucket(n){return new Gp(n)}queryRadius(n){const t=n;return Hl("circle-radius",this,t)+Hl("circle-stroke-width",this,t)+Nf(this.paint.get("circle-translate"))}queryIntersectsFeature(n,t,s,c,f,p,_,v){const w=_y(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),p.angle,n.pixelToTileUnitsFactor),E=this.paint.get("circle-radius").evaluate(t,s)+this.paint.get("circle-stroke-width").evaluate(t,s);return Iy(n,c,p,_,v,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",w,E)}getProgramIds(){return["circle"]}getProgramConfiguration(n){return new Wo(this,n)}},heatmap:class extends is{createBucket(n){return new Ly(n)}constructor(n){super(n,OT),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){n==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=rm({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(n){return Hl("heatmap-radius",this,n)}queryIntersectsFeature(n,t,s,c,f,p,_,v){const w=this.paint.get("heatmap-radius").evaluate(t,s);return Iy(n,c,p,_,v,!0,!0,new F(0,0),w)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(n){return new Wo(this,n)}},hillshade:class extends is{constructor(n){super(n,DT)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends is{constructor(n){super(n,JT)}getProgramIds(){const n=this.paint.get("fill-pattern"),t=n&&n.constantOr(1),s=[t?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&s.push(t&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),s}getProgramConfiguration(n){return new Wo(this,n)}recalculate(n,t){super.recalculate(n,t);const s=this.paint._values["fill-outline-color"];s.value.kind==="constant"&&s.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(n){return new Xf(n)}queryRadius(){return Nf(this.paint.get("fill-translate"))}queryIntersectsFeature(n,t,s,c,f,p){return!n.queryGeometry.isAboveHorizon&&fy(gy(n.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),p.angle,n.pixelToTileUnitsFactor),c)}isTileClipped(){return!0}},"fill-extrusion":class extends is{constructor(n){super(n,hE)}createBucket(n){return new Zu(n)}queryRadius(){return Nf(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(n){return new Wo(this,n)}queryIntersectsFeature(n,t,s,c,f,p,_,v,w){const E=_y(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),p.angle,n.pixelToTileUnitsFactor),M=this.paint.get("fill-extrusion-height").evaluate(t,s),C=this.paint.get("fill-extrusion-base").evaluate(t,s),L=[0,0],O=v&&p.elevation,z=p.elevation?p.elevation.exaggeration():1,G=n.tile.getBucket(this);if(O&&G instanceof Zu){const he=G.centroidVertexArray,se=w+1;if(se<he.length){const le=he.get(se);L[0]=le.a_centroid_pos0,L[1]=le.a_centroid_pos1}}if(L[0]===0&&L[1]===1)return!1;p.projection.name==="globe"&&(c=Hy([c],[new F(0,0),new F(It,It)],n.tileID.canonical).map(he=>he.polygon).flat());const q=function(he,se,le,xe,de,Oe,Le,Ne,it,ze,Ge){return he.projection.name==="globe"?function(He,Ze,Qe,Ye,ut,Ut,Vt,wt,nt,qt,Ot){const ft=[],gi=[],fi=He.projection.upVectorScale(Ot,He.center.lat,He.worldSize).metersToTile,Mi=[0,0,0,1],Gt=[0,0,0,1],ti=(di,hi,wi,ki)=>{di[0]=hi,di[1]=wi,di[2]=ki,di[3]=1},_i=Xy();Qe>0&&(Qe+=_i),Ye+=_i;for(const di of Ze){const hi=[],wi=[];for(const ki of di){const cr=ki.x+ut.x,Kr=ki.y+ut.y,Yt=He.projection.projectTilePoint(cr,Kr,Ot),Bi=He.projection.upVector(Ot,ki.x,ki.y);let Cr=Qe,oi=Ye;if(Vt){const Ri=Qy(cr,Kr,Qe,Ye,Vt,wt,nt,qt);Cr+=Ri.base,oi+=Ri.top}Qe!==0?ti(Mi,Yt.x+Bi[0]*fi*Cr,Yt.y+Bi[1]*fi*Cr,Yt.z+Bi[2]*fi*Cr):ti(Mi,Yt.x,Yt.y,Yt.z),ti(Gt,Yt.x+Bi[0]*fi*oi,Yt.y+Bi[1]*fi*oi,Yt.z+Bi[2]*fi*oi),Yi(Mi,Mi,Ut),Yi(Gt,Gt,Ut),hi.push(Kf(Mi)),wi.push(Kf(Gt))}ft.push(hi),gi.push(wi)}return[ft,gi]}(he,se,le,xe,de,Oe,Le,Ne,it,ze,Ge):Le?function(He,Ze,Qe,Ye,ut,Ut,Vt,wt,nt){const qt=[],Ot=[],ft=[0,0,0,1];for(const gi of He){const fi=[],Mi=[];for(const Gt of gi){const ti=Gt.x+Ye.x,_i=Gt.y+Ye.y,di=Qy(ti,_i,Ze,Qe,Ut,Vt,wt,nt);ft[0]=ti,ft[1]=_i,ft[2]=di.base,ft[3]=1,Xa(ft,ft,ut),ft[3]=Math.max(ft[3],1e-5);const hi=Kf([ft[0]/ft[3],ft[1]/ft[3],ft[2]/ft[3]]);ft[0]=ti,ft[1]=_i,ft[2]=di.top,ft[3]=1,Xa(ft,ft,ut),ft[3]=Math.max(ft[3],1e-5);const wi=Kf([ft[0]/ft[3],ft[1]/ft[3],ft[2]/ft[3]]);fi.push(hi),Mi.push(wi)}qt.push(fi),Ot.push(Mi)}return[qt,Ot]}(se,le,xe,de,Oe,Le,Ne,it,ze):function(He,Ze,Qe,Ye,ut){const Ut=[],Vt=[],wt=ut[8]*Ze,nt=ut[9]*Ze,qt=ut[10]*Ze,Ot=ut[11]*Ze,ft=ut[8]*Qe,gi=ut[9]*Qe,fi=ut[10]*Qe,Mi=ut[11]*Qe;for(const Gt of He){const ti=[],_i=[];for(const di of Gt){const hi=di.x+Ye.x,wi=di.y+Ye.y,ki=ut[0]*hi+ut[4]*wi+ut[12],cr=ut[1]*hi+ut[5]*wi+ut[13],Kr=ut[2]*hi+ut[6]*wi+ut[14],Yt=ut[3]*hi+ut[7]*wi+ut[15],Bi=ki+wt,Cr=cr+nt,oi=Kr+qt,Ri=Math.max(Yt+Ot,1e-5),Ur=ki+ft,Pi=cr+gi,ji=Kr+fi,ur=Math.max(Yt+Mi,1e-5),Qi=new F(Bi/Ri,Cr/Ri);Qi.z=oi/Ri,ti.push(Qi);const br=new F(Ur/ur,Pi/ur);br.z=ji/ur,_i.push(br)}Ut.push(ti),Vt.push(_i)}return[Ut,Vt]}(se,le,xe,de,Oe)}(p,c,C,M,E,_,O?v:null,L,z,p.center.lat,n.tileID.canonical),re=n.queryGeometry;return function(he,se,le){let xe=1/0;fy(le,se)&&(xe=Jy(le,se[0]));for(let de=0;de<se.length;de++){const Oe=se[de],Le=he[de];for(let Ne=0;Ne<Oe.length-1;Ne++){const it=Oe[Ne],ze=[it,Oe[Ne+1],Le[Ne+1],Le[Ne],it];hy(le,ze)&&(xe=Math.min(xe,Jy(le,ze)))}}return xe!==1/0&&xe}(q[0],q[1],re.isPointQuery()?re.screenBounds:re.screenGeometry)}},line:class extends is{constructor(n){super(n,ev),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(n){if(n==="line-gradient"){const t=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=t._styleExpression&&t._styleExpression.expression instanceof Xc,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(n,t){super.recalculate(n,t),this.paint._values["line-floorwidth"]=tv.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,n)}createBucket(n){return new Jf(n)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(n){return new Wo(this,n)}queryRadius(n){const t=n,s=iv(Hl("line-width",this,t),Hl("line-gap-width",this,t)),c=Hl("line-offset",this,t);return s/2+Math.abs(c)+Nf(this.paint.get("line-translate"))}queryIntersectsFeature(n,t,s,c,f,p){if(n.queryGeometry.isAboveHorizon)return!1;const _=gy(n.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),p.angle,n.pixelToTileUnitsFactor),v=n.pixelToTileUnitsFactor/2*iv(this.paint.get("line-width").evaluate(t,s),this.paint.get("line-gap-width").evaluate(t,s)),w=this.paint.get("line-offset").evaluate(t,s);return w&&(c=function(E,M){const C=[],L=new F(0,0);for(let O=0;O<E.length;O++){const z=E[O],G=[];for(let q=0;q<z.length;q++){const re=z[q-1],he=z[q],se=z[q+1],le=q===0?L:he.sub(re)._unit()._perp(),xe=q===z.length-1?L:se.sub(he)._unit()._perp(),de=le._add(xe)._unit();de._mult(1/(de.x*xe.x+de.y*xe.y)),G.push(de._mult(M)._add(he))}C.push(G)}return C}(c,w*n.pixelToTileUnitsFactor)),function(E,M,C){for(let L=0;L<M.length;L++){const O=M[L];if(E.length>=3){for(let z=0;z<O.length;z++)if(Wa(E,O[z]))return!0}if(TT(E,O,C))return!0}return!1}(_,c,v)}isTileClipped(){return!0}},symbol:pd,background:class extends is{constructor(n){super(n,vS)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends is{constructor(n){super(n,xS)}getProgramIds(){return["raster"]}},sky:class extends is{constructor(n){super(n,wS),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){n==="sky-gradient"?this._updateColorRamp():n!=="sky-atmosphere-sun"&&n!=="sky-atmosphere-halo-color"&&n!=="sky-atmosphere-color"&&n!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=rm({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(n){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const t=n.style.light.properties.get("position");return this._lightPosition.azimuthal!==t.azimuthal||this._lightPosition.polar!==t.polar}return!1}getCenter(n,t){if(this.paint.get("sky-type")==="atmosphere"){const c=this.paint.get("sky-atmosphere-sun"),f=!c,p=n.style.light,_=p.properties.get("position");return f&&p.properties.get("anchor")==="viewport"&&Ci("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),f?Pm(_.azimuthal,90-_.polar,t):Pm(c[0],90-c[1],t)}const s=this.paint.get("sky-gradient-center");return Pm(s[0],90-s[1],t)}is3D(){return!1}isSky(){return!0}markSkyboxValid(n){this._skyboxInvalidated=!1,this._lightPosition=n.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const n=this.paint.get("sky-type");return n==="atmosphere"?["skyboxCapture","skybox"]:n==="gradient"?["skyboxGradient"]:null}}};class sh{constructor(t,s,c,f){this.context=t,this.format=c,this.texture=t.gl.createTexture(),this.update(s,f)}update(t,s,c){const{width:f,height:p}=t,{context:_}=this,{gl:v}=_,{HTMLImageElement:w,HTMLCanvasElement:E,HTMLVideoElement:M,ImageData:C,ImageBitmap:L}=P;if(v.bindTexture(v.TEXTURE_2D,this.texture),_.pixelStoreUnpackFlipY.set(!1),_.pixelStoreUnpack.set(1),_.pixelStoreUnpackPremultiplyAlpha.set(this.format===v.RGBA&&(!s||s.premultiply!==!1)),c||this.size&&this.size[0]===f&&this.size[1]===p){const{x:O,y:z}=c||{x:0,y:0};t instanceof w||t instanceof E||t instanceof M||t instanceof C||L&&t instanceof L?v.texSubImage2D(v.TEXTURE_2D,0,O,z,v.RGBA,v.UNSIGNED_BYTE,t):v.texSubImage2D(v.TEXTURE_2D,0,O,z,f,p,v.RGBA,v.UNSIGNED_BYTE,t.data)}else this.size=[f,p],t instanceof w||t instanceof E||t instanceof M||t instanceof C||L&&t instanceof L?v.texImage2D(v.TEXTURE_2D,0,this.format,this.format,v.UNSIGNED_BYTE,t):v.texImage2D(v.TEXTURE_2D,0,this.format,f,p,0,this.format,v.UNSIGNED_BYTE,t.data);this.useMipmap=!!(s&&s.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&v.generateMipmap(v.TEXTURE_2D)}bind(t,s){const{context:c}=this,{gl:f}=c;f.bindTexture(f.TEXTURE_2D,this.texture),t!==this.filter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,t),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,this.useMipmap?t===f.NEAREST?f.NEAREST_MIPMAP_NEAREST:f.LINEAR_MIPMAP_NEAREST:t),this.filter=t),s!==this.wrap&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,s),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,s),this.wrap=s)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class Im{constructor(t,s){this.width=t,this.height=s,this.nextRow=0,this.image=new lo({width:t,height:s}),this.positions={},this.uploaded=!1}getDash(t,s){const c=this.getKey(t,s);return this.positions[c]}trim(){const t=this.width,s=this.height=Ki(this.nextRow);this.image.resize({width:t,height:s})}getKey(t,s){return t.join(",")+s}getDashRanges(t,s,c){const f=[];let p=t.length%2==1?-t[t.length-1]*c:0,_=t[0]*c,v=!0;f.push({left:p,right:_,isDash:v,zeroLength:t[0]===0});let w=t[0];for(let E=1;E<t.length;E++){v=!v;const M=t[E];p=w*c,w+=M,_=w*c,f.push({left:p,right:_,isDash:v,zeroLength:M===0})}return f}addRoundDash(t,s,c){const f=s/2;for(let p=-c;p<=c;p++){const _=this.width*(this.nextRow+c+p);let v=0,w=t[v];for(let E=0;E<this.width;E++){E/w.right>1&&(w=t[++v]);const M=Math.abs(E-w.left),C=Math.abs(E-w.right),L=Math.min(M,C);let O;const z=p/c*(f+1);if(w.isDash){const G=f-Math.abs(z);O=Math.sqrt(L*L+G*G)}else O=f-Math.sqrt(L*L+z*z);this.image.data[_+E]=Math.max(0,Math.min(255,O+128))}}}addRegularDash(t,s){for(let w=t.length-1;w>=0;--w){const E=t[w],M=t[w+1];E.zeroLength?t.splice(w,1):M&&M.isDash===E.isDash&&(M.left=E.left,t.splice(w,1))}const c=t[0],f=t[t.length-1];c.isDash===f.isDash&&(c.left=f.left-this.width,f.right=c.right+this.width);const p=this.width*this.nextRow;let _=0,v=t[_];for(let w=0;w<this.width;w++){w/v.right>1&&(v=t[++_]);const E=Math.abs(w-v.left),M=Math.abs(w-v.right),C=Math.min(E,M);this.image.data[p+w]=Math.max(0,Math.min(255,(v.isDash?C:-C)+s+128))}}addDash(t,s){const c=this.getKey(t,s);if(this.positions[c])return this.positions[c];const f=s==="round",p=f?7:0,_=2*p+1;if(this.nextRow+_>this.height)return Ci("LineAtlas out of space"),null;t.length===0&&t.push(1);let v=0;for(let M=0;M<t.length;M++)t[M]<0&&(Ci("Negative value is found in line dasharray, replacing values with 0"),t[M]=0),v+=t[M];if(v!==0){const M=this.width/v,C=this.getDashRanges(t,this.width,M);f?this.addRoundDash(C,M,p):this.addRegularDash(C,s==="square"?.5*M:0)}const w=this.nextRow+p;this.nextRow+=_;const E={tl:[w,p],br:[v,0]};return this.positions[c]=E,E}}pt(Im,"LineAtlas");class ES{constructor(t){this._callback=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class SS{constructor(){this.tasks={},this.taskQueue=[],Or(["process"],this),this.invoker=new ES(this.process),this.nextId=0}add(t,s){const c=this.nextId++,f=function({type:p,isSymbolTile:_,zoom:v}){return v=v||0,p==="message"?0:p!=="maybePrepare"||_?p!=="parseTile"||_?p==="parseTile"&&_?300-v:p==="maybePrepare"&&_?400-v:500:200-v:100-v}(s);if(f===0){wr();try{t()}finally{}return{cancel:()=>{}}}return this.tasks[c]={fn:t,metadata:s,priority:f,id:c},this.taskQueue.push(c),this.invoker.trigger(),{cancel:()=>{delete this.tasks[c]}}}process(){wr();try{if(this.taskQueue=this.taskQueue.filter(c=>!!this.tasks[c]),!this.taskQueue.length)return;const t=this.pick();if(t===null)return;const s=this.tasks[t];if(delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),!s)return;s.fn()}finally{}}pick(){let t=null,s=1/0;for(let f=0;f<this.taskQueue.length;f++){const p=this.tasks[this.taskQueue[f]];p.priority<s&&(s=p.priority,t=f)}if(t===null)return null;const c=this.taskQueue[t];return this.taskQueue.splice(t,1),c}remove(){this.invoker.remove()}}class Wv{constructor(t){this._stringToNumber={},this._numberToString=[];for(let s=0;s<t.length;s++){const c=t[s];this._stringToNumber[c]=s,this._numberToString[s]=c}}encode(t){return this._stringToNumber[t]}decode(t){return this._numberToString[t]}}const AS=["tile","layer","source","sourceLayer","state"];class qv{constructor(t,s,c,f,p){this.type="Feature",this._vectorTileFeature=t,this._z=s,this._x=c,this._y=f,this.properties=t.properties,this.id=p}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={type:"Feature",geometry:this.geometry,properties:this.properties};this.id!==void 0&&(t.id=this.id);for(const s of AS)this[s]!==void 0&&(t[s]=this[s]);return t}}const Un=32,Is=33,Jo=new Uint16Array(8184);for(let n=0;n<2046;n++){let t=n+2,s=0,c=0,f=0,p=0,_=0,v=0;for(1&t?f=p=_=Un:s=c=v=Un;(t>>=1)>1;){const E=s+f>>1,M=c+p>>1;1&t?(f=s,p=c,s=_,c=v):(s=f,c=p,f=_,p=v),_=E,v=M}const w=4*n;Jo[w+0]=s,Jo[w+1]=c,Jo[w+2]=f,Jo[w+3]=p}const Cs=new Uint16Array(2178),Qo=new Uint8Array(1089),md=new Uint16Array(1089);function Xv(n){return n===0?-.03125:n===32?.03125:0}var Hv=We([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const Yv={type:2,extent:It,loadGeometry:()=>[[new F(0,0),new F(8193,0),new F(8193,8193),new F(0,8193),new F(0,0)]]};class Cm{constructor(t,s,c,f,p){this.tileID=t,this.uid=Xt(),this.uses=0,this.tileSize=s,this.tileZoom=c,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=p,this.expiredRequestCount=0,this.state="loading",f&&f.transform&&(this.projection=f.transform.projection)}registerFadeDuration(t){const s=t+this.timeAdded;s<Er.now()||this.fadeEndTime&&s<this.fadeEndTime||(this.fadeEndTime=s)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=Ka(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,s,c){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(f,p){const _={};if(!p)return _;for(const v of f){const w=v.layerIds.map(E=>p.getLayer(E)).filter(Boolean);if(w.length!==0){v.layers=w,v.stateDependentLayerIds&&(v.stateDependentLayers=v.stateDependentLayerIds.map(E=>w.filter(M=>M.id===E)[0]));for(const E of w)_[E.id]=v}}return _}(t.buckets,s.style),this.hasSymbolBuckets=!1;for(const f in this.buckets){const p=this.buckets[f];if(p instanceof Ko){if(this.hasSymbolBuckets=!0,!c)break;p.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const f in this.buckets){const p=this.buckets[f];if(p instanceof Ko&&p.hasRTLText){this.hasRTLText=!0,H.isLoading()||H.isLoaded()||Z()!=="deferred"||J();break}}this.queryPadding=0;for(const f in this.buckets){const p=this.buckets[f];this.queryPadding=Math.max(this.queryPadding,s.style.getLayer(f).queryRadius(p))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas)}else this.collisionBoxArray=new Ts}unloadVectorData(){if(this.hasData()){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(t){return this.buckets[t.id]}upload(t){for(const c in this.buckets){const f=this.buckets[c];f.uploadPending()&&f.upload(t)}const s=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new sh(t,this.imageAtlas.image,s.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new sh(t,this.glyphAtlasImage,s.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new sh(t,this.lineAtlas.image,s.ALPHA),this.lineAtlas.uploaded=!0)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,s,c,f,p,_,v,w){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:f,pixelPosMatrix:v,transform:_,params:p,tileTransform:this.tileTransform},t,s,c):{}}querySourceFeatures(t,s){const c=this.latestFeatureIndex;if(!c||!c.rawTileData)return;const f=c.loadVTLayers(),p=s?s.sourceLayer:"",_=f._geojsonTileLayer||f[p];if(!_)return;const v=Da(s&&s.filter),{z:w,x:E,y:M}=this.tileID.canonical,C={z:w,x:E,y:M};for(let L=0;L<_.length;L++){const O=_.feature(L);if(v.needGeometry){const q=$a(O,!0);if(!v.filter(new Y(this.tileID.overscaledZ),q,this.tileID.canonical))continue}else if(!v.filter(new Y(this.tileID.overscaledZ),O))continue;const z=c.getId(O,p),G=new qv(O,w,E,M,z);G.tile=C,t.push(G)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const s=this.expirationTime;if(t.cacheControl){const c=Li(t.cacheControl);c["max-age"]&&(this.expirationTime=Date.now()+1e3*c["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const c=Date.now();let f=!1;if(this.expirationTime>c)f=!1;else if(s)if(this.expirationTime<s)f=!0;else{const p=this.expirationTime-s;p?this.expirationTime=c+Math.max(p,3e4):f=!0}else f=!0;f?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,s){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0||!s)return;const c=this.latestFeatureIndex.loadVTLayers(),f=s.style.listImages();for(const p in this.buckets){if(!s.style.hasLayer(p))continue;const _=this.buckets[p],v=_.layers[0].sourceLayer||"_geojsonTileLayer",w=c[v],E=t[v];if(!w||!E||Object.keys(E).length===0)continue;if(_.update(E,w,f,this.imageAtlas&&this.imageAtlas.patternPositions||{}),_ instanceof Jf||_ instanceof Xf){const C=s.style._getSourceCache(_.layers[0].source);s._terrain&&s._terrain.enabled&&C&&_.programConfigurations.needsUpload&&s._terrain._clearRenderCacheForTile(C.id,this.tileID)}const M=s&&s.style&&s.style.getLayer(p);M&&(this.queryPadding=Math.max(this.queryPadding,M.queryRadius(_)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Er.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=Er.now()+t}setTexture(t,s){const c=s.context,f=c.gl;this.texture=s.getTileTexture(t.width),this.texture?this.texture.update(t,{useMipmap:!0}):(this.texture=new sh(c,t,f.RGBA,{useMipmap:!0}),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE),c.extTextureFilterAnisotropic&&f.texParameterf(f.TEXTURE_2D,c.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,c.extTextureFilterAnisotropicMax))}setDependencies(t,s){const c={};for(const f of s)c[f]=!0;this.dependencies[t]=c}hasDependency(t,s){for(const c of t){const f=this.dependencies[c];if(f){for(const p of s)if(f[p])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,s){if(!s||s.name==="mercator"||this._tileDebugBuffer)return;const c=ao(Yv,this.tileID.canonical,this.tileTransform)[0],f=new st,p=new eo;for(let _=0;_<c.length;_++){const{x:v,y:w}=c[_];f.emplaceBack(v,w),p.emplaceBack(_)}p.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(p),this._tileDebugBuffer=t.createVertexBuffer(f,Ku.members),this._tileDebugSegments=Xi.simpleSegment(0,0,f.length,p.length)}_makeTileBoundsBuffers(t,s){if(this._tileBoundsBuffer||!s||s.name==="mercator")return;const c=ao(Yv,this.tileID.canonical,this.tileTransform)[0];let f,p;if(this.isRaster){const _=function(v,w){const E=Ka(v,w),M=Math.pow(2,v.z);for(let q=0;q<Is;q++)for(let re=0;re<Is;re++){const he=Fn((v.x+(re+Xv(re))/Un)/M),se=vr((v.y+(q+Xv(q))/Un)/M),le=w.project(he,se),xe=q*Is+re;Cs[2*xe+0]=Math.round((le.x*E.scale-E.x)*It),Cs[2*xe+1]=Math.round((le.y*E.scale-E.y)*It)}Qo.fill(0),md.fill(0);for(let q=2045;q>=0;q--){const re=4*q,he=Jo[re+0],se=Jo[re+1],le=Jo[re+2],xe=Jo[re+3],de=he+le>>1,Oe=se+xe>>1,Le=de+Oe-se,Ne=Oe+he-de,it=se*Is+he,ze=xe*Is+le,Ge=Oe*Is+de,He=Math.hypot((Cs[2*it+0]+Cs[2*ze+0])/2-Cs[2*Ge+0],(Cs[2*it+1]+Cs[2*ze+1])/2-Cs[2*Ge+1])>=16;if(Qo[Ge]=Qo[Ge]||(He?1:0),q<1022){const Ze=(se+Ne>>1)*Is+(he+Le>>1),Qe=(xe+Ne>>1)*Is+(le+Le>>1);Qo[Ge]=Qo[Ge]||Qo[Ze]||Qo[Qe]}}const C=new At,L=new Zt;let O=0;function z(q,re){const he=re*Is+q;return md[he]===0&&(C.emplaceBack(Cs[2*he+0],Cs[2*he+1],q*It/Un,re*It/Un),md[he]=++O),md[he]-1}function G(q,re,he,se,le,xe){const de=q+he>>1,Oe=re+se>>1;if(Math.abs(q-le)+Math.abs(re-xe)>1&&Qo[Oe*Is+de])G(le,xe,q,re,de,Oe),G(he,se,le,xe,de,Oe);else{const Le=z(q,re),Ne=z(he,se),it=z(le,xe);L.emplaceBack(Le,Ne,it)}}return G(0,0,Un,Un,Un,0),G(Un,Un,0,0,0,Un),{vertices:C,indices:L}}(this.tileID.canonical,s);f=_.vertices,p=_.indices}else{f=new At,p=new Zt;for(const{x:v,y:w}of c)f.emplaceBack(v,w,0,0);const _=Gf(f.int16,void 0,4);for(let v=0;v<_.length;v+=3)p.emplaceBack(_[v],_[v+1],_[v+2])}this._tileBoundsBuffer=t.createVertexBuffer(f,Hv.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(p),this._tileBoundsSegments=Xi.simpleSegment(0,0,f.length,p.length)}_makeGlobeTileDebugBuffers(t,s){const c=s.projection;if(!c||c.name!=="globe"||s.freezeTileCoverage)return;const f=this.tileID.canonical,p=Qu(Rv(f,s)),_=eh(s.zoom);let v;_>0&&(v=Wp(new Float64Array(16),s.globeMatrix));const w=(f.x+.5)/(1<<f.z)-Es(s.center.lng);let E=0;w>.5?E=-1:w<-.5&&(E=1),this._makeGlobeTileDebugBorderBuffer(t,f,s,p,v,_,E),this._makeGlobeTileDebugTextBuffer(t,f,s,p,v,_,E)}_globePoint(t,s,c,f,p,_,v,w){let E=Ju(t,s,c);if(_){const M=1<<c.z,C=[((t/It+c.x)/M+w)*f,(s/It+c.y)/M*f,0];Yi(C,C,_),E=ko(E,C,v)}return Yi(E,E,p)}_makeGlobeTileDebugBorderBuffer(t,s,c,f,p,_,v){const w=new st,E=new eo,M=new yt,C=(O,z,G,q,re)=>{const he=(G-O)/(re-1),se=(q-z)/(re-1),le=w.length;for(let xe=0;xe<re;xe++){const de=O+xe*he,Oe=z+xe*se;w.emplaceBack(de,Oe);const Le=this._globePoint(de,Oe,s,c.worldSize,f,p,_,v);M.emplaceBack(Le[0],Le[1],Le[2]),E.emplaceBack(le+xe)}},L=It;C(0,0,L,0,16),C(L,0,L,L,16),C(L,L,0,L,16),C(0,L,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(E),this._tileDebugBuffer=t.createVertexBuffer(w,Ku.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(M,Lv.members),this._tileDebugSegments=Xi.simpleSegment(0,0,w.length,E.length)}_makeGlobeTileDebugTextBuffer(t,s,c,f,p,_,v){const w=new st,E=new Zt,M=new yt,C=25;E.reserve(32),w.reserve(C),M.reserve(C);const L=(O,z)=>C*O+z;for(let O=0;O<C;O++){const z=2048*O;for(let G=0;G<C;G++){const q=2048*G;w.emplaceBack(q,z);const re=this._globePoint(q,z,s,c.worldSize,f,p,_,v);M.emplaceBack(re[0],re[1],re[2])}}for(let O=0;O<4;O++)for(let z=0;z<4;z++){const G=L(O,z),q=L(O,z+1),re=L(O+1,z),he=L(O+1,z+1);E.emplaceBack(G,q,re),E.emplaceBack(re,q,he)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(E),this._tileDebugTextBuffer=t.createVertexBuffer(w,Ku.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(M,Lv.members),this._tileDebugTextSegments=Xi.simpleSegment(0,0,C,32)}}class MS{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,s,c){const f=String(s);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][f]=this.stateChanges[t][f]||{},gt(this.stateChanges[t][f],c),this.deletedStates[t]===null){this.deletedStates[t]={};for(const p in this.state[t])p!==f&&(this.deletedStates[t][p]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][f]===null){this.deletedStates[t][f]={};for(const p in this.state[t][f])c[p]||(this.deletedStates[t][f][p]=null)}else for(const p in c)this.deletedStates[t]&&this.deletedStates[t][f]&&this.deletedStates[t][f][p]===null&&delete this.deletedStates[t][f][p]}removeFeatureState(t,s,c){if(this.deletedStates[t]===null)return;const f=String(s);if(this.deletedStates[t]=this.deletedStates[t]||{},c&&s!==void 0)this.deletedStates[t][f]!==null&&(this.deletedStates[t][f]=this.deletedStates[t][f]||{},this.deletedStates[t][f][c]=null);else if(s!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][f])for(c in this.deletedStates[t][f]={},this.stateChanges[t][f])this.deletedStates[t][f][c]=null;else this.deletedStates[t][f]=null;else this.deletedStates[t]=null}getState(t,s){const c=String(s),f=gt({},(this.state[t]||{})[c],(this.stateChanges[t]||{})[c]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const p=this.deletedStates[t][s];if(p===null)return{};for(const _ in p)delete f[_]}return f}initializeTileState(t,s){t.setFeatureState(this.state,s)}coalesceChanges(t,s){const c={};for(const f in this.stateChanges){this.state[f]=this.state[f]||{};const p={};for(const _ in this.stateChanges[f])this.state[f][_]||(this.state[f][_]={}),gt(this.state[f][_],this.stateChanges[f][_]),p[_]=this.state[f][_];c[f]=p}for(const f in this.deletedStates){this.state[f]=this.state[f]||{};const p={};if(this.deletedStates[f]===null)for(const _ in this.state[f])p[_]={},this.state[f][_]={};else for(const _ in this.deletedStates[f]){if(this.deletedStates[f][_]===null)this.state[f][_]={};else for(const v of Object.keys(this.deletedStates[f][_]))delete this.state[f][_][v];p[_]=this.state[f][_]}c[f]=c[f]||{},gt(c[f],p)}if(this.stateChanges={},this.deletedStates={},Object.keys(c).length!==0)for(const f in t)t[f].setFeatureState(c,s)}}class Kv{constructor(t){this.size=t,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(t,s){const c=this.toIdx(t,s);return{min:this.minimums[c],max:this.maximums[c]}}isLeaf(t,s){return this.leaves[this.toIdx(t,s)]}toIdx(t,s){return s*this.size+t}}function Jv(n,t,s,c){let f=0,p=Number.MAX_VALUE;for(let _=0;_<3;_++)if(Math.abs(c[_])<1e-15){if(s[_]<n[_]||s[_]>t[_])return null}else{const v=1/c[_];let w=(n[_]-s[_])*v,E=(t[_]-s[_])*v;if(w>E){const M=w;w=E,E=M}if(w>f&&(f=w),E<p&&(p=E),f>p)return null}return f}function Qv(n,t,s,c,f,p,_,v,w,E,M){const C=c-n,L=f-t,O=p-s,z=_-n,G=v-t,q=w-s,re=M[1]*q-M[2]*G,he=M[2]*z-M[0]*q,se=M[0]*G-M[1]*z,le=C*re+L*he+O*se;if(Math.abs(le)<1e-15)return null;const xe=1/le,de=E[0]-n,Oe=E[1]-t,Le=E[2]-s,Ne=(de*re+Oe*he+Le*se)*xe;if(Ne<0||Ne>1)return null;const it=Oe*O-Le*L,ze=Le*C-de*O,Ge=de*L-Oe*C,He=(M[0]*it+M[1]*ze+M[2]*Ge)*xe;return He<0||Ne+He>1?null:(z*it+G*ze+q*Ge)*xe}function e0(n,t,s){return(n-t)/(s-t)}function t0(n,t,s,c,f,p,_,v,w){const E=1<<s,M=p-c,C=_-f,L=(n+1)/E*M+c,O=(t+0)/E*C+f,z=(t+1)/E*C+f;v[0]=(n+0)/E*M+c,v[1]=O,w[0]=L,w[1]=z}class i0{constructor(t){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=t,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const s=function(p){const _=Math.ceil(Math.log2(p.dim/8)),v=[];let w=Math.ceil(Math.pow(2,_));const E=1/w,M=(O,z,G,q,re)=>{const he=q?1:0,se=(O+1)*G-he,le=z*G,xe=(z+1)*G-he;re[0]=O*G,re[1]=le,re[2]=se,re[3]=xe};let C=new Kv(w);const L=[];for(let O=0;O<w*w;O++){M(O%w,Math.floor(O/w),E,!1,L);const z=ea(L[0],L[1],p),G=ea(L[2],L[1],p),q=ea(L[2],L[3],p),re=ea(L[0],L[3],p);C.minimums.push(Math.min(z,G,q,re)),C.maximums.push(Math.max(z,G,q,re)),C.leaves.push(1)}for(v.push(C),w/=2;w>=1;w/=2){const O=v[v.length-1];C=new Kv(w);for(let z=0;z<w*w;z++){M(z%w,Math.floor(z/w),2,!0,L);const G=O.getElevation(L[0],L[1]),q=O.getElevation(L[2],L[1]),re=O.getElevation(L[2],L[3]),he=O.getElevation(L[0],L[3]),se=O.isLeaf(L[0],L[1]),le=O.isLeaf(L[2],L[1]),xe=O.isLeaf(L[2],L[3]),de=O.isLeaf(L[0],L[3]),Oe=Math.min(G.min,q.min,re.min,he.min),Le=Math.max(G.max,q.max,re.max,he.max),Ne=se&&le&&xe&&de;C.maximums.push(Le),C.minimums.push(Oe),C.leaves.push(Le-Oe<=5&&Ne?1:0)}v.push(C)}return v}(this.dem),c=s.length-1,f=s[c];this._addNode(f.minimums[0],f.maximums[0],f.leaves[0]),this._construct(s,0,0,c,0)}raycastRoot(t,s,c,f,p,_,v=1){return Jv([t,s,-100],[c,f,this.maximums[0]*v],p,_)}raycast(t,s,c,f,p,_,v=1){if(!this.nodeCount)return null;const w=this.raycastRoot(t,s,c,f,p,_,v);if(w==null)return null;const E=[],M=[],C=[],L=[],O=[{idx:0,t:w,nodex:0,nodey:0,depth:0}];for(;O.length>0;){const{idx:z,t:G,nodex:q,nodey:re,depth:he}=O.pop();if(this.leaves[z]){t0(q,re,he,t,s,c,f,C,L);const le=1<<he,xe=(q+0)/le,de=(q+1)/le,Oe=(re+0)/le,Le=(re+1)/le,Ne=ea(xe,Oe,this.dem)*v,it=ea(de,Oe,this.dem)*v,ze=ea(de,Le,this.dem)*v,Ge=ea(xe,Le,this.dem)*v,He=Qv(C[0],C[1],Ne,L[0],C[1],it,L[0],L[1],ze,p,_),Ze=Qv(L[0],L[1],ze,C[0],L[1],Ge,C[0],C[1],Ne,p,_),Qe=Math.min(He!==null?He:Number.MAX_VALUE,Ze!==null?Ze:Number.MAX_VALUE);if(Qe!==Number.MAX_VALUE)return Qe;{const Ye=Vf([],p,_,G);if(r0(Ne,it,Ge,ze,e0(Ye[0],C[0],L[0]),e0(Ye[1],C[1],L[1]))>=Ye[2])return G}continue}let se=0;for(let le=0;le<this._siblingOffset.length;le++){t0((q<<1)+this._siblingOffset[le][0],(re<<1)+this._siblingOffset[le][1],he+1,t,s,c,f,C,L),C[2]=-100,L[2]=this.maximums[this.childOffsets[z]+le]*v;const xe=Jv(C,L,p,_);if(xe!=null){const de=xe;E[le]=de;let Oe=!1;for(let Le=0;Le<se&&!Oe;Le++)de>=E[M[Le]]&&(M.splice(Le,0,le),Oe=!0);Oe||(M[se]=le),se++}}for(let le=0;le<se;le++){const xe=M[le];O.push({idx:this.childOffsets[z]+xe,t:E[xe],nodex:(q<<1)+this._siblingOffset[xe][0],nodey:(re<<1)+this._siblingOffset[xe][1],depth:he+1})}}return null}_addNode(t,s,c){return this.minimums.push(t),this.maximums.push(s),this.leaves.push(c),this.childOffsets.push(0),this.nodeCount++}_construct(t,s,c,f,p){if(t[f].isLeaf(s,c)===1)return;this.childOffsets[p]||(this.childOffsets[p]=this.nodeCount);const _=f-1,v=t[_];let w=0,E=0;for(let M=0;M<this._siblingOffset.length;M++){const C=2*s+this._siblingOffset[M][0],L=2*c+this._siblingOffset[M][1],O=v.getElevation(C,L),z=v.isLeaf(C,L),G=this._addNode(O.min,O.max,z);z&&(w|=1<<M),E||(E=G)}for(let M=0;M<this._siblingOffset.length;M++)w&1<<M||this._construct(t,2*s+this._siblingOffset[M][0],2*c+this._siblingOffset[M][1],_,E+M)}}function r0(n,t,s,c,f,p){return Qt(Qt(n,s,p),Qt(t,c,p),f)}function ea(n,t,s){const c=s.dim,f=Re(n*c-.5,0,c-1),p=Re(t*c-.5,0,c-1),_=Math.floor(f),v=Math.floor(p),w=Math.min(_+1,c-1),E=Math.min(v+1,c-1);return r0(s.get(_,v),s.get(w,v),s.get(_,E),s.get(w,E),f-_,p-v)}const n0={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class gd{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(t,s,c,f=!1,p=!1){if(this.uid=t,s.height!==s.width)throw new RangeError("DEM tiles must be square");if(c&&c!=="mapbox"&&c!=="terrarium")return Ci(`"${c}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=s.height;const _=this.dim=s.height-2,v=new Uint32Array(s.data.buffer);if(this.pixels=new Uint8Array(s.data.buffer),this.encoding=c||"mapbox",this.borderReady=f,!f){for(let w=0;w<_;w++)v[this._idx(-1,w)]=v[this._idx(0,w)],v[this._idx(_,w)]=v[this._idx(_-1,w)],v[this._idx(w,-1)]=v[this._idx(w,0)],v[this._idx(w,_)]=v[this._idx(w,_-1)];v[this._idx(-1,-1)]=v[this._idx(0,0)],v[this._idx(_,-1)]=v[this._idx(_-1,0)],v[this._idx(-1,_)]=v[this._idx(0,_-1)],v[this._idx(_,_)]=v[this._idx(_-1,_-1)],p&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new i0(this)}get(t,s,c=!1){c&&(t=Re(t,-1,this.dim),s=Re(s,-1,this.dim));const f=4*this._idx(t,s);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(this.pixels[f],this.pixels[f+1],this.pixels[f+2])}static getUnpackVector(t){return n0[t]}get unpackVector(){return n0[this.encoding]}_idx(t,s){if(t<-1||t>=this.dim+1||s<-1||s>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(s+1)*this.stride+(t+1)}_unpackMapbox(t,s,c){return(256*t*256+256*s+c)/10-1e4}_unpackTerrarium(t,s,c){return 256*t+s+c/256-32768}static pack(t,s){const c=[0,0,0,0],f=gd.getUnpackVector(s);let p=Math.floor((t+f[3])/f[2]);return c[2]=p%256,p=Math.floor(p/256),c[1]=p%256,p=Math.floor(p/256),c[0]=p,c}getPixels(){return new ln({width:this.stride,height:this.stride},this.pixels)}backfillBorder(t,s,c){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let f=s*this.dim,p=s*this.dim+this.dim,_=c*this.dim,v=c*this.dim+this.dim;switch(s){case-1:f=p-1;break;case 1:p=f+1}switch(c){case-1:_=v-1;break;case 1:v=_+1}const w=-s*this.dim,E=-c*this.dim;for(let M=_;M<v;M++)for(let C=f;C<p;C++){const L=4*this._idx(C,M),O=4*this._idx(C+w,M+E);this.pixels[L+0]=t.pixels[O+0],this.pixels[L+1]=t.pixels[O+1],this.pixels[L+2]=t.pixels[O+2],this.pixels[L+3]=t.pixels[O+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}pt(gd,"DEMData"),pt(i0,"DemMinMaxQuadTree",{omit:["dem"]});class PS{constructor(t,s){this.max=t,this.onRemove=s,this.reset()}reset(){for(const t in this.data)for(const s of this.data[t])s.timeout&&clearTimeout(s.timeout),this.onRemove(s.value);return this.data={},this.order=[],this}add(t,s,c){const f=t.wrapped().key;this.data[f]===void 0&&(this.data[f]=[]);const p={value:s,timeout:void 0};if(c!==void 0&&(p.timeout=setTimeout(()=>{this.remove(t,p)},c)),this.data[f].push(p),this.order.push(f),this.order.length>this.max){const _=this._getAndRemoveByKey(this.order[0]);_&&this.onRemove(_)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const s=this.data[t].shift();return s.timeout&&clearTimeout(s.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),s.value}getByKey(t){const s=this.data[t];return s?s[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,s){if(!this.has(t))return this;const c=t.wrapped().key,f=s===void 0?0:this.data[c].indexOf(s),p=this.data[c][f];return this.data[c].splice(f,1),p.timeout&&clearTimeout(p.timeout),this.data[c].length===0&&delete this.data[c],this.onRemove(p.value),this.order.splice(this.order.indexOf(c),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const s=this._getAndRemoveByKey(this.order[0]);s&&this.onRemove(s)}return this}filter(t){const s=[];for(const c in this.data)for(const f of this.data[c])t(f.value)||s.push(f);for(const c of s)this.remove(c.value.tileID,c)}}class cc{constructor(t,s,c){this.func=t,this.mask=s,this.range=c}}cc.ReadOnly=!1,cc.ReadWrite=!0,cc.disabled=new cc(519,cc.ReadOnly,[0,1]);const Lm=7680;class km{constructor(t,s,c,f,p,_){this.test=t,this.ref=s,this.mask=c,this.fail=f,this.depthFail=p,this.pass=_}}km.disabled=new km({func:519,mask:0},0,0,Lm,Lm,Lm);class Ls{constructor(t,s,c){this.blendFunction=t,this.blendColor=s,this.mask=c}}Ls.Replace=[1,0],Ls.disabled=new Ls(Ls.Replace,ce.transparent,[!1,!1,!1,!1]),Ls.unblended=new Ls(Ls.Replace,ce.transparent,[!0,!0,!0,!0]),Ls.alphaBlended=new Ls([1,771],ce.transparent,[!0,!0,!0,!0]);const Rm=1029,Om=2305;class as{constructor(t,s,c){this.enable=t,this.mode=s,this.frontFace=c}}as.disabled=new as(!1,Rm,Om),as.backCCW=new as(!0,Rm,Om),as.backCW=new as(!0,Rm,2304),as.frontCW=new as(!0,1028,2304),as.frontCCW=new as(!0,1028,Om);class Ja extends St{constructor(t,s,c){super(),this.id=t,this._onlySymbols=c,s.on("data",f=>{f.dataType==="source"&&f.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&f.dataType==="source"&&f.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),s.on("error",()=>{this._sourceErrored=!0}),this._source=s,this._tiles={},this._cache=new PS(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=s.minTileCacheSize,this._maxTileCacheSize=s.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new MS,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(t){this.map=t,this._minTileCacheSize=this._minTileCacheSize===void 0&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles){const s=this._tiles[t];if(s.state!=="loaded"&&s.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,s){return t.isSymbolTile=this._onlySymbols,this._source.loadTile(t,s)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t,()=>{})}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t,()=>{})}serialize(){return this._source.serialize()}prepare(t){if(this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._source.prepareTile)for(const s in this._tiles){const c=this._tiles[s];this._source.prepareTile(c)&&this.map.painter.terrain&&this.map.painter.terrain._clearRenderCacheForTile(this.id,c.tileID),c.upload(t),c.prepare(this.map.style.imageManager)}else for(const s in this._tiles){const c=this._tiles[s];c.upload(t),c.prepare(this.map.style.imageManager)}}getIds(){return Mt(this._tiles).map(t=>t.tileID).sort(s0).map(t=>t.key)}getRenderableIds(t){const s=[];for(const c in this._tiles)this._isIdRenderable(+c,t)&&s.push(this._tiles[c]);return t?s.sort((c,f)=>{const p=c.tileID,_=f.tileID,v=new F(p.canonical.x,p.canonical.y)._rotate(this.transform.angle),w=new F(_.canonical.x,_.canonical.y)._rotate(this.transform.angle);return p.overscaledZ-_.overscaledZ||w.y-v.y||w.x-v.x}).map(c=>c.tileID.key):s.map(c=>c.tileID).sort(s0).map(c=>c.key)}hasRenderableParent(t){const s=this.findLoadedParent(t,0);return!!s&&this._isIdRenderable(s.tileID.key)}_isIdRenderable(t,s){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(s||!this._tiles[t].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(+t,"reloading")}}_reloadTile(t,s){const c=this._tiles[t];c&&(c.state!=="loading"&&(c.state=s),this._loadTile(c,this._tileLoaded.bind(this,c,t,s)))}_tileLoaded(t,s,c,f){if(f)if(t.state="errored",f.status!==404)this._source.fire(new ni(f,{tile:t}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const p=this.map.painter.terrain;this.update(this.transform,p.getScaledDemTileSize(),!0),p.resetTileLookupCache(this.id)}else this.update(this.transform);else t.timeAdded=Er.now(),c==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(s,t),this._source.type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new ri("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id}))}_backfillDEM(t){const s=this.getRenderableIds();for(let f=0;f<s.length;f++){const p=s[f];if(t.neighboringTiles&&t.neighboringTiles[p]){const _=this.getTileByID(p);c(t,_),c(_,t)}}function c(f,p){if(!f.dem||f.dem.borderReady)return;f.needsHillshadePrepare=!0,f.needsDEMTextureUpload=!0;let _=p.tileID.canonical.x-f.tileID.canonical.x;const v=p.tileID.canonical.y-f.tileID.canonical.y,w=Math.pow(2,f.tileID.canonical.z),E=p.tileID.key;_===0&&v===0||Math.abs(v)>1||(Math.abs(_)>1&&(Math.abs(_+w)===1?_+=w:Math.abs(_-w)===1&&(_-=w)),p.dem&&f.dem&&(f.dem.backfillBorder(p.dem,_,v),f.neighboringTiles&&f.neighboringTiles[E]&&(f.neighboringTiles[E].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,s,c,f){for(const p in this._tiles){let _=this._tiles[p];if(f[p]||!_.hasData()||_.tileID.overscaledZ<=s||_.tileID.overscaledZ>c)continue;let v=_.tileID;for(;_&&_.tileID.overscaledZ>s+1;){const E=_.tileID.scaledTo(_.tileID.overscaledZ-1);_=this._tiles[E.key],_&&_.hasData()&&(v=E)}let w=v;for(;w.overscaledZ>s;)if(w=w.scaledTo(w.overscaledZ-1),t[w.key]){f[v.key]=v;break}}}findLoadedParent(t,s){if(t.key in this._loadedParentTiles){const c=this._loadedParentTiles[t.key];return c&&c.tileID.overscaledZ>=s?c:null}for(let c=t.overscaledZ-1;c>=s;c--){const f=t.scaledTo(c),p=this._getLoadedTile(f);if(p)return p}}_getLoadedTile(t){const s=this._tiles[t.key];return s&&s.hasData()?s:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,s){s=s||this._source.tileSize;const c=Math.ceil(t.width/s)+1,f=Math.ceil(t.height/s)+1,p=Math.floor(c*f*5),_=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,p):p,v=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,_):_;this._cache.setMaxSize(v)}handleWrapJump(t){const s=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,s){const c={};for(const f in this._tiles){const p=this._tiles[f];p.tileID=p.tileID.unwrapTo(p.tileID.wrap+s),c[p.tileID.key]=p}this._tiles=c;for(const f in this._timers)clearTimeout(this._timers[f]),delete this._timers[f];for(const f in this._tiles)this._setTileReloadTimer(+f,this._tiles[f])}}update(t,s,c){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!c)return;let f;this.updateCacheSize(t,s),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?f=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(v=>new Nr(v.canonical.z,v.wrap,v.canonical.z,v.canonical.x,v.canonical.y)):(f=t.coveringTiles({tileSize:s||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!c,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(f=f.filter(v=>this._source.hasTile(v)))):f=[];const p=this._updateRetainedTiles(f);if(o0(this._source.type)&&f.length!==0){const v={},w={},E=Object.keys(p);for(const C of E){const L=p[C],O=this._tiles[C];if(!O||O.fadeEndTime&&O.fadeEndTime<=Er.now())continue;const z=this.findLoadedParent(L,Math.max(L.overscaledZ-Ja.maxOverzooming,this._source.minzoom));z&&(this._addTile(z.tileID),v[z.tileID.key]=z.tileID),w[C]=L}const M=f[f.length-1].overscaledZ;for(const C in this._tiles){const L=this._tiles[C];if(p[C]||!L.hasData())continue;let O=L.tileID;for(;O.overscaledZ>M;){O=O.scaledTo(O.overscaledZ-1);const z=this._tiles[O.key];if(z&&z.hasData()&&w[O.key]){p[C]=L.tileID;break}}}for(const C in v)p[C]||(this._coveredTiles[C]=!0,p[C]=v[C])}for(const v in p)this._tiles[v].clearFadeHold();const _=function(v,w){const E=[];for(const M in v)M in w||E.push(M);return E}(this._tiles,p);for(const v of _){const w=this._tiles[v];w.hasSymbolBuckets&&!w.holdingForFade()?w.setHoldDuration(this.map._fadeDuration):w.hasSymbolBuckets&&!w.symbolFadeFinished()||this._removeTile(+v)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const s={};if(t.length===0)return s;const c={},f=t.reduce((E,M)=>Math.min(E,M.overscaledZ),1/0),p=t[0].overscaledZ,_=Math.max(p-Ja.maxOverzooming,this._source.minzoom),v=Math.max(p+Ja.maxUnderzooming,this._source.minzoom),w={};for(const E of t){const M=this._addTile(E);s[E.key]=E,M.hasData()||f<this._source.maxzoom&&(w[E.key]=E)}this._retainLoadedChildren(w,f,v,s);for(const E of t){let M=this._tiles[E.key];if(M.hasData())continue;if(E.canonical.z>=this._source.maxzoom){const L=E.children(this._source.maxzoom)[0],O=this.getTile(L);if(O&&O.hasData()){s[L.key]=L;continue}}else{const L=E.children(this._source.maxzoom);if(s[L[0].key]&&s[L[1].key]&&s[L[2].key]&&s[L[3].key])continue}let C=M.wasRequested();for(let L=E.overscaledZ-1;L>=_;--L){const O=E.scaledTo(L);if(c[O.key]||(c[O.key]=!0,M=this.getTile(O),!M&&C&&(M=this._addTile(O)),M&&(s[O.key]=O,C=M.wasRequested(),M.hasData())))break}}return s}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const s=[];let c,f=this._tiles[t].tileID;for(;f.overscaledZ>0;){if(f.key in this._loadedParentTiles){c=this._loadedParentTiles[f.key];break}s.push(f.key);const p=f.scaledTo(f.overscaledZ-1);if(c=this._getLoadedTile(p),c)break;f=p}for(const p of s)this._loadedParentTiles[p]=c}}_addTile(t){let s=this._tiles[t.key];if(s)return this._source.prepareTile&&this._source.prepareTile(s),s;s=this._cache.getAndRemove(t),s&&(this._setTileReloadTimer(t.key,s),s.tileID=t,this._state.initializeTileState(s,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,s)));const c=!!s;if(!c){const f=this.map?this.map.painter:null;s=new Cm(t,this._source.tileSize*t.overscaleFactor(),this.transform.tileZoom,f,this._isRaster),this._source.prepareTile&&this._source.prepareTile(s)||this._loadTile(s,this._tileLoaded.bind(this,s,t.key,s.state))}return s?(s.uses++,this._tiles[t.key]=s,c||this._source.fire(new ri("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s):null}_setTileReloadTimer(t,s){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const c=s.getExpiryTimeout();c&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},c))}_removeTile(t){const s=this._tiles[t];s&&(s.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),s.uses>0||(s.hasData()&&s.state!=="reloading"?this._cache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,s,c){const f=[],p=this.transform;if(!p)return f;const _=p.projection.name==="globe",v=Es(p.center.lng);for(const w in this._tiles){const E=this._tiles[w];if(c&&E.clearQueryDebugViz(),E.holdingForFade())continue;let M;if(_){const C=E.tileID.canonical;if(C.z===0){const L=[Math.abs(Re(v,...oh(C,-1))-v),Math.abs(Re(v,...oh(C,1))-v)];M=[0,2*L.indexOf(Math.min(...L))-1]}else{const L=[Math.abs(Re(v,...oh(C,-1))-v),Math.abs(Re(v,...oh(C,0))-v),Math.abs(Re(v,...oh(C,1))-v)];M=[L.indexOf(Math.min(...L))-1]}}else M=[0];for(const C of M){const L=t.containsTile(E,p,s,C);L&&f.push(L)}}return f}getVisibleCoordinates(t){const s=this.getRenderableIds(t).map(c=>this._tiles[c].tileID);for(const c of s)c.projMatrix=this.transform.calculateProjMatrix(c.toUnwrapped());return s}hasTransition(){if(this._source.hasTransition())return!0;if(o0(this._source.type))for(const t in this._tiles){const s=this._tiles[t];if(s.fadeEndTime!==void 0&&s.fadeEndTime>=Er.now())return!0}return!1}setFeatureState(t,s,c){this._state.updateState(t=t||"_geojsonTileLayer",s,c)}removeFeatureState(t,s,c){this._state.removeFeatureState(t=t||"_geojsonTileLayer",s,c)}getFeatureState(t,s){return this._state.getState(t=t||"_geojsonTileLayer",s)}setDependencies(t,s,c){const f=this._tiles[t];f&&f.setDependencies(s,c)}reloadTilesForDependencies(t,s){for(const c in this._tiles)this._tiles[c].hasDependency(t,s)&&this._reloadTile(+c,"reloading");this._cache.filter(c=>!c.hasDependency(t,s))}_preloadTiles(t,s){const c=new Map,f=Array.isArray(t)?t:[t],p=this.map.painter.terrain,_=this.usedForTerrain&&p?p.getScaledDemTileSize():this._source.tileSize;for(const v of f){const w=v.coveringTiles({tileSize:_,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const E of w)c.set(E.key,E);this.usedForTerrain&&v.updateElevation(!1)}mt(Array.from(c.values()),(v,w)=>{const E=new Cm(v,this._source.tileSize*v.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(E,M=>{this._source.type==="raster-dem"&&E.dem&&this._backfillDEM(E),w(M,E)})},s)}}function s0(n,t){const s=Math.abs(2*n.wrap)-+(n.wrap<0),c=Math.abs(2*t.wrap)-+(t.wrap<0);return n.overscaledZ-t.overscaledZ||c-s||t.canonical.y-n.canonical.y||t.canonical.x-n.canonical.x}function o0(n){return n==="raster"||n==="image"||n==="video"}function oh(n,t){const s=1<<n.z;return[n.x/s+t,(n.x+1)/s+t]}Ja.maxOverzooming=10,Ja.maxUnderzooming=3;class _d{constructor(t,s,c){this._demTile=t,this._dem=this._demTile.dem,this._scale=s,this._offset=c}static create(t,s,c){const f=c||t.findDEMTileFor(s);if(!f||!f.dem)return;const p=f.dem,_=f.tileID,v=1<<s.canonical.z-_.canonical.z;return new _d(f,f.tileSize/It/v,[(s.canonical.x/v-_.canonical.x)*p.dim,(s.canonical.y/v-_.canonical.y)*p.dim])}tileCoordToPixel(t,s){const c=s*this._scale+this._offset[1],f=Math.floor(t*this._scale+this._offset[0]),p=Math.floor(c);return new F(f,p)}getElevationAt(t,s,c,f){const p=t*this._scale+this._offset[0],_=s*this._scale+this._offset[1],v=Math.floor(p),w=Math.floor(_),E=this._dem;return f=!!f,c?Qt(Qt(E.get(v,w,f),E.get(v,w+1,f),_-w),Qt(E.get(v+1,w,f),E.get(v+1,w+1,f),_-w),p-v):E.get(v,w,f)}getElevationAtPixel(t,s,c){return this._dem.get(t,s,!!c)}getMeterToDEM(t){return(1<<this._demTile.tileID.canonical.z)*Bn(1,t)*this._dem.stride}}class a0{constructor(t,s){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Go(It,16,0),this.featureIndexArray=new Y_,this.promoteId=s}insert(t,s,c,f,p,_=0){const v=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(c,f,p,_);const w=this.grid;for(let E=0;E<s.length;E++){const M=s[E],C=[1/0,1/0,-1/0,-1/0];for(let L=0;L<M.length;L++){const O=M[L];C[0]=Math.min(C[0],O.x),C[1]=Math.min(C[1],O.y),C[2]=Math.max(C[2],O.x),C[3]=Math.max(C[3],O.y)}C[0]<It&&C[1]<It&&C[2]>=0&&C[3]>=0&&w.insert(v,C[0],C[1],C[2],C[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Ya.VectorTile(new Xu(this.rawTileData)).layers,this.sourceLayerCoder=new Wv(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const t in this.vtLayers)this.vtFeatures[t]=[]}return this.vtLayers}query(t,s,c,f){this.loadVTLayers();const p=t.params||{},_=Da(p.filter),v=t.tileResult,w=t.transform,E=v.bufferedTilespaceBounds,M=this.grid.query(E.min.x,E.min.y,E.max.x,E.max.y,(z,G,q,re)=>my(v.bufferedTilespaceGeometry,z,G,q,re));M.sort(IS);let C=null;w.elevation&&M.length>0&&(C=_d.create(w.elevation,this.tileID));const L={};let O;for(let z=0;z<M.length;z++){const G=M[z];if(G===O)continue;O=G;const q=this.featureIndexArray.get(G);let re=null;this.loadMatchingFeature(L,q,_,p.layers,p.availableImages,s,c,f,(he,se,le,xe=0)=>(re||(re=ao(he,this.tileID.canonical,t.tileTransform)),se.queryIntersectsFeature(v,he,le,re,this.z,t.transform,t.pixelPosMatrix,C,xe)))}return L}loadMatchingFeature(t,s,c,f,p,_,v,w,E){const{featureIndex:M,bucketIndex:C,sourceLayerIndex:L,layoutVertexArrayOffset:O}=s,z=this.bucketLayerIDs[C];if(f&&!function(he,se){for(let le=0;le<he.length;le++)if(se.indexOf(he[le])>=0)return!0;return!1}(f,z))return;const G=this.sourceLayerCoder.decode(L),q=this.vtLayers[G].feature(M);if(c.needGeometry){const he=$a(q,!0);if(!c.filter(new Y(this.tileID.overscaledZ),he,this.tileID.canonical))return}else if(!c.filter(new Y(this.tileID.overscaledZ),q))return;const re=this.getId(q,G);for(let he=0;he<z.length;he++){const se=z[he];if(f&&f.indexOf(se)<0)continue;const le=_[se];if(!le)continue;let xe={};re!==void 0&&w&&(xe=w.getState(le.sourceLayer||"_geojsonTileLayer",re));const de=gt({},v[se]);de.paint=l0(de.paint,le.paint,q,xe,p),de.layout=l0(de.layout,le.layout,q,xe,p);const Oe=!E||E(q,le,xe,O);if(!Oe)continue;const Le=new qv(q,this.z,this.x,this.y,re);Le.layer=de;let Ne=t[se];Ne===void 0&&(Ne=t[se]=[]),Ne.push({featureIndex:M,feature:Le,intersectionZ:Oe})}}lookupSymbolFeatures(t,s,c,f,p,_,v,w){const E={};this.loadVTLayers();const M=Da(p);for(const C of t)this.loadMatchingFeature(E,{bucketIndex:c,sourceLayerIndex:f,featureIndex:C,layoutVertexArrayOffset:0},M,_,v,w,s);return E}loadFeature(t){const{featureIndex:s,sourceLayerIndex:c}=t;this.loadVTLayers();const f=this.sourceLayerCoder.decode(c),p=this.vtFeatures[f];if(p[s])return p[s];const _=this.vtLayers[f].feature(s);return p[s]=_,_}hasLayer(t){for(const s of this.bucketLayerIDs)for(const c of s)if(t===c)return!0;return!1}getId(t,s){let c=t.id;return this.promoteId&&(c=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[s]],typeof c=="boolean"&&(c=Number(c))),c}}function l0(n,t,s,c,f){return Zr(n,(p,_)=>{const v=t instanceof _e?t.get(_):null;return v&&v.evaluate?v.evaluate(s,c,f):v})}function IS(n,t){return t-n}pt(a0,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class c0{constructor(t){const s={},c=[];for(const v in t){const w=t[v],E=s[v]={};for(const M in w.glyphs){const C=w.glyphs[+M];if(!C||C.bitmap.width===0||C.bitmap.height===0)continue;const L=C.metrics.localGlyph?2:1,O={x:0,y:0,w:C.bitmap.width+2*L,h:C.bitmap.height+2*L};c.push(O),E[M]=O}}const{w:f,h:p}=fm(c),_=new lo({width:f||1,height:p||1});for(const v in t){const w=t[v];for(const E in w.glyphs){const M=w.glyphs[+E];if(!M||M.bitmap.width===0||M.bitmap.height===0)continue;const C=s[v][E],L=M.metrics.localGlyph?2:1;lo.copy(M.bitmap,_,{x:0,y:0},{x:C.x+L,y:C.y+L},M.bitmap)}}this.image=_,this.positions=s}}pt(c0,"GlyphAtlas");class CS{constructor(t){this.tileID=new Nr(t.tileID.overscaledZ,t.tileID.wrap,t.tileID.canonical.z,t.tileID.canonical.x,t.tileID.canonical.y),this.tileZoom=t.tileZoom,this.uid=t.uid,this.zoom=t.zoom,this.canonical=t.tileID.canonical,this.pixelRatio=t.pixelRatio,this.tileSize=t.tileSize,this.source=t.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=t.showCollisionBoxes,this.collectResourceTiming=!!t.collectResourceTiming,this.returnDependencies=!!t.returnDependencies,this.promoteId=t.promoteId,this.enableTerrain=!!t.enableTerrain,this.isSymbolTile=t.isSymbolTile,this.tileTransform=Ka(t.tileID.canonical,t.projection),this.projection=t.projection}parse(t,s,c,f,p){this.status="parsing",this.data=t,this.collisionBoxArray=new Ts;const _=new Wv(Object.keys(t.layers).sort()),v=new a0(this.tileID,this.promoteId);v.bucketLayerIDs=[];const w={},E=new Im(256,256),M={featureIndex:v,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:E,availableImages:c},C=s.familiesBySource[this.source];for(const xe in C){const de=t.layers[xe];if(!de)continue;let Oe=!1,Le=!1;for(const ze of C[xe])ze[0].type==="symbol"?Oe=!0:Le=!0;if(this.isSymbolTile===!0&&!Oe||this.isSymbolTile===!1&&!Le)continue;de.version===1&&Ci(`Vector tile source "${this.source}" layer "${xe}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Ne=_.encode(xe),it=[];for(let ze=0;ze<de.length;ze++){const Ge=de.feature(ze),He=v.getId(Ge,xe);it.push({feature:Ge,id:He,index:ze,sourceLayerIndex:Ne})}for(const ze of C[xe]){const Ge=ze[0];this.isSymbolTile!==void 0&&Ge.type==="symbol"!==this.isSymbolTile||Ge.minzoom&&this.zoom<Math.floor(Ge.minzoom)||Ge.maxzoom&&this.zoom>=Ge.maxzoom||Ge.visibility!=="none"&&(Dm(ze,this.zoom,c),(w[Ge.id]=Ge.createBucket({index:v.bucketLayerIDs.length,layers:ze,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ne,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:c})).populate(it,M,this.tileID.canonical,this.tileTransform),v.bucketLayerIDs.push(ze.map(He=>He.id)))}}let L,O,z,G;E.trim();const q={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},re=Zr(M.glyphDependencies,xe=>Object.keys(xe).map(Number));Object.keys(re).length?f.send("getGlyphs",{uid:this.uid,stacks:re},(xe,de)=>{L||(L=xe,O=de,le.call(this))},void 0,!1,q):O={};const he=Object.keys(M.iconDependencies);he.length?f.send("getImages",{icons:he,source:this.source,tileID:this.tileID,type:"icons"},(xe,de)=>{L||(L=xe,z=de,le.call(this))},void 0,!1,q):z={};const se=Object.keys(M.patternDependencies);function le(){if(L)return p(L);if(O&&z&&G){const xe=new c0(O),de=new uv(z,G);for(const Oe in w){const Le=w[Oe];Le instanceof Ko?(Dm(Le.layers,this.zoom,c),JE(Le,O,xe.positions,z,de.iconPositions,this.showCollisionBoxes,c,this.tileID.canonical,this.tileZoom,this.projection)):Le.hasPattern&&(Le instanceof Jf||Le instanceof Xf||Le instanceof Zu)&&(Dm(Le.layers,this.zoom,c),Le.addFeatures(M,this.tileID.canonical,de.patternPositions,c,this.tileTransform))}this.status="done",p(null,{buckets:Mt(w).filter(Oe=>!Oe.isEmpty()),featureIndex:v,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:xe.image,lineAtlas:E,imageAtlas:de,glyphMap:this.returnDependencies?O:null,iconMap:this.returnDependencies?z:null,glyphPositions:this.returnDependencies?xe.positions:null})}}se.length?f.send("getImages",{icons:se,source:this.source,tileID:this.tileID,type:"patterns"},(xe,de)=>{L||(L=xe,G=de,le.call(this))},void 0,!1,q):G={},le.call(this)}}function Dm(n,t,s){const c=new Y(t);for(const f of n)f.recalculate(c,s)}class u0{constructor(t){this.entries={},this.scheduler=t}request(t,s,c,f){const p=this.entries[t]=this.entries[t]||{callbacks:[]};if(p.result){const[_,v]=p.result;return this.scheduler?this.scheduler.add(()=>{f(_,v)},s):f(_,v),()=>{}}return p.callbacks.push(f),p.cancel||(p.cancel=c((_,v)=>{p.result=[_,v];for(const w of p.callbacks)this.scheduler?this.scheduler.add(()=>{w(_,v)},s):w(_,v);setTimeout(()=>delete this.entries[t],3e3)})),()=>{p.result||(p.callbacks=p.callbacks.filter(_=>_!==f),p.callbacks.length||(p.cancel(),delete this.entries[t]))}}}function h0(n,t,s){const c=JSON.stringify(n.request);return n.data&&(this.deduped.entries[c]={result:[null,n.data]}),this.deduped.request(c,{type:"parseTile",isSymbolTile:n.isSymbolTile,zoom:n.tileZoom},f=>{const p=Me(n.request,(_,v,w,E)=>{_?f(_):v&&f(null,{vectorTile:s?void 0:new Ya.VectorTile(new Xu(v)),rawData:v,cacheControl:w,expires:E})});return()=>{p.cancel(),f()}},t)}a.ARRAY_TYPE=an,a.AUTH_ERR_MSG=dr,a.Aabb=Yr,a.Actor=class{constructor(n,t,s){this.target=n,this.parent=t,this.mapId=s,this.callbacks={},this.cancelCallbacks={},Or(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=wr()?n:P,this.scheduler=new SS}send(n,t,s,c,f=!1,p){const _=Math.round(1e18*Math.random()).toString(36).substring(0,10);s&&(s.metadata=p,this.callbacks[_]=s);const v=yi(this.globalScope)?void 0:[];return this.target.postMessage({id:_,type:n,hasCallback:!!s,targetMapId:c,mustQueue:f,sourceMapId:this.mapId,data:Zo(t,v)},v),{cancel:()=>{s&&delete this.callbacks[_],this.target.postMessage({id:_,type:"<cancel>",targetMapId:c,sourceMapId:this.mapId})}}}receive(n){const t=n.data,s=t.id;if(s&&(!t.targetMapId||this.mapId===t.targetMapId))if(t.type==="<cancel>"){const c=this.cancelCallbacks[s];delete this.cancelCallbacks[s],c&&c.cancel()}else if(t.mustQueue||wr()){const c=this.callbacks[s];this.cancelCallbacks[s]=this.scheduler.add(()=>this.processTask(s,t),c&&c.metadata||{type:"message"})}else this.processTask(s,t)}processTask(n,t){if(t.type==="<response>"){const s=this.callbacks[n];delete this.callbacks[n],s&&(t.error?s(Fa(t.error)):s(null,Fa(t.data)))}else{const s=yi(this.globalScope)?void 0:[],c=t.hasCallback?(p,_)=>{delete this.cancelCallbacks[n],this.target.postMessage({id:n,type:"<response>",sourceMapId:this.mapId,error:p?Zo(p):null,data:Zo(_,s)},s)}:p=>{},f=Fa(t.data);if(this.parent[t.type])this.parent[t.type](t.sourceMapId,f,c);else if(this.parent.getWorkerSource){const p=t.type.split(".");this.parent.getWorkerSource(t.sourceMapId,p[0],f.source)[p[1]](f,c)}else c(new Error(`Could not find function ${t.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},a.CanonicalTileID=Yf,a.Color=ce,a.ColorMode=Ls,a.CullFaceMode=as,a.DEMData=gd,a.DataConstantProperty=pe,a.DedupedRequest=u0,a.DepthMode=cc,a.EXTENT=It,a.Elevation=class{isDataAvailableAtPoint(n){const t=this._source();if(!t||n.y<0||n.y>1)return!1;const s=t.getSource().maxzoom,c=1<<s,f=Math.floor(n.x),p=Math.floor((n.x-f)*c),_=Math.floor(n.y*c),v=this.findDEMTileFor(new Nr(s,f,s,p,_));return!(!v||!v.dem)}getAtPointOrZero(n,t=0){return this.getAtPoint(n,t)||0}getAtPoint(n,t,s=!0){t==null&&(t=null);const c=this._source();if(!c||n.y<0||n.y>1)return t;const f=c.getSource().maxzoom,p=1<<f,_=Math.floor(n.x),v=n.x-_,w=new Nr(f,_,f,Math.floor(v*p),Math.floor(n.y*p)),E=this.findDEMTileFor(w);if(!E||!E.dem)return t;const M=E.dem,C=1<<E.tileID.canonical.z,L=(v*C-E.tileID.canonical.x)*M.dim,O=(n.y*C-E.tileID.canonical.y)*M.dim,z=Math.floor(L),G=Math.floor(O);return(s?this.exaggeration():1)*Qt(Qt(M.get(z,G),M.get(z,G+1),O-G),Qt(M.get(z+1,G),M.get(z+1,G+1),O-G),L-z)}getAtTileOffset(n,t,s){const c=1<<n.canonical.z;return this.getAtPointOrZero(new Xl(n.wrap+(n.canonical.x+t/It)/c,(n.canonical.y+s/It)/c))}getAtTileOffsetFunc(n,t,s,c){return f=>{const p=this.getAtTileOffset(n,f.x,f.y),_=c.upVector(n.canonical,f.x,f.y);return rs(_,_,p*c.upVectorScale(n.canonical,t,s).metersToTile),_}}getForTilePoints(n,t,s,c){const f=_d.create(this,n,c);return!!f&&(t.forEach(p=>{p[2]=this.exaggeration()*f.getElevationAt(p[0],p[1],s)}),!0)}getMinMaxForTile(n){const t=this.findDEMTileFor(n);if(!t||!t.dem)return null;const s=t.dem.tree,c=t.tileID,f=1<<n.canonical.z-c.canonical.z;let p=n.canonical.x/f-c.canonical.x,_=n.canonical.y/f-c.canonical.y,v=0;for(let w=0;w<n.canonical.z-c.canonical.z&&!s.leaves[v];w++){p*=2,_*=2;const E=2*Math.floor(_)+Math.floor(p);v=s.childOffsets[v]+E,p%=1,_%=1}return{min:this.exaggeration()*s.minimums[v],max:this.exaggeration()*s.maximums[v]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(n,t,s){throw new Error("Pure virtual method called.")}pointCoordinate(n){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(n){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},a.ErrorEvent=ni,a.EvaluationParameters=Y,a.Event=ri,a.Evented=St,a.FillExtrusionBucket=Zu,a.Frustum=tm,a.FrustumCorners=em,a.GLOBE_METERS_TO_ECEF=bm,a.GLOBE_RADIUS=ho,a.GLOBE_SCALE_MATCH_LATITUDE=45,a.GLOBE_ZOOM_THRESHOLD_MAX=6,a.GLOBE_ZOOM_THRESHOLD_MIN=5,a.GlobeSharedBuffers=class{constructor(n){this._createGrid(n),this._createPoles(n)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const n of this._poleSegments)n.destroy();for(const n of this._gridSegments)n.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const n of this._wireframeSegments)n.destroy()}}_createGrid(n){const t=new st,s=new Zt,c=65;for(let f=0;f<c;f++)for(let p=0;p<c;p++)t.emplaceBack(p,f);this._gridSegments=[];for(let f=0,p=0;f<oc.length;f++){const _=oc[f];for(let w=0;w<_;w++)for(let E=0;E<64;E++){const M=w*c+E;s.emplaceBack(M+1,M,M+c),s.emplaceBack(M+c,M+c+1,M+1)}const v=64*_*2;this._gridSegments.push(Xi.simpleSegment(0,p,(_+1)*c,v)),p+=v}this._gridBuffer=n.createVertexBuffer(t,Ku.members),this._gridIndexBuffer=n.createIndexBuffer(s,!0)}_createPoles(n){const t=new Zt;for(let f=0;f<=64;f++)t.emplaceBack(0,f+1,f+2);this._poleIndexBuffer=n.createIndexBuffer(t,!0);const s=new yr,c=new yr;this._poleSegments=[];for(let f=0,p=0;f<5;f++){const _=360/(1<<f);s.emplaceBack(0,-ho,0,.5,0),c.emplaceBack(0,-ho,0,.5,1);for(let v=0;v<=64;v++){const w=v/64,E=Qt(0,_,w),[M,C,L]=ac(sS,oS,E,ho);s.emplaceBack(M,C,L,w,0),c.emplaceBack(M,C,L,w,1)}this._poleSegments.push(Xi.simpleSegment(p,0,66,64)),p+=66}this._poleNorthVertexBuffer=n.createVertexBuffer(s,Cv,!1),this._poleSouthVertexBuffer=n.createVertexBuffer(c,Cv,!1)}getGridBuffers(n){return[this._gridBuffer,this._gridIndexBuffer,this._gridSegments[n]]}getPoleBuffers(n){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[n]]}getWirefameBuffers(n,t){if(!this._wireframeSegments){const s=new Pr,c=64,f=c+1;this._wireframeSegments=[];for(let p=0,_=0;p<oc.length;p++){const v=oc[p];for(let E=0;E<v;E++)for(let M=0;M<c;M++){const C=E*f+M;s.emplaceBack(C,C+1),s.emplaceBack(C,C+f),s.emplaceBack(C,C+f+1)}const w=v*c*3;this._wireframeSegments.push(Xi.simpleSegment(0,_,(v+1)*f,w)),_+=w}this._wireframeIndexBuffer=n.createIndexBuffer(s)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[t]]}},a.GlyphManager=nc,a.ImagePosition=dm,a.LineAtlas=Im,a.LngLat=li,a.LngLatBounds=qo,a.LocalGlyphMode=_m,a.MAX_MERCATOR_LATITUDE=Ss,a.MercatorCoordinate=Xl,a.ONE_EM=xr,a.OverscaledTileID=Nr,a.Properties=Ue,a.RGBAImage=ln,a.Ray=Qp,a.RequestManager=class{constructor(n,t,s){this._transformRequestFn=n,this._customAccessToken=t,this._silenceAuthErrors=!!s,this._createSkuToken()}_createSkuToken(){const n=function(){let t="";for(let s=0;s<10;s++)t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",gs,t].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=n.token,this._skuTokenExpiresAt=n.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(n,t){return this._transformRequestFn&&this._transformRequestFn(n,t)||{url:n}}normalizeStyleURL(n,t){if(!Xr(n))return n;const s=Sr(n);return s.path=`/styles/v1${s.path}`,this._makeAPIURL(s,this._customAccessToken||t)}normalizeGlyphsURL(n,t){if(!Xr(n))return n;const s=Sr(n);return s.path=`/fonts/v1${s.path}`,this._makeAPIURL(s,this._customAccessToken||t)}normalizeSourceURL(n,t,s,c){if(!Xr(n))return n;const f=Sr(n);return f.path=`/v4/${f.authority}.json`,f.params.push("secure"),s&&f.params.push(`language=${s}`),c&&f.params.push(`worldview=${c}`),this._makeAPIURL(f,this._customAccessToken||t)}normalizeSpriteURL(n,t,s,c){const f=Sr(n);return Xr(n)?(f.path=`/styles/v1${f.path}/sprite${t}${s}`,this._makeAPIURL(f,this._customAccessToken||c)):(f.path+=`${t}${s}`,gn(f))}normalizeTileURL(n,t,s){if(this._isSkuTokenExpired()&&this._createSkuToken(),n&&!Xr(n))return n;const c=Sr(n);c.path=c.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${t||s&&c.authority!=="raster"&&s===512?"@2x":""}${Ln.supported?".webp":"$1"}`),c.authority==="raster"?c.path=`/${Dt.RASTER_URL_PREFIX}${c.path}`:(c.path=c.path.replace(/^.+\/v4\//,"/"),c.path=`/${Dt.TILE_URL_VERSION}${c.path}`);const f=this._customAccessToken||function(p){for(const _ of p){const v=_.match(/^access_token=(.*)$/);if(v)return v[1]}return null}(c.params)||Dt.ACCESS_TOKEN;return Dt.REQUIRE_ACCESS_TOKEN&&f&&this._skuToken&&c.params.push(`sku=${this._skuToken}`),this._makeAPIURL(c,f)}canonicalizeTileURL(n,t){const s=Sr(n);if(!s.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!s.path.match(/\.[\w]+$/))return n;let c="mapbox://";s.path.match(/^\/raster\/v1\//)?c+=`raster/${s.path.replace(`/${Dt.RASTER_URL_PREFIX}/`,"")}`:c+=`tiles/${s.path.replace(`/${Dt.TILE_URL_VERSION}/`,"")}`;let f=s.params;return t&&(f=f.filter(p=>!p.match(/^access_token=/))),f.length&&(c+=`?${f.join("&")}`),c}canonicalizeTileset(n,t){const s=!!t&&Xr(t),c=[];for(const f of n.tiles||[])tn(f)?c.push(this.canonicalizeTileURL(f,s)):c.push(f);return c}_makeAPIURL(n,t){const s="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",c=Sr(Dt.API_URL);if(n.protocol=c.protocol,n.authority=c.authority,n.protocol==="http"){const f=n.params.indexOf("secure");f>=0&&n.params.splice(f,1)}if(c.path!=="/"&&(n.path=`${c.path}${n.path}`),!Dt.REQUIRE_ACCESS_TOKEN)return gn(n);if(t=t||Dt.ACCESS_TOKEN,!this._silenceAuthErrors){if(!t)throw new Error(`An API access token is required to use Mapbox GL. ${s}`);if(t[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${s}`)}return n.params=n.params.filter(f=>f.indexOf("access_token")===-1),n.params.push(`access_token=${t||""}`),gn(n)}},a.ResourceType=ye,a.SegmentVector=Xi,a.SourceCache=Ja,a.StencilMode=km,a.StructArrayLayout1ui2=eo,a.StructArrayLayout2f1f2i16=es,a.StructArrayLayout2i4=st,a.StructArrayLayout2ui4=Pr,a.StructArrayLayout3f12=Ai,a.StructArrayLayout3ui6=Zt,a.StructArrayLayout4i8=At,a.StructArrayLayout5f20=yr,a.Texture=sh,a.Tile=Cm,a.Transitionable=ne,a.Uniform1f=Df,a.Uniform1i=class extends no{constructor(n){super(n),this.current=0}set(n,t,s){this.fetchUniformLocation(n,t)&&this.current!==s&&(this.current=s,this.gl.uniform1i(this.location,s))}},a.Uniform2f=class extends no{constructor(n){super(n),this.current=[0,0]}set(n,t,s){this.fetchUniformLocation(n,t)&&(s[0]===this.current[0]&&s[1]===this.current[1]||(this.current=s,this.gl.uniform2f(this.location,s[0],s[1])))}},a.Uniform3f=class extends no{constructor(n){super(n),this.current=[0,0,0]}set(n,t,s){this.fetchUniformLocation(n,t)&&(s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]||(this.current=s,this.gl.uniform3f(this.location,s[0],s[1],s[2])))}},a.Uniform4f=ry,a.UniformColor=ny,a.UniformMatrix2f=class extends no{constructor(n){super(n),this.current=dT}set(n,t,s){if(this.fetchUniformLocation(n,t)){for(let c=0;c<4;c++)if(s[c]!==this.current[c]){this.current=s,this.gl.uniformMatrix2fv(this.location,!1,s);break}}}},a.UniformMatrix3f=class extends no{constructor(n){super(n),this.current=fT}set(n,t,s){if(this.fetchUniformLocation(n,t)){for(let c=0;c<9;c++)if(s[c]!==this.current[c]){this.current=s,this.gl.uniformMatrix3fv(this.location,!1,s);break}}}},a.UniformMatrix4f=class extends no{constructor(n){super(n),this.current=hT}set(n,t,s){if(this.fetchUniformLocation(n,t)){if(s[12]!==this.current[12]||s[0]!==this.current[0])return this.current=s,void this.gl.uniformMatrix4fv(this.location,!1,s);for(let c=1;c<16;c++)if(s[c]!==this.current[c]){this.current=s,this.gl.uniformMatrix4fv(this.location,!1,s);break}}}},a.UnwrappedTileID=Ky,a.ValidationError=ht,a.VectorTileWorkerSource=class extends St{constructor(n,t,s,c,f){super(),this.actor=n,this.layerIndex=t,this.availableImages=s,this.loadVectorData=f||h0,this.loading={},this.loaded={},this.deduped=new u0(n.scheduler),this.isSpriteLoaded=c,this.scheduler=n.scheduler}loadTile(n,t){const s=n.uid,c=n&&n.request,f=c&&c.collectResourceTiming,p=this.loading[s]=new CS(n);p.abort=this.loadVectorData(n,(_,v)=>{const w=!this.loading[s];if(delete this.loading[s],w||_||!v)return p.status="done",w||(this.loaded[s]=p),t(_);const E=v.rawData,M={};v.expires&&(M.expires=v.expires),v.cacheControl&&(M.cacheControl=v.cacheControl),p.vectorTile=v.vectorTile||new Ya.VectorTile(new Xu(E));const C=()=>{p.parse(p.vectorTile,this.layerIndex,this.availableImages,this.actor,(L,O)=>{if(L||!O)return t(L);const z={};if(f){const G=$r(c);G.length>0&&(z.resourceTiming=JSON.parse(JSON.stringify(G)))}t(null,gt({rawTileData:E.slice(0)},O,M,z))})};this.isSpriteLoaded?C():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(C,{type:"parseTile",isSymbolTile:n.isSymbolTile,zoom:n.tileZoom}):C()}),this.loaded=this.loaded||{},this.loaded[s]=p})}reloadTile(n,t){const s=this.loaded,c=n.uid,f=this;if(s&&s[c]){const p=s[c];p.showCollisionBoxes=n.showCollisionBoxes,p.enableTerrain=!!n.enableTerrain,p.projection=n.projection,p.tileTransform=Ka(n.tileID.canonical,n.projection);const _=(v,w)=>{const E=p.reloadCallback;E&&(delete p.reloadCallback,p.parse(p.vectorTile,f.layerIndex,this.availableImages,f.actor,E)),t(v,w)};p.status==="parsing"?p.reloadCallback=_:p.status==="done"&&(p.vectorTile?p.parse(p.vectorTile,this.layerIndex,this.availableImages,this.actor,_):_())}}abortTile(n,t){const s=n.uid,c=this.loading[s];c&&(c.abort&&c.abort(),delete this.loading[s]),t()}removeTile(n,t){const s=this.loaded,c=n.uid;s&&s[c]&&delete s[c],t()}},a.WritingMode=wn,a.ZoomHistory=xf,a.add=Xo,a.addDynamicAttributes=dd,a.adjoint=function(n,t){var s=t[0],c=t[1],f=t[2],p=t[3],_=t[4],v=t[5],w=t[6],E=t[7],M=t[8];return n[0]=_*M-v*E,n[1]=f*E-c*M,n[2]=c*v-f*_,n[3]=v*w-p*M,n[4]=s*M-f*w,n[5]=f*p-s*v,n[6]=p*E-_*w,n[7]=c*w-s*E,n[8]=s*_-c*p,n},a.asyncAll=mt,a.bezier=$e,a.bindAll=Or,a.boundsAttributes=Hv,a.bufferConvexPolygon=function(n,t){const s=[];for(let c=0;c<n.length;c++){const f=bt(c-1,-1,n.length-1),p=bt(c+1,-1,n.length-1),_=n[c],v=n[p],w=n[f].sub(_).unit(),E=v.sub(_).unit(),M=E.angleWithSep(w.x,w.y),C=w.add(E).unit().mult(-1*t/Math.sin(M/2));s.push(_.add(C))}return s},a.cacheEntryPossiblyAdded=function(n){ae++,ae>Io&&(n.getActor().send("enforceCacheSizeLimit",ys),ae=0)},a.calculateGlobeLabelMatrix=function(n,t){const{x:s,y:c}=n.point,f=zv(s,c,n.worldSize/n._pixelsPerMercatorPixel,0,0);return Yl(f,f,Em(Ps(t)))},a.calculateGlobeMatrix=function(n){const{x:t,y:s}=n.point,{lng:c,lat:f}=n._center;return zv(t,s,n.worldSize,c,f)},a.calculateGlobeMercatorMatrix=function(n){const t=n.pixelsPerMeter,s=t/Bn(1,n.center.lat),c=As(new Float64Array(16));return Du(c,c,[n.point.x,n.point.y,0]),qa(c,c,[s,s,t]),Float32Array.from(c)},a.circumferenceAtLatitude=Np,a.clamp=Re,a.clearTileCache=function(n){const t=ie(),s=[];for(const c in nr)t&&s.push(t.delete(c)),delete nr[c];n&&Promise.all(s).catch(n).then(()=>n())},a.clipLine=wv,a.clone=function(n){var t=new an(16);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],t},a.clone$1=Dr,a.collisionCircleLayout=EE,a.config=Dt,a.conjugate=function(n,t){return n[0]=-t[0],n[1]=-t[1],n[2]=-t[2],n[3]=t[3],n},a.create=function(){var n=new an(16);return an!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n},a.create$1=yy,a.createExpression=Fo,a.createLayout=We,a.createStyleLayer=function(n){return n.type==="custom"?new bS(n):new TS[n.type](n)},a.cross=Jp,a.degToRad=fe,a.distance=function(n,t){return Math.hypot(t[0]-n[0],t[1]-n[1],t[2]-n[2])},a.div=function(n,t,s){return n[0]=t[0]/s[0],n[1]=t[1]/s[1],n[2]=t[2]/s[2],n},a.dot=Nn,a.ease=Ve,a.easeCubicInOut=ke,a.emitValidationErrors=Tu,a.endsWith=ds,a.enforceCacheSizeLimit=function(n){for(const t in nr)B(t),nr[t].then(s=>{s.keys().then(c=>{for(let f=0;f<c.length-n;f++)s.delete(c[f])})})},a.evaluateSizeForFeature=Qf,a.evaluateSizeForZoom=ec,a.evaluateVariableOffset=Mv,a.evented=U,a.exactEquals=function(n,t){return n[0]===t[0]&&n[1]===t[1]&&n[2]===t[2]&&n[3]===t[3]},a.exactEquals$1=function(n,t){return n[0]===t[0]&&n[1]===t[1]&&n[2]===t[2]},a.exported=Er,a.exported$1=Ln,a.extend=gt,a.extend$1=Ei,a.fillExtrusionHeightLift=Xy,a.filterObject=Wn,a.fromMat4=function(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[4],n[4]=t[5],n[5]=t[6],n[6]=t[8],n[7]=t[9],n[8]=t[10],n},a.fromQuat=function(n,t){var s=t[0],c=t[1],f=t[2],p=t[3],_=s+s,v=c+c,w=f+f,E=s*_,M=c*_,C=c*v,L=f*_,O=f*v,z=f*w,G=p*_,q=p*v,re=p*w;return n[0]=1-C-z,n[1]=M+re,n[2]=L-q,n[3]=0,n[4]=M-re,n[5]=1-E-z,n[6]=O+G,n[7]=0,n[8]=L+q,n[9]=O-G,n[10]=1-E-C,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},a.fromRotation=function(n,t){var s=Math.sin(t),c=Math.cos(t);return n[0]=c,n[1]=s,n[2]=0,n[3]=-s,n[4]=c,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},a.fromScaling=vy,a.furthestTileCorner=function(n){const t=Math.round((n+45+360)%360/90)%4;return Ce[t]},a.getAABBPointSquareDist=function(n,t,s){let c=0;for(let f=0;f<2;++f){const p=s?s[f]:0;n[f]>p&&(c+=(n[f]-p)*(n[f]-p)),t[f]<p&&(c+=(p-t[f])*(p-t[f]))}return c},a.getAnchorAlignment=gm,a.getAnchorJustification=vm,a.getBounds=function(n){let t=1/0,s=1/0,c=-1/0,f=-1/0;for(const p of n)t=Math.min(t,p.x),s=Math.min(s,p.y),c=Math.max(c,p.x),f=Math.max(f,p.y);return{min:new F(t,s),max:new F(c,f)}},a.getColumn=zr,a.getGridMatrix=function(n,t,s){const c=t.getNorth(),f=t.getSouth(),p=t.getWest(),_=.015625;return[0,(t.getEast()-p)*_,1<<n.z,(f-c)/oc[s],0,n.y,c,p,_]},a.getImage=Pt,a.getJSON=function(n,t){return be(gt(n,{type:"json"}),t)},a.getLatitudinalLod=function(n){const t=80.051129;n=Re(n,-80.051129,t)/t*90;const s=Math.pow(Math.abs(Math.sin(fe(n))),3);return Math.round(s*(oc.length-1))},a.getMapSessionAPI=Po,a.getPerformanceMeasurement=$r,a.getProjection=Zv,a.getRTLTextPluginStatus=Z,a.getReferrer=Te,a.getTilePoint=function(n,{x:t,y:s},c=0){return new F(((t-c)*n.scale-n.x)*It,(s*n.scale-n.y)*It)},a.getTileVec3=function(n,t,s=0){return Kl(((t.x-s)*n.scale-n.x)*It,(t.y*n.scale-n.y)*It,ay(t.z,t.y))},a.getVideo=function(n,t){const s=P.document.createElement("video");s.muted=!0,s.onloadstart=function(){t(null,s)};for(let c=0;c<n.length;c++){const f=P.document.createElement("source");Ke(n[c])||(s.crossOrigin="Anonymous"),f.src=n[c],s.appendChild(f)}return{cancel:()=>{}}},a.globeCenterToScreenPoint=function(n){const t=[0,0,0],s=As(new Float64Array(16));return Yl(s,n.pixelMatrix,n.globeMatrix),Yi(t,t,s),new F(t[0],t[1])},a.globeDenormalizeECEF=Em,a.globeECEFOrigin=function(n,t){const s=[0,0,0];return Yi(s,s,Qu(Ps(t.canonical))),Yi(s,s,n),s},a.globeNormalizeECEF=Qu,a.globePixelsToTileUnits=function(n,t){return It/(512*Math.pow(2,n))*ld(Ps(t))},a.globePoleMatrixForTile=function(n,t,s){const c=As(new Float64Array(16)),f=(t/(1<<n)-.5)*Math.PI*2;return jf(c,s.globeMatrix,f),Float32Array.from(c)},a.globeTileBounds=Ps,a.globeTiltAtLngLat=Bv,a.globeToMercatorTransition=eh,a.globeUseCustomAntiAliasing=function(n,t,s){const c=eh(s.zoom),f=n.style.map._antialias,p=!!t.extStandardDerivatives,_=t.extStandardDerivativesForceOff||n.terrain&&n.terrain.exaggeration()>0;return c===0&&!f&&!_&&p},a.identity=As,a.identity$1=Ay,a.invert=Wp,a.isFullscreen=function(){return!!P.document.fullscreenElement||!!P.document.webkitFullscreenElement},a.isLngLatBehindGlobe=function(n,t){return Bv(n,t)>Math.PI/2*1.01},a.isMapAuthenticated=function(n){return rn.has(n)},a.isMapboxURL=Xr,a.isSafariWithAntialiasingBug=function(n){const t=n.navigator?n.navigator.userAgent:null;return!!yi(n)&&t&&(t.match("Version/15.4")||t.match("Version/15.5")||t.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},a.latFromMercatorY=vr,a.len=CT,a.length=zu,a.length$1=function(n){return Math.hypot(n[0],n[1],n[2],n[3])},a.loadVectorTile=h0,a.makeRequest=be,a.mapValue=function(n,t,s,c,f){return Re((n-t)/(s-t)*(f-c)+c,c,f)},a.mercatorScale=ly,a.mercatorXfromLng=Es,a.mercatorYfromLat=oo,a.mercatorZfromAltitude=Bn,a.mul=PT,a.mul$1=IT,a.multiply=Yl,a.multiply$1=function(n,t,s){var c=t[0],f=t[1],p=t[2],_=t[3],v=t[4],w=t[5],E=t[6],M=t[7],C=t[8],L=s[0],O=s[1],z=s[2],G=s[3],q=s[4],re=s[5],he=s[6],se=s[7],le=s[8];return n[0]=L*c+O*_+z*E,n[1]=L*f+O*v+z*M,n[2]=L*p+O*w+z*C,n[3]=G*c+q*_+re*E,n[4]=G*f+q*v+re*M,n[5]=G*p+q*w+re*C,n[6]=he*c+se*_+le*E,n[7]=he*f+se*v+le*M,n[8]=he*p+se*w+le*C,n},a.multiply$2=wy,a.nextPowerOfTwo=Ki,a.normalize=Fr,a.normalize$1=function(n,t){var s=t[0],c=t[1],f=t[2],p=t[3],_=s*s+c*c+f*f+p*p;return _>0&&(_=1/Math.sqrt(_)),n[0]=s*_,n[1]=c*_,n[2]=f*_,n[3]=p*_,n},a.number=Qt,a.ortho=function(n,t,s,c,f,p,_){var v=1/(t-s),w=1/(c-f),E=1/(p-_);return n[0]=-2*v,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*w,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*E,n[11]=0,n[12]=(t+s)*v,n[13]=(f+c)*w,n[14]=(_+p)*E,n[15]=1,n},a.pbf=Xu,a.perspective=function(n,t,s,c,f){var p,_=1/Math.tan(t/2);return n[0]=_/s,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=_,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,f!=null&&f!==1/0?(n[10]=(f+c)*(p=1/(c-f)),n[14]=2*f*c*p):(n[10]=-1,n[14]=-2*c),n},a.pick=function(n,t){const s={};for(let c=0;c<t.length;c++){const f=t[c];f in n&&(s[f]=n[f])}return s},a.plugin=H,a.pointGeometry=F,a.polygonContainsPoint=Wa,a.polygonIntersectsBox=my,a.polygonIntersectsPolygon=hy,a.polygonizeBounds=function(n,t,s=0,c=!0){const f=new F(s,s),p=n.sub(f),_=t.add(f),v=[p,new F(_.x,p.y),_,new F(p.x,_.y)];return c&&v.push(p.clone()),v},a.posAttributes=Ku,a.postMapLoadEvent=Mo,a.postTurnstileEvent=kn,a.potpack=fm,a.prevPowerOfTwo=function(n){return n<=1?1:Math.pow(2,Math.floor(Math.log(n)/Math.LN2))},a.radToDeg=Ee,a.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],a.registerForPluginStateChange=function(n){return n({pluginStatus:A,pluginURL:I}),U.on("pluginStateChange",n),n},a.removeAuthState=function(n){rn.delete(n)},a.renderColorRamp=rm,a.resample=cy,a.rotateX=qp,a.rotateX$1=My,a.rotateY=jf,a.rotateY$1=Py,a.rotateZ=function(n,t,s){var c=Math.sin(s),f=Math.cos(s),p=t[0],_=t[1],v=t[2],w=t[3],E=t[4],M=t[5],C=t[6],L=t[7];return t!==n&&(n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[0]=p*f+E*c,n[1]=_*f+M*c,n[2]=v*f+C*c,n[3]=w*f+L*c,n[4]=E*f-p*c,n[5]=M*f-_*c,n[6]=C*f-v*c,n[7]=L*f-w*c,n},a.rotateZ$1=function(n,t,s){s*=.5;var c=t[0],f=t[1],p=t[2],_=t[3],v=Math.sin(s),w=Math.cos(s);return n[0]=c*w+f*v,n[1]=f*w-c*v,n[2]=p*w+_*v,n[3]=_*w-p*v,n},a.scale=qa,a.scale$1=Ey,a.scale$2=rs,a.scaleAndAdd=Vf,a.setCacheLimits=function(n,t){ys=n,Io=t},a.setColumn=function(n,t,s){n[4*t+0]=s[0],n[4*t+1]=s[1],n[4*t+2]=s[2],n[4*t+3]=s[3]},a.setRTLTextPlugin=function(n,t,s=!1){if(A===g||A===x||A===b)throw new Error("setRTLTextPlugin cannot be called multiple times.");I=Er.resolveURL(n),A=g,S=t,R(),s||J()},a.smoothstep=ot,a.spec=Fe,a.storeAuthState=function(n,t){t?rn.add(n):rn.delete(n)},a.sub=ns,a.subtract=Hp,a.symbolSize=SE,a.tileAABB=function(n,t,s,c,f,p,_,v,w){if(w.name==="globe")return nS(n,t,new Yf(s,c,f));const E=Ka({z:s,x:c,y:f},w);return new Yr([(p+E.x/E.scale)*t,t*(E.y/E.scale),_],[(p+E.x2/E.scale)*t,t*(E.y2/E.scale),v])},a.tileCornersToBounds=od,a.tileTransform=Ka,a.transformMat3=function(n,t,s){var c=t[0],f=t[1],p=t[2];return n[0]=c*s[0]+f*s[3]+p*s[6],n[1]=c*s[1]+f*s[4]+p*s[7],n[2]=c*s[2]+f*s[5]+p*s[8],n},a.transformMat4=Yi,a.transformMat4$1=Xa,a.transformQuat=Ty,a.transitionTileAABBinECEF=Rv,a.translate=Du,a.transpose=function(n,t){if(n===t){var s=t[1],c=t[2],f=t[5];n[1]=t[3],n[2]=t[6],n[3]=s,n[5]=t[7],n[6]=c,n[7]=f}else n[0]=t[0],n[1]=t[3],n[2]=t[6],n[3]=t[1],n[4]=t[4],n[5]=t[7],n[6]=t[2],n[7]=t[5],n[8]=t[8];return n},a.triggerPluginCompletionEvent=k,a.uniqueId=Xt,a.updateGlobeVertexNormal=function(n,t,s,c,f){const p=5*t+2;n.float32[p+0]=s,n.float32[p+1]=c,n.float32[p+2]=f},a.validateCustomStyleLayer=function(n){const t=[],s=n.id;return s===void 0&&t.push({message:`layers.${s}: missing required property "id"`}),n.render===void 0&&t.push({message:`layers.${s}: missing required method "render"`}),n.renderingMode&&n.renderingMode!=="2d"&&n.renderingMode!=="3d"&&t.push({message:`layers.${s}: property "renderingMode" must be either "2d" or "3d"`}),t},a.validateFilter=n=>Qn(jo(n)),a.validateFog=n=>Qn(gf(n)),a.validateLayer=n=>Qn(Bl(n)),a.validateLight=n=>Qn(mf(n)),a.validateSource=n=>Qn(pf(n)),a.validateStyle=Ul,a.validateTerrain=n=>Qn(Nl(n)),a.values=Mt,a.vectorTile=Ya,a.version=Wr,a.warnOnce=Ci,a.window=P,a.wrap=bt}),y(["./shared"],function(a){function P(ie){if(typeof ie=="number"||typeof ie=="boolean"||typeof ie=="string"||ie==null)return JSON.stringify(ie);if(Array.isArray(ie)){let V="[";for(const te of ie)V+=`${P(te)},`;return`${V}]`}let B="{";for(const V of Object.keys(ie).sort())B+=`${V}:${P(ie[V])},`;return`${B}}`}function D(ie){let B="";for(const V of a.refProperties)B+=`/${P(ie[V])}`;return B}class N{constructor(B){this.keyCache={},B&&this.replace(B)}replace(B){this._layerConfigs={},this._layers={},this.update(B,[])}update(B,V){for(const ae of B)this._layerConfigs[ae.id]=ae,(this._layers[ae.id]=a.createStyleLayer(ae)).compileFilter(),this.keyCache[ae.id]&&delete this.keyCache[ae.id];for(const ae of V)delete this.keyCache[ae],delete this._layerConfigs[ae],delete this._layers[ae];this.familiesBySource={};const te=function(ae,ye){const Se={};for(let be=0;be<ae.length;be++){const Me=ye&&ye[ae[be].id]||D(ae[be]);ye&&(ye[ae[be].id]=Me);let Xe=Se[Me];Xe||(Xe=Se[Me]=[]),Xe.push(ae[be])}const Te=[];for(const be in Se)Te.push(Se[be]);return Te}(a.values(this._layerConfigs),this.keyCache);for(const ae of te){const ye=ae.map(lt=>this._layers[lt.id]),Se=ye[0];if(Se.visibility==="none")continue;const Te=Se.source||"";let be=this.familiesBySource[Te];be||(be=this.familiesBySource[Te]={});const Me=Se.sourceLayer||"_geojsonTileLayer";let Xe=be[Me];Xe||(Xe=be[Me]=[]),Xe.push(ye)}}}class F{loadTile(B,V){const{uid:te,encoding:ae,rawImageData:ye,padding:Se,buildQuadTree:Te}=B,be=a.window.ImageBitmap&&ye instanceof a.window.ImageBitmap?this.getImageData(ye,Se):ye;V(null,new a.DEMData(te,be,ae,Se<1,Te))}getImageData(B,V){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(B.width,B.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=B.width,this.offscreenCanvas.height=B.height,this.offscreenCanvasContext.drawImage(B,0,0,B.width,B.height);const te=this.offscreenCanvasContext.getImageData(-V,-V,B.width+2*V,B.height+2*V);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),te}}var W=function ie(B,V){var te,ae=B&&B.type;if(ae==="FeatureCollection")for(te=0;te<B.features.length;te++)ie(B.features[te],V);else if(ae==="GeometryCollection")for(te=0;te<B.geometries.length;te++)ie(B.geometries[te],V);else if(ae==="Feature")ie(B.geometry,V);else if(ae==="Polygon")oe(B.coordinates,V);else if(ae==="MultiPolygon")for(te=0;te<B.coordinates.length;te++)oe(B.coordinates[te],V);return B};function oe(ie,B){if(ie.length!==0){me(ie[0],B);for(var V=1;V<ie.length;V++)me(ie[V],!B)}}function me(ie,B){for(var V=0,te=0,ae=0,ye=ie.length,Se=ye-1;ae<ye;Se=ae++){var Te=(ie[ae][0]-ie[Se][0])*(ie[Se][1]+ie[ae][1]),be=V+Te;te+=Math.abs(V)>=Math.abs(Te)?V-be+Te:Te-be+V,V=be}V+te>=0!=!!B&&ie.reverse()}const fe=a.vectorTile.VectorTileFeature.prototype.toGeoJSON;class Ee{constructor(B){this._feature=B,this.extent=a.EXTENT,this.type=B.type,this.properties=B.tags,"id"in B&&!isNaN(B.id)&&(this.id=parseInt(B.id,10))}loadGeometry(){if(this._feature.type===1){const B=[];for(const V of this._feature.geometry)B.push([new a.pointGeometry(V[0],V[1])]);return B}{const B=[];for(const V of this._feature.geometry){const te=[];for(const ae of V)te.push(new a.pointGeometry(ae[0],ae[1]));B.push(te)}return B}}toGeoJSON(B,V,te){return fe.call(this,B,V,te)}}class Ce{constructor(B){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=a.EXTENT,this.length=B.length,this._features=B}feature(B){return new Ee(this._features[B])}}var ke=a.vectorTile.VectorTileFeature,$e=Ve;function Ve(ie,B){this.options=B||{},this.features=ie,this.length=ie.length}function Re(ie,B){this.id=typeof ie.id=="number"?ie.id:void 0,this.type=ie.type,this.rawGeometry=ie.type===1?[ie.geometry]:ie.geometry,this.properties=ie.tags,this.extent=B||4096}Ve.prototype.feature=function(ie){return new Re(this.features[ie],this.options.extent)},Re.prototype.loadGeometry=function(){var ie=this.rawGeometry;this.geometry=[];for(var B=0;B<ie.length;B++){for(var V=ie[B],te=[],ae=0;ae<V.length;ae++)te.push(new a.pointGeometry(V[ae][0],V[ae][1]));this.geometry.push(te)}return this.geometry},Re.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ie=this.geometry,B=1/0,V=-1/0,te=1/0,ae=-1/0,ye=0;ye<ie.length;ye++)for(var Se=ie[ye],Te=0;Te<Se.length;Te++){var be=Se[Te];B=Math.min(B,be.x),V=Math.max(V,be.x),te=Math.min(te,be.y),ae=Math.max(ae,be.y)}return[B,te,V,ae]},Re.prototype.toGeoJSON=ke.prototype.toGeoJSON;var ot=mt,bt=$e;function mt(ie){var B=new a.pbf;return function(V,te){for(var ae in V.layers)te.writeMessage(3,Mt,V.layers[ae])}(ie,B),B.finish()}function Mt(ie,B){var V;B.writeVarintField(15,ie.version||1),B.writeStringField(1,ie.name||""),B.writeVarintField(5,ie.extent||4096);var te={keys:[],values:[],keycache:{},valuecache:{}};for(V=0;V<ie.length;V++)te.feature=ie.feature(V),B.writeMessage(2,gt,te);var ae=te.keys;for(V=0;V<ae.length;V++)B.writeStringField(3,ae[V]);var ye=te.values;for(V=0;V<ye.length;V++)B.writeMessage(4,$n,ye[V])}function gt(ie,B){var V=ie.feature;V.id!==void 0&&B.writeVarintField(1,V.id),B.writeMessage(2,Ht,ie),B.writeVarintField(3,V.type),B.writeMessage(4,Ki,V)}function Ht(ie,B){var V=ie.feature,te=ie.keys,ae=ie.values,ye=ie.keycache,Se=ie.valuecache;for(var Te in V.properties){var be=V.properties[Te],Me=ye[Te];if(be!==null){Me===void 0&&(te.push(Te),ye[Te]=Me=te.length-1),B.writeVarint(Me);var Xe=typeof be;Xe!=="string"&&Xe!=="boolean"&&Xe!=="number"&&(be=JSON.stringify(be));var lt=Xe+":"+be,Ke=Se[lt];Ke===void 0&&(ae.push(be),Se[lt]=Ke=ae.length-1),B.writeVarint(Ke)}}}function Xt(ie,B){return(B<<3)+(7&ie)}function jt(ie){return ie<<1^ie>>31}function Ki(ie,B){for(var V=ie.loadGeometry(),te=ie.type,ae=0,ye=0,Se=V.length,Te=0;Te<Se;Te++){var be=V[Te],Me=1;te===1&&(Me=be.length),B.writeVarint(Xt(1,Me));for(var Xe=te===3?be.length-1:be.length,lt=0;lt<Xe;lt++){lt===1&&te!==1&&B.writeVarint(Xt(2,Xe-1));var Ke=be[lt].x-ae,Tt=be[lt].y-ye;B.writeVarint(jt(Ke)),B.writeVarint(jt(Tt)),ae+=Ke,ye+=Tt}te===3&&B.writeVarint(Xt(7,1))}}function $n(ie,B){var V=typeof ie;V==="string"?B.writeStringField(1,ie):V==="boolean"?B.writeBooleanField(7,ie):V==="number"&&(ie%1!=0?B.writeDoubleField(3,ie):ie<0?B.writeSVarintField(6,ie):B.writeVarintField(5,ie))}function Or(ie,B,V,te,ae,ye){if(ae-te<=V)return;const Se=te+ae>>1;ds(ie,B,Se,te,ae,ye%2),Or(ie,B,V,te,Se-1,ye+1),Or(ie,B,V,Se+1,ae,ye+1)}function ds(ie,B,V,te,ae,ye){for(;ae>te;){if(ae-te>600){const Me=ae-te+1,Xe=V-te+1,lt=Math.log(Me),Ke=.5*Math.exp(2*lt/3),Tt=.5*Math.sqrt(lt*Ke*(Me-Ke)/Me)*(Xe-Me/2<0?-1:1);ds(ie,B,V,Math.max(te,Math.floor(V-Xe*Ke/Me+Tt)),Math.min(ae,Math.floor(V+(Me-Xe)*Ke/Me+Tt)),ye)}const Se=B[2*V+ye];let Te=te,be=ae;for(Zr(ie,B,te,V),B[2*ae+ye]>Se&&Zr(ie,B,te,ae);Te<be;){for(Zr(ie,B,Te,be),Te++,be--;B[2*Te+ye]<Se;)Te++;for(;B[2*be+ye]>Se;)be--}B[2*te+ye]===Se?Zr(ie,B,te,be):(be++,Zr(ie,B,be,ae)),be<=V&&(te=be+1),V<=be&&(ae=be-1)}}function Zr(ie,B,V,te){Wn(ie,V,te),Wn(B,2*V,2*te),Wn(B,2*V+1,2*te+1)}function Wn(ie,B,V){const te=ie[B];ie[B]=ie[V],ie[V]=te}function Dr(ie,B,V,te){const ae=ie-V,ye=B-te;return ae*ae+ye*ye}ot.fromVectorTileJs=mt,ot.fromGeojsonVt=function(ie,B){B=B||{};var V={};for(var te in ie)V[te]=new $e(ie[te].features,B),V[te].name=te,V[te].version=B.version,V[te].extent=B.extent;return mt({layers:V})},ot.GeoJSONWrapper=bt;const hn=ie=>ie[0],Ci=ie=>ie[1];class $i{constructor(B,V=hn,te=Ci,ae=64,ye=Float64Array){this.nodeSize=ae,this.points=B;const Se=B.length<65536?Uint16Array:Uint32Array,Te=this.ids=new Se(B.length),be=this.coords=new ye(2*B.length);for(let Me=0;Me<B.length;Me++)Te[Me]=Me,be[2*Me]=V(B[Me]),be[2*Me+1]=te(B[Me]);Or(Te,be,ae,0,Te.length-1,0)}range(B,V,te,ae){return function(ye,Se,Te,be,Me,Xe,lt){const Ke=[0,ye.length-1,0],Tt=[];let Et,_t;for(;Ke.length;){const Pt=Ke.pop(),Bt=Ke.pop(),Jt=Ke.pop();if(Bt-Jt<=lt){for(let St=Jt;St<=Bt;St++)Et=Se[2*St],_t=Se[2*St+1],Et>=Te&&Et<=Me&&_t>=be&&_t<=Xe&&Tt.push(ye[St]);continue}const ri=Math.floor((Jt+Bt)/2);Et=Se[2*ri],_t=Se[2*ri+1],Et>=Te&&Et<=Me&&_t>=be&&_t<=Xe&&Tt.push(ye[ri]);const ni=(Pt+1)%2;(Pt===0?Te<=Et:be<=_t)&&(Ke.push(Jt),Ke.push(ri-1),Ke.push(ni)),(Pt===0?Me>=Et:Xe>=_t)&&(Ke.push(ri+1),Ke.push(Bt),Ke.push(ni))}return Tt}(this.ids,this.coords,B,V,te,ae,this.nodeSize)}within(B,V,te){return function(ae,ye,Se,Te,be,Me){const Xe=[0,ae.length-1,0],lt=[],Ke=be*be;for(;Xe.length;){const Tt=Xe.pop(),Et=Xe.pop(),_t=Xe.pop();if(Et-_t<=Me){for(let ni=_t;ni<=Et;ni++)Dr(ye[2*ni],ye[2*ni+1],Se,Te)<=Ke&&lt.push(ae[ni]);continue}const Pt=Math.floor((_t+Et)/2),Bt=ye[2*Pt],Jt=ye[2*Pt+1];Dr(Bt,Jt,Se,Te)<=Ke&&lt.push(ae[Pt]);const ri=(Tt+1)%2;(Tt===0?Se-be<=Bt:Te-be<=Jt)&&(Xe.push(_t),Xe.push(Pt-1),Xe.push(ri)),(Tt===0?Se+be>=Bt:Te+be>=Jt)&&(Xe.push(Pt+1),Xe.push(Et),Xe.push(ri))}return lt}(this.ids,this.coords,B,V,te,this.nodeSize)}}const fn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ie=>ie},wr=Math.fround||(Li=new Float32Array(1),ie=>(Li[0]=+ie,Li[0]));var Li;class rr{constructor(B){this.options=qi(Object.create(fn),B),this.trees=new Array(this.options.maxZoom+1)}load(B){const{log:V,minZoom:te,maxZoom:ae,nodeSize:ye}=this.options;V&&console.time("total time");const Se=`prepare ${B.length} points`;V&&console.time(Se),this.points=B;let Te=[];for(let be=0;be<B.length;be++)B[be].geometry&&Te.push(Wi(B[be],be));this.trees[ae+1]=new $i(Te,Tr,qr,ye,Float32Array),V&&console.timeEnd(Se);for(let be=ae;be>=te;be--){const Me=+Date.now();Te=this._cluster(Te,be),this.trees[be]=new $i(Te,Tr,qr,ye,Float32Array),V&&console.log("z%d: %d clusters in %dms",be,Te.length,+Date.now()-Me)}return V&&console.timeEnd("total time"),this}getClusters(B,V){let te=((B[0]+180)%360+360)%360-180;const ae=Math.max(-90,Math.min(90,B[1]));let ye=B[2]===180?180:((B[2]+180)%360+360)%360-180;const Se=Math.max(-90,Math.min(90,B[3]));if(B[2]-B[0]>=360)te=-180,ye=180;else if(te>ye){const Xe=this.getClusters([te,ae,180,Se],V),lt=this.getClusters([-180,ae,ye,Se],V);return Xe.concat(lt)}const Te=this.trees[this._limitZoom(V)],be=Te.range($r(te),Wr(Se),$r(ye),Wr(ae)),Me=[];for(const Xe of be){const lt=Te.points[Xe];Me.push(lt.numPoints?zr(lt):this.points[lt.index])}return Me}getChildren(B){const V=this._getOriginId(B),te=this._getOriginZoom(B),ae="No cluster with the specified id.",ye=this.trees[te];if(!ye)throw new Error(ae);const Se=ye.points[V];if(!Se)throw new Error(ae);const Te=this.options.radius/(this.options.extent*Math.pow(2,te-1)),be=ye.within(Se.x,Se.y,Te),Me=[];for(const Xe of be){const lt=ye.points[Xe];lt.parentId===B&&Me.push(lt.numPoints?zr(lt):this.points[lt.index])}if(Me.length===0)throw new Error(ae);return Me}getLeaves(B,V,te){const ae=[];return this._appendLeaves(ae,B,V=V||10,te=te||0,0),ae}getTile(B,V,te){const ae=this.trees[this._limitZoom(B)],ye=Math.pow(2,B),{extent:Se,radius:Te}=this.options,be=Te/Se,Me=(te-be)/ye,Xe=(te+1+be)/ye,lt={features:[]};return this._addTileFeatures(ae.range((V-be)/ye,Me,(V+1+be)/ye,Xe),ae.points,V,te,ye,lt),V===0&&this._addTileFeatures(ae.range(1-be/ye,Me,1,Xe),ae.points,ye,te,ye,lt),V===ye-1&&this._addTileFeatures(ae.range(0,Me,be/ye,Xe),ae.points,-1,te,ye,lt),lt.features.length?lt:null}getClusterExpansionZoom(B){let V=this._getOriginZoom(B)-1;for(;V<=this.options.maxZoom;){const te=this.getChildren(B);if(V++,te.length!==1)break;B=te[0].properties.cluster_id}return V}_appendLeaves(B,V,te,ae,ye){const Se=this.getChildren(V);for(const Te of Se){const be=Te.properties;if(be&&be.cluster?ye+be.point_count<=ae?ye+=be.point_count:ye=this._appendLeaves(B,be.cluster_id,te,ae,ye):ye<ae?ye++:B.push(Te),B.length===te)break}return ye}_addTileFeatures(B,V,te,ae,ye,Se){for(const Te of B){const be=V[Te],Me=be.numPoints;let Xe,lt,Ke;if(Me)Xe=Cn(be),lt=be.x,Ke=be.y;else{const _t=this.points[be.index];Xe=_t.properties,lt=$r(_t.geometry.coordinates[0]),Ke=Wr(_t.geometry.coordinates[1])}const Tt={type:1,geometry:[[Math.round(this.options.extent*(lt*ye-te)),Math.round(this.options.extent*(Ke*ye-ae))]],tags:Xe};let Et;Me?Et=be.id:this.options.generateId?Et=be.index:this.points[be.index].id&&(Et=this.points[be.index].id),Et!==void 0&&(Tt.id=Et),Se.features.push(Tt)}}_limitZoom(B){return Math.max(this.options.minZoom,Math.min(+B,this.options.maxZoom+1))}_cluster(B,V){const te=[],{radius:ae,extent:ye,reduce:Se,minPoints:Te}=this.options,be=ae/(ye*Math.pow(2,V));for(let Me=0;Me<B.length;Me++){const Xe=B[Me];if(Xe.zoom<=V)continue;Xe.zoom=V;const lt=this.trees[V+1],Ke=lt.within(Xe.x,Xe.y,be),Tt=Xe.numPoints||1;let Et=Tt;for(const _t of Ke){const Pt=lt.points[_t];Pt.zoom>V&&(Et+=Pt.numPoints||1)}if(Et>Tt&&Et>=Te){let _t=Xe.x*Tt,Pt=Xe.y*Tt,Bt=Se&&Tt>1?this._map(Xe,!0):null;const Jt=(Me<<5)+(V+1)+this.points.length;for(const ri of Ke){const ni=lt.points[ri];if(ni.zoom<=V)continue;ni.zoom=V;const St=ni.numPoints||1;_t+=ni.x*St,Pt+=ni.y*St,ni.parentId=Jt,Se&&(Bt||(Bt=this._map(Xe,!0)),Se(Bt,this._map(ni)))}Xe.parentId=Jt,te.push(yi(_t/Et,Pt/Et,Jt,Et,Bt))}else if(te.push(Xe),Et>1)for(const _t of Ke){const Pt=lt.points[_t];Pt.zoom<=V||(Pt.zoom=V,te.push(Pt))}}return te}_getOriginId(B){return B-this.points.length>>5}_getOriginZoom(B){return(B-this.points.length)%32}_map(B,V){if(B.numPoints)return V?qi({},B.properties):B.properties;const te=this.points[B.index].properties,ae=this.options.map(te);return V&&ae===te?qi({},ae):ae}}function yi(ie,B,V,te,ae){return{x:wr(ie),y:wr(B),zoom:1/0,id:V,parentId:-1,numPoints:te,properties:ae}}function Wi(ie,B){const[V,te]=ie.geometry.coordinates;return{x:wr($r(V)),y:wr(Wr(te)),zoom:1/0,index:B,parentId:-1}}function zr(ie){return{type:"Feature",id:ie.id,properties:Cn(ie),geometry:{type:"Point",coordinates:[(B=ie.x,360*(B-.5)),$t(ie.y)]}};var B}function Cn(ie){const B=ie.numPoints,V=B>=1e4?`${Math.round(B/1e3)}k`:B>=1e3?Math.round(B/100)/10+"k":B;return qi(qi({},ie.properties),{cluster:!0,cluster_id:ie.id,point_count:B,point_count_abbreviated:V})}function $r(ie){return ie/360+.5}function Wr(ie){const B=Math.sin(ie*Math.PI/180),V=.5-.25*Math.log((1+B)/(1-B))/Math.PI;return V<0?0:V>1?1:V}function $t(ie){const B=(180-360*ie)*Math.PI/180;return 360*Math.atan(Math.exp(B))/Math.PI-90}function qi(ie,B){for(const V in B)ie[V]=B[V];return ie}function Tr(ie){return ie.x}function qr(ie){return ie.y}function Er(ie,B,V,te){for(var ae,ye=te,Se=V-B>>1,Te=V-B,be=ie[B],Me=ie[B+1],Xe=ie[V],lt=ie[V+1],Ke=B+3;Ke<V;Ke+=3){var Tt=dn(ie[Ke],ie[Ke+1],be,Me,Xe,lt);if(Tt>ye)ae=Ke,ye=Tt;else if(Tt===ye){var Et=Math.abs(Ke-Se);Et<Te&&(ae=Ke,Te=Et)}}ye>te&&(ae-B>3&&Er(ie,B,ae,te),ie[ae+2]=ye,V-ae>3&&Er(ie,ae,V,te))}function dn(ie,B,V,te,ae,ye){var Se=ae-V,Te=ye-te;if(Se!==0||Te!==0){var be=((ie-V)*Se+(B-te)*Te)/(Se*Se+Te*Te);be>1?(V=ae,te=ye):be>0&&(V+=Se*be,te+=Te*be)}return(Se=ie-V)*Se+(Te=B-te)*Te}function Dt(ie,B,V,te){var ae={id:ie===void 0?null:ie,type:B,geometry:V,tags:te,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(ye){var Se=ye.geometry,Te=ye.type;if(Te==="Point"||Te==="MultiPoint"||Te==="LineString")Ln(ye,Se);else if(Te==="Polygon"||Te==="MultiLineString")for(var be=0;be<Se.length;be++)Ln(ye,Se[be]);else if(Te==="MultiPolygon")for(be=0;be<Se.length;be++)for(var Me=0;Me<Se[be].length;Me++)Ln(ye,Se[be][Me])}(ae),ae}function Ln(ie,B){for(var V=0;V<B.length;V+=3)ie.minX=Math.min(ie.minX,B[V]),ie.minY=Math.min(ie.minY,B[V+1]),ie.maxX=Math.max(ie.maxX,B[V]),ie.maxY=Math.max(ie.maxY,B[V+1])}function pn(ie,B,V,te){if(B.geometry){var ae=B.geometry.coordinates,ye=B.geometry.type,Se=Math.pow(V.tolerance/((1<<V.maxZoom)*V.extent),2),Te=[],be=B.id;if(V.promoteId?be=B.properties[V.promoteId]:V.generateId&&(be=te||0),ye==="Point")mn(ae,Te);else if(ye==="MultiPoint")for(var Me=0;Me<ae.length;Me++)mn(ae[Me],Te);else if(ye==="LineString")qn(ae,Te,Se,!1);else if(ye==="MultiLineString"){if(V.lineMetrics){for(Me=0;Me<ae.length;Me++)qn(ae[Me],Te=[],Se,!1),ie.push(Dt(be,"LineString",Te,B.properties));return}ps(ae,Te,Se,!1)}else if(ye==="Polygon")ps(ae,Te,Se,!0);else{if(ye!=="MultiPolygon"){if(ye==="GeometryCollection"){for(Me=0;Me<B.geometry.geometries.length;Me++)pn(ie,{id:be,geometry:B.geometry.geometries[Me],properties:B.properties},V,te);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Me=0;Me<ae.length;Me++){var Xe=[];ps(ae[Me],Xe,Se,!0),Te.push(Xe)}}ie.push(Dt(be,ye,Te,B.properties))}}function mn(ie,B){B.push(ms(ie[0])),B.push(gs(ie[1])),B.push(0)}function qn(ie,B,V,te){for(var ae,ye,Se=0,Te=0;Te<ie.length;Te++){var be=ms(ie[Te][0]),Me=gs(ie[Te][1]);B.push(be),B.push(Me),B.push(0),Te>0&&(Se+=te?(ae*Me-be*ye)/2:Math.sqrt(Math.pow(be-ae,2)+Math.pow(Me-ye,2))),ae=be,ye=Me}var Xe=B.length-3;B[2]=1,Er(B,0,Xe,V),B[Xe+2]=1,B.size=Math.abs(Se),B.start=0,B.end=B.size}function ps(ie,B,V,te){for(var ae=0;ae<ie.length;ae++){var ye=[];qn(ie[ae],ye,V,te),B.push(ye)}}function ms(ie){return ie/360+.5}function gs(ie){var B=Math.sin(ie*Math.PI/180),V=.5-.25*Math.log((1+B)/(1-B))/Math.PI;return V<0?0:V>1?1:V}function dr(ie,B,V,te,ae,ye,Se,Te){if(te/=B,ye>=(V/=B)&&Se<te)return ie;if(Se<V||ye>=te)return null;for(var be=[],Me=0;Me<ie.length;Me++){var Xe=ie[Me],lt=Xe.geometry,Ke=Xe.type,Tt=ae===0?Xe.minX:Xe.minY,Et=ae===0?Xe.maxX:Xe.maxY;if(Tt>=V&&Et<te)be.push(Xe);else if(!(Et<V||Tt>=te)){var _t=[];if(Ke==="Point"||Ke==="MultiPoint")Xr(lt,_t,V,te,ae);else if(Ke==="LineString")tn(lt,_t,V,te,ae,!1,Te.lineMetrics);else if(Ke==="MultiLineString")Sr(lt,_t,V,te,ae,!1);else if(Ke==="Polygon")Sr(lt,_t,V,te,ae,!0);else if(Ke==="MultiPolygon")for(var Pt=0;Pt<lt.length;Pt++){var Bt=[];Sr(lt[Pt],Bt,V,te,ae,!0),Bt.length&&_t.push(Bt)}if(_t.length){if(Te.lineMetrics&&Ke==="LineString"){for(Pt=0;Pt<_t.length;Pt++)be.push(Dt(Xe.id,Ke,_t[Pt],Xe.tags));continue}Ke!=="LineString"&&Ke!=="MultiLineString"||(_t.length===1?(Ke="LineString",_t=_t[0]):Ke="MultiLineString"),Ke!=="Point"&&Ke!=="MultiPoint"||(Ke=_t.length===3?"Point":"MultiPoint"),be.push(Dt(Xe.id,Ke,_t,Xe.tags))}}}return be.length?be:null}function Xr(ie,B,V,te,ae){for(var ye=0;ye<ie.length;ye+=3){var Se=ie[ye+ae];Se>=V&&Se<=te&&(B.push(ie[ye]),B.push(ie[ye+1]),B.push(ie[ye+2]))}}function tn(ie,B,V,te,ae,ye,Se){for(var Te,be,Me=_s(ie),Xe=ae===0?Ao:Gs,lt=ie.start,Ke=0;Ke<ie.length-3;Ke+=3){var Tt=ie[Ke],Et=ie[Ke+1],_t=ie[Ke+2],Pt=ie[Ke+3],Bt=ie[Ke+4],Jt=ae===0?Tt:Et,ri=ae===0?Pt:Bt,ni=!1;Se&&(Te=Math.sqrt(Math.pow(Tt-Pt,2)+Math.pow(Et-Bt,2))),Jt<V?ri>V&&(be=Xe(Me,Tt,Et,Pt,Bt,V),Se&&(Me.start=lt+Te*be)):Jt>te?ri<te&&(be=Xe(Me,Tt,Et,Pt,Bt,te),Se&&(Me.start=lt+Te*be)):gn(Me,Tt,Et,_t),ri<V&&Jt>=V&&(be=Xe(Me,Tt,Et,Pt,Bt,V),ni=!0),ri>te&&Jt<=te&&(be=Xe(Me,Tt,Et,Pt,Bt,te),ni=!0),!ye&&ni&&(Se&&(Me.end=lt+Te*be),B.push(Me),Me=_s(ie)),Se&&(lt+=Te)}var St=ie.length-3;Tt=ie[St],Et=ie[St+1],_t=ie[St+2],(Jt=ae===0?Tt:Et)>=V&&Jt<=te&&gn(Me,Tt,Et,_t),St=Me.length-3,ye&&St>=3&&(Me[St]!==Me[0]||Me[St+1]!==Me[1])&&gn(Me,Me[0],Me[1],Me[2]),Me.length&&B.push(Me)}function _s(ie){var B=[];return B.size=ie.size,B.start=ie.start,B.end=ie.end,B}function Sr(ie,B,V,te,ae,ye){for(var Se=0;Se<ie.length;Se++)tn(ie[Se],B,V,te,ae,ye,!1)}function gn(ie,B,V,te){ie.push(B),ie.push(V),ie.push(te)}function Ao(ie,B,V,te,ae,ye){var Se=(ye-B)/(te-B);return ie.push(ye),ie.push(V+(ae-V)*Se),ie.push(1),Se}function Gs(ie,B,V,te,ae,ye){var Se=(ye-V)/(ae-V);return ie.push(B+(te-B)*Se),ie.push(ye),ie.push(1),Se}function Zs(ie,B){for(var V=[],te=0;te<ie.length;te++){var ae,ye=ie[te],Se=ye.type;if(Se==="Point"||Se==="MultiPoint"||Se==="LineString")ae=kn(ye.geometry,B);else if(Se==="MultiLineString"||Se==="Polygon"){ae=[];for(var Te=0;Te<ye.geometry.length;Te++)ae.push(kn(ye.geometry[Te],B))}else if(Se==="MultiPolygon")for(ae=[],Te=0;Te<ye.geometry.length;Te++){for(var be=[],Me=0;Me<ye.geometry[Te].length;Me++)be.push(kn(ye.geometry[Te][Me],B));ae.push(be)}V.push(Dt(ye.id,Se,ae,ye.tags))}return V}function kn(ie,B){var V=[];V.size=ie.size,ie.start!==void 0&&(V.start=ie.start,V.end=ie.end);for(var te=0;te<ie.length;te+=3)V.push(ie[te]+B,ie[te+1],ie[te+2]);return V}function $s(ie,B){if(ie.transformed)return ie;var V,te,ae,ye=1<<ie.z,Se=ie.x,Te=ie.y;for(V=0;V<ie.features.length;V++){var be=ie.features[V],Me=be.geometry,Xe=be.type;if(be.geometry=[],Xe===1)for(te=0;te<Me.length;te+=2)be.geometry.push(Mo(Me[te],Me[te+1],B,ye,Se,Te));else for(te=0;te<Me.length;te++){var lt=[];for(ae=0;ae<Me[te].length;ae+=2)lt.push(Mo(Me[te][ae],Me[te][ae+1],B,ye,Se,Te));be.geometry.push(lt)}}return ie.transformed=!0,ie}function Mo(ie,B,V,te,ae,ye){return[Math.round(V*(ie*te-ae)),Math.round(V*(B*te-ye))]}function Ws(ie,B,V,te,ae){for(var ye=B===ae.maxZoom?0:ae.tolerance/((1<<B)*ae.extent),Se={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:V,y:te,z:B,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Te=0;Te<ie.length;Te++){Se.numFeatures++,Po(Se,ie[Te],ye,ae);var be=ie[Te].minX,Me=ie[Te].minY,Xe=ie[Te].maxX,lt=ie[Te].maxY;be<Se.minX&&(Se.minX=be),Me<Se.minY&&(Se.minY=Me),Xe>Se.maxX&&(Se.maxX=Xe),lt>Se.maxY&&(Se.maxY=lt)}return Se}function Po(ie,B,V,te){var ae=B.geometry,ye=B.type,Se=[];if(ye==="Point"||ye==="MultiPoint")for(var Te=0;Te<ae.length;Te+=3)Se.push(ae[Te]),Se.push(ae[Te+1]),ie.numPoints++,ie.numSimplified++;else if(ye==="LineString")rn(Se,ae,ie,V,!1,!1);else if(ye==="MultiLineString"||ye==="Polygon")for(Te=0;Te<ae.length;Te++)rn(Se,ae[Te],ie,V,ye==="Polygon",Te===0);else if(ye==="MultiPolygon")for(var be=0;be<ae.length;be++){var Me=ae[be];for(Te=0;Te<Me.length;Te++)rn(Se,Me[Te],ie,V,!0,Te===0)}if(Se.length){var Xe=B.tags||null;if(ye==="LineString"&&te.lineMetrics){for(var lt in Xe={},B.tags)Xe[lt]=B.tags[lt];Xe.mapbox_clip_start=ae.start/ae.size,Xe.mapbox_clip_end=ae.end/ae.size}var Ke={geometry:Se,type:ye==="Polygon"||ye==="MultiPolygon"?3:ye==="LineString"||ye==="MultiLineString"?2:1,tags:Xe};B.id!==null&&(Ke.id=B.id),ie.features.push(Ke)}}function rn(ie,B,V,te,ae,ye){var Se=te*te;if(te>0&&B.size<(ae?Se:te))V.numPoints+=B.length/3;else{for(var Te=[],be=0;be<B.length;be+=3)(te===0||B[be+2]>Se)&&(V.numSimplified++,Te.push(B[be]),Te.push(B[be+1])),V.numPoints++;ae&&function(Me,Xe){for(var lt=0,Ke=0,Tt=Me.length,Et=Tt-2;Ke<Tt;Et=Ke,Ke+=2)lt+=(Me[Ke]-Me[Et])*(Me[Ke+1]+Me[Et+1]);if(lt>0===Xe)for(Ke=0,Tt=Me.length;Ke<Tt/2;Ke+=2){var _t=Me[Ke],Pt=Me[Ke+1];Me[Ke]=Me[Tt-2-Ke],Me[Ke+1]=Me[Tt-1-Ke],Me[Tt-2-Ke]=_t,Me[Tt-1-Ke]=Pt}}(Te,ye),ie.push(Te)}}function _n(ie,B){var V=(B=this.options=function(ae,ye){for(var Se in ye)ae[Se]=ye[Se];return ae}(Object.create(this.options),B)).debug;if(V&&console.time("preprocess data"),B.maxZoom<0||B.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(B.promoteId&&B.generateId)throw new Error("promoteId and generateId cannot be used together.");var te=function(ae,ye){var Se=[];if(ae.type==="FeatureCollection")for(var Te=0;Te<ae.features.length;Te++)pn(Se,ae.features[Te],ye,Te);else pn(Se,ae.type==="Feature"?ae:{geometry:ae},ye);return Se}(ie,B);this.tiles={},this.tileCoords=[],V&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",B.indexMaxZoom,B.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(te=function(ae,ye){var Se=ye.buffer/ye.extent,Te=ae,be=dr(ae,1,-1-Se,Se,0,-1,2,ye),Me=dr(ae,1,1-Se,2+Se,0,-1,2,ye);return(be||Me)&&(Te=dr(ae,1,-Se,1+Se,0,-1,2,ye)||[],be&&(Te=Zs(be,1).concat(Te)),Me&&(Te=Te.concat(Zs(Me,-1)))),Te}(te,B)).length&&this.splitTile(te,0,0,0),V&&(te.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function ys(ie,B,V){return 32*((1<<ie)*V+B)+ie}function Io(ie,B){const V=ie.tileID.canonical;if(!this._geoJSONIndex)return B(null,null);const te=this._geoJSONIndex.getTile(V.z,V.x,V.y);if(!te)return B(null,null);const ae=new Ce(te.features);let ye=ot(ae);ye.byteOffset===0&&ye.byteLength===ye.buffer.byteLength||(ye=new Uint8Array(ye)),B(null,{vectorTile:ae,rawData:ye.buffer})}_n.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},_n.prototype.splitTile=function(ie,B,V,te,ae,ye,Se){for(var Te=[ie,B,V,te],be=this.options,Me=be.debug;Te.length;){te=Te.pop(),V=Te.pop(),B=Te.pop(),ie=Te.pop();var Xe=1<<B,lt=ys(B,V,te),Ke=this.tiles[lt];if(!Ke&&(Me>1&&console.time("creation"),Ke=this.tiles[lt]=Ws(ie,B,V,te,be),this.tileCoords.push({z:B,x:V,y:te}),Me)){Me>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",B,V,te,Ke.numFeatures,Ke.numPoints,Ke.numSimplified),console.timeEnd("creation"));var Tt="z"+B;this.stats[Tt]=(this.stats[Tt]||0)+1,this.total++}if(Ke.source=ie,ae){if(B===be.maxZoom||B===ae)continue;var Et=1<<ae-B;if(V!==Math.floor(ye/Et)||te!==Math.floor(Se/Et))continue}else if(B===be.indexMaxZoom||Ke.numPoints<=be.indexMaxPoints)continue;if(Ke.source=null,ie.length!==0){Me>1&&console.time("clipping");var _t,Pt,Bt,Jt,ri,ni,St=.5*be.buffer/be.extent,Fe=.5-St,Ei=.5+St,ci=1+St;_t=Pt=Bt=Jt=null,ri=dr(ie,Xe,V-St,V+Ei,0,Ke.minX,Ke.maxX,be),ni=dr(ie,Xe,V+Fe,V+ci,0,Ke.minX,Ke.maxX,be),ie=null,ri&&(_t=dr(ri,Xe,te-St,te+Ei,1,Ke.minY,Ke.maxY,be),Pt=dr(ri,Xe,te+Fe,te+ci,1,Ke.minY,Ke.maxY,be),ri=null),ni&&(Bt=dr(ni,Xe,te-St,te+Ei,1,Ke.minY,Ke.maxY,be),Jt=dr(ni,Xe,te+Fe,te+ci,1,Ke.minY,Ke.maxY,be),ni=null),Me>1&&console.timeEnd("clipping"),Te.push(_t||[],B+1,2*V,2*te),Te.push(Pt||[],B+1,2*V,2*te+1),Te.push(Bt||[],B+1,2*V+1,2*te),Te.push(Jt||[],B+1,2*V+1,2*te+1)}}},_n.prototype.getTile=function(ie,B,V){var te=this.options,ae=te.extent,ye=te.debug;if(ie<0||ie>24)return null;var Se=1<<ie,Te=ys(ie,B=(B%Se+Se)%Se,V);if(this.tiles[Te])return $s(this.tiles[Te],ae);ye>1&&console.log("drilling down to z%d-%d-%d",ie,B,V);for(var be,Me=ie,Xe=B,lt=V;!be&&Me>0;)Me--,Xe=Math.floor(Xe/2),lt=Math.floor(lt/2),be=this.tiles[ys(Me,Xe,lt)];return be&&be.source?(ye>1&&console.log("found parent tile z%d-%d-%d",Me,Xe,lt),ye>1&&console.time("drilling down"),this.splitTile(be.source,Me,Xe,lt,ie,B,V),ye>1&&console.timeEnd("drilling down"),this.tiles[Te]?$s(this.tiles[Te],ae):null):null};class nr extends a.VectorTileWorkerSource{constructor(B,V,te,ae,ye){super(B,V,te,ae,Io),ye&&(this.loadGeoJSON=ye)}loadData(B,V){const te=B&&B.request,ae=te&&te.collectResourceTiming;this.loadGeoJSON(B,(ye,Se)=>{if(ye||!Se)return V(ye);if(typeof Se!="object")return V(new Error(`Input data given to '${B.source}' is not a valid GeoJSON object.`));{W(Se,!0);try{if(B.filter){const be=a.createExpression(B.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(be.result==="error")throw new Error(be.value.map(Xe=>`${Xe.key}: ${Xe.message}`).join(", "));Se={type:"FeatureCollection",features:Se.features.filter(Xe=>be.value.evaluate({zoom:0},Xe))}}this._geoJSONIndex=B.cluster?new rr(function({superclusterOptions:be,clusterProperties:Me}){if(!Me||!be)return be;const Xe={},lt={},Ke={accumulated:null,zoom:0},Tt={properties:null},Et=Object.keys(Me);for(const _t of Et){const[Pt,Bt]=Me[_t],Jt=a.createExpression(Bt),ri=a.createExpression(typeof Pt=="string"?[Pt,["accumulated"],["get",_t]]:Pt);Xe[_t]=Jt.value,lt[_t]=ri.value}return be.map=_t=>{Tt.properties=_t;const Pt={};for(const Bt of Et)Pt[Bt]=Xe[Bt].evaluate(Ke,Tt);return Pt},be.reduce=(_t,Pt)=>{Tt.properties=Pt;for(const Bt of Et)Ke.accumulated=_t[Bt],_t[Bt]=lt[Bt].evaluate(Ke,Tt)},be}(B)).load(Se.features):function(be,Me){return new _n(be,Me)}(Se,B.geojsonVtOptions)}catch(be){return V(be)}this.loaded={};const Te={};if(ae){const be=a.getPerformanceMeasurement(te);be&&(Te.resourceTiming={},Te.resourceTiming[B.source]=JSON.parse(JSON.stringify(be)))}V(null,Te)}})}reloadTile(B,V){const te=this.loaded;return te&&te[B.uid]?super.reloadTile(B,V):this.loadTile(B,V)}loadGeoJSON(B,V){if(B.request)a.getJSON(B.request,V);else{if(typeof B.data!="string")return V(new Error(`Input data given to '${B.source}' is not a valid GeoJSON object.`));try{return V(null,JSON.parse(B.data))}catch{return V(new Error(`Input data given to '${B.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(B,V){try{V(null,this._geoJSONIndex.getClusterExpansionZoom(B.clusterId))}catch(te){V(te)}}getClusterChildren(B,V){try{V(null,this._geoJSONIndex.getChildren(B.clusterId))}catch(te){V(te)}}getClusterLeaves(B,V){try{V(null,this._geoJSONIndex.getLeaves(B.clusterId,B.limit,B.offset))}catch(te){V(te)}}}class qs{constructor(B){this.self=B,this.actor=new a.Actor(B,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=a.getProjection({name:"mercator"}),this.workerSourceTypes={vector:a.VectorTileWorkerSource,geojson:nr},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(V,te)=>{if(this.workerSourceTypes[V])throw new Error(`Worker source with name "${V}" already registered.`);this.workerSourceTypes[V]=te},this.self.registerRTLTextPlugin=V=>{if(a.plugin.isParsed())throw new Error("RTL text plugin already registered.");a.plugin.applyArabicShaping=V.applyArabicShaping,a.plugin.processBidirectionalText=V.processBidirectionalText,a.plugin.processStyledBidirectionalText=V.processStyledBidirectionalText}}clearCaches(B,V,te){delete this.layerIndexes[B],delete this.availableImages[B],delete this.workerSources[B],delete this.demWorkerSources[B],te()}checkIfReady(B,V,te){te()}setReferrer(B,V){this.referrer=V}spriteLoaded(B,V){this.isSpriteLoaded[B]=V;for(const te in this.workerSources[B]){const ae=this.workerSources[B][te];for(const ye in ae)ae[ye]instanceof a.VectorTileWorkerSource&&(ae[ye].isSpriteLoaded=V,ae[ye].fire(new a.Event("isSpriteLoaded")))}}setImages(B,V,te){this.availableImages[B]=V;for(const ae in this.workerSources[B]){const ye=this.workerSources[B][ae];for(const Se in ye)ye[Se].availableImages=V}te()}enableTerrain(B,V,te){this.terrain=V,te()}setProjection(B,V){this.projections[B]=a.getProjection(V)}setLayers(B,V,te){this.getLayerIndex(B).replace(V),te()}updateLayers(B,V,te){this.getLayerIndex(B).update(V.layers,V.removedIds),te()}loadTile(B,V,te){const ae=this.enableTerrain?a.extend({enableTerrain:this.terrain},V):V;ae.projection=this.projections[B]||this.defaultProjection,this.getWorkerSource(B,V.type,V.source).loadTile(ae,te)}loadDEMTile(B,V,te){const ae=this.enableTerrain?a.extend({buildQuadTree:this.terrain},V):V;this.getDEMWorkerSource(B,V.source).loadTile(ae,te)}reloadTile(B,V,te){const ae=this.enableTerrain?a.extend({enableTerrain:this.terrain},V):V;ae.projection=this.projections[B]||this.defaultProjection,this.getWorkerSource(B,V.type,V.source).reloadTile(ae,te)}abortTile(B,V,te){this.getWorkerSource(B,V.type,V.source).abortTile(V,te)}removeTile(B,V,te){this.getWorkerSource(B,V.type,V.source).removeTile(V,te)}removeSource(B,V,te){if(!this.workerSources[B]||!this.workerSources[B][V.type]||!this.workerSources[B][V.type][V.source])return;const ae=this.workerSources[B][V.type][V.source];delete this.workerSources[B][V.type][V.source],ae.removeSource!==void 0?ae.removeSource(V,te):te()}loadWorkerSource(B,V,te){try{this.self.importScripts(V.url),te()}catch(ae){te(ae.toString())}}syncRTLPluginState(B,V,te){try{a.plugin.setState(V);const ae=a.plugin.getPluginURL();if(a.plugin.isLoaded()&&!a.plugin.isParsed()&&ae!=null){this.self.importScripts(ae);const ye=a.plugin.isParsed();te(ye?void 0:new Error(`RTL Text Plugin failed to import scripts from ${ae}`),ye)}}catch(ae){te(ae.toString())}}getAvailableImages(B){let V=this.availableImages[B];return V||(V=[]),V}getLayerIndex(B){let V=this.layerIndexes[B];return V||(V=this.layerIndexes[B]=new N),V}getWorkerSource(B,V,te){return this.workerSources[B]||(this.workerSources[B]={}),this.workerSources[B][V]||(this.workerSources[B][V]={}),this.workerSources[B][V][te]||(this.workerSources[B][V][te]=new this.workerSourceTypes[V]({send:(ae,ye,Se,Te,be,Me)=>{this.actor.send(ae,ye,Se,B,be,Me)},scheduler:this.actor.scheduler},this.getLayerIndex(B),this.getAvailableImages(B),this.isSpriteLoaded[B])),this.workerSources[B][V][te]}getDEMWorkerSource(B,V){return this.demWorkerSources[B]||(this.demWorkerSources[B]={}),this.demWorkerSources[B][V]||(this.demWorkerSources[B][V]=new F),this.demWorkerSources[B][V]}enforceCacheSizeLimit(B,V){a.enforceCacheSizeLimit(V)}getWorkerPerformanceMetrics(B,V,te){te(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new qs(self)),qs}),y(["./shared"],function(a){function P(d,o){if(Array.isArray(d)){if(!Array.isArray(o)||d.length!==o.length)return!1;for(let h=0;h<d.length;h++)if(!P(d[h],o[h]))return!1;return!0}if(typeof d=="object"&&d!==null&&o!==null){if(typeof o!="object"||Object.keys(d).length!==Object.keys(o).length)return!1;for(const h in d)if(!P(d[h],o[h]))return!1;return!0}return d===o}var D=N;function N(d){return!function(o){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var g,x,b=new Blob([""],{type:"text/javascript"}),S=URL.createObjectURL(b);try{x=new Worker(S),g=!0}catch{g=!1}return x&&x.terminate(),URL.revokeObjectURL(S),g}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var g=document.createElement("canvas");g.width=g.height=1;var x=g.getContext("2d");if(!x)return!1;var b=x.getImageData(0,0,1,1);return b&&b.width===g.width}()?(F[h=o&&o.failIfMajorPerformanceCaveat]===void 0&&(F[h]=function(g){var x,b=function(S){var A=document.createElement("canvas"),I=Object.create(N.webGLContextAttributes);return I.failIfMajorPerformanceCaveat=S,A.getContext("webgl",I)||A.getContext("experimental-webgl",I)}(g);if(!b)return!1;try{x=b.createShader(b.VERTEX_SHADER)}catch{return!1}return!(!x||b.isContextLost())&&(b.shaderSource(x,"void main() {}"),b.compileShader(x),b.getShaderParameter(x,b.COMPILE_STATUS)===!0)}(h)),F[h]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var h}(d)}var F={};function W(d,o,h){const g=a.window.document.createElement(d);return o!==void 0&&(g.className=o),h&&h.appendChild(g),g}function oe(d,o,h){const g=a.window.document.createElementNS("http://www.w3.org/2000/svg",d);for(const x of Object.keys(o))g.setAttributeNS(null,x,o[x]);return h&&h.appendChild(g),g}N.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const me=a.window.document&&a.window.document.documentElement.style,fe=me&&me.userSelect!==void 0?"userSelect":"WebkitUserSelect";let Ee;function Ce(){me&&fe&&(Ee=me[fe],me[fe]="none")}function ke(){me&&fe&&(me[fe]=Ee)}function $e(d){d.preventDefault(),d.stopPropagation(),a.window.removeEventListener("click",$e,!0)}function Ve(){a.window.addEventListener("click",$e,!0),a.window.setTimeout(()=>{a.window.removeEventListener("click",$e,!0)},0)}function Re(d,o){const h=d.getBoundingClientRect();return mt(d,h,o)}function ot(d,o){const h=d.getBoundingClientRect(),g=[];for(let x=0;x<o.length;x++)g.push(mt(d,h,o[x]));return g}function bt(d){return a.window.InstallTrigger!==void 0&&d.button===2&&d.ctrlKey&&a.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:d.button}function mt(d,o,h){const g=d.offsetWidth===o.width?1:d.offsetWidth/o.width;return new a.pointGeometry((h.clientX-o.left)*g,(h.clientY-o.top)*g)}function Mt(d,o){var h=o[0],g=o[1],x=o[2],b=o[3],S=h*b-x*g;return S?(d[0]=b*(S=1/S),d[1]=-g*S,d[2]=-x*S,d[3]=h*S,d):null}function gt(d){const{userImage:o}=d;return!!(o&&o.render&&o.render())&&(d.data.replace(new Uint8Array(o.data.buffer)),!0)}class Ht extends a.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new a.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(o){if(this.loaded!==o&&(this.loaded=o,o)){for(const{ids:h,callback:g}of this.requestors)this._notify(h,g);this.requestors=[]}}hasImage(o){return!!this.getImage(o)}getImage(o){return this.images[o]}addImage(o,h){this._validate(o,h)&&(this.images[o]=h)}_validate(o,h){let g=!0;return this._validateStretch(h.stretchX,h.data&&h.data.width)||(this.fire(new a.ErrorEvent(new Error(`Image "${o}" has invalid "stretchX" value`))),g=!1),this._validateStretch(h.stretchY,h.data&&h.data.height)||(this.fire(new a.ErrorEvent(new Error(`Image "${o}" has invalid "stretchY" value`))),g=!1),this._validateContent(h.content,h)||(this.fire(new a.ErrorEvent(new Error(`Image "${o}" has invalid "content" value`))),g=!1),g}_validateStretch(o,h){if(!o)return!0;let g=0;for(const x of o){if(x[0]<g||x[1]<x[0]||h<x[1])return!1;g=x[1]}return!0}_validateContent(o,h){return!(o&&(o.length!==4||o[0]<0||h.data.width<o[0]||o[1]<0||h.data.height<o[1]||o[2]<0||h.data.width<o[2]||o[3]<0||h.data.height<o[3]||o[2]<o[0]||o[3]<o[1]))}updateImage(o,h){h.version=this.images[o].version+1,this.images[o]=h,this.updatedImages[o]=!0}removeImage(o){const h=this.images[o];delete this.images[o],delete this.patterns[o],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(o,h){let g=!0;if(!this.isLoaded())for(const x of o)this.images[x]||(g=!1);this.isLoaded()||g?this._notify(o,h):this.requestors.push({ids:o,callback:h})}_notify(o,h){const g={};for(const x of o){this.images[x]||this.fire(new a.Event("styleimagemissing",{id:x}));const b=this.images[x];b?g[x]={data:b.data.clone(),pixelRatio:b.pixelRatio,sdf:b.sdf,version:b.version,stretchX:b.stretchX,stretchY:b.stretchY,content:b.content,hasRenderCallback:!!(b.userImage&&b.userImage.render)}:a.warnOnce(`Image "${x}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}h(null,g)}getPixelSize(){const{width:o,height:h}=this.atlasImage;return{width:o,height:h}}getPattern(o){const h=this.patterns[o],g=this.getImage(o);if(!g)return null;if(h&&h.position.version===g.version)return h.position;if(h)h.position.version=g.version;else{const x={w:g.data.width+2,h:g.data.height+2,x:0,y:0},b=new a.ImagePosition(x,g);this.patterns[o]={bin:x,position:b}}return this._updatePatternAtlas(),this.patterns[o].position}bind(o){const h=o.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new a.Texture(o,this.atlasImage,h.RGBA),this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)}_updatePatternAtlas(){const o=[];for(const b in this.patterns)o.push(this.patterns[b].bin);const{w:h,h:g}=a.potpack(o),x=this.atlasImage;x.resize({width:h||1,height:g||1});for(const b in this.patterns){const{bin:S}=this.patterns[b],A=S.x+1,I=S.y+1,k=this.images[b].data,R=k.width,U=k.height;a.RGBAImage.copy(k,x,{x:0,y:0},{x:A,y:I},{width:R,height:U}),a.RGBAImage.copy(k,x,{x:0,y:U-1},{x:A,y:I-1},{width:R,height:1}),a.RGBAImage.copy(k,x,{x:0,y:0},{x:A,y:I+U},{width:R,height:1}),a.RGBAImage.copy(k,x,{x:R-1,y:0},{x:A-1,y:I},{width:1,height:U}),a.RGBAImage.copy(k,x,{x:0,y:0},{x:A+R,y:I},{width:1,height:U})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(o){for(const h of o){if(this.callbackDispatchedThisFrame[h])continue;this.callbackDispatchedThisFrame[h]=!0;const g=this.images[h];gt(g)&&this.updateImage(h,g)}}}const Xt=new a.Properties({anchor:new a.DataConstantProperty(a.spec.light.anchor),position:new class{constructor(){this.specification=a.spec.light.position}possiblyEvaluate(d,o){return function([h,g,x]){const b=a.degToRad(g+90),S=a.degToRad(x);return{x:h*Math.cos(b)*Math.sin(S),y:h*Math.sin(b)*Math.sin(S),z:h*Math.cos(S),azimuthal:g,polar:x}}(d.expression.evaluate(o))}interpolate(d,o,h){return{x:a.number(d.x,o.x,h),y:a.number(d.y,o.y,h),z:a.number(d.z,o.z,h),azimuthal:a.number(d.azimuthal,o.azimuthal,h),polar:a.number(d.polar,o.polar,h)}}},color:new a.DataConstantProperty(a.spec.light.color),intensity:new a.DataConstantProperty(a.spec.light.intensity)}),jt="-transition";class Ki extends a.Evented{constructor(o){super(),this._transitionable=new a.Transitionable(Xt),this.setLight(o),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(o,h={}){if(!this._validate(a.validateLight,o,h))for(const g in o){const x=o[g];a.endsWith(g,jt)?this._transitionable.setTransition(g.slice(0,-jt.length),x):this._transitionable.setValue(g,x)}}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,h,g){return(!g||g.validate!==!1)&&a.emitValidationErrors(this,o.call(a.validateStyle,a.extend({value:h,style:{glyphs:!0,sprite:!0},styleSpec:a.spec})))}}const $n=new a.Properties({source:new a.DataConstantProperty(a.spec.terrain.source),exaggeration:new a.DataConstantProperty(a.spec.terrain.exaggeration)}),Or="-transition";class ds extends a.Evented{constructor(o,h){super(),this._transitionable=new a.Transitionable($n),this.set(o),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=h}get(){return this._transitionable.serialize()}set(o){for(const h in o){const g=o[h];a.endsWith(h,Or)?this._transitionable.setTransition(h.slice(0,-Or.length),g):this._transitionable.setValue(h,g)}}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}}function Zr(d,o,h,g){const x=a.smoothstep(45,65,h),[b,S]=Wn(d,g),A=a.length(o);let I=1-Math.min(1,Math.exp((A-b)/(S-b)*-6));return I*=I*I,I=Math.min(1,1.00747*I),I*x*d.alpha}function Wn(d,o){const h=.5/Math.tan(.5*o);return[d.range[0]+h,d.range[1]+h]}const Dr=new a.Properties({range:new a.DataConstantProperty(a.spec.fog.range),color:new a.DataConstantProperty(a.spec.fog.color),"high-color":new a.DataConstantProperty(a.spec.fog["high-color"]),"space-color":new a.DataConstantProperty(a.spec.fog["space-color"]),"horizon-blend":new a.DataConstantProperty(a.spec.fog["horizon-blend"]),"star-intensity":new a.DataConstantProperty(a.spec.fog["star-intensity"])}),hn="-transition";class Ci extends a.Evented{constructor(o,h){super(),this._transitionable=new a.Transitionable(Dr),this.set(o),this._transitioning=this._transitionable.untransitioned(),this._transform=h}get state(){const o=this._transform,h=o.projection.name==="globe",g=a.globeToMercatorTransition(o.zoom),x=this.properties.get("range"),b=[.5,3];return{range:h?[a.number(b[0],x[0],g),a.number(b[1],x[1],g)]:x,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(o,h={}){if(!this._validate(a.validateFog,o,h)){for(const g of Object.keys(a.spec.fog))o&&o[g]===void 0&&(o[g]=a.spec.fog[g].default);for(const g in o){const x=o[g];a.endsWith(g,hn)?this._transitionable.setTransition(g.slice(0,-hn.length),x):this._transitionable.setValue(g,x)}}}getOpacity(o){if(!this._transform.projection.supportsFog)return 0;const h=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:a.smoothstep(45,65,o))*h.a}getOpacityAtLatLng(o,h){return this._transform.projection.supportsFog?function(g,x,b){const S=a.MercatorCoordinate.fromLngLat(x),A=b.elevation?b.elevation.getAtPointOrZero(S):0,I=[S.x,S.y,A];return a.transformMat4(I,I,b.mercatorFogMatrix),Zr(g,I,b.pitch,b._fov)}(this.state,o,h):0}getFovAdjustedRange(o){return this._transform.projection.supportsFog?Wn(this.state,o):[0,1]}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,h,g){return(!g||g.validate!==!1)&&a.emitValidationErrors(this,o.call(a.validateStyle,a.extend({value:h,style:{glyphs:!0,sprite:!0},styleSpec:a.spec})))}}class $i{constructor(o,h){this.workerPool=o,this.actors=[],this.currentActor=0,this.id=a.uniqueId();const g=this.workerPool.acquire(this.id);for(let x=0;x<g.length;x++){const b=new $i.Actor(g[x],h,this.id);b.name=`Worker ${x}`,this.actors.push(b)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(o,h,g){a.asyncAll(this.actors,(x,b)=>{x.send(o,h,b)},g=g||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(o=>{o.remove()}),this.actors=[],this.workerPool.release(this.id)}}function fn(d,o,h){return o*(a.EXTENT/(d.tileSize*Math.pow(2,h-d.tileID.overscaledZ)))}$i.Actor=a.Actor;class wr{constructor(o,h,g,x){this.screenBounds=o,this.cameraPoint=h,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=g,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,x)}static createFromScreenPoints(o,h){let g,x;if(o instanceof a.pointGeometry||typeof o[0]=="number"){const b=a.pointGeometry.convert(o);g=[a.pointGeometry.convert(o)],x=h.isPointAboveHorizon(b)}else{const b=a.pointGeometry.convert(o[0]),S=a.pointGeometry.convert(o[1]);g=[b,S],x=a.polygonizeBounds(b,S).every(A=>h.isPointAboveHorizon(A))}return new wr(g,h.getCameraPoint(),x,h)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(o){return a.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],o)}bufferedCameraGeometry(o){const h=this.screenBounds[0],g=this.screenBounds.length===1?this.screenBounds[0].add(new a.pointGeometry(1,1)):this.screenBounds[1],x=a.polygonizeBounds(h,g,0,!1);return this.cameraPoint.y>g.y&&(this.cameraPoint.x>h.x&&this.cameraPoint.x<g.x?x.splice(3,0,this.cameraPoint):this.cameraPoint.x>=g.x?x[2]=this.cameraPoint:this.cameraPoint.x<=h.x&&(x[3]=this.cameraPoint)),a.bufferConvexPolygon(x,o)}bufferedCameraGeometryGlobe(o){const h=this.screenBounds[0],g=this.screenBounds.length===1?this.screenBounds[0].add(new a.pointGeometry(1,1)):this.screenBounds[1],x=a.polygonizeBounds(h,g,o),b=this.cameraPoint.clone();switch(3*((b.y>h.y)+(b.y>g.y))+((b.x>h.x)+(b.x>g.x))){case 0:x[0]=b,x[4]=b.clone();break;case 1:x.splice(1,0,b);break;case 2:x[1]=b;break;case 3:x.splice(4,0,b);break;case 5:x.splice(2,0,b);break;case 6:x[3]=b;break;case 7:x.splice(3,0,b);break;case 8:x[2]=b}return x}containsTile(o,h,g,x=0){const b=o.queryPadding/h._pixelsPerMercatorPixel+1,S=g?this._bufferedCameraMercator(b,h):this._bufferedScreenMercator(b,h);let A=o.tileID.wrap+(S.unwrapped?x:0);const I=S.polygon.map(K=>a.getTilePoint(o.tileTransform,K,A));if(!a.polygonIntersectsBox(I,0,0,a.EXTENT,a.EXTENT))return;A=o.tileID.wrap+(this.screenGeometryMercator.unwrapped?x:0);const k=this.screenGeometryMercator.polygon.map(K=>a.getTileVec3(o.tileTransform,K,A)),R=k.map(K=>new a.pointGeometry(K[0],K[1])),U=h.getFreeCameraOptions().position||new a.MercatorCoordinate(0,0,0),Z=a.getTileVec3(o.tileTransform,U,A),J=k.map(K=>{const X=a.sub(K,K,Z);return a.normalize(X,X),new a.Ray(Z,X)}),H=fn(o,1,h.zoom)*h._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:R,tilespaceRays:J,bufferedTilespaceGeometry:I,bufferedTilespaceBounds:(Y=a.getBounds(I),Y.min.x=a.clamp(Y.min.x,0,a.EXTENT),Y.min.y=a.clamp(Y.min.y,0,a.EXTENT),Y.max.x=a.clamp(Y.max.x,0,a.EXTENT),Y.max.y=a.clamp(Y.max.y,0,a.EXTENT),Y),tile:o,tileID:o.tileID,pixelToTileUnitsFactor:H};var Y}_bufferedScreenMercator(o,h){const g=yi(o);if(this._screenRaycastCache[g])return this._screenRaycastCache[g];{let x;return x=h.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(o),h):{polygon:this.bufferedScreenGeometry(o).map(b=>h.pointCoordinate3D(b)),unwrapped:!0},this._screenRaycastCache[g]=x,x}}_bufferedCameraMercator(o,h){const g=yi(o);if(this._cameraRaycastCache[g])return this._cameraRaycastCache[g];{let x;return x=h.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(o),h):{polygon:this.bufferedCameraGeometry(o).map(b=>h.pointCoordinate3D(b)),unwrapped:!0},this._cameraRaycastCache[g]=x,x}}_projectAndResample(o,h){const g=function(b,S){const A=a.multiply([],S.pixelMatrix,S.globeMatrix),I=[0,-a.GLOBE_RADIUS,0,1],k=[0,a.GLOBE_RADIUS,0,1],R=[0,0,0,1];a.transformMat4$1(I,I,A),a.transformMat4$1(k,k,A),a.transformMat4$1(R,R,A);const U=new a.pointGeometry(I[0]/I[3],I[1]/I[3]),Z=new a.pointGeometry(k[0]/k[3],k[1]/k[3]),J=a.polygonContainsPoint(b,U)&&I[3]<R[3],H=a.polygonContainsPoint(b,Z)&&k[3]<R[3];if(!J&&!H)return null;const Y=function(_e,pe,we){for(let Ie=1;Ie<_e.length;Ie++){const Je=rr(pe.pointCoordinate3D(_e[Ie-1]).x),Ae=rr(pe.pointCoordinate3D(_e[Ie]).x);if(we<0){if(Je<Ae)return{idx:Ie,t:-Je/(Ae-1-Je)}}else if(Ae<Je)return{idx:Ie,t:(1-Je)/(Ae+1-Je)}}return null}(b,S,J?-1:1);if(!Y)return null;const{idx:K,t:X}=Y;let ne=K>1?Li(b.slice(0,K),S):[],ee=K<b.length?Li(b.slice(K),S):[];ne=ne.map(_e=>new a.pointGeometry(rr(_e.x),_e.y)),ee=ee.map(_e=>new a.pointGeometry(rr(_e.x),_e.y));const ve=[...ne];ve.length===0&&ve.push(ee[ee.length-1]);const ge=a.number(ve[ve.length-1].y,(ee.length===0?ne[0]:ee[0]).y,X);let ue;return ue=J?[new a.pointGeometry(0,ge),new a.pointGeometry(0,0),new a.pointGeometry(1,0),new a.pointGeometry(1,ge)]:[new a.pointGeometry(1,ge),new a.pointGeometry(1,1),new a.pointGeometry(0,1),new a.pointGeometry(0,ge)],ve.push(...ue),ee.length===0?ve.push(ne[0]):ve.push(...ee),{polygon:ve.map(_e=>new a.MercatorCoordinate(_e.x,_e.y)),unwrapped:!1}}(o,h);if(g)return g;const x=function(b,S){let A=!1,I=-1/0,k=0;for(let U=0;U<b.length-1;U++)b[U].x>I&&(I=b[U].x,k=U);for(let U=0;U<b.length-1;U++){const Z=(k+U)%(b.length-1),J=b[Z],H=b[Z+1];Math.abs(J.x-H.x)>.5&&(J.x<H.x?(J.x+=1,Z===0&&(b[b.length-1].x+=1)):(H.x+=1,Z+1===b.length-1&&(b[0].x+=1)),A=!0)}const R=a.mercatorXfromLng(S.center.lng);return A&&R<Math.abs(R-1)&&b.forEach(U=>{U.x-=1}),{polygon:b,unwrapped:A}}(Li(o,h).map(b=>new a.pointGeometry(rr(b.x),b.y)),h);return{polygon:x.polygon.map(b=>new a.MercatorCoordinate(b.x,b.y)),unwrapped:x.unwrapped}}}function Li(d,o){return a.resample(d,h=>{const g=o.pointCoordinate3D(h);h.x=g.x,h.y=g.y},1/256)}function rr(d){return d<0?1+d%1:d%1}function yi(d){return 100*d|0}function Wi(d,o,h,g,x){const b=function(S,A){if(S)return x(S);if(A){const I=a.pick(a.extend(A,d),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);A.vector_layers&&(I.vectorLayers=A.vector_layers,I.vectorLayerIds=I.vectorLayers.map(k=>k.id)),A.language_options&&(I.languageOptions=A.language_options),A.language&&A.language[A.id]&&(I.language=A.language[A.id]),A.worldview_options&&(I.worldviewOptions=A.worldview_options),A.worldview?I.worldview=A.worldview[A.id]:A.worldview_default&&(I.worldview=A.worldview_default),I.tiles=o.canonicalizeTileset(I,d.url),x(null,I)}};return d.url?a.getJSON(o.transformRequest(o.normalizeSourceURL(d.url,null,h,g),a.ResourceType.Source),b):a.exported.frame(()=>b(null,d))}class zr{constructor(o,h,g){this.bounds=a.LngLatBounds.convert(this.validateBounds(o)),this.minzoom=h||0,this.maxzoom=g||24}validateBounds(o){return Array.isArray(o)&&o.length===4?[Math.max(-180,o[0]),Math.max(-90,o[1]),Math.min(180,o[2]),Math.min(90,o[3])]:[-180,-90,180,90]}contains(o){const h=Math.pow(2,o.z),g=Math.floor(a.mercatorXfromLng(this.bounds.getWest())*h),x=Math.floor(a.mercatorYfromLat(this.bounds.getNorth())*h),b=Math.ceil(a.mercatorXfromLng(this.bounds.getEast())*h),S=Math.ceil(a.mercatorYfromLat(this.bounds.getSouth())*h);return o.x>=g&&o.x<b&&o.y>=x&&o.y<S}}class Cn{constructor(o,h,g){this.context=o;const x=o.gl;this.buffer=x.createBuffer(),this.dynamicDraw=!!g,this.context.unbindVAO(),o.bindElementBuffer.set(this.buffer),x.bufferData(x.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||h.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(o){const h=this.context.gl;this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,o.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const $r={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Wr{constructor(o,h,g,x){this.length=h.length,this.attributes=g,this.itemSize=h.bytesPerElement,this.dynamicDraw=x,this.context=o;const b=o.gl;this.buffer=b.createBuffer(),o.bindVertexBuffer.set(this.buffer),b.bufferData(b.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||h.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(o){const h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,o.arrayBuffer)}enableAttributes(o,h){for(let g=0;g<this.attributes.length;g++){const x=h.attributes[this.attributes[g].name];x!==void 0&&o.enableVertexAttribArray(x)}}setVertexAttribPointers(o,h,g){for(let x=0;x<this.attributes.length;x++){const b=this.attributes[x],S=h.attributes[b.name];S!==void 0&&o.vertexAttribPointer(S,b.components,o[$r[b.type]],!1,this.itemSize,b.offset+this.itemSize*(g||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class $t{constructor(o){this.gl=o.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(o){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class qi extends $t{getDefault(){return a.Color.transparent}set(o){const h=this.current;(o.r!==h.r||o.g!==h.g||o.b!==h.b||o.a!==h.a||this.dirty)&&(this.gl.clearColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class Tr extends $t{getDefault(){return 1}set(o){(o!==this.current||this.dirty)&&(this.gl.clearDepth(o),this.current=o,this.dirty=!1)}}class qr extends $t{getDefault(){return 0}set(o){(o!==this.current||this.dirty)&&(this.gl.clearStencil(o),this.current=o,this.dirty=!1)}}class Er extends $t{getDefault(){return[!0,!0,!0,!0]}set(o){const h=this.current;(o[0]!==h[0]||o[1]!==h[1]||o[2]!==h[2]||o[3]!==h[3]||this.dirty)&&(this.gl.colorMask(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class dn extends $t{getDefault(){return!0}set(o){(o!==this.current||this.dirty)&&(this.gl.depthMask(o),this.current=o,this.dirty=!1)}}class Dt extends $t{getDefault(){return 255}set(o){(o!==this.current||this.dirty)&&(this.gl.stencilMask(o),this.current=o,this.dirty=!1)}}class Ln extends $t{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(o){const h=this.current;(o.func!==h.func||o.ref!==h.ref||o.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(o.func,o.ref,o.mask),this.current=o,this.dirty=!1)}}class pn extends $t{getDefault(){const o=this.gl;return[o.KEEP,o.KEEP,o.KEEP]}set(o){const h=this.current;(o[0]!==h[0]||o[1]!==h[1]||o[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(o[0],o[1],o[2]),this.current=o,this.dirty=!1)}}class mn extends $t{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;o?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=o,this.dirty=!1}}class qn extends $t{getDefault(){return[0,1]}set(o){const h=this.current;(o[0]!==h[0]||o[1]!==h[1]||this.dirty)&&(this.gl.depthRange(o[0],o[1]),this.current=o,this.dirty=!1)}}class ps extends $t{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;o?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=o,this.dirty=!1}}class ms extends $t{getDefault(){return this.gl.LESS}set(o){(o!==this.current||this.dirty)&&(this.gl.depthFunc(o),this.current=o,this.dirty=!1)}}class gs extends $t{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;o?h.enable(h.BLEND):h.disable(h.BLEND),this.current=o,this.dirty=!1}}class dr extends $t{getDefault(){const o=this.gl;return[o.ONE,o.ZERO]}set(o){const h=this.current;(o[0]!==h[0]||o[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(o[0],o[1]),this.current=o,this.dirty=!1)}}class Xr extends $t{getDefault(){return a.Color.transparent}set(o){const h=this.current;(o.r!==h.r||o.g!==h.g||o.b!==h.b||o.a!==h.a||this.dirty)&&(this.gl.blendColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class tn extends $t{getDefault(){return this.gl.FUNC_ADD}set(o){(o!==this.current||this.dirty)&&(this.gl.blendEquation(o),this.current=o,this.dirty=!1)}}class _s extends $t{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;o?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=o,this.dirty=!1}}class Sr extends $t{getDefault(){return this.gl.BACK}set(o){(o!==this.current||this.dirty)&&(this.gl.cullFace(o),this.current=o,this.dirty=!1)}}class gn extends $t{getDefault(){return this.gl.CCW}set(o){(o!==this.current||this.dirty)&&(this.gl.frontFace(o),this.current=o,this.dirty=!1)}}class Ao extends $t{getDefault(){return null}set(o){(o!==this.current||this.dirty)&&(this.gl.useProgram(o),this.current=o,this.dirty=!1)}}class Gs extends $t{getDefault(){return this.gl.TEXTURE0}set(o){(o!==this.current||this.dirty)&&(this.gl.activeTexture(o),this.current=o,this.dirty=!1)}}class Zs extends $t{getDefault(){const o=this.gl;return[0,0,o.drawingBufferWidth,o.drawingBufferHeight]}set(o){const h=this.current;(o[0]!==h[0]||o[1]!==h[1]||o[2]!==h[2]||o[3]!==h[3]||this.dirty)&&(this.gl.viewport(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class kn extends $t{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,o),this.current=o,this.dirty=!1}}class $s extends $t{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class Mo extends $t{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.bindTexture(h.TEXTURE_2D,o),this.current=o,this.dirty=!1}}class Ws extends $t{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class Po extends $t{getDefault(){return null}set(o){const h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class rn extends $t{constructor(o){super(o),this.vao=o.extVertexArrayObject}getDefault(){return null}set(o){this.vao&&(o!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(o),this.current=o,this.dirty=!1)}}class _n extends $t{getDefault(){return 4}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,o),this.current=o,this.dirty=!1}}class ys extends $t{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o),this.current=o,this.dirty=!1}}class Io extends $t{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,o),this.current=o,this.dirty=!1}}class nr extends $t{constructor(o,h){super(o),this.context=o,this.parent=h}getDefault(){return null}}class qs extends nr{setDirty(){this.dirty=!0}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class ie extends nr{attachment(){return this.gl.DEPTH_ATTACHMENT}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,this.attachment(),h.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class B extends ie{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class V{constructor(o,h,g,x){this.context=o,this.width=h,this.height=g;const b=this.framebuffer=o.gl.createFramebuffer();this.colorAttachment=new qs(o,b),x&&(this.depthAttachment=new ie(o,b))}destroy(){const o=this.context.gl,h=this.colorAttachment.get();if(h&&o.deleteTexture(h),this.depthAttachment){const g=this.depthAttachment.get();g&&o.deleteRenderbuffer(g)}o.deleteFramebuffer(this.framebuffer)}}class te{constructor(o){this.gl=o,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new qi(this),this.clearDepth=new Tr(this),this.clearStencil=new qr(this),this.colorMask=new Er(this),this.depthMask=new dn(this),this.stencilMask=new Dt(this),this.stencilFunc=new Ln(this),this.stencilOp=new pn(this),this.stencilTest=new mn(this),this.depthRange=new qn(this),this.depthTest=new ps(this),this.depthFunc=new ms(this),this.blend=new gs(this),this.blendFunc=new dr(this),this.blendColor=new Xr(this),this.blendEquation=new tn(this),this.cullFace=new _s(this),this.cullFaceSide=new Sr(this),this.frontFace=new gn(this),this.program=new Ao(this),this.activeTexture=new Gs(this),this.viewport=new Zs(this),this.bindFramebuffer=new kn(this),this.bindRenderbuffer=new $s(this),this.bindTexture=new Mo(this),this.bindVertexBuffer=new Ws(this),this.bindElementBuffer=new Po(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new rn(this),this.pixelStoreUnpack=new _n(this),this.pixelStoreUnpackPremultiplyAlpha=new ys(this),this.pixelStoreUnpackFlipY=new Io(this),this.extTextureFilterAnisotropic=o.getExtension("EXT_texture_filter_anisotropic")||o.getExtension("MOZ_EXT_texture_filter_anisotropic")||o.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=o.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extTextureHalfFloat=o.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(o.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=o.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=o.getExtension("OES_standard_derivatives"),this.extTimerQuery=o.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=o.getParameter(o.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(o,h){return new Cn(this,o,h)}createVertexBuffer(o,h,g){return new Wr(this,o,h,g)}createRenderbuffer(o,h,g){const x=this.gl,b=x.createRenderbuffer();return this.bindRenderbuffer.set(b),x.renderbufferStorage(x.RENDERBUFFER,o,h,g),this.bindRenderbuffer.set(null),b}createFramebuffer(o,h,g){return new V(this,o,h,g)}clear({color:o,depth:h,stencil:g}){const x=this.gl;let b=0;o&&(b|=x.COLOR_BUFFER_BIT,this.clearColor.set(o),this.colorMask.set([!0,!0,!0,!0])),h!==void 0&&(b|=x.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),g!==void 0&&(b|=x.STENCIL_BUFFER_BIT,this.clearStencil.set(g),this.stencilMask.set(255)),x.clear(b)}setCullFace(o){o.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(o.mode),this.frontFace.set(o.frontFace))}setDepthMode(o){o.func!==this.gl.ALWAYS||o.mask?(this.depthTest.set(!0),this.depthFunc.set(o.func),this.depthMask.set(o.mask),this.depthRange.set(o.range)):this.depthTest.set(!1)}setStencilMode(o){o.test.func!==this.gl.ALWAYS||o.mask?(this.stencilTest.set(!0),this.stencilMask.set(o.mask),this.stencilOp.set([o.fail,o.depthFail,o.pass]),this.stencilFunc.set({func:o.test.func,ref:o.ref,mask:o.test.mask})):this.stencilTest.set(!1)}setColorMode(o){P(o.blendFunction,a.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(o.blendFunction),this.blendColor.set(o.blendColor)),this.colorMask.set(o.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class ae extends a.Evented{constructor(o,h,g,x){super(),this.id=o,this.dispatcher=g,this.setEventedParent(x),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=a.extend({type:"raster"},h),a.extend(this,a.pick(h,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Wi(this._options,this.map._requestManager,null,null,(o,h)=>{this._tileJSONRequest=null,this._loaded=!0,o?this.fire(new a.ErrorEvent(o)):h&&(a.extend(this,h),h.bounds&&(this.tileBounds=new zr(h.bounds,this.minzoom,this.maxzoom)),a.postTurnstileEvent(h.tiles),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(o){this.map=o,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return a.extend({},this._options)}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}loadTile(o,h){const g=a.exported.devicePixelRatio>=2,x=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme),g,this.tileSize);o.request=a.getImage(this.map._requestManager.transformRequest(x,a.ResourceType.Tile),(b,S,A,I)=>(delete o.request,o.aborted?(o.state="unloaded",h(null)):b?(o.state="errored",h(b)):S?(this.map._refreshExpiredTiles&&o.setExpiryData({cacheControl:A,expires:I}),o.setTexture(S,this.map.painter),o.state="loaded",a.cacheEntryPossiblyAdded(this.dispatcher),void h(null)):h(null)))}static loadTileData(o,h,g){o.setTexture(h,g)}static unloadTileData(o,h){o.texture&&h.saveTileTexture(o.texture)}abortTile(o,h){o.request&&(o.request.cancel(),delete o.request),h()}unloadTile(o,h){o.texture&&this.map.painter.saveTileTexture(o.texture),h()}hasTransition(){return!1}}let ye;function Se(d,o,h,g,x,b,S,A){const I=[d,h,x,o,g,b,1,1,1],k=[S,A,1],R=a.adjoint([],I),[U,Z,J]=a.transformMat3(k,k,a.transpose(R,R));return a.multiply$1(I,[U,0,0,0,Z,0,0,0,J],I)}class Te extends a.Evented{constructor(o,h,g,x){super(),this.id=o,this.dispatcher=g,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(x),this.options=h}load(o,h){this._loaded=h||!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this.url=this.options.url,a.getImage(this.map._requestManager.transformRequest(this.url,a.ResourceType.Image),(g,x)=>{if(this._loaded=!0,g)this.fire(new a.ErrorEvent(g));else if(x){const{HTMLImageElement:b}=a.window;this.image=x instanceof b?a.exported.getImageData(x):x,this.width=this.image.width,this.height=this.image.height,o&&(this.coordinates=o),this._finishLoading()}})}loaded(){return this._loaded}updateImage(o){return this.image&&o.url?(this.options.url=o.url,this.load(o.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(o){this.map=o,this.load()}onRemove(){this.texture&&this.texture.destroy()}setCoordinates(o){this.coordinates=o,this._boundsArray=void 0;const h=o.map(a.MercatorCoordinate.fromLngLat);return this.tileID=function(g){let x=1/0,b=1/0,S=-1/0,A=-1/0;for(const U of g)x=Math.min(x,U.x),b=Math.min(b,U.y),S=Math.max(S,U.x),A=Math.max(A,U.y);const I=Math.max(S-x,A-b),k=Math.max(0,Math.floor(-Math.log(I)/Math.LN2)),R=Math.pow(2,k);return new a.CanonicalTileID(k,Math.floor((x+S)/2*R),Math.floor((b+A)/2*R))}(h),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(o){for(const I in this.tiles){const k=this.tiles[I];k.state!=="loaded"&&(k.state="loaded",k.texture=this.texture)}if(this._boundsArray)return;const h=a.tileTransform(this.tileID,this.map.transform.projection),[g,x,b,S]=this.coordinates.map(I=>{const k=h.projection.project(I[0],I[1]);return a.getTilePoint(h,k)._round()});this.perspectiveTransform=function(I,k,R,U,Z,J,H,Y,K,X){const ne=Se(0,0,I,0,0,k,I,k),ee=Se(R,U,Z,J,H,Y,K,X);return a.multiply$1(ee,a.adjoint(ne,ne),ee),[ee[6]/ee[8]*I/a.EXTENT,ee[7]/ee[8]*k/a.EXTENT]}(this.width,this.height,g.x,g.y,x.x,x.y,S.x,S.y,b.x,b.y);const A=this._boundsArray=new a.StructArrayLayout4i8;A.emplaceBack(g.x,g.y,0,0),A.emplaceBack(x.x,x.y,a.EXTENT,0),A.emplaceBack(S.x,S.y,0,a.EXTENT),A.emplaceBack(b.x,b.y,a.EXTENT,a.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=o.createVertexBuffer(A,a.boundsAttributes.members),this.boundsSegments=a.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const o=this.map.painter.context,h=o.gl;this.texture?this.texture.update(this.image):(this.texture=new a.Texture(o,this.image,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE)),this._prepareData(o)}loadTile(o,h){this.tileID&&this.tileID.equals(o.tileID.canonical)?(this.tiles[String(o.tileID.wrap)]=o,o.buckets={},h(null)):(o.state="errored",h(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const be={vector:class extends a.Evented{constructor(d,o,h,g){if(super(),this.id=d,this.dispatcher=h,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,a.extend(this,a.pick(o,["url","scheme","tileSize","promoteId"])),this._options=a.extend({type:"vector"},o),this._collectResourceTiming=o.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(g),this._tileWorkers={},this._deduped=new a.DedupedRequest}load(d){this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"}));const o=this.language||this.map._language,h=this.worldview||this.map._worldview;this._tileJSONRequest=Wi(this._options,this.map._requestManager,o,h,(g,x)=>{this._tileJSONRequest=null,this._loaded=!0,g?(o&&console.warn(`Ensure that your requested language string is a valid BCP-47 code. Found: ${o}`),h&&h.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${h}`),this.fire(new a.ErrorEvent(g))):x&&(a.extend(this,x),x.bounds&&(this.tileBounds=new zr(x.bounds,this.minzoom,this.maxzoom)),a.postTurnstileEvent(x.tiles,this.map._requestManager._customAccessToken),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"}))),d&&d(g)})}loaded(){return this._loaded}hasTile(d){return!this.tileBounds||this.tileBounds.contains(d.canonical)}onAdd(d){this.map=d,this.load()}setSourceProperty(d){this._tileJSONRequest&&this._tileJSONRequest.cancel(),d(),this.load(()=>{const o=this.map.style._getSourceCaches(this.id);for(const h of o)h.clearTiles()})}setTiles(d){return this.setSourceProperty(()=>{this._options.tiles=d}),this}setUrl(d){return this.setSourceProperty(()=>{this.url=d,this._options.url=d}),this}_setLanguage(d){return d===this.language||this.setSourceProperty(()=>{this.language=d}),this}_setWorldview(d){return d===this.worldview?this:this.worldviewOptions&&d&&!this.worldviewOptions[d]?(console.warn(`Vector tile source "${this.id}" does not support worldview "${d}".`),this):(this.setSourceProperty(()=>{this.worldview=d}),this)}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return a.extend({},this._options)}loadTile(d,o){const h=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme)),g={request:this.map._requestManager.transformRequest(h,a.ResourceType.Tile),data:void 0,uid:d.uid,tileID:d.tileID,tileZoom:d.tileZoom,zoom:d.tileID.overscaledZ,tileSize:this.tileSize*d.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:a.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:d.isSymbolTile};if(g.request.collectResourceTiming=this._collectResourceTiming,d.actor&&d.state!=="expired")d.state==="loading"?d.reloadCallback=o:d.request=d.actor.send("reloadTile",g,x.bind(this));else if(d.actor=this._tileWorkers[h]=this._tileWorkers[h]||this.dispatcher.getActor(),this.dispatcher.ready)d.request=d.actor.send("loadTile",g,x.bind(this),void 0,!0);else{const b=a.loadVectorTile.call({deduped:this._deduped},g,(S,A)=>{S||!A?x.call(this,S):(g.data={cacheControl:A.cacheControl,expires:A.expires,rawData:A.rawData.slice(0)},d.actor&&d.actor.send("loadTile",g,x.bind(this),void 0,!0))},!0);d.request={cancel:b}}function x(b,S){return delete d.request,d.aborted?o(null):b&&b.status!==404?o(b):(S&&S.resourceTiming&&(d.resourceTiming=S.resourceTiming),this.map._refreshExpiredTiles&&S&&d.setExpiryData(S),d.loadVectorData(S,this.map.painter),a.cacheEntryPossiblyAdded(this.dispatcher),o(null),void(d.reloadCallback&&(this.loadTile(d,d.reloadCallback),d.reloadCallback=null)))}}abortTile(d){d.request&&(d.request.cancel(),delete d.request),d.actor&&d.actor.send("abortTile",{uid:d.uid,type:this.type,source:this.id})}unloadTile(d){d.unloadVectorData(),d.actor&&d.actor.send("removeTile",{uid:d.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:ae,"raster-dem":class extends ae{constructor(d,o,h,g){super(d,o,h,g),this.type="raster-dem",this.maxzoom=22,this._options=a.extend({type:"raster-dem"},o),this.encoding=o.encoding||"mapbox"}loadTile(d,o){const h=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function g(x,b){x&&(d.state="errored",o(x)),b&&(d.dem=b,d.dem.onDeserialize(),d.needsHillshadePrepare=!0,d.needsDEMTextureUpload=!0,d.state="loaded",o(null))}d.request=a.getImage(this.map._requestManager.transformRequest(h,a.ResourceType.Tile),function(x,b,S,A){if(delete d.request,d.aborted)d.state="unloaded",o(null);else if(x)d.state="errored",o(x);else if(b){this.map._refreshExpiredTiles&&d.setExpiryData({cacheControl:S,expires:A});const I=a.window.ImageBitmap&&b instanceof a.window.ImageBitmap&&(ye==null&&(ye=a.window.OffscreenCanvas&&new a.window.OffscreenCanvas(1,1).getContext("2d")&&typeof a.window.createImageBitmap=="function"),ye),k=1-(b.width-a.prevPowerOfTwo(b.width))/2;k<1||d.neighboringTiles||(d.neighboringTiles=this._getNeighboringTiles(d.tileID));const R=I?b:a.exported.getImageData(b,k),U={uid:d.uid,coord:d.tileID,source:this.id,rawImageData:R,encoding:this.encoding,padding:k};d.actor&&d.state!=="expired"||(d.actor=this.dispatcher.getActor(),d.actor.send("loadDEMTile",U,g.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(d){const o=d.canonical,h=Math.pow(2,o.z),g=(o.x-1+h)%h,x=o.x===0?d.wrap-1:d.wrap,b=(o.x+1+h)%h,S=o.x+1===h?d.wrap+1:d.wrap,A={};return A[new a.OverscaledTileID(d.overscaledZ,x,o.z,g,o.y).key]={backfilled:!1},A[new a.OverscaledTileID(d.overscaledZ,S,o.z,b,o.y).key]={backfilled:!1},o.y>0&&(A[new a.OverscaledTileID(d.overscaledZ,x,o.z,g,o.y-1).key]={backfilled:!1},A[new a.OverscaledTileID(d.overscaledZ,d.wrap,o.z,o.x,o.y-1).key]={backfilled:!1},A[new a.OverscaledTileID(d.overscaledZ,S,o.z,b,o.y-1).key]={backfilled:!1}),o.y+1<h&&(A[new a.OverscaledTileID(d.overscaledZ,x,o.z,g,o.y+1).key]={backfilled:!1},A[new a.OverscaledTileID(d.overscaledZ,d.wrap,o.z,o.x,o.y+1).key]={backfilled:!1},A[new a.OverscaledTileID(d.overscaledZ,S,o.z,b,o.y+1).key]={backfilled:!1}),A}unloadTile(d){d.demTexture&&this.map.painter.saveTileTexture(d.demTexture),d.fbo&&(d.fbo.destroy(),delete d.fbo),d.dem&&delete d.dem,delete d.neighboringTiles,d.state="unloaded"}},geojson:class extends a.Evented{constructor(d,o,h,g){super(),this.id=d,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=h.getActor(),this.setEventedParent(g),this._data=o.data,this._options=a.extend({},o),this._collectResourceTiming=o.collectResourceTiming,o.maxzoom!==void 0&&(this.maxzoom=o.maxzoom),o.type&&(this.type=o.type),o.attribution&&(this.attribution=o.attribution),this.promoteId=o.promoteId;const x=a.EXTENT/this.tileSize;this.workerOptions=a.extend({source:this.id,cluster:o.cluster||!1,geojsonVtOptions:{buffer:(o.buffer!==void 0?o.buffer:128)*x,tolerance:(o.tolerance!==void 0?o.tolerance:.375)*x,extent:a.EXTENT,maxZoom:this.maxzoom,lineMetrics:o.lineMetrics||!1,generateId:o.generateId||!1},superclusterOptions:{maxZoom:o.clusterMaxZoom!==void 0?o.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,o.clusterMinPoints||2),extent:a.EXTENT,radius:(o.clusterRadius!==void 0?o.clusterRadius:50)*x,log:!1,generateId:o.generateId||!1},clusterProperties:o.clusterProperties,filter:o.filter},o.workerOptions)}onAdd(d){this.map=d,this.setData(this._data)}setData(d){return this._data=d,this._updateWorkerData(),this}getClusterExpansionZoom(d,o){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:d,source:this.id},o),this}getClusterChildren(d,o){return this.actor.send("geojson.getClusterChildren",{clusterId:d,source:this.id},o),this}getClusterLeaves(d,o,h,g){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:d,limit:o,offset:h},g),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new a.Event("dataloading",{dataType:"source"})),this._loaded=!1;const d=a.extend({},this.workerOptions),o=this._data;typeof o=="string"?(d.request=this.map._requestManager.transformRequest(a.exported.resolveURL(o),a.ResourceType.Source),d.request.collectResourceTiming=this._collectResourceTiming):d.data=JSON.stringify(o),this._pendingLoad=this.actor.send(`${this.type}.loadData`,d,(h,g)=>{if(this._loaded=!0,this._pendingLoad=null,h)this.fire(new a.ErrorEvent(h));else{const x={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&g&&g.resourceTiming&&g.resourceTiming[this.id]&&(x.resourceTiming=g.resourceTiming[this.id]),this.fire(new a.Event("data",x)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(d,o){const h=d.actor?"reloadTile":"loadTile";d.actor=this.actor,d.request=this.actor.send(h,{type:this.type,uid:d.uid,tileID:d.tileID,tileZoom:d.tileZoom,zoom:d.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:a.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(g,x)=>(delete d.request,d.unloadVectorData(),d.aborted?o(null):g?o(g):(d.loadVectorData(x,this.map.painter,h==="reloadTile"),o(null))),void 0,h==="loadTile")}abortTile(d){d.request&&(d.request.cancel(),delete d.request),d.aborted=!0}unloadTile(d){d.unloadVectorData(),this.actor.send("removeTile",{uid:d.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return a.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Te{constructor(d,o,h,g){super(d,o,h,g),this.roundZoom=!0,this.type="video",this.options=o}load(){this._loaded=!1;const d=this.options;this.urls=[];for(const o of d.urls)this.urls.push(this.map._requestManager.transformRequest(o,a.ResourceType.Source).url);a.getVideo(this.urls,(o,h)=>{this._loaded=!0,o?this.fire(new a.ErrorEvent(o)):h&&(this.video=h,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(d){if(this.video){const o=this.video.seekable;d<o.start(0)||d>o.end(0)?this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${o.start(0)} and ${o.end(0)}-second mark.`))):this.video.currentTime=d}}getVideo(){return this.video}onAdd(d){this.map||(this.map=d,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const d=this.map.painter.context,o=d.gl;this.texture?this.video.paused||(this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),o.texSubImage2D(o.TEXTURE_2D,0,0,0,o.RGBA,o.UNSIGNED_BYTE,this.video)):(this.texture=new a.Texture(d,this.video,o.RGBA),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(d)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Te,canvas:class extends Te{constructor(d,o,h,g){super(d,o,h,g),o.coordinates?Array.isArray(o.coordinates)&&o.coordinates.length===4&&!o.coordinates.some(x=>!Array.isArray(x)||x.length!==2||x.some(b=>typeof b!="number"))||this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${d}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${d}`,null,'missing required property "coordinates"'))),o.animate&&typeof o.animate!="boolean"&&this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${d}`,null,'optional "animate" property must be a boolean value'))),o.canvas?typeof o.canvas=="string"||o.canvas instanceof a.window.HTMLCanvasElement||this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${d}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${d}`,null,'missing required property "canvas"'))),this.options=o,this.animate=o.animate===void 0||o.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof a.window.HTMLCanvasElement?this.options.canvas:a.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(d){this.map=d,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let d=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,d=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,d=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const o=this.map.painter.context;this.texture?(d||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new a.Texture(o,this.canvas,o.gl.RGBA,{premultiply:!0}),this._prepareData(o)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const d of[this.canvas.width,this.canvas.height])if(isNaN(d)||d<=0)return!0;return!1}},custom:class extends a.Evented{constructor(d,o,h,g){super(),this.id=d,this.type="custom",this._dataType="raster",this._dispatcher=h,this._implementation=o,this.setEventedParent(g),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new a.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new a.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new zr(this._implementation.bounds,this.minzoom,this.maxzoom)),o.update=this._update.bind(this),o.coveringTiles=this._coveringTiles.bind(this),a.extend(this,a.pick(o,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return a.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(d){this._map=d,this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(d),this.load()}onRemove(d){this._implementation.onRemove&&this._implementation.onRemove(d)}hasTile(d){if(this._implementation.hasTile){const{x:o,y:h,z:g}=d.canonical;return this._implementation.hasTile({x:o,y:h,z:g})}return!this.tileBounds||this.tileBounds.contains(d.canonical)}loadTile(d,o){const{x:h,y:g,z:x}=d.tileID.canonical,b=new a.window.AbortController,S=this._implementation.loadTile({x:h,y:g,z:x},{signal:b.signal});if(!S)return this.loadTileData(d,{width:this.tileSize,height:this.tileSize,data:null}),d.state="loaded",o(null);S.cancel=()=>b.abort(),d.request=S.then(function(A){return delete d.request,d.aborted?(d.state="unloaded",o(null)):A?function(I){return I instanceof a.window.ImageData||I instanceof a.window.ImageBitmap||I instanceof a.window.HTMLCanvasElement}(A)?(this.loadTileData(d,A),d.state="loaded",void o(null)):(d.state="errored",o(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`))):(this.loadTileData(d,{width:this.tileSize,height:this.tileSize,data:null}),d.state="loaded",o(null))}.bind(this)).catch(A=>{A.code!==20&&(d.state="errored",o(A))})}loadTileData(d,o){ae.loadTileData(d,o,this._map.painter)}unloadTileData(d){ae.unloadTileData(d,this._map.painter)}prepareTile(d){if(!this._implementation.prepareTile)return null;const{x:o,y:h,z:g}=d.tileID.canonical,x=this._implementation.prepareTile({x:o,y:h,z:g});return x?(this.loadTileData(d,x),d.state="loaded",x):null}unloadTile(d,o){if(this.unloadTileData(d),this._implementation.unloadTile){const{x:h,y:g,z:x}=d.tileID.canonical;this._implementation.unloadTile({x:h,y:g,z:x})}o()}abortTile(d,o){d.request&&d.request.cancel&&(d.request.cancel(),delete d.request),o()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(d=>({x:d.canonical.x,y:d.canonical.y,z:d.canonical.z}))}_update(){this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"}))}}},Me=function(d,o,h,g){const x=new be[o.type](d,o,h,g);if(x.id!==d)throw new Error(`Expected Source id to be ${d} instead of ${x.id}`);return a.bindAll(["load","abort","unload","serialize","prepare"],x),x};function Xe(d,o){const h=a.identity([]);return a.scale(h,h,[.5*d.width,.5*-d.height,1]),a.translate(h,h,[1,-1,0]),a.multiply(h,h,d.calculateProjMatrix(o.toUnwrapped())),Float32Array.from(h)}function lt(d,o,h,g,x,b,S,A=!1){const I=d.tilesIn(g,S,A);I.sort(Tt);const k=[];for(const U of I)k.push({wrappedTileID:U.tile.tileID.wrapped().key,queryResults:U.tile.queryRenderedFeatures(o,h,d._state,U,x,b,Xe(d.transform,U.tile.tileID),A)});const R=function(U){const Z={},J={};for(const H of U){const Y=H.queryResults,K=H.wrappedTileID,X=J[K]=J[K]||{};for(const ne in Y){const ee=Y[ne],ve=X[ne]=X[ne]||{},ge=Z[ne]=Z[ne]||[];for(const ue of ee)ve[ue.featureIndex]||(ve[ue.featureIndex]=!0,ge.push(ue))}}return Z}(k);for(const U in R)R[U].forEach(Z=>{const J=Z.feature,H=J.layer;H&&H.type!=="background"&&H.type!=="sky"&&(J.source=H.source,H["source-layer"]&&(J.sourceLayer=H["source-layer"]),J.state=J.id!==void 0?d.getFeatureState(H["source-layer"],J.id):{})});return R}function Ke(d,o){const h=d.getRenderableIds().map(b=>d.getTileByID(b)),g=[],x={};for(let b=0;b<h.length;b++){const S=h[b],A=S.tileID.canonical.key;x[A]||(x[A]=!0,S.querySourceFeatures(g,o))}return g}function Tt(d,o){const h=d.tileID,g=o.tileID;return h.overscaledZ-g.overscaledZ||h.canonical.y-g.canonical.y||h.wrap-g.wrap||h.canonical.x-g.canonical.x}function Et(){return Va.workerClass!=null?new Va.workerClass:new a.window.Worker(Va.workerUrl)}const _t="mapboxgl_preloaded_worker_pool";class Pt{constructor(){this.active={}}acquire(o){if(!this.workers)for(this.workers=[];this.workers.length<Pt.workerCount;)this.workers.push(new Et);return this.active[o]=!0,this.workers.slice()}release(o){delete this.active[o],this.numActive()===0&&(this.workers.forEach(h=>{h.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[_t]}numActive(){return Object.keys(this.active).length}}let Bt;function Jt(){return Bt||(Bt=new Pt),Bt}function ri(d,o){const h={};for(const g in d)g!=="ref"&&(h[g]=d[g]);return a.refProperties.forEach(g=>{g in o&&(h[g]=o[g])}),h}function ni(d){d=d.slice();const o=Object.create(null);for(let h=0;h<d.length;h++)o[d[h].id]=d[h];for(let h=0;h<d.length;h++)"ref"in d[h]&&(d[h]=ri(d[h],o[d[h].ref]));return d}Pt.workerCount=2;const St={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Fe(d,o,h){h.push({command:St.addSource,args:[d,o[d]]})}function Ei(d,o,h){o.push({command:St.removeSource,args:[d]}),h[d]=!0}function ci(d,o,h,g){Ei(d,h,g),Fe(d,o,h)}function sr(d,o,h){let g;for(g in d[h])if(d[h].hasOwnProperty(g)&&g!=="data"&&!P(d[h][g],o[h][g]))return!1;for(g in o[h])if(o[h].hasOwnProperty(g)&&g!=="data"&&!P(d[h][g],o[h][g]))return!1;return!0}function Br(d,o,h,g,x,b){let S;for(S in o=o||{},d=d||{})d.hasOwnProperty(S)&&(P(d[S],o[S])||h.push({command:b,args:[g,S,o[S],x]}));for(S in o)o.hasOwnProperty(S)&&!d.hasOwnProperty(S)&&(P(d[S],o[S])||h.push({command:b,args:[g,S,o[S],x]}))}function or(d){return d.id}function Ar(d,o){return d[o.id]=o,d}class yn{constructor(o,h){this.reset(o,h)}reset(o,h){this.points=o||[],this._distances=[0];for(let g=1;g<this.points.length;g++)this._distances[g]=this._distances[g-1]+this.points[g].dist(this.points[g-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(o){if(this.points.length===1)return this.points[0];o=a.clamp(o,0,1);let h=1,g=this._distances[h];const x=o*this.paddedLength+this.padding;for(;g<x&&h<this._distances.length;)g=this._distances[++h];const b=h-1,S=this._distances[b],A=g-S,I=A>0?(x-S)/A:0;return this.points[b].mult(1-I).add(this.points[h].mult(I))}}class Xn{constructor(o,h,g){const x=this.boxCells=[],b=this.circleCells=[];this.xCellCount=Math.ceil(o/g),this.yCellCount=Math.ceil(h/g);for(let S=0;S<this.xCellCount*this.yCellCount;S++)x.push([]),b.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=o,this.height=h,this.xScale=this.xCellCount/o,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(o,h,g,x,b){this._forEachCell(h,g,x,b,this._insertBoxCell,this.boxUid++),this.boxKeys.push(o),this.bboxes.push(h),this.bboxes.push(g),this.bboxes.push(x),this.bboxes.push(b)}insertCircle(o,h,g,x){this._forEachCell(h-x,g-x,h+x,g+x,this._insertCircleCell,this.circleUid++),this.circleKeys.push(o),this.circles.push(h),this.circles.push(g),this.circles.push(x)}_insertBoxCell(o,h,g,x,b,S){this.boxCells[b].push(S)}_insertCircleCell(o,h,g,x,b,S){this.circleCells[b].push(S)}_query(o,h,g,x,b,S){if(g<0||o>this.width||x<0||h>this.height)return!b&&[];const A=[];if(o<=0&&h<=0&&this.width<=g&&this.height<=x){if(b)return!0;for(let I=0;I<this.boxKeys.length;I++)A.push({key:this.boxKeys[I],x1:this.bboxes[4*I],y1:this.bboxes[4*I+1],x2:this.bboxes[4*I+2],y2:this.bboxes[4*I+3]});for(let I=0;I<this.circleKeys.length;I++){const k=this.circles[3*I],R=this.circles[3*I+1],U=this.circles[3*I+2];A.push({key:this.circleKeys[I],x1:k-U,y1:R-U,x2:k+U,y2:R+U})}return S?A.filter(S):A}return this._forEachCell(o,h,g,x,this._queryCell,A,{hitTest:b,seenUids:{box:{},circle:{}}},S),b?A.length>0:A}_queryCircle(o,h,g,x,b){const S=o-g,A=o+g,I=h-g,k=h+g;if(A<0||S>this.width||k<0||I>this.height)return!x&&[];const R=[];return this._forEachCell(S,I,A,k,this._queryCellCircle,R,{hitTest:x,circle:{x:o,y:h,radius:g},seenUids:{box:{},circle:{}}},b),x?R.length>0:R}query(o,h,g,x,b){return this._query(o,h,g,x,!1,b)}hitTest(o,h,g,x,b){return this._query(o,h,g,x,!0,b)}hitTestCircle(o,h,g,x){return this._queryCircle(o,h,g,!0,x)}_queryCell(o,h,g,x,b,S,A,I){const k=A.seenUids,R=this.boxCells[b];if(R!==null){const Z=this.bboxes;for(const J of R)if(!k.box[J]){k.box[J]=!0;const H=4*J;if(o<=Z[H+2]&&h<=Z[H+3]&&g>=Z[H+0]&&x>=Z[H+1]&&(!I||I(this.boxKeys[J]))){if(A.hitTest)return S.push(!0),!0;S.push({key:this.boxKeys[J],x1:Z[H],y1:Z[H+1],x2:Z[H+2],y2:Z[H+3]})}}}const U=this.circleCells[b];if(U!==null){const Z=this.circles;for(const J of U)if(!k.circle[J]){k.circle[J]=!0;const H=3*J;if(this._circleAndRectCollide(Z[H],Z[H+1],Z[H+2],o,h,g,x)&&(!I||I(this.circleKeys[J]))){if(A.hitTest)return S.push(!0),!0;{const Y=Z[H],K=Z[H+1],X=Z[H+2];S.push({key:this.circleKeys[J],x1:Y-X,y1:K-X,x2:Y+X,y2:K+X})}}}}}_queryCellCircle(o,h,g,x,b,S,A,I){const k=A.circle,R=A.seenUids,U=this.boxCells[b];if(U!==null){const J=this.bboxes;for(const H of U)if(!R.box[H]){R.box[H]=!0;const Y=4*H;if(this._circleAndRectCollide(k.x,k.y,k.radius,J[Y+0],J[Y+1],J[Y+2],J[Y+3])&&(!I||I(this.boxKeys[H])))return S.push(!0),!0}}const Z=this.circleCells[b];if(Z!==null){const J=this.circles;for(const H of Z)if(!R.circle[H]){R.circle[H]=!0;const Y=3*H;if(this._circlesCollide(J[Y],J[Y+1],J[Y+2],k.x,k.y,k.radius)&&(!I||I(this.circleKeys[H])))return S.push(!0),!0}}}_forEachCell(o,h,g,x,b,S,A,I){const k=this._convertToXCellCoord(o),R=this._convertToYCellCoord(h),U=this._convertToXCellCoord(g),Z=this._convertToYCellCoord(x);for(let J=k;J<=U;J++)for(let H=R;H<=Z;H++)if(b.call(this,o,h,g,x,this.xCellCount*H+J,S,A,I))return}_convertToXCellCoord(o){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(o*this.xScale)))}_convertToYCellCoord(o){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(o*this.yScale)))}_circlesCollide(o,h,g,x,b,S){const A=x-o,I=b-h,k=g+S;return k*k>A*A+I*I}_circleAndRectCollide(o,h,g,x,b,S,A){const I=(S-x)/2,k=Math.abs(o-(x+I));if(k>I+g)return!1;const R=(A-b)/2,U=Math.abs(h-(b+R));if(U>R+g)return!1;if(k<=I||U<=R)return!0;const Z=k-I,J=U-R;return Z*Z+J*J<=g*g}}const ct=Math.tan(85*Math.PI/180);function Nt(d,o,h,g,x,b,S){const A=a.create();if(h)if(b.name==="globe"){const I=a.calculateGlobeLabelMatrix(x,o);a.multiply(A,A,I)}else{const I=Mt([],S);A[0]=I[0],A[1]=I[1],A[4]=I[2],A[5]=I[3],g||a.rotateZ(A,A,x.angle)}else a.multiply(A,x.labelPlaneMatrix,d);return A}function Lt(d,o,h,g,x,b,S){const A=Nt(d,o,h,g,x,b,S);return b.name==="globe"&&h||(A[2]=A[6]=A[10]=A[14]=0),A}function pr(d,o,h,g,x,b,S){if(h){if(b.name==="globe"){const A=Nt(d,o,h,g,x,b,S);return a.invert(A,A),a.multiply(A,d,A),A}{const A=a.clone(d),I=a.identity([]);return I[0]=S[0],I[1]=S[1],I[4]=S[2],I[5]=S[3],a.multiply(A,A,I),g||a.rotateZ(A,A,-x.angle),A}}return x.glCoordMatrix}function Mr(d,o,h=0){const g=[d.x,d.y,h,1];h?a.transformMat4$1(g,g,o):Q(g,g,o);const x=g[3];return{point:[g[0]/x,g[1]/x,g[2]/x],signedDistanceFromCamera:x}}function zt(d,o){const h=[d[0],d[1],d[2],1];a.transformMat4$1(h,h,o);const g=h[3];return{point:[h[0]/g,h[1]/g,h[2]/g],signedDistanceFromCamera:g}}function Hn(d,o){return Math.min(.5+d/o*.5,1.5)}function Yn(d,o){const h=d[0]/d[3],g=d[1]/d[3];return h>=-o[0]&&h<=o[0]&&g>=-o[1]&&g<=o[1]}function Rn(d,o,h,g,x,b,S,A,I,k){const R=h.transform,U=g?d.textSizeData:d.iconSizeData,Z=a.evaluateSizeForZoom(U,h.transform.zoom),J=R.projection.name==="globe",H=[256/h.width*2+1,256/h.height*2+1],Y=g?d.text.dynamicLayoutVertexArray:d.icon.dynamicLayoutVertexArray;Y.clear();let K=null;J&&(K=g?d.text.globeExtVertexArray:d.icon.globeExtVertexArray);const X=d.lineVertexArray,ne=g?d.text.placedSymbolArray:d.icon.placedSymbolArray,ee=h.transform.width/h.transform.height;let ve=!1;for(let ge=0;ge<ne.length;ge++){const ue=ne.get(ge);if(ue.writingMode!==a.WritingMode.vertical||ve||ge!==0&&ne.get(ge-1).writingMode===a.WritingMode.horizontal||(ve=!0),(ue.hidden||ue.writingMode===a.WritingMode.vertical)&&!ve){$(ue.numGlyphs,Y);continue}ve=!1;const _e=new a.pointGeometry(ue.tileAnchorX,ue.tileAnchorY),pe=I?I(_e):[0,0,0],we=R.projection.projectTilePoint(_e.x,_e.y,k.canonical),Ie=[we.x+pe[0],we.y+pe[1],we.z+pe[2]],Je=[...Ie,1];if(a.transformMat4$1(Je,Je,o),!Yn(Je,H)){$(ue.numGlyphs,Y);continue}const Ae=Hn(h.transform.cameraToCenterDistance,Je[3]),Ue=a.evaluateSizeForFeature(U,Z,ue),qe=S?Ue/Ae:Ue*Ae,rt=Mr(new a.pointGeometry(Ie[0],Ie[1]),x,Ie[2]);if(rt.signedDistanceFromCamera<=0){$(ue.numGlyphs,Y);continue}let Be={};const et=S?null:I,We=_a(ue,qe,!1,A,o,x,b,d.glyphOffsetArray,X,Y,K,rt.point,_e,Be,ee,et,R.projection,k,S);ve=We.useVertical,et&&We.needsFlipping&&(Be={}),(We.notEnoughRoom||ve||We.needsFlipping&&_a(ue,qe,!0,A,o,x,b,d.glyphOffsetArray,X,Y,K,rt.point,_e,Be,ee,et,R.projection,k,S).notEnoughRoom)&&$(ue.numGlyphs,Y)}g?(d.text.dynamicLayoutVertexBuffer.updateData(Y),K&&d.text.globeExtVertexBuffer.updateData(K)):(d.icon.dynamicLayoutVertexBuffer.updateData(Y),K&&d.icon.globeExtVertexBuffer.updateData(K))}function Ni(d,o,h,g,x,b,S,A,I,k,R,U,Z,J,H,Y){const K=A.glyphStartIndex+A.numGlyphs,X=A.lineStartIndex,ne=A.lineStartIndex+A.lineLength,ee=o.getoffsetX(A.glyphStartIndex),ve=o.getoffsetX(K-1),ge=Dn(d*ee,h,g,x,b,S,A.segment,X,ne,I,k,R,U,Z,!0,J,H,Y);if(!ge)return null;const ue=Dn(d*ve,h,g,x,b,S,A.segment,X,ne,I,k,R,U,Z,!0,J,H,Y);return ue?{first:ge,last:ue}:null}function vi(d,o,h,g){return d.writingMode===a.WritingMode.horizontal&&Math.abs(h.y-o.y)>Math.abs(h.x-o.x)*g?{useVertical:!0}:d.writingMode===a.WritingMode.vertical?o.y<h.y?{needsFlipping:!0}:null:d.flipState!==0&&function(x,b,S){const A=(b.x-x.x)*S;return A===0||Math.abs((b.y-x.y)/A)>ct}(o,h,g)?d.flipState===1?{needsFlipping:!0}:null:o.x>h.x?{needsFlipping:!0}:null}function _a(d,o,h,g,x,b,S,A,I,k,R,U,Z,J,H,Y,K,X,ne){const ee=o/24,ve=d.lineOffsetX*ee,ge=d.lineOffsetY*ee;let ue;if(d.numGlyphs>1){const _e=d.glyphStartIndex+d.numGlyphs,pe=d.lineStartIndex,we=d.lineStartIndex+d.lineLength,Ie=Ni(ee,A,ve,ge,h,U,Z,d,I,b,J,Y,!1,K,X,ne);if(!Ie)return{notEnoughRoom:!0};const Je=zt(Ie.first.point,S).point,Ae=zt(Ie.last.point,S).point,Ue=new a.pointGeometry(Je[0],Je[1]),qe=new a.pointGeometry(Ae[0],Ae[1]);if(g&&!h){const rt=vi(d,Ue,qe,H);if(d.flipState=rt&&rt.needsFlipping?1:2,rt)return rt}ue=[Ie.first];for(let rt=d.glyphStartIndex+1;rt<_e-1;rt++)ue.push(Dn(ee*A.getoffsetX(rt),ve,ge,h,U,Z,d.segment,pe,we,I,b,J,Y,!1,!1,K,X,ne));ue.push(Ie.last)}else{if(g&&!h){const pe=Mr(Z,x).point,we=d.lineStartIndex+d.segment+1,Ie=new a.pointGeometry(I.getx(we),I.gety(we)),Je=Mr(Ie,x),Ae=Je.signedDistanceFromCamera>0?Je.point:Xs(Z,Ie,pe,1,x,void 0,K,X.canonical),Ue=vi(d,new a.pointGeometry(pe[0],pe[1]),new a.pointGeometry(Ae[0],Ae[1]),H);if(d.flipState=Ue&&Ue.needsFlipping?1:2,Ue)return Ue}const _e=Dn(ee*A.getoffsetX(d.glyphStartIndex),ve,ge,h,U,Z,d.segment,d.lineStartIndex,d.lineStartIndex+d.lineLength,I,b,J,Y,!1,!1,K,X,ne);if(!_e)return{notEnoughRoom:!0};ue=[_e]}if(R)for(const _e of ue)a.updateGlobeVertexNormal(R,k.length+0,_e.up[0],_e.up[1],_e.up[2]),a.updateGlobeVertexNormal(R,k.length+1,_e.up[0],_e.up[1],_e.up[2]),a.updateGlobeVertexNormal(R,k.length+2,_e.up[0],_e.up[1],_e.up[2]),a.updateGlobeVertexNormal(R,k.length+3,_e.up[0],_e.up[1],_e.up[2]),a.addDynamicAttributes(k,_e.point[0],_e.point[1],_e.point[2],_e.angle);else for(const _e of ue)a.addDynamicAttributes(k,_e.point[0],_e.point[1],_e.point[2],_e.angle);return{}}function On(d,o,h,g,x){const b=g.projectTilePoint(d.x,d.y,o);if(!x)return Mr(b,h,b.z);const S=x(d);return Mr(new a.pointGeometry(b.x+S[0],b.y+S[1]),h,b.z+S[2])}function Xs(d,o,h,g,x,b,S,A){const I=On(d.add(d.sub(o)._unit()),A,x,S,b).point,k=a.sub([],h,I);return a.scaleAndAdd([],h,k,g/a.length(k))}function Dn(d,o,h,g,x,b,S,A,I,k,R,U,Z,J,H,Y,K,X){const ne=g?d-o:d+o;let ee=ne>0?1:-1,ve=0;g&&(ee*=-1,ve=Math.PI),ee<0&&(ve+=Math.PI);let ge=ee>0?A+S:A+S+1,ue=x,_e=x,pe=0,we=0;const Ie=Math.abs(ne),Je=[],Ae=[];let Ue=b;const qe=()=>{const vt=ge-ee;return pe===0?b:new a.pointGeometry(k.getx(vt),k.gety(vt))},rt=()=>Xs(qe(),Ue,_e,Ie-pe+1,R,Z,Y,K.canonical);for(;pe+we<=Ie;){if(ge+=ee,ge<A||ge>=I)return null;if(_e=ue,Je.push(ue),J&&Ae.push(Ue||qe()),ue=U[ge],ue===void 0){Ue=new a.pointGeometry(k.getx(ge),k.gety(ge));const vt=On(Ue,K.canonical,R,Y,Z);ue=vt.signedDistanceFromCamera>0?U[ge]=vt.point:rt()}else Ue=null;pe+=we,we=a.distance(_e,ue)}Ue=Ue||new a.pointGeometry(k.getx(ge),k.gety(ge));const Be=qe();H&&Z&&(U[ge]=ue=U[ge]===void 0?ue:rt(),we=a.distance(_e,ue));const et=(Ie-pe)/we,We=Ue.sub(Be).mult(et)._add(Be),at=a.sub([],ue,_e),st=a.scaleAndAdd([],_e,at,et);let yt=[0,0,1],At=at[0],kt=at[1];if(X&&(yt=Y.upVector(K.canonical,We.x,We.y),yt[0]!==0||yt[1]!==0||yt[2]!==1)){const vt=[1,0,0],Ft=[0,1,0];vt[0]=yt[2],vt[1]=0,vt[2]=-yt[0],a.cross(Ft,yt,vt),a.normalize(vt,vt),a.normalize(Ft,Ft),At=a.dot(at,vt),kt=a.dot(at,Ft)}if(h){const vt=a.cross([],yt,at);a.normalize(vt,vt),a.scaleAndAdd(st,st,vt,h*ee)}const Wt=ve+Math.atan2(kt,At);return Je.push(st),J&&Ae.push(We),{point:st,angle:Wt,path:Je,tilePath:Ae,up:yt}}const ya=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function $(d,o){for(let h=0;h<d;h++){const g=o.length;o.resize(g+4),o.float32.set(ya,4*g)}}function Q(d,o,h){const g=o[0],x=o[1];return d[0]=h[0]*g+h[4]*x+h[12],d[1]=h[1]*g+h[5]*x+h[13],d[3]=h[3]*g+h[7]*x+h[15],d}const ce=100;class De{constructor(o,h,g=new Xn(o.width+200,o.height+200,25),x=new Xn(o.width+200,o.height+200,25)){this.transform=o,this.grid=g,this.ignoredGrid=x,this.pitchfactor=Math.cos(o._pitch)*o.cameraToCenterDistance,this.screenRightBoundary=o.width+ce,this.screenBottomBoundary=o.height+ce,this.gridRightBoundary=o.width+200,this.gridBottomBoundary=o.height+200,this.fogState=h}placeCollisionBox(o,h,g,x,b,S,A,I){let k=g.projectedAnchorX,R=g.projectedAnchorY,U=g.projectedAnchorZ;const Z=g.elevation,J=g.tileID;if(Z&&J){const ge=o.getProjection().upVector(J.canonical,g.tileAnchorX,g.tileAnchorY),ue=o.getProjection().upVectorScale(J.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;k+=ge[0]*Z*ue,R+=ge[1]*Z*ue,U+=ge[2]*Z*ue}const H=this.projectAndGetPerspectiveRatio(A,[k,R,U],g.tileID,o.projection.name==="globe"||!!Z||this.transform.pitch>0,o.getProjection()),Y=S*H.perspectiveRatio,K=(g.x1*h+x.x-g.padding)*Y+H.point.x,X=(g.y1*h+x.y-g.padding)*Y+H.point.y,ne=(g.x2*h+x.x+g.padding)*Y+H.point.x,ee=(g.y2*h+x.y+g.padding)*Y+H.point.y,ve=H.perspectiveRatio<=.55||H.occluded;return!this.isInsideGrid(K,X,ne,ee)||!b&&this.grid.hitTest(K,X,ne,ee,I)||ve?{box:[],offscreen:!1,occluded:H.occluded}:{box:[K,X,ne,ee],offscreen:this.isOffscreen(K,X,ne,ee),occluded:!1}}placeCollisionCircles(o,h,g,x,b,S,A,I,k,R,U,Z,J,H,Y){const K=[],X=this.transform.elevation,ne=X?X.getAtTileOffsetFunc(Y,this.transform.center.lat,this.transform.worldSize,o.getProjection()):Be=>[0,0,0],ee=new a.pointGeometry(g.tileAnchorX,g.tileAnchorY),ve=o.getProjection().projectTilePoint(g.tileAnchorX,g.tileAnchorY,Y.canonical),ge=ne(ee),ue=[ve.x+ge[0],ve.y+ge[1],ve.z+ge[2]],_e=o.projection.name==="globe",pe=this.projectAndGetPerspectiveRatio(A,[ue[0],ue[1],ue[2]],Y,_e||!!X||this.transform.pitch>0,o.getProjection()),{perspectiveRatio:we}=pe,Ie=(U?S/we:S*we)/a.ONE_EM,Je=Mr(new a.pointGeometry(ue[0],ue[1]),I,ue[2]).point,Ae=pe.signedDistanceFromCamera>0?Ni(Ie,b,g.lineOffsetX*Ie,g.lineOffsetY*Ie,!1,Je,ee,g,x,I,{},X&&!U?ne:null,U&&!!X,o.getProjection(),Y,U):null;let Ue=!1,qe=!1,rt=!0;if(Ae&&!pe.occluded){const Be=.5*J*we+H,et=new a.pointGeometry(-100,-100),We=new a.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),at=new yn,st=Ae.first,yt=Ae.last;let At=[];for(let vt=st.path.length-1;vt>=1;vt--)At.push(st.path[vt]);for(let vt=1;vt<yt.path.length;vt++)At.push(yt.path[vt]);const kt=2.5*Be;if(k){const vt=At.map(X&&!_e?(Ft,ei)=>{const xi=ne(ei<st.path.length-1?st.tilePath[st.path.length-1-ei]:yt.tilePath[ei-st.path.length+2]);return Ft[2]=xi[2],zt(Ft,k)}:Ft=>zt(Ft,k));At=vt.some(Ft=>Ft.signedDistanceFromCamera<=0)?[]:vt.map(Ft=>Ft.point)}let Wt=[];if(At.length>0){const vt=At.map(ui=>new a.pointGeometry(ui[0],ui[1]));let Ft=1/0,ei=-1/0,xi=1/0,Di=-1/0;for(let ui=0;ui<vt.length;ui++)Ft=Math.min(Ft,vt[ui].x),xi=Math.min(xi,vt[ui].y),ei=Math.max(ei,vt[ui].x),Di=Math.max(Di,vt[ui].y);Wt=Ft>=et.x&&ei<=We.x&&xi>=et.y&&Di<=We.y?[vt]:ei<et.x||Ft>We.x||Di<et.y||xi>We.y?[]:a.clipLine([vt],et.x,et.y,We.x,We.y)}for(const vt of Wt){at.reset(vt,.25*Be);let Ft=0;Ft=at.length<=.5*Be?1:Math.ceil(at.paddedLength/kt)+1;for(let ei=0;ei<Ft;ei++){const xi=ei/Math.max(Ft-1,1),Di=at.lerp(xi),ui=Di.x+ce,lr=Di.y+ce;K.push(ui,lr,Be,0);const bn=ui-Be,es=lr-Be,bi=ui+Be,Ai=lr+Be;if(rt=rt&&this.isOffscreen(bn,es,bi,Ai),qe=qe||this.isInsideGrid(bn,es,bi,Ai),!h&&this.grid.hitTestCircle(ui,lr,Be,Z)&&(Ue=!0,!R))return{circles:[],offscreen:!1,collisionDetected:Ue,occluded:!1}}}}return{circles:!R&&Ue||!qe?[]:K,offscreen:rt,collisionDetected:Ue,occluded:pe.occluded}}queryRenderedSymbols(o){if(o.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const h=[];let g=1/0,x=1/0,b=-1/0,S=-1/0;for(const R of o){const U=new a.pointGeometry(R.x+ce,R.y+ce);g=Math.min(g,U.x),x=Math.min(x,U.y),b=Math.max(b,U.x),S=Math.max(S,U.y),h.push(U)}const A=this.grid.query(g,x,b,S).concat(this.ignoredGrid.query(g,x,b,S)),I={},k={};for(const R of A){const U=R.key;if(I[U.bucketInstanceId]===void 0&&(I[U.bucketInstanceId]={}),I[U.bucketInstanceId][U.featureIndex])continue;const Z=[new a.pointGeometry(R.x1,R.y1),new a.pointGeometry(R.x2,R.y1),new a.pointGeometry(R.x2,R.y2),new a.pointGeometry(R.x1,R.y2)];a.polygonIntersectsPolygon(h,Z)&&(I[U.bucketInstanceId][U.featureIndex]=!0,k[U.bucketInstanceId]===void 0&&(k[U.bucketInstanceId]=[]),k[U.bucketInstanceId].push(U.featureIndex))}return k}insertCollisionBox(o,h,g,x,b){(h?this.ignoredGrid:this.grid).insert({bucketInstanceId:g,featureIndex:x,collisionGroupID:b},o[0],o[1],o[2],o[3])}insertCollisionCircles(o,h,g,x,b){const S=h?this.ignoredGrid:this.grid,A={bucketInstanceId:g,featureIndex:x,collisionGroupID:b};for(let I=0;I<o.length;I+=4)S.insertCircle(A,o[I],o[I+1],o[I+2])}projectAndGetPerspectiveRatio(o,h,g,x,b){const S=[h[0],h[1],h[2],1];let A=!1;if(h[2]||this.transform.pitch>0){a.transformMat4$1(S,S,o);const I=b.name==="globe";this.fogState&&g&&!I&&(A=function(k,R,U,Z,J,H){const Y=H.calculateFogTileMatrix(J),K=[R,U,Z];return a.transformMat4(K,K,Y),Zr(k,K,H.pitch,H._fov)}(this.fogState,h[0],h[1],h[2],g.toUnwrapped(),this.transform)>.9)}else Q(S,S,o);return{point:new a.pointGeometry((S[0]/S[3]+1)/2*this.transform.width+ce,(-S[1]/S[3]+1)/2*this.transform.height+ce),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(b)/S[3]*.5,1.5),signedDistanceFromCamera:S[3],occluded:x&&S[2]>S[3]||A}}isOffscreen(o,h,g,x){return g<ce||o>=this.screenRightBoundary||x<ce||h>this.screenBottomBoundary}isInsideGrid(o,h,g,x){return g>=0&&o<this.gridRightBoundary&&x>=0&&h<this.gridBottomBoundary}getViewportMatrix(){const o=a.identity([]);return a.translate(o,o,[-100,-100,0]),o}}function tt(d,o,h){const g=o.createTileMatrix(d,d.worldSize,h.toUnwrapped());return a.multiply(new Float32Array(16),d.projMatrix,g)}function dt(d,o,h){if(o.projection.name===h.projection.name)return d.projMatrix;const g=h.clone();return g.setProjection(o.projection),tt(g,o.getProjection(),d)}function Rt(d,o,h){return o.name===h.projection.name?d.projMatrix:tt(h,o,d)}class Ui{constructor(o,h,g,x){this.opacity=o?Math.max(0,Math.min(1,o.opacity+(o.placed?h:-h))):x&&g?1:0,this.placed=g}isHidden(){return this.opacity===0&&!this.placed}}class Si{constructor(o,h,g,x,b,S=!1){this.text=new Ui(o?o.text:null,h,g,b),this.icon=new Ui(o?o.icon:null,h,x,b),this.clipped=S}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Kt{constructor(o,h,g,x=!1){this.text=o,this.icon=h,this.skipFade=g,this.clipped=x}}class mr{constructor(){this.invProjMatrix=a.create(),this.viewportMatrix=a.create(),this.circles=[]}}class Nc{constructor(o,h,g,x,b){this.bucketInstanceId=o,this.featureIndex=h,this.sourceLayerIndex=g,this.bucketIndex=x,this.tileID=b}}class va{constructor(o){this.crossSourceCollisions=o,this.maxGroupID=0,this.collisionGroups={}}get(o){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[o]){const h=++this.maxGroupID;this.collisionGroups[o]={ID:h,predicate:g=>g.collisionGroupID===h}}return this.collisionGroups[o]}}function Ji(d,o,h,g,x){const{horizontalAlign:b,verticalAlign:S}=a.getAnchorAlignment(d),A=-(b-.5)*o,I=-(S-.5)*h,k=a.evaluateVariableOffset(d,g);return new a.pointGeometry(A+k[0]*x,I+k[1]*x)}function xa(d,o,h,g,x){const b=new a.pointGeometry(d,o);return h&&b._rotate(g?x:-x),b}class Uc{constructor(o,h,g,x,b){this.transform=o.clone(),this.projection=o.projection.name,this.collisionIndex=new De(this.transform,b),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=h,this.retainedQueryData={},this.collisionGroups=new va(g),this.collisionCircleArrays={},this.prevPlacement=x,x&&(x.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(o,h,g,x){const b=g.getBucket(h),S=g.latestFeatureIndex;if(!b||!S||h.id!==b.layerIds[0])return;const A=b.layers[0].layout,I=g.collisionBoxArray,k=Math.pow(2,this.transform.zoom-g.tileID.overscaledZ),R=g.tileSize/a.EXTENT,U=g.tileID.toUnwrapped();this.transform.setProjection(b.projection);const Z=(J=g.tileID,H=b.getProjection(),Y=this.transform,H.name===this.projection?Y.calculateProjMatrix(J.toUnwrapped()):tt(Y,H,J));var J,H,Y;const K=A.get("text-pitch-alignment")==="map",X=A.get("text-rotation-alignment")==="map";h.compileFilter();const ne=h.dynamicFilter(),ee=h.dynamicFilterNeedsFeature(),ve=this.transform.calculatePixelsToTileUnitsMatrix(g),ge=Lt(Z,g.tileID.canonical,K,X,this.transform,b.getProjection(),ve);let ue=null;if(K){const we=pr(Z,g.tileID.canonical,K,X,this.transform,b.getProjection(),ve);ue=a.multiply([],this.transform.labelPlaneMatrix,we)}let _e=null;ne&&g.latestFeatureIndex&&(_e={unwrappedTileID:U,dynamicFilter:ne,dynamicFilterNeedsFeature:ee,featureIndex:g.latestFeatureIndex}),this.retainedQueryData[b.bucketInstanceId]=new Nc(b.bucketInstanceId,S,b.sourceLayerIndex,b.index,g.tileID);const pe={bucket:b,layout:A,posMatrix:Z,textLabelPlaneMatrix:ge,labelToScreenMatrix:ue,clippingData:_e,scale:k,textPixelRatio:R,holdingForFade:g.holdingForFade(),collisionBoxArray:I,partiallyEvaluatedTextSize:a.evaluateSizeForZoom(b.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:a.evaluateSizeForZoom(b.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(b.sourceID)};if(x)for(const we of b.sortKeyRanges){const{sortKey:Ie,symbolInstanceStart:Je,symbolInstanceEnd:Ae}=we;o.push({sortKey:Ie,symbolInstanceStart:Je,symbolInstanceEnd:Ae,parameters:pe})}else o.push({symbolInstanceStart:0,symbolInstanceEnd:b.symbolInstances.length,parameters:pe})}attemptAnchorPlacement(o,h,g,x,b,S,A,I,k,R,U,Z,J,H,Y,K,X,ne){const ee=[Z.textOffset0,Z.textOffset1],ve=Ji(o,g,x,ee,b),ge=this.collisionIndex.placeCollisionBox(H,b,h,xa(ve.x,ve.y,S,A,this.transform.angle),U,I,k,R.predicate);if((!K||this.collisionIndex.placeCollisionBox(H,H.getSymbolInstanceIconSize(ne,this.transform.zoom,J),K,xa(ve.x,ve.y,S,A,this.transform.angle),U,I,k,R.predicate).box.length!==0)&&ge.box.length>0){let ue;return this.prevPlacement&&this.prevPlacement.variableOffsets[Z.crossTileID]&&this.prevPlacement.placements[Z.crossTileID]&&this.prevPlacement.placements[Z.crossTileID].text&&(ue=this.prevPlacement.variableOffsets[Z.crossTileID].anchor),this.variableOffsets[Z.crossTileID]={textOffset:ee,width:g,height:x,anchor:o,textScale:b,prevAnchor:ue},this.markUsedJustification(H,o,Z,Y),H.allowVerticalPlacement&&(this.markUsedOrientation(H,Y,Z),this.placedOrientations[Z.crossTileID]=Y),{shift:ve,placedGlyphBoxes:ge}}}placeLayerBucketPart(o,h,g,x){const{bucket:b,layout:S,posMatrix:A,textLabelPlaneMatrix:I,labelToScreenMatrix:k,clippingData:R,textPixelRatio:U,holdingForFade:Z,collisionBoxArray:J,partiallyEvaluatedTextSize:H,partiallyEvaluatedIconSize:Y,collisionGroup:K}=o.parameters,X=S.get("text-optional"),ne=S.get("icon-optional"),ee=S.get("text-allow-overlap"),ve=S.get("icon-allow-overlap"),ge=S.get("text-rotation-alignment")==="map",ue=S.get("text-pitch-alignment")==="map",_e=S.get("icon-text-fit")!=="none",pe=S.get("symbol-z-order")==="viewport-y";this.transform.setProjection(b.projection);let we=ee&&(ve||!b.hasIconData()||ne),Ie=ve&&(ee||!b.hasTextData()||X);!b.collisionArrays&&J&&b.deserializeCollisionBoxes(J),g&&x&&b.updateCollisionDebugBuffers(this.transform.zoom,J);const Je=(Ae,Ue,qe)=>{if(R){const bi={zoom:this.transform.zoom,pitch:this.transform.pitch};let Ai=null;if(R.dynamicFilterNeedsFeature){const Zt=this.retainedQueryData[b.bucketInstanceId];Ai=R.featureIndex.loadFeature({featureIndex:Ae.featureIndex,bucketIndex:Zt.bucketIndex,sourceLayerIndex:Zt.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,R.dynamicFilter)(bi,Ai,this.retainedQueryData[b.bucketInstanceId].tileID.canonical,new a.pointGeometry(Ae.tileAnchorX,Ae.tileAnchorY),this.transform.calculateDistanceTileData(R.unwrappedTileID)))return this.placements[Ae.crossTileID]=new Kt(!1,!1,!1,!0),void(h[Ae.crossTileID]=!0)}if(h[Ae.crossTileID])return;if(Z)return void(this.placements[Ae.crossTileID]=new Kt(!1,!1,!1));let rt=!1,Be=!1,et=!0,We=!1,at=!1,st=null,yt={box:null,offscreen:null,occluded:null},At={box:null,offscreen:null,occluded:null},kt=null,Wt=null,vt=null,Ft=0,ei=0,xi=0;qe.textFeatureIndex?Ft=qe.textFeatureIndex:Ae.useRuntimeCollisionCircles&&(Ft=Ae.featureIndex),qe.verticalTextFeatureIndex&&(ei=qe.verticalTextFeatureIndex);const Di=bi=>{bi.tileID=this.retainedQueryData[b.bucketInstanceId].tileID,(this.transform.elevation||bi.elevation)&&(bi.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[b.bucketInstanceId].tileID,bi.tileAnchorX,bi.tileAnchorY):0)},ui=qe.textBox;if(ui){Di(ui);const bi=Zt=>{let Gi=a.WritingMode.horizontal;if(b.allowVerticalPlacement&&!Zt&&this.prevPlacement){const _r=this.prevPlacement.placedOrientations[Ae.crossTileID];_r&&(this.placedOrientations[Ae.crossTileID]=_r,Gi=_r,this.markUsedOrientation(b,Gi,Ae))}return Gi},Ai=(Zt,Gi)=>{if(b.allowVerticalPlacement&&Ae.numVerticalGlyphVertices>0&&qe.verticalTextBox){for(const _r of b.writingModes)if(_r===a.WritingMode.vertical?(yt=Gi(),At=yt):yt=Zt(),yt&&yt.box&&yt.box.length)break}else yt=Zt()};if(S.get("text-variable-anchor")){let Zt=S.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Ae.crossTileID]){const pi=this.prevPlacement.variableOffsets[Ae.crossTileID];Zt.indexOf(pi.anchor)>0&&(Zt=Zt.filter(yr=>yr!==pi.anchor),Zt.unshift(pi.anchor))}const Gi=(pi,yr,Qs)=>{const Pr=b.getSymbolInstanceTextSize(H,Ae,this.transform.zoom,Ue),eo=(pi.x2-pi.x1)*Pr+2*pi.padding,to=(pi.y2-pi.y1)*Pr+2*pi.padding,io=_e&&!ve?yr:null;io&&Di(io);let Ir={box:[],offscreen:!1,occluded:!1};const ro=ee?2*Zt.length:Zt.length;for(let Ts=0;Ts<ro;++Ts){const Ga=this.attemptAnchorPlacement(Zt[Ts%Zt.length],pi,eo,to,Pr,ge,ue,U,A,K,Ts>=Zt.length,Ae,Ue,b,Qs,io,H,Y);if(Ga&&(Ir=Ga.placedGlyphBoxes,Ir&&Ir.box&&Ir.box.length)){rt=!0,st=Ga.shift;break}}return Ir};Ai(()=>Gi(ui,qe.iconBox,a.WritingMode.horizontal),()=>{const pi=qe.verticalTextBox;return pi&&Di(pi),b.allowVerticalPlacement&&!(yt&&yt.box&&yt.box.length)&&Ae.numVerticalGlyphVertices>0&&pi?Gi(pi,qe.verticalIconBox,a.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),yt&&(rt=yt.box,et=yt.offscreen,We=yt.occluded);const _r=bi(yt&&yt.box);if(!rt&&this.prevPlacement){const pi=this.prevPlacement.variableOffsets[Ae.crossTileID];pi&&(this.variableOffsets[Ae.crossTileID]=pi,this.markUsedJustification(b,pi.anchor,Ae,_r))}}else{const Zt=(Gi,_r)=>{const pi=b.getSymbolInstanceTextSize(H,Ae,this.transform.zoom,Ue),yr=this.collisionIndex.placeCollisionBox(b,pi,Gi,new a.pointGeometry(0,0),ee,U,A,K.predicate);return yr&&yr.box&&yr.box.length&&(this.markUsedOrientation(b,_r,Ae),this.placedOrientations[Ae.crossTileID]=_r),yr};Ai(()=>Zt(ui,a.WritingMode.horizontal),()=>{const Gi=qe.verticalTextBox;return b.allowVerticalPlacement&&Ae.numVerticalGlyphVertices>0&&Gi?(Di(Gi),Zt(Gi,a.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),bi(yt&&yt.box&&yt.box.length)}}if(kt=yt,rt=kt&&kt.box&&kt.box.length>0,et=kt&&kt.offscreen,We=kt&&kt.occluded,Ae.useRuntimeCollisionCircles){const bi=b.text.placedSymbolArray.get(Ae.centerJustifiedTextSymbolIndex>=0?Ae.centerJustifiedTextSymbolIndex:Ae.verticalPlacedTextSymbolIndex),Ai=a.evaluateSizeForFeature(b.textSizeData,H,bi),Zt=S.get("text-padding");Wt=this.collisionIndex.placeCollisionCircles(b,ee,bi,b.lineVertexArray,b.glyphOffsetArray,Ai,A,I,k,g,ue,K.predicate,Ae.collisionCircleDiameter*Ai/a.ONE_EM,Zt,this.retainedQueryData[b.bucketInstanceId].tileID),rt=ee||Wt.circles.length>0&&!Wt.collisionDetected,et=et&&Wt.offscreen,We=Wt.occluded}if(qe.iconFeatureIndex&&(xi=qe.iconFeatureIndex),qe.iconBox){const bi=Ai=>{Di(Ai);const Zt=_e&&st?xa(st.x,st.y,ge,ue,this.transform.angle):new a.pointGeometry(0,0),Gi=b.getSymbolInstanceIconSize(Y,this.transform.zoom,Ue);return this.collisionIndex.placeCollisionBox(b,Gi,Ai,Zt,ve,U,A,K.predicate)};At&&At.box&&At.box.length&&qe.verticalIconBox?(vt=bi(qe.verticalIconBox),Be=vt.box.length>0):(vt=bi(qe.iconBox),Be=vt.box.length>0),et=et&&vt.offscreen,at=vt.occluded}const lr=X||Ae.numHorizontalGlyphVertices===0&&Ae.numVerticalGlyphVertices===0,bn=ne||Ae.numIconVertices===0;if(lr||bn?bn?lr||(Be=Be&&rt):rt=Be&&rt:Be=rt=Be&&rt,rt&&kt&&kt.box&&this.collisionIndex.insertCollisionBox(kt.box,S.get("text-ignore-placement"),b.bucketInstanceId,At&&At.box&&ei?ei:Ft,K.ID),Be&&vt&&this.collisionIndex.insertCollisionBox(vt.box,S.get("icon-ignore-placement"),b.bucketInstanceId,xi,K.ID),Wt&&(rt&&this.collisionIndex.insertCollisionCircles(Wt.circles,S.get("text-ignore-placement"),b.bucketInstanceId,Ft,K.ID),g)){const bi=b.bucketInstanceId;let Ai=this.collisionCircleArrays[bi];Ai===void 0&&(Ai=this.collisionCircleArrays[bi]=new mr);for(let Zt=0;Zt<Wt.circles.length;Zt+=4)Ai.circles.push(Wt.circles[Zt+0]),Ai.circles.push(Wt.circles[Zt+1]),Ai.circles.push(Wt.circles[Zt+2]),Ai.circles.push(Wt.collisionDetected?1:0)}const es=b.projection.name!=="globe";we=we&&(es||!We),Ie=Ie&&(es||!at),this.placements[Ae.crossTileID]=new Kt(rt||we,Be||Ie,et||b.justReloaded),h[Ae.crossTileID]=!0};if(pe){const Ae=b.getSortedSymbolIndexes(this.transform.angle);for(let Ue=Ae.length-1;Ue>=0;--Ue){const qe=Ae[Ue];Je(b.symbolInstances.get(qe),qe,b.collisionArrays[qe])}}else for(let Ae=o.symbolInstanceStart;Ae<o.symbolInstanceEnd;Ae++)Je(b.symbolInstances.get(Ae),Ae,b.collisionArrays[Ae]);if(g&&b.bucketInstanceId in this.collisionCircleArrays){const Ae=this.collisionCircleArrays[b.bucketInstanceId];a.invert(Ae.invProjMatrix,A),Ae.viewportMatrix=this.collisionIndex.getViewportMatrix()}b.justReloaded=!1}markUsedJustification(o,h,g,x){let b;b=x===a.WritingMode.vertical?g.verticalPlacedTextSymbolIndex:{left:g.leftJustifiedTextSymbolIndex,center:g.centerJustifiedTextSymbolIndex,right:g.rightJustifiedTextSymbolIndex}[a.getAnchorJustification(h)];const S=[g.leftJustifiedTextSymbolIndex,g.centerJustifiedTextSymbolIndex,g.rightJustifiedTextSymbolIndex,g.verticalPlacedTextSymbolIndex];for(const A of S)A>=0&&(o.text.placedSymbolArray.get(A).crossTileID=b>=0&&A!==b?0:g.crossTileID)}markUsedOrientation(o,h,g){const x=h===a.WritingMode.horizontal||h===a.WritingMode.horizontalOnly?h:0,b=h===a.WritingMode.vertical?h:0,S=[g.leftJustifiedTextSymbolIndex,g.centerJustifiedTextSymbolIndex,g.rightJustifiedTextSymbolIndex];for(const A of S)o.text.placedSymbolArray.get(A).placedOrientation=x;g.verticalPlacedTextSymbolIndex&&(o.text.placedSymbolArray.get(g.verticalPlacedTextSymbolIndex).placedOrientation=b)}commit(o){this.commitTime=o,this.zoomAtLastRecencyCheck=this.transform.zoom;const h=this.prevPlacement;let g=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;const x=h?h.symbolFadeChange(o):1,b=h?h.opacities:{},S=h?h.variableOffsets:{},A=h?h.placedOrientations:{};for(const I in this.placements){const k=this.placements[I],R=b[I];R?(this.opacities[I]=new Si(R,x,k.text,k.icon,null,k.clipped),g=g||k.text!==R.text.placed||k.icon!==R.icon.placed):(this.opacities[I]=new Si(null,x,k.text,k.icon,k.skipFade,k.clipped),g=g||k.text||k.icon)}for(const I in b){const k=b[I];if(!this.opacities[I]){const R=new Si(k,x,!1,!1);R.isHidden()||(this.opacities[I]=R,g=g||k.text.placed||k.icon.placed)}}for(const I in S)this.variableOffsets[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.variableOffsets[I]=S[I]);for(const I in A)this.placedOrientations[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.placedOrientations[I]=A[I]);g?this.lastPlacementChangeTime=o:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:o)}updateLayerOpacities(o,h){const g={};for(const x of h){const b=x.getBucket(o);b&&x.latestFeatureIndex&&o.id===b.layerIds[0]&&this.updateBucketOpacities(b,g,x.collisionBoxArray)}}updateBucketOpacities(o,h,g){o.hasTextData()&&o.text.opacityVertexArray.clear(),o.hasIconData()&&o.icon.opacityVertexArray.clear(),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexArray.clear(),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexArray.clear();const x=o.layers[0].layout,b=!!o.layers[0].dynamicFilter(),S=new Si(null,0,!1,!1,!0),A=x.get("text-allow-overlap"),I=x.get("icon-allow-overlap"),k=x.get("text-variable-anchor"),R=x.get("text-rotation-alignment")==="map",U=x.get("text-pitch-alignment")==="map",Z=x.get("icon-text-fit")!=="none",J=new Si(null,0,A&&(I||!o.hasIconData()||x.get("icon-optional")),I&&(A||!o.hasTextData()||x.get("text-optional")),!0);!o.collisionArrays&&g&&(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData())&&o.deserializeCollisionBoxes(g);const H=(K,X,ne)=>{for(let ee=0;ee<X/4;ee++)K.opacityVertexArray.emplaceBack(ne)};let Y=0;for(let K=0;K<o.symbolInstances.length;K++){const X=o.symbolInstances.get(K),{numHorizontalGlyphVertices:ne,numVerticalGlyphVertices:ee,crossTileID:ve}=X;let ge=this.opacities[ve];h[ve]?ge=S:ge||(ge=J,this.opacities[ve]=ge),h[ve]=!0;const ue=ne>0||ee>0,_e=X.numIconVertices>0,pe=this.placedOrientations[X.crossTileID],we=pe===a.WritingMode.vertical,Ie=pe===a.WritingMode.horizontal||pe===a.WritingMode.horizontalOnly;if(!ue&&!_e||ge.isHidden()||Y++,ue){const Je=Hs(ge.text);H(o.text,ne,we?vn:Je),H(o.text,ee,Ie?vn:Je);const Ae=ge.text.isHidden();[X.rightJustifiedTextSymbolIndex,X.centerJustifiedTextSymbolIndex,X.leftJustifiedTextSymbolIndex].forEach(rt=>{rt>=0&&(o.text.placedSymbolArray.get(rt).hidden=Ae||we?1:0)}),X.verticalPlacedTextSymbolIndex>=0&&(o.text.placedSymbolArray.get(X.verticalPlacedTextSymbolIndex).hidden=Ae||Ie?1:0);const Ue=this.variableOffsets[X.crossTileID];Ue&&this.markUsedJustification(o,Ue.anchor,X,pe);const qe=this.placedOrientations[X.crossTileID];qe&&(this.markUsedJustification(o,"left",X,qe),this.markUsedOrientation(o,qe,X))}if(_e){const Je=Hs(ge.icon);X.placedIconSymbolIndex>=0&&(H(o.icon,X.numIconVertices,we?vn:Je),o.icon.placedSymbolArray.get(X.placedIconSymbolIndex).hidden=ge.icon.isHidden()),X.verticalPlacedIconSymbolIndex>=0&&(H(o.icon,X.numVerticalIconVertices,Ie?vn:Je),o.icon.placedSymbolArray.get(X.verticalPlacedIconSymbolIndex).hidden=ge.icon.isHidden())}if(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData()){const Je=o.collisionArrays[K];if(Je){let Ae=new a.pointGeometry(0,0),Ue=!0;if(Je.textBox||Je.verticalTextBox){if(k){const rt=this.variableOffsets[ve];rt?(Ae=Ji(rt.anchor,rt.width,rt.height,rt.textOffset,rt.textScale),R&&Ae._rotate(U?this.transform.angle:-this.transform.angle)):Ue=!1}b&&(Ue=!ge.clipped),Je.textBox&&nn(o.textCollisionBox.collisionVertexArray,ge.text.placed,!Ue||we,Ae.x,Ae.y),Je.verticalTextBox&&nn(o.textCollisionBox.collisionVertexArray,ge.text.placed,!Ue||Ie,Ae.x,Ae.y)}const qe=Ue&&!!(!Ie&&Je.verticalIconBox);Je.iconBox&&nn(o.iconCollisionBox.collisionVertexArray,ge.icon.placed,qe,Z?Ae.x:0,Z?Ae.y:0),Je.verticalIconBox&&nn(o.iconCollisionBox.collisionVertexArray,ge.icon.placed,!qe,Z?Ae.x:0,Z?Ae.y:0)}}}if(o.fullyClipped=Y===0,o.sortFeatures(this.transform.angle),this.retainedQueryData[o.bucketInstanceId]&&(this.retainedQueryData[o.bucketInstanceId].featureSortOrder=o.featureSortOrder),o.hasTextData()&&o.text.opacityVertexBuffer&&o.text.opacityVertexBuffer.updateData(o.text.opacityVertexArray),o.hasIconData()&&o.icon.opacityVertexBuffer&&o.icon.opacityVertexBuffer.updateData(o.icon.opacityVertexArray),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexBuffer&&o.iconCollisionBox.collisionVertexBuffer.updateData(o.iconCollisionBox.collisionVertexArray),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexBuffer&&o.textCollisionBox.collisionVertexBuffer.updateData(o.textCollisionBox.collisionVertexArray),o.bucketInstanceId in this.collisionCircleArrays){const K=this.collisionCircleArrays[o.bucketInstanceId];o.placementInvProjMatrix=K.invProjMatrix,o.placementViewportMatrix=K.viewportMatrix,o.collisionCircleArray=K.circles,delete this.collisionCircleArrays[o.bucketInstanceId]}}symbolFadeChange(o){return this.fadeDuration===0?1:(o-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(o){return Math.max(0,(this.transform.zoom-o)/1.5)}hasTransitions(o){return this.stale||o-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(o,h){const g=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*g>o}setStale(){this.stale=!0}}function nn(d,o,h,g,x){d.emplaceBack(o?1:0,h?1:0,g||0,x||0),d.emplaceBack(o?1:0,h?1:0,g||0,x||0),d.emplaceBack(o?1:0,h?1:0,g||0,x||0),d.emplaceBack(o?1:0,h?1:0,g||0,x||0)}const ba=Math.pow(2,25),gl=Math.pow(2,24),_p=Math.pow(2,17),jc=Math.pow(2,16),Co=Math.pow(2,9),yp=Math.pow(2,8),Zh=Math.pow(2,1);function Hs(d){if(d.opacity===0&&!d.placed)return 0;if(d.opacity===1&&d.placed)return 4294967295;const o=d.placed?1:0,h=Math.floor(127*d.opacity);return h*ba+o*gl+h*_p+o*jc+h*Co+o*yp+h*Zh+o}const vn=0;class _l{constructor(o){this._sortAcrossTiles=o.layout.get("symbol-z-order")!=="viewport-y"&&o.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(o,h,g,x,b){const S=this._bucketParts;for(;this._currentTileIndex<o.length;)if(h.getBucketParts(S,x,o[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,b())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,S.sort((A,I)=>A.sortKey-I.sortKey));this._currentPartIndex<S.length;){const A=S[this._currentPartIndex];if(h.placeLayerBucketPart(A,this._seenCrossTileIDs,g,A.symbolInstanceStart===0),this._currentPartIndex++,b())return!0}return!1}}class vs{constructor(o,h,g,x,b,S,A,I){this.placement=new Uc(o,b,S,A,I),this._currentPlacementIndex=h.length-1,this._forceFullPlacement=g,this._showCollisionBoxes=x,this._done=!1}isDone(){return this._done}continuePlacement(o,h,g){const x=a.exported.now(),b=()=>{const S=a.exported.now()-x;return!this._forceFullPlacement&&S>2};for(;this._currentPlacementIndex>=0;){const S=h[o[this._currentPlacementIndex]],A=this.placement.collisionIndex.transform.zoom;if(S.type==="symbol"&&(!S.minzoom||S.minzoom<=A)&&(!S.maxzoom||S.maxzoom>A)){if(this._inProgressLayer||(this._inProgressLayer=new _l(S)),this._inProgressLayer.continuePlacement(g[S.source],this.placement,this._showCollisionBoxes,S,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(o){return this.placement.commit(o),this.placement}}const Vc=512/a.EXTENT/2;class yl{constructor(o,h,g){this.tileID=o,this.indexedSymbolInstances={},this.bucketInstanceId=g;for(let x=0;x<h.length;x++){const b=h.get(x),S=b.key;this.indexedSymbolInstances[S]||(this.indexedSymbolInstances[S]=[]),this.indexedSymbolInstances[S].push({crossTileID:b.crossTileID,coord:this.getScaledCoordinates(b,o)})}}getScaledCoordinates(o,h){const g=Vc/Math.pow(2,h.canonical.z-this.tileID.canonical.z);return{x:Math.floor((h.canonical.x*a.EXTENT+o.tileAnchorX)*g),y:Math.floor((h.canonical.y*a.EXTENT+o.tileAnchorY)*g)}}findMatches(o,h,g){const x=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z);for(let b=0;b<o.length;b++){const S=o.get(b);if(S.crossTileID)continue;const A=this.indexedSymbolInstances[S.key];if(!A)continue;const I=this.getScaledCoordinates(S,h);for(const k of A)if(Math.abs(k.coord.x-I.x)<=x&&Math.abs(k.coord.y-I.y)<=x&&!g[k.crossTileID]){g[k.crossTileID]=!0,S.crossTileID=k.crossTileID;break}}}}class vp{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class xp{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(o){const h=Math.round((o-this.lng)/360);if(h!==0)for(const g in this.indexes){const x=this.indexes[g],b={};for(const S in x){const A=x[S];A.tileID=A.tileID.unwrapTo(A.tileID.wrap+h),b[A.tileID.key]=A}this.indexes[g]=b}this.lng=o}addBucket(o,h,g){if(this.indexes[o.overscaledZ]&&this.indexes[o.overscaledZ][o.key]){if(this.indexes[o.overscaledZ][o.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(o.overscaledZ,this.indexes[o.overscaledZ][o.key])}for(let b=0;b<h.symbolInstances.length;b++)h.symbolInstances.get(b).crossTileID=0;this.usedCrossTileIDs[o.overscaledZ]||(this.usedCrossTileIDs[o.overscaledZ]={});const x=this.usedCrossTileIDs[o.overscaledZ];for(const b in this.indexes){const S=this.indexes[b];if(Number(b)>o.overscaledZ)for(const A in S){const I=S[A];I.tileID.isChildOf(o)&&I.findMatches(h.symbolInstances,o,x)}else{const A=S[o.scaledTo(Number(b)).key];A&&A.findMatches(h.symbolInstances,o,x)}}for(let b=0;b<h.symbolInstances.length;b++){const S=h.symbolInstances.get(b);S.crossTileID||(S.crossTileID=g.generate(),x[S.crossTileID]=!0)}return this.indexes[o.overscaledZ]===void 0&&(this.indexes[o.overscaledZ]={}),this.indexes[o.overscaledZ][o.key]=new yl(o,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(o,h){for(const g in h.indexedSymbolInstances)for(const x of h.indexedSymbolInstances[g])delete this.usedCrossTileIDs[o][x.crossTileID]}removeStaleBuckets(o){let h=!1;for(const g in this.indexes){const x=this.indexes[g];for(const b in x)o[x[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(g,x[b]),delete x[b],h=!0)}return h}}class vl{constructor(){this.layerIndexes={},this.crossTileIDs=new vp,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(o,h,g,x){let b=this.layerIndexes[o.id];b===void 0&&(b=this.layerIndexes[o.id]=new xp);let S=!1;const A={};x.name!=="globe"&&b.handleWrapJump(g);for(const I of h){const k=I.getBucket(o);k&&o.id===k.layerIds[0]&&(k.bucketInstanceId||(k.bucketInstanceId=++this.maxBucketInstanceId),b.addBucket(I.tileID,k,this.crossTileIDs)&&(S=!0),A[k.bucketInstanceId]=!0)}return b.removeStaleBuckets(A)&&(S=!0),S}pruneUnusedLayers(o){const h={};o.forEach(g=>{h[g]=!0});for(const g in this.layerIndexes)h[g]||delete this.layerIndexes[g]}}const xl=(d,o)=>a.emitValidationErrors(d,o&&o.filter(h=>h.identifier!=="source.canvas")),$h=a.pick(St,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),bp=a.pick(St,["setCenter","setZoom","setBearing","setPitch"]),Wh={version:8,layers:[],sources:{}},wp={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class sn extends a.Evented{constructor(o,h={}){super(),this.map=o,this.dispatcher=new $i(Jt(),this),this.imageManager=new Ht,this.imageManager.setEventedParent(this),this.glyphManager=new a.GlyphManager(o._requestManager,h.localFontFamily?a.LocalGlyphMode.all:h.localIdeographFontFamily?a.LocalGlyphMode.ideographs:a.LocalGlyphMode.none,h.localFontFamily||h.localIdeographFontFamily),this.lineAtlas=new a.LineAtlas(256,512),this.crossTileSymbolIndex=new vl,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new a.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",a.getReferrer());const g=this;this._rtlTextPluginCallback=sn.registerForPluginStateChange(x=>{g.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:x.pluginStatus,pluginURL:x.pluginURL},(b,S)=>{if(a.triggerPluginCompletionEvent(b),S&&S.every(A=>A))for(const A in g._sourceCaches){const I=g._sourceCaches[A],k=I.getSource().type;k!=="vector"&&k!=="geojson"||I.reload()}})}),this.on("data",x=>{if(x.dataType!=="source"||x.sourceDataType!=="metadata")return;const b=this.getSource(x.sourceId);if(b&&b.vectorLayerIds)for(const S in this._layers){const A=this._layers[S];A.source===b.id&&this._validateLayer(A)}})}loadURL(o,h={}){this.fire(new a.Event("dataloading",{dataType:"style"}));const g=typeof h.validate=="boolean"?h.validate:!a.isMapboxURL(o);o=this.map._requestManager.normalizeStyleURL(o,h.accessToken);const x=this.map._requestManager.transformRequest(o,a.ResourceType.Style);this._request=a.getJSON(x,(b,S)=>{this._request=null,b?this.fire(new a.ErrorEvent(b)):S&&this._load(S,g)})}loadJSON(o,h={}){this.fire(new a.Event("dataloading",{dataType:"style"})),this._request=a.exported.frame(()=>{this._request=null,this._load(o,h.validate!==!1)})}loadEmpty(){this.fire(new a.Event("dataloading",{dataType:"style"})),this._load(Wh,!1)}_updateLayerCount(o,h){const g=h?1:-1;o.is3D()&&(this._num3DLayers+=g),o.type==="circle"&&(this._numCircleLayers+=g),o.type==="symbol"&&(this._numSymbolLayers+=g)}_load(o,h){if(h&&xl(this,a.validateStyle(o)))return;this._loaded=!0,this.stylesheet=a.clone$1(o),this._updateMapProjection();for(const x in o.sources)this.addSource(x,o.sources[x],{validate:!1});this._changed=!1,o.sprite?this._loadSprite(o.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(o.glyphs);const g=ni(this.stylesheet.layers);this._order=g.map(x=>x.id),this._layers={},this._serializedLayers={};for(let x of g)x=a.createStyleLayer(x),x.setEventedParent(this,{layer:{id:x.id}}),this._layers[x.id]=x,this._serializedLayers[x.id]=x.serialize(),this._updateLayerCount(x,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Ki(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new a.Event("data",{dataType:"style"})),this.fire(new a.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}setProjection(o){o?this.stylesheet.projection=o:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(o){this._spriteRequest=function(h,g,x){let b,S,A;const I=a.exported.devicePixelRatio>1?"@2x":"";let k=a.getJSON(g.transformRequest(g.normalizeSpriteURL(h,I,".json"),a.ResourceType.SpriteJSON),(Z,J)=>{k=null,A||(A=Z,b=J,U())}),R=a.getImage(g.transformRequest(g.normalizeSpriteURL(h,I,".png"),a.ResourceType.SpriteImage),(Z,J)=>{R=null,A||(A=Z,S=J,U())});function U(){if(A)x(A);else if(b&&S){const Z=a.exported.getImageData(S),J={};for(const H in b){const{width:Y,height:K,x:X,y:ne,sdf:ee,pixelRatio:ve,stretchX:ge,stretchY:ue,content:_e}=b[H],pe=new a.RGBAImage({width:Y,height:K});a.RGBAImage.copy(Z,pe,{x:X,y:ne},{x:0,y:0},{width:Y,height:K}),J[H]={data:pe,pixelRatio:ve,sdf:ee,stretchX:ge,stretchY:ue,content:_e}}x(null,J)}}return{cancel(){k&&(k.cancel(),k=null),R&&(R.cancel(),R=null)}}}(o,this.map._requestManager,(h,g)=>{if(this._spriteRequest=null,h)this.fire(new a.ErrorEvent(h));else if(g)for(const x in g)this.imageManager.addImage(x,g[x]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new a.Event("data",{dataType:"style"}))})}_validateLayer(o){const h=this.getSource(o.source);if(!h)return;const g=o.sourceLayer;g&&(h.type==="geojson"||h.vectorLayerIds&&h.vectorLayerIds.indexOf(g)===-1)&&this.fire(new a.ErrorEvent(new Error(`Source layer "${g}" does not exist on source "${h.id}" as specified by style layer "${o.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const o in this._sourceCaches)if(!this._sourceCaches[o].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(o){const h=[];for(const g of o){const x=this._layers[g];x.type!=="custom"&&h.push(x.serialize())}return h}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const o in this._sourceCaches)if(this._sourceCaches[o].hasTransition())return!0;for(const o in this._layers)if(this._layers[o].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(o){return!!this.terrain&&wp[o.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(o){if(!this._loaded)return;const h=this._changed;if(this._changed){const x=Object.keys(this._updatedLayers),b=Object.keys(this._removedLayers);(x.length||b.length)&&this._updateWorkerLayers(x,b);for(const S in this._updatedSources){const A=this._updatedSources[S];A==="reload"?this._reloadSource(S):A==="clear"&&this._clearSource(S)}this._updateTilesForChangedImages();for(const S in this._updatedPaintProps)this._layers[S].updateTransitions(o);this.light.updateTransitions(o),this.fog&&this.fog.updateTransitions(o),this._resetUpdates()}const g={};for(const x in this._sourceCaches){const b=this._sourceCaches[x];g[x]=b.used,b.used=!1}for(const x of this._order){const b=this._layers[x];if(b.recalculate(o,this._availableImages),!b.isHidden(o.zoom)){const A=this._getLayerSourceCache(b);A&&(A.used=!0)}const S=this.map.painter;if(S){const A=b.getProgramIds();if(!A)continue;const I=b.getProgramConfiguration(o.zoom);for(const k of A)S.useProgram(k,I)}}for(const x in g){const b=this._sourceCaches[x];g[x]!==b.used&&b.getSource().fire(new a.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:b.getSource().id}))}this.light.recalculate(o),this.terrain&&this.terrain.recalculate(o),this.fog&&this.fog.recalculate(o),this.z=o.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),h&&this.fire(new a.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const o=Object.keys(this._changedImages);if(o.length){for(const h in this._sourceCaches)this._sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],o);this._changedImages={}}}_updateWorkerLayers(o,h){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(o),removedIds:h})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(o){if(this._checkLoaded(),xl(this,a.validateStyle(o)))return!1;(o=a.clone$1(o)).layers=ni(o.layers);const h=function(x,b){if(!x)return[{command:St.setStyle,args:[b]}];let S=[];try{if(!P(x.version,b.version))return[{command:St.setStyle,args:[b]}];P(x.center,b.center)||S.push({command:St.setCenter,args:[b.center]}),P(x.zoom,b.zoom)||S.push({command:St.setZoom,args:[b.zoom]}),P(x.bearing,b.bearing)||S.push({command:St.setBearing,args:[b.bearing]}),P(x.pitch,b.pitch)||S.push({command:St.setPitch,args:[b.pitch]}),P(x.sprite,b.sprite)||S.push({command:St.setSprite,args:[b.sprite]}),P(x.glyphs,b.glyphs)||S.push({command:St.setGlyphs,args:[b.glyphs]}),P(x.transition,b.transition)||S.push({command:St.setTransition,args:[b.transition]}),P(x.light,b.light)||S.push({command:St.setLight,args:[b.light]}),P(x.fog,b.fog)||S.push({command:St.setFog,args:[b.fog]}),P(x.projection,b.projection)||S.push({command:St.setProjection,args:[b.projection]});const A={},I=[];(function(U,Z,J,H){let Y;for(Y in Z=Z||{},U=U||{})U.hasOwnProperty(Y)&&(Z.hasOwnProperty(Y)||Ei(Y,J,H));for(Y in Z)Z.hasOwnProperty(Y)&&(U.hasOwnProperty(Y)?P(U[Y],Z[Y])||(U[Y].type==="geojson"&&Z[Y].type==="geojson"&&sr(U,Z,Y)?J.push({command:St.setGeoJSONSourceData,args:[Y,Z[Y].data]}):ci(Y,Z,J,H)):Fe(Y,Z,J))})(x.sources,b.sources,I,A);const k=[];x.layers&&x.layers.forEach(U=>{U.source&&A[U.source]?S.push({command:St.removeLayer,args:[U.id]}):k.push(U)});let R=x.terrain;R&&A[R.source]&&(S.push({command:St.setTerrain,args:[void 0]}),R=void 0),S=S.concat(I),P(R,b.terrain)||S.push({command:St.setTerrain,args:[b.terrain]}),function(U,Z,J){Z=Z||[];const H=(U=U||[]).map(or),Y=Z.map(or),K=U.reduce(Ar,{}),X=Z.reduce(Ar,{}),ne=H.slice(),ee=Object.create(null);let ve,ge,ue,_e,pe,we,Ie;for(ve=0,ge=0;ve<H.length;ve++)ue=H[ve],X.hasOwnProperty(ue)?ge++:(J.push({command:St.removeLayer,args:[ue]}),ne.splice(ne.indexOf(ue,ge),1));for(ve=0,ge=0;ve<Y.length;ve++)ue=Y[Y.length-1-ve],ne[ne.length-1-ve]!==ue&&(K.hasOwnProperty(ue)?(J.push({command:St.removeLayer,args:[ue]}),ne.splice(ne.lastIndexOf(ue,ne.length-ge),1)):ge++,we=ne[ne.length-ve],J.push({command:St.addLayer,args:[X[ue],we]}),ne.splice(ne.length-ve,0,ue),ee[ue]=!0);for(ve=0;ve<Y.length;ve++)if(ue=Y[ve],_e=K[ue],pe=X[ue],!ee[ue]&&!P(_e,pe))if(P(_e.source,pe.source)&&P(_e["source-layer"],pe["source-layer"])&&P(_e.type,pe.type)){for(Ie in Br(_e.layout,pe.layout,J,ue,null,St.setLayoutProperty),Br(_e.paint,pe.paint,J,ue,null,St.setPaintProperty),P(_e.filter,pe.filter)||J.push({command:St.setFilter,args:[ue,pe.filter]}),P(_e.minzoom,pe.minzoom)&&P(_e.maxzoom,pe.maxzoom)||J.push({command:St.setLayerZoomRange,args:[ue,pe.minzoom,pe.maxzoom]}),_e)_e.hasOwnProperty(Ie)&&Ie!=="layout"&&Ie!=="paint"&&Ie!=="filter"&&Ie!=="metadata"&&Ie!=="minzoom"&&Ie!=="maxzoom"&&(Ie.indexOf("paint.")===0?Br(_e[Ie],pe[Ie],J,ue,Ie.slice(6),St.setPaintProperty):P(_e[Ie],pe[Ie])||J.push({command:St.setLayerProperty,args:[ue,Ie,pe[Ie]]}));for(Ie in pe)pe.hasOwnProperty(Ie)&&!_e.hasOwnProperty(Ie)&&Ie!=="layout"&&Ie!=="paint"&&Ie!=="filter"&&Ie!=="metadata"&&Ie!=="minzoom"&&Ie!=="maxzoom"&&(Ie.indexOf("paint.")===0?Br(_e[Ie],pe[Ie],J,ue,Ie.slice(6),St.setPaintProperty):P(_e[Ie],pe[Ie])||J.push({command:St.setLayerProperty,args:[ue,Ie,pe[Ie]]}))}else J.push({command:St.removeLayer,args:[ue]}),we=ne[ne.lastIndexOf(ue)+1],J.push({command:St.addLayer,args:[pe,we]})}(k,b.layers,S)}catch(A){console.warn("Unable to compute style diff:",A),S=[{command:St.setStyle,args:[b]}]}return S}(this.serialize(),o).filter(x=>!(x.command in bp));if(h.length===0)return!1;const g=h.filter(x=>!(x.command in $h));if(g.length>0)throw new Error(`Unimplemented: ${g.map(x=>x.command).join(", ")}.`);return h.forEach(x=>{x.command!=="setTransition"&&x.command!=="setProjection"&&this[x.command].apply(this,x.args)}),this.stylesheet=o,this._updateMapProjection(),!0}addImage(o,h){return this.getImage(o)?this.fire(new a.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(o,h),this._afterImageUpdated(o),this)}updateImage(o,h){this.imageManager.updateImage(o,h)}getImage(o){return this.imageManager.getImage(o)}removeImage(o){return this.getImage(o)?(this.imageManager.removeImage(o),this._afterImageUpdated(o),this):this.fire(new a.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(o){this._availableImages=this.imageManager.listImages(),this._changedImages[o]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new a.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(o,h,g={}){if(this._checkLoaded(),this.getSource(o)!==void 0)throw new Error("There is already a source with this ID");if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(a.validateSource,`sources.${o}`,h,null,g))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);const x=Me(o,h,this.dispatcher,this);x.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(o),source:x.serialize(),sourceId:o}));const b=S=>{const A=(S?"symbol:":"other:")+o,I=this._sourceCaches[A]=new a.SourceCache(A,x,S);(S?this._symbolSourceCaches:this._otherSourceCaches)[o]=I,I.style=this,I.onAdd(this.map)};b(!1),h.type!=="vector"&&h.type!=="geojson"||b(!0),x.onAdd&&x.onAdd(this.map),this._changed=!0}removeSource(o){this._checkLoaded();const h=this.getSource(o);if(!h)throw new Error("There is no source with this ID");for(const x in this._layers)if(this._layers[x].source===o)return this.fire(new a.ErrorEvent(new Error(`Source "${o}" cannot be removed while layer "${x}" is using it.`)));if(this.terrain&&this.terrain.get().source===o)return this.fire(new a.ErrorEvent(new Error(`Source "${o}" cannot be removed while terrain is using it.`)));const g=this._getSourceCaches(o);for(const x of g)delete this._sourceCaches[x.id],delete this._updatedSources[x.id],x.fire(new a.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:x.getSource().id})),x.setEventedParent(null),x.clearTiles();return delete this._otherSourceCaches[o],delete this._symbolSourceCaches[o],h.setEventedParent(null),h.onRemove&&h.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(o,h){this._checkLoaded(),this.getSource(o).setData(h),this._changed=!0}getSource(o){const h=this._getSourceCache(o);return h&&h.getSource()}addLayer(o,h,g={}){this._checkLoaded();const x=o.id;if(this.getLayer(x))return void this.fire(new a.ErrorEvent(new Error(`Layer with id "${x}" already exists on this map`)));let b;if(o.type==="custom"){if(xl(this,a.validateCustomStyleLayer(o)))return;b=a.createStyleLayer(o)}else{if(typeof o.source=="object"&&(this.addSource(x,o.source),o=a.clone$1(o),o=a.extend(o,{source:x})),this._validate(a.validateLayer,`layers.${x}`,o,{arrayIndex:-1},g))return;b=a.createStyleLayer(o),this._validateLayer(b),b.setEventedParent(this,{layer:{id:x}}),this._serializedLayers[b.id]=b.serialize(),this._updateLayerCount(b,!0)}const S=h?this._order.indexOf(h):this._order.length;if(h&&S===-1)return void this.fire(new a.ErrorEvent(new Error(`Layer with id "${h}" does not exist on this map.`)));this._order.splice(S,0,x),this._layerOrderChanged=!0,this._layers[x]=b;const A=this._getLayerSourceCache(b);if(this._removedLayers[x]&&b.source&&A&&b.type!=="custom"){const I=this._removedLayers[x];delete this._removedLayers[x],I.type!==b.type?this._updatedSources[b.source]="clear":(this._updatedSources[b.source]="reload",A.pause())}this._updateLayer(b),b.onAdd&&b.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(o,h){if(this._checkLoaded(),this._changed=!0,!this._layers[o])return void this.fire(new a.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be moved.`)));if(o===h)return;const g=this._order.indexOf(o);this._order.splice(g,1);const x=h?this._order.indexOf(h):this._order.length;h&&x===-1?this.fire(new a.ErrorEvent(new Error(`Layer with id "${h}" does not exist on this map.`))):(this._order.splice(x,0,o),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(o){this._checkLoaded();const h=this._layers[o];if(!h)return void this.fire(new a.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be removed.`)));h.setEventedParent(null),this._updateLayerCount(h,!1);const g=this._order.indexOf(o);this._order.splice(g,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[o]=h,delete this._layers[o],delete this._serializedLayers[o],delete this._updatedLayers[o],delete this._updatedPaintProps[o],h.onRemove&&h.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(o){return this._layers[o]}hasLayer(o){return o in this._layers}hasLayerType(o){for(const h in this._layers)if(this._layers[h].type===o)return!0;return!1}setLayerZoomRange(o,h,g){this._checkLoaded();const x=this.getLayer(o);x?x.minzoom===h&&x.maxzoom===g||(h!=null&&(x.minzoom=h),g!=null&&(x.maxzoom=g),this._updateLayer(x)):this.fire(new a.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(o,h,g={}){this._checkLoaded();const x=this.getLayer(o);if(x){if(!P(x.filter,h))return h==null?(x.filter=void 0,void this._updateLayer(x)):void(this._validate(a.validateFilter,`layers.${x.id}.filter`,h,{layerType:x.type},g)||(x.filter=a.clone$1(h),this._updateLayer(x)))}else this.fire(new a.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be filtered.`)))}getFilter(o){const h=this.getLayer(o);return h&&a.clone$1(h.filter)}setLayoutProperty(o,h,g,x={}){this._checkLoaded();const b=this.getLayer(o);b?P(b.getLayoutProperty(h),g)||(b.setLayoutProperty(h,g,x),this._updateLayer(b)):this.fire(new a.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(o,h){const g=this.getLayer(o);if(g)return g.getLayoutProperty(h);this.fire(new a.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style.`)))}setPaintProperty(o,h,g,x={}){this._checkLoaded();const b=this.getLayer(o);b?P(b.getPaintProperty(h),g)||(b.setPaintProperty(h,g,x)&&this._updateLayer(b),this._changed=!0,this._updatedPaintProps[o]=!0):this.fire(new a.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(o,h){const g=this.getLayer(o);return g&&g.getPaintProperty(h)}setFeatureState(o,h){this._checkLoaded();const g=o.source,x=o.sourceLayer,b=this.getSource(g);if(!b)return void this.fire(new a.ErrorEvent(new Error(`The source '${g}' does not exist in the map's style.`)));const S=b.type;if(S==="geojson"&&x)return void this.fire(new a.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(S==="vector"&&!x)return void this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));o.id===void 0&&this.fire(new a.ErrorEvent(new Error("The feature id parameter must be provided.")));const A=this._getSourceCaches(g);for(const I of A)I.setFeatureState(x,o.id,h)}removeFeatureState(o,h){this._checkLoaded();const g=o.source,x=this.getSource(g);if(!x)return void this.fire(new a.ErrorEvent(new Error(`The source '${g}' does not exist in the map's style.`)));const b=x.type,S=b==="vector"?o.sourceLayer:void 0;if(b==="vector"&&!S)return void this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(h&&typeof o.id!="string"&&typeof o.id!="number")return void this.fire(new a.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const A=this._getSourceCaches(g);for(const I of A)I.removeFeatureState(S,o.id,h)}getFeatureState(o){this._checkLoaded();const h=o.source,g=o.sourceLayer,x=this.getSource(h);if(x){if(x.type!=="vector"||g)return o.id===void 0&&this.fire(new a.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(h)[0].getFeatureState(g,o.id);this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new a.ErrorEvent(new Error(`The source '${h}' does not exist in the map's style.`)))}getTransition(){return a.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const o={};for(const h in this._sourceCaches){const g=this._sourceCaches[h].getSource();o[g.id]||(o[g.id]=g.serialize())}return a.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:o,layers:this._serializeLayers(this._order)},h=>h!==void 0)}_updateLayer(o){this._updatedLayers[o.id]=!0;const h=this._getLayerSourceCache(o);o.source&&!this._updatedSources[o.source]&&h&&h.getSource().type!=="raster"&&(this._updatedSources[o.source]="reload",h.pause()),this._changed=!0,o.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(o){const h=S=>this._layers[S].type==="fill-extrusion",g={},x=[];for(let S=this._order.length-1;S>=0;S--){const A=this._order[S];if(h(A)){g[A]=S;for(const I of o){const k=I[A];if(k)for(const R of k)x.push(R)}}}x.sort((S,A)=>A.intersectionZ-S.intersectionZ);const b=[];for(let S=this._order.length-1;S>=0;S--){const A=this._order[S];if(h(A))for(let I=x.length-1;I>=0;I--){const k=x[I].feature;if(g[k.layer.id]<S)break;b.push(k),x.pop()}else for(const I of o){const k=I[A];if(k)for(const R of k)b.push(R.feature)}}return b}queryRenderedFeatures(o,h,g){h&&h.filter&&this._validate(a.validateFilter,"queryRenderedFeatures.filter",h.filter,null,h);const x={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new a.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const I of h.layers){const k=this._layers[I];if(!k)return this.fire(new a.ErrorEvent(new Error(`The layer '${I}' does not exist in the map's style and cannot be queried for features.`))),[];x[k.source]=!0}}const b=[];h.availableImages=this._availableImages;const S=h&&h.layers?h.layers.some(I=>{const k=this.getLayer(I);return k&&k.is3D()}):this.has3DLayers(),A=wr.createFromScreenPoints(o,g);for(const I in this._sourceCaches){const k=this._sourceCaches[I].getSource().id;h.layers&&!x[k]||b.push(lt(this._sourceCaches[I],this._layers,this._serializedLayers,A,h,g,S,!!this.map._showQueryGeometry))}return this.placement&&b.push(function(I,k,R,U,Z,J,H){const Y={},K=J.queryRenderedSymbols(U),X=[];for(const ne of Object.keys(K).map(Number))X.push(H[ne]);X.sort(Tt);for(const ne of X){const ee=ne.featureIndex.lookupSymbolFeatures(K[ne.bucketInstanceId],k,ne.bucketIndex,ne.sourceLayerIndex,Z.filter,Z.layers,Z.availableImages,I);for(const ve in ee){const ge=Y[ve]=Y[ve]||[],ue=ee[ve];ue.sort((_e,pe)=>{const we=ne.featureSortOrder;if(we){const Ie=we.indexOf(_e.featureIndex);return we.indexOf(pe.featureIndex)-Ie}return pe.featureIndex-_e.featureIndex});for(const _e of ue)ge.push(_e)}}for(const ne in Y)Y[ne].forEach(ee=>{const ve=ee.feature,ge=R(I[ne]).getFeatureState(ve.layer["source-layer"],ve.id);ve.source=ve.layer.source,ve.layer["source-layer"]&&(ve.sourceLayer=ve.layer["source-layer"]),ve.state=ge});return Y}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),A.screenGeometry,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(b)}querySourceFeatures(o,h){h&&h.filter&&this._validate(a.validateFilter,"querySourceFeatures.filter",h.filter,null,h);const g=this._getSourceCaches(o);let x=[];for(const b of g)x=x.concat(Ke(b,h));return x}addSourceType(o,h,g){return sn.getSourceType(o)?g(new Error(`A source type called "${o}" already exists.`)):(sn.setSourceType(o,h),h.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:o,url:h.workerSourceURL},g):g(null,null))}getLight(){return this.light.getLight()}setLight(o,h={}){this._checkLoaded();const g=this.light.getLight();let x=!1;for(const S in o)if(!P(o[S],g[S])){x=!0;break}if(!x)return;const b=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(o,h),this.light.updateTransitions(b)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(o,h=1){if(this._checkLoaded(),!o)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(h===1){if(typeof o.source=="object"){const g="terrain-dem-src";this.addSource(g,o.source),o=a.clone$1(o),o=a.extend(o,{source:g})}if(this._validate(a.validateTerrain,"terrain",o))return}if(!this.terrain||this.terrain&&h!==this.terrain.drapeRenderMode)this._createTerrain(o,h);else{const g=this.terrain,x=g.get();for(const b of Object.keys(a.spec.terrain))!o.hasOwnProperty(b)&&a.spec.terrain[b].default&&(o[b]=a.spec.terrain[b].default);for(const b in o)if(!P(o[b],x[b])){g.set(o),this.stylesheet.terrain=o;const S=this._setTransitionParameters({duration:0});g.updateTransitions(S);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(o){const h=this.fog=new Ci(o,this.map.transform);this.stylesheet.fog=o;const g=this._setTransitionParameters({duration:0});h.updateTransitions(g)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const o of this.map._markers)o._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(o){if(this._checkLoaded(),!o)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const h=this.fog,g=h.get();Object.keys(o).length===0&&h.set(o);for(const x in o)if(!P(o[x],g[x])){h.set(o),this.stylesheet.fog=o;const b=this._setTransitionParameters({duration:0});h.updateTransitions(b);break}}else this._createFog(o);this._markersNeedUpdate=!0}_setTransitionParameters(o){return{now:a.exported.now(),transition:a.extend(o,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const o=this._order.filter(g=>this.isLayerDraped(this._layers[g])),h=this._order.filter(g=>!this.isLayerDraped(this._layers[g]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...o),this._drapedFirstOrder.push(...h)}_createTerrain(o,h){const g=this.terrain=new ds(o,h);this.stylesheet.terrain=o,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const x=this._setTransitionParameters({duration:0});g.updateTransitions(x)}_force3DLayerUpdate(){for(const o in this._layers){const h=this._layers[o];h.type==="fill-extrusion"&&this._updateLayer(h)}}_forceSymbolLayerUpdate(){for(const o in this._layers){const h=this._layers[o];h.type==="symbol"&&this._updateLayer(h)}}_validate(o,h,g,x,b={}){return(!b||b.validate!==!1)&&xl(this,o.call(a.validateStyle,a.extend({key:h,style:this.serialize(),value:g,styleSpec:a.spec},x)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),a.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const o in this._layers)this._layers[o].setEventedParent(null);for(const o in this._sourceCaches)this._sourceCaches[o].clearTiles(),this._sourceCaches[o].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(o){const h=this._getSourceCaches(o);for(const g of h)g.clearTiles()}_reloadSource(o){const h=this._getSourceCaches(o);for(const g of h)g.resume(),g.reload()}_updateSources(o){for(const h in this._sourceCaches)this._sourceCaches[h].update(o)}_generateCollisionBoxes(){for(const o in this._sourceCaches){const h=this._sourceCaches[o];h.resume(),h.reload()}}_updatePlacement(o,h,g,x,b=!1){let S=!1,A=!1;const I={};for(const k of this._order){const R=this._layers[k];if(R.type!=="symbol")continue;if(!I[R.source]){const Z=this._getLayerSourceCache(R);if(!Z)continue;I[R.source]=Z.getRenderableIds(!0).map(J=>Z.getTileByID(J)).sort((J,H)=>H.tileID.overscaledZ-J.tileID.overscaledZ||(J.tileID.isLessThan(H.tileID)?-1:1))}const U=this.crossTileSymbolIndex.addLayer(R,I[R.source],o.center.lng,o.projection);S=S||U}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),b=b||this._layerOrderChanged||g===0,this._layerOrderChanged&&this.fire(new a.Event("neworder")),(b||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(a.exported.now(),o.zoom))&&(this.pauseablePlacement=new vs(o,this._order,b,h,g,x,this.placement,this.fog&&o.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,I),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(a.exported.now()),A=!0),S&&this.pauseablePlacement.placement.setStale()),A||S)for(const k of this._order){const R=this._layers[k];R.type==="symbol"&&this.placement.updateLayerOpacities(R,I[R.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(a.exported.now())}_releaseSymbolFadeTiles(){for(const o in this._sourceCaches)this._sourceCaches[o].releaseSymbolFadeTiles()}getImages(o,h,g){this.imageManager.getImages(h.icons,g),this._updateTilesForChangedImages();const x=b=>{b&&b.setDependencies(h.tileID.key,h.type,h.icons)};x(this._otherSourceCaches[h.source]),x(this._symbolSourceCaches[h.source])}getGlyphs(o,h,g){this.glyphManager.getGlyphs(h.stacks,g)}getResource(o,h,g){return a.makeRequest(h,g)}_getSourceCache(o){return this._otherSourceCaches[o]}_getLayerSourceCache(o){return o.type==="symbol"?this._symbolSourceCaches[o.source]:this._otherSourceCaches[o.source]}_getSourceCaches(o){const h=[];return this._otherSourceCaches[o]&&h.push(this._otherSourceCaches[o]),this._symbolSourceCaches[o]&&h.push(this._symbolSourceCaches[o]),h}_isSourceCacheLoaded(o){const h=this._getSourceCaches(o);return h.length===0?(this.fire(new a.ErrorEvent(new Error(`There is no source with ID '${o}'`))),!1):h.every(g=>g.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}sn.getSourceType=function(d){return be[d]},sn.setSourceType=function(d,o){be[d]=o},sn.registerForPluginStateChange=a.registerForPluginStateChange;var Gc=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#define HALF_PI PI/2.0
#define QUARTER_PI PI/4.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0`,Zc="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",$c=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,Wc=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Lo=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`;let bl={},Ys={};const xs=[];Ks(Gc,xs),Ks($c,xs),Ks(Wc,xs),Ks(Lo,xs),bl=ii("",$c),Ys=ii(Lo,Wc);const wa=ii(`
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}`,`
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),wl=Gc,Tl=`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`;var El={background:ii(`uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:ii(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:ii(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);vec4 world_center=vec4(pos,1);
#else 
mat3 surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;
#else
vec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:ii("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:ii(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
vec3 pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:ii(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:ii("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:ii("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:ii("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:ii(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:ii(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:ii(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:ii(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:ii(`uniform lowp vec3 u_lightpos;varying vec4 v_color;
#ifdef RENDER_SHADOWS
varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;varying highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
void main() {vec4 color=v_color;
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;
#endif
#ifdef RENDER_SHADOWS
color.xyz=shadowed_color_normal(color.xyz,normalize(v_normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying highp vec3 v_normal;varying float v_depth;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;vec3 pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
v_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_normal=normal;v_depth=gl_Position.w;
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);directional*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:ii(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);
#else
vec3 p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);directional*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:ii(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:ii(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:ii(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash_from
#pragma mapbox: define lowp vec4 dash_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash_from
#pragma mapbox: initialize lowp vec4 dash_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
#ifdef RENDER_LINE_GRADIENT
highp vec4 out_color=texture2D(u_gradient_image,v_uv.xy);
#else
vec4 out_color=color;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);}}
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
attribute highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash_from
#pragma mapbox: define lowp vec4 dash_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash_from
#pragma mapbox: initialize lowp vec4 dash_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:ii(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:ii(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:ii(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
vec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);vec4 offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
vec4 offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:ii(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
vec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);vec4 offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
vec4 offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:ii(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
vec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:ii(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef RENDER_SHADOWS
color.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
const float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=u_skirt_height*u_skirt_height*wireframeOffset;
#endif
vec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;
#endif
}`),terrainDepth:ii(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:ii(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Zc),skyboxGradient:ii(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Zc),skyboxCapture:ii(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:ii(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);vec4 color=vec4(raster.rgb*antialias,raster.a*antialias);
#else
vec4 color=texture2D(u_image0,v_pos0);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;
#ifdef GLOBE_POLES
attribute vec3 a_globe_pos;attribute vec2 a_uv;
#else
attribute vec2 a_pos;
#endif
varying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idy=u_grid_matrix[1][2];float S=u_grid_matrix[2][2];vec3 latLng=u_grid_matrix*vec3(a_pos,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=a_pos[0]*S;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;
#ifdef GLOBE_POLES
vec3 up_vector=normalize(globe_pos)*u_tile_up_scale;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
globe_pos+=up_vector*height;
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:ii(`uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);
#ifdef PROJECTION_GLOBE_VIEW
float globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(dot(dir,horizon_dir)),0.0);
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));float horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
float horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:
(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:
uv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}`,`attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`)};function Ks(d,o){const h=d.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let g of h)if(g=g.trim(),g[0]==="#"&&g.includes("if")&&!g.includes("endif")){g=g.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const x=g.split(" ");for(const b of x)o.includes(b)||o.push(b)}}function ii(d,o){const h=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,g=o.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),x={},b=[...xs];return Ks(d,b),Ks(o,b),{fragmentSource:d=d.replace(h,(S,A,I,k,R)=>(x[R]=!0,A==="define"?`
#ifndef HAS_UNIFORM_u_${R}
varying ${I} ${k} ${R};
#else
uniform ${I} ${k} u_${R};
#endif
`:`
#ifdef HAS_UNIFORM_u_${R}
    ${I} ${k} ${R} = u_${R};
#endif
`)),vertexSource:o=o.replace(h,(S,A,I,k,R)=>{const U=k==="float"?"vec2":"vec4",Z=R.match(/color/)?"color":U;return x[R]?A==="define"?`
#ifndef HAS_UNIFORM_u_${R}
uniform lowp float u_${R}_t;
attribute ${I} ${U} a_${R};
varying ${I} ${k} ${R};
#else
uniform ${I} ${k} u_${R};
#endif
`:Z==="vec4"?`
#ifndef HAS_UNIFORM_u_${R}
    ${R} = a_${R};
#else
    ${I} ${k} ${R} = u_${R};
#endif
`:`
#ifndef HAS_UNIFORM_u_${R}
    ${R} = unpack_mix_${Z}(a_${R}, u_${R}_t);
#else
    ${I} ${k} ${R} = u_${R};
#endif
`:A==="define"?`
#ifndef HAS_UNIFORM_u_${R}
uniform lowp float u_${R}_t;
attribute ${I} ${U} a_${R};
#else
uniform ${I} ${k} u_${R};
#endif
`:Z==="vec4"?`
#ifndef HAS_UNIFORM_u_${R}
    ${I} ${k} ${R} = a_${R};
#else
    ${I} ${k} ${R} = u_${R};
#endif
`:`
#ifndef HAS_UNIFORM_u_${R}
    ${I} ${k} ${R} = unpack_mix_${Z}(a_${R}, u_${R}_t);
#else
    ${I} ${k} ${R} = u_${R};
#endif
`}),staticAttributes:g,usedDefines:b}}class Sl{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(o,h,g,x,b,S,A){this.context=o;let I=this.boundPaintVertexBuffers.length!==x.length;for(let R=0;!I&&R<x.length;R++)this.boundPaintVertexBuffers[R]!==x[R]&&(I=!0);let k=this.boundDynamicVertexBuffers.length!==A.length;for(let R=0;!k&&R<A.length;R++)this.boundDynamicVertexBuffers[R]!==A[R]&&(k=!0);if(!o.extVertexArrayObject||!this.vao||this.boundProgram!==h||this.boundLayoutVertexBuffer!==g||I||k||this.boundIndexBuffer!==b||this.boundVertexOffset!==S)this.freshBind(h,g,x,b,S,A);else{o.bindVertexArrayOES.set(this.vao);for(const R of A)R&&R.bind();b&&b.dynamicDraw&&b.bind()}}freshBind(o,h,g,x,b,S){let A;const I=o.numAttributes,k=this.context,R=k.gl;if(k.extVertexArrayObject)this.vao&&this.destroy(),this.vao=k.extVertexArrayObject.createVertexArrayOES(),k.bindVertexArrayOES.set(this.vao),A=0,this.boundProgram=o,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=g,this.boundIndexBuffer=x,this.boundVertexOffset=b,this.boundDynamicVertexBuffers=S;else{A=k.currentNumAttributes||0;for(let U=I;U<A;U++)R.disableVertexAttribArray(U)}h.enableAttributes(R,o),h.bind(),h.setVertexAttribPointers(R,o,b);for(const U of g)U.enableAttributes(R,o),U.bind(),U.setVertexAttribPointers(R,o,b);for(const U of S)U&&(U.enableAttributes(R,o),U.bind(),U.setVertexAttribPointers(R,o,b));x&&x.bind(),k.currentNumAttributes=I}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function qc(d,o){const h=Math.pow(2,o.canonical.z),g=o.canonical.y;return[new a.MercatorCoordinate(0,g/h).toLngLat().lat,new a.MercatorCoordinate(0,(g+1)/h).toLngLat().lat]}function Xc(d,o,h,g,x,b,S){const A=d.context,I=A.gl,k=h.fbo;if(!k)return;d.prepareDrawTile();const R=d.useProgram("hillshade");A.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,k.colorAttachment.get());const U=((Y,K,X,ne)=>{const ee=X.paint.get("hillshade-shadow-color"),ve=X.paint.get("hillshade-highlight-color"),ge=X.paint.get("hillshade-accent-color");let ue=X.paint.get("hillshade-illumination-direction")*(Math.PI/180);X.paint.get("hillshade-illumination-anchor")==="viewport"&&(ue-=Y.transform.angle);const _e=!Y.options.moving;return{u_matrix:ne||Y.transform.calculateProjMatrix(K.tileID.toUnwrapped(),_e),u_image:0,u_latrange:qc(0,K.tileID),u_light:[X.paint.get("hillshade-exaggeration"),ue],u_shadow:ee,u_highlight:ve,u_accent:ge}})(d,h,g,d.terrain?o.projMatrix:null);d.prepareDrawProgram(A,R,o.toUnwrapped());const{tileBoundsBuffer:Z,tileBoundsIndexBuffer:J,tileBoundsSegments:H}=d.getTileBoundsBuffers(h);R.draw(A,I.TRIANGLES,x,b,S,a.CullFaceMode.disabled,U,g.id,Z,J,H)}function Qt(d,o,h){if(!o.needsDEMTextureUpload)return;const g=d.context,x=g.gl;g.pixelStoreUnpackPremultiplyAlpha.set(!1),o.demTexture=o.demTexture||d.getTileTexture(h.stride);const b=h.getPixels();o.demTexture?o.demTexture.update(b,{premultiply:!1}):o.demTexture=new a.Texture(g,b,x.RGBA,{premultiply:!1}),o.needsDEMTextureUpload=!1}function ko(d,o,h,g,x,b){const S=d.context,A=S.gl;if(!o.dem)return;const I=o.dem;if(S.activeTexture.set(A.TEXTURE1),Qt(d,o,I),!o.demTexture)return;o.demTexture.bind(A.NEAREST,A.CLAMP_TO_EDGE);const k=I.dim;S.activeTexture.set(A.TEXTURE0);let R=o.fbo;if(!R){const H=new a.Texture(S,{width:k,height:k,data:null},A.RGBA);H.bind(A.LINEAR,A.CLAMP_TO_EDGE),R=o.fbo=S.createFramebuffer(k,k,!0),R.colorAttachment.set(H.texture)}S.bindFramebuffer.set(R.framebuffer),S.viewport.set([0,0,k,k]);const{tileBoundsBuffer:U,tileBoundsIndexBuffer:Z,tileBoundsSegments:J}=d.getMercatorTileBoundsBuffers();d.useProgram("hillshadePrepare").draw(S,A.TRIANGLES,g,x,b,a.CullFaceMode.disabled,((H,Y)=>{const K=Y.stride,X=a.create();return a.ortho(X,0,a.EXTENT,-a.EXTENT,0,0,1),a.translate(X,X,[0,-a.EXTENT,0]),{u_matrix:X,u_image:1,u_dimension:[K,K],u_zoom:H.overscaledZ,u_unpack:Y.unpackVector}})(o.tileID,I),h.id,U,Z,J),o.needsHillshadePrepare=!1}const Ta=d=>({u_matrix:new a.UniformMatrix4f(d),u_image0:new a.Uniform1i(d),u_skirt_height:new a.Uniform1f(d)}),Hc=(d,o)=>({u_matrix:d,u_image0:0,u_skirt_height:o}),Yc=(d,o,h,g,x,b,S,A,I,k,R,U,Z,J)=>({u_proj_matrix:Float32Array.from(d),u_globe_matrix:o,u_normalize_matrix:Float32Array.from(g),u_merc_matrix:h,u_zoom_transition:x,u_merc_center:b,u_image0:0,u_frustum_tl:S,u_frustum_tr:A,u_frustum_br:I,u_frustum_bl:k,u_globe_pos:R,u_globe_radius:U,u_viewport:Z,u_grid_matrix:J?Float32Array.from(J):new Float32Array(9)});function Kc(d,o){return d!=null&&o!=null&&!(!d.hasData()||!o.hasData())&&d.demTexture!=null&&o.demTexture!=null&&d.tileID.key!==o.tileID.key}const bs=new class{constructor(){this.operations={}}newMorphing(d,o,h,g,x){if(d in this.operations){const b=this.operations[d];b.to.tileID.key!==h.tileID.key&&(b.queued=h)}else this.operations[d]={startTime:g,phase:0,duration:x,from:o,to:h,queued:null}}getMorphValuesForProxy(d){if(!(d in this.operations))return null;const o=this.operations[d];return{from:o.from,to:o.to,phase:o.phase}}update(d){for(const o in this.operations){const h=this.operations[o];for(h.phase=(d-h.startTime)/h.duration;h.phase>=1||!this._validOp(h);)if(!this._nextOp(h,d)){delete this.operations[o];break}}}_nextOp(d,o){return!!d.queued&&(d.from=d.to,d.to=d.queued,d.queued=null,d.phase=0,d.startTime=o,!0)}_validOp(d){return d.from.hasData()&&d.to.hasData()}},Ea={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function Tp(d,o){const h=1<<d.z;return!o&&(d.x===0||d.x===h-1)||d.y===0||d.y===h-1}const Jc=d=>({u_matrix:d});function Al(d,o,h,g,x){if(x>0){const b=a.exported.now(),S=(b-d.timeAdded)/x,A=o?(b-o.timeAdded)/x:-1,I=h.getSource(),k=g.coveringZoomLevel({tileSize:I.tileSize,roundZoom:I.roundZoom}),R=!o||Math.abs(o.tileID.overscaledZ-k)>Math.abs(d.tileID.overscaledZ-k),U=R&&d.refreshedUponExpiration?1:a.clamp(R?S:1-A,0,1);return d.refreshedUponExpiration&&S>=1&&(d.refreshedUponExpiration=!1),o?{opacity:1,mix:1-U}:{opacity:U,mix:0}}return{opacity:1,mix:0}}class Qc extends a.SourceCache{constructor(o){const h={type:"raster-dem",maxzoom:o.transform.maxZoom},g=new $i(Jt(),null),x=Me("mock-dem",h,g,o.style);super("mock-dem",x,!1),x.setEventedParent(this),this._sourceLoaded=!0}_loadTile(o,h){o.state="loaded",h(null)}}class eu extends a.SourceCache{constructor(o){const h=Me("proxy",{type:"geojson",maxzoom:o.transform.maxZoom},new $i(Jt(),null),o.style);super("proxy",h,!1),h.setEventedParent(this),this.map=this.getSource().map=o,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(o,h,g){if(o.freezeTileCoverage)return;this.transform=o;const x=o.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((b,S)=>{if(b[S.key]="",!this._tiles[S.key]){const A=new a.Tile(S,this._source.tileSize*S.overscaleFactor(),o.tileZoom);A.state="loaded",this._tiles[S.key]=A}return b},{});for(const b in this._tiles)b in x||(this.freeFBO(b),this._tiles[b].unloadVectorData(),delete this._tiles[b])}freeFBO(o){const h=this.proxyCachedFBO[o];if(h!==void 0){const g=Object.values(h);this.renderCachePool.push(...g),delete this.proxyCachedFBO[o]}}deallocRenderCache(){this.renderCache.forEach(o=>o.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Ml extends a.OverscaledTileID{constructor(o,h,g){super(o.overscaledZ,o.wrap,o.canonical.z,o.canonical.x,o.canonical.y),this.proxyTileKey=h,this.projMatrix=g}}class qh extends a.Elevation{constructor(o,h){super(),this.painter=o,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[g,x,b]=function(I){const k=new a.StructArrayLayout4i8,R=new a.StructArrayLayout3ui6,U=131;k.reserve(17161),R.reserve(33800);const Z=a.EXTENT/128,J=a.EXTENT+Z/2,H=J+Z;for(let K=-Z;K<H;K+=Z)for(let X=-Z;X<H;X+=Z){const ne=X<0||X>J||K<0||K>J?24575:0,ee=a.clamp(Math.round(X),0,a.EXTENT),ve=a.clamp(Math.round(K),0,a.EXTENT);k.emplaceBack(ee+ne,ve,ee,ve)}const Y=(K,X)=>{const ne=X*U+K;R.emplaceBack(ne+1,ne,ne+U),R.emplaceBack(ne+U,ne+U+1,ne+1)};for(let K=1;K<129;K++)for(let X=1;X<129;X++)Y(X,K);return[0,129].forEach(K=>{for(let X=0;X<130;X++)Y(X,K),Y(K,X)}),[k,R,32768]}(),S=o.context;this.gridBuffer=S.createVertexBuffer(g,a.boundsAttributes.members),this.gridIndexBuffer=S.createIndexBuffer(x),this.gridSegments=a.SegmentVector.simpleSegment(0,0,g.length,x.length),this.gridNoSkirtSegments=a.SegmentVector.simpleSegment(0,0,g.length,b),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new eu(h.map),this.orthoMatrix=a.create(),a.ortho(this.orthoMatrix,0,a.EXTENT,0,a.EXTENT,0,1);const A=S.gl;this._overlapStencilMode=new a.StencilMode({func:A.GEQUAL,mask:255},0,255,A.KEEP,A.KEEP,A.REPLACE),this._previousZoom=o.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=h,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Qc(h.map)}set style(o){o.on("data",this._onStyleDataEvent.bind(this)),o.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=o,this._checkRenderCacheEfficiency()}update(o,h,g){if(o&&o.terrain){this._style!==o&&(this.style=o),this.enabled=!0;const x=o.terrain.properties;this.sourceCache=o.terrain.drapeRenderMode===0?this._mockSourceCache:o._getSourceCache(x.get("source")),this._exaggeration=x.get("exaggeration");const b=()=>{this.sourceCache.used&&a.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const S=this.getScaledDemTileSize();this.sourceCache.update(h,S,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,b(),this._initializing=!0),b(),h.updateElevation(!g),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(h),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(o){this._findCoveringTileCache[o]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const o=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||o.efficiency!==100&&a.warnOnce(`Terrain render cache efficiency is not optimal (${o.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${o.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(o){o.coord&&o.dataType==="source"?this._clearRenderCacheForTile(o.sourceCacheId,o.coord):o.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const o in this._style._sourceCaches)this._style._sourceCaches[o].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(o=>o.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const o=2*this.proxySourceCache.getSource().tileSize;return[o,o]}set useVertexMorphing(o){this._useVertexMorphing=o}updateTileBinding(o){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const h=this.proxySourceCache,g=this.painter.transform;this._initializing&&(this._initializing=g._centerAltitude===0&&this.getAtPointOrZero(a.MercatorCoordinate.fromLngLat(g.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const x=this.proxyCoords=h.getIds().map(I=>{const k=h.getTileByID(I).tileID;return k.projMatrix=g.calculateProjMatrix(k.toUnwrapped()),k});(function(I,k){const R=k.transform.pointCoordinate(k.transform.getCameraPoint()),U=new a.pointGeometry(R.x,R.y);I.sort((Z,J)=>{if(J.overscaledZ-Z.overscaledZ)return J.overscaledZ-Z.overscaledZ;const H=new a.pointGeometry(Z.canonical.x+(1<<Z.canonical.z)*Z.wrap,Z.canonical.y),Y=new a.pointGeometry(J.canonical.x+(1<<J.canonical.z)*J.wrap,J.canonical.y),K=U.mult(1<<Z.canonical.z);return K.x-=.5,K.y-=.5,K.distSqr(H)-K.distSqr(Y)})})(x,this.painter),this._previousZoom=g.zoom;const b=this.proxyToSource||{};this.proxyToSource={},x.forEach(I=>{this.proxyToSource[I.key]={}}),this.terrainTileForTile={};const S=this._style._sourceCaches;for(const I in S){const k=S[I];if(!k.used||(k!==this.sourceCache&&this.resetTileLookupCache(k.id),this._setupProxiedCoordsForOrtho(k,o[I],b),k.usedForTerrain))continue;const R=o[I];k.getSource().reparseOverscaled&&this._assignTerrainTiles(R)}this.proxiedCoords[h.id]=x.map(I=>new Ml(I,I.key,this.orthoMatrix)),this._assignTerrainTiles(x),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(b),this.renderingToTexture=!1,this._updateTimestamp=a.exported.now();const A={};this._visibleDemTiles=[];for(const I of this.proxyCoords){const k=this.terrainTileForTile[I.key];if(!k)continue;const R=k.tileID.key;R in A||(this._visibleDemTiles.push(k),A[R]=R)}}_assignTerrainTiles(o){this._initializing||o.forEach(h=>{if(this.terrainTileForTile[h.key])return;const g=this._findTileCoveringTileID(h,this.sourceCache);g&&(this.terrainTileForTile[h.key]=g)})}_prepareDEMTextures(){const o=this.painter.context,h=o.gl;for(const g in this.terrainTileForTile){const x=this.terrainTileForTile[g],b=x.dem;!b||x.demTexture&&!x.needsDEMTextureUpload||(o.activeTexture.set(h.TEXTURE1),Qt(this.painter,x,b))}}_prepareDemTileUniforms(o,h,g,x){if(!h||h.demTexture==null)return!1;const b=o.tileID.canonical,S=Math.pow(2,h.tileID.canonical.z-b.z),A=x||"";return g[`u_dem_tl${A}`]=[b.x*S%1,b.y*S%1],g[`u_dem_scale${A}`]=S,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const o=this.painter.context,h=o.gl;if(!this._emptyDepthBufferTexture){const g=new a.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new a.Texture(o,g,h.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let o=0;const h=this._visibleDemTiles.reduce((g,x)=>{if(!x.dem)return g;const b=x.dem.tree.minimums[0];return b>0&&o++,g+b},0);return o?h/o:0}_updateEmptyDEMTexture(){const o=this.painter.context,h=o.gl;o.activeTexture.set(h.TEXTURE2);const g=this._getLoadedAreaMinimum(),x=new a.RGBAImage({width:1,height:1},new Uint8Array(a.DEMData.pack(g,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let b=this._emptyDEMTexture;return b?b.update(x,{premultiply:!1}):b=this._emptyDEMTexture=new a.Texture(o,x,h.RGBA,{premultiply:!1}),b}setupElevationDraw(o,h,g){const x=this.painter.context,b=x.gl,S=(A=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:a.DEMData.getUnpackVector(A),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0,u_tile_tl_up:[0,0,1],u_tile_tr_up:[0,0,1],u_tile_br_up:[0,0,1],u_tile_bl_up:[0,0,1],u_tile_up_scale:1});var A;S.u_dem_size=this.sourceCache.getSource().tileSize,S.u_exaggeration=this.exaggeration();const I=this.painter.transform,k=I.projection,R=o.tileID.canonical;S.u_tile_tl_up=k.upVector(R,0,0),S.u_tile_tr_up=k.upVector(R,a.EXTENT,0),S.u_tile_br_up=k.upVector(R,a.EXTENT,a.EXTENT),S.u_tile_bl_up=k.upVector(R,0,a.EXTENT),S.u_tile_up_scale=g&&g.useDenormalizedUpVectorScale?a.GLOBE_METERS_TO_ECEF:k.upVectorScale(R,I.center.lat,I.worldSize).metersToTile;let U=null,Z=null,J=1;if(g&&g.morphing&&this._useVertexMorphing){const H=g.morphing.srcDemTile,Y=g.morphing.dstDemTile;J=g.morphing.phase,H&&Y&&(this._prepareDemTileUniforms(o,H,S,"_prev")&&(Z=H),this._prepareDemTileUniforms(o,Y,S)&&(U=Y))}if(Z&&U?(x.activeTexture.set(b.TEXTURE2),U.demTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE,b.NEAREST),x.activeTexture.set(b.TEXTURE4),Z.demTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE,b.NEAREST),S.u_dem_lerp=J):(U=this.terrainTileForTile[o.tileID.key],x.activeTexture.set(b.TEXTURE2),(this._prepareDemTileUniforms(o,U,S)?U.demTexture:this.emptyDEMTexture).bind(b.NEAREST,b.CLAMP_TO_EDGE)),x.activeTexture.set(b.TEXTURE3),g&&g.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),this._depthFBO&&(S.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),S.u_depth_size_inv=[1,1]),g&&g.useMeterToDem&&U){const H=(1<<U.tileID.canonical.z)*a.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;S.u_meter_to_dem=H}g&&g.labelPlaneMatrixInv&&(S.u_label_plane_matrix_inv=g.labelPlaneMatrixInv),h.setTerrainUniformValues(x,S)}renderToBackBuffer(o){const h=this.painter,g=this.painter.context;o.length!==0&&(g.bindFramebuffer.set(null),g.viewport.set([0,0,h.width,h.height]),h.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(x,b,S,A,I){if(x.transform.projection.name==="globe")(function(k,R,U,Z,J){const H=k.context,Y=H.gl;let K,X;const ne=k.options.showTerrainWireframe?2:0,ee=k.transform,ve=a.globeUseCustomAntiAliasing(k,H,ee),ge=(rt,Be)=>{if(X===rt)return;const et=[Ea[rt],"PROJECTION_GLOBE_VIEW"];ve&&et.push("CUSTOM_ANTIALIASING"),Be&&et.push(Ea[ne]),K=k.useProgram("globeRaster",null,et),X=rt},ue=k.colorModeForRenderPass(),_e=new a.DepthMode(Y.LEQUAL,a.DepthMode.ReadWrite,k.depthRangeFor3D);bs.update(J);const pe=a.calculateGlobeMercatorMatrix(ee),we=[a.mercatorXfromLng(ee.center.lng),a.mercatorYfromLat(ee.center.lat)],Ie=ne?[!1,!0]:[!1],Je=k.globeSharedBuffers,Ae=[ee.width*a.exported.devicePixelRatio,ee.height*a.exported.devicePixelRatio],Ue=Float32Array.from(ee.globeMatrix),qe={useDenormalizedUpVectorScale:!0};if(Ie.forEach(rt=>{X=-1;const Be=rt?Y.LINES:Y.TRIANGLES;for(const et of Z){const We=U.getTile(et),at=a.StencilMode.disabled,st=R.prevTerrainTileForTile[et.key],yt=R.terrainTileForTile[et.key];Kc(st,yt)&&bs.newMorphing(et.key,st,yt,J,250),H.activeTexture.set(Y.TEXTURE0),We.texture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE);const At=bs.getMorphValuesForProxy(et.key),kt=At?1:0;At&&a.extend$1(qe,{morphing:{srcDemTile:At.from,dstDemTile:At.to,phase:a.easeCubicInOut(At.phase)}});const Wt=a.tileCornersToBounds(et.canonical),vt=a.getLatitudinalLod(Wt.getCenter().lat),Ft=a.getGridMatrix(et.canonical,Wt,vt),ei=a.globeNormalizeECEF(a.globeTileBounds(et.canonical)),xi=Yc(ee.projMatrix,Ue,pe,ei,a.globeToMercatorTransition(ee.zoom),we,ee.frustumCorners.TL,ee.frustumCorners.TR,ee.frustumCorners.BR,ee.frustumCorners.BL,ee.globeCenterInViewSpace,ee.globeRadius,Ae,Ft);if(ge(kt,rt),R.setupElevationDraw(We,K,qe),k.prepareDrawProgram(H,K,et.toUnwrapped()),Je){const[Di,ui,lr]=rt?Je.getWirefameBuffers(k.context,vt):Je.getGridBuffers(vt);K.draw(H,Be,_e,at,ue,a.CullFaceMode.backCCW,xi,"globe_raster",Di,ui,lr)}}}),Je){const rt=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ve&&rt.push("CUSTOM_ANTIALIASING"),K=k.useProgram("globeRaster",null,rt);for(const Be of Z){const{x:et,y:We,z:at}=Be.canonical,st=We===0,yt=We===(1<<at)-1,[At,kt,Wt,vt]=Je.getPoleBuffers(at);if(vt&&(st||yt)){const Ft=U.getTile(Be);H.activeTexture.set(Y.TEXTURE0),Ft.texture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE);let ei=a.globePoleMatrixForTile(at,et,ee);const xi=a.globeNormalizeECEF(a.globeTileBounds(Be.canonical)),Di=(ui,lr)=>ui.draw(H,Y.TRIANGLES,_e,a.StencilMode.disabled,ue,a.CullFaceMode.disabled,Yc(ee.projMatrix,ei,ei,xi,0,we,ee.frustumCorners.TL,ee.frustumCorners.TR,ee.frustumCorners.BR,ee.frustumCorners.BL,ee.globeCenterInViewSpace,ee.globeRadius,Ae),"globe_pole_raster",lr,Wt,vt);R.setupElevationDraw(Ft,K,qe),k.prepareDrawProgram(H,K,Be.toUnwrapped()),st&&Di(K,At),yt&&(ei=a.scale(a.create(),ei,[1,-1,1]),Di(K,kt))}}}})(x,b,S,A,I);else{const k=x.context,R=k.gl;let U,Z;const J=x.options.showTerrainWireframe?2:0,H=(ee,ve)=>{if(Z===ee)return;const ge=[Ea[ee]];ve&&ge.push(Ea[J]),U=x.useProgram("terrainRaster",null,ge),Z=ee},Y=x.colorModeForRenderPass(),K=new a.DepthMode(R.LEQUAL,a.DepthMode.ReadWrite,x.depthRangeFor3D);bs.update(I);const X=x.transform,ne=6*Math.pow(1.5,22-X.zoom)*b.exaggeration();(J?[!1,!0]:[!1]).forEach(ee=>{Z=-1;const ve=ee?R.LINES:R.TRIANGLES,[ge,ue]=ee?b.getWirefameBuffer():[b.gridIndexBuffer,b.gridSegments];for(const _e of A){const pe=S.getTile(_e),we=a.StencilMode.disabled,Ie=b.prevTerrainTileForTile[_e.key],Je=b.terrainTileForTile[_e.key];Kc(Ie,Je)&&bs.newMorphing(_e.key,Ie,Je,I,250),k.activeTexture.set(R.TEXTURE0),pe.texture.bind(R.LINEAR,R.CLAMP_TO_EDGE,R.LINEAR_MIPMAP_NEAREST);const Ae=bs.getMorphValuesForProxy(_e.key),Ue=Ae?1:0;let qe;Ae&&(qe={morphing:{srcDemTile:Ae.from,dstDemTile:Ae.to,phase:a.easeCubicInOut(Ae.phase)}});const rt=Hc(_e.projMatrix,Tp(_e.canonical,X.renderWorldCopies)?ne/10:ne);H(Ue,ee),b.setupElevationDraw(pe,U,qe),x.prepareDrawProgram(k,U,_e.toUnwrapped()),U.draw(k,ve,K,we,Y,a.CullFaceMode.backCCW,rt,"terrain_raster",b.gridBuffer,ge,ue)}})}}(h,this,this.proxySourceCache,o,this._updateTimestamp),this.renderingToTexture=!0,h.gpuTimingDeferredRenderEnd(),o.splice(0,o.length))}renderBatch(o){if(this._drapedRenderBatches.length===0)return o+1;this.renderingToTexture=!0;const h=this.painter,g=this.painter.context,x=this.proxySourceCache,b=this.proxiedCoords[x.id],S=this._drapedRenderBatches.shift(),A=[],I=h.style.order;let k=0;for(const R of b){const U=x.getTileByID(R.proxyTileKey),Z=x.proxyCachedFBO[R.key]?x.proxyCachedFBO[R.key][o]:void 0,J=Z!==void 0?x.renderCache[Z]:this.pool[k++],H=Z!==void 0;if(U.texture=J.tex,H&&!J.dirty){A.push(U.tileID);continue}let Y;g.bindFramebuffer.set(J.fb.framebuffer),this.renderedToTile=!1,J.dirty&&(g.clear({color:a.Color.transparent,stencil:0}),J.dirty=!1);for(let K=S.start;K<=S.end;++K){const X=h.style._layers[I[K]];if(X.isHidden(h.transform.zoom))continue;const ne=h.style._getLayerSourceCache(X),ee=ne?this.proxyToSource[R.key][ne.id]:[R];if(!ee)continue;const ve=ee;g.viewport.set([0,0,J.fb.width,J.fb.height]),Y!==(ne?ne.id:null)&&(this._setupStencil(J,ee,X,ne),Y=ne?ne.id:null),h.renderLayer(h,ne,X,ve)}this.renderedToTile?(J.dirty=!0,A.push(U.tileID)):H||--k,k===5&&(k=0,this.renderToBackBuffer(A))}return this.renderToBackBuffer(A),this.renderingToTexture=!1,g.bindFramebuffer.set(null),g.viewport.set([0,0,h.width,h.height]),S.end+1}postRender(){}renderCacheEfficiency(o){const h=o.order.length;if(h===0)return{efficiency:100};let g,x=0,b=0,S=!1;for(let A=0;A<h;++A){const I=o._layers[o.order[A]];this._style.isLayerDraped(I)?(S&&++x,++b):S||(S=!0,g=I.id)}return b===0?{efficiency:100}:{efficiency:100*(1-x/b),firstUndrapedLayer:g}}getMinElevationBelowMSL(){let o=0;return this._visibleDemTiles.filter(h=>h.dem).forEach(h=>{o=Math.min(o,h.dem.tree.minimums[0])}),o===0?o:(o-30)*this._exaggeration}raycast(o,h,g){if(!this._visibleDemTiles)return null;const x=this._visibleDemTiles.filter(b=>b.dem).map(b=>{const S=b.tileID,A=1<<S.overscaledZ,{x:I,y:k}=S.canonical,R=I/A,U=(I+1)/A,Z=k/A,J=(k+1)/A;return{minx:R,miny:Z,maxx:U,maxy:J,t:b.dem.tree.raycastRoot(R,Z,U,J,o,h,g),tile:b}});x.sort((b,S)=>(b.t!==null?b.t:Number.MAX_VALUE)-(S.t!==null?S.t:Number.MAX_VALUE));for(const b of x){if(b.t==null)return null;const S=b.tile.dem.tree.raycast(b.minx,b.miny,b.maxx,b.maxy,o,h,g);if(S!=null)return S}return null}_createFBO(){const o=this.painter.context,h=o.gl,g=this.drapeBufferSize;o.activeTexture.set(h.TEXTURE0);const x=new a.Texture(o,{width:g[0],height:g[1],data:null},h.RGBA);x.bind(h.LINEAR,h.CLAMP_TO_EDGE);const b=o.createFramebuffer(g[0],g[1],!1);return b.colorAttachment.set(x.texture),b.depthAttachment=new B(o,b.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=o.createRenderbuffer(o.gl.DEPTH_STENCIL,g[0],g[1]),this._stencilRef=0,b.depthAttachment.set(this._sharedDepthStencil),o.clear({stencil:0})):b.depthAttachment.set(this._sharedDepthStencil),o.extTextureFilterAnisotropic&&!o.extTextureFilterAnisotropicForceOff&&h.texParameterf(h.TEXTURE_2D,o.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,o.extTextureFilterAnisotropicMax),{fb:b,tex:x,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const o in this._style._sourceCaches)if(this._style._sourceCaches[o].hasTransition())return!0;return this._style.order.some(o=>{const h=this._style._layers[o],g=h.isHidden(this.painter.transform.zoom),x=h.getCrossfadeParameters(),b=!!x&&x.t!==1,S=h.hasTransition();return h.type!=="custom"&&!g&&(b||S)})}_clearRasterFadeFromRenderCache(){let o=!1;for(const h in this._style._sourceCaches)if(this._style._sourceCaches[h]._source instanceof ae){o=!0;break}if(o)for(let h=0;h<this._style.order.length;++h){const g=this._style._layers[this._style.order[h]],x=g.isHidden(this.painter.transform.zoom),b=this._style._getLayerSourceCache(g);if(g.type!=="raster"||x||!b)continue;const S=g.paint.get("raster-fade-duration");for(const A of this.proxyCoords){const I=this.proxyToSource[A.key][b.id];if(I)for(const k of I){const R=Al(b.getTile(k),b.findLoadedParent(k,0),b,this.painter.transform,S);(R.opacity!==1||R.mix!==0)&&this._clearRenderCacheForTile(b.id,k)}}}}_setupDrapedRenderBatches(){const o=this._style.order,h=o.length;if(h===0)return;const g=[];let x,b=0,S=this._style._layers[o[b]];for(;!this._style.isLayerDraped(S)&&S.isHidden(this.painter.transform.zoom)&&++b<h;)S=this._style._layers[o[b]];for(;b<h;++b){const A=this._style._layers[o[b]];A.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(A)?x===void 0&&(x=b):x!==void 0&&(g.push({start:x,end:b-1}),x=void 0))}x!==void 0&&g.push({start:x,end:b-1}),this._drapedRenderBatches=g}_setupRenderCache(o){const h=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,h.renderCache.length>h.renderCachePool.length){const S=Object.values(h.proxyCachedFBO);h.proxyCachedFBO={};for(let A=0;A<S.length;++A){const I=Object.values(S[A]);h.renderCachePool.push(...I)}}return}this._clearRasterFadeFromRenderCache();const g=this.proxyCoords,x=this._tilesDirty;for(let S=g.length-1;S>=0;S--){const A=g[S];if(h.getTileByID(A.key),h.proxyCachedFBO[A.key]!==void 0){const I=o[A.key],k=this.proxyToSource[A.key];let R=0;for(const U in k){const Z=k[U],J=I[U];if(!J||J.length!==Z.length||Z.some((H,Y)=>H!==J[Y]||x[U]&&x[U].hasOwnProperty(H.key))){R=-1;break}++R}for(const U in h.proxyCachedFBO[A.key])h.renderCache[h.proxyCachedFBO[A.key][U]].dirty=R<0||R!==Object.values(I).length}}const b=[...this._drapedRenderBatches];b.sort((S,A)=>A.end-A.start-(S.end-S.start));for(const S of b)for(const A of g){if(h.proxyCachedFBO[A.key])continue;let I=h.renderCachePool.pop();I===void 0&&h.renderCache.length<50&&(I=h.renderCache.length,h.renderCache.push(this._createFBO())),I!==void 0&&(h.proxyCachedFBO[A.key]={},h.proxyCachedFBO[A.key][S.start]=I,h.renderCache[I].dirty=!0)}this._tilesDirty={}}_setupStencil(o,h,g,x){if(!x||!this._sourceTilesOverlap[x.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const b=this.painter.context,S=b.gl;if(h.length<=1)return void(this._overlapStencilType=!1);let A;if(g.isTileClipped())A=h.length,this._overlapStencilMode.test={func:S.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(h[0].overscaledZ>h[h.length-1].overscaledZ))return void(this._overlapStencilType=!1);A=1,this._overlapStencilMode.test={func:S.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+A>255&&(b.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=A,this._overlapStencilMode.ref=this._stencilRef,g.isTileClipped()&&this._renderTileClippingMasks(h,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(o){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[o.key]),this._overlapStencilMode):a.StencilMode.disabled}_renderTileClippingMasks(o,h){const g=this.painter,x=this.painter.context,b=x.gl;g._tileClippingMaskIDs={},x.setColorMode(a.ColorMode.disabled),x.setDepthMode(a.DepthMode.disabled);const S=g.useProgram("clippingMask");for(const A of o){const I=g._tileClippingMaskIDs[A.key]=--h;S.draw(x,b.TRIANGLES,a.DepthMode.disabled,new a.StencilMode({func:b.ALWAYS,mask:0},I,255,b.KEEP,b.KEEP,b.REPLACE),a.ColorMode.disabled,a.CullFaceMode.disabled,Jc(A.projMatrix),"$clipping",g.tileExtentBuffer,g.quadTriangleIndexBuffer,g.tileExtentSegments)}}pointCoordinate(o){const h=this.painter.transform;if(o.x<0||o.x>h.width||o.y<0||o.y>h.height)return null;const g=[o.x,o.y,1,1];a.transformMat4$1(g,g,h.pixelMatrixInverse),a.scale$1(g,g,1/g[3]),g[0]/=h.worldSize,g[1]/=h.worldSize;const x=h._camera.position,b=a.mercatorZfromAltitude(1,h.center.lat),S=[x[0],x[1],x[2]/b,0],A=a.subtract([],g.slice(0,3),S);a.normalize(A,A);const I=this.raycast(S,A,this._exaggeration);return I!==null&&I?(a.scaleAndAdd(S,S,A,I),S[3]=S[2],S[2]*=b,S):null}drawDepth(){const o=this.painter,h=o.context,g=this.proxySourceCache,x=Math.ceil(o.width),b=Math.ceil(o.height);if(!this._depthFBO||this._depthFBO.width===x&&this._depthFBO.height===b||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const S=h.gl,A=h.createFramebuffer(x,b,!0);h.activeTexture.set(S.TEXTURE0);const I=new a.Texture(h,{width:x,height:b,data:null},S.RGBA);I.bind(S.NEAREST,S.CLAMP_TO_EDGE),A.colorAttachment.set(I.texture);const k=h.createRenderbuffer(h.gl.DEPTH_COMPONENT16,x,b);A.depthAttachment.set(k),this._depthFBO=A,this._depthTexture=I}h.bindFramebuffer.set(this._depthFBO.framebuffer),h.viewport.set([0,0,x,b]),function(S,A,I,k){if(S.transform.projection.name==="globe")return;const R=S.context,U=R.gl;R.clear({depth:1});const Z=S.useProgram("terrainDepth"),J=new a.DepthMode(U.LESS,a.DepthMode.ReadWrite,S.depthRangeFor3D);for(const H of k){const Y=I.getTile(H),K=Hc(H.projMatrix,0);A.setupElevationDraw(Y,Z),Z.draw(R,U.TRIANGLES,J,a.StencilMode.disabled,a.ColorMode.unblended,a.CullFaceMode.backCCW,K,"terrain_depth",A.gridBuffer,A.gridIndexBuffer,A.gridNoSkirtSegments)}}(o,this,g,this.proxyCoords)}_setupProxiedCoordsForOrtho(o,h,g){if(o.getSource()instanceof Te)return this._setupProxiedCoordsForImageSource(o,h,g);this._findCoveringTileCache[o.id]=this._findCoveringTileCache[o.id]||{};const x=this.proxiedCoords[o.id]=[],b=this.proxyCoords;for(let A=0;A<b.length;A++){const I=b[A],k=this._findTileCoveringTileID(I,o);if(k){const R=this._createProxiedId(I,k,g[I.key]&&g[I.key][o.id]);x.push(R),this.proxyToSource[I.key][o.id]=[R]}}let S=!1;for(let A=0;A<h.length;A++){const I=o.getTile(h[A]);if(!I||!I.hasData())continue;const k=this._findTileCoveringTileID(I.tileID,this.proxySourceCache);if(k&&k.tileID.canonical.z!==I.tileID.canonical.z){const R=this.proxyToSource[k.tileID.key][o.id],U=this._createProxiedId(k.tileID,I,g[k.tileID.key]&&g[k.tileID.key][o.id]);R?R.splice(R.length-1,0,U):this.proxyToSource[k.tileID.key][o.id]=[U],x.push(U),S=!0}}this._sourceTilesOverlap[o.id]=S}_setupProxiedCoordsForImageSource(o,h,g){if(!o.getSource().loaded())return;const x=this.proxiedCoords[o.id]=[],b=this.proxyCoords,S=o.getSource(),A=new a.pointGeometry(S.tileID.x,S.tileID.y)._div(1<<S.tileID.z),I=S.coordinates.map(a.MercatorCoordinate.fromLngLat).reduce((R,U)=>(R.min.x=Math.min(R.min.x,U.x-A.x),R.min.y=Math.min(R.min.y,U.y-A.y),R.max.x=Math.max(R.max.x,U.x-A.x),R.max.y=Math.max(R.max.y,U.y-A.y),R),{min:new a.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new a.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),k=(R,U)=>{const Z=R.wrap+R.canonical.x/(1<<R.canonical.z),J=R.canonical.y/(1<<R.canonical.z),H=a.EXTENT/(1<<R.canonical.z),Y=U.wrap+U.canonical.x/(1<<U.canonical.z),K=U.canonical.y/(1<<U.canonical.z);return Z+H<Y+I.min.x||Z>Y+I.max.x||J+H<K+I.min.y||J>K+I.max.y};for(let R=0;R<b.length;R++){const U=b[R];for(let Z=0;Z<h.length;Z++){const J=o.getTile(h[Z]);if(!J||!J.hasData()||k(U,J.tileID))continue;const H=this._createProxiedId(U,J,g[U.key]&&g[U.key][o.id]),Y=this.proxyToSource[U.key][o.id];Y?Y.push(H):this.proxyToSource[U.key][o.id]=[H],x.push(H)}}}_createProxiedId(o,h,g){let x=this.orthoMatrix;if(g){const b=g.find(S=>S.key===h.tileID.key);if(b)return b}if(h.tileID.key!==o.key){const b=o.canonical.z-h.tileID.canonical.z;let S,A,I;x=a.create();const k=h.tileID.wrap-o.wrap<<o.overscaledZ;b>0?(S=a.EXTENT>>b,A=S*((h.tileID.canonical.x<<b)-o.canonical.x+k),I=S*((h.tileID.canonical.y<<b)-o.canonical.y)):(S=a.EXTENT<<-b,A=a.EXTENT*(h.tileID.canonical.x-(o.canonical.x+k<<-b)),I=a.EXTENT*(h.tileID.canonical.y-(o.canonical.y<<-b))),a.ortho(x,0,S,0,S,0,1),a.translate(x,x,[A,I,0])}return new Ml(h.tileID,o.key,x)}_findTileCoveringTileID(o,h){let g=h.getTile(o);if(g&&g.hasData())return g;const x=this._findCoveringTileCache[h.id],b=x[o.key];if(g=b?h.getTileByID(b):null,g&&g.hasData()||b===null)return g;let S=g?g.tileID:o,A=S.overscaledZ;const I=h.getSource().minzoom,k=[];if(!b){const U=h.getSource().maxzoom;if(o.canonical.z>=U){const Z=o.canonical.z-U;h.getSource().reparseOverscaled?(A=Math.max(o.canonical.z+2,h.transform.tileZoom),S=new a.OverscaledTileID(A,o.wrap,U,o.canonical.x>>Z,o.canonical.y>>Z)):Z!==0&&(A=U,S=new a.OverscaledTileID(A,o.wrap,U,o.canonical.x>>Z,o.canonical.y>>Z))}S.key!==o.key&&(k.push(S.key),g=h.getTile(S))}const R=U=>{k.forEach(Z=>{x[Z]=U}),k.length=0};for(A-=1;A>=I&&(!g||!g.hasData());A--){g&&R(g.tileID.key);const U=S.calculateScaledKey(A);if(g=h.getTileByID(U),g&&g.hasData())break;const Z=x[U];if(Z===null)break;Z===void 0?k.push(U):g=h.getTileByID(Z)}return R(g?g.tileID.key:null),g&&g.hasData()?g:null}findDEMTileFor(o){return this.enabled?this._findTileCoveringTileID(o,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(o,h){let g=this._tilesDirty[o];g||(g=this._tilesDirty[o]={}),g[h.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const o=function(h){let g=0;const x=new a.StructArrayLayout2ui4,b=131;for(let S=1;S<129;S++){for(let A=1;A<129;A++)g=S*b+A,x.emplaceBack(g,g+1),x.emplaceBack(g,g+b),x.emplaceBack(g+1,g+b),S===128&&x.emplaceBack(g+b,g+b+1);x.emplaceBack(g+1,g+1+b)}return x}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(o),this.wireframeSegments=a.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,o.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class tu{static cacheKey(o,h,g,x){let b=`${h}${x?x.cacheKey:""}`;for(const S of g)o.usedDefines.includes(S)&&(b+=`/${S}`);return b}constructor(o,h,g,x,b,S){const A=o.gl;this.program=A.createProgram();const I=function(K){const X=[];for(let ne=0;ne<K.length;ne++){if(K[ne]===null)continue;const ee=K[ne].split(" ");X.push(ee.pop())}return X}(g.staticAttributes),k=x?x.getBinderAttributes():[],R=I.concat(k);let U=x?x.defines():[];U=U.concat(S.map(K=>`#define ${K}`));const Z=U.concat(o.extStandardDerivatives?`#extension GL_OES_standard_derivatives : enable
`.concat(Tl):Tl,Tl,wl,wa.fragmentSource,Ys.fragmentSource,g.fragmentSource).join(`
`),J=U.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,wl,wa.vertexSource,Ys.vertexSource,bl.vertexSource,g.vertexSource).join(`
`),H=A.createShader(A.FRAGMENT_SHADER);if(A.isContextLost())return void(this.failedToCreate=!0);A.shaderSource(H,Z),A.compileShader(H),A.attachShader(this.program,H);const Y=A.createShader(A.VERTEX_SHADER);if(A.isContextLost())this.failedToCreate=!0;else{A.shaderSource(Y,J),A.compileShader(Y),A.attachShader(this.program,Y),this.attributes={},this.numAttributes=R.length;for(let K=0;K<this.numAttributes;K++)R[K]&&(A.bindAttribLocation(this.program,K,R[K]),this.attributes[R[K]]=K);A.linkProgram(this.program),A.deleteShader(Y),A.deleteShader(H),this.fixedUniforms=b(o),this.binderUniforms=x?x.getUniforms(o):[],S.indexOf("TERRAIN")!==-1&&(this.terrainUniforms=(K=>({u_dem:new a.Uniform1i(K),u_dem_prev:new a.Uniform1i(K),u_dem_unpack:new a.Uniform4f(K),u_dem_tl:new a.Uniform2f(K),u_dem_scale:new a.Uniform1f(K),u_dem_tl_prev:new a.Uniform2f(K),u_dem_scale_prev:new a.Uniform1f(K),u_dem_size:new a.Uniform1f(K),u_dem_lerp:new a.Uniform1f(K),u_exaggeration:new a.Uniform1f(K),u_depth:new a.Uniform1i(K),u_depth_size_inv:new a.Uniform2f(K),u_meter_to_dem:new a.Uniform1f(K),u_label_plane_matrix_inv:new a.UniformMatrix4f(K),u_tile_tl_up:new a.Uniform3f(K),u_tile_tr_up:new a.Uniform3f(K),u_tile_br_up:new a.Uniform3f(K),u_tile_bl_up:new a.Uniform3f(K),u_tile_up_scale:new a.Uniform1f(K)}))(o)),S.indexOf("FOG")!==-1&&(this.fogUniforms=(K=>({u_fog_matrix:new a.UniformMatrix4f(K),u_fog_range:new a.Uniform2f(K),u_fog_color:new a.Uniform4f(K),u_fog_horizon_blend:new a.Uniform1f(K),u_fog_temporal_offset:new a.Uniform1f(K),u_frustum_tl:new a.Uniform3f(K),u_frustum_tr:new a.Uniform3f(K),u_frustum_br:new a.Uniform3f(K),u_frustum_bl:new a.Uniform3f(K),u_globe_pos:new a.Uniform3f(K),u_globe_radius:new a.Uniform1f(K),u_globe_transition:new a.Uniform1f(K),u_is_globe:new a.Uniform1i(K),u_viewport:new a.Uniform2f(K)}))(o))}}setTerrainUniformValues(o,h){if(!this.terrainUniforms)return;const g=this.terrainUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const x in h)g[x].set(this.program,x,h[x])}}setFogUniformValues(o,h){if(!this.fogUniforms)return;const g=this.fogUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const x in h)g[x].set(this.program,x,h[x])}}draw(o,h,g,x,b,S,A,I,k,R,U,Z,J,H,Y){const K=o.gl;if(this.failedToCreate)return;o.program.set(this.program),o.setDepthMode(g),o.setStencilMode(x),o.setColorMode(b),o.setCullFace(S);for(const ne of Object.keys(this.fixedUniforms))this.fixedUniforms[ne].set(this.program,ne,A[ne]);H&&H.setUniforms(this.program,o,this.binderUniforms,Z,{zoom:J});const X={[K.LINES]:2,[K.TRIANGLES]:3,[K.LINE_STRIP]:1}[h];for(const ne of U.get()){const ee=ne.vaos||(ne.vaos={});(ee[I]||(ee[I]=new Sl)).bind(o,this,k,H?H.getPaintVertexBuffers():[],R,ne.vertexOffset,Y||[]),K.drawElements(h,ne.primitiveLength*X,K.UNSIGNED_SHORT,ne.primitiveOffset*X*2)}}}function Xh(d,o,h){const g=1/fn(h,1,o.transform.tileZoom),x=Math.pow(2,h.tileID.overscaledZ),b=h.tileSize*Math.pow(2,o.transform.tileZoom)/x,S=b*(h.tileID.canonical.x+h.tileID.wrap*x),A=b*h.tileID.canonical.y;return{u_image:0,u_texsize:h.imageAtlasTexture.size,u_scale:[g,d.fromScale,d.toScale],u_fade:d.t,u_pixel_coord_upper:[S>>16,A>>16],u_pixel_coord_lower:[65535&S,65535&A]}}const Sa=a.create(),Ro=(d,o,h,g,x,b,S,A,I,k,R)=>{const U=o.style.light,Z=U.properties.get("position"),J=[Z.x,Z.y,Z.z],H=a.create$1();U.properties.get("anchor")==="viewport"&&(a.fromRotation(H,-o.transform.angle),a.transformMat3(J,J,H));const Y=U.properties.get("color"),K=o.transform,X={u_matrix:d,u_lightpos:J,u_lightintensity:U.properties.get("intensity"),u_lightcolor:[Y.r,Y.g,Y.b],u_vertical_gradient:+h,u_opacity:g,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Sa,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:x,u_edge_radius:b};return K.projection.name==="globe"&&(X.u_tile_id=[S.canonical.x,S.canonical.y,1<<S.canonical.z],X.u_zoom_transition=I,X.u_inv_rot_matrix=R,X.u_merc_center=k,X.u_up_dir=K.projection.upVector(new a.CanonicalTileID(0,0,0),k[0]*a.EXTENT,k[1]*a.EXTENT),X.u_height_lift=A),X},Hh=(d,o,h,g,x,b,S,A,I,k,R,U,Z)=>{const J=Ro(d,o,h,g,x,b,S,k,R,U,Z),H={u_height_factor:-Math.pow(2,S.overscaledZ)/I.tileSize/8};return a.extend(J,Xh(A,o,I),H)},Aa=d=>({u_matrix:d}),Pl=(d,o,h,g)=>a.extend(Aa(d),Xh(h,o,g)),zn=(d,o)=>({u_matrix:d,u_world:o}),iu=(d,o,h,g,x)=>a.extend(Pl(d,o,h,g),{u_world:x}),Yh=a.create(),ru=(d,o,h,g,x,b)=>{const S=d.transform,A=S.projection.name==="globe";let I;if(b.paint.get("circle-pitch-alignment")==="map")if(A){const R=a.globePixelsToTileUnits(S.zoom,o.canonical)*S._pixelsPerMercatorPixel;I=Float32Array.from([R,0,0,R])}else I=S.calculatePixelsToTileUnitsMatrix(h);else I=new Float32Array([S.pixelsToGLUnits[0],0,0,S.pixelsToGLUnits[1]]);const k={u_camera_to_center_distance:S.cameraToCenterDistance,u_matrix:d.translatePosMatrix(o.projMatrix,h,b.paint.get("circle-translate"),b.paint.get("circle-translate-anchor")),u_device_pixel_ratio:a.exported.devicePixelRatio,u_extrude_scale:I,u_inv_rot_matrix:Yh,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(A){k.u_inv_rot_matrix=g,k.u_merc_center=x,k.u_tile_id=[o.canonical.x,o.canonical.y,1<<o.canonical.z],k.u_zoom_transition=a.globeToMercatorTransition(S.zoom);const R=x[0]*a.EXTENT,U=x[1]*a.EXTENT;k.u_up_dir=S.projection.upVector(new a.CanonicalTileID(0,0,0),R,U)}return k},Kh=d=>{const o=[];return d.paint.get("circle-pitch-alignment")==="map"&&o.push("PITCH_WITH_MAP"),d.paint.get("circle-pitch-scale")==="map"&&o.push("SCALE_WITH_MAP"),o},nu=(d,o,h,g)=>{const x=a.EXTENT/h.tileSize;return{u_matrix:d,u_camera_to_center_distance:o.getCameraToCenterDistance(g),u_extrude_scale:[o.pixelsToGLUnits[0]/x,o.pixelsToGLUnits[1]/x]}},Jh=(d,o,h=1)=>({u_matrix:d,u_color:o,u_overlay:0,u_overlay_scale:h}),su=a.create(),Ep=(d,o,h,g,x,b,S)=>{const A=d.transform,I=A.projection.name==="globe",k=I?a.globePixelsToTileUnits(A.zoom,o.canonical)*A._pixelsPerMercatorPixel:fn(h,1,b),R={u_matrix:o.projMatrix,u_extrude_scale:k,u_intensity:S,u_inv_rot_matrix:su,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(I){R.u_inv_rot_matrix=g,R.u_merc_center=x,R.u_tile_id=[o.canonical.x,o.canonical.y,1<<o.canonical.z],R.u_zoom_transition=a.globeToMercatorTransition(A.zoom);const U=x[0]*a.EXTENT,Z=x[1]*a.EXTENT;R.u_up_dir=A.projection.upVector(new a.CanonicalTileID(0,0,0),U,Z)}return R},Il=(d,o,h,g,x,b,S,A)=>{const I=d.transform,k=I.calculatePixelsToTileUnitsMatrix(o),R={u_matrix:Qh(d,o,h,x),u_pixels_to_tile_units:k,u_device_pixel_ratio:S,u_units_to_pixels:[1/I.pixelsToGLUnits[0],1/I.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:b,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0,u_alpha_discard_threshold:0,u_trim_offset:A};if(Ll(h)){const U=Cl(o,d.transform);R.u_texsize=o.lineAtlasTexture.size,R.u_scale=[U,g.fromScale,g.toScale],R.u_mix=g.t}return R},Sp=(d,o,h,g,x,b)=>{const S=d.transform,A=Cl(o,S);return{u_matrix:Qh(d,o,h,x),u_texsize:o.imageAtlasTexture.size,u_pixels_to_tile_units:S.calculatePixelsToTileUnitsMatrix(o),u_device_pixel_ratio:b,u_image:0,u_scale:[A,g.fromScale,g.toScale],u_fade:g.t,u_units_to_pixels:[1/S.pixelsToGLUnits[0],1/S.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function Cl(d,o){return 1/fn(d,1,o.tileZoom)}function Qh(d,o,h,g){return d.translatePosMatrix(g||o.tileID.projMatrix,o,h.paint.get("line-translate"),h.paint.get("line-translate-anchor"))}function Ll(d){const o=d.paint.get("line-dasharray").value;return o.value||o.kind!=="constant"}const Ap=(d,o,h,g,x,b)=>{return{u_matrix:d,u_tl_parent:o,u_scale_parent:h,u_fade_t:g.mix,u_opacity:g.opacity*x.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:x.paint.get("raster-brightness-min"),u_brightness_high:x.paint.get("raster-brightness-max"),u_saturation_factor:(A=x.paint.get("raster-saturation"),A>0?1-1/(1.001-A):-A),u_contrast_factor:(S=x.paint.get("raster-contrast"),S>0?1/(1-S):1+S),u_spin_weights:kl(x.paint.get("raster-hue-rotate")),u_perspective_transform:b};var S,A};function kl(d){d*=Math.PI/180;const o=Math.sin(d),h=Math.cos(d);return[(2*h+1)/3,(-Math.sqrt(3)*o-h+1)/3,(Math.sqrt(3)*o-h+1)/3]}const ef=a.create(),ou=(d,o,h,g,x,b,S,A,I,k,R,U,Z,J,H,Y)=>{const K=x.transform,X={u_is_size_zoom_constant:+(d==="constant"||d==="source"),u_is_size_feature_constant:+(d==="constant"||d==="camera"),u_size_t:o?o.uSizeT:0,u_size:o?o.uSize:0,u_camera_to_center_distance:K.cameraToCenterDistance,u_rotate_symbol:+h,u_aspect_ratio:K.width/K.height,u_fade_change:x.options.fadeDuration?x.symbolFadeChange:1,u_matrix:b,u_label_plane_matrix:S,u_coord_matrix:A,u_is_text:+I,u_pitch_with_map:+g,u_texsize:k,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:ef,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:ef,u_up_vector:[0,-1,0]};return Y.name==="globe"&&(X.u_tile_id=[R.canonical.x,R.canonical.y,1<<R.canonical.z],X.u_zoom_transition=U,X.u_inv_rot_matrix=J,X.u_merc_center=Z,X.u_camera_forward=K._camera.forward(),X.u_ecef_origin=a.globeECEFOrigin(K.globeMatrix,R.toUnwrapped()),X.u_tile_matrix=Float32Array.from(K.globeMatrix),X.u_up_vector=H),X},au=(d,o,h,g,x,b,S,A,I,k,R,U,Z,J,H,Y,K)=>a.extend(ou(d,o,h,g,x,b,S,A,I,k,U,Z,J,H,Y,K),{u_gamma_scale:g?x.transform.cameraToCenterDistance*Math.cos(x.terrain?0:x.transform._pitch):1,u_device_pixel_ratio:a.exported.devicePixelRatio,u_is_halo:+R}),Oo=(d,o,h,g,x,b,S,A,I,k,R,U,Z,J,H,Y)=>a.extend(au(d,o,h,g,x,b,S,A,!0,I,!0,R,U,Z,J,H,Y),{u_texsize_icon:k,u_texture_icon:1}),Mp=(d,o,h)=>({u_matrix:d,u_opacity:o,u_color:h}),Pp=(d,o,h,g,x,b)=>a.extend(function(S,A,I,k){const R=I.imageManager.getPattern(S.from.toString()),U=I.imageManager.getPattern(S.to.toString()),{width:Z,height:J}=I.imageManager.getPixelSize(),H=Math.pow(2,k.tileID.overscaledZ),Y=k.tileSize*Math.pow(2,I.transform.tileZoom)/H,K=Y*(k.tileID.canonical.x+k.tileID.wrap*H),X=Y*k.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:R.tl,u_pattern_br_a:R.br,u_pattern_tl_b:U.tl,u_pattern_br_b:U.br,u_texsize:[Z,J],u_mix:A.t,u_pattern_size_a:R.displaySize,u_pattern_size_b:U.displaySize,u_scale_a:A.fromScale,u_scale_b:A.toScale,u_tile_units_to_pixels:1/fn(k,1,I.transform.tileZoom),u_pixel_coord_upper:[K>>16,X>>16],u_pixel_coord_lower:[65535&K,65535&X]}}(g,b,h,x),{u_matrix:d,u_opacity:o}),Ip={fillExtrusion:d=>({u_matrix:new a.UniformMatrix4f(d),u_lightpos:new a.Uniform3f(d),u_lightintensity:new a.Uniform1f(d),u_lightcolor:new a.Uniform3f(d),u_vertical_gradient:new a.Uniform1f(d),u_opacity:new a.Uniform1f(d),u_edge_radius:new a.Uniform1f(d),u_ao:new a.Uniform2f(d),u_tile_id:new a.Uniform3f(d),u_zoom_transition:new a.Uniform1f(d),u_inv_rot_matrix:new a.UniformMatrix4f(d),u_merc_center:new a.Uniform2f(d),u_up_dir:new a.Uniform3f(d),u_height_lift:new a.Uniform1f(d)}),fillExtrusionPattern:d=>({u_matrix:new a.UniformMatrix4f(d),u_lightpos:new a.Uniform3f(d),u_lightintensity:new a.Uniform1f(d),u_lightcolor:new a.Uniform3f(d),u_vertical_gradient:new a.Uniform1f(d),u_height_factor:new a.Uniform1f(d),u_edge_radius:new a.Uniform1f(d),u_ao:new a.Uniform2f(d),u_tile_id:new a.Uniform3f(d),u_zoom_transition:new a.Uniform1f(d),u_inv_rot_matrix:new a.UniformMatrix4f(d),u_merc_center:new a.Uniform2f(d),u_up_dir:new a.Uniform3f(d),u_height_lift:new a.Uniform1f(d),u_image:new a.Uniform1i(d),u_texsize:new a.Uniform2f(d),u_pixel_coord_upper:new a.Uniform2f(d),u_pixel_coord_lower:new a.Uniform2f(d),u_scale:new a.Uniform3f(d),u_fade:new a.Uniform1f(d),u_opacity:new a.Uniform1f(d)}),fill:d=>({u_matrix:new a.UniformMatrix4f(d)}),fillPattern:d=>({u_matrix:new a.UniformMatrix4f(d),u_image:new a.Uniform1i(d),u_texsize:new a.Uniform2f(d),u_pixel_coord_upper:new a.Uniform2f(d),u_pixel_coord_lower:new a.Uniform2f(d),u_scale:new a.Uniform3f(d),u_fade:new a.Uniform1f(d)}),fillOutline:d=>({u_matrix:new a.UniformMatrix4f(d),u_world:new a.Uniform2f(d)}),fillOutlinePattern:d=>({u_matrix:new a.UniformMatrix4f(d),u_world:new a.Uniform2f(d),u_image:new a.Uniform1i(d),u_texsize:new a.Uniform2f(d),u_pixel_coord_upper:new a.Uniform2f(d),u_pixel_coord_lower:new a.Uniform2f(d),u_scale:new a.Uniform3f(d),u_fade:new a.Uniform1f(d)}),circle:d=>({u_camera_to_center_distance:new a.Uniform1f(d),u_extrude_scale:new a.UniformMatrix2f(d),u_device_pixel_ratio:new a.Uniform1f(d),u_matrix:new a.UniformMatrix4f(d),u_inv_rot_matrix:new a.UniformMatrix4f(d),u_merc_center:new a.Uniform2f(d),u_tile_id:new a.Uniform3f(d),u_zoom_transition:new a.Uniform1f(d),u_up_dir:new a.Uniform3f(d)}),collisionBox:d=>({u_matrix:new a.UniformMatrix4f(d),u_camera_to_center_distance:new a.Uniform1f(d),u_extrude_scale:new a.Uniform2f(d)}),collisionCircle:d=>({u_matrix:new a.UniformMatrix4f(d),u_inv_matrix:new a.UniformMatrix4f(d),u_camera_to_center_distance:new a.Uniform1f(d),u_viewport_size:new a.Uniform2f(d)}),debug:d=>({u_color:new a.UniformColor(d),u_matrix:new a.UniformMatrix4f(d),u_overlay:new a.Uniform1i(d),u_overlay_scale:new a.Uniform1f(d)}),clippingMask:d=>({u_matrix:new a.UniformMatrix4f(d)}),heatmap:d=>({u_extrude_scale:new a.Uniform1f(d),u_intensity:new a.Uniform1f(d),u_matrix:new a.UniformMatrix4f(d),u_inv_rot_matrix:new a.UniformMatrix4f(d),u_merc_center:new a.Uniform2f(d),u_tile_id:new a.Uniform3f(d),u_zoom_transition:new a.Uniform1f(d),u_up_dir:new a.Uniform3f(d)}),heatmapTexture:d=>({u_image:new a.Uniform1i(d),u_color_ramp:new a.Uniform1i(d),u_opacity:new a.Uniform1f(d)}),hillshade:d=>({u_matrix:new a.UniformMatrix4f(d),u_image:new a.Uniform1i(d),u_latrange:new a.Uniform2f(d),u_light:new a.Uniform2f(d),u_shadow:new a.UniformColor(d),u_highlight:new a.UniformColor(d),u_accent:new a.UniformColor(d)}),hillshadePrepare:d=>({u_matrix:new a.UniformMatrix4f(d),u_image:new a.Uniform1i(d),u_dimension:new a.Uniform2f(d),u_zoom:new a.Uniform1f(d),u_unpack:new a.Uniform4f(d)}),line:d=>({u_matrix:new a.UniformMatrix4f(d),u_pixels_to_tile_units:new a.UniformMatrix2f(d),u_device_pixel_ratio:new a.Uniform1f(d),u_units_to_pixels:new a.Uniform2f(d),u_dash_image:new a.Uniform1i(d),u_gradient_image:new a.Uniform1i(d),u_image_height:new a.Uniform1f(d),u_texsize:new a.Uniform2f(d),u_scale:new a.Uniform3f(d),u_mix:new a.Uniform1f(d),u_alpha_discard_threshold:new a.Uniform1f(d),u_trim_offset:new a.Uniform2f(d)}),linePattern:d=>({u_matrix:new a.UniformMatrix4f(d),u_texsize:new a.Uniform2f(d),u_pixels_to_tile_units:new a.UniformMatrix2f(d),u_device_pixel_ratio:new a.Uniform1f(d),u_image:new a.Uniform1i(d),u_units_to_pixels:new a.Uniform2f(d),u_scale:new a.Uniform3f(d),u_fade:new a.Uniform1f(d),u_alpha_discard_threshold:new a.Uniform1f(d)}),raster:d=>({u_matrix:new a.UniformMatrix4f(d),u_tl_parent:new a.Uniform2f(d),u_scale_parent:new a.Uniform1f(d),u_fade_t:new a.Uniform1f(d),u_opacity:new a.Uniform1f(d),u_image0:new a.Uniform1i(d),u_image1:new a.Uniform1i(d),u_brightness_low:new a.Uniform1f(d),u_brightness_high:new a.Uniform1f(d),u_saturation_factor:new a.Uniform1f(d),u_contrast_factor:new a.Uniform1f(d),u_spin_weights:new a.Uniform3f(d),u_perspective_transform:new a.Uniform2f(d)}),symbolIcon:d=>({u_is_size_zoom_constant:new a.Uniform1i(d),u_is_size_feature_constant:new a.Uniform1i(d),u_size_t:new a.Uniform1f(d),u_size:new a.Uniform1f(d),u_camera_to_center_distance:new a.Uniform1f(d),u_rotate_symbol:new a.Uniform1i(d),u_aspect_ratio:new a.Uniform1f(d),u_fade_change:new a.Uniform1f(d),u_matrix:new a.UniformMatrix4f(d),u_label_plane_matrix:new a.UniformMatrix4f(d),u_coord_matrix:new a.UniformMatrix4f(d),u_is_text:new a.Uniform1i(d),u_pitch_with_map:new a.Uniform1i(d),u_texsize:new a.Uniform2f(d),u_tile_id:new a.Uniform3f(d),u_zoom_transition:new a.Uniform1f(d),u_inv_rot_matrix:new a.UniformMatrix4f(d),u_merc_center:new a.Uniform2f(d),u_camera_forward:new a.Uniform3f(d),u_tile_matrix:new a.UniformMatrix4f(d),u_up_vector:new a.Uniform3f(d),u_ecef_origin:new a.Uniform3f(d),u_texture:new a.Uniform1i(d)}),symbolSDF:d=>({u_is_size_zoom_constant:new a.Uniform1i(d),u_is_size_feature_constant:new a.Uniform1i(d),u_size_t:new a.Uniform1f(d),u_size:new a.Uniform1f(d),u_camera_to_center_distance:new a.Uniform1f(d),u_rotate_symbol:new a.Uniform1i(d),u_aspect_ratio:new a.Uniform1f(d),u_fade_change:new a.Uniform1f(d),u_matrix:new a.UniformMatrix4f(d),u_label_plane_matrix:new a.UniformMatrix4f(d),u_coord_matrix:new a.UniformMatrix4f(d),u_is_text:new a.Uniform1i(d),u_pitch_with_map:new a.Uniform1i(d),u_texsize:new a.Uniform2f(d),u_texture:new a.Uniform1i(d),u_gamma_scale:new a.Uniform1f(d),u_device_pixel_ratio:new a.Uniform1f(d),u_tile_id:new a.Uniform3f(d),u_zoom_transition:new a.Uniform1f(d),u_inv_rot_matrix:new a.UniformMatrix4f(d),u_merc_center:new a.Uniform2f(d),u_camera_forward:new a.Uniform3f(d),u_tile_matrix:new a.UniformMatrix4f(d),u_up_vector:new a.Uniform3f(d),u_ecef_origin:new a.Uniform3f(d),u_is_halo:new a.Uniform1i(d)}),symbolTextAndIcon:d=>({u_is_size_zoom_constant:new a.Uniform1i(d),u_is_size_feature_constant:new a.Uniform1i(d),u_size_t:new a.Uniform1f(d),u_size:new a.Uniform1f(d),u_camera_to_center_distance:new a.Uniform1f(d),u_rotate_symbol:new a.Uniform1i(d),u_aspect_ratio:new a.Uniform1f(d),u_fade_change:new a.Uniform1f(d),u_matrix:new a.UniformMatrix4f(d),u_label_plane_matrix:new a.UniformMatrix4f(d),u_coord_matrix:new a.UniformMatrix4f(d),u_is_text:new a.Uniform1i(d),u_pitch_with_map:new a.Uniform1i(d),u_texsize:new a.Uniform2f(d),u_texsize_icon:new a.Uniform2f(d),u_texture:new a.Uniform1i(d),u_texture_icon:new a.Uniform1i(d),u_gamma_scale:new a.Uniform1f(d),u_device_pixel_ratio:new a.Uniform1f(d),u_is_halo:new a.Uniform1i(d)}),background:d=>({u_matrix:new a.UniformMatrix4f(d),u_opacity:new a.Uniform1f(d),u_color:new a.UniformColor(d)}),backgroundPattern:d=>({u_matrix:new a.UniformMatrix4f(d),u_opacity:new a.Uniform1f(d),u_image:new a.Uniform1i(d),u_pattern_tl_a:new a.Uniform2f(d),u_pattern_br_a:new a.Uniform2f(d),u_pattern_tl_b:new a.Uniform2f(d),u_pattern_br_b:new a.Uniform2f(d),u_texsize:new a.Uniform2f(d),u_mix:new a.Uniform1f(d),u_pattern_size_a:new a.Uniform2f(d),u_pattern_size_b:new a.Uniform2f(d),u_scale_a:new a.Uniform1f(d),u_scale_b:new a.Uniform1f(d),u_pixel_coord_upper:new a.Uniform2f(d),u_pixel_coord_lower:new a.Uniform2f(d),u_tile_units_to_pixels:new a.Uniform1f(d)}),terrainRaster:Ta,terrainDepth:Ta,skybox:d=>({u_matrix:new a.UniformMatrix4f(d),u_sun_direction:new a.Uniform3f(d),u_cubemap:new a.Uniform1i(d),u_opacity:new a.Uniform1f(d),u_temporal_offset:new a.Uniform1f(d)}),skyboxGradient:d=>({u_matrix:new a.UniformMatrix4f(d),u_color_ramp:new a.Uniform1i(d),u_center_direction:new a.Uniform3f(d),u_radius:new a.Uniform1f(d),u_opacity:new a.Uniform1f(d),u_temporal_offset:new a.Uniform1f(d)}),skyboxCapture:d=>({u_matrix_3f:new a.UniformMatrix3f(d),u_sun_direction:new a.Uniform3f(d),u_sun_intensity:new a.Uniform1f(d),u_color_tint_r:new a.Uniform4f(d),u_color_tint_m:new a.Uniform4f(d),u_luminance:new a.Uniform1f(d)}),globeRaster:d=>({u_proj_matrix:new a.UniformMatrix4f(d),u_globe_matrix:new a.UniformMatrix4f(d),u_normalize_matrix:new a.UniformMatrix4f(d),u_merc_matrix:new a.UniformMatrix4f(d),u_zoom_transition:new a.Uniform1f(d),u_merc_center:new a.Uniform2f(d),u_image0:new a.Uniform1i(d),u_grid_matrix:new a.UniformMatrix3f(d),u_frustum_tl:new a.Uniform3f(d),u_frustum_tr:new a.Uniform3f(d),u_frustum_br:new a.Uniform3f(d),u_frustum_bl:new a.Uniform3f(d),u_globe_pos:new a.Uniform3f(d),u_globe_radius:new a.Uniform1f(d),u_viewport:new a.Uniform2f(d)}),globeAtmosphere:d=>({u_frustum_tl:new a.Uniform3f(d),u_frustum_tr:new a.Uniform3f(d),u_frustum_br:new a.Uniform3f(d),u_frustum_bl:new a.Uniform3f(d),u_horizon:new a.Uniform1f(d),u_transition:new a.Uniform1f(d),u_fadeout_range:new a.Uniform1f(d),u_color:new a.Uniform4f(d),u_high_color:new a.Uniform4f(d),u_space_color:new a.Uniform4f(d),u_star_intensity:new a.Uniform1f(d),u_star_density:new a.Uniform1f(d),u_star_size:new a.Uniform1f(d),u_temporal_offset:new a.Uniform1f(d),u_horizon_angle:new a.Uniform1f(d),u_rotation_matrix:new a.UniformMatrix4f(d)})};let Rl;function tf(d,o,h,g,x,b,S){const A=d.context,I=A.gl,k=d.transform,R=d.useProgram("collisionBox"),U=[];let Z=0,J=0;for(let ve=0;ve<g.length;ve++){const ge=g[ve],ue=o.getTile(ge),_e=ue.getBucket(h);if(!_e)continue;const pe=dt(ge,_e,k);let we=pe;x[0]===0&&x[1]===0||(we=d.translatePosMatrix(pe,ue,x,b));const Ie=S?_e.textCollisionBox:_e.iconCollisionBox,Je=_e.collisionCircleArray;if(Je.length>0){const Ae=a.create(),Ue=we;a.mul(Ae,_e.placementInvProjMatrix,k.glCoordMatrix),a.mul(Ae,Ae,_e.placementViewportMatrix),U.push({circleArray:Je,circleOffset:J,transform:Ue,invTransform:Ae,projection:_e.getProjection()}),Z+=Je.length/4,J=Z}Ie&&(d.terrain&&d.terrain.setupElevationDraw(ue,R),R.draw(A,I.LINES,a.DepthMode.disabled,a.StencilMode.disabled,d.colorModeForRenderPass(),a.CullFaceMode.disabled,nu(we,k,ue,_e.getProjection()),h.id,Ie.layoutVertexBuffer,Ie.indexBuffer,Ie.segments,null,k.zoom,null,[Ie.collisionVertexBuffer,Ie.collisionVertexBufferExt]))}if(!S||!U.length)return;const H=d.useProgram("collisionCircle"),Y=new a.StructArrayLayout2f1f2i16;Y.resize(4*Z),Y._trim();let K=0;for(const ve of U)for(let ge=0;ge<ve.circleArray.length/4;ge++){const ue=4*ge,_e=ve.circleArray[ue+0],pe=ve.circleArray[ue+1],we=ve.circleArray[ue+2],Ie=ve.circleArray[ue+3];Y.emplace(K++,_e,pe,we,Ie,0),Y.emplace(K++,_e,pe,we,Ie,1),Y.emplace(K++,_e,pe,we,Ie,2),Y.emplace(K++,_e,pe,we,Ie,3)}(!Rl||Rl.length<2*Z)&&(Rl=function(ve){const ge=2*ve,ue=new a.StructArrayLayout3ui6;ue.resize(ge),ue._trim();for(let _e=0;_e<ge;_e++){const pe=6*_e;ue.uint16[pe+0]=4*_e+0,ue.uint16[pe+1]=4*_e+1,ue.uint16[pe+2]=4*_e+2,ue.uint16[pe+3]=4*_e+2,ue.uint16[pe+4]=4*_e+3,ue.uint16[pe+5]=4*_e+0}return ue}(Z));const X=A.createIndexBuffer(Rl,!0),ne=A.createVertexBuffer(Y,a.collisionCircleLayout.members,!0);for(const ve of U){const ge={u_matrix:ve.transform,u_inv_matrix:ve.invTransform,u_camera_to_center_distance:(ee=k).getCameraToCenterDistance(ve.projection),u_viewport_size:[ee.width,ee.height]};H.draw(A,I.TRIANGLES,a.DepthMode.disabled,a.StencilMode.disabled,d.colorModeForRenderPass(),a.CullFaceMode.disabled,ge,h.id,ne,X,a.SegmentVector.simpleSegment(0,2*ve.circleOffset,ve.circleArray.length,ve.circleArray.length/2),null,k.zoom)}var ee;ne.destroy(),X.destroy()}const rf=a.create();function lu(d,o,h,g,x,b){const{horizontalAlign:S,verticalAlign:A}=a.getAnchorAlignment(d),I=-(S-.5)*o,k=-(A-.5)*h,R=a.evaluateVariableOffset(d,g);return new a.pointGeometry((I/x+R[0])*b,(k/x+R[1])*b)}function cu(d,o,h,g,x,b,S,A,I,k,R){const U=d.text.placedSymbolArray,Z=d.text.dynamicLayoutVertexArray,J=d.icon.dynamicLayoutVertexArray,H={},Y=Rt(A,d.getProjection(),b),K=b.elevation,X=d.getProjection().upVectorScale(A.canonical,b.center.lat,b.worldSize);Z.clear();for(let ne=0;ne<U.length;ne++){const ee=U.get(ne),ve=d.allowVerticalPlacement&&!ee.placedOrientation,ge=ee.hidden||!ee.crossTileID||ve?null:g[ee.crossTileID];if(ge){const ue=new a.pointGeometry(ee.tileAnchorX,ee.tileAnchorY),_e=d.getProjection().upVector(A.canonical,ue.x,ue.y),pe=K?K.getAtTileOffset(A,ue.x,ue.y):0,we=zt([ee.projectedAnchorX+pe*_e[0]*X.metersToTile,ee.projectedAnchorY+pe*_e[1]*X.metersToTile,ee.projectedAnchorZ+pe*_e[2]*X.metersToTile],h?Y:S),Ie=Hn(b.getCameraToCenterDistance(d.getProjection()),we.signedDistanceFromCamera);let Je=x.evaluateSizeForFeature(d.textSizeData,k,ee)*Ie/a.ONE_EM;h&&(Je*=d.tilePixelRatio/I);const{width:Ae,height:Ue,anchor:qe,textOffset:rt,textScale:Be}=ge,et=lu(qe,Ae,Ue,rt,Be,Je);let We;if(h){const st=ue.add(et),{x:yt,y:At,z:kt}=d.getProjection().projectTilePoint(st.x,st.y,A.canonical);We=zt([yt+pe*_e[0]*X.metersToTile,At+pe*_e[1]*X.metersToTile,kt+pe*_e[2]*X.metersToTile],S).point}else{const st=o?et.rotate(-b.angle):et;We=[we.point[0]+st.x,we.point[1]+st.y,0]}const at=d.allowVerticalPlacement&&ee.placedOrientation===a.WritingMode.vertical?Math.PI/2:0;for(let st=0;st<ee.numGlyphs;st++)a.addDynamicAttributes(Z,We[0],We[1],We[2],at);R&&ee.associatedIconIndex>=0&&(H[ee.associatedIconIndex]={shiftedAnchor:We,angle:at})}else $(ee.numGlyphs,Z)}if(R){J.clear();const ne=d.icon.placedSymbolArray;for(let ee=0;ee<ne.length;ee++){const ve=ne.get(ee);if(ve.hidden)$(ve.numGlyphs,J);else{const ge=H[ee];if(ge)for(let ue=0;ue<ve.numGlyphs;ue++)a.addDynamicAttributes(J,ge.shiftedAnchor[0],ge.shiftedAnchor[1],ge.shiftedAnchor[2],ge.angle);else $(ve.numGlyphs,J)}}d.icon.dynamicLayoutVertexBuffer.updateData(J)}d.text.dynamicLayoutVertexBuffer.updateData(Z)}function nf(d,o,h){return h.iconsInText&&o?"symbolTextAndIcon":d?"symbolSDF":"symbolIcon"}function uu(d,o,h,g,x,b,S,A,I,k,R,U){const Z=d.context,J=Z.gl,H=d.transform,Y=A==="map",K=I==="map",X=Y&&h.layout.get("symbol-placement")!=="point",ne=Y&&!K&&!X,ee=h.layout.get("symbol-sort-key").constantOr(1)!==void 0;let ve=!1;const ge=d.depthModeForSublayer(0,a.DepthMode.ReadOnly),ue=[a.mercatorXfromLng(H.center.lng),a.mercatorYfromLat(H.center.lat)],_e=h.layout.get("text-variable-anchor"),pe=H.projection.name==="globe",we=[],Ie=[0,-1,0];let Je=Ie;!pe&&!H.mercatorFromTransition||Y||(Je=function(Ae){const Ue=Ae._camera.getWorldToCamera(Ae.worldSize,1),qe=a.multiply([],Ue,Ae.globeMatrix);a.invert(qe,qe);const rt=[0,0,0],Be=[0,1,0,0];return a.transformMat4$1(Be,Be,qe),rt[0]=Be[0],rt[1]=Be[1],rt[2]=Be[2],a.normalize(rt,rt),rt}(H));for(const Ae of g){const Ue=o.getTile(Ae),qe=Ue.getBucket(h);if(!qe||qe.projection.name==="mercator"&&pe)continue;const rt=x?qe.text:qe.icon;if(!rt||qe.fullyClipped||!rt.segments.get().length)continue;const Be=rt.programConfigurations.get(h.id),et=x||qe.sdfIcons,We=x?qe.textSizeData:qe.iconSizeData,at=K||H.pitch!==0,st=a.evaluateSizeForZoom(We,H.zoom);let yt,At,kt,Wt,vt=[0,0],Ft=null;if(x){if(At=Ue.glyphAtlasTexture,kt=J.LINEAR,yt=Ue.glyphAtlasTexture.size,qe.iconsInText){vt=Ue.imageAtlasTexture.size,Ft=Ue.imageAtlasTexture;const Ir=We.kind==="composite"||We.kind==="camera";Wt=at||d.options.rotating||d.options.zooming||Ir?J.LINEAR:J.NEAREST}}else{const Ir=h.layout.get("icon-size").constantOr(0)!==1||qe.iconsNeedLinear;At=Ue.imageAtlasTexture,kt=et||d.options.rotating||d.options.zooming||Ir||at?J.LINEAR:J.NEAREST,yt=Ue.imageAtlasTexture.size}const ei=qe.projection.name==="globe",xi=ei?Je:Ie,Di=ei?a.globeToMercatorTransition(H.zoom):0,ui=Rt(Ae,qe.getProjection(),H),lr=H.calculatePixelsToTileUnitsMatrix(Ue),bn=Nt(ui,Ue.tileID.canonical,K,Y,H,qe.getProjection(),lr),es=d.terrain&&K&&X?a.invert(a.create(),bn):rf,bi=pr(ui,Ue.tileID.canonical,K,Y,H,qe.getProjection(),lr),Ai=_e&&qe.hasTextData(),Zt=h.layout.get("icon-text-fit")!=="none"&&Ai&&qe.hasIconData();if(X){const Ir=H.elevation,ro=Ir?Ir.getAtTileOffsetFunc(Ae,H.center.lat,H.worldSize,qe.getProjection()):Ga=>[0,0,0],Ts=Lt(ui,Ue.tileID.canonical,K,Y,H,qe.getProjection(),lr);Rn(qe,ui,d,x,Ts,bi,K,k,ro,Ae)}const Gi=X||x&&_e||Zt,_r=d.translatePosMatrix(ui,Ue,b,S),pi=Gi?rf:bn,yr=d.translatePosMatrix(bi,Ue,b,S,!0),Qs=qe.getProjection().createInversionMatrix(H,Ae.canonical),Pr=[];d.terrain&&K&&Pr.push("PITCH_WITH_MAP_TERRAIN"),ei&&Pr.push("PROJECTION_GLOBE_VIEW"),Gi&&Pr.push("PROJECTED_POS_ON_VIEWPORT");const eo=et&&h.paint.get(x?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let to;to=et?qe.iconsInText?Oo(We.kind,st,ne,K,d,_r,pi,yr,yt,vt,Ae,Di,ue,Qs,xi,qe.getProjection()):au(We.kind,st,ne,K,d,_r,pi,yr,x,yt,!0,Ae,Di,ue,Qs,xi,qe.getProjection()):ou(We.kind,st,ne,K,d,_r,pi,yr,x,yt,Ae,Di,ue,Qs,xi,qe.getProjection());const io={program:d.useProgram(nf(et,x,qe),Be,Pr),buffers:rt,uniformValues:to,atlasTexture:At,atlasTextureIcon:Ft,atlasInterpolation:kt,atlasInterpolationIcon:Wt,isSDF:et,hasHalo:eo,tile:Ue,labelPlaneMatrixInv:es};if(ee&&qe.canOverlap){ve=!0;const Ir=rt.segments.get();for(const ro of Ir)we.push({segments:new a.SegmentVector([ro]),sortKey:ro.sortKey,state:io})}else we.push({segments:rt.segments,sortKey:0,state:io})}ve&&we.sort((Ae,Ue)=>Ae.sortKey-Ue.sortKey);for(const Ae of we){const Ue=Ae.state;if(d.terrain&&d.terrain.setupElevationDraw(Ue.tile,Ue.program,{useDepthForOcclusion:!pe,labelPlaneMatrixInv:Ue.labelPlaneMatrixInv}),Z.activeTexture.set(J.TEXTURE0),Ue.atlasTexture.bind(Ue.atlasInterpolation,J.CLAMP_TO_EDGE),Ue.atlasTextureIcon&&(Z.activeTexture.set(J.TEXTURE1),Ue.atlasTextureIcon&&Ue.atlasTextureIcon.bind(Ue.atlasInterpolationIcon,J.CLAMP_TO_EDGE)),Ue.isSDF){const qe=Ue.uniformValues;Ue.hasHalo&&(qe.u_is_halo=1,hu(Ue.buffers,Ae.segments,h,d,Ue.program,ge,R,U,qe)),qe.u_is_halo=0}hu(Ue.buffers,Ae.segments,h,d,Ue.program,ge,R,U,Ue.uniformValues)}}function hu(d,o,h,g,x,b,S,A,I){const k=g.context,R=[d.dynamicLayoutVertexBuffer,d.opacityVertexBuffer,d.globeExtVertexBuffer];x.draw(k,k.gl.TRIANGLES,b,S,A,a.CullFaceMode.disabled,I,h.id,d.layoutVertexBuffer,d.indexBuffer,o,h.paint,g.transform.zoom,d.programConfigurations.get(h.id),R)}function Ol(d,o,h,g,x,b,S){const A=d.context.gl,I=h.paint.get("fill-pattern"),k=I&&I.constantOr(1),R=h.getCrossfadeParameters();let U,Z,J,H,Y;S?(Z=k&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",U=A.LINES):(Z=k?"fillPattern":"fill",U=A.TRIANGLES);for(const K of g){const X=o.getTile(K);if(k&&!X.patternsLoaded())continue;const ne=X.getBucket(h);if(!ne)continue;d.prepareDrawTile();const ee=ne.programConfigurations.get(h.id),ve=d.useProgram(Z,ee);k&&(d.context.activeTexture.set(A.TEXTURE0),X.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),ee.updatePaintBuffers(R));const ge=I.constantOr(null);if(ge&&X.imageAtlas){const _e=X.imageAtlas,pe=_e.patternPositions[ge.to.toString()],we=_e.patternPositions[ge.from.toString()];pe&&we&&ee.setConstantPatternPositions(pe,we)}const ue=d.translatePosMatrix(K.projMatrix,X,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor"));if(S){H=ne.indexBuffer2,Y=ne.segments2;const _e=d.terrain&&d.terrain.renderingToTexture?d.terrain.drapeBufferSize:[A.drawingBufferWidth,A.drawingBufferHeight];J=Z==="fillOutlinePattern"&&k?iu(ue,d,R,X,_e):zn(ue,_e)}else H=ne.indexBuffer,Y=ne.segments,J=k?Pl(ue,d,R,X):Aa(ue);d.prepareDrawProgram(d.context,ve,K.toUnwrapped()),ve.draw(d.context,U,x,d.stencilModeForClipping(K),b,a.CullFaceMode.disabled,J,h.id,ne.layoutVertexBuffer,H,Y,h.paint,d.transform.zoom,ee)}}function Kn(d,o,h,g,x,b,S){const A=d.context,I=A.gl,k=d.transform,R=h.paint.get("fill-extrusion-pattern"),U=R.constantOr(1),Z=h.getCrossfadeParameters(),J=h.paint.get("fill-extrusion-opacity"),H=[h.paint.get("fill-extrusion-ambient-occlusion-intensity"),h.paint.get("fill-extrusion-ambient-occlusion-radius")],Y=h.layout.get("fill-extrusion-edge-radius"),K=k.projection.name==="globe"?a.fillExtrusionHeightLift():0,X=k.projection.name==="globe",ne=X?a.globeToMercatorTransition(k.zoom):0,ee=[a.mercatorXfromLng(k.center.lng),a.mercatorYfromLat(k.center.lat)],ve=[];X&&(ve.push("PROJECTION_GLOBE_VIEW"),d.style.terrainSetForDrapingOnly()&&ve.push("TERRAIN")),H[0]>0&&ve.push("FAUX_AO");for(const ge of g){const ue=o.getTile(ge),_e=ue.getBucket(h);if(!_e||_e.projection.name!==k.projection.name)continue;const pe=_e.programConfigurations.get(h.id),we=d.useProgram(U?"fillExtrusionPattern":"fillExtrusion",pe,ve);if(d.terrain){const Be=d.terrain;if(d.style.terrainSetForDrapingOnly())Be.setupElevationDraw(ue,we,{useMeterToDem:!0});else{if(!_e.enableTerrain)continue;if(Be.setupElevationDraw(ue,we,{useMeterToDem:!0}),Ma(A,o,ge,_e,h,Be),!_e.centroidVertexBuffer){const et=we.attributes.a_centroid_pos;et!==void 0&&I.vertexAttrib2f(et,0,0)}}}U&&(d.context.activeTexture.set(I.TEXTURE0),ue.imageAtlasTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),pe.updatePaintBuffers(Z));const Ie=R.constantOr(null);if(Ie&&ue.imageAtlas){const Be=ue.imageAtlas,et=Be.patternPositions[Ie.to.toString()],We=Be.patternPositions[Ie.from.toString()];et&&We&&pe.setConstantPatternPositions(et,We)}const Je=d.translatePosMatrix(ge.projMatrix,ue,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),Ae=k.projection.createInversionMatrix(k,ge.canonical),Ue=h.paint.get("fill-extrusion-vertical-gradient"),qe=U?Hh(Je,d,Ue,J,H,Y,ge,Z,ue,K,ne,ee,Ae):Ro(Je,d,Ue,J,H,Y,ge,K,ne,ee,Ae);d.prepareDrawProgram(A,we,ge.toUnwrapped());const rt=[];d.terrain&&rt.push(_e.centroidVertexBuffer),X&&rt.push(_e.layoutVertexExtBuffer),we.draw(A,A.gl.TRIANGLES,x,b,S,a.CullFaceMode.backCCW,qe,h.id,_e.layoutVertexBuffer,_e.indexBuffer,_e.segments,h.paint,d.transform.zoom,pe,rt)}}function Ma(d,o,h,g,x,b){const S=[X=>{let ne=X.canonical.x-1,ee=X.wrap;return ne<0&&(ne=(1<<X.canonical.z)-1,ee--),new a.OverscaledTileID(X.overscaledZ,ee,X.canonical.z,ne,X.canonical.y)},X=>{let ne=X.canonical.x+1,ee=X.wrap;return ne===1<<X.canonical.z&&(ne=0,ee++),new a.OverscaledTileID(X.overscaledZ,ee,X.canonical.z,ne,X.canonical.y)},X=>new a.OverscaledTileID(X.overscaledZ,X.wrap,X.canonical.z,X.canonical.x,(X.canonical.y===0?1<<X.canonical.z:X.canonical.y)-1),X=>new a.OverscaledTileID(X.overscaledZ,X.wrap,X.canonical.z,X.canonical.x,X.canonical.y===(1<<X.canonical.z)-1?0:X.canonical.y+1)],A=X=>{const ne=o.getSource().minzoom,ee=ge=>{const ue=o.getTileByID(ge);if(ue&&ue.hasData())return ue.getBucket(x)},ve=[0,-1,1];for(const ge of ve){if(X.overscaledZ+ge<ne)continue;const ue=ee(X.calculateScaledKey(X.overscaledZ+ge));if(ue)return ue}},I=[0,0,0],k=(X,ne)=>(I[0]=Math.min(X.min.y,ne.min.y),I[1]=Math.max(X.max.y,ne.max.y),I[2]=a.EXTENT-ne.min.x>X.max.x?ne.min.x-a.EXTENT:X.max.x,I),R=(X,ne)=>(I[0]=Math.min(X.min.x,ne.min.x),I[1]=Math.max(X.max.x,ne.max.x),I[2]=a.EXTENT-ne.min.y>X.max.y?ne.min.y-a.EXTENT:X.max.y,I),U=[(X,ne)=>k(X,ne),(X,ne)=>k(ne,X),(X,ne)=>R(X,ne),(X,ne)=>R(ne,X)],Z=new a.pointGeometry(0,0);let J,H,Y;const K=(X,ne,ee,ve,ge)=>{const ue=[[ve?ee:X,ve?X:ee,0],[ve?ee:ne,ve?ne:ee,0]],_e=ge<0?a.EXTENT+ge:ge,pe=[ve?_e:(X+ne)/2,ve?(X+ne)/2:_e,0];return ee===0&&ge<0||ee!==0&&ge>0?b.getForTilePoints(Y,[pe],!0,H):ue.push(pe),b.getForTilePoints(h,ue,!0,J),Math.max(ue[0][2],ue[1][2],pe[2])/b.exaggeration()};for(let X=0;X<4;X++){const ne=(X<2?1:5)-X,ee=g.borders[X];if(ee.length===0)continue;const ve=Y=S[X](h),ge=A(ve);if(!(ge&&ge instanceof a.FillExtrusionBucket&&ge.enableTerrain)||g.borderDoneWithNeighborZ[X]===ge.canonical.z&&ge.borderDoneWithNeighborZ[ne]===g.canonical.z||(H=b.findDEMTileFor(ve),!H||!H.dem))continue;if(!J){const we=b.findDEMTileFor(h);if(!we||!we.dem)return;J=we}const ue=ge.borders[ne];let _e=0;const pe=ge.borderDoneWithNeighborZ[ne]!==g.canonical.z;if(g.canonical.z===ge.canonical.z){for(let we=0;we<ee.length;we++){const Ie=g.featuresOnBorder[ee[we]],Je=Ie.borders[X];let Ae;for(;_e<ue.length&&(Ae=ge.featuresOnBorder[ue[_e]],!(Ae.borders[ne][1]>Je[0]+3));)pe&&ge.encodeCentroid(void 0,Ae,!1),_e++;if(Ae&&_e<ue.length){const Ue=_e;let qe=0;for(;!(Ae.borders[ne][0]>Je[1]-3)&&(qe++,++_e!==ue.length);)Ae=ge.featuresOnBorder[ue[_e]];if(Ae=ge.featuresOnBorder[ue[Ue]],Ie.intersectsCount()>1||Ae.intersectsCount()>1||qe!==1){qe!==1&&(_e=Ue),g.encodeCentroid(void 0,Ie,!1),pe&&ge.encodeCentroid(void 0,Ae,!1);continue}const rt=U[X](Ie,Ae),Be=X%2?a.EXTENT-1:0;Z.x=K(rt[0],Math.min(a.EXTENT-1,rt[1]),Be,X<2,rt[2]),Z.y=0,g.encodeCentroid(Z,Ie,!1),pe&&ge.encodeCentroid(Z,Ae,!1)}else g.encodeCentroid(void 0,Ie,!1)}g.borderDoneWithNeighborZ[X]=ge.canonical.z,g.needsCentroidUpdate=!0,pe&&(ge.borderDoneWithNeighborZ[ne]=g.canonical.z,ge.needsCentroidUpdate=!0)}else{for(const we of ee)g.encodeCentroid(void 0,g.featuresOnBorder[we],!1);if(pe){for(const we of ue)ge.encodeCentroid(void 0,ge.featuresOnBorder[we],!1);ge.borderDoneWithNeighborZ[ne]=g.canonical.z,ge.needsCentroidUpdate=!0}g.borderDoneWithNeighborZ[X]=ge.canonical.z,g.needsCentroidUpdate=!0}}(g.needsCentroidUpdate||!g.centroidVertexBuffer&&g.centroidVertexArray.length!==0)&&g.uploadCentroid(d)}const sf=new a.Color(1,0,0,1),Do=new a.Color(0,1,0,1),zo=new a.Color(0,0,1,1),of=new a.Color(1,0,1,1),fu=new a.Color(0,1,1,1);function si(d,o,h){const g=d.context,x=d.transform,b=g.gl,S=x.projection.name==="globe",A=S?["PROJECTION_GLOBE_VIEW"]:null;let I=h.projMatrix;if(S&&a.globeToMercatorTransition(x.zoom)>0){const Ie=a.transitionTileAABBinECEF(h.canonical,x),Je=a.globeDenormalizeECEF(Ie);I=a.multiply(new Float32Array(16),x.globeMatrix,Je),a.multiply(I,x.projMatrix,I)}const k=d.useProgram("debug",null,A),R=o.getTileByID(h.key);d.terrain&&d.terrain.setupElevationDraw(R,k);const U=a.DepthMode.disabled,Z=a.StencilMode.disabled,J=d.colorModeForRenderPass(),H="$debug";g.activeTexture.set(b.TEXTURE0),d.emptyTexture.bind(b.LINEAR,b.CLAMP_TO_EDGE),S?R._makeGlobeTileDebugBuffers(d.context,x):R._makeDebugTileBoundsBuffers(d.context,x.projection);const Y=R._tileDebugBuffer||d.debugBuffer,K=R._tileDebugIndexBuffer||d.debugIndexBuffer,X=R._tileDebugSegments||d.debugSegments;k.draw(g,b.LINE_STRIP,U,Z,J,a.CullFaceMode.disabled,Jh(I,a.Color.red),H,Y,K,X,null,null,null,[R._globeTileDebugBorderBuffer]);const ne=R.latestRawTileData,ee=Math.floor((ne&&ne.byteLength||0)/1024),ve=o.getTile(h).tileSize,ge=512/Math.min(ve,512)*(h.overscaledZ/x.zoom)*.5;let ue=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(ue+=` => ${h.overscaledZ}`),ue+=` ${ee}kb`,function(Ie,Je){Ie.initDebugOverlayCanvas();const Ae=Ie.debugOverlayCanvas,Ue=Ie.context.gl,qe=Ie.debugOverlayCanvas.getContext("2d");qe.clearRect(0,0,Ae.width,Ae.height),qe.shadowColor="white",qe.shadowBlur=2,qe.lineWidth=1.5,qe.strokeStyle="white",qe.textBaseline="top",qe.font="bold 36px Open Sans, sans-serif",qe.fillText(Je,5,5),qe.strokeText(Je,5,5),Ie.debugOverlayTexture.update(Ae),Ie.debugOverlayTexture.bind(Ue.LINEAR,Ue.CLAMP_TO_EDGE)}(d,ue);const _e=R._tileDebugTextBuffer||d.debugBuffer,pe=R._tileDebugTextIndexBuffer||d.quadTriangleIndexBuffer,we=R._tileDebugTextSegments||d.debugSegments;k.draw(g,b.TRIANGLES,U,Z,a.ColorMode.alphaBlended,a.CullFaceMode.disabled,Jh(I,a.Color.transparent,ge),H,_e,pe,we,null,null,null,[R._globeTileDebugTextBuffer])}function Pa(d,o,h,g){Ia(d,0,o+h/2,d.transform.width,h,g)}function af(d,o,h,g){Ia(d,o-h/2,0,h,d.transform.height,g)}function Ia(d,o,h,g,x,b){const S=d.context,A=S.gl;A.enable(A.SCISSOR_TEST),A.scissor(o*a.exported.devicePixelRatio,h*a.exported.devicePixelRatio,g*a.exported.devicePixelRatio,x*a.exported.devicePixelRatio),S.clear({color:b}),A.disable(A.SCISSOR_TEST)}const Ca=a.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Cp}=Ca;function ws(d,o,h,g){d.emplaceBack(o,h,g)}class du{constructor(o){this.vertexArray=new a.StructArrayLayout3f12,this.indices=new a.StructArrayLayout3ui6,ws(this.vertexArray,-1,-1,1),ws(this.vertexArray,1,-1,1),ws(this.vertexArray,-1,1,1),ws(this.vertexArray,1,1,1),ws(this.vertexArray,-1,-1,-1),ws(this.vertexArray,1,-1,-1),ws(this.vertexArray,-1,1,-1),ws(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=o.createVertexBuffer(this.vertexArray,Cp),this.indexBuffer=o.createIndexBuffer(this.indices),this.segment=a.SegmentVector.simpleSegment(0,0,36,12)}}function Bo(d,o,h,g,x,b){const S=d.gl,A=o.paint.get("sky-atmosphere-color"),I=o.paint.get("sky-atmosphere-halo-color"),k=o.paint.get("sky-atmosphere-sun-intensity"),R=((U,Z,J,H,Y)=>({u_matrix_3f:U,u_sun_direction:Z,u_sun_intensity:J,u_color_tint_r:[H.r,H.g,H.b,H.a],u_color_tint_m:[Y.r,Y.g,Y.b,Y.a],u_luminance:5e-5}))(a.fromMat4(a.create$1(),g),x,k,A,I);S.framebufferTexture2D(S.FRAMEBUFFER,S.COLOR_ATTACHMENT0,S.TEXTURE_CUBE_MAP_POSITIVE_X+b,o.skyboxTexture,0),h.draw(d,S.TRIANGLES,a.DepthMode.disabled,a.StencilMode.disabled,a.ColorMode.unblended,a.CullFaceMode.frontCW,R,"skyboxCapture",o.skyboxGeometry.vertexBuffer,o.skyboxGeometry.indexBuffer,o.skyboxGeometry.segment)}const pu=a.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Dl{constructor(o){const h=new a.StructArrayLayout5f20;h.emplaceBack(-1,1,1,0,0),h.emplaceBack(1,1,1,1,0),h.emplaceBack(1,-1,1,1,1),h.emplaceBack(-1,-1,1,0,1);const g=new a.StructArrayLayout3ui6;g.emplaceBack(0,1,2),g.emplaceBack(2,3,0),this.vertexBuffer=o.createVertexBuffer(h,pu.members),this.indexBuffer=o.createIndexBuffer(g),this.segments=a.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Fo={symbol:function(d,o,h,g,x){if(d.renderPass!=="translucent")return;const b=a.StencilMode.disabled,S=d.colorModeForRenderPass();h.layout.get("text-variable-anchor")&&function(A,I,k,R,U,Z,J){const H=I.transform,Y=U==="map",K=Z==="map";for(const X of A){const ne=R.getTile(X),ee=ne.getBucket(k);if(!ee||!ee.text||!ee.text.segments.get().length)continue;const ve=a.evaluateSizeForZoom(ee.textSizeData,H.zoom),ge=Rt(X,ee.getProjection(),H),ue=H.calculatePixelsToTileUnitsMatrix(ne),_e=Nt(ge,ne.tileID.canonical,K,Y,H,ee.getProjection(),ue),pe=k.layout.get("icon-text-fit")!=="none"&&ee.hasIconData();if(ve){const we=Math.pow(2,H.zoom-ne.tileID.overscaledZ);cu(ee,Y,K,J,a.symbolSize,H,_e,X,we,ve,pe)}}}(g,d,h,o,h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),x),h.paint.get("icon-opacity").constantOr(1)!==0&&uu(d,o,h,g,!1,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),h.layout.get("icon-rotation-alignment"),h.layout.get("icon-pitch-alignment"),h.layout.get("icon-keep-upright"),b,S),h.paint.get("text-opacity").constantOr(1)!==0&&uu(d,o,h,g,!0,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),h.layout.get("text-keep-upright"),b,S),o.map.showCollisionBoxes&&(tf(d,o,h,g,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),!0),tf(d,o,h,g,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),!1))},circle:function(d,o,h,g){if(d.renderPass!=="translucent")return;const x=h.paint.get("circle-opacity"),b=h.paint.get("circle-stroke-width"),S=h.paint.get("circle-stroke-opacity"),A=h.layout.get("circle-sort-key").constantOr(1)!==void 0;if(x.constantOr(1)===0&&(b.constantOr(1)===0||S.constantOr(1)===0))return;const I=d.context,k=I.gl,R=d.transform,U=d.depthModeForSublayer(0,a.DepthMode.ReadOnly),Z=a.StencilMode.disabled,J=d.colorModeForRenderPass(),H=R.projection.name==="globe",Y=[a.mercatorXfromLng(R.center.lng),a.mercatorYfromLat(R.center.lat)],K=[];for(let ne=0;ne<g.length;ne++){const ee=g[ne],ve=o.getTile(ee),ge=ve.getBucket(h);if(!ge||ge.projection.name!==R.projection.name)continue;const ue=ge.programConfigurations.get(h.id),_e=Kh(h);H&&_e.push("PROJECTION_GLOBE_VIEW");const pe=d.useProgram("circle",ue,_e),we=ge.layoutVertexBuffer,Ie=ge.globeExtVertexBuffer,Je=ge.indexBuffer,Ae=R.projection.createInversionMatrix(R,ee.canonical),Ue={programConfiguration:ue,program:pe,layoutVertexBuffer:we,globeExtVertexBuffer:Ie,indexBuffer:Je,uniformValues:ru(d,ee,ve,Ae,Y,h),tile:ve};if(A){const qe=ge.segments.get();for(const rt of qe)K.push({segments:new a.SegmentVector([rt]),sortKey:rt.sortKey,state:Ue})}else K.push({segments:ge.segments,sortKey:0,state:Ue})}A&&K.sort((ne,ee)=>ne.sortKey-ee.sortKey);const X={useDepthForOcclusion:!H};for(const ne of K){const{programConfiguration:ee,program:ve,layoutVertexBuffer:ge,globeExtVertexBuffer:ue,indexBuffer:_e,uniformValues:pe,tile:we}=ne.state,Ie=ne.segments;d.terrain&&d.terrain.setupElevationDraw(we,ve,X),d.prepareDrawProgram(I,ve,we.tileID.toUnwrapped()),ve.draw(I,k.TRIANGLES,U,Z,J,a.CullFaceMode.disabled,pe,h.id,ge,_e,Ie,h.paint,R.zoom,ee,[ue])}},heatmap:function(d,o,h,g){if(h.paint.get("heatmap-opacity")!==0)if(d.renderPass==="offscreen"){const x=d.context,b=x.gl,S=a.StencilMode.disabled,A=new a.ColorMode([b.ONE,b.ONE],a.Color.transparent,[!0,!0,!0,!0]);(function(J,H,Y,K){const X=J.gl,ne=H.width*K,ee=H.height*K;J.activeTexture.set(X.TEXTURE1),J.viewport.set([0,0,ne,ee]);let ve=Y.heatmapFbo;if(!ve||ve&&(ve.width!==ne||ve.height!==ee)){ve&&ve.destroy();const ge=X.createTexture();X.bindTexture(X.TEXTURE_2D,ge),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_WRAP_S,X.CLAMP_TO_EDGE),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_WRAP_T,X.CLAMP_TO_EDGE),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_MIN_FILTER,X.LINEAR),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_MAG_FILTER,X.LINEAR),ve=Y.heatmapFbo=J.createFramebuffer(ne,ee,!1),function(ue,_e,pe,we,Ie,Je){const Ae=ue.gl;Ae.texImage2D(Ae.TEXTURE_2D,0,Ae.RGBA,Ie,Je,0,Ae.RGBA,ue.extRenderToTextureHalfFloat?ue.extTextureHalfFloat.HALF_FLOAT_OES:Ae.UNSIGNED_BYTE,null),we.colorAttachment.set(pe)}(J,0,ge,ve,ne,ee)}else X.bindTexture(X.TEXTURE_2D,ve.colorAttachment.get()),J.bindFramebuffer.set(ve.framebuffer)})(x,d,h,d.transform.projection.name==="globe"?.5:.25),x.clear({color:a.Color.transparent});const I=d.transform,k=I.projection.name==="globe",R=k?["PROJECTION_GLOBE_VIEW"]:null,U=k?a.CullFaceMode.frontCCW:a.CullFaceMode.disabled,Z=[a.mercatorXfromLng(I.center.lng),a.mercatorYfromLat(I.center.lat)];for(let J=0;J<g.length;J++){const H=g[J];if(o.hasRenderableParent(H))continue;const Y=o.getTile(H),K=Y.getBucket(h);if(!K||K.projection.name!==I.projection.name)continue;const X=K.programConfigurations.get(h.id),ne=d.useProgram("heatmap",X,R),{zoom:ee}=d.transform;d.terrain&&d.terrain.setupElevationDraw(Y,ne),d.prepareDrawProgram(x,ne,H.toUnwrapped());const ve=I.projection.createInversionMatrix(I,H.canonical);ne.draw(x,b.TRIANGLES,a.DepthMode.disabled,S,A,U,Ep(d,H,Y,ve,Z,ee,h.paint.get("heatmap-intensity")),h.id,K.layoutVertexBuffer,K.indexBuffer,K.segments,h.paint,d.transform.zoom,X,k?[K.globeExtVertexBuffer]:null)}x.viewport.set([0,0,d.width,d.height])}else d.renderPass==="translucent"&&(d.context.setColorMode(d.colorModeForRenderPass()),function(x,b){const S=x.context,A=S.gl,I=b.heatmapFbo;if(!I)return;S.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,I.colorAttachment.get()),S.activeTexture.set(A.TEXTURE1);let k=b.colorRampTexture;k||(k=b.colorRampTexture=new a.Texture(S,b.colorRamp,A.RGBA)),k.bind(A.LINEAR,A.CLAMP_TO_EDGE),x.useProgram("heatmapTexture").draw(S,A.TRIANGLES,a.DepthMode.disabled,a.StencilMode.disabled,x.colorModeForRenderPass(),a.CullFaceMode.disabled,((R,U,Z,J)=>({u_image:0,u_color_ramp:1,u_opacity:U.paint.get("heatmap-opacity")}))(0,b),b.id,x.viewportBuffer,x.quadTriangleIndexBuffer,x.viewportSegments,b.paint,x.transform.zoom)}(d,h))},line:function(d,o,h,g){if(d.renderPass!=="translucent")return;const x=h.paint.get("line-opacity"),b=h.paint.get("line-width");if(x.constantOr(1)===0||b.constantOr(1)===0)return;const S=d.depthModeForSublayer(0,a.DepthMode.ReadOnly),A=d.colorModeForRenderPass(),I=d.terrain&&d.terrain.renderingToTexture?1:a.exported.devicePixelRatio,k=h.paint.get("line-dasharray"),R=k.constantOr(1),U=h.layout.get("line-cap"),Z=h.paint.get("line-pattern"),J=Z.constantOr(1),H=h.paint.get("line-gradient"),Y=h.getCrossfadeParameters(),K=J?"linePattern":"line",X=d.context,ne=X.gl,ee=(ge=>{const ue=[];Ll(ge)&&ue.push("RENDER_LINE_DASH"),ge.paint.get("line-gradient")&&ue.push("RENDER_LINE_GRADIENT");const _e=ge.paint.get("line-trim-offset");_e[0]===0&&_e[1]===0||ue.push("RENDER_LINE_TRIM_OFFSET");const pe=ge.paint.get("line-pattern").constantOr(1),we=ge.paint.get("line-opacity").constantOr(1)!==1;return!pe&&we&&ue.push("RENDER_LINE_ALPHA_DISCARD"),ue})(h);let ve=ee.includes("RENDER_LINE_ALPHA_DISCARD");d.terrain&&d.terrain.clipOrMaskOverlapStencilType()&&(ve=!1);for(const ge of g){const ue=o.getTile(ge);if(J&&!ue.patternsLoaded())continue;const _e=ue.getBucket(h);if(!_e)continue;d.prepareDrawTile();const pe=_e.programConfigurations.get(h.id),we=d.useProgram(K,pe,ee),Ie=Z.constantOr(null);if(Ie&&ue.imageAtlas){const We=ue.imageAtlas,at=We.patternPositions[Ie.to.toString()],st=We.patternPositions[Ie.from.toString()];at&&st&&pe.setConstantPatternPositions(at,st)}const Je=k.constantOr(null),Ae=U.constantOr(null);if(!J&&Je&&Ae&&ue.lineAtlas){const We=ue.lineAtlas,at=We.getDash(Je.to,Ae),st=We.getDash(Je.from,Ae);at&&st&&pe.setConstantPatternPositions(at,st)}let[Ue,qe]=h.paint.get("line-trim-offset");(Ae==="round"||Ae==="square")&&Ue!==qe&&(Ue===0&&(Ue-=1),qe===1&&(qe+=1));const rt=d.terrain?ge.projMatrix:null,Be=J?Sp(d,ue,h,Y,rt,I):Il(d,ue,h,Y,rt,_e.lineClipsArray.length,I,[Ue,qe]);if(H){const We=_e.gradients[h.id];let at=We.texture;if(h.gradientVersion!==We.version){let st=256;if(h.stepInterpolant){const yt=o.getSource().maxzoom,At=ge.canonical.z===yt?Math.ceil(1<<d.transform.maxZoom-ge.canonical.z):1;st=a.clamp(a.nextPowerOfTwo(_e.maxLineLength/a.EXTENT*1024*At),256,X.maxTextureSize)}We.gradient=a.renderColorRamp({expression:h.gradientExpression(),evaluationKey:"lineProgress",resolution:st,image:We.gradient||void 0,clips:_e.lineClipsArray}),We.texture?We.texture.update(We.gradient):We.texture=new a.Texture(X,We.gradient,ne.RGBA),We.version=h.gradientVersion,at=We.texture}X.activeTexture.set(ne.TEXTURE1),at.bind(h.stepInterpolant?ne.NEAREST:ne.LINEAR,ne.CLAMP_TO_EDGE)}R&&(X.activeTexture.set(ne.TEXTURE0),ue.lineAtlasTexture.bind(ne.LINEAR,ne.REPEAT),pe.updatePaintBuffers(Y)),J&&(X.activeTexture.set(ne.TEXTURE0),ue.imageAtlasTexture.bind(ne.LINEAR,ne.CLAMP_TO_EDGE),pe.updatePaintBuffers(Y)),d.prepareDrawProgram(X,we,ge.toUnwrapped());const et=We=>{we.draw(X,ne.TRIANGLES,S,We,A,a.CullFaceMode.disabled,Be,h.id,_e.layoutVertexBuffer,_e.indexBuffer,_e.segments,h.paint,d.transform.zoom,pe,[_e.layoutVertexBuffer2])};if(ve){const We=d.stencilModeForClipping(ge).ref;We===0&&d.terrain&&X.clear({stencil:0});const at={func:ne.EQUAL,mask:255};Be.u_alpha_discard_threshold=.8,et(new a.StencilMode(at,We,255,ne.KEEP,ne.KEEP,ne.INVERT)),Be.u_alpha_discard_threshold=0,et(new a.StencilMode(at,We,255,ne.KEEP,ne.KEEP,ne.KEEP))}else et(d.stencilModeForClipping(ge))}ve&&(d.resetStencilClippingMasks(),d.terrain&&X.clear({stencil:0}))},fill:function(d,o,h,g){const x=h.paint.get("fill-color"),b=h.paint.get("fill-opacity");if(b.constantOr(1)===0)return;const S=d.colorModeForRenderPass(),A=h.paint.get("fill-pattern"),I=d.opaquePassEnabledForLayer()&&!A.constantOr(1)&&x.constantOr(a.Color.transparent).a===1&&b.constantOr(0)===1?"opaque":"translucent";if(d.renderPass===I){const k=d.depthModeForSublayer(1,d.renderPass==="opaque"?a.DepthMode.ReadWrite:a.DepthMode.ReadOnly);Ol(d,o,h,g,k,S,!1)}if(d.renderPass==="translucent"&&h.paint.get("fill-antialias")){const k=d.depthModeForSublayer(h.getPaintProperty("fill-outline-color")?2:0,a.DepthMode.ReadOnly);Ol(d,o,h,g,k,S,!0)}},"fill-extrusion":function(d,o,h,g){const x=h.paint.get("fill-extrusion-opacity");if(x!==0&&d.renderPass==="translucent"){const b=new a.DepthMode(d.context.gl.LEQUAL,a.DepthMode.ReadWrite,d.depthRangeFor3D);if(x!==1||h.paint.get("fill-extrusion-pattern").constantOr(1))Kn(d,o,h,g,b,a.StencilMode.disabled,a.ColorMode.disabled),Kn(d,o,h,g,b,d.stencilModeFor3D(),d.colorModeForRenderPass()),d.resetStencilClippingMasks();else{const S=d.colorModeForRenderPass();Kn(d,o,h,g,b,a.StencilMode.disabled,S)}}},hillshade:function(d,o,h,g){if(d.renderPass!=="offscreen"&&d.renderPass!=="translucent")return;const x=d.context,b=d.depthModeForSublayer(0,a.DepthMode.ReadOnly),S=d.colorModeForRenderPass(),A=d.terrain&&d.terrain.renderingToTexture,[I,k]=d.renderPass!=="translucent"||A?[{},g]:d.stencilConfigForOverlap(g);for(const R of k){const U=o.getTile(R);if(U.needsHillshadePrepare&&d.renderPass==="offscreen")ko(d,U,h,b,a.StencilMode.disabled,S);else if(d.renderPass==="translucent"){const Z=A&&d.terrain?d.terrain.stencilModeForRTTOverlap(R):I[R.overscaledZ];Xc(d,R,U,h,b,Z,S)}}x.viewport.set([0,0,d.width,d.height]),d.resetStencilClippingMasks()},raster:function(d,o,h,g,x,b){if(d.renderPass!=="translucent"||h.paint.get("raster-opacity")===0||!g.length)return;const S=d.context,A=S.gl,I=o.getSource(),k=d.useProgram("raster"),R=d.colorModeForRenderPass(),U=d.terrain&&d.terrain.renderingToTexture,[Z,J]=I instanceof Te||U?[{},g]:d.stencilConfigForOverlap(g),H=J[J.length-1].overscaledZ,Y=!d.options.moving;for(const K of J){const X=U?a.DepthMode.disabled:d.depthModeForSublayer(K.overscaledZ-H,h.paint.get("raster-opacity")===1?a.DepthMode.ReadWrite:a.DepthMode.ReadOnly,A.LESS),ne=K.toUnwrapped(),ee=o.getTile(K);if(U&&(!ee||!ee.hasData()))continue;const ve=U?K.projMatrix:d.transform.calculateProjMatrix(ne,Y),ge=d.terrain&&U?d.terrain.stencilModeForRTTOverlap(K):Z[K.overscaledZ],ue=b?0:h.paint.get("raster-fade-duration");ee.registerFadeDuration(ue);const _e=o.findLoadedParent(K,0),pe=Al(ee,_e,o,d.transform,ue);let we,Ie;d.terrain&&d.terrain.prepareDrawTile();const Je=h.paint.get("raster-resampling")==="nearest"?A.NEAREST:A.LINEAR;S.activeTexture.set(A.TEXTURE0),ee.texture.bind(Je,A.CLAMP_TO_EDGE),S.activeTexture.set(A.TEXTURE1),_e?(_e.texture.bind(Je,A.CLAMP_TO_EDGE),we=Math.pow(2,_e.tileID.overscaledZ-ee.tileID.overscaledZ),Ie=[ee.tileID.canonical.x*we%1,ee.tileID.canonical.y*we%1]):ee.texture.bind(Je,A.CLAMP_TO_EDGE);const Ae=Ap(ve,Ie||[0,0],we||1,pe,h,I instanceof Te?I.perspectiveTransform:[0,0]);if(d.prepareDrawProgram(S,k,ne),I instanceof Te)I.boundsBuffer&&I.boundsSegments&&k.draw(S,A.TRIANGLES,X,a.StencilMode.disabled,R,a.CullFaceMode.disabled,Ae,h.id,I.boundsBuffer,d.quadTriangleIndexBuffer,I.boundsSegments);else{const{tileBoundsBuffer:Ue,tileBoundsIndexBuffer:qe,tileBoundsSegments:rt}=d.getTileBoundsBuffers(ee);k.draw(S,A.TRIANGLES,X,ge,R,a.CullFaceMode.disabled,Ae,h.id,Ue,qe,rt)}}d.resetStencilClippingMasks()},background:function(d,o,h,g){const x=h.paint.get("background-color"),b=h.paint.get("background-opacity");if(b===0)return;const S=d.context,A=S.gl,I=d.transform,k=I.tileSize,R=h.paint.get("background-pattern");if(d.isPatternMissing(R))return;const U=!R&&x.a===1&&b===1&&d.opaquePassEnabledForLayer()?"opaque":"translucent";if(d.renderPass!==U)return;const Z=a.StencilMode.disabled,J=d.depthModeForSublayer(0,U==="opaque"?a.DepthMode.ReadWrite:a.DepthMode.ReadOnly),H=d.colorModeForRenderPass(),Y=d.useProgram(R?"backgroundPattern":"background");let K,X=g;X||(K=d.getBackgroundTiles(),X=Object.values(K).map(ee=>ee.tileID)),R&&(S.activeTexture.set(A.TEXTURE0),d.imageManager.bind(d.context));const ne=h.getCrossfadeParameters();for(const ee of X){const ve=ee.toUnwrapped(),ge=g?ee.projMatrix:d.transform.calculateProjMatrix(ve);d.prepareDrawTile();const ue=o?o.getTile(ee):K?K[ee.key]:new a.Tile(ee,k,I.zoom,d),_e=R?Pp(ge,b,d,R,{tileID:ee,tileSize:k},ne):Mp(ge,b,x);d.prepareDrawProgram(S,Y,ve);const{tileBoundsBuffer:pe,tileBoundsIndexBuffer:we,tileBoundsSegments:Ie}=d.getTileBoundsBuffers(ue);Y.draw(S,A.TRIANGLES,J,Z,H,a.CullFaceMode.disabled,_e,h.id,pe,we,Ie)}},sky:function(d,o,h){const g=d.transform,x=g.projection.name==="mercator"||g.projection.name==="globe"?1:a.smoothstep(7,8,g.zoom),b=h.paint.get("sky-opacity")*x;if(b===0)return;const S=d.context,A=h.paint.get("sky-type"),I=new a.DepthMode(S.gl.LEQUAL,a.DepthMode.ReadOnly,[0,1]),k=d.frameCounter/1e3%1;A==="atmosphere"?d.renderPass==="offscreen"?h.needsSkyboxCapture(d)&&(function(R,U,Z,J){const H=R.context,Y=H.gl;let K=U.skyboxFbo;if(!K){K=U.skyboxFbo=H.createFramebuffer(32,32,!1),U.skyboxGeometry=new du(H),U.skyboxTexture=H.gl.createTexture(),Y.bindTexture(Y.TEXTURE_CUBE_MAP,U.skyboxTexture),Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_WRAP_S,Y.CLAMP_TO_EDGE),Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_WRAP_T,Y.CLAMP_TO_EDGE),Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_MIN_FILTER,Y.LINEAR),Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_MAG_FILTER,Y.LINEAR);for(let ve=0;ve<6;++ve)Y.texImage2D(Y.TEXTURE_CUBE_MAP_POSITIVE_X+ve,0,Y.RGBA,32,32,0,Y.RGBA,Y.UNSIGNED_BYTE,null)}H.bindFramebuffer.set(K.framebuffer),H.viewport.set([0,0,32,32]);const X=U.getCenter(R,!0),ne=R.useProgram("skyboxCapture"),ee=new Float64Array(16);a.identity(ee),a.rotateY(ee,ee,.5*-Math.PI),Bo(H,U,ne,ee,X,0),a.identity(ee),a.rotateY(ee,ee,.5*Math.PI),Bo(H,U,ne,ee,X,1),a.identity(ee),a.rotateX(ee,ee,.5*-Math.PI),Bo(H,U,ne,ee,X,2),a.identity(ee),a.rotateX(ee,ee,.5*Math.PI),Bo(H,U,ne,ee,X,3),a.identity(ee),Bo(H,U,ne,ee,X,4),a.identity(ee),a.rotateY(ee,ee,Math.PI),Bo(H,U,ne,ee,X,5),H.viewport.set([0,0,R.width,R.height])}(d,h),h.markSkyboxValid(d)):d.renderPass==="sky"&&function(R,U,Z,J,H){const Y=R.context,K=Y.gl,X=R.transform,ne=R.useProgram("skybox");Y.activeTexture.set(K.TEXTURE0),K.bindTexture(K.TEXTURE_CUBE_MAP,U.skyboxTexture);const ee=((ve,ge,ue,_e,pe)=>({u_matrix:ve,u_sun_direction:ge,u_cubemap:0,u_opacity:_e,u_temporal_offset:pe}))(X.skyboxMatrix,U.getCenter(R,!1),0,J,H);R.prepareDrawProgram(Y,ne),ne.draw(Y,K.TRIANGLES,Z,a.StencilMode.disabled,R.colorModeForRenderPass(),a.CullFaceMode.backCW,ee,"skybox",U.skyboxGeometry.vertexBuffer,U.skyboxGeometry.indexBuffer,U.skyboxGeometry.segment)}(d,h,I,b,k):A==="gradient"&&d.renderPass==="sky"&&function(R,U,Z,J,H){const Y=R.context,K=Y.gl,X=R.transform,ne=R.useProgram("skyboxGradient");U.skyboxGeometry||(U.skyboxGeometry=new du(Y)),Y.activeTexture.set(K.TEXTURE0);let ee=U.colorRampTexture;ee||(ee=U.colorRampTexture=new a.Texture(Y,U.colorRamp,K.RGBA)),ee.bind(K.LINEAR,K.CLAMP_TO_EDGE);const ve=((ge,ue,_e,pe,we)=>({u_matrix:ge,u_color_ramp:0,u_center_direction:ue,u_radius:a.degToRad(_e),u_opacity:pe,u_temporal_offset:we}))(X.skyboxMatrix,U.getCenter(R,!1),U.paint.get("sky-gradient-radius"),J,H);R.prepareDrawProgram(Y,ne),ne.draw(Y,K.TRIANGLES,Z,a.StencilMode.disabled,R.colorModeForRenderPass(),a.CullFaceMode.backCW,ve,"skyboxGradient",U.skyboxGeometry.vertexBuffer,U.skyboxGeometry.indexBuffer,U.skyboxGeometry.segment)}(d,h,I,b,k)},debug:function(d,o,h){for(let g=0;g<h.length;g++)si(d,o,h[g])},custom:function(d,o,h){const g=d.context,x=h.implementation;if(d.transform.projection.unsupportedLayers&&d.transform.projection.unsupportedLayers.includes("custom"))a.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if(d.renderPass==="offscreen"){const b=x.prerender;b&&(d.setCustomLayerDefaults(),g.setColorMode(d.colorModeForRenderPass()),b.call(x,g.gl,d.transform.customLayerMatrix()),g.setDirty(),d.setBaseState())}else if(d.renderPass==="translucent"){d.setCustomLayerDefaults(),g.setColorMode(d.colorModeForRenderPass()),g.setStencilMode(a.StencilMode.disabled);const b=x.renderingMode==="3d"?new a.DepthMode(d.context.gl.LEQUAL,a.DepthMode.ReadWrite,d.depthRangeFor3D):d.depthModeForSublayer(0,a.DepthMode.ReadOnly);g.setDepthMode(b),x.render(g.gl,d.transform.customLayerMatrix()),g.setDirty(),d.setBaseState(),g.bindFramebuffer.set(null)}}};class mu{constructor(o,h){this.context=new te(o),this.transform=h,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=a.SourceCache.maxUnderzooming+a.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new vl,this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(o,h){const g=!!o&&!!o.terrain&&this.transform.projection.supportsTerrain;if(!(g||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new qh(this,o));const x=this._terrain;this.transform.elevation=g?x:null,x.update(o,this.transform,h)}_updateFog(o){const h=o.fog;if(!h||this.transform.projection.name==="globe"||h.getOpacity(this.transform.pitch)<1||h.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[g,x]=h.getFovAdjustedRange(this.transform._fov);if(g>x)return void(this.transform.fogCullDistSq=null);const b=g+.78*(x-g);this.transform.fogCullDistSq=b*b}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(o,h){if(this.width=o*a.exported.devicePixelRatio,this.height=h*a.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const g of this.style.order)this.style._layers[g].resize()}setup(){const o=this.context,h=new a.StructArrayLayout2i4;h.emplaceBack(0,0),h.emplaceBack(a.EXTENT,0),h.emplaceBack(0,a.EXTENT),h.emplaceBack(a.EXTENT,a.EXTENT),this.tileExtentBuffer=o.createVertexBuffer(h,a.posAttributes.members),this.tileExtentSegments=a.SegmentVector.simpleSegment(0,0,4,2);const g=new a.StructArrayLayout2i4;g.emplaceBack(0,0),g.emplaceBack(a.EXTENT,0),g.emplaceBack(0,a.EXTENT),g.emplaceBack(a.EXTENT,a.EXTENT),this.debugBuffer=o.createVertexBuffer(g,a.posAttributes.members),this.debugSegments=a.SegmentVector.simpleSegment(0,0,4,5);const x=new a.StructArrayLayout2i4;x.emplaceBack(-1,-1),x.emplaceBack(1,-1),x.emplaceBack(-1,1),x.emplaceBack(1,1),this.viewportBuffer=o.createVertexBuffer(x,a.posAttributes.members),this.viewportSegments=a.SegmentVector.simpleSegment(0,0,4,2);const b=new a.StructArrayLayout4i8;b.emplaceBack(0,0,0,0),b.emplaceBack(a.EXTENT,0,a.EXTENT,0),b.emplaceBack(0,a.EXTENT,0,a.EXTENT),b.emplaceBack(a.EXTENT,a.EXTENT,a.EXTENT,a.EXTENT),this.mercatorBoundsBuffer=o.createVertexBuffer(b,a.boundsAttributes.members),this.mercatorBoundsSegments=a.SegmentVector.simpleSegment(0,0,4,2);const S=new a.StructArrayLayout3ui6;S.emplaceBack(0,1,2),S.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=o.createIndexBuffer(S);const A=new a.StructArrayLayout1ui2;for(const k of[0,1,3,2,0])A.emplaceBack(k);this.debugIndexBuffer=o.createIndexBuffer(A),this.emptyTexture=new a.Texture(o,new a.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),o.gl.RGBA),this.identityMat=a.create();const I=this.context.gl;this.stencilClearMode=new a.StencilMode({func:I.ALWAYS,mask:0},0,255,I.ZERO,I.ZERO,I.ZERO),this.loadTimeStamps.push(a.window.performance.now()),this.atmosphereBuffer=new Dl(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(o){return o._makeTileBoundsBuffers(this.context,this.transform.projection),o._tileBoundsBuffer?{tileBoundsBuffer:o._tileBoundsBuffer,tileBoundsIndexBuffer:o._tileBoundsIndexBuffer,tileBoundsSegments:o._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const o=this.context,h=o.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(o,h.TRIANGLES,a.DepthMode.disabled,this.stencilClearMode,a.ColorMode.disabled,a.CullFaceMode.disabled,Jc(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(o,h,g){if(!h||this.currentStencilSource===h.id||!o.isTileClipped()||!g||g.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let A=!1;for(const I of g)if(this._tileClippingMaskIDs[I.key]===void 0){A=!0;break}if(!A)return}this.currentStencilSource=h.id;const x=this.context,b=x.gl;this.nextStencilID+g.length>256&&this.clearStencil(),x.setColorMode(a.ColorMode.disabled),x.setDepthMode(a.DepthMode.disabled);const S=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const A of g){const I=h.getTile(A),k=this._tileClippingMaskIDs[A.key]=this.nextStencilID++,{tileBoundsBuffer:R,tileBoundsIndexBuffer:U,tileBoundsSegments:Z}=this.getTileBoundsBuffers(I);S.draw(x,b.TRIANGLES,a.DepthMode.disabled,new a.StencilMode({func:b.ALWAYS,mask:0},k,255,b.KEEP,b.KEEP,b.REPLACE),a.ColorMode.disabled,a.CullFaceMode.disabled,Jc(A.projMatrix),"$clipping",R,U,Z)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const o=this.nextStencilID++,h=this.context.gl;return new a.StencilMode({func:h.NOTEQUAL,mask:255},o,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(o){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(o);const h=this.context.gl;return new a.StencilMode({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[o.key],0,h.KEEP,h.KEEP,h.REPLACE)}stencilConfigForOverlap(o){const h=this.context.gl,g=o.sort((S,A)=>A.overscaledZ-S.overscaledZ),x=g[g.length-1].overscaledZ,b=g[0].overscaledZ-x+1;if(b>1){this.currentStencilSource=void 0,this.nextStencilID+b>256&&this.clearStencil();const S={};for(let A=0;A<b;A++)S[A+x]=new a.StencilMode({func:h.GEQUAL,mask:255},A+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=b,[S,g]}return[{[x]:a.StencilMode.disabled},g]}colorModeForRenderPass(){const o=this.context.gl;return this._showOverdrawInspector?new a.ColorMode([o.CONSTANT_COLOR,o.ONE],new a.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?a.ColorMode.unblended:a.ColorMode.alphaBlended}depthModeForSublayer(o,h,g){if(!this.opaquePassEnabledForLayer())return a.DepthMode.disabled;const x=1-((1+this.currentLayer)*this.numSublayers+o)*this.depthEpsilon;return new a.DepthMode(g||this.context.gl.LEQUAL,h,[x,x])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(o,h){this.style=o,this.options=h,this.lineAtlas=o.lineAtlas,this.imageManager=o.imageManager,this.glyphManager=o.glyphManager,this.symbolFadeChange=o.placement.symbolFadeChange(a.exported.now()),this.imageManager.beginFrame();const g=this.style.order,x=this.style._sourceCaches;for(const I in x){const k=x[I];k.used&&k.prepare(this.context)}const b={},S={},A={};for(const I in x){const k=x[I];b[I]=k.getVisibleCoordinates(),S[I]=b[I].slice().reverse(),A[I]=k.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let I=0;I<g.length;I++)if(this.style._layers[g[I]].is3D()){this.opaquePassCutoff=I;break}if(this.terrain&&(this.terrain.updateTileBinding(A),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new a.GlobeSharedBuffers(this.context)),a.isMapAuthenticated(this.context.gl)){this.renderPass="offscreen";for(const I of g){const k=this.style._layers[I],R=o._getLayerSourceCache(k);if(!k.hasOffscreenPass()||k.isHidden(this.transform.zoom))continue;const U=R?S[R.id]:void 0;(k.type==="custom"||k.isSky()||U&&U.length)&&this.renderLayer(this,R,k,U)}if(this.depthRangeFor3D=[0,1-(o.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:h.showOverdrawInspector?a.Color.black:a.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=h.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=g.length-1;this.currentLayer>=0;this.currentLayer--){const I=this.style._layers[g[this.currentLayer]],k=o._getLayerSourceCache(I);if(I.isSky())continue;const R=k?S[k.id]:void 0;this._renderTileClippingMasks(I,k,R),this.renderLayer(this,k,I,R)}if(this.style.fog&&this.transform.projection.supportsFog&&function(I,k){const R=I.context,U=R.gl,Z=I.transform,J=new a.DepthMode(U.LEQUAL,a.DepthMode.ReadOnly,[0,1]),H=I.useProgram("globeAtmosphere",null,Z.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),Y=a.globeToMercatorTransition(Z.zoom),K=k.properties.get("color").toArray01(),X=k.properties.get("high-color").toArray01(),ne=k.properties.get("space-color").toArray01PremultipliedAlpha(),ee=a.identity$1([]);a.rotateY$1(ee,ee,-a.degToRad(Z._center.lng)),a.rotateX$1(ee,ee,a.degToRad(Z._center.lat)),a.rotateZ$1(ee,ee,Z.angle),a.rotateX$1(ee,ee,-Z._pitch);const ve=a.fromQuat(new Float32Array(16),ee),ge=a.mapValue(k.properties.get("star-intensity"),0,1,0,.25),ue=5e-4,_e=a.mapValue(k.properties.get("horizon-blend"),0,1,ue,.25),pe=a.globeUseCustomAntiAliasing(I,R,Z)&&_e===ue?Z.worldSize/(2*Math.PI*1.025)-1:Z.globeRadius,we=I.frameCounter/1e3%1,Ie=a.length(Z.globeCenterInViewSpace),Je=Math.sqrt(Math.pow(Ie,2)-Math.pow(pe,2)),Ae=Math.acos(Je/Ie),Ue=((rt,Be,et,We,at,st,yt,At,kt,Wt,vt,Ft,ei,xi)=>({u_frustum_tl:rt,u_frustum_tr:Be,u_frustum_br:et,u_frustum_bl:We,u_horizon:at,u_transition:st,u_fadeout_range:yt,u_color:At,u_high_color:kt,u_space_color:Wt,u_star_intensity:vt,u_star_size:5*a.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:Ft,u_horizon_angle:ei,u_rotation_matrix:xi}))(Z.frustumCorners.TL,Z.frustumCorners.TR,Z.frustumCorners.BR,Z.frustumCorners.BL,Z.frustumCorners.horizon,Y,_e,K,X,ne,ge,we,Ae,ve);I.prepareDrawProgram(R,H);const qe=I.atmosphereBuffer;qe&&H.draw(R,U.TRIANGLES,J,a.StencilMode.disabled,a.ColorMode.alphaBlended,a.CullFaceMode.backCW,Ue,"skybox",qe.vertexBuffer,qe.indexBuffer,qe.segments)}(this,this.style.fog),this.renderPass="sky",(a.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<g.length;this.currentLayer++){const I=this.style._layers[g[this.currentLayer]],k=o._getLayerSourceCache(I);I.isSky()&&this.renderLayer(this,k,I,k?S[k.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<g.length;){const I=this.style._layers[g[this.currentLayer]],k=o._getLayerSourceCache(I);if(I.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(I)){if(I.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const R=k?(I.type==="symbol"?A:S)[k.id]:void 0;this._renderTileClippingMasks(I,k,k?b[k.id]:void 0),this.renderLayer(this,k,I,R),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let I=null;a.values(this.style._layers).forEach(k=>{const R=o._getLayerSourceCache(k);R&&!k.isHidden(this.transform.zoom)&&(!I||I.getSource().maxzoom<R.getSource().maxzoom)&&(I=R)}),I&&this.options.showTileBoundaries&&Fo.debug(this,I,I.getVisibleCoordinates())}this.options.showPadding&&function(I){const k=I.transform.padding;Pa(I,I.transform.height-(k.top||0),3,sf),Pa(I,k.bottom||0,3,Do),af(I,k.left||0,3,zo),af(I,I.transform.width-(k.right||0),3,of);const R=I.transform.centerPoint;(function(U,Z,J,H){Ia(U,Z-1,J-10,2,20,H),Ia(U,Z-10,J-1,20,2,H)})(I,R.x,I.transform.height-R.y,fu)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(a.window.performance.now()),this.saveCanvasCopy())}}renderLayer(o,h,g,x){g.isHidden(this.transform.zoom)||(g.type==="background"||g.type==="sky"||g.type==="custom"||x&&x.length)&&(this.id=g.id,this.gpuTimingStart(g),o.transform.projection.unsupportedLayers&&o.transform.projection.unsupportedLayers.includes(g.type)||Fo[g.type](o,h,g,x,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(o){if(!this.options.gpuTiming)return;const h=this.context.extTimerQuery;let g=this.gpuTimers[o.id];g||(g=this.gpuTimers[o.id]={calls:0,cpuTime:0,query:h.createQueryEXT()}),g.calls++,h.beginQueryEXT(h.TIME_ELAPSED_EXT,g.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const o=this.context.extTimerQuery,h=o.createQueryEXT();this.deferredRenderGpuTimeQueries.push(h),o.beginQueryEXT(o.TIME_ELAPSED_EXT,h)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const o=this.context.extTimerQuery;o.endQueryEXT(o.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const o=this.context.extTimerQuery;o.endQueryEXT(o.TIME_ELAPSED_EXT)}collectGpuTimers(){const o=this.gpuTimers;return this.gpuTimers={},o}collectDeferredRenderGpuQueries(){const o=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],o}queryGpuTimers(o){const h={};for(const g in o){const x=o[g],b=this.context.extTimerQuery,S=b.getQueryObjectEXT(x.query,b.QUERY_RESULT_EXT)/1e6;b.deleteQueryEXT(x.query),h[g]=S}return h}queryGpuTimeDeferredRender(o){if(!this.options.gpuTimingDeferredRender)return 0;const h=this.context.extTimerQuery;let g=0;for(const x of o)g+=h.getQueryObjectEXT(x,h.QUERY_RESULT_EXT)/1e6,h.deleteQueryEXT(x);return g}translatePosMatrix(o,h,g,x,b){if(!g[0]&&!g[1])return o;const S=b?x==="map"?this.transform.angle:0:x==="viewport"?-this.transform.angle:0;if(S){const k=Math.sin(S),R=Math.cos(S);g=[g[0]*R-g[1]*k,g[0]*k+g[1]*R]}const A=[b?g[0]:fn(h,g[0],this.transform.zoom),b?g[1]:fn(h,g[1],this.transform.zoom),0],I=new Float32Array(16);return a.translate(I,o,A),I}saveTileTexture(o){const h=this._tileTextures[o.size[0]];h?h.push(o):this._tileTextures[o.size[0]]=[o]}getTileTexture(o){const h=this._tileTextures[o];return h&&h.length>0?h.pop():null}isPatternMissing(o){if(!o)return!1;if(!o.from||!o.to)return!0;const h=this.imageManager.getPattern(o.from.toString()),g=this.imageManager.getPattern(o.to.toString());return!h||!g}currentGlobalDefines(){const o=this.terrain&&this.terrain.renderingToTexture,h=this.style&&this.style.fog,g=[];return this.terrain&&!this.terrain.renderingToTexture&&g.push("TERRAIN"),h&&!o&&h.getOpacity(this.transform.pitch)!==0&&g.push("FOG"),o&&g.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&g.push("OVERDRAW_INSPECTOR"),g}useProgram(o,h,g){this.cache=this.cache||{};const x=g||[],b=this.currentGlobalDefines().concat(x),S=tu.cacheKey(El[o],o,b,h);return this.cache[S]||(this.cache[S]=new tu(this.context,o,El[o],h,Ip[o],b)),this.cache[S]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const o=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(o.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=a.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new a.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(o,h,g){if(this.terrain&&this.terrain.renderingToTexture)return;const x=this.style.fog;if(x){const b=x.getOpacity(this.transform.pitch),S=((A,I,k,R,U,Z,J,H,Y,K,X)=>{const ne=A.transform,ee=I.properties.get("color").toArray01();ee[3]=R;const ve=A.frameCounter/1e3%1;return{u_fog_matrix:k?ne.calculateFogTileMatrix(k):A.identityMat,u_fog_range:I.getFovAdjustedRange(ne._fov),u_fog_color:ee,u_fog_horizon_blend:I.properties.get("horizon-blend"),u_fog_temporal_offset:ve,u_frustum_tl:U,u_frustum_tr:Z,u_frustum_br:J,u_frustum_bl:H,u_globe_pos:Y,u_globe_radius:K,u_viewport:X,u_globe_transition:a.globeToMercatorTransition(ne.zoom),u_is_globe:+(ne.projection.name==="globe")}})(this,x,g,b,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*a.exported.devicePixelRatio,this.transform.height*a.exported.devicePixelRatio]);h.setFogUniformValues(o,S)}}setTileLoadedFlag(o){this.tileLoaded=o}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const o=this.context.gl,h=o.createTexture();return o.bindTexture(o.TEXTURE_2D,h),o.copyTexImage2D(o.TEXTURE_2D,0,o.RGBA,0,0,o.drawingBufferWidth,o.drawingBufferHeight,0),h}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const o=this.style&&this.style.fog;return!!o&&o.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const o=this._backgroundTiles,h=this._backgroundTiles={},g=this.transform.coveringTiles({tileSize:512});for(const x of g)h[x.key]=o[x.key]||new a.Tile(x,512,this.transform.tileZoom,this);return h}clearBackgroundTiles(){this._backgroundTiles={}}}class La{constructor(o=0,h=0,g=0,x=0){if(isNaN(o)||o<0||isNaN(h)||h<0||isNaN(g)||g<0||isNaN(x)||x<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=o,this.bottom=h,this.left=g,this.right=x}interpolate(o,h,g){return h.top!=null&&o.top!=null&&(this.top=a.number(o.top,h.top,g)),h.bottom!=null&&o.bottom!=null&&(this.bottom=a.number(o.bottom,h.bottom,g)),h.left!=null&&o.left!=null&&(this.left=a.number(o.left,h.left,g)),h.right!=null&&o.right!=null&&(this.right=a.number(o.right,h.right,g)),this}getCenter(o,h){const g=a.clamp((this.left+o-this.right)/2,0,o),x=a.clamp((this.top+h-this.bottom)/2,0,h);return new a.pointGeometry(g,x)}equals(o){return this.top===o.top&&this.bottom===o.bottom&&this.left===o.left&&this.right===o.right}clone(){return new La(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function gu(d,o){const h=a.getColumn(d,3);a.fromQuat(d,o),a.setColumn(d,3,h)}function No(d,o){const h=a.identity$1([]);return a.rotateZ$1(h,h,-o),a.rotateX$1(h,h,-d),h}function Uo(d,o){const h=[d[0],d[1],0],g=[o[0],o[1],0];if(a.length(h)>=1e-15){const S=a.normalize([],h);a.scale$2(g,S,a.dot(g,S)),o[0]=g[0],o[1]=g[1]}const x=a.cross([],o,d);if(a.len(x)<1e-15)return null;const b=Math.atan2(-x[1],x[0]);return No(Math.atan2(Math.sqrt(d[0]*d[0]+d[1]*d[1]),-d[2]),b)}class ht{constructor(o,h){this.position=o,this.orientation=h}get position(){return this._position}set position(o){if(o){const h=o instanceof a.MercatorCoordinate?o:new a.MercatorCoordinate(o[0],o[1],o[2]);this._renderWorldCopies&&(h.x=a.wrap(h.x,0,1)),this._position=h}else this._position=null}lookAtPoint(o,h){if(this.orientation=null,!this.position)return;const g=this._elevation?this._elevation.getAtPointOrZero(a.MercatorCoordinate.fromLngLat(o)):0,x=this.position,b=a.MercatorCoordinate.fromLngLat(o,g),S=[b.x-x.x,b.y-x.y,b.z-x.z];h||(h=[0,0,1]),h[2]=Math.abs(h[2]),this.orientation=Uo(S,h)}setPitchBearing(o,h){this.orientation=No(a.degToRad(o),a.degToRad(-h))}}class Hr{constructor(o,h){this._transform=a.identity([]),this.orientation=h,this.position=o}get mercatorPosition(){const o=this.position;return new a.MercatorCoordinate(o[0],o[1],o[2])}get position(){const o=a.getColumn(this._transform,3);return[o[0],o[1],o[2]]}set position(o){var h;o&&a.setColumn(this._transform,3,[(h=o)[0],h[1],h[2],1])}get orientation(){return this._orientation}set orientation(o){this._orientation=o||a.identity$1([]),o&&gu(this._transform,this._orientation)}getPitchBearing(){const o=this.forward(),h=this.right();return{bearing:Math.atan2(-h[1],h[0]),pitch:Math.atan2(Math.sqrt(o[0]*o[0]+o[1]*o[1]),-o[2])}}setPitchBearing(o,h){this._orientation=No(o,h),gu(this._transform,this._orientation)}forward(){const o=a.getColumn(this._transform,2);return[-o[0],-o[1],-o[2]]}up(){const o=a.getColumn(this._transform,1);return[-o[0],-o[1],-o[2]]}right(){const o=a.getColumn(this._transform,0);return[o[0],o[1],o[2]]}getCameraToWorld(o,h){const g=new Float64Array(16);return a.invert(g,this.getWorldToCamera(o,h)),g}getWorldToCameraPosition(o,h,g){const x=this.position;a.scale$2(x,x,-o);const b=new Float64Array(16);return a.fromScaling(b,[g,g,g]),a.translate(b,b,x),b[10]*=h,b}getWorldToCamera(o,h){const g=new Float64Array(16),x=new Float64Array(4),b=this.position;return a.conjugate(x,this._orientation),a.scale$2(b,b,-o),a.fromQuat(g,x),a.translate(g,g,b),g[1]*=-1,g[5]*=-1,g[9]*=-1,g[13]*=-1,g[8]*=h,g[9]*=h,g[10]*=h,g[11]*=h,g}getCameraToClipPerspective(o,h,g,x){const b=new Float64Array(16);return a.perspective(b,o,h,g,x),b}getDistanceToElevation(o){const h=o===0?0:a.mercatorZfromAltitude(o,this.position[1]),g=this.forward();return(h-this.position[2])/g[2]}clone(){return new Hr([...this.position],[...this.orientation])}}function _u(d,o){const h=ka(d.projection,d.zoom,d.width,d.height),g=function(b,S,A,I,k){const R=new a.LngLat(A.lng-180*xn,A.lat),U=new a.LngLat(A.lng+180*xn,A.lat),Z=b.project(R.lng,R.lat),J=b.project(U.lng,U.lat),H=-Math.atan2(J.y-Z.y,J.x-Z.x),Y=a.MercatorCoordinate.fromLngLat(A);Y.y=a.clamp(Y.y,-.999975,.999975);const K=Y.toLngLat(),X=b.project(K.lng,K.lat),ne=a.MercatorCoordinate.fromLngLat(K);ne.x+=xn;const ee=ne.toLngLat(),ve=b.project(ee.lng,ee.lat),ge=Ra(ve.x-X.x,ve.y-X.y,H),ue=a.MercatorCoordinate.fromLngLat(K);ue.y+=xn;const _e=ue.toLngLat(),pe=b.project(_e.lng,_e.lat),we=Ra(pe.x-X.x,pe.y-X.y,H),Ie=Math.abs(ge.x)/Math.abs(we.y),Je=a.identity([]);a.rotateZ(Je,Je,-H*(1-(k?0:I)));const Ae=a.identity([]);return a.scale(Ae,Ae,[1,1-(1-Ie)*I,1]),Ae[4]=-we.x/we.y*I,a.rotateZ(Ae,Ae,H),a.multiply(Ae,Je,Ae),Ae}(d.projection,0,d.center,h,o),x=yu(d);return a.scale(g,g,[x,x,1]),g}function yu(d){const o=d.projection,h=ka(d.projection,d.zoom,d.width,d.height),g=vu(o,d.center),x=vu(o,a.LngLat.convert(o.center));return Math.pow(2,g*h+(1-h)*x)}function ka(d,o,h,g,x=1/0){const b=d.range;if(!b)return 0;const S=Math.min(x,Math.max(h,g)),A=Math.log(S/1024)/Math.LN2;return a.smoothstep(b[0]+A,b[1]+A,o)}const xn=1/4e4;function vu(d,o){const h=a.clamp(o.lat,-a.MAX_MERCATOR_LATITUDE,a.MAX_MERCATOR_LATITUDE),g=new a.LngLat(o.lng-180*xn,h),x=new a.LngLat(o.lng+180*xn,h),b=d.project(g.lng,h),S=d.project(x.lng,h),A=a.MercatorCoordinate.fromLngLat(g),I=a.MercatorCoordinate.fromLngLat(x),k=S.x-b.x,R=S.y-b.y,U=I.x-A.x,Z=I.y-A.y,J=Math.sqrt((U*U+Z*Z)/(k*k+R*R));return Math.log(J)/Math.LN2}function Ra(d,o,h){const g=Math.cos(h),x=Math.sin(h);return{x:d*g-o*x,y:d*x+o*g}}class Oa{constructor(o,h,g,x,b,S,A){this.tileSize=512,this._renderWorldCopies=b===void 0||b,this._minZoom=o||0,this._maxZoom=h||22,this._minPitch=g??0,this._maxPitch=x??60,this.setProjection(S),this.setMaxBounds(A),this.width=0,this.height=0,this._center=new a.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new La,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new Hr,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const o=new Oa(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return o._elevation=this._elevation,o._centerAltitude=this._centerAltitude,o._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,o.tileSize=this.tileSize,o.width=this.width,o.height=this.height,o.cameraElevationReference=this.cameraElevationReference,o._center=this._center,o._setZoom(this.zoom),o._seaLevelZoom=this._seaLevelZoom,o.angle=this.angle,o._fov=this._fov,o._pitch=this._pitch,o._nearZ=this._nearZ,o._farZ=this._farZ,o._averageElevation=this._averageElevation,o._unmodified=this._unmodified,o._edgeInsets=this._edgeInsets.clone(),o._camera=this._camera.clone(),o._calcMatrices(),o.freezeTileCoverage=this.freezeTileCoverage,o.frustumCorners=this.frustumCorners,o}get elevation(){return this._elevation}set elevation(o){this._elevation!==o&&(this._elevation=o,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(o){const h=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||h)&&this._updateCameraOnTerrain(),(o||h)&&this._constrainCameraAltitude(),this._calcMatrices()}getProjection(){return a.pick(this.projection,["name","center","parallels"])}setProjection(o){this.projectionOptions=o||{name:"mercator"};const h=this.projection?this.getProjection():void 0;this.projection=a.getProjection(this.projectionOptions);const g=!P(h,this.getProjection());return g&&this._calcMatrices(),this.mercatorFromTransition=!1,g}setMercatorFromTransition(){const o=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=a.getProjection({name:"mercator"});const h=o!==this.projection.name;return h&&this._calcMatrices(),h}get minZoom(){return this._minZoom}set minZoom(o){this._minZoom!==o&&(this._minZoom=o,this.zoom=Math.max(this.zoom,o))}get maxZoom(){return this._maxZoom}set maxZoom(o){this._maxZoom!==o&&(this._maxZoom=o,this.zoom=Math.min(this.zoom,o))}get minPitch(){return this._minPitch}set minPitch(o){this._minPitch!==o&&(this._minPitch=o,this.pitch=Math.max(this.pitch,o))}get maxPitch(){return this._maxPitch}set maxPitch(o){this._maxPitch!==o&&(this._maxPitch=o,this.pitch=Math.min(this.pitch,o))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(o){o===void 0?o=!0:o===null&&(o=!1),this._renderWorldCopies=o}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const o=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(o))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return a.mercatorZfromAltitude(this.center.lat,this.cameraWorldSize)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new a.pointGeometry(this.width,this.height)}get bearing(){return a.wrap(this.rotation,-180,180)}set bearing(o){this.rotation=o}get rotation(){return-this.angle/Math.PI*180}set rotation(o){const h=-o*Math.PI/180;var g;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=(g=new a.ARRAY_TYPE(4),a.ARRAY_TYPE!=Float32Array&&(g[1]=0,g[2]=0),g[0]=1,g[3]=1,g),function(x,b,S){var A=b[0],I=b[1],k=b[2],R=b[3],U=Math.sin(S),Z=Math.cos(S);x[0]=A*Z+k*U,x[1]=I*Z+R*U,x[2]=A*-U+k*Z,x[3]=I*-U+R*Z}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(o){const h=a.clamp(o,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(o){o=Math.max(.01,Math.min(60,o)),this._fov!==o&&(this._unmodified=!1,this._fov=o/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(o){this._averageElevation=o,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(o){const h=Math.min(Math.max(o,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._setZoom(h),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(o){this._zoom=o,this.scale=this.zoomScale(o),this.tileZoom=Math.floor(o),this.zoomFraction=o-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const o=this._elevation;this._centerAltitude=o.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=o.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const o=this._elevation,h=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],g=this.horizonLineFromTop();let x=0,b=0;for(let S=0;S<h.length;S++){const A=new a.pointGeometry(h[S][0]*this.width,g+h[S][1]*(this.height-g)),I=o.pointCoordinate(A);if(!I)continue;const k=1/Math.hypot(I[0]-this._camera.position[0],I[1]-this._camera.position[1]);x+=I[3]*k,b+=k}return b===0?NaN:x/b}get center(){return this._center}set center(o){o.lat===this._center.lat&&o.lng===this._center.lng||(this._unmodified=!1,this._center=o,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const o=this._seaLevelZoom,h=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),g=this.pixelsPerMeter/this.worldSize*h,x=this._mercatorZfromZoom(o),b=this._mercatorZfromZoom(this._maxZoom),S=Math.max(x-g,b);this._setZoom(this._zoomFromMercatorZ(S))}get padding(){return this._edgeInsets.toJSON()}set padding(o){this._edgeInsets.equals(o)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,o,1),this._calcMatrices())}computeZoomRelativeTo(o){const h=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,o.toAltitude()));let g;g=o.z<this._camera.position[2]?[h.x,h.y,h.z]:[o.x,o.y,o.z];const x=a.length(a.sub([],this._camera.position,g));return a.clamp(this._zoomFromMercatorZ(x),this._minZoom,this._maxZoom)}setFreeCameraOptions(o){if(!this.height||!o.position&&!o.orientation)return;this._updateCameraState();let h=!1;if(o.orientation&&!a.exactEquals(o.orientation,this._camera.orientation)&&(h=this._setCameraOrientation(o.orientation)),o.position){const g=[o.position.x,o.position.y,o.position.z];a.exactEquals$1(g,this._camera.position)||(this._setCameraPosition(g),h=!0)}h&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const o=this._camera.position,h=new ht;return h.position=new a.MercatorCoordinate(o[0],o[1],o[2]),h.orientation=this._camera.orientation,h._elevation=this.elevation,h._renderWorldCopies=this.renderWorldCopies,h}_setCameraOrientation(o){if(!a.length$1(o))return!1;a.normalize$1(o,o);const h=a.transformQuat([],[0,0,-1],o),g=a.transformQuat([],[0,-1,0],o);if(g[2]<0)return!1;const x=Uo(h,g);return!!x&&(this._camera.orientation=x,!0)}_setCameraPosition(o){const h=this.zoomScale(this.minZoom)*this.tileSize,g=this.zoomScale(this.maxZoom)*this.tileSize,x=this.cameraToCenterDistance;o[2]=a.clamp(o[2],x/g,x/h),this._camera.position=o}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(o){return this._edgeInsets.equals(o)}interpolatePadding(o,h,g){this._unmodified=!1,this._edgeInsets.interpolate(o,h,g),this._constrain(),this._calcMatrices()}coveringZoomLevel(o){const h=(o.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/o.tileSize));return Math.max(0,h)}getVisibleUnwrappedCoordinates(o){const h=[new a.UnwrappedTileID(0,o)];if(this.renderWorldCopies){const g=this.pointCoordinate(new a.pointGeometry(0,0)),x=this.pointCoordinate(new a.pointGeometry(this.width,0)),b=this.pointCoordinate(new a.pointGeometry(this.width,this.height)),S=this.pointCoordinate(new a.pointGeometry(0,this.height)),A=Math.floor(Math.min(g.x,x.x,b.x,S.x)),I=Math.floor(Math.max(g.x,x.x,b.x,S.x)),k=1;for(let R=A-k;R<=I+k;R++)R!==0&&h.push(new a.UnwrappedTileID(R,o))}return h}coveringTiles(o){let h=this.coveringZoomLevel(o);const g=h,x=this.elevation&&!o.isTerrainDEM,b=this.projection.name==="mercator";if(o.minzoom!==void 0&&h<o.minzoom)return[];o.maxzoom!==void 0&&h>o.maxzoom&&(h=o.maxzoom);const S=this.locationCoordinate(this.center),A=this.center.lat,I=1<<h,k=[I*S.x,I*S.y,0],R=this.projection.name==="globe",U=!R,Z=a.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,h,U),J=R?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),H=I*a.mercatorZfromAltitude(1,this.center.lat),Y=this._camera.position[2]/a.mercatorZfromAltitude(1,this.center.lat),K=[I*J.x,I*J.y,Y*(U?1:H)],X=this.cameraToCenterDistance/o.tileSize*(o.roundZoom?1:.502),ne=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?h:0,ee=o.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,ve=o.isTerrainDEM?-ee:this._elevation?this._elevation.getMinElevationBelowMSL():0,ge=this.projection.isReprojectedInTileSpace?yu(this):1,ue=Be=>{const We=new a.MercatorCoordinate(Be.x+25e-6,Be.y,Be.z),at=new a.MercatorCoordinate(Be.x,Be.y+25e-6,Be.z),st=Be.toLngLat(),yt=We.toLngLat(),At=at.toLngLat(),kt=this.locationCoordinate(st),Wt=this.locationCoordinate(yt),vt=this.locationCoordinate(At),Ft=Math.hypot(Wt.x-kt.x,Wt.y-kt.y),ei=Math.hypot(vt.x-kt.x,vt.y-kt.y);return Math.sqrt(Ft*ei)*ge/25e-6},_e=Be=>{const et=ee,We=ve;return{aabb:a.tileAABB(this,I,0,0,0,Be,We,et,this.projection),zoom:0,x:0,y:0,minZ:We,maxZ:et,wrap:Be,fullyVisible:!1}},pe=[];let we=[];const Ie=h,Je=o.reparseOverscaled?g:h,Ae=Be=>Be*Be,Ue=Ae((Y-this._centerAltitude)*H),qe=Be=>{if(!this._elevation||!Be.tileID||!b)return;const et=this._elevation.getMinMaxForTile(Be.tileID),We=Be.aabb;et?(We.min[2]=et.min,We.max[2]=et.max,We.center[2]=(We.min[2]+We.max[2])/2):(Be.shouldSplit=rt(Be),Be.shouldSplit||(We.min[2]=We.max[2]=We.center[2]=this._centerAltitude))},rt=Be=>{if(Be.zoom<ne)return!0;if(Be.zoom===Ie)return!1;if(Be.shouldSplit!=null)return Be.shouldSplit;const et=Be.aabb.distanceX(K),We=Be.aabb.distanceY(K);let at=Ue,st=1;if(R){at=Ae(Be.aabb.distanceZ(K));const At=Math.pow(2,Be.zoom),kt=a.latFromMercatorY((Be.y+1)/At),Wt=a.latFromMercatorY(Be.y/At),vt=Math.min(Math.max(A,kt),Wt),Ft=a.circumferenceAtLatitude(vt)/a.circumferenceAtLatitude(A);if(st=vt===A?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Ft/this._mercatorScaleRatio),this.zoom<=a.GLOBE_ZOOM_THRESHOLD_MIN&&Be.zoom===Ie-1&&Ft>=.9)return!0}else if(x&&(at=Ae(Be.aabb.distanceZ(K)*H)),this.projection.isReprojectedInTileSpace&&g<=5){const At=Math.pow(2,Be.zoom),kt=ue(new a.MercatorCoordinate((Be.x+.5)/At,(Be.y+.5)/At));st=kt>.85?1:kt}const yt=et*et+We*We+at;return yt<Ae((1<<Ie-Be.zoom)*X*st*((At,kt)=>{if(kt*Ae(.707)<At)return 1;const Wt=Math.sqrt(kt/At);return Wt/(1.4144271570014144+(Math.pow(1.1,Wt-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(at,Ue),yt))};if(this.renderWorldCopies)for(let Be=1;Be<=3;Be++)pe.push(_e(-Be)),pe.push(_e(Be));for(pe.push(_e(0));pe.length>0;){const Be=pe.pop(),et=Be.x,We=Be.y;let at=Be.fullyVisible;if(!at){const st=Be.aabb.intersects(Z);if(st===0)continue;at=st===2}if(Be.zoom!==Ie&&rt(Be))for(let st=0;st<4;st++){const yt=(et<<1)+st%2,At=(We<<1)+(st>>1),kt={aabb:b?Be.aabb.quadrant(st):a.tileAABB(this,I,Be.zoom+1,yt,At,Be.wrap,Be.minZ,Be.maxZ,this.projection),zoom:Be.zoom+1,x:yt,y:At,wrap:Be.wrap,fullyVisible:at,tileID:void 0,shouldSplit:void 0,minZ:Be.minZ,maxZ:Be.maxZ};x&&!R&&(kt.tileID=new a.OverscaledTileID(Be.zoom+1===Ie?Je:Be.zoom+1,Be.wrap,Be.zoom+1,yt,At),qe(kt)),pe.push(kt)}else{const st=Be.zoom===Ie?Je:Be.zoom;if(o.minzoom&&o.minzoom>st)continue;const yt=k[0]-(.5+et+(Be.wrap<<Be.zoom))*(1<<h-Be.zoom),At=k[1]-.5-We,kt=Be.tileID?Be.tileID:new a.OverscaledTileID(st,Be.wrap,Be.zoom,et,We);we.push({tileID:kt,distanceSq:yt*yt+At*At})}}if(this.fogCullDistSq){const Be=this.fogCullDistSq,et=this.horizonLineFromTop();we=we.filter(We=>{const at=[0,0,0,1],st=[a.EXTENT,a.EXTENT,0,1],yt=this.calculateFogTileMatrix(We.tileID.toUnwrapped());a.transformMat4$1(at,at,yt),a.transformMat4$1(st,st,yt);const At=a.getAABBPointSquareDist(at,st);if(At===0)return!0;let kt=!1;const Wt=this._elevation;if(Wt&&At>Be&&et!==0){const vt=this.calculateProjMatrix(We.tileID.toUnwrapped());let Ft;o.isTerrainDEM||(Ft=Wt.getMinMaxForTile(We.tileID)),Ft||(Ft={min:ve,max:ee});const ei=a.furthestTileCorner(this.rotation),xi=[ei[0]*a.EXTENT,ei[1]*a.EXTENT,Ft.max];a.transformMat4(xi,xi,vt),kt=(1-xi[1])*this.height*.5<et}return At<Be||kt})}return we.sort((Be,et)=>Be.distanceSq-et.distanceSq).map(Be=>Be.tileID)}resize(o,h){this.width=o,this.height=h,this.pixelsToGLUnits=[2/o,-2/h],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(o){return Math.pow(2,o)}scaleZoom(o){return Math.log(o)/Math.LN2}project(o){const h=a.clamp(o.lat,-a.MAX_MERCATOR_LATITUDE,a.MAX_MERCATOR_LATITUDE),g=this.projection.project(o.lng,h);return new a.pointGeometry(g.x*this.worldSize,g.y*this.worldSize)}unproject(o){return this.projection.unproject(o.x/this.worldSize,o.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(o,h){let g,x;const b=this.centerPoint;if(this.projection.name==="globe"){const A=this.worldSize;g=(h.x-b.x)/A,x=(h.y-b.y)/A}else{const A=this.pointCoordinate(h),I=this.pointCoordinate(b);g=A.x-I.x,x=A.y-I.y}const S=this.locationCoordinate(o);this.setLocation(new a.MercatorCoordinate(S.x-g,S.y-x))}setLocation(o){this.center=this.coordinateLocation(o),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(o){return this.projection.locationPoint(this,o)}locationPoint3D(o){return this.projection.locationPoint(this,o,!0)}pointLocation(o){return this.coordinateLocation(this.pointCoordinate(o))}pointLocation3D(o){return this.coordinateLocation(this.pointCoordinate3D(o))}locationCoordinate(o,h){const g=h?a.mercatorZfromAltitude(h,o.lat):void 0,x=this.projection.project(o.lng,o.lat);return new a.MercatorCoordinate(x.x,x.y,g)}coordinateLocation(o){return this.projection.unproject(o.x,o.y)}pointRayIntersection(o,h){const g=h??this._centerAltitude,x=[o.x,o.y,0,1],b=[o.x,o.y,1,1];a.transformMat4$1(x,x,this.pixelMatrixInverse),a.transformMat4$1(b,b,this.pixelMatrixInverse);const S=b[3];a.scale$1(x,x,1/x[3]),a.scale$1(b,b,1/S);const A=x[2],I=b[2];return{p0:x,p1:b,t:A===I?0:(g-A)/(I-A)}}screenPointToMercatorRay(o){const h=[o.x,o.y,0,1],g=[o.x,o.y,1,1];return a.transformMat4$1(h,h,this.pixelMatrixInverse),a.transformMat4$1(g,g,this.pixelMatrixInverse),a.scale$1(h,h,1/h[3]),a.scale$1(g,g,1/g[3]),h[2]=a.mercatorZfromAltitude(h[2],this._center.lat)*this.worldSize,g[2]=a.mercatorZfromAltitude(g[2],this._center.lat)*this.worldSize,a.scale$1(h,h,1/this.worldSize),a.scale$1(g,g,1/this.worldSize),new a.Ray([h[0],h[1],h[2]],a.normalize([],a.sub([],g,h)))}rayIntersectionCoordinate(o){const{p0:h,p1:g,t:x}=o,b=a.mercatorZfromAltitude(h[2],this._center.lat),S=a.mercatorZfromAltitude(g[2],this._center.lat);return new a.MercatorCoordinate(a.number(h[0],g[0],x)/this.worldSize,a.number(h[1],g[1],x)/this.worldSize,a.number(b,S,x))}pointCoordinate(o,h=this._centerAltitude){return this.projection.pointCoordinate(this,o.x,o.y,h)}pointCoordinate3D(o){if(!this.elevation)return this.pointCoordinate(o);let h=this.projection.pointCoordinate3D(this,o.x,o.y);if(h)return new a.MercatorCoordinate(h[0],h[1],h[2]);let g=0,x=this.horizonLineFromTop();if(o.y>x)return this.pointCoordinate(o);const b=.02*x,S=o.clone();for(let A=0;A<10&&x-g>b;A++){S.y=a.number(g,x,.66);const I=this.projection.pointCoordinate3D(this,S.x,S.y);I?(x=S.y,h=I):g=S.y}return h?new a.MercatorCoordinate(h[0],h[1],h[2]):this.pointCoordinate(o)}isPointAboveHorizon(o){return this.projection.isPointAboveHorizon(this,o)}_coordinatePoint(o,h){const g=h&&this.elevation?this.elevation.getAtPointOrZero(o,this._centerAltitude):this._centerAltitude,x=[o.x*this.worldSize,o.y*this.worldSize,g+o.toAltitude(),1];return a.transformMat4$1(x,x,this.pixelMatrix),x[3]>0?new a.pointGeometry(x[0]/x[3],x[1]/x[3]):new a.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBounds(o,h){const g=new a.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),x=new a.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),b=new a.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),S=new a.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let A=this.pointCoordinate(g,o),I=this.pointCoordinate(x,o);const k=this.pointCoordinate(b,h),R=this.pointCoordinate(S,h),U=(Z,J)=>(J.y-Z.y)/(J.x-Z.x);return A.y>1&&I.y>=0?A=new a.MercatorCoordinate((1-R.y)/U(R,A)+R.x,1):A.y<0&&I.y<=1&&(A=new a.MercatorCoordinate(-R.y/U(R,A)+R.x,0)),I.y>1&&A.y>=0?I=new a.MercatorCoordinate((1-k.y)/U(k,I)+k.x,1):I.y<0&&A.y<=1&&(I=new a.MercatorCoordinate(-k.y/U(k,I)+k.x,0)),new a.LngLatBounds().extend(this.coordinateLocation(A)).extend(this.coordinateLocation(I)).extend(this.coordinateLocation(R)).extend(this.coordinateLocation(k))}_getBounds3D(){const o=this.elevation;if(!o.visibleDemTiles.length)return this._getBounds(0,0);const h=o.visibleDemTiles.reduce((g,x)=>{if(x.dem){const b=x.dem.tree;g.min=Math.min(g.min,b.minimums[0]),g.max=Math.max(g.max,b.maximums[0])}return g},{min:Number.MAX_VALUE,max:0});return this._getBounds(h.min*o.exaggeration(),h.max*o.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(o=!0){const h=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,g=this.height/2-h*(1-this._horizonShift);return o?Math.max(0,g):g}getMaxBounds(){return this.maxBounds}setMaxBounds(o){this.maxBounds=o,this.minLat=-a.MAX_MERCATOR_LATITUDE,this.maxLat=a.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,o&&(this.minLat=o.getSouth(),this.maxLat=o.getNorth(),this.minLng=o.getWest(),this.maxLng=o.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=a.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=a.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=a.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=a.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(o,h){return this.projection.createTileMatrix(this,h,o)}calculateDistanceTileData(o){const h=o.key,g=this._distanceTileDataCache;if(g[h])return g[h];const x=o.canonical,b=1/this.height,S=this.cameraWorldSize/this.zoomScale(x.z),A=(x.x+Math.pow(2,x.z)*o.wrap)*S,I=x.y*S,k=this.point,R=this.angle,U=Math.sin(-R),Z=-Math.cos(-R);return g[h]={bearing:[U,Z],center:[(k.x-A)*b,(k.y-I)*b],scale:S/a.EXTENT*b},g[h]}calculateFogTileMatrix(o){const h=o.key,g=this._fogTileMatrixCache;if(g[h])return g[h];const x=this.projection.createTileMatrix(this,this.cameraWorldSize,o);return a.multiply(x,this.worldToFogMatrix,x),g[h]=new Float32Array(x),g[h]}calculateProjMatrix(o,h=!1){const g=o.key,x=h?this._alignedProjMatrixCache:this._projMatrixCache;if(x[g])return x[g];const b=this.calculatePosMatrix(o,this.worldSize);return a.multiply(b,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:h?this.alignedProjMatrix:this.projMatrix,b),x[g]=new Float32Array(b),x[g]}calculatePixelsToTileUnitsMatrix(o){const h=o.tileID.key,g=this._pixelsToTileUnitsCache;if(g[h])return g[h];const x=function(b,S){const{scale:A}=b.tileTransform,I=A*a.EXTENT/(b.tileSize*Math.pow(2,S.zoom-b.tileID.overscaledZ+b.tileID.canonical.z));return k=new Float32Array(4),Z=(R=S.inverseAdjustmentMatrix)[1],J=R[2],H=R[3],K=(U=[I,I])[1],k[0]=R[0]*(Y=U[0]),k[1]=Z*Y,k[2]=J*K,k[3]=H*K,k;var k,R,U,Z,J,H,Y,K}(o,this);return g[h]=x,g[h]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const o=this._elevation;this._updateCameraState();const h=a.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,g=this._computeCameraPosition(h),x=this._camera.forward(),b=a.mercatorZfromAltitude(1,this._center.lat);g[2]/=b,x[2]/=b,a.normalize(x,x);const S=o.raycast(g,x,o.exaggeration());if(S){const A=a.scaleAndAdd([],g,x,S),I=new a.MercatorCoordinate(A[0],A[1],a.mercatorZfromAltitude(A[2],a.latFromMercatorY(A[1]))),k=(I.z+a.length([I.x-g[0],I.y-g[1],I.z-g[2]*b]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(k),this._centerAltitude=I.toAltitude(),this._center=this.coordinateLocation(I),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const o=this._elevation;this._updateCameraState();const h=a.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,g=this._computeCameraPosition(h),x=o.getAtPointOrZero(new a.MercatorCoordinate(...g)),b=this._minimumHeightOverTerrain()*Math.cos(a.degToRad(this._maxPitch)),S=this._camera.position[2]-this.pixelsPerMeter/this.worldSize*x;if(S<b){const A=this.locationCoordinate(this._center,this._centerAltitude),I=[A.x-g[0],A.y-g[1],A.z-g[2]],k=a.length(I);I[2]-=(b-S)/this._pixelsPerMercatorPixel;const R=a.length(I);if(R===0)return;a.scale$2(I,I,k/R*this._pixelsPerMercatorPixel),this._camera.position=[A.x-I[0],A.y-I[1],A.z*this._pixelsPerMercatorPixel-I[2]],this._camera.orientation=Uo(I,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const o=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||o){const Z=this.center;return Z.lat=a.clamp(Z.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!o)&&(Z.lng=a.clamp(Z.lng,this.minLng,this.maxLng)),this.center=Z,void(this._constraining=!1)}const h=this._unmodified,{x:g,y:x}=this.point;let b=0,S=g,A=x;const I=this.width/2,k=this.height/2,R=this.worldMinY*this.scale,U=this.worldMaxY*this.scale;if(x-k<R&&(A=R+k),x+k>U&&(A=U-k),U-R<this.height&&(b=Math.max(b,this.height/(U-R)),A=(U+R)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const Z=this.worldMinX*this.scale,J=this.worldMaxX*this.scale,H=this.worldSize/2-(Z+J)/2;S=(g+H+this.worldSize)%this.worldSize-H,S-I<Z&&(S=Z+I),S+I>J&&(S=J-I),J-Z<this.width&&(b=Math.max(b,this.width/(J-Z)),S=(J+Z)/2)}S===g&&A===x||(this.center=this.unproject(new a.pointGeometry(S,A))),b&&(this.zoom+=this.scaleZoom(b)),this._constrainCameraAltitude(),this._unmodified=h,this._constraining=!1}_minZoomForBounds(){let o=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(o=Math.max(o,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),o}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const o=this.centerOffset,h=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=a.mercatorZfromAltitude(1,this.center.lat)/a.mercatorZfromAltitude(1,a.GLOBE_SCALE_MATCH_LATITUDE));const g=ka(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,g),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const x=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?h:1),b=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);b[8]=2*-o.x/this.width,b[9]=2*o.y/this.height;let S=a.mul([],b,x);if(this.projection.isReprojectedInTileSpace){const ge=this.locationCoordinate(this.center),ue=a.identity([]);a.translate(ue,ue,[ge.x*this.worldSize,ge.y*this.worldSize,0]),a.multiply(ue,ue,_u(this)),a.translate(ue,ue,[-ge.x*this.worldSize,-ge.y*this.worldSize,0]),a.multiply(S,S,ue),this.inverseAdjustmentMatrix=function(_e){const pe=_u(_e,!0);return Mt([],[pe[0],pe[1],pe[4],pe[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=a.scale([],S,[this.worldSize,this.worldSize,this.worldSize/h,1]),this.projMatrix=S,this.invProjMatrix=a.invert(new Float64Array(16),this.projMatrix);const A=a.invert([],b);this.frustumCorners=a.FrustumCorners.fromInvProjectionMatrix(A,this.horizonLineFromTop(),this.height);const I=new Float32Array(16);a.identity(I),a.scale(I,I,[1,-1,1]),a.rotateX(I,I,this._pitch),a.rotateZ(I,I,this.angle);const k=a.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),R=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;k[8]=2*-o.x/this.width,k[9]=2*(o.y+R)/this.height,this.skyboxMatrix=a.multiply(I,k,I);const U=this.point,Z=U.x,J=U.y,H=this.width%2/2,Y=this.height%2/2,K=Math.cos(this.angle),X=Math.sin(this.angle),ne=Z-Math.round(Z)+K*H+X*Y,ee=J-Math.round(J)+K*Y+X*H,ve=new Float64Array(S);if(a.translate(ve,ve,[ne>.5?ne-1:ne,ee>.5?ee-1:ee,0]),this.alignedProjMatrix=ve,S=a.create(),a.scale(S,S,[this.width/2,-this.height/2,1]),a.translate(S,S,[1,-1,0]),this.labelPlaneMatrix=S,S=a.create(),a.scale(S,S,[1,-1,1]),a.translate(S,S,[-1,-1,0]),a.scale(S,S,[2/this.width,2/this.height,1]),this.glCoordMatrix=S,this.pixelMatrix=a.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},S=a.invert(new Float64Array(16),this.pixelMatrix),!S)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=S,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=a.calculateGlobeMatrix(this);const ge=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=a.transformMat4(ge,ge,x),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=S;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const o=this.cameraWorldSize,h=this.cameraPixelsPerMeter,g=this._camera.position,x=1/this.height/this._pixelsPerMercatorPixel,b=[o,o,h];a.scale$2(b,b,x),a.scale$2(g,g,-1),a.multiply$2(g,g,b);const S=a.create();a.translate(S,S,g),a.scale(S,S,b),this.mercatorFogMatrix=S,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(o,h,x)}_computeCameraPosition(o){const h=(o=o||this.pixelsPerMeter)/this.pixelsPerMeter,g=this._camera.forward(),x=this.point,b=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*h-o/this.worldSize*this._centerAltitude;return[x.x/this.worldSize-g[0]*b,x.y/this.worldSize-g[1]*b,o/this.worldSize*this._centerAltitude-g[2]*b]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(o){const h=this._maxCameraBoundsDistance()*Math.cos(this._pitch),g=o[2];let x=1;g>0&&(x=Math.min((h-this._camera.position[2])/g,1)),this._camera.position=a.scaleAndAdd([],this._camera.position,o,x),this._updateStateFromCamera(),this.projection.wrap&&(this.center=this.center.wrap())}_updateStateFromCamera(){const o=this._camera.position,h=this._camera.forward(),{pitch:g,bearing:x}=this._camera.getPitchBearing(),b=a.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,S=this._mercatorZfromZoom(this._maxZoom)*Math.cos(a.degToRad(this._maxPitch)),A=Math.max((o[2]-b)/Math.cos(g),S),I=this._zoomFromMercatorZ(A);a.scaleAndAdd(o,o,h,A),this._pitch=a.clamp(g,a.degToRad(this.minPitch),a.degToRad(this.maxPitch)),this.angle=a.wrap(x,-Math.PI,Math.PI),this._setZoom(a.clamp(I,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new a.MercatorCoordinate(o[0],o[1],o[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(o){return Math.pow(2,o)*this.tileSize}_mercatorZfromZoom(o){return this.cameraToCenterDistance/this._worldSizeFromZoom(o)}_minimumHeightOverTerrain(){const o=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(o)}_zoomFromMercatorZ(o){return this.scaleZoom(this.cameraToCenterDistance/(o*this.tileSize))}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(a.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(o,h){const g=Math.min(o.x,h.x),x=Math.max(o.x,h.x),b=Math.min(o.y,h.y),S=Math.max(o.y,h.y);if(b<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const A=[new a.pointGeometry(g,b),new a.pointGeometry(x,S),new a.pointGeometry(g,S),new a.pointGeometry(x,b)],I=this.renderWorldCopies?-3:0,k=this.renderWorldCopies?4:1;for(const R of A){const U=this.pointRayIntersection(R);if(U.t<0)return!0;const Z=this.rayIntersectionCoordinate(U);if(Z.x<I||Z.y<0||Z.x>k||Z.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+a.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new a.pointGeometry(0,0),new a.pointGeometry(this.width,this.height))}zoomDeltaToMovement(o,h){const g=a.length(a.sub([],this._camera.position,o)),x=this._zoomFromMercatorZ(g)+h;return g-this._mercatorZfromZoom(x)}getCameraPoint(){if(this.projection.name==="globe"){const o=function(h,g){const x=[h[0],h[1],h[2],1];a.transformMat4$1(x,x,g);const b=Math.max(x[3],1e-6);return[x[0]/b,x[1]/b,x[2]/b,b]}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new a.pointGeometry(o[0],o[1])}{const o=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.pointGeometry(0,o))}}getCameraToCenterDistance(o){const h=ka(o,this.zoom,this.width,this.height,1024),g=o.pixelSpaceConversion(this.center.lat,this.worldSize,h);return .5/Math.tan(.5*this._fov)*this.height*g}}function Da(d,o){let h=!1,g=null;const x=()=>{g=null,h&&(d(),g=setTimeout(x,o),h=!1)};return()=>(h=!0,g||x(),g)}class lf{constructor(o){this._hashName=o&&encodeURIComponent(o),a.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Da(this._updateHashUnthrottled.bind(this),300)}addTo(o){return this._map=o,a.window.addEventListener("hashchange",this._onHashChange,!1),o.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),a.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const o=this._map;if(!o)return"";const h=xu(o);if(this._hashName){const g=this._hashName;let x=!1;const b=a.window.location.hash.slice(1).split("&").map(S=>{const A=S.split("=")[0];return A===g?(x=!0,`${A}=${h}`):S}).filter(S=>S);return x||b.push(`${g}=${h}`),`#${b.join("&")}`}return`#${h}`}_getCurrentHash(){const o=a.window.location.hash.replace("#","");if(this._hashName){let h;return o.split("&").map(g=>g.split("=")).forEach(g=>{g[0]===this._hashName&&(h=g)}),(h&&h[1]||"").split("/")}return o.split("/")}_onHashChange(){const o=this._map;if(!o)return!1;const h=this._getCurrentHash();if(h.length>=3&&!h.some(g=>isNaN(g))){const g=o.dragRotate.isEnabled()&&o.touchZoomRotate.isEnabled()?+(h[3]||0):o.getBearing();return o.jumpTo({center:[+h[2],+h[1]],zoom:+h[0],bearing:g,pitch:+(h[4]||0)}),!0}return!1}_updateHashUnthrottled(){const o=a.window.location.href.replace(/(#.+)?$/,this.getHashString());a.window.history.replaceState(a.window.history.state,null,o)}}function xu(d,o){const h=d.getCenter(),g=Math.round(100*d.getZoom())/100,x=Math.ceil((g*Math.LN2+Math.log(512/360/.5))/Math.LN10),b=Math.pow(10,x),S=Math.round(h.lng*b)/b,A=Math.round(h.lat*b)/b,I=d.getBearing(),k=d.getPitch();let R=o?`/${S}/${A}/${g}`:`${g}/${A}/${S}`;return(I||k)&&(R+="/"+Math.round(10*I)/10),k&&(R+=`/${Math.round(k)}`),R}const Jn={linearity:.3,easing:a.bezier(0,0,.3,1)},Lp=a.extend({deceleration:2500,maxSpeed:1400},Jn),kp=a.extend({deceleration:20,maxSpeed:1400},Jn),cf=a.extend({deceleration:1e3,maxSpeed:360},Jn),zl=a.extend({deceleration:1e3,maxSpeed:90},Jn);class bu{constructor(o){this._map=o,this.clear()}clear(){this._inertiaBuffer=[]}record(o){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:a.exported.now(),settings:o})}_drainInertiaBuffer(){const o=this._inertiaBuffer,h=a.exported.now();for(;o.length>0&&h-o[0].time>160;)o.shift()}_onMoveEnd(o){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const h={zoom:0,bearing:0,pitch:0,pan:new a.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:b}of this._inertiaBuffer)h.zoom+=b.zoomDelta||0,h.bearing+=b.bearingDelta||0,h.pitch+=b.pitchDelta||0,b.panDelta&&h.pan._add(b.panDelta),b.around&&(h.around=b.around),b.pinchAround&&(h.pinchAround=b.pinchAround);const g=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,x={};if(h.pan.mag()){const b=Ba(h.pan.mag(),g,a.extend({},Lp,o||{}));x.offset=h.pan.mult(b.amount/h.pan.mag()),x.center=this._map.transform.center,za(x,b)}if(h.zoom){const b=Ba(h.zoom,g,kp);x.zoom=this._map.transform.zoom+b.amount,za(x,b)}if(h.bearing){const b=Ba(h.bearing,g,cf);x.bearing=this._map.transform.bearing+a.clamp(b.amount,-179,179),za(x,b)}if(h.pitch){const b=Ba(h.pitch,g,zl);x.pitch=this._map.transform.pitch+b.amount,za(x,b)}if(x.zoom||x.bearing){const b=h.pinchAround===void 0?h.around:h.pinchAround;x.around=b?this._map.unproject(b):this._map.getCenter()}return this.clear(),x.noMoveStart=!0,x}}function za(d,o){(!d.duration||d.duration<o.duration)&&(d.duration=o.duration,d.easing=o.easing)}function Ba(d,o,h){const{maxSpeed:g,linearity:x,deceleration:b}=h,S=a.clamp(d*x/(o/1e3),-g,g),A=Math.abs(S)/(b*x);return{easing:h.easing,duration:1e3*A,amount:S*(A/2)}}class gr extends a.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,h,g,x={}){const b=Re(h.getCanvasContainer(),g),S=h.unproject(b);super(o,a.extend({point:b,lngLat:S,originalEvent:g},x)),this._defaultPrevented=!1,this.target=h}}class jo extends a.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,h,g){const x=o==="touchend"?g.changedTouches:g.touches,b=ot(h.getCanvasContainer(),x),S=b.map(I=>h.unproject(I)),A=b.reduce((I,k,R,U)=>I.add(k.div(U.length)),new a.pointGeometry(0,0));super(o,{points:b,point:A,lngLats:S,lngLat:h.unproject(A),originalEvent:g}),this._defaultPrevented=!1}}class uf extends a.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,h,g){super(o,{originalEvent:g}),this._defaultPrevented=!1}}class hf{constructor(o,h){this._map=o,this._clickTolerance=h.clickTolerance}reset(){this._mousedownPos=void 0}wheel(o){return this._firePreventable(new uf(o.type,this._map,o))}mousedown(o,h){return this._mousedownPos=h,this._firePreventable(new gr(o.type,this._map,o))}mouseup(o){this._map.fire(new gr(o.type,this._map,o))}preclick(o){const h=a.extend({},o);h.type="preclick",this._map.fire(new gr(h.type,this._map,h))}click(o,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||(this.preclick(o),this._map.fire(new gr(o.type,this._map,o)))}dblclick(o){return this._firePreventable(new gr(o.type,this._map,o))}mouseover(o){this._map.fire(new gr(o.type,this._map,o))}mouseout(o){this._map.fire(new gr(o.type,this._map,o))}touchstart(o){return this._firePreventable(new jo(o.type,this._map,o))}touchmove(o){this._map.fire(new jo(o.type,this._map,o))}touchend(o){this._map.fire(new jo(o.type,this._map,o))}touchcancel(o){this._map.fire(new jo(o.type,this._map,o))}_firePreventable(o){if(this._map.fire(o),o.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ff{constructor(o){this._map=o}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(o){this._map.fire(new gr(o.type,this._map,o))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new gr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(o){this._delayContextMenu?this._contextMenuEvent=o:this._map.fire(new gr(o.type,this._map,o)),this._map.listens("contextmenu")&&o.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class df{constructor(o,h){this._map=o,this._el=o.getCanvasContainer(),this._container=o.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(o,h){this.isEnabled()&&o.shiftKey&&o.button===0&&(Ce(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(o,h){if(!this._active)return;const g=h;if(this._lastPos.equals(g)||!this._box&&g.dist(this._startPos)<this._clickTolerance)return;const x=this._startPos;this._lastPos=g,this._box||(this._box=W("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",o));const b=Math.min(x.x,g.x),S=Math.max(x.x,g.x),A=Math.min(x.y,g.y),I=Math.max(x.y,g.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${b}px,${A}px)`,this._box.style.width=S-b+"px",this._box.style.height=I-A+"px")})}mouseupWindow(o,h){if(!this._active||o.button!==0)return;const g=this._startPos,x=h;if(this.reset(),Ve(),g.x!==x.x||g.y!==x.y)return this._map.fire(new a.Event("boxzoomend",{originalEvent:o})),{cameraAnimation:b=>b.fitScreenCoordinates(g,x,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",o)}keydown(o){this._active&&o.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",o))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),ke(),delete this._startPos,delete this._lastPos}_fireEvent(o,h){return this._map.fire(new a.Event(o,{originalEvent:h}))}}function Bl(d,o){const h={};for(let g=0;g<d.length;g++)h[d[g].identifier]=o[g];return h}class Vo{constructor(o){this.reset(),this.numTouches=o.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(o,h,g){(this.centroid||g.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=o.timeStamp),g.length===this.numTouches&&(this.centroid=function(x){const b=new a.pointGeometry(0,0);for(const S of x)b._add(S);return b.div(x.length)}(h),this.touches=Bl(g,h)))}touchmove(o,h,g){if(this.aborted||!this.centroid)return;const x=Bl(g,h);for(const b in this.touches){const S=this.touches[b],A=x[b];(!A||A.dist(S)>30)&&(this.aborted=!0)}}touchend(o,h,g){if((!this.centroid||o.timeStamp-this.startTime>500)&&(this.aborted=!0),g.length===0){const x=!this.aborted&&this.centroid;if(this.reset(),x)return x}}}class Fl{constructor(o){this.singleTap=new Vo(o),this.numTaps=o.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(o,h,g){this.singleTap.touchstart(o,h,g)}touchmove(o,h,g){this.singleTap.touchmove(o,h,g)}touchend(o,h,g){const x=this.singleTap.touchend(o,h,g);if(x){const b=o.timeStamp-this.lastTime<500,S=!this.lastTap||this.lastTap.dist(x)<30;if(b&&S||this.reset(),this.count++,this.lastTime=o.timeStamp,this.lastTap=x,this.count===this.numTaps)return this.reset(),x}}}class pf{constructor(){this._zoomIn=new Fl({numTouches:1,numTaps:2}),this._zoomOut=new Fl({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(o,h,g){this._zoomIn.touchstart(o,h,g),this._zoomOut.touchstart(o,h,g)}touchmove(o,h,g){this._zoomIn.touchmove(o,h,g),this._zoomOut.touchmove(o,h,g)}touchend(o,h,g){const x=this._zoomIn.touchend(o,h,g),b=this._zoomOut.touchend(o,h,g);return x?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:S.getZoom()+1,around:S.unproject(x)},{originalEvent:o})}):b?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:S.getZoom()-1,around:S.unproject(b)},{originalEvent:o})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const mf={0:1,2:2};class Nl{constructor(o){this.reset(),this._clickTolerance=o.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(o,h){return!1}_move(o,h){return{}}mousedown(o,h){if(this._lastPoint)return;const g=bt(o);this._correctButton(o,g)&&(this._lastPoint=h,this._eventButton=g)}mousemoveWindow(o,h){const g=this._lastPoint;if(g){if(o.preventDefault(),this._eventButton!=null&&function(x,b){const S=mf[b];return x.buttons===void 0||(x.buttons&S)!==S}(o,this._eventButton))this.reset();else if(this._moved||!(h.dist(g)<this._clickTolerance))return this._moved=!0,this._lastPoint=h,this._move(g,h)}}mouseupWindow(o){this._lastPoint&&bt(o)===this._eventButton&&(this._moved&&Ve(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class gf extends Nl{mousedown(o,h){super.mousedown(o,h),this._lastPoint&&(this._active=!0)}_correctButton(o,h){return h===0&&!o.ctrlKey}_move(o,h){return{around:h,panDelta:h.sub(o)}}}class wu extends Nl{_correctButton(o,h){return h===0&&o.ctrlKey||h===2}_move(o,h){const g=.8*(h.x-o.x);if(g)return this._active=!0,{bearingDelta:g}}contextmenu(o){o.preventDefault()}}class ar extends Nl{_correctButton(o,h){return h===0&&o.ctrlKey||h===2}_move(o,h){const g=-.5*(h.y-o.y);if(g)return this._active=!0,{pitchDelta:g}}contextmenu(o){o.preventDefault()}}class Rp{constructor(o,h){this._map=o,this._el=o.getCanvasContainer(),this._minTouches=1,this._clickTolerance=h.clickTolerance||1,this.reset(),a.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new a.pointGeometry(0,0)}touchstart(o,h,g){return this._calculateTransform(o,h,g)}touchmove(o,h,g){if(this._active&&!(g.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(g.length===1&&!a.isFullscreen())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return o.cancelable&&o.preventDefault(),this._calculateTransform(o,h,g)}}touchend(o,h,g){this._calculateTransform(o,h,g),this._active&&g.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(o,h,g){g.length>0&&(this._active=!0);const x=Bl(g,h),b=new a.pointGeometry(0,0),S=new a.pointGeometry(0,0);let A=0;for(const k in x){const R=x[k],U=this._touches[k];U&&(b._add(R),S._add(R.sub(U)),A++,x[k]=R)}if(this._touches=x,A<this._minTouches||!S.mag())return;const I=S.div(A);return this._sum._add(I),this._sum.mag()<this._clickTolerance?void 0:{around:b.div(A),panDelta:I}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=W("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class Ul{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(o){}_move(o,h,g){return{}}touchstart(o,h,g){this._firstTwoTouches||g.length<2||(this._firstTwoTouches=[g[0].identifier,g[1].identifier],this._start([h[0],h[1]]))}touchmove(o,h,g){const x=this._firstTwoTouches;if(!x)return;o.preventDefault();const[b,S]=x,A=jl(g,h,b),I=jl(g,h,S);if(!A||!I)return;const k=this._aroundCenter?null:A.add(I).div(2);return this._move([A,I],k,o)}touchend(o,h,g){if(!this._firstTwoTouches)return;const[x,b]=this._firstTwoTouches,S=jl(g,h,x),A=jl(g,h,b);S&&A||(this._active&&Ve(),this.reset())}touchcancel(){this.reset()}enable(o){this._enabled=!0,this._aroundCenter=!!o&&o.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function jl(d,o,h){for(let g=0;g<d.length;g++)if(d[g].identifier===h)return o[g]}function _f(d,o){return Math.log(d/o)/Math.LN2}class Qn extends Ul{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(o){this._startDistance=this._distance=o[0].dist(o[1])}_move(o,h){const g=this._distance;if(this._distance=o[0].dist(o[1]),this._active||!(Math.abs(_f(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:_f(this._distance,g),pinchAround:h}}}function Tu(d,o){return 180*d.angleWith(o)/Math.PI}class Go extends Ul{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(o){this._startVector=this._vector=o[0].sub(o[1]),this._minDiameter=o[0].dist(o[1])}_move(o,h){const g=this._vector;if(this._vector=o[0].sub(o[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Tu(this._vector,g),pinchAround:h}}_isBelowThreshold(o){this._minDiameter=Math.min(this._minDiameter,o.mag());const h=25/(Math.PI*this._minDiameter)*360,g=Tu(o,this._startVector);return Math.abs(g)<h}}function on(d){return Math.abs(d.y)>Math.abs(d.x)}class Vl extends Ul{constructor(o){super(),this._map=o}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(o){this._lastPoints=o,on(o[0].sub(o[1]))&&(this._valid=!1)}_move(o,h,g){const x=this._lastPoints;if(!x)return;const b=o[0].sub(x[0]),S=o[1].sub(x[1]);return this._map._cooperativeGestures&&g.touches.length<3||(this._valid=this.gestureBeginsVertically(b,S,g.timeStamp),!this._valid)?void 0:(this._lastPoints=o,this._active=!0,{pitchDelta:(b.y+S.y)/2*-.5})}gestureBeginsVertically(o,h,g){if(this._valid!==void 0)return this._valid;const x=o.mag()>=2,b=h.mag()>=2;if(!x&&!b)return;if(!x||!b)return this._firstMove==null&&(this._firstMove=g),g-this._firstMove<100&&void 0;const S=o.y>0==h.y>0;return on(o)&&on(h)&&S}}const pt={panStep:100,bearingStep:15,pitchStep:10};class yf{constructor(){const o=pt;this._panStep=o.panStep,this._bearingStep=o.bearingStep,this._pitchStep=o.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(o){if(o.altKey||o.ctrlKey||o.metaKey)return;let h=0,g=0,x=0,b=0,S=0;switch(o.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:o.shiftKey?g=-1:(o.preventDefault(),b=-1);break;case 39:o.shiftKey?g=1:(o.preventDefault(),b=1);break;case 38:o.shiftKey?x=1:(o.preventDefault(),S=-1);break;case 40:o.shiftKey?x=-1:(o.preventDefault(),S=1);break;default:return}return this._rotationDisabled&&(g=0,x=0),{cameraAnimation:A=>{const I=A.getZoom();A.easeTo({duration:300,easeId:"keyboardHandler",easing:vf,zoom:h?Math.round(I)+h*(o.shiftKey?2:1):I,bearing:A.getBearing()+g*this._bearingStep,pitch:A.getPitch()+x*this._pitchStep,offset:[-b*this._panStep,-S*this._panStep],center:A.getCenter()},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function vf(d){return d*(2-d)}const Zo=4.000244140625;class Fa{constructor(o,h){this._map=o,this._el=o.getCanvasContainer(),this._handler=h,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,a.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(o){this._defaultZoomRate=o}setWheelZoomRate(o){this._wheelZoomRate=o}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(o){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!o&&o.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(o){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(o.ctrlKey||o.metaKey||this.isZooming()||a.isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let h=o.deltaMode===a.window.WheelEvent.DOM_DELTA_LINE?40*o.deltaY:o.deltaY;const g=a.exported.now(),x=g-(this._lastWheelEventTime||0);this._lastWheelEventTime=g,h!==0&&h%Zo==0?this._type="wheel":h!==0&&Math.abs(h)<4?this._type="trackpad":x>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,o)):this._type||(this._type=Math.abs(x*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),o.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=o,this._delta-=h,this._active||this._start(o)),o.preventDefault()}_onTimeout(o){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(o)}_start(o){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const h=Re(this._el,o);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:h,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const o=this._map.transform,h=()=>o._terrainEnabled()&&this._aroundCoord?o.computeZoomRelativeTo(this._aroundCoord):o.zoom;if(this._delta!==0){const I=this._type==="wheel"&&Math.abs(this._delta)>Zo?this._wheelZoomRate:this._defaultZoomRate;let k=2/(1+Math.exp(-Math.abs(this._delta*I)));this._delta<0&&k!==0&&(k=1/k);const R=h(),U=Math.pow(2,R),Z=typeof this._targetZoom=="number"?o.zoomScale(this._targetZoom):U;this._targetZoom=Math.min(o.maxZoom,Math.max(o.minZoom,o.scaleZoom(Z*k))),this._type==="wheel"&&(this._startZoom=R,this._easing=this._smoothOutEasing(200)),this._delta=0}const g=typeof this._targetZoom=="number"?this._targetZoom:h(),x=this._startZoom,b=this._easing;let S,A=!1;if(this._type==="wheel"&&x&&b){const I=Math.min((a.exported.now()-this._lastWheelEventTime)/200,1),k=b(I);S=a.number(x,g,k),I<1?this._frameId||(this._frameId=!0):A=!0}else S=g,A=!0;return this._active=!0,A&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!A,zoomDelta:S-h(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(o){let h=a.ease;if(this._prevEase){const g=this._prevEase,x=(a.exported.now()-g.start)/g.duration,b=g.easing(x+.01)-g.easing(x),S=.27/Math.sqrt(b*b+1e-4)*.01,A=Math.sqrt(.0729-S*S);h=a.bezier(S,A,.25,1)}return this._prevEase={start:a.exported.now(),duration:o,easing:h},h}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=W("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(a.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class xf{constructor(o,h){this._clickZoom=o,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class bf{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(o,h){return o.preventDefault(),{cameraAnimation:g=>{g.easeTo({duration:300,zoom:g.getZoom()+(o.shiftKey?-1:1),around:g.unproject(h)},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class wf{constructor(){this._tap=new Fl({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(o,h,g){this._swipePoint||(this._tapTime&&o.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?g.length>0&&(this._swipePoint=h[0],this._swipeTouch=g[0].identifier):this._tap.touchstart(o,h,g))}touchmove(o,h,g){if(this._tapTime){if(this._swipePoint){if(g[0].identifier!==this._swipeTouch)return;const x=h[0],b=x.y-this._swipePoint.y;return this._swipePoint=x,o.preventDefault(),this._active=!0,{zoomDelta:b/128}}}else this._tap.touchmove(o,h,g)}touchend(o,h,g){this._tapTime?this._swipePoint&&g.length===0&&this.reset():this._tap.touchend(o,h,g)&&(this._tapTime=o.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Tf{constructor(o,h,g){this._el=o,this._mousePan=h,this._touchPan=g}enable(o){this._inertiaOptions=o||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Ef{constructor(o,h,g){this._pitchWithRotate=o.pitchWithRotate,this._mouseRotate=h,this._mousePitch=g}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Sf{constructor(o,h,g,x){this._el=o,this._touchZoom=h,this._touchRotate=g,this._tapDragZoom=x,this._rotationDisabled=!1,this._enabled=!0}enable(o){this._touchZoom.enable(o),this._rotationDisabled||this._touchRotate.enable(o),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Na=d=>d.zoom||d.drag||d.pitch||d.rotate;class Gl extends a.Event{}class Eu{constructor(){this.constants=[1,1,.01],this.radius=0}setup(o,h){const g=a.sub([],h,o);this.radius=a.length(g[2]<0?a.div([],g,this.constants):[g[0],g[1],0])}projectRay(o){a.div(o,o,this.constants),a.normalize(o,o),a.mul$1(o,o,this.constants);const h=a.scale$2([],o,this.radius);if(h[2]>0){const g=a.scale$2([],[0,0,1],a.dot(h,[0,0,1])),x=a.scale$2([],a.normalize([],[h[0],h[1],0]),this.radius),b=a.add([],h,a.scale$2([],a.sub([],a.add([],x,g),h),2));h[0]=b[0],h[1]=b[1]}return h}}function Js(d){return d.panDelta&&d.panDelta.mag()||d.zoomDelta||d.bearingDelta||d.pitchDelta}class Af{constructor(o,h){this._map=o,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new bu(o),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Eu,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(h),a.bindAll(["handleEvent","handleWindowEvent"],this);const g=this._el;this._listeners=[[g,"touchstart",{passive:!0}],[g,"touchmove",{passive:!1}],[g,"touchend",void 0],[g,"touchcancel",void 0],[g,"mousedown",void 0],[g,"mousemove",void 0],[g,"mouseup",void 0],[a.window.document,"mousemove",{capture:!0}],[a.window.document,"mouseup",void 0],[g,"mouseover",void 0],[g,"mouseout",void 0],[g,"dblclick",void 0],[g,"click",void 0],[g,"keydown",{capture:!1}],[g,"keyup",void 0],[g,"wheel",{passive:!1}],[g,"contextmenu",void 0],[a.window,"blur",void 0]];for(const[x,b,S]of this._listeners)x.addEventListener(b,x===a.window.document?this.handleWindowEvent:this.handleEvent,S)}destroy(){for(const[o,h,g]of this._listeners)o.removeEventListener(h,o===a.window.document?this.handleWindowEvent:this.handleEvent,g)}_addDefaultHandlers(o){const h=this._map,g=h.getCanvasContainer();this._add("mapEvent",new hf(h,o));const x=h.boxZoom=new df(h,o);this._add("boxZoom",x);const b=new pf,S=new bf;h.doubleClickZoom=new xf(S,b),this._add("tapZoom",b),this._add("clickZoom",S);const A=new wf;this._add("tapDragZoom",A);const I=h.touchPitch=new Vl(h);this._add("touchPitch",I);const k=new wu(o),R=new ar(o);h.dragRotate=new Ef(o,k,R),this._add("mouseRotate",k,["mousePitch"]),this._add("mousePitch",R,["mouseRotate"]);const U=new gf(o),Z=new Rp(h,o);h.dragPan=new Tf(g,U,Z),this._add("mousePan",U),this._add("touchPan",Z,["touchZoom","touchRotate"]);const J=new Go,H=new Qn;h.touchZoomRotate=new Sf(g,H,J,A),this._add("touchRotate",J,["touchPan","touchZoom"]),this._add("touchZoom",H,["touchPan","touchRotate"]),this._add("blockableMapEvent",new ff(h));const Y=h.scrollZoom=new Fa(h,this);this._add("scrollZoom",Y,["mousePan"]);const K=h.keyboard=new yf;this._add("keyboard",K);for(const X of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])o.interactive&&o[X]&&h[X].enable(o[X])}_add(o,h,g){this._handlers.push({handlerName:o,handler:h,allowed:g}),this._handlersById[o]=h}stop(o){if(!this._updatingCamera){for(const{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},o),this._changes=[]}}isActive(){for(const{handler:o}of this._handlers)if(o.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Na(this._eventsInProgress)||this.isZooming()}_blockedByActive(o,h,g){for(const x in o)if(x!==g&&(!h||h.indexOf(x)<0))return!0;return!1}handleWindowEvent(o){this.handleEvent(o,`${o.type}Window`)}_getMapTouches(o){const h=[];for(const g of o)this._el.contains(g.target)&&h.push(g);return h}handleEvent(o,h){this._updatingCamera=!0;const g=o.type==="renderFrame",x=g?void 0:o,b={needsRenderFrame:!1},S={},A={},I=o.touches?this._getMapTouches(o.touches):void 0,k=I?ot(this._el,I):g?void 0:Re(this._el,o);for(const{handlerName:Z,handler:J,allowed:H}of this._handlers){if(!J.isEnabled())continue;let Y;this._blockedByActive(A,H,Z)?J.reset():J[h||o.type]&&(Y=J[h||o.type](o,k,I),this.mergeHandlerResult(b,S,Y,Z,x),Y&&Y.needsRenderFrame&&this._triggerRenderFrame()),(Y||J.isActive())&&(A[Z]=J)}const R={};for(const Z in this._previousActiveHandlers)A[Z]||(R[Z]=x);this._previousActiveHandlers=A,(Object.keys(R).length||Js(b))&&(this._changes.push([b,S,R]),this._triggerRenderFrame()),(Object.keys(A).length||Js(b))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:U}=b;U&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],U(this._map))}mergeHandlerResult(o,h,g,x,b){if(!g)return;a.extend(o,g);const S={handlerName:x,originalEvent:g.originalEvent||b};g.zoomDelta!==void 0&&(h.zoom=S),g.panDelta!==void 0&&(h.drag=S),g.pitchDelta!==void 0&&(h.pitch=S),g.bearingDelta!==void 0&&(h.rotate=S)}_applyChanges(){const o={},h={},g={};for(const[x,b,S]of this._changes)x.panDelta&&(o.panDelta=(o.panDelta||new a.pointGeometry(0,0))._add(x.panDelta)),x.zoomDelta&&(o.zoomDelta=(o.zoomDelta||0)+x.zoomDelta),x.bearingDelta&&(o.bearingDelta=(o.bearingDelta||0)+x.bearingDelta),x.pitchDelta&&(o.pitchDelta=(o.pitchDelta||0)+x.pitchDelta),x.around!==void 0&&(o.around=x.around),x.aroundCoord!==void 0&&(o.aroundCoord=x.aroundCoord),x.pinchAround!==void 0&&(o.pinchAround=x.pinchAround),x.noInertia&&(o.noInertia=x.noInertia),a.extend(h,b),a.extend(g,S);this._updateMapTransform(o,h,g),this._changes=[]}_updateMapTransform(o,h,g){const x=this._map,b=x.transform,S=ne=>[ne.x,ne.y,ne.z];if((ne=>{const ee=this._eventsInProgress.drag;return ee&&!this._handlersById[ee.handlerName].isActive()})()&&!Js(o)){const ne=b.zoom;b.cameraElevationReference="sea",b.recenterOnTerrain(),b.cameraElevationReference="ground",ne!==b.zoom&&this._map._update(!0)}if(!Js(o))return void this._fireEvents(h,g,!0);let{panDelta:A,zoomDelta:I,bearingDelta:k,pitchDelta:R,around:U,aroundCoord:Z,pinchAround:J}=o;J!==void 0&&(U=J),(ne=>h.drag&&!this._eventsInProgress.drag)()&&U&&(this._dragOrigin=S(b.pointCoordinate3D(U)),this._trackingEllipsoid.setup(b._camera.position,this._dragOrigin)),b.cameraElevationReference="sea",x._stop(!0),U=U||x.transform.centerPoint,k&&(b.bearing+=k),R&&(b.pitch+=R),b._updateCameraState();const H=[0,0,0];if(A)if(b.projection.name==="mercator"){const ne=this._trackingEllipsoid.projectRay(b.screenPointToMercatorRay(U).dir),ee=this._trackingEllipsoid.projectRay(b.screenPointToMercatorRay(U.sub(A)).dir);H[0]=ee[0]-ne[0],H[1]=ee[1]-ne[1]}else{const ne=b.pointCoordinate(U);if(b.projection.name==="globe"){A=A.rotate(-b.angle);const ee=b._pixelsPerMercatorPixel/b.worldSize;H[0]=-A.x*a.mercatorScale(a.latFromMercatorY(ne.y))*ee,H[1]=-A.y*a.mercatorScale(b.center.lat)*ee}else{const ee=b.pointCoordinate(U.sub(A));ne&&ee&&(H[0]=ee.x-ne.x,H[1]=ee.y-ne.y)}}const Y=b.zoom,K=[0,0,0];if(I){const ne=S(Z||b.pointCoordinate3D(U)),ee={dir:a.normalize([],a.sub([],ne,b._camera.position))};if(ee.dir[2]<0){const ve=b.zoomDeltaToMovement(ne,I);a.scale$2(K,ee.dir,ve)}}const X=a.add(H,H,K);b._translateCameraConstrained(X),I&&Math.abs(b.zoom-Y)>1e-4&&b.recenterOnTerrain(),b.cameraElevationReference="ground",this._map._update(),o.noInertia||this._inertia.record(o),this._fireEvents(h,g,!0)}_fireEvents(o,h,g){const x=Na(this._eventsInProgress),b=Na(o),S={};for(const R in o){const{originalEvent:U}=o[R];this._eventsInProgress[R]||(S[`${R}start`]=U),this._eventsInProgress[R]=o[R]}!x&&b&&this._fireEvent("movestart",b.originalEvent);for(const R in S)this._fireEvent(R,S[R]);b&&this._fireEvent("move",b.originalEvent);for(const R in o){const{originalEvent:U}=o[R];this._fireEvent(R,U)}const A={};let I;for(const R in this._eventsInProgress){const{handlerName:U,originalEvent:Z}=this._eventsInProgress[R];this._handlersById[U].isActive()||(delete this._eventsInProgress[R],I=h[U]||Z,A[`${R}end`]=I)}for(const R in A)this._fireEvent(R,A[R]);const k=Na(this._eventsInProgress);if(g&&(x||b)&&!k){this._updatingCamera=!0;const R=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),U=Z=>Z!==0&&-this._bearingSnap<Z&&Z<this._bearingSnap;R?(U(R.bearing||this._map.getBearing())&&(R.bearing=0),this._map.easeTo(R,{originalEvent:I})):(this._map.fire(new a.Event("moveend",{originalEvent:I})),U(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(o,h){this._map.fire(new a.Event(o,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(o=>{this._frameId=void 0,this.handleEvent(new Gl("renderFrame",{timeStamp:o})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Su="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Mf extends a.Evented{constructor(o,h){super(),this._moving=!1,this._zooming=!1,this.transform=o,this._bearingSnap=h.bearingSnap,a.bindAll(["_renderFrameCallback"],this)}getCenter(){return new a.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(o,h){return this.jumpTo({center:o},h)}panBy(o,h,g){return o=a.pointGeometry.convert(o).mult(-1),this.panTo(this.transform.center,a.extend({offset:o},h),g)}panTo(o,h,g){return this.easeTo(a.extend({center:o},h),g)}getZoom(){return this.transform.zoom}setZoom(o,h){return this.jumpTo({zoom:o},h),this}zoomTo(o,h,g){return this.easeTo(a.extend({zoom:o},h),g)}zoomIn(o,h){return this.zoomTo(this.getZoom()+1,o,h),this}zoomOut(o,h){return this.zoomTo(this.getZoom()-1,o,h),this}getBearing(){return this.transform.bearing}setBearing(o,h){return this.jumpTo({bearing:o},h),this}getPadding(){return this.transform.padding}setPadding(o,h){return this.jumpTo({padding:o},h),this}rotateTo(o,h,g){return this.easeTo(a.extend({bearing:o},h),g)}resetNorth(o,h){return this.rotateTo(0,a.extend({duration:1e3},o),h),this}resetNorthPitch(o,h){return this.easeTo(a.extend({bearing:0,pitch:0,duration:1e3},o),h),this}snapToNorth(o,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(o,h):this}getPitch(){return this.transform.pitch}setPitch(o,h){return this.jumpTo({pitch:o},h),this}cameraForBounds(o,h){this.transform.projection.name==="globe"&&a.warnOnce('Globe projection does not support cameraForBounds API, this API may behave unexpectedly."'),o=a.LngLatBounds.convert(o);const g=h&&h.bearing||0;return this._cameraForBoxAndBearing(o.getNorthWest(),o.getSouthEast(),g,h)}_extendCameraOptions(o){const h={top:0,bottom:0,right:0,left:0};if(typeof(o=a.extend({padding:h,offset:[0,0],maxZoom:this.transform.maxZoom},o)).padding=="number"){const g=o.padding;o.padding={top:g,bottom:g,right:g,left:g}}return o.padding=a.extend(h,o.padding),o}_cameraForBoxAndBearing(o,h,g,x){const b=this._extendCameraOptions(x),S=this.transform,A=S.padding,I=S.project(a.LngLat.convert(o)),k=S.project(a.LngLat.convert(h)),R=new a.pointGeometry(I.x,k.y),U=new a.pointGeometry(k.x,I.y),Z=-a.degToRad(g),J=I.rotate(Z),H=k.rotate(Z),Y=R.rotate(Z),K=U.rotate(Z),X=new a.pointGeometry(Math.max(J.x,H.x,Y.x,K.x),Math.max(J.y,H.y,Y.y,K.y)),ne=new a.pointGeometry(Math.min(J.x,H.x,Y.x,K.x),Math.min(J.y,H.y,Y.y,K.y)),ee=X.sub(ne),ve=(S.width-((A.left||0)+(A.right||0)+b.padding.left+b.padding.right))/ee.x,ge=(S.height-((A.top||0)+(A.bottom||0)+b.padding.top+b.padding.bottom))/ee.y;if(ge<0||ve<0)return void a.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const ue=Math.min(S.scaleZoom(S.scale*Math.min(ve,ge)),b.maxZoom),_e=typeof b.offset.x=="number"&&typeof b.offset.y=="number"?new a.pointGeometry(b.offset.x,b.offset.y):a.pointGeometry.convert(b.offset),pe=new a.pointGeometry((b.padding.left-b.padding.right)/2,(b.padding.top-b.padding.bottom)/2).rotate(g*Math.PI/180),we=_e.add(pe).mult(S.scale/S.zoomScale(ue));return{center:S.unproject(I.add(k).div(2).sub(we)),zoom:ue,bearing:g}}_cameraForBox(o,h,g,x,b){const S=this._extendCameraOptions(b);g=g||0,x=x||0,o=a.LngLat.convert(o),h=a.LngLat.convert(h);const A=this.transform.clone();A.padding=S.padding;const I=this.getFreeCameraOptions(),k=new a.LngLat(.5*(o.lng+h.lng),.5*(o.lat+h.lat)),R=.5*(g+x);if(A._camera.position[2]<a.mercatorZfromAltitude(R,k.lat))return void a.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");I.lookAtPoint(k),A.setFreeCameraOptions(I);const U=a.MercatorCoordinate.fromLngLat(o),Z=a.MercatorCoordinate.fromLngLat(h),J=A.pointRayIntersection(A.centerPoint,R),H=[(Y=A.rayIntersectionCoordinate(J)).x,Y.y,Y.z];var Y;const K=A.screenPointToMercatorRay(A.centerPoint),X=A.projection.name!=="globe";let ne,ee=0;do{const ve=Math.floor(A.zoom),ge=1<<ve,ue=Math.min(ge*U.x,ge*Z.x),_e=Math.min(ge*U.y,ge*Z.y),pe=Math.max(ge*U.x,ge*Z.x),we=Math.max(ge*U.y,ge*Z.y),Ie=new a.Aabb([ue,_e,g],[pe,we,x]),Je=a.Frustum.fromInvProjectionMatrix(A.invProjMatrix,A.worldSize,ve,X);if(Ie.intersects(Je)!==2){ne&&(A._camera.position=a.scaleAndAdd([],A._camera.position,K.dir,-ne),A._updateStateFromCamera());break}const Ae=a.sub([],A._camera.position,H);ne=.5*a.length(Ae),A._camera.position=a.scaleAndAdd([],A._camera.position,K.dir,ne);try{A._updateStateFromCamera()}catch{return void a.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++ee<10);return{center:A.center,zoom:A.zoom,bearing:A.bearing,pitch:A.pitch}}fitBounds(o,h,g){return this.transform.projection.name==="globe"&&a.warnOnce("Globe projection does not support fitBounds API, this API may behave unexpectedly."),this._fitInternal(this.cameraForBounds(o,h),h,g)}_raycastElevationBox(o,h){const g=this.transform.elevation;if(!g)return;const x=new a.pointGeometry(o.x,h.y),b=new a.pointGeometry(h.x,o.y),S=g.pointCoordinate(o);if(!S)return;const A=g.pointCoordinate(h);if(!A)return;const I=g.pointCoordinate(x);if(!I)return;const k=g.pointCoordinate(b);if(!k)return;const R=new a.MercatorCoordinate(S[0],S[1]).toLngLat(),U=new a.MercatorCoordinate(A[0],A[1]).toLngLat(),Z=new a.MercatorCoordinate(I[0],I[1]).toLngLat(),J=new a.MercatorCoordinate(k[0],k[1]).toLngLat(),H=Math.min(R.lng,Math.min(U.lng,Math.min(Z.lng,J.lng))),Y=Math.min(R.lat,Math.min(U.lat,Math.min(Z.lat,J.lat))),K=Math.max(R.lng,Math.max(U.lng,Math.max(Z.lng,J.lng))),X=Math.max(R.lat,Math.max(U.lat,Math.max(Z.lat,J.lat))),ne=Math.min(S[3],Math.min(A[3],Math.min(I[3],k[3]))),ee=Math.max(S[3],Math.max(A[3],Math.max(I[3],k[3])));return{minLngLat:new a.LngLat(H,Y),maxLngLat:new a.LngLat(K,X),minAltitude:ne,maxAltitude:ee}}fitScreenCoordinates(o,h,g,x,b){let S,A,I,k;this.transform.projection.name==="globe"&&a.warnOnce("Globe projection does not support fitScreenCoordinates API, this API may behave unexpectedly.");const R=a.pointGeometry.convert(o),U=a.pointGeometry.convert(h),Z=this._raycastElevationBox(R,U);if(Z)S=Z.minLngLat,A=Z.maxLngLat,I=Z.minAltitude,k=Z.maxAltitude;else{if(this.transform.anyCornerOffEdge(R,U))return this;S=this.transform.pointLocation(R),A=this.transform.pointLocation(U)}return this._fitInternal(this.transform.pitch===0?this._cameraForBoxAndBearing(this.transform.pointLocation(a.pointGeometry.convert(o)),this.transform.pointLocation(a.pointGeometry.convert(h)),g,x):this._cameraForBox(S,A,I,k,x),x,b)}_fitInternal(o,h,g){return o?(delete(h=a.extend(o,h)).padding,h.linear?this.easeTo(h,g):this.flyTo(h,g)):this}jumpTo(o,h){this.stop();const g=o.preloadOnly?this.transform.clone():this.transform;let x=!1,b=!1,S=!1;return"zoom"in o&&g.zoom!==+o.zoom&&(x=!0,g.zoom=+o.zoom),o.center!==void 0&&(g.center=a.LngLat.convert(o.center)),"bearing"in o&&g.bearing!==+o.bearing&&(b=!0,g.bearing=+o.bearing),"pitch"in o&&g.pitch!==+o.pitch&&(S=!0,g.pitch=+o.pitch),o.padding==null||g.isPaddingEqual(o.padding)||(g.padding=o.padding),o.preloadOnly?(this._preloadTiles(g),this):(this.fire(new a.Event("movestart",h)).fire(new a.Event("move",h)),x&&this.fire(new a.Event("zoomstart",h)).fire(new a.Event("zoom",h)).fire(new a.Event("zoomend",h)),b&&this.fire(new a.Event("rotatestart",h)).fire(new a.Event("rotate",h)).fire(new a.Event("rotateend",h)),S&&this.fire(new a.Event("pitchstart",h)).fire(new a.Event("pitch",h)).fire(new a.Event("pitchend",h)),this.fire(new a.Event("moveend",h)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||a.warnOnce(Su),this.transform.getFreeCameraOptions()}setFreeCameraOptions(o,h){const g=this.transform;if(!g.projection.supportsFreeCamera)return a.warnOnce(Su),this;this.stop();const x=g.zoom,b=g.pitch,S=g.bearing;g.setFreeCameraOptions(o);const A=x!==g.zoom,I=b!==g.pitch,k=S!==g.bearing;return this.fire(new a.Event("movestart",h)).fire(new a.Event("move",h)),A&&this.fire(new a.Event("zoomstart",h)).fire(new a.Event("zoom",h)).fire(new a.Event("zoomend",h)),k&&this.fire(new a.Event("rotatestart",h)).fire(new a.Event("rotate",h)).fire(new a.Event("rotateend",h)),I&&this.fire(new a.Event("pitchstart",h)).fire(new a.Event("pitch",h)).fire(new a.Event("pitchend",h)),this.fire(new a.Event("moveend",h)),this}easeTo(o,h){this._stop(!1,o.easeId),((o=a.extend({offset:[0,0],duration:500,easing:a.ease},o)).animate===!1||!o.essential&&a.exported.prefersReducedMotion)&&(o.duration=0);const g=this.transform,x=this.getZoom(),b=this.getBearing(),S=this.getPitch(),A=this.getPadding(),I="zoom"in o?+o.zoom:x,k="bearing"in o?this._normalizeBearing(o.bearing,b):b,R="pitch"in o?+o.pitch:S,U="padding"in o?o.padding:g.padding,Z=a.pointGeometry.convert(o.offset);let J,H,Y;if(g.projection.name==="globe"){const we=a.MercatorCoordinate.fromLngLat(g.center),Ie=Z.rotate(-g.angle);we.x+=Ie.x/g.worldSize,we.y+=Ie.y/g.worldSize;const Je=we.toLngLat(),Ae=a.LngLat.convert(o.center||Je);this._normalizeCenter(Ae),J=g.centerPoint.add(Ie),H=new a.pointGeometry(we.x,we.y).mult(g.worldSize),Y=new a.pointGeometry(a.mercatorXfromLng(Ae.lng),a.mercatorYfromLat(Ae.lat)).mult(g.worldSize).sub(H)}else{J=g.centerPoint.add(Z);const we=g.pointLocation(J),Ie=a.LngLat.convert(o.center||we);this._normalizeCenter(Ie),H=g.project(we),Y=g.project(Ie).sub(H)}const K=g.zoomScale(I-x);let X,ne;o.around&&(X=a.LngLat.convert(o.around),ne=g.locationPoint(X));const ee=this._zooming||I!==x,ve=this._rotating||b!==k,ge=this._pitching||R!==S,ue=!g.isPaddingEqual(U),_e=we=>Ie=>{if(ee&&(we.zoom=a.number(x,I,Ie)),ve&&(we.bearing=a.number(b,k,Ie)),ge&&(we.pitch=a.number(S,R,Ie)),ue&&(we.interpolatePadding(A,U,Ie),J=we.centerPoint.add(Z)),X)we.setLocationAtPoint(X,ne);else{const Je=we.zoomScale(we.zoom-x),Ae=I>x?Math.min(2,K):Math.max(.5,K),Ue=Math.pow(Ae,1-Ie),qe=we.unproject(H.add(Y.mult(Ie*Ue)).mult(Je));we.setLocationAtPoint(we.renderWorldCopies?qe.wrap():qe,J)}return o.preloadOnly||this._fireMoveEvents(h),we};if(o.preloadOnly){const we=this._emulate(_e,o.duration,g);return this._preloadTiles(we),this}const pe={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ee,this._rotating=ve,this._pitching=ge,this._padding=ue,this._easeId=o.easeId,this._prepareEase(h,o.noMoveStart,pe),this._ease(_e(g),we=>{g.recenterOnTerrain(),this._afterEase(h,we)},o),this}_prepareEase(o,h,g={}){this._moving=!0,this.transform.cameraElevationReference="sea",h||g.moving||this.fire(new a.Event("movestart",o)),this._zooming&&!g.zooming&&this.fire(new a.Event("zoomstart",o)),this._rotating&&!g.rotating&&this.fire(new a.Event("rotatestart",o)),this._pitching&&!g.pitching&&this.fire(new a.Event("pitchstart",o))}_fireMoveEvents(o){this.fire(new a.Event("move",o)),this._zooming&&this.fire(new a.Event("zoom",o)),this._rotating&&this.fire(new a.Event("rotate",o)),this._pitching&&this.fire(new a.Event("pitch",o))}_afterEase(o,h){if(this._easeId&&h&&this._easeId===h)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const g=this._zooming,x=this._rotating,b=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,g&&this.fire(new a.Event("zoomend",o)),x&&this.fire(new a.Event("rotateend",o)),b&&this.fire(new a.Event("pitchend",o)),this.fire(new a.Event("moveend",o))}flyTo(o,h){if(!o.essential&&a.exported.prefersReducedMotion){const at=a.pick(o,["center","zoom","bearing","pitch","around"]);return this.jumpTo(at,h)}this.stop(),o=a.extend({offset:[0,0],speed:1.2,curve:1.42,easing:a.ease},o);const g=this.transform,x=this.getZoom(),b=this.getBearing(),S=this.getPitch(),A=this.getPadding(),I="zoom"in o?a.clamp(+o.zoom,g.minZoom,g.maxZoom):x,k="bearing"in o?this._normalizeBearing(o.bearing,b):b,R="pitch"in o?+o.pitch:S,U="padding"in o?o.padding:g.padding,Z=g.zoomScale(I-x),J=a.pointGeometry.convert(o.offset);let H=g.centerPoint.add(J);const Y=g.pointLocation(H),K=a.LngLat.convert(o.center||Y);this._normalizeCenter(K);const X=g.project(Y),ne=g.project(K).sub(X);let ee=o.curve;const ve=Math.max(g.width,g.height),ge=ve/Z,ue=ne.mag();if("minZoom"in o){const at=a.clamp(Math.min(o.minZoom,x,I),g.minZoom,g.maxZoom),st=ve/g.zoomScale(at-x);ee=Math.sqrt(st/ue*2)}const _e=ee*ee;function pe(at){const st=(ge*ge-ve*ve+(at?-1:1)*_e*_e*ue*ue)/(2*(at?ge:ve)*_e*ue);return Math.log(Math.sqrt(st*st+1)-st)}function we(at){return(Math.exp(at)-Math.exp(-at))/2}function Ie(at){return(Math.exp(at)+Math.exp(-at))/2}const Je=pe(0);let Ae=function(at){return Ie(Je)/Ie(Je+ee*at)},Ue=function(at){return ve*((Ie(Je)*(we(st=Je+ee*at)/Ie(st))-we(Je))/_e)/ue;var st},qe=(pe(1)-Je)/ee;if(Math.abs(ue)<1e-6||!isFinite(qe)){if(Math.abs(ve-ge)<1e-6)return this.easeTo(o,h);const at=ge<ve?-1:1;qe=Math.abs(Math.log(ge/ve))/ee,Ue=function(){return 0},Ae=function(st){return Math.exp(at*ee*st)}}o.duration="duration"in o?+o.duration:1e3*qe/("screenSpeed"in o?+o.screenSpeed/ee:+o.speed),o.maxDuration&&o.duration>o.maxDuration&&(o.duration=0);const rt=b!==k,Be=R!==S,et=!g.isPaddingEqual(U),We=at=>st=>{const yt=st*qe,At=1/Ae(yt);at.zoom=st===1?I:x+at.scaleZoom(At),rt&&(at.bearing=a.number(b,k,st)),Be&&(at.pitch=a.number(S,R,st)),et&&(at.interpolatePadding(A,U,st),H=at.centerPoint.add(J));const kt=st===1?K:at.unproject(X.add(ne.mult(Ue(yt))).mult(At));return at.setLocationAtPoint(at.renderWorldCopies?kt.wrap():kt,H),at._updateCameraOnTerrain(),o.preloadOnly||this._fireMoveEvents(h),at};if(o.preloadOnly){const at=this._emulate(We,o.duration,g);return this._preloadTiles(at),this}return this._zooming=!0,this._rotating=rt,this._pitching=Be,this._padding=et,this._prepareEase(h,!1),this._ease(We(g),()=>this._afterEase(h),o),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(o,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const g=this._onEaseEnd;this._onEaseEnd=void 0,g.call(this,h)}if(!o){const g=this.handlers;g&&g.stop(!1)}return this}_ease(o,h,g){g.animate===!1||g.duration===0?(o(1),h()):(this._easeStart=a.exported.now(),this._easeOptions=g,this._onEaseFrame=o,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const o=Math.min((a.exported.now()-this._easeStart)/this._easeOptions.duration,1),h=this._onEaseFrame;h&&h(this._easeOptions.easing(o)),o<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(o,h){o=a.wrap(o,-180,180);const g=Math.abs(o-h);return Math.abs(o-360-h)<g&&(o-=360),Math.abs(o+360-h)<g&&(o+=360),o}_normalizeCenter(o){const h=this.transform;if(!h.renderWorldCopies||h.maxBounds)return;const g=o.lng-h.center.lng;o.lng+=g>180?-360:g<-180?360:0}_emulate(o,h,g){const x=Math.ceil(15*h/1e3),b=[],S=o(g.clone());for(let A=0;A<=x;A++){const I=S(A/x);b.push(I.clone())}return b}}class Au{constructor(o={}){this.options=o,a.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(o){const h=this.options&&this.options.compact;return this._map=o,this._container=W("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=W("button","mapboxgl-ctrl-attrib-button",this._container),W("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=W("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),h&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),h===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(o,h){const g=this._map._getUIString(`AttributionControl.${h}`);o.setAttribute("aria-label",g),o.removeAttribute("title"),o.firstElementChild&&o.firstElementChild.setAttribute("title",g)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let o=this._editLink;o||(o=this._editLink=this._container.querySelector(".mapbox-improve-map"));const h=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||a.config.ACCESS_TOKEN}];if(o){const g=h.reduce((x,b,S)=>(b.value&&(x+=`${b.key}=${b.value}${S<h.length-1?"&":""}`),x),"?");o.href=`${a.config.FEEDBACK_URL}/${g}#${xu(this._map,!0)}`,o.rel="noopener nofollow",this._setElementTitle(o,"MapFeedback")}}_updateData(o){!o||o.sourceDataType!=="metadata"&&o.sourceDataType!=="visibility"&&o.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let o=[];if(this._map.style.stylesheet){const x=this._map.style.stylesheet;this.styleOwner=x.owner,this.styleId=x.id}const h=this._map.style._sourceCaches;for(const x in h){const b=h[x];if(b.used){const S=b.getSource();S.attribution&&o.indexOf(S.attribution)<0&&o.push(S.attribution)}}o.sort((x,b)=>x.length-b.length),o=o.filter((x,b)=>{for(let S=b+1;S<o.length;S++)if(o[S].indexOf(x)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?o=[...this.options.customAttribution,...o]:o.unshift(this.options.customAttribution));const g=o.join(" | ");g!==this._attribHTML&&(this._attribHTML=g,o.length?(this._innerContainer.innerHTML=g,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Mu{constructor(){a.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(o){this._map=o,this._container=W("div","mapboxgl-ctrl");const h=W("a","mapboxgl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://www.mapbox.com/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(o){o&&o.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const o=this._map.style._sourceCaches;if(Object.entries(o).length===0)return!0;for(const h in o){const g=o[h].getSource();if(g.hasOwnProperty("mapbox_logo")&&!g.mapbox_logo)return!1}return!0}_updateCompact(){const o=this._container.children;if(o.length){const h=o[0];this._map.getCanvasContainer().offsetWidth<250?h.classList.add("mapboxgl-compact"):h.classList.remove("mapboxgl-compact")}}}class Pu{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(o){const h=++this._id;return this._queue.push({callback:o,id:h,cancelled:!1}),h}remove(o){const h=this._currentlyRunning,g=h?this._queue.concat(h):this._queue;for(const x of g)if(x.id===o)return void(x.cancelled=!0)}run(o=0){const h=this._currentlyRunning=this._queue;this._queue=[];for(const g of h)if(!g.cancelled&&(g.callback(o),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Iu(d,o,h){if(d=new a.LngLat(d.lng,d.lat),o){const g=new a.LngLat(d.lng-360,d.lat),x=new a.LngLat(d.lng+360,d.lat),b=360*Math.ceil(Math.abs(d.lng-h.center.lng)/360),S=h.locationPoint(d).distSqr(o),A=o.x<0||o.y<0||o.x>h.width||o.y>h.height;h.locationPoint(g).distSqr(o)<S&&(A||Math.abs(g.lng-h.center.lng)<b)?d=g:h.locationPoint(x).distSqr(o)<S&&(A||Math.abs(x.lng-h.center.lng)<b)&&(d=x)}for(;Math.abs(d.lng-h.center.lng)>180;){const g=h.locationPoint(d);if(g.x>=0&&g.y>=0&&g.x<=h.width&&g.y<=h.height)break;d.lng>h.center.lng?d.lng-=360:d.lng+=360}return d}const Ua={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Zl extends a.Evented{constructor(o,h){if(super(),(o instanceof a.window.HTMLElement||h)&&(o=a.extend({element:o},h)),a.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=o&&o.anchor||"center",this._color=o&&o.color||"#3FB1CE",this._scale=o&&o.scale||1,this._draggable=o&&o.draggable||!1,this._clickTolerance=o&&o.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=o&&o.rotation||0,this._rotationAlignment=o&&o.rotationAlignment||"auto",this._pitchAlignment=o&&o.pitchAlignment&&o.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),o&&o.element)this._element=o.element,this._offset=a.pointGeometry.convert(o&&o.offset||[0,0]);else{this._defaultMarker=!0,this._element=W("div");const x=41,b=27,S=oe("svg",{display:"block",height:x*this._scale+"px",width:b*this._scale+"px",viewBox:`0 0 ${b} ${x}`},this._element),A=oe("radialGradient",{id:"shadowGradient"},oe("defs",{},S));oe("stop",{offset:"10%","stop-opacity":.4},A),oe("stop",{offset:"100%","stop-opacity":.05},A),oe("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},S),oe("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},S),oe("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},S),oe("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},S),this._offset=a.pointGeometry.convert(o&&o.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",x=>{x.preventDefault()}),this._element.addEventListener("mousedown",x=>{x.preventDefault()});const g=this._element.classList;for(const x in Ua)g.remove(`mapboxgl-marker-anchor-${x}`);g.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(o){return o===this._map||(this.remove(),this._map=o,o.getCanvasContainer().appendChild(this._element),o.on("move",this._updateMoving),o.on("moveend",this._update),o.on("remove",this._clearFadeTimer),o._addMarker(this),this.setDraggable(this._draggable),this._update(),o.on("click",this._onMapClick)),this}remove(){const o=this._map;return o&&(o.off("click",this._onMapClick),o.off("move",this._updateMoving),o.off("moveend",this._update),o.off("mousedown",this._addDragHandler),o.off("touchstart",this._addDragHandler),o.off("mouseup",this._onUp),o.off("touchend",this._onUp),o.off("mousemove",this._onMove),o.off("touchmove",this._onMove),o.off("remove",this._clearFadeTimer),o._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(o){return this._lngLat=a.LngLat.convert(o),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(o){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),o){if(!("offset"in o.options)){const x=Math.sqrt(Math.pow(13.5,2)/2);o.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[x,-1*(38.1-13.5+x)],"bottom-right":[-x,-1*(38.1-13.5+x)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=o,o._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(o){const h=o.code,g=o.charCode||o.keyCode;h!=="Space"&&h!=="Enter"&&g!==32&&g!==13||this.togglePopup()}_onMapClick(o){const h=o.originalEvent.target,g=this._element;this._popup&&(h===g||g.contains(h))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const o=this._popup;return o?(o.isOpen()?(o.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(o.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const o=this._map;if(!o)return!1;const h=o.unproject(this._pos),g=o.getFreeCameraOptions();if(!g.position)return!1;const x=g.position.toLngLat();return x.distanceTo(h)<.9*x.distanceTo(this._lngLat)}_evaluateOpacity(){const o=this._map;if(!o)return;const h=this._pos;if(!h||h.x<0||h.x>o.transform.width||h.y<0||h.y>o.transform.height)return void this._clearFadeTimer();const g=o.unproject(h);let x;o._showingGlobe()&&a.isLngLatBehindGlobe(o.transform,this._lngLat)?x=0:(x=1-o._queryFogOpacity(g),o.transform._terrainEnabled()&&o.getTerrain()&&this._behindTerrain()&&(x*=.2)),this._element.style.opacity=`${x}`,this._element.style.pointerEvents=x>0?"auto":"none",this._popup&&this._popup._setOpacity(x),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const o=this._pos;if(!o||!this._map)return;const h=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${o.x}px,${o.y}px)
            ${Ua[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${h.x}px,${h.y}px)
        `}_calculateXYTransform(){const o=this._pos,h=this._map,g=this.getPitchAlignment();if(!h||!o||g!=="map")return"";if(!h._showingGlobe()){const I=h.getPitch();return I?`rotateX(${I}deg)`:""}const x=a.radToDeg(a.globeTiltAtLngLat(h.transform,this._lngLat)),b=o.sub(a.globeCenterToScreenPoint(h.transform)),S=Math.abs(b.x)+Math.abs(b.y);if(S===0)return"";const A=x/S;return`rotateX(${-b.y*A}deg) rotateY(${b.x*A}deg)`}_calculateZTransform(){const o=this._pos,h=this._map;if(!h||!o)return"";let g=0;const x=this.getRotationAlignment();if(x==="map")if(h._showingGlobe()){const b=h.project(new a.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),S=h.project(new a.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(b);g=a.radToDeg(Math.atan2(S.y,S.x))-90}else g=-h.getBearing();else if(x==="horizon"){const b=a.smoothstep(4,6,h.getZoom()),S=a.globeCenterToScreenPoint(h.transform);S.y+=b*h.transform.height;const A=o.sub(S),I=a.radToDeg(Math.atan2(A.y,A.x));g=(I>90?I-270:I+90)*(1-b)}return g+=this._rotation,g?`rotateZ(${g}deg)`:""}_update(o){a.window.cancelAnimationFrame(this._updateFrameId);const h=this._map;h&&(h.transform.renderWorldCopies&&(this._lngLat=Iu(this._lngLat,this._pos,h.transform)),this._pos=h.project(this._lngLat),o===!0?this._updateFrameId=a.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),h._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(h._showingGlobe()||h.getTerrain()||h.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(o){return this._offset=a.pointGeometry.convert(o),this._update(),this}_onMove(o){const h=this._map;if(h){if(!this._isDragging){const g=this._clickTolerance||h._clickTolerance;this._isDragging=o.point.dist(this._pointerdownPos)>=g}this._isDragging&&(this._pos=o.point.sub(this._positionDelta),this._lngLat=h.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new a.Event("dragstart"))),this.fire(new a.Event("drag")))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const o=this._map;o&&(o.off("mousemove",this._onMove),o.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new a.Event("dragend")),this._state="inactive"}_addDragHandler(o){const h=this._map;h&&this._element.contains(o.originalEvent.target)&&(o.preventDefault(),this._positionDelta=o.point.sub(this._pos),this._pointerdownPos=o.point,this._state="pending",h.on("mousemove",this._onMove),h.on("touchmove",this._onMove),h.once("mouseup",this._onUp),h.once("touchend",this._onUp))}setDraggable(o){this._draggable=!!o;const h=this._map;return h&&(o?(h.on("mousedown",this._addDragHandler),h.on("touchstart",this._addDragHandler)):(h.off("mousedown",this._addDragHandler),h.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(o){return this._rotation=o||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(o){return this._rotationAlignment=o||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(o){return this._pitchAlignment=o||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}}class Pf{constructor(o){this.jumpTo(o)}getValue(o){if(o<=this._startTime)return this._start;if(o>=this._endTime)return this._end;const h=a.easeCubicInOut((o-this._startTime)/(this._endTime-this._startTime));return this._start*(1-h)+this._end*h}isEasing(o){return o>=this._startTime&&o<=this._endTime}jumpTo(o){this._startTime=-1/0,this._endTime=-1/0,this._start=o,this._end=o}easeTo(o,h,g){this._start=this.getValue(h),this._end=o,this._startTime=h,this._endTime=h+g}}const If={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Cf={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function ja(d){d.parentNode&&d.parentNode.removeChild(d)}const Lf={showCompass:!0,showZoom:!0,visualizePitch:!1};class Cu{constructor(o,h,g=!1){this._clickTolerance=10,this.element=h,this.mouseRotate=new wu({clickTolerance:o.dragRotate._mouseRotate._clickTolerance}),this.map=o,g&&(this.mousePitch=new ar({clickTolerance:o.dragRotate._mousePitch._clickTolerance})),a.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),h.addEventListener("mousedown",this.mousedown),h.addEventListener("touchstart",this.touchstart,{passive:!1}),h.addEventListener("touchmove",this.touchmove),h.addEventListener("touchend",this.touchend),h.addEventListener("touchcancel",this.reset)}down(o,h){this.mouseRotate.mousedown(o,h),this.mousePitch&&this.mousePitch.mousedown(o,h),Ce()}move(o,h){const g=this.map,x=this.mouseRotate.mousemoveWindow(o,h),b=x&&x.bearingDelta;if(b&&g.setBearing(g.getBearing()+b),this.mousePitch){const S=this.mousePitch.mousemoveWindow(o,h),A=S&&S.pitchDelta;A&&g.setPitch(g.getPitch()+A)}}off(){const o=this.element;o.removeEventListener("mousedown",this.mousedown),o.removeEventListener("touchstart",this.touchstart,{passive:!1}),o.removeEventListener("touchmove",this.touchmove),o.removeEventListener("touchend",this.touchend),o.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){ke(),a.window.removeEventListener("mousemove",this.mousemove),a.window.removeEventListener("mouseup",this.mouseup)}mousedown(o){this.down(a.extend({},o,{ctrlKey:!0,preventDefault:()=>o.preventDefault()}),Re(this.element,o)),a.window.addEventListener("mousemove",this.mousemove),a.window.addEventListener("mouseup",this.mouseup)}mousemove(o){this.move(o,Re(this.element,o))}mouseup(o){this.mouseRotate.mouseupWindow(o),this.mousePitch&&this.mousePitch.mouseupWindow(o),this.offTemp()}touchstart(o){o.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=ot(this.element,o.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>o.preventDefault()},this._startPos))}touchmove(o){o.targetTouches.length!==1?this.reset():(this._lastPos=ot(this.element,o.targetTouches)[0],this.move({preventDefault:()=>o.preventDefault()},this._lastPos))}touchend(o){o.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const kf={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Lu={maxWidth:100,unit:"metric"};function ku(d,o,h){const g=$l(o),x=g/o,b={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"}[h];this._map._requestDomTask(()=>{this._container.style.width=d*x+"px",this._container.innerHTML=`${g}&nbsp;${b}`})}function $l(d){const o=Math.pow(10,`${Math.floor(d)}`.length-1);let h=d/o;return h=h>=10?10:h>=5?5:h>=3?3:h>=2?2:h>=1?1:function(g){const x=Math.pow(10,Math.ceil(-Math.log(g)/Math.LN10));return Math.round(g*x)/x}(h),o*h}const Op={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Dp=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Wl(d=new a.pointGeometry(0,0),o="bottom"){if(typeof d=="number"){const h=Math.round(Math.sqrt(.5*Math.pow(d,2)));switch(o){case"top":return new a.pointGeometry(0,d);case"top-left":return new a.pointGeometry(h,h);case"top-right":return new a.pointGeometry(-h,h);case"bottom":return new a.pointGeometry(0,-d);case"bottom-left":return new a.pointGeometry(h,-h);case"bottom-right":return new a.pointGeometry(-h,-h);case"left":return new a.pointGeometry(d,0);case"right":return new a.pointGeometry(-d,0)}return new a.pointGeometry(0,0)}return d instanceof a.pointGeometry||Array.isArray(d)?a.pointGeometry.convert(d):a.pointGeometry.convert(d[o]||[0,0])}const Va={version:a.version,supported:D,setRTLTextPlugin:a.setRTLTextPlugin,getRTLTextPluginStatus:a.getRTLTextPluginStatus,Map:class extends Mf{constructor(d){if((d=a.extend({},Cf,d)).minZoom!=null&&d.maxZoom!=null&&d.minZoom>d.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(d.minPitch!=null&&d.maxPitch!=null&&d.minPitch>d.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(d.minPitch!=null&&d.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(d.maxPitch!=null&&d.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(d.antialias&&a.isSafariWithAntialiasingBug(a.window)&&(d.antialias=!1,a.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Oa(d.minZoom,d.maxZoom,d.minPitch,d.maxPitch,d.renderWorldCopies),d),this._interactive=d.interactive,this._minTileCacheSize=d.minTileCacheSize,this._maxTileCacheSize=d.maxTileCacheSize,this._failIfMajorPerformanceCaveat=d.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=d.preserveDrawingBuffer,this._antialias=d.antialias,this._trackResize=d.trackResize,this._bearingSnap=d.bearingSnap,this._refreshExpiredTiles=d.refreshExpiredTiles,this._fadeDuration=d.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=d.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=d.collectResourceTiming,this._optimizeForTerrain=d.optimizeForTerrain,this._language=d.language==="auto"?a.window.navigator.language:d.language,this._worldview=d.worldview,this._renderTaskQueue=new Pu,this._domRenderTaskQueue=new Pu,this._controls=[],this._markers=[],this._mapId=a.uniqueId(),this._locale=a.extend({},If,d.locale),this._clickTolerance=d.clickTolerance,this._cooperativeGestures=d.cooperativeGestures,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Pf(0),this._useExplicitProjection=!1,this._requestManager=new a.RequestManager(d.transformRequest,d.accessToken,d.testMode),this._silenceAuthErrors=!!d.testMode,typeof d.container=="string"){if(this._container=a.window.document.getElementById(d.container),!this._container)throw new Error(`Container '${d.container}' not found.`)}else{if(!(d.container instanceof a.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=d.container}if(this._container.childNodes.length>0&&a.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),d.maxBounds&&this.setMaxBounds(d.maxBounds),a.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),a.window!==void 0&&(a.window.addEventListener("online",this._onWindowOnline,!1),a.window.addEventListener("resize",this._onWindowResize,!1),a.window.addEventListener("orientationchange",this._onWindowResize,!1),a.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new Af(this,d),this._localFontFamily=d.localFontFamily,this._localIdeographFontFamily=d.localIdeographFontFamily,d.style&&this.setStyle(d.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),d.projection&&this.setProjection(d.projection),this._hash=d.hash&&new lf(typeof d.hash=="string"&&d.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch}),d.bounds&&(this.resize(),this.fitBounds(d.bounds,a.extend({},d.fitBoundsOptions,{duration:0})))),this.resize(),d.attributionControl&&this.addControl(new Au({customAttribution:d.customAttribution})),this._logoControl=new Mu,this.addControl(this._logoControl,d.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",o=>{this._update(o.dataType==="style"),this.fire(new a.Event(`${o.dataType}data`,o))}),this.on("dataloading",o=>{this.fire(new a.Event(`${o.dataType}dataloading`,o))})}_getMapId(){return this._mapId}addControl(d,o){if(o===void 0&&(o=d.getDefaultPosition?d.getDefaultPosition():"top-right"),!d||!d.onAdd)return this.fire(new a.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const h=d.onAdd(this);this._controls.push(d);const g=this._controlPositions[o];return o.indexOf("bottom")!==-1?g.insertBefore(h,g.firstChild):g.appendChild(h),this}removeControl(d){if(!d||!d.onRemove)return this.fire(new a.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const o=this._controls.indexOf(d);return o>-1&&this._controls.splice(o,1),d.onRemove(this),this}hasControl(d){return this._controls.indexOf(d)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(d){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const o=!this._moving;return o&&this.fire(new a.Event("movestart",d)).fire(new a.Event("move",d)),this.fire(new a.Event("resize",d)),o&&this.fire(new a.Event("moveend",d)),this}getBounds(){return this.transform.projection.name==="globe"&&a.warnOnce('Globe projection does not support getBounds API, this API may behave unexpectedly."'),this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(d){return this.transform.setMaxBounds(a.LngLatBounds.convert(d)),this._update()}setMinZoom(d){if((d=d??-2)>=-2&&d<=this.transform.maxZoom)return this.transform.minZoom=d,this._update(),this.getZoom()<d?this.setZoom(d):this.fire(new a.Event("zoomstart")).fire(new a.Event("zoom")).fire(new a.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(d){if((d=d??22)>=this.transform.minZoom)return this.transform.maxZoom=d,this._update(),this.getZoom()>d?this.setZoom(d):this.fire(new a.Event("zoomstart")).fire(new a.Event("zoom")).fire(new a.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(d){if((d=d??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(d>=0&&d<=this.transform.maxPitch)return this.transform.minPitch=d,this._update(),this.getPitch()<d?this.setPitch(d):this.fire(new a.Event("pitchstart")).fire(new a.Event("pitch")).fire(new a.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(d){if((d=d??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(d>=this.transform.minPitch)return this.transform.maxPitch=d,this._update(),this.getPitch()>d?this.setPitch(d):this.fire(new a.Event("pitchstart")).fire(new a.Event("pitch")).fire(new a.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(d){return this.transform.renderWorldCopies=d,this._update()}getLanguage(){return this._language}setLanguage(d){if(this._language=d==="auto"?a.window.navigator.language:d,this.style)for(const o in this.style._sourceCaches){const h=this.style._sourceCaches[o]._source;h._setLanguage&&h._setLanguage(this._language)}for(const o of this._controls)o._setLanguage&&o._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(d){if(this._worldview=d,this.style)for(const o in this.style._sourceCaches){const h=this.style._sourceCaches[o]._source;h._setWorldview&&h._setWorldview(d)}return this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(d){return this._lazyInitEmptyStyle(),d?typeof d=="string"&&(d={name:d}):d=null,this._useExplicitProjection=!!d,this._prioritizeAndUpdateProjection(d,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const d=this.transform,o=d.projection.name;let h;o==="globe"&&d.zoom>=a.GLOBE_ZOOM_THRESHOLD_MAX?(d.setMercatorFromTransition(),h=!0):o==="mercator"&&d.zoom<a.GLOBE_ZOOM_THRESHOLD_MAX&&(d.setProjection({name:"globe"}),h=!0),h&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(d,o){return this._updateProjection(d||o||{name:"mercator"})}_updateProjection(d){let o;if(o=d.name==="globe"&&this.transform.zoom>=a.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(d),this.style.applyProjectionUpdate(),o){this.painter.clearBackgroundTiles();for(const h in this.style._sourceCaches)this.style._sourceCaches[h].clearTiles();this._update(!0)}return this}project(d){return this.transform.locationPoint3D(a.LngLat.convert(d))}unproject(d){return this.transform.pointLocation3D(a.pointGeometry.convert(d))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_createDelegatedListener(d,o,h){if(d==="mouseenter"||d==="mouseover"){let g=!1;const x=S=>{const A=o.filter(k=>this.getLayer(k)),I=A.length?this.queryRenderedFeatures(S.point,{layers:A}):[];I.length?g||(g=!0,h.call(this,new gr(d,this,S.originalEvent,{features:I}))):g=!1},b=()=>{g=!1};return{layers:new Set(o),listener:h,delegates:{mousemove:x,mouseout:b}}}if(d==="mouseleave"||d==="mouseout"){let g=!1;const x=S=>{const A=o.filter(I=>this.getLayer(I));(A.length?this.queryRenderedFeatures(S.point,{layers:A}):[]).length?g=!0:g&&(g=!1,h.call(this,new gr(d,this,S.originalEvent)))},b=S=>{g&&(g=!1,h.call(this,new gr(d,this,S.originalEvent)))};return{layers:new Set(o),listener:h,delegates:{mousemove:x,mouseout:b}}}{const g=x=>{const b=o.filter(A=>this.getLayer(A)),S=b.length?this.queryRenderedFeatures(x.point,{layers:b}):[];S.length&&(x.features=S,h.call(this,x),delete x.features)};return{layers:new Set(o),listener:h,delegates:{[d]:g}}}}on(d,o,h){if(h===void 0)return super.on(d,o);Array.isArray(o)||(o=[o]);const g=this._createDelegatedListener(d,o,h);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[d]=this._delegatedListeners[d]||[],this._delegatedListeners[d].push(g);for(const x in g.delegates)this.on(x,g.delegates[x]);return this}once(d,o,h){if(h===void 0)return super.once(d,o);Array.isArray(o)||(o=[o]);const g=this._createDelegatedListener(d,o,h);for(const x in g.delegates)this.once(x,g.delegates[x]);return this}off(d,o,h){if(h===void 0)return super.off(d,o);o=new Set(Array.isArray(o)?o:[o]);const g=(b,S)=>{if(b.size!==S.size)return!1;for(const A of b)if(!S.has(A))return!1;return!0},x=this._delegatedListeners?this._delegatedListeners[d]:void 0;return x&&(b=>{for(let S=0;S<b.length;S++){const A=b[S];if(A.listener===h&&g(A.layers,o)){for(const I in A.delegates)this.off(I,A.delegates[I]);return b.splice(S,1),this}}})(x),this}queryRenderedFeatures(d,o){return this.style?(o!==void 0||d===void 0||d instanceof a.pointGeometry||Array.isArray(d)||(o=d,d=void 0),this.style.queryRenderedFeatures(d=d||[[0,0],[this.transform.width,this.transform.height]],o=o||{},this.transform)):[]}querySourceFeatures(d,o){return this.style.querySourceFeatures(d,o)}queryTerrainElevation(d,o){const h=this.transform.elevation;return h?(o=a.extend({},{exaggerated:!0},o),h.getAtPoint(a.MercatorCoordinate.fromLngLat(d),null,o.exaggerated)):null}setStyle(d,o){return(o=a.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},o)).diff!==!1&&o.localIdeographFontFamily===this._localIdeographFontFamily&&o.localFontFamily===this._localFontFamily&&this.style&&d?(this._diffStyle(d,o),this):(this._localIdeographFontFamily=o.localIdeographFontFamily,this._localFontFamily=o.localFontFamily,this._updateStyle(d,o))}_getUIString(d){const o=this._locale[d];if(o==null)throw new Error(`Missing UI string '${d}'`);return o}_updateStyle(d,o){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),d&&(this.style=new sn(this,o||{}),this.style.setEventedParent(this,{style:this.style}),typeof d=="string"?this.style.loadURL(d):this.style.loadJSON(d)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new sn(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(d,o){if(typeof d=="string"){const h=this._requestManager.normalizeStyleURL(d),g=this._requestManager.transformRequest(h,a.ResourceType.Style);a.getJSON(g,(x,b)=>{x?this.fire(new a.ErrorEvent(x)):b&&this._updateDiff(b,o)})}else typeof d=="object"&&this._updateDiff(d,o)}_updateDiff(d,o){try{this.style.setState(d)&&this._update(!0)}catch(h){a.warnOnce(`Unable to perform style diff: ${h.message||h.error||h}.  Rebuilding the style from scratch.`),this._updateStyle(d,o)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(a.warnOnce("There is no style added to the map."),!1)}addSource(d,o){return this._lazyInitEmptyStyle(),this.style.addSource(d,o),this._update(!0)}isSourceLoaded(d){return!!this.style&&this.style._isSourceCacheLoaded(d)}areTilesLoaded(){const d=this.style&&this.style._sourceCaches;for(const o in d){const h=d[o]._tiles;for(const g in h){const x=h[g];if(x.state!=="loaded"&&x.state!=="errored")return!1}}return!0}addSourceType(d,o,h){this._lazyInitEmptyStyle(),this.style.addSourceType(d,o,h)}removeSource(d){return this.style.removeSource(d),this._updateTerrain(),this._update(!0)}getSource(d){return this.style.getSource(d)}addImage(d,o,{pixelRatio:h=1,sdf:g=!1,stretchX:x,stretchY:b,content:S}={}){if(this._lazyInitEmptyStyle(),o instanceof a.window.HTMLImageElement||a.window.ImageBitmap&&o instanceof a.window.ImageBitmap){const{width:A,height:I,data:k}=a.exported.getImageData(o);this.style.addImage(d,{data:new a.RGBAImage({width:A,height:I},k),pixelRatio:h,stretchX:x,stretchY:b,content:S,sdf:g,version:0})}else if(o.width===void 0||o.height===void 0)this.fire(new a.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:A,height:I}=o,k=o;this.style.addImage(d,{data:new a.RGBAImage({width:A,height:I},new Uint8Array(k.data)),pixelRatio:h,stretchX:x,stretchY:b,content:S,sdf:g,version:0,userImage:k}),k.onAdd&&k.onAdd(this,d)}}updateImage(d,o){const h=this.style.getImage(d);if(!h)return void this.fire(new a.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const g=o instanceof a.window.HTMLImageElement||a.window.ImageBitmap&&o instanceof a.window.ImageBitmap?a.exported.getImageData(o):o,{width:x,height:b}=g;x!==void 0&&b!==void 0?x===h.data.width&&b===h.data.height?(h.data.replace(g.data,!(o instanceof a.window.HTMLImageElement||a.window.ImageBitmap&&o instanceof a.window.ImageBitmap)),this.style.updateImage(d,h)):this.fire(new a.ErrorEvent(new Error(`The width and height of the updated image (${x}, ${b})
                must be that same as the previous version of the image
                (${h.data.width}, ${h.data.height})`))):this.fire(new a.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(d){return d?!!this.style.getImage(d):(this.fire(new a.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(d){this.style.removeImage(d)}loadImage(d,o){a.getImage(this._requestManager.transformRequest(d,a.ResourceType.Image),(h,g)=>{o(h,g instanceof a.window.HTMLImageElement?a.exported.getImageData(g):g)})}listImages(){return this.style.listImages()}addLayer(d,o){return this._lazyInitEmptyStyle(),this.style.addLayer(d,o),this._update(!0)}moveLayer(d,o){return this.style.moveLayer(d,o),this._update(!0)}removeLayer(d){return this.style.removeLayer(d),this._update(!0)}getLayer(d){return this.style.getLayer(d)}setLayerZoomRange(d,o,h){return this.style.setLayerZoomRange(d,o,h),this._update(!0)}setFilter(d,o,h={}){return this.style.setFilter(d,o,h),this._update(!0)}getFilter(d){return this.style.getFilter(d)}setPaintProperty(d,o,h,g={}){return this.style.setPaintProperty(d,o,h,g),this._update(!0)}getPaintProperty(d,o){return this.style.getPaintProperty(d,o)}setLayoutProperty(d,o,h,g={}){return this.style.setLayoutProperty(d,o,h,g),this._update(!0)}getLayoutProperty(d,o){return this.style.getLayoutProperty(d,o)}setLight(d,o={}){return this._lazyInitEmptyStyle(),this.style.setLight(d,o),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(d){return this._lazyInitEmptyStyle(),!d&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(d),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(d){return this._lazyInitEmptyStyle(),this.style.setFog(d),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(d){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(a.LngLat.convert(d),this.transform):0}setFeatureState(d,o){return this.style.setFeatureState(d,o),this._update()}removeFeatureState(d,o){return this.style.removeFeatureState(d,o),this._update()}getFeatureState(d){return this.style.getFeatureState(d)}_updateContainerDimensions(){if(!this._container)return;const d=this._container.getBoundingClientRect().width||400,o=this._container.getBoundingClientRect().height||300;let h,g,x,b=this._container;for(;b&&(!g||!x);){const S=a.window.getComputedStyle(b).transform;S&&S!=="none"&&(h=S.match(/matrix.*\((.+)\)/)[1].split(", "),h[0]&&h[0]!=="0"&&h[0]!=="1"&&(g=h[0]),h[3]&&h[3]!=="0"&&h[3]!=="1"&&(x=h[3])),b=b.parentElement}this._containerWidth=g?Math.abs(d/g):d,this._containerHeight=x?Math.abs(o/x):o}_detectMissingCSS(){a.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&a.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const d=this._container;d.classList.add("mapboxgl-map"),(this._missingCSSCanary=W("div","mapboxgl-canary",d)).style.visibility="hidden",this._detectMissingCSS();const o=this._canvasContainer=W("div","mapboxgl-canvas-container",d);this._interactive&&o.classList.add("mapboxgl-interactive"),this._canvas=W("canvas","mapboxgl-canvas",o),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const h=this._controlContainer=W("div","mapboxgl-control-container",d),g=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(x=>{g[x]=W("div",`mapboxgl-ctrl-${x}`,h)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(d,o){const h=a.exported.devicePixelRatio||1;this._canvas.width=h*Math.ceil(d),this._canvas.height=h*Math.ceil(o),this._canvas.style.width=`${d}px`,this._canvas.style.height=`${o}px`}_addMarker(d){this._markers.push(d)}_removeMarker(d){const o=this._markers.indexOf(d);o!==-1&&this._markers.splice(o,1)}_setupPainter(){const d=a.extend({},D.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),o=this._canvas.getContext("webgl",d)||this._canvas.getContext("experimental-webgl",d);o?(a.storeAuthState(o,!0),this.painter=new mu(o,this.transform),this.on("data",h=>{h.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),a.exported$1.testSupport(o)):this.fire(new a.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(d){d.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new a.Event("webglcontextlost",{originalEvent:d}))}_contextRestored(d){this._setupPainter(),this.resize(),this._update(),this.fire(new a.Event("webglcontextrestored",{originalEvent:d}))}_onMapScroll(d){if(d.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(d){return this.style?(this._styleDirty=this._styleDirty||d,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(d){return this._update(),this._renderTaskQueue.add(d)}_cancelRenderFrame(d){this._renderTaskQueue.remove(d)}_requestDomTask(d){!this.loaded()||this.loaded()&&!this.isMoving()?d():this._domRenderTaskQueue.add(d)}_render(d){let o;const h=this.painter.context.extTimerQuery,g=a.exported.now();if(this.listens("gpu-timing-frame")&&(o=h.createQueryEXT(),h.beginQueryEXT(h.TIME_ELAPSED_EXT,o)),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(d),this._domRenderTaskQueue.run(d),this._removed)return;this._updateProjectionTransition();let x=!1;const b=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const I=this.transform.zoom,k=this.transform.pitch,R=a.exported.now();this.style.zoomHistory.update(I,R);const U=new a.EvaluationParameters(I,{now:R,fadeDuration:b,pitch:k,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),Z=U.crossFadingFactor();Z===1&&Z===this._crossFadingFactor||(x=!0,this._crossFadingFactor=Z),this.style.update(U)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let S=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),S=this._updateAverageElevation(g),this.style._updateSources(this.transform),this._forceMarkerUpdate()):S=this._updateAverageElevation(g),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,b,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:b,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new a.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new a.Event("load"))),this.style&&(this.style.hasTransitions()||x)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),o){const I=a.exported.now()-g;h.endQueryEXT(h.TIME_ELAPSED_EXT,o),setTimeout(()=>{const k=h.getQueryObjectEXT(o,h.QUERY_RESULT_EXT)/1e6;h.deleteQueryEXT(o),this.fire(new a.Event("gpu-timing-frame",{cpuTime:I,gpuTime:k})),a.window.performance.mark("frame-gpu",{startTime:g,detail:{gpuTime:k}})},50)}if(this.listens("gpu-timing-layer")){const I=this.painter.collectGpuTimers();setTimeout(()=>{const k=this.painter.queryGpuTimers(I);this.fire(new a.Event("gpu-timing-layer",{layerTimes:k}))},50)}if(this.listens("gpu-timing-deferred-render")){const I=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const k=this.painter.queryGpuTimeDeferredRender(I);this.fire(new a.Event("gpu-timing-deferred-render",{gpuTime:k}))},50)}const A=this._sourcesDirty||this._styleDirty||this._placementDirty||S;if(A||this._repaint)this.triggerRepaint();else{const I=!this.isMoving()&&this.loaded();if(I&&(S=this._updateAverageElevation(g,!0)),S)this.triggerRepaint();else if(this._triggerFrame(!1),I&&(this.fire(new a.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const k=this._calculateSpeedIndex();this.fire(new a.Event("speedindexcompleted",{speedIndex:k})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||A||(this._fullyLoaded=!0,this._authenticate())}_forceMarkerUpdate(){for(const d of this._markers)d._update()}_updateAverageElevation(d,o=!1){const h=g=>(this.transform.averageElevation=g,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&h(0);if((o||d-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(d)){const g=this.transform.averageElevation;let x=this.transform.sampleAverageElevation(),b=!1;this.transform.elevation&&(b=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(x)?x=0:this._averageElevationLastSampledAt=d;const S=Math.abs(g-x);if(S>1){if(this._isInitialLoad||b)return this._averageElevation.jumpTo(x),h(x);this._averageElevation.easeTo(x,d,300)}else if(S>1e-4)return this._averageElevation.jumpTo(x),h(x)}return!!this._averageElevation.isEasing(d)&&h(this._averageElevation.getValue(d))}_authenticate(){a.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,d=>{if(d&&(d.message===a.AUTH_ERR_MSG||d.status===401)){const o=this.painter.context.gl;a.storeAuthState(o,!1),this._logoControl instanceof Mu&&this._logoControl._updateLogo(),o&&o.clear(o.DEPTH_BUFFER_BIT|o.COLOR_BUFFER_BIT|o.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new a.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),a.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const d=this.painter.canvasCopy(),o=this.painter.getCanvasCopiesAndTimestamps();o.timeStamps.push(performance.now());const h=this.painter.context.gl,g=h.createFramebuffer();function x(b){h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,b,0);const S=new Uint8Array(h.drawingBufferWidth*h.drawingBufferHeight*4);return h.readPixels(0,0,h.drawingBufferWidth,h.drawingBufferHeight,h.RGBA,h.UNSIGNED_BYTE,S),S}return h.bindFramebuffer(h.FRAMEBUFFER,g),this._canvasPixelComparison(x(d),o.canvasCopies.map(x),o.timeStamps)}_canvasPixelComparison(d,o,h){let g=h[1]-h[0];const x=d.length/4;for(let b=0;b<o.length;b++){const S=o[b];let A=0;for(let I=0;I<S.length;I+=4)S[I]===d[I]&&S[I+1]===d[I+1]&&S[I+2]===d[I+2]&&S[I+3]===d[I+3]&&(A+=1);g+=(h[b+2]-h[b+1])*(1-A/x)}return g}remove(){this._hash&&this._hash.remove();for(const o of this._controls)o.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),a.window!==void 0&&(a.window.removeEventListener("resize",this._onWindowResize,!1),a.window.removeEventListener("orientationchange",this._onWindowResize,!1),a.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),a.window.removeEventListener("online",this._onWindowOnline,!1));const d=this.painter.context.gl.getExtension("WEBGL_lose_context");d&&d.loseContext(),ja(this._canvasContainer),ja(this._controlContainer),ja(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),a.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new a.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(d){this._renderNextFrame=this._renderNextFrame||d,this.style&&!this._frame&&(this._frame=a.exported.frame(o=>{const h=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,h&&this._render(o)}))}_preloadTiles(d){const o=this.style?Object.values(this.style._sourceCaches):[];return a.asyncAll(o,(h,g)=>h._preloadTiles(d,g),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(d){this._trackResize&&this.resize({originalEvent:d})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(d){this._showTileBoundaries!==d&&(this._showTileBoundaries=d,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(d){this._showTerrainWireframe!==d&&(this._showTerrainWireframe=d,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(d){this._speedIndexTiming!==d&&(this._speedIndexTiming=d,this._update())}get showPadding(){return!!this._showPadding}set showPadding(d){this._showPadding!==d&&(this._showPadding=d,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(d){this._showCollisionBoxes!==d&&(this._showCollisionBoxes=d,d?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(d){this._showOverdrawInspector!==d&&(this._showOverdrawInspector=d,this._update())}get repaint(){return!!this._repaint}set repaint(d){this._repaint!==d&&(this._repaint=d,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(d){this._vertices=d,this._update()}_setCacheLimits(d,o){a.setCacheLimits(d,o)}get version(){return a.version}},NavigationControl:class{constructor(d){this.options=a.extend({},Lf,d),this._container=W("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",o=>o.preventDefault()),this.options.showZoom&&(a.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",o=>{this._map&&this._map.zoomIn({},{originalEvent:o})}),W("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",o=>{this._map&&this._map.zoomOut({},{originalEvent:o})}),W("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(a.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",o=>{const h=this._map;h&&(this.options.visualizePitch?h.resetNorthPitch({},{originalEvent:o}):h.resetNorth({},{originalEvent:o}))}),this._compassIcon=W("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const d=this._map;if(!d)return;const o=d.getZoom(),h=o===d.getMaxZoom(),g=o===d.getMinZoom();this._zoomInButton.disabled=h,this._zoomOutButton.disabled=g,this._zoomInButton.setAttribute("aria-disabled",h.toString()),this._zoomOutButton.setAttribute("aria-disabled",g.toString())}_rotateCompassArrow(){const d=this._map;if(!d)return;const o=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(d.transform.pitch*(Math.PI/180)),.5)}) rotateX(${d.transform.pitch}deg) rotateZ(${d.transform.angle*(180/Math.PI)}deg)`:`rotate(${d.transform.angle*(180/Math.PI)}deg)`;d._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=o)})}onAdd(d){return this._map=d,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),d.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&d.on("pitch",this._rotateCompassArrow),d.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Cu(d,this._compass,this.options.visualizePitch)),this._container}onRemove(){const d=this._map;d&&(this._container.remove(),this.options.showZoom&&d.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&d.off("pitch",this._rotateCompassArrow),d.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(d,o){const h=W("button",d,this._container);return h.type="button",h.addEventListener("click",o),h}_setButtonTitle(d,o){if(!this._map)return;const h=this._map._getUIString(`NavigationControl.${o}`);d.setAttribute("aria-label",h),d.firstElementChild&&d.firstElementChild.setAttribute("title",h)}},GeolocateControl:class extends a.Evented{constructor(d){super(),this.options=a.extend({geolocation:a.window.navigator.geolocation},kf,d),a.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Da(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(d){return this._map=d,this._container=W("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(d){this._supportsGeolocation!==void 0?d(this._supportsGeolocation):a.window.navigator.permissions!==void 0?a.window.navigator.permissions.query({name:"geolocation"}).then(o=>{this._supportsGeolocation=o.state!=="denied",d(this._supportsGeolocation)}):(this._supportsGeolocation=!!this.options.geolocation,d(this._supportsGeolocation))}_isOutOfMapMaxBounds(d){const o=this._map.getMaxBounds(),h=d.coords;return!!o&&(h.longitude<o.getWest()||h.longitude>o.getEast()||h.latitude<o.getSouth()||h.latitude>o.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(d){if(this._map){if(this._isOutOfMapMaxBounds(d))return this._setErrorState(),this.fire(new a.Event("outofmaxbounds",d)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=d,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(d),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(d),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new a.Event("geolocate",d)),this._finish()}}_updateCamera(d){const o=new a.LngLat(d.coords.longitude,d.coords.latitude),h=d.coords.accuracy,g=this._map.getBearing(),x=a.extend({bearing:g},this.options.fitBoundsOptions);this._map.fitBounds(o.toBounds(h),x,{geolocateSource:!0})}_updateMarker(d){if(d){const o=new a.LngLat(d.coords.longitude,d.coords.latitude);this._accuracyCircleMarker.setLngLat(o).addTo(this._map),this._userLocationDotMarker.setLngLat(o).addTo(this._map),this._accuracy=d.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const d=this._map.transform,o=a.mercatorZfromAltitude(1,d._center.lat)*d.worldSize,h=Math.ceil(2*this._accuracy*o);this._circleElement.style.width=`${h}px`,this._circleElement.style.height=`${h}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(d){if(this._map){if(this.options.trackUserLocation)if(d.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(d.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new a.Event("error",d)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(d){if(this._container.addEventListener("contextmenu",o=>o.preventDefault()),this._geolocateButton=W("button","mapboxgl-ctrl-geolocate",this._container),W("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",d===!1){a.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o)}else{const o=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=W("div","mapboxgl-user-location"),this._dotElement.appendChild(W("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(W("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Zl({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=W("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Zl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",o=>{o.geolocateSource||this._watchState!=="ACTIVE_LOCK"||o.originalEvent&&o.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new a.Event("trackuserlocationend")))})}_onDeviceOrientation(d){this._userLocationDotMarker&&(d.webkitCompassHeading?this._heading=d.webkitCompassHeading:d.absolute===!0&&(this._heading=-1*d.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return a.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new a.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let d;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(d={maximumAge:6e5,timeout:0},this._noTimeout=!0):(d=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,d),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const d=()=>{a.window.addEventListener("ondeviceorientationabsolute"in a.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};a.window.DeviceMotionEvent!==void 0&&typeof a.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(o=>{o==="granted"&&d()}).catch(console.error):d()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),a.window.removeEventListener("deviceorientation",this._onDeviceOrientation),a.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Au,ScaleControl:class{constructor(d){this.options=a.extend({},Lu,d),function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"narrow",unit:"meter"}),!0}catch{return!1}}()||(this._setScale=ku.bind(this)),a.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const d=this.options.maxWidth||100,o=this._map,h=o._containerHeight/2,g=o._containerWidth/2-d/2,x=o.unproject([g,h]),b=o.unproject([g+d,h]),S=x.distanceTo(b);if(this.options.unit==="imperial"){const A=3.2808*S;A>5280?this._setScale(d,A/5280,"mile"):this._setScale(d,A,"foot")}else this.options.unit==="nautical"?this._setScale(d,S/1852,"nautical-mile"):S>=1e3?this._setScale(d,S/1e3,"kilometer"):this._setScale(d,S,"meter")}_setScale(d,o,h){const g=$l(o),x=g/o;this._map._requestDomTask(()=>{this._container.style.width=d*x+"px",this._container.innerHTML=h!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"narrow",unit:h}).format(g):`${g}&nbsp;nm`})}onAdd(d){return this._map=d,this._language=d.getLanguage(),this._container=W("div","mapboxgl-ctrl mapboxgl-ctrl-scale",d.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(d){this._language=d,this._update()}setUnit(d){this.options.unit=d,this._update()}},FullscreenControl:class{constructor(d){this._fullscreen=!1,d&&d.container&&(d.container instanceof a.window.HTMLElement?this._container=d.container:a.warnOnce("Full screen control 'container' must be a DOM element.")),a.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in a.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in a.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(d){return this._map=d,this._container||(this._container=this._map.getContainer()),this._controlContainer=W("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",a.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,a.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!a.window.document.fullscreenEnabled&&!a.window.document.webkitFullscreenEnabled)}_setupUI(){const d=this._fullscreenButton=W("button","mapboxgl-ctrl-fullscreen",this._controlContainer);W("span","mapboxgl-ctrl-icon",d).setAttribute("aria-hidden","true"),d.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),a.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const d=this._getTitle();this._fullscreenButton.setAttribute("aria-label",d),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",d)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(a.window.document.fullscreenElement||a.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?a.window.document.exitFullscreen?a.window.document.exitFullscreen():a.window.document.webkitCancelFullScreen&&a.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends a.Evented{constructor(d){super(),this.options=a.extend(Object.create(Op),d),a.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(d&&d.className?d.className.trim().split(/\s+/):[])}addTo(d){return this._map&&this.remove(),this._map=d,this.options.closeOnClick&&d.on("preclick",this._onClose),this.options.closeOnMove&&d.on("move",this._onClose),d.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(d.on("mousemove",this._onMouseEvent),d.on("mouseup",this._onMouseEvent),d._canvasContainer.classList.add("mapboxgl-track-pointer")):d.on("move",this._update),this.fire(new a.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const d=this._map;return d&&(d.off("move",this._update),d.off("move",this._onClose),d.off("preclick",this._onClose),d.off("click",this._onClose),d.off("remove",this.remove),d.off("mousemove",this._onMouseEvent),d.off("mouseup",this._onMouseEvent),d.off("drag",this._onMouseEvent),this._map=void 0),this.fire(new a.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(d){this._lngLat=a.LngLat.convert(d),this._pos=null,this._trackPointer=!1,this._update();const o=this._map;return o&&(o.on("move",this._update),o.off("mousemove",this._onMouseEvent),o._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const d=this._map;return d&&(d.off("move",this._update),d.on("mousemove",this._onMouseEvent),d.on("drag",this._onMouseEvent),d._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(d){return this.setDOMContent(a.window.document.createTextNode(d))}setHTML(d){const o=a.window.document.createDocumentFragment(),h=a.window.document.createElement("body");let g;for(h.innerHTML=d;g=h.firstChild,g;)o.appendChild(g);return this.setDOMContent(o)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(d){return this.options.maxWidth=d,this._update(),this}setDOMContent(d){let o=this._content;if(o)for(;o.hasChildNodes();)o.firstChild&&o.removeChild(o.firstChild);else o=this._content=W("div","mapboxgl-popup-content",this._container||void 0);if(o.appendChild(d),this.options.closeButton){const h=this._closeButton=W("button","mapboxgl-popup-close-button",o);h.type="button",h.setAttribute("aria-label","Close popup"),h.setAttribute("aria-hidden","true"),h.innerHTML="&#215;",h.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(d){return this._classList.add(d),this._updateClassList(),this}removeClassName(d){return this._classList.delete(d),this._updateClassList(),this}setOffset(d){return this.options.offset=d,this._update(),this}toggleClassName(d){let o;return this._classList.delete(d)?o=!1:(this._classList.add(d),o=!0),this._updateClassList(),o}_onMouseEvent(d){this._update(d.point)}_getAnchor(d){if(this.options.anchor)return this.options.anchor;const o=this._map,h=this._container,g=this._pos;if(!o||!h||!g)return"bottom";const x=h.offsetWidth,b=h.offsetHeight,S=g.x<x/2,A=g.x>o.transform.width-x/2;if(g.y+d<b)return S?"top-left":A?"top-right":"top";if(g.y>o.transform.height-b){if(S)return"bottom-left";if(A)return"bottom-right"}return S?"left":A?"right":"bottom"}_updateClassList(){const d=this._container;if(!d)return;const o=[...this._classList];o.push("mapboxgl-popup"),this._anchor&&o.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&o.push("mapboxgl-popup-track-pointer"),d.className=o.join(" ")}_update(d){const o=this._map,h=this._content;if(!o||!this._lngLat&&!this._trackPointer||!h)return;let g=this._container;if(g||(g=this._container=W("div","mapboxgl-popup",o.getContainer()),this._tip=W("div","mapboxgl-popup-tip",g),g.appendChild(h)),this.options.maxWidth&&g.style.maxWidth!==this.options.maxWidth&&(g.style.maxWidth=this.options.maxWidth),o.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Iu(this._lngLat,this._pos,o.transform)),!this._trackPointer||d){const x=this._pos=this._trackPointer&&d?d:o.project(this._lngLat),b=Wl(this.options.offset),S=this._anchor=this._getAnchor(b.y),A=Wl(this.options.offset,S),I=x.add(A).round();o._requestDomTask(()=>{this._container&&S&&(this._container.style.transform=`${Ua[S]} translate(${I.x}px,${I.y}px)`)})}if(!this._marker&&o._showingGlobe()){const x=a.isLngLatBehindGlobe(o.transform,this._lngLat)?0:1;this._setOpacity(x)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const d=this._container.querySelector(Dp);d&&d.focus()}_onClose(){this.remove()}_setOpacity(d){this._container&&(this._container.style.opacity=`${d}`),this._content&&(this._content.style.pointerEvents=d?"auto":"none")}},Marker:Zl,Style:sn,LngLat:a.LngLat,LngLatBounds:a.LngLatBounds,Point:a.pointGeometry,MercatorCoordinate:a.MercatorCoordinate,FreeCameraOptions:ht,Evented:a.Evented,config:a.config,prewarm:function(){Jt().acquire(_t)},clearPrewarmedResources:function(){const d=Bt;d&&(d.isPreloaded()&&d.numActive()===1?(d.release(_t),Bt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return a.config.ACCESS_TOKEN},set accessToken(d){a.config.ACCESS_TOKEN=d},get baseApiUrl(){return a.config.API_URL},set baseApiUrl(d){a.config.API_URL=d},get workerCount(){return Pt.workerCount},set workerCount(d){Pt.workerCount=d},get maxParallelImageRequests(){return a.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(d){a.config.MAX_PARALLEL_IMAGE_REQUESTS=d},clearStorage(d){a.clearTileCache(d)},workerUrl:"",workerClass:null,setNow:a.exported.setNow,restoreNow:a.exported.restoreNow};return Va});var T=m;return T})})(Kw);var Gz=Kw.exports;const Vs=i_(Gz);var Zz=1e-7;function Jg(r){return Array.isArray(r)||ArrayBuffer.isView(r)}function Qw(r,e){if(r===e)return!0;if(Jg(r)&&Jg(e)){if(r.length!==e.length)return!1;for(var i=0;i<r.length;++i)if(!Qw(r[i],e[i]))return!1;return!0}return Math.abs(r-e)<=Zz}function Cd(r,e,i){return Math.max(e,Math.min(i,r))}function rp(r,e,i){return Jg(r)?r.map(function(l,u){return rp(l,e[u],i)}):i*e+(1-i)*r}function cs(r,e){if(!r)throw new Error(e||"react-map-gl: assertion failed.")}function mb(r,e){var i=Object.keys(r);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(r);e&&(l=l.filter(function(u){return Object.getOwnPropertyDescriptor(r,u).enumerable})),i.push.apply(i,l)}return i}function gb(r){for(var e=1;e<arguments.length;e++){var i=arguments[e]!=null?arguments[e]:{};e%2?mb(Object(i),!0).forEach(function(l){j(r,l,i[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(i)):mb(Object(i)).forEach(function(l){Object.defineProperty(r,l,Object.getOwnPropertyDescriptor(i,l))})}return r}var al={minZoom:0,maxZoom:24,minPitch:0,maxPitch:85},_g={pitch:0,bearing:0,altitude:1.5},_b=5,$z=1.2,Ec=function(){function r(e){var i=e.width,l=e.height,u=e.latitude,m=e.longitude,y=e.zoom,T=e.bearing,a=T===void 0?_g.bearing:T,P=e.pitch,D=P===void 0?_g.pitch:P,N=e.altitude,F=N===void 0?_g.altitude:N,W=e.maxZoom,oe=W===void 0?al.maxZoom:W,me=e.minZoom,fe=me===void 0?al.minZoom:me,Ee=e.maxPitch,Ce=Ee===void 0?al.maxPitch:Ee,ke=e.minPitch,$e=ke===void 0?al.minPitch:ke,Ve=e.transitionDuration,Re=e.transitionEasing,ot=e.transitionInterpolator,bt=e.transitionInterruption,mt=e.startPanLngLat,Mt=e.startZoomLngLat,gt=e.startRotatePos,Ht=e.startBearing,Xt=e.startPitch,jt=e.startZoom;fa(this,r),cs(Number.isFinite(i),"`width` must be supplied"),cs(Number.isFinite(l),"`height` must be supplied"),cs(Number.isFinite(m),"`longitude` must be supplied"),cs(Number.isFinite(u),"`latitude` must be supplied"),cs(Number.isFinite(y),"`zoom` must be supplied"),this._viewportProps=this._applyConstraints({width:i,height:l,latitude:u,longitude:m,zoom:y,bearing:a,pitch:D,altitude:F,maxZoom:oe,minZoom:fe,maxPitch:Ce,minPitch:$e,transitionDuration:Ve,transitionEasing:Re,transitionInterpolator:ot,transitionInterruption:bt}),this._state={startPanLngLat:mt,startZoomLngLat:Mt,startRotatePos:gt,startBearing:Ht,startPitch:Xt,startZoom:jt}}return da(r,[{key:"getViewportProps",value:function(){return this._viewportProps}},{key:"getState",value:function(){return this._state}},{key:"panStart",value:function(i){var l=i.pos;return this._getUpdatedMapState({startPanLngLat:this._unproject(l)})}},{key:"pan",value:function(i){var l=i.pos,u=i.startPos,m=this._state.startPanLngLat||this._unproject(u);if(!m)return this;var y=this._calculateNewLngLat({startPanLngLat:m,pos:l}),T=ir(y,2),a=T[0],P=T[1];return this._getUpdatedMapState({longitude:a,latitude:P})}},{key:"panEnd",value:function(){return this._getUpdatedMapState({startPanLngLat:null})}},{key:"rotateStart",value:function(i){var l=i.pos;return this._getUpdatedMapState({startRotatePos:l,startBearing:this._viewportProps.bearing,startPitch:this._viewportProps.pitch})}},{key:"rotate",value:function(i){var l=i.pos,u=i.deltaAngleX,m=u===void 0?0:u,y=i.deltaAngleY,T=y===void 0?0:y,a=this._state,P=a.startRotatePos,D=a.startBearing,N=a.startPitch;if(!Number.isFinite(D)||!Number.isFinite(N))return this;var F;return l?F=this._calculateNewPitchAndBearing(gb(gb({},this._getRotationParams(l,P)),{},{startBearing:D,startPitch:N})):F={bearing:D+m,pitch:N+T},this._getUpdatedMapState(F)}},{key:"rotateEnd",value:function(){return this._getUpdatedMapState({startBearing:null,startPitch:null})}},{key:"zoomStart",value:function(i){var l=i.pos;return this._getUpdatedMapState({startZoomLngLat:this._unproject(l),startZoom:this._viewportProps.zoom})}},{key:"zoom",value:function(i){var l=i.pos,u=i.startPos,m=i.scale;cs(m>0,"`scale` must be a positive number");var y=this._state,T=y.startZoom,a=y.startZoomLngLat;Number.isFinite(T)||(T=this._viewportProps.zoom,a=this._unproject(u)||this._unproject(l)),cs(a,"`startZoomLngLat` prop is required for zoom behavior to calculate where to position the map.");var P=this._calculateNewZoom({scale:m,startZoom:T||0}),D=new ll(Object.assign({},this._viewportProps,{zoom:P})),N=D.getMapCenterByLngLatPosition({lngLat:a,pos:l}),F=ir(N,2),W=F[0],oe=F[1];return this._getUpdatedMapState({zoom:P,longitude:W,latitude:oe})}},{key:"zoomEnd",value:function(){return this._getUpdatedMapState({startZoomLngLat:null,startZoom:null})}},{key:"_getUpdatedMapState",value:function(i){return new r(Object.assign({},this._viewportProps,this._state,i))}},{key:"_applyConstraints",value:function(i){var l=i.maxZoom,u=i.minZoom,m=i.zoom;i.zoom=Cd(m,u,l);var y=i.maxPitch,T=i.minPitch,a=i.pitch;return i.pitch=Cd(a,T,y),Object.assign(i,gw(i)),i}},{key:"_unproject",value:function(i){var l=new ll(this._viewportProps);return i&&l.unproject(i)}},{key:"_calculateNewLngLat",value:function(i){var l=i.startPanLngLat,u=i.pos,m=new ll(this._viewportProps);return m.getMapCenterByLngLatPosition({lngLat:l,pos:u})}},{key:"_calculateNewZoom",value:function(i){var l=i.scale,u=i.startZoom,m=this._viewportProps,y=m.maxZoom,T=m.minZoom,a=u+Math.log2(l);return Cd(a,T,y)}},{key:"_calculateNewPitchAndBearing",value:function(i){var l=i.deltaScaleX,u=i.deltaScaleY,m=i.startBearing,y=i.startPitch;u=Cd(u,-1,1);var T=this._viewportProps,a=T.minPitch,P=T.maxPitch,D=m+180*l,N=y;return u>0?N=y+u*(P-y):u<0&&(N=y-u*(a-y)),{pitch:N,bearing:D}}},{key:"_getRotationParams",value:function(i,l){var u=i[0]-l[0],m=i[1]-l[1],y=i[1],T=l[1],a=this._viewportProps,P=a.width,D=a.height,N=u/P,F=0;return m>0?Math.abs(D-T)>_b&&(F=m/(T-D)*$z):m<0&&T>_b&&(F=1-y/T),F=Math.min(1,Math.max(-1,F)),{deltaScaleX:N,deltaScaleY:F}}}]),r}();function Wz(r){return r[0].toLowerCase()+r.slice(1)}function qz(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:al;for(var i in e){var l=i.slice(0,3),u=Wz(i.slice(3));if(l==="min"&&r[u]<e[i]||l==="max"&&r[u]>e[i])return!1}return!0}function yb(r,e){var i=Object.keys(r);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(r);e&&(l=l.filter(function(u){return Object.getOwnPropertyDescriptor(r,u).enumerable})),i.push.apply(i,l)}return i}function vb(r){for(var e=1;e<arguments.length;e++){var i=arguments[e]!=null?arguments[e]:{};e%2?yb(Object(i),!0).forEach(function(l){j(r,l,i[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(i)):yb(Object(i)).forEach(function(l){Object.defineProperty(r,l,Object.getOwnPropertyDescriptor(i,l))})}return r}var Fc=je.createContext({viewport:null,map:null,container:null,onViewportChange:null,onViewStateChange:null,eventManager:null}),C_=Fc.Provider;function Xz(r){var e=r.value,i=r.children,l=je.useState(null),u=ir(l,2),m=u[0],y=u[1],T=je.useContext(Fc);return e=vb(vb({setMap:y},T),{},{map:T&&T.map||m},e),je.createElement(C_,{value:e},i)}Fc.Provider=Xz;var Qg=typeof window<"u"?je.useLayoutEffect:je.useEffect;function gp(r,e){var i=e.longitude,l=e.latitude;return r&&r.queryTerrainElevation&&r.queryTerrainElevation([i,l])||0}function xb(r,e){var i=Object.keys(r);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(r);e&&(l=l.filter(function(u){return Object.getOwnPropertyDescriptor(r,u).enumerable})),i.push.apply(i,l)}return i}function ls(r){for(var e=1;e<arguments.length;e++){var i=arguments[e]!=null?arguments[e]:{};e%2?xb(Object(i),!0).forEach(function(l){j(r,l,i[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(i)):xb(Object(i)).forEach(function(l){Object.defineProperty(r,l,Object.getOwnPropertyDescriptor(i,l))})}return r}var Hz="https://visgl.github.io/react-map-gl/docs/get-started/mapbox-tokens",eT="A valid API access token is required to use Mapbox data";function Yz(){}function tT(r){var e=r.map,i=r.props,l=r.width,u=r.height,m=ls(ls(ls({},i),i.viewState),{},{width:l,height:u});return m.position=[0,0,gp(e,m)],new ll(m)}var Kz=401,bb={position:"absolute",width:"100%",height:"100%",overflow:"hidden"},Jz=Object.assign({},ml.propTypes,{width:Pe.oneOfType([Pe.number,Pe.string]),height:Pe.oneOfType([Pe.number,Pe.string]),onResize:Pe.func,disableTokenWarning:Pe.bool,visible:Pe.bool,className:Pe.string,style:Pe.object,visibilityConstraints:Pe.object}),Qz=Object.assign({},ml.defaultProps,{disableTokenWarning:!1,visible:!0,onResize:Yz,className:"",style:null,visibilityConstraints:al});function eB(){var r={position:"absolute",left:0,top:0};return je.createElement("div",{key:"warning",id:"no-token-warning",style:r},je.createElement("h3",{key:"header"},eT),je.createElement("div",{key:"text"},"For information on setting up your basemap, read"),je.createElement("a",{key:"link",href:Hz},"Note on Map Tokens"))}function tB(r){return{getMap:function(){return r.current&&r.current.getMap()},queryRenderedFeatures:function(i){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},u=r.current&&r.current.getMap();return u&&u.queryRenderedFeatures(i,l)}}}var pa=je.forwardRef(function(r,e){var i=je.useState(!0),l=ir(i,2),u=l[0],m=l[1],y=je.useState({width:0,height:0}),T=ir(y,2),a=T[0],P=T[1],D=je.useRef(null),N=je.useRef(null),F=je.useRef(null),W=je.useRef(null),oe=je.useContext(Fc);Qg(function(){if(pa.supported()){var Mt=new ml(ls(ls(ls({},r),a),{},{mapboxgl:Vs,container:N.current,onError:function(Xt){var jt=Xt.error&&Xt.error.status||Xt.status;jt===Kz&&u&&(console.error(eT),m(!1)),r.onError(Xt)}}));D.current=Mt,oe&&oe.setMap&&oe.setMap(Mt.getMap());var gt=new iA(function(Ht){if(Ht[0].contentRect){var Xt=Ht[0].contentRect,jt=Xt.width,Ki=Xt.height;P({width:jt,height:Ki}),r.onResize({width:jt,height:Ki})}});return gt.observe(F.current),function(){Mt.finalize(),D.current=null,gt.disconnect()}}},[]),Qg(function(){D.current&&D.current.setProps(ls(ls({},r),a))});var me=D.current&&D.current.getMap();je.useImperativeHandle(e,function(){return tB(D)},[]);var fe=je.useCallback(function(Mt){var gt=Mt.target;gt===W.current&&gt.scrollTo(0,0)},[]),Ee=me&&je.createElement(C_,{value:ls(ls({},oe),{},{viewport:oe.viewport||tT(ls({map:me,props:r},a)),map:me,container:oe.container||F.current})},je.createElement("div",{key:"map-overlays",className:"overlays",ref:W,style:bb,onScroll:fe},r.children)),Ce=r.className,ke=r.width,$e=r.height,Ve=r.style,Re=r.visibilityConstraints,ot=Object.assign({position:"relative"},Ve,{width:ke,height:$e}),bt=r.visible&&qz(r.viewState||r,Re),mt=Object.assign({},bb,{visibility:bt?"inherit":"hidden"});return je.createElement("div",{key:"map-container",ref:F,style:ot},je.createElement("div",{key:"map-mapbox",ref:N,style:mt,className:Ce}),Ee,!u&&!r.disableTokenWarning&&je.createElement(eB,null))});pa.supported=function(){return Vs&&Vs.supported()};pa.propTypes=Jz;pa.defaultProps=Qz;function iB(r,e){var i;if(typeof Symbol>"u"||r[Symbol.iterator]==null){if(Array.isArray(r)||(i=rB(r))||e){i&&(r=i);var l=0,u=function(){};return{s:u,n:function(){return l>=r.length?{done:!0}:{done:!1,value:r[l++]}},e:function(P){throw P},f:u}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var m=!0,y=!1,T;return{s:function(){i=r[Symbol.iterator]()},n:function(){var P=i.next();return m=P.done,P},e:function(P){y=!0,T=P},f:function(){try{!m&&i.return!=null&&i.return()}finally{if(y)throw T}}}}function rB(r,e){if(r){if(typeof r=="string")return wb(r,e);var i=Object.prototype.toString.call(r).slice(8,-1);if(i==="Object"&&r.constructor&&(i=r.constructor.name),i==="Map"||i==="Set")return Array.from(r);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return wb(r,e)}}function wb(r,e){(e==null||e>r.length)&&(e=r.length);for(var i=0,l=new Array(e);i<e;i++)l[i]=r[i];return l}var iT=function(){function r(){fa(this,r),j(this,"propNames",[])}return da(r,[{key:"arePropsEqual",value:function(i,l){var u=iB(this.propNames||[]),m;try{for(u.s();!(m=u.n()).done;){var y=m.value;if(!Qw(i[y],l[y]))return!1}}catch(T){u.e(T)}finally{u.f()}return!0}},{key:"initializeProps",value:function(i,l){return{start:i,end:l}}},{key:"interpolateProps",value:function(i,l,u){cs(!1,"interpolateProps is not implemented")}},{key:"getDuration",value:function(i,l){return l.transitionDuration}}]),r}();function L_(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(e&&e.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),Object.defineProperty(r,"prototype",{writable:!1}),e&&bg(r,e)}function k_(r,e){if(e&&(Sc(e)=="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return go(r)}function ha(r){return ha=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ha(r)}var nB={longitude:1,bearing:1};function np(r){return Number.isFinite(r)||Array.isArray(r)}function sB(r){return r in nB}function e_(r,e,i){return sB(r)&&Math.abs(i-e)>180&&(i=i<0?i+360:i-360),i}function yg(r,e){var i;if(typeof Symbol>"u"||r[Symbol.iterator]==null){if(Array.isArray(r)||(i=oB(r))||e){i&&(r=i);var l=0,u=function(){};return{s:u,n:function(){return l>=r.length?{done:!0}:{done:!1,value:r[l++]}},e:function(P){throw P},f:u}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var m=!0,y=!1,T;return{s:function(){i=r[Symbol.iterator]()},n:function(){var P=i.next();return m=P.done,P},e:function(P){y=!0,T=P},f:function(){try{!m&&i.return!=null&&i.return()}finally{if(y)throw T}}}}function oB(r,e){if(r){if(typeof r=="string")return Tb(r,e);var i=Object.prototype.toString.call(r).slice(8,-1);if(i==="Object"&&r.constructor&&(i=r.constructor.name),i==="Map"||i==="Set")return Array.from(r);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return Tb(r,e)}}function Tb(r,e){(e==null||e>r.length)&&(e=r.length);for(var i=0,l=new Array(e);i<e;i++)l[i]=r[i];return l}function aB(r){var e=lB();return function(){var l=ha(r),u;if(e){var m=ha(this).constructor;u=Reflect.construct(l,arguments,m)}else u=l.apply(this,arguments);return k_(this,u)}}function lB(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}var cB=["longitude","latitude","zoom","bearing","pitch"],uB=["latitude","longitude","zoom","width","height"],Eb=["bearing","pitch"],hB={speed:1.2,curve:1.414};(function(r){L_(i,r);var e=aB(i);function i(){var l,u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return fa(this,i),l=e.call(this),j(go(l),"propNames",cB),l.props=Object.assign({},hB,u),l}return da(i,[{key:"initializeProps",value:function(u,m){var y={},T={},a=yg(uB),P;try{for(a.s();!(P=a.n()).done;){var D=P.value,N=u[D],F=m[D];cs(np(N)&&np(F),"".concat(D," must be supplied for transition")),y[D]=N,T[D]=e_(D,N,F)}}catch(Ce){a.e(Ce)}finally{a.f()}var W=yg(Eb),oe;try{for(W.s();!(oe=W.n()).done;){var me=oe.value,fe=u[me]||0,Ee=m[me]||0;y[me]=fe,T[me]=e_(me,fe,Ee)}}catch(Ce){W.e(Ce)}finally{W.f()}return{start:y,end:T}}},{key:"interpolateProps",value:function(u,m,y){var T=$3(u,m,y,this.props),a=yg(Eb),P;try{for(a.s();!(P=a.n()).done;){var D=P.value;T[D]=rp(u[D],m[D],y)}}catch(N){a.e(N)}finally{a.f()}return T}},{key:"getDuration",value:function(u,m){var y=m.transitionDuration;return y==="auto"&&(y=W3(u,m,this.props)),y}}]),i})(iT);function Sb(r,e){var i;if(typeof Symbol>"u"||r[Symbol.iterator]==null){if(Array.isArray(r)||(i=fB(r))||e){i&&(r=i);var l=0,u=function(){};return{s:u,n:function(){return l>=r.length?{done:!0}:{done:!1,value:r[l++]}},e:function(P){throw P},f:u}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var m=!0,y=!1,T;return{s:function(){i=r[Symbol.iterator]()},n:function(){var P=i.next();return m=P.done,P},e:function(P){y=!0,T=P},f:function(){try{!m&&i.return!=null&&i.return()}finally{if(y)throw T}}}}function fB(r,e){if(r){if(typeof r=="string")return Ab(r,e);var i=Object.prototype.toString.call(r).slice(8,-1);if(i==="Object"&&r.constructor&&(i=r.constructor.name),i==="Map"||i==="Set")return Array.from(r);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return Ab(r,e)}}function Ab(r,e){(e==null||e>r.length)&&(e=r.length);for(var i=0,l=new Array(e);i<e;i++)l[i]=r[i];return l}function dB(r){var e=pB();return function(){var l=ha(r),u;if(e){var m=ha(this).constructor;u=Reflect.construct(l,arguments,m)}else u=l.apply(this,arguments);return k_(this,u)}}function pB(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}var mB=["longitude","latitude","zoom","bearing","pitch"],wh=function(r){L_(i,r);var e=dB(i);function i(){var l,u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return fa(this,i),l=e.call(this),Array.isArray(u)&&(u={transitionProps:u}),l.propNames=u.transitionProps||mB,u.around&&(l.around=u.around),l}return da(i,[{key:"initializeProps",value:function(u,m){var y={},T={};if(this.around){y.around=this.around;var a=new ll(u).unproject(this.around);Object.assign(T,m,{around:new ll(m).project(a),aroundLngLat:a})}var P=Sb(this.propNames),D;try{for(P.s();!(D=P.n()).done;){var N=D.value,F=u[N],W=m[N];cs(np(F)&&np(W),"".concat(N," must be supplied for transition")),y[N]=F,T[N]=e_(N,F,W)}}catch(oe){P.e(oe)}finally{P.f()}return{start:y,end:T}}},{key:"interpolateProps",value:function(u,m,y){var T={},a=Sb(this.propNames),P;try{for(a.s();!(P=a.n()).done;){var D=P.value;T[D]=rp(u[D],m[D],y)}}catch(me){a.e(me)}finally{a.f()}if(m.around){var N=new ll(Object.assign({},m,T)).getMapCenterByLngLatPosition({lngLat:m.aroundLngLat,pos:rp(u.around,m.around,y)}),F=ir(N,2),W=F[0],oe=F[1];T.longitude=W,T.latitude=oe}return T}}]),i}(iT),Th=function(){};function gB(r,e){var i=r(e);return function(l){return 1/(1-i)*(r(l*(1-e)+e)-i)}}var Eh={BREAK:1,SNAP_TO_END:2,IGNORE:3,UPDATE:4},_B={transitionDuration:0,transitionEasing:function(e){return e},transitionInterpolator:new wh,transitionInterruption:Eh.BREAK,onTransitionStart:Th,onTransitionInterrupt:Th,onTransitionEnd:Th},R_=function(){function r(){var e=this,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};fa(this,r),j(this,"_animationFrame",null),j(this,"_onTransitionFrame",function(){e._animationFrame=requestAnimationFrame(e._onTransitionFrame),e._updateViewport()}),this.props=null,this.onViewportChange=i.onViewportChange||Th,this.onStateChange=i.onStateChange||Th,this.time=i.getTime||Date.now}return da(r,[{key:"getViewportInTransition",value:function(){return this._animationFrame?this.state.propsInTransition:null}},{key:"processViewportChange",value:function(i){var l=this.props;if(this.props=i,!l||this._shouldIgnoreViewportChange(l,i))return!1;if(this._isTransitionEnabled(i)){var u=Object.assign({},l),m=Object.assign({},i);if(this._isTransitionInProgress()&&(l.onTransitionInterrupt(),this.state.interruption===Eh.SNAP_TO_END?Object.assign(u,this.state.endProps):Object.assign(u,this.state.propsInTransition),this.state.interruption===Eh.UPDATE)){var y=this.time(),T=(y-this.state.startTime)/this.state.duration;m.transitionDuration=this.state.duration-(y-this.state.startTime),m.transitionEasing=gB(this.state.easing,T),m.transitionInterpolator=u.transitionInterpolator}return m.onTransitionStart(),this._triggerTransition(u,m),!0}return this._isTransitionInProgress()&&(l.onTransitionInterrupt(),this._endTransition()),!1}},{key:"_isTransitionInProgress",value:function(){return!!this._animationFrame}},{key:"_isTransitionEnabled",value:function(i){var l=i.transitionDuration,u=i.transitionInterpolator;return(l>0||l==="auto")&&!!u}},{key:"_isUpdateDueToCurrentTransition",value:function(i){return this.state.propsInTransition?this.state.interpolator.arePropsEqual(i,this.state.propsInTransition):!1}},{key:"_shouldIgnoreViewportChange",value:function(i,l){return i?this._isTransitionInProgress()?this.state.interruption===Eh.IGNORE||this._isUpdateDueToCurrentTransition(l):this._isTransitionEnabled(l)?l.transitionInterpolator.arePropsEqual(i,l):!0:!0}},{key:"_triggerTransition",value:function(i,l){cs(this._isTransitionEnabled(l)),this._animationFrame&&cancelAnimationFrame(this._animationFrame);var u=l.transitionInterpolator,m=u.getDuration?u.getDuration(i,l):l.transitionDuration;if(m!==0){var y=l.transitionInterpolator.initializeProps(i,l),T={inTransition:!0,isZooming:i.zoom!==l.zoom,isPanning:i.longitude!==l.longitude||i.latitude!==l.latitude,isRotating:i.bearing!==l.bearing||i.pitch!==l.pitch};this.state={duration:m,easing:l.transitionEasing,interpolator:l.transitionInterpolator,interruption:l.transitionInterruption,startTime:this.time(),startProps:y.start,endProps:y.end,animation:null,propsInTransition:{}},this._onTransitionFrame(),this.onStateChange(T)}}},{key:"_endTransition",value:function(){this._animationFrame&&(cancelAnimationFrame(this._animationFrame),this._animationFrame=null),this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1})}},{key:"_updateViewport",value:function(){var i=this.time(),l=this.state,u=l.startTime,m=l.duration,y=l.easing,T=l.interpolator,a=l.startProps,P=l.endProps,D=!1,N=(i-u)/m;N>=1&&(N=1,D=!0),N=y(N);var F=T.interpolateProps(a,P,N),W=new Ec(Object.assign({},this.props,F));this.state.propsInTransition=W.getViewportProps(),this.onViewportChange(this.state.propsInTransition,this.props),D&&(this._endTransition(),this.props.onTransitionEnd())}}]),r}();j(R_,"defaultProps",_B);function Mb(r,e){var i=Object.keys(r);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(r);e&&(l=l.filter(function(u){return Object.getOwnPropertyDescriptor(r,u).enumerable})),i.push.apply(i,l)}return i}function Jr(r){for(var e=1;e<arguments.length;e++){var i=arguments[e]!=null?arguments[e]:{};e%2?Mb(Object(i),!0).forEach(function(l){j(r,l,i[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(i)):Mb(Object(i)).forEach(function(l){Object.defineProperty(r,l,Object.getOwnPropertyDescriptor(i,l))})}return r}var nl={transitionDuration:0},_o={transitionDuration:300,transitionEasing:function(e){return e},transitionInterpolator:new wh,transitionInterruption:Eh.BREAK},Ld=300,kd=function(e){return 1-(1-e)*(1-e)},_c={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},rT=function(){function r(){var e=this;fa(this,r),j(this,"events",[]),j(this,"scrollZoom",!0),j(this,"dragPan",!0),j(this,"dragRotate",!0),j(this,"doubleClickZoom",!0),j(this,"touchZoom",!0),j(this,"touchRotate",!1),j(this,"keyboard",!0),j(this,"_interactionState",{isDragging:!1}),j(this,"_events",{}),j(this,"_setInteractionState",function(i){Object.assign(e._interactionState,i),e.onStateChange&&e.onStateChange(e._interactionState)}),j(this,"_onTransition",function(i,l){e.onViewportChange(i,e._interactionState,l)}),this.handleEvent=this.handleEvent.bind(this),this._transitionManager=new R_({onViewportChange:this._onTransition,onStateChange:this._setInteractionState})}return da(r,[{key:"handleEvent",value:function(i){this.mapState=this.getMapState();var l=this._eventStartBlocked;switch(i.type){case"panstart":return l?!1:this._onPanStart(i);case"panmove":return this._onPan(i);case"panend":return this._onPanEnd(i);case"pinchstart":return l?!1:this._onPinchStart(i);case"pinchmove":return this._onPinch(i);case"pinchend":return this._onPinchEnd(i);case"tripanstart":return l?!1:this._onTriplePanStart(i);case"tripanmove":return this._onTriplePan(i);case"tripanend":return this._onTriplePanEnd(i);case"doubletap":return this._onDoubleTap(i);case"wheel":return this._onWheel(i);case"keydown":return this._onKeyDown(i);default:return!1}}},{key:"getCenter",value:function(i){var l=i.offsetCenter,u=l.x,m=l.y;return[u,m]}},{key:"isFunctionKeyPressed",value:function(i){var l=i.srcEvent;return!!(l.metaKey||l.altKey||l.ctrlKey||l.shiftKey)}},{key:"blockEvents",value:function(i){var l=this,u=setTimeout(function(){l._eventStartBlocked===u&&(l._eventStartBlocked=null)},i);this._eventStartBlocked=u}},{key:"updateViewport",value:function(i,l,u){var m=this.mapState instanceof Ec?this.mapState.getViewportProps():this.mapState,y=Jr(Jr({},i.getViewportProps()),l),T=Object.keys(y).some(function(a){return m[a]!==y[a]});this._state=i.getState(),this._setInteractionState(u),T&&this.onViewportChange(y,this._interactionState,m)}},{key:"getMapState",value:function(i){return new Ec(Jr(Jr(Jr({},this.mapStateProps),this._state),i))}},{key:"isDragging",value:function(){return this._interactionState.isDragging}},{key:"setOptions",value:function(i){var l=i.onViewportChange,u=i.onStateChange,m=i.eventManager,y=m===void 0?this.eventManager:m,T=i.isInteractive,a=T===void 0?!0:T,P=i.scrollZoom,D=P===void 0?this.scrollZoom:P,N=i.dragPan,F=N===void 0?this.dragPan:N,W=i.dragRotate,oe=W===void 0?this.dragRotate:W,me=i.doubleClickZoom,fe=me===void 0?this.doubleClickZoom:me,Ee=i.touchZoom,Ce=Ee===void 0?this.touchZoom:Ee,ke=i.touchRotate,$e=ke===void 0?this.touchRotate:ke,Ve=i.keyboard,Re=Ve===void 0?this.keyboard:Ve;this.onViewportChange=l,this.onStateChange=u;var ot=this.mapStateProps||{},bt=ot.height!==i.height||ot.width!==i.width;this.mapStateProps=i,bt&&(this.mapState=ot,this.updateViewport(new Ec(i))),this._transitionManager.processViewportChange(i),this.eventManager!==y&&(this.eventManager=y,this._events={},this.toggleEvents(this.events,!0)),this.toggleEvents(_c.WHEEL,a&&!!D),this.toggleEvents(_c.PAN,a&&!!(F||oe)),this.toggleEvents(_c.PINCH,a&&!!(Ce||$e)),this.toggleEvents(_c.TRIPLE_PAN,a&&!!$e),this.toggleEvents(_c.DOUBLE_TAP,a&&!!fe),this.toggleEvents(_c.KEYBOARD,a&&!!Re),this.scrollZoom=D,this.dragPan=F,this.dragRotate=oe,this.doubleClickZoom=fe,this.touchZoom=Ce,this.touchRotate=$e,this.keyboard=Re}},{key:"toggleEvents",value:function(i,l){var u=this;this.eventManager&&i.forEach(function(m){u._events[m]!==l&&(u._events[m]=l,l?u.eventManager.on(m,u.handleEvent):u.eventManager.off(m,u.handleEvent))})}},{key:"_onPanStart",value:function(i){var l=this.getCenter(i);this._panRotate=this.isFunctionKeyPressed(i)||i.rightButton;var u=this._panRotate?this.mapState.rotateStart({pos:l}):this.mapState.panStart({pos:l});return this.updateViewport(u,nl,{isDragging:!0}),!0}},{key:"_onPan",value:function(i){return this.isDragging()?this._panRotate?this._onPanRotate(i):this._onPanMove(i):!1}},{key:"_onPanEnd",value:function(i){return this.isDragging()?this._panRotate?this._onPanRotateEnd(i):this._onPanMoveEnd(i):!1}},{key:"_onPanMove",value:function(i){if(!this.dragPan)return!1;var l=this.getCenter(i),u=this.mapState.pan({pos:l});return this.updateViewport(u,nl,{isPanning:!0}),!0}},{key:"_onPanMoveEnd",value:function(i){if(this.dragPan){var l=this.dragPan.inertia,u=l===void 0?Ld:l;if(u&&i.velocity){var m=this.getCenter(i),y=[m[0]+i.velocityX*u/2,m[1]+i.velocityY*u/2],T=this.mapState.pan({pos:y}).panEnd();return this.updateViewport(T,Jr(Jr({},_o),{},{transitionDuration:u,transitionEasing:kd}),{isDragging:!1,isPanning:!0}),!0}}var a=this.mapState.panEnd();return this.updateViewport(a,null,{isDragging:!1,isPanning:!1}),!0}},{key:"_onPanRotate",value:function(i){if(!this.dragRotate)return!1;var l=this.getCenter(i),u=this.mapState.rotate({pos:l});return this.updateViewport(u,nl,{isRotating:!0}),!0}},{key:"_onPanRotateEnd",value:function(i){if(this.dragRotate){var l=this.dragRotate.inertia,u=l===void 0?Ld:l;if(u&&i.velocity){var m=this.getCenter(i),y=[m[0]+i.velocityX*u/2,m[1]+i.velocityY*u/2],T=this.mapState.rotate({pos:y}).rotateEnd();return this.updateViewport(T,Jr(Jr({},_o),{},{transitionDuration:u,transitionEasing:kd}),{isDragging:!1,isRotating:!0}),!0}}var a=this.mapState.panEnd();return this.updateViewport(a,null,{isDragging:!1,isRotating:!1}),!0}},{key:"_onWheel",value:function(i){if(!this.scrollZoom)return!1;var l=this.scrollZoom,u=l.speed,m=u===void 0?.01:u,y=l.smooth,T=y===void 0?!1:y;i.preventDefault();var a=this.getCenter(i),P=i.delta,D=2/(1+Math.exp(-Math.abs(P*m)));P<0&&D!==0&&(D=1/D);var N=this.mapState.zoom({pos:a,scale:D});return N.getViewportProps().zoom===this.mapStateProps.zoom?!1:(this.updateViewport(N,Jr(Jr({},_o),{},{transitionInterpolator:new wh({around:a}),transitionDuration:T?250:1}),{isPanning:!0,isZooming:!0}),!0)}},{key:"_onPinchStart",value:function(i){var l=this.getCenter(i),u=this.mapState.zoomStart({pos:l}).rotateStart({pos:l});return this._startPinchRotation=i.rotation,this._lastPinchEvent=i,this.updateViewport(u,nl,{isDragging:!0}),!0}},{key:"_onPinch",value:function(i){if(!this.isDragging()||!this.touchZoom&&!this.touchRotate)return!1;var l=this.mapState;if(this.touchZoom){var u=i.scale,m=this.getCenter(i);l=l.zoom({pos:m,scale:u})}if(this.touchRotate){var y=i.rotation;l=l.rotate({deltaAngleX:this._startPinchRotation-y})}return this.updateViewport(l,nl,{isDragging:!0,isPanning:!!this.touchZoom,isZooming:!!this.touchZoom,isRotating:!!this.touchRotate}),this._lastPinchEvent=i,!0}},{key:"_onPinchEnd",value:function(i){if(!this.isDragging())return!1;if(this.touchZoom){var l=this.touchZoom.inertia,u=l===void 0?Ld:l,m=this._lastPinchEvent;if(u&&m&&i.scale!==m.scale){var y=this.getCenter(i),T=this.mapState.rotateEnd(),a=Math.log2(i.scale),P=(a-Math.log2(m.scale))/(i.deltaTime-m.deltaTime),D=Math.pow(2,a+P*u/2);return T=T.zoom({pos:y,scale:D}).zoomEnd(),this.updateViewport(T,Jr(Jr({},_o),{},{transitionInterpolator:new wh({around:y}),transitionDuration:u,transitionEasing:kd}),{isDragging:!1,isPanning:!!this.touchZoom,isZooming:!!this.touchZoom,isRotating:!1}),this.blockEvents(u),!0}}var N=this.mapState.zoomEnd().rotateEnd();return this._state.startPinchRotation=0,this.updateViewport(N,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1}),this._startPinchRotation=null,this._lastPinchEvent=null,!0}},{key:"_onTriplePanStart",value:function(i){var l=this.getCenter(i),u=this.mapState.rotateStart({pos:l});return this.updateViewport(u,nl,{isDragging:!0}),!0}},{key:"_onTriplePan",value:function(i){if(!this.isDragging()||!this.touchRotate)return!1;var l=this.getCenter(i);l[0]-=i.deltaX;var u=this.mapState.rotate({pos:l});return this.updateViewport(u,nl,{isRotating:!0}),!0}},{key:"_onTriplePanEnd",value:function(i){if(!this.isDragging())return!1;if(this.touchRotate){var l=this.touchRotate.inertia,u=l===void 0?Ld:l;if(u&&i.velocityY){var m=this.getCenter(i),y=[m[0],m[1]+=i.velocityY*u/2],T=this.mapState.rotate({pos:y});return this.updateViewport(T,Jr(Jr({},_o),{},{transitionDuration:u,transitionEasing:kd}),{isDragging:!1,isRotating:!0}),this.blockEvents(u),!1}}var a=this.mapState.rotateEnd();return this.updateViewport(a,null,{isDragging:!1,isRotating:!1}),!0}},{key:"_onDoubleTap",value:function(i){if(!this.doubleClickZoom)return!1;var l=this.getCenter(i),u=this.isFunctionKeyPressed(i),m=this.mapState.zoom({pos:l,scale:u?.5:2});return this.updateViewport(m,Object.assign({},_o,{transitionInterpolator:new wh({around:l})}),{isZooming:!0}),!0}},{key:"_onKeyDown",value:function(i){if(!this.keyboard)return!1;var l=this.isFunctionKeyPressed(i),u=this.keyboard,m=u.zoomSpeed,y=m===void 0?2:m,T=u.moveSpeed,a=T===void 0?100:T,P=u.rotateSpeedX,D=P===void 0?15:P,N=u.rotateSpeedY,F=N===void 0?10:N,W=this.mapStateProps,oe;switch(i.srcEvent.keyCode){case 189:l?oe=this.getMapState({zoom:W.zoom-Math.log2(y)-1}):oe=this.getMapState({zoom:W.zoom-Math.log2(y)});break;case 187:l?oe=this.getMapState({zoom:W.zoom+Math.log2(y)+1}):oe=this.getMapState({zoom:W.zoom+Math.log2(y)});break;case 37:l?oe=this.getMapState({bearing:W.bearing-D}):oe=this.mapState.pan({pos:[a,0],startPos:[0,0]});break;case 39:l?oe=this.getMapState({bearing:W.bearing+D}):oe=this.mapState.pan({pos:[-a,0],startPos:[0,0]});break;case 38:l?oe=this.getMapState({pitch:W.pitch+F}):oe=this.mapState.pan({pos:[0,a],startPos:[0,0]});break;case 40:l?oe=this.getMapState({pitch:W.pitch-F}):oe=this.mapState.pan({pos:[0,-a],startPos:[0,0]});break;default:return!1}return this.updateViewport(oe,_o)}}]),r}();function Pb(r,e){var i=Object.keys(r);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(r);e&&(l=l.filter(function(u){return Object.getOwnPropertyDescriptor(r,u).enumerable})),i.push.apply(i,l)}return i}function mo(r){for(var e=1;e<arguments.length;e++){var i=arguments[e]!=null?arguments[e]:{};e%2?Pb(Object(i),!0).forEach(function(l){j(r,l,i[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(i)):Pb(Object(i)).forEach(function(l){Object.defineProperty(r,l,Object.getOwnPropertyDescriptor(i,l))})}return r}var yB=Object.assign({},pa.propTypes,{maxZoom:Pe.number,minZoom:Pe.number,maxPitch:Pe.number,minPitch:Pe.number,onViewStateChange:Pe.func,onViewportChange:Pe.func,onInteractionStateChange:Pe.func,transitionDuration:Pe.oneOfType([Pe.number,Pe.string]),transitionInterpolator:Pe.object,transitionInterruption:Pe.number,transitionEasing:Pe.func,onTransitionStart:Pe.func,onTransitionInterrupt:Pe.func,onTransitionEnd:Pe.func,scrollZoom:Pe.oneOfType([Pe.bool,Pe.object]),dragPan:Pe.oneOfType([Pe.bool,Pe.object]),dragRotate:Pe.oneOfType([Pe.bool,Pe.object]),doubleClickZoom:Pe.bool,touchZoom:Pe.oneOfType([Pe.bool,Pe.object]),touchRotate:Pe.oneOfType([Pe.bool,Pe.object]),keyboard:Pe.oneOfType([Pe.bool,Pe.object]),onHover:Pe.func,onClick:Pe.func,onDblClick:Pe.func,onContextMenu:Pe.func,onMouseDown:Pe.func,onMouseMove:Pe.func,onMouseUp:Pe.func,onTouchStart:Pe.func,onTouchMove:Pe.func,onTouchEnd:Pe.func,onMouseEnter:Pe.func,onMouseLeave:Pe.func,onMouseOut:Pe.func,onWheel:Pe.func,touchAction:Pe.string,eventRecognizerOptions:Pe.object,clickRadius:Pe.number,interactiveLayerIds:Pe.array,getCursor:Pe.func,controller:Pe.instanceOf(rT)}),vB=function(e){var i=e.isDragging,l=e.isHovering;return i?"grabbing":l?"pointer":"grab"},xB=Object.assign({},pa.defaultProps,al,R_.defaultProps,{onViewStateChange:null,onViewportChange:null,onClick:null,onNativeClick:null,onHover:null,onContextMenu:function(e){return e.preventDefault()},scrollZoom:!0,dragPan:!0,dragRotate:!0,doubleClickZoom:!0,touchZoom:!0,touchRotate:!1,keyboard:!0,touchAction:"none",eventRecognizerOptions:{},clickRadius:0,getCursor:vB});function O_(r){if(r.lngLat||!r.offsetCenter)return r;var e=r.offsetCenter,i=e.x,l=e.y;if(!Number.isFinite(i)||!Number.isFinite(l))return r;var u=[i,l];if(r.point=u,this.map){var m=this.map.unproject(u);r.lngLat=[m.lng,m.lat]}return r}function nT(r){var e=this.map;if(!e||!r)return null;var i={},l=this.props.clickRadius;this.props.interactiveLayerIds&&(i.layers=this.props.interactiveLayerIds);try{return e.queryRenderedFeatures(l?[[r[0]-l,r[1]+l],[r[0]+l,r[1]-l]]:r,i)}catch{return null}}function xo(r,e){var i=this.props[r];i&&i(O_.call(this,e))}function bB(r){xo.call(this,r.pointerType==="touch"?"onTouchStart":"onMouseDown",r)}function wB(r){xo.call(this,r.pointerType==="touch"?"onTouchEnd":"onMouseUp",r)}function TB(r){if(xo.call(this,r.pointerType==="touch"?"onTouchMove":"onMouseMove",r),!this.state.isDragging){var e=this.props,i=e.onHover,l=e.interactiveLayerIds,u;r=O_.call(this,r),(l||i)&&(u=nT.call(this,r.point));var m=!!(l&&u&&u.length>0),y=m&&!this.state.isHovering,T=!m&&this.state.isHovering;(i||y)&&(r.features=u,i&&i(r)),y&&xo.call(this,"onMouseEnter",r),T&&xo.call(this,"onMouseLeave",r),(y||T)&&this.setState({isHovering:m})}}function Ib(r){var e=this.props,i=e.onClick,l=e.onNativeClick,u=e.onDblClick,m=e.doubleClickZoom,y=[],T=u||m;switch(r.type){case"anyclick":y.push(l),T||y.push(i);break;case"click":T&&y.push(i);break}y=y.filter(Boolean),y.length&&(r=O_.call(this,r),r.features=nT.call(this,r.point),y.forEach(function(a){return a(r)}))}function EB(r){return{getMap:r.current&&r.current.getMap,queryRenderedFeatures:r.current&&r.current.queryRenderedFeatures}}var D_=je.forwardRef(function(r,e){var i=je.useContext(Fc),l=je.useMemo(function(){return r.controller||new rT},[]),u=je.useMemo(function(){return new Dw(null,{touchAction:r.touchAction,recognizerOptions:r.eventRecognizerOptions})},[]),m=je.useRef(null),y=je.useRef(null),T=je.useRef({width:0,height:0,state:{isHovering:!1,isDragging:!1}}),a=T.current;a.props=r,a.map=y.current&&y.current.getMap(),a.setState=function(Re){a.state=mo(mo({},a.state),Re),m.current.style.cursor=r.getCursor(a.state)};var P=!0,D,N,F=function(ot,bt,mt){if(P){D=[ot,bt,mt];return}var Mt=a.props,gt=Mt.onViewStateChange,Ht=Mt.onViewportChange;Object.defineProperty(ot,"position",{get:function(){return[0,0,gp(a.map,ot)]}}),gt&&gt({viewState:ot,interactionState:bt,oldViewState:mt}),Ht&&Ht(ot,bt,mt)};je.useImperativeHandle(e,function(){return EB(y)},[]);var W=je.useMemo(function(){return mo(mo({},i),{},{eventManager:u,container:i.container||m.current})},[i,m.current]);W.onViewportChange=F,W.viewport=i.viewport||tT(a),a.viewport=W.viewport;var oe=function(ot){var bt=ot.isDragging,mt=bt===void 0?!1:bt;if(mt!==a.state.isDragging&&a.setState({isDragging:mt}),P){N=ot;return}var Mt=a.props.onInteractionStateChange;Mt&&Mt(ot)},me=function(){a.width&&a.height&&l.setOptions(mo(mo(mo({},a.props),a.props.viewState),{},{isInteractive:!!(a.props.onViewStateChange||a.props.onViewportChange),onViewportChange:F,onStateChange:oe,eventManager:u,width:a.width,height:a.height}))},fe=function(ot){var bt=ot.width,mt=ot.height;a.width=bt,a.height=mt,me(),a.props.onResize({width:bt,height:mt})};je.useEffect(function(){return u.setElement(m.current),u.on({pointerdown:bB.bind(a),pointermove:TB.bind(a),pointerup:wB.bind(a),pointerleave:xo.bind(a,"onMouseOut"),click:Ib.bind(a),anyclick:Ib.bind(a),dblclick:xo.bind(a,"onDblClick"),wheel:xo.bind(a,"onWheel"),contextmenu:xo.bind(a,"onContextMenu")}),function(){u.destroy()}},[]),Qg(function(){D&&F.apply(void 0,Rz(D)),N&&oe(N)}),me();var Ee=r.width,Ce=r.height,ke=r.style,$e=r.getCursor,Ve=je.useMemo(function(){return mo(mo({position:"relative"},ke),{},{width:Ee,height:Ce,cursor:$e(a.state)})},[ke,Ee,Ce,$e,a.state]);return(!D||!a._child)&&(a._child=je.createElement(C_,{value:W},je.createElement("div",{key:"event-canvas",ref:m,style:Ve},je.createElement(pa,Vb({},r,{width:"100%",height:"100%",style:null,onResize:fe,ref:y}))))),P=!1,a._child});D_.supported=pa.supported;D_.propTypes=yB;D_.defaultProps=xB;Pe.string.isRequired,Pe.string;var SB=["fill","line","symbol","circle","fill-extrusion","raster","background","heatmap","hillshade","sky"];Pe.oneOf(SB).isRequired,Pe.string,Pe.string,Pe.string;var ma={captureScroll:!1,captureDrag:!0,captureClick:!0,captureDoubleClick:!0,capturePointerMove:!1},fs={captureScroll:Pe.bool,captureDrag:Pe.bool,captureClick:Pe.bool,captureDoubleClick:Pe.bool,capturePointerMove:Pe.bool};function AB(r){var e=r.containerRef.current,i=r.context.eventManager;if(!(!e||!i)){var l={wheel:function(m){var y=r.props;y.captureScroll&&m.stopPropagation(),y.onScroll&&y.onScroll(m,r)},panstart:function(m){var y=r.props;y.captureDrag&&m.stopPropagation(),y.onDragStart&&y.onDragStart(m,r)},anyclick:function(m){var y=r.props;y.captureClick&&m.stopPropagation(),y.onNativeClick&&y.onNativeClick(m,r)},click:function(m){var y=r.props;y.captureClick&&m.stopPropagation(),y.onClick&&y.onClick(m,r)},dblclick:function(m){var y=r.props;y.captureDoubleClick&&m.stopPropagation(),y.onDoubleClick&&y.onDoubleClick(m,r)},pointermove:function(m){var y=r.props;y.capturePointerMove&&m.stopPropagation(),y.onPointerMove&&y.onPointerMove(m,r)}};return i.watch(l,e),function(){i.off(l)}}}function ga(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=je.useContext(Fc),i=je.useRef(null),l=je.useRef({props:r,state:{},context:e,containerRef:i}),u=l.current;return u.props=r,u.context=e,je.useEffect(function(){return AB(u)},[e.eventManager]),u}function MB(r){var e=PB();return function(){var l=ha(r),u;if(e){var m=ha(this).constructor;u=Reflect.construct(l,arguments,m)}else u=l.apply(this,arguments);return k_(this,u)}}function PB(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function IB(r){var e=r.instance,i=ga(r),l=i.context,u=i.containerRef;return e._context=l,e._containerRef=u,e._render()}var sT=function(r){L_(i,r);var e=MB(i);function i(){var l;fa(this,i);for(var u=arguments.length,m=new Array(u),y=0;y<u;y++)m[y]=arguments[y];return l=e.call.apply(e,[this].concat(m)),j(go(l),"_context",{}),j(go(l),"_containerRef",je.createRef()),j(go(l),"_onScroll",function(T){}),j(go(l),"_onDragStart",function(T){}),j(go(l),"_onDblClick",function(T){}),j(go(l),"_onClick",function(T){}),j(go(l),"_onPointerMove",function(T){}),l}return da(i,[{key:"_render",value:function(){throw new Error("_render() not implemented")}},{key:"render",value:function(){return je.createElement(IB,Vb({instance:this},this.props,{onScroll:this._onScroll,onDragStart:this._onDragStart,onDblClick:this._onDblClick,onClick:this._onClick,onPointerMove:this._onPointerMove}))}}]),i}(je.PureComponent);j(sT,"propTypes",fs);j(sT,"defaultProps",ma);function Cb(r,e){var i=Object.keys(r);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(r);e&&(l=l.filter(function(u){return Object.getOwnPropertyDescriptor(r,u).enumerable})),i.push.apply(i,l)}return i}function Lb(r){for(var e=1;e<arguments.length;e++){var i=arguments[e]!=null?arguments[e]:{};e%2?Cb(Object(i),!0).forEach(function(l){j(r,l,i[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(i)):Cb(Object(i)).forEach(function(l){Object.defineProperty(r,l,Object.getOwnPropertyDescriptor(i,l))})}return r}var CB=Object.assign({},fs,{draggable:Pe.bool,onDrag:Pe.func,onDragEnd:Pe.func,onDragStart:Pe.func,offsetLeft:Pe.number,offsetTop:Pe.number}),LB=Object.assign({},ma,{draggable:!1,offsetLeft:0,offsetTop:0});function oT(r){var e=r.offsetCenter,i=e.x,l=e.y;return[i,l]}function kB(r,e){var i=r.center,l=i.x,u=i.y;if(e){var m=e.getBoundingClientRect();return[m.left-l,m.top-u]}return null}function z_(r,e,i,l){var u=r[0]+e[0]-i.offsetLeft,m=r[1]+e[1]-i.offsetTop;return l.viewport.unproject([u,m])}function RB(r,e){var i=e.props,l=e.callbacks,u=e.state,m=e.context,y=e.containerRef,T=i.draggable;if(T){r.stopPropagation();var a=oT(r),P=kB(r,y.current);if(u.setDragPos(a),u.setDragOffset(P),l.onDragStart&&P){var D=Object.assign({},r);D.lngLat=z_(a,P,i,m),l.onDragStart(D)}}}function OB(r,e){var i=e.props,l=e.callbacks,u=e.state,m=e.context;r.stopPropagation();var y=oT(r);u.setDragPos(y);var T=u.dragOffset;if(l.onDrag&&T){var a=Object.assign({},r);a.lngLat=z_(y,T,i,m),l.onDrag(a)}}function DB(r,e){var i=e.props,l=e.callbacks,u=e.state,m=e.context;r.stopPropagation();var y=u.dragPos,T=u.dragOffset;if(u.setDragPos(null),u.setDragOffset(null),l.onDragEnd&&y&&T){var a=Object.assign({},r);a.lngLat=z_(y,T,i,m),l.onDragEnd(a)}}function zB(r,e){var i=e.state;r.stopPropagation(),i.setDragPos(null),i.setDragOffset(null)}function BB(r){var e=r.context.eventManager;if(!(!e||!r.state.dragPos)){var i={panmove:function(u){return OB(u,r)},panend:function(u){return DB(u,r)},pancancel:function(u){return zB(u,r)}};return e.watch(i),function(){e.off(i)}}}function FB(r){var e=je.useState(null),i=ir(e,2),l=i[0],u=i[1],m=je.useState(null),y=ir(m,2),T=y[0],a=y[1],P=ga(Lb(Lb({},r),{},{onDragStart:RB}));return P.callbacks=r,P.state.dragPos=l,P.state.setDragPos=u,P.state.dragOffset=T,P.state.setDragOffset=a,je.useEffect(function(){return BB(P)},[P.context.eventManager,!!l]),P}var kb=typeof window<"u"&&window.devicePixelRatio||1,kh=function(e){return Math.round(e*kb)/kb},Rb=function(e,i){var l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"x";if(e===null)return i;var u=l==="x"?e.offsetWidth:e.offsetHeight;return kh(i/100*u)/u*100};function Ob(r,e){var i=Object.keys(r);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(r);e&&(l=l.filter(function(u){return Object.getOwnPropertyDescriptor(r,u).enumerable})),i.push.apply(i,l)}return i}function NB(r){for(var e=1;e<arguments.length;e++){var i=arguments[e]!=null?arguments[e]:{};e%2?Ob(Object(i),!0).forEach(function(l){j(r,l,i[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(i)):Ob(Object(i)).forEach(function(l){Object.defineProperty(r,l,Object.getOwnPropertyDescriptor(i,l))})}return r}var UB=Object.assign({},CB,{className:Pe.string,longitude:Pe.number.isRequired,latitude:Pe.number.isRequired,style:Pe.object}),jB=Object.assign({},LB,{className:""});function VB(r){var e=r.props,i=r.state,l=r.context,u=e.longitude,m=e.latitude,y=e.offsetLeft,T=e.offsetTop,a=i.dragPos,P=i.dragOffset,D=l.viewport,N=l.map;if(a&&P)return[a[0]+P[0],a[1]+P[1]];var F=gp(N,{longitude:u,latitude:m}),W=D.project([u,m,F]),oe=ir(W,2),me=oe[0],fe=oe[1];return me+=y,fe+=T,[me,fe]}function B_(r){var e=FB(r),i=e.state,l=e.containerRef,u=r.children,m=r.className,y=r.draggable,T=r.style,a=i.dragPos,P=VB(e),D=ir(P,2),N=D[0],F=D[1],W="translate(".concat(kh(N),"px, ").concat(kh(F),"px)"),oe=y?a?"grabbing":"grab":"auto",me=je.useMemo(function(){var Ee=NB({position:"absolute",left:0,top:0,transform:W,cursor:oe},T);return je.createElement("div",{className:"mapboxgl-marker ".concat(m),ref:e.containerRef,style:Ee},u)},[u,m]),fe=l.current;return fe&&(fe.style.transform=W,fe.style.cursor=oe),me}B_.defaultProps=jB;B_.propTypes=UB;je.memo(B_);var Rh={top:{x:.5,y:0},"top-left":{x:0,y:0},"top-right":{x:1,y:0},bottom:{x:.5,y:1},"bottom-left":{x:0,y:1},"bottom-right":{x:1,y:1},left:{x:0,y:.5},right:{x:1,y:.5}},GB=Object.keys(Rh);function ZB(r){var e=r.x,i=r.y,l=r.width,u=r.height,m=r.selfWidth,y=r.selfHeight,T=r.anchor,a=r.padding,P=a===void 0?0:a,D=Rh[T],N=D.x,F=D.y,W=i-F*y,oe=W+y,me=Math.max(0,P-W)+Math.max(0,oe-u+P);if(me>0){var fe=F,Ee=me;for(F=0;F<=1;F+=.5)W=i-F*y,oe=W+y,me=Math.max(0,P-W)+Math.max(0,oe-u+P),me<Ee&&(Ee=me,fe=F);F=fe}var Ce=.5;F===.5&&(N=Math.floor(N),Ce=1);var ke=e-N*m,$e=ke+m,Ve=Math.max(0,P-ke)+Math.max(0,$e-l+P);if(Ve>0){var Re=N,ot=Ve;for(N=0;N<=1;N+=Ce)ke=e-N*m,$e=ke+m,Ve=Math.max(0,P-ke)+Math.max(0,$e-l+P),Ve<ot&&(ot=Ve,Re=N);N=Re}return GB.find(function(bt){var mt=Rh[bt];return mt.x===N&&mt.y===F})||T}var $B=Object.assign({},fs,{className:Pe.string,longitude:Pe.number.isRequired,latitude:Pe.number.isRequired,altitude:Pe.number,offsetLeft:Pe.number,offsetTop:Pe.number,tipSize:Pe.number,closeButton:Pe.bool,closeOnClick:Pe.bool,anchor:Pe.oneOf(Object.keys(Rh)),dynamicPosition:Pe.bool,sortByDepth:Pe.bool,onClose:Pe.func}),WB=Object.assign({},ma,{className:"",offsetLeft:0,offsetTop:0,tipSize:10,anchor:"bottom",dynamicPosition:!0,sortByDepth:!1,closeButton:!0,closeOnClick:!0,onClose:function(){}});function qB(r,e,i,l){var u=ir(l,2),m=u[0],y=u[1],T=r.anchor,a=r.dynamicPosition,P=r.tipSize;return i&&a?ZB({x:m,y,anchor:T,padding:P,width:e.width,height:e.height,selfWidth:i.clientWidth,selfHeight:i.clientHeight}):T}function XB(r,e,i,l,u){var m=ir(l,3),y=m[0],T=m[1],a=m[2],P=r.offsetLeft,D=r.offsetTop,N=r.sortByDepth,F=Rh[u],W=y+P,oe=T+D,me=Rb(i,-F.x*100),fe=Rb(i,-F.y*100,"y"),Ee={position:"absolute",transform:`
      translate(`.concat(me,"%, ").concat(fe,`%)
      translate(`).concat(kh(W),"px, ").concat(kh(oe),`px)
    `),display:void 0,zIndex:void 0};return N&&(a>1||a<-1||y<0||y>e.width||T<0||T>e.height?Ee.display="none":Ee.zIndex=Math.floor((1-a)/2*1e5)),Ee}function F_(r){var e=je.useRef(null),i=ga(r),l=i.context,u=i.containerRef,m=je.useState(!1),y=ir(m,2),T=y[1];je.useEffect(function(){T(!0)},[e.current]),je.useEffect(function(){if(l.eventManager&&r.closeOnClick){var Ve=function(){return i.props.onClose()};return l.eventManager.on("anyclick",Ve),function(){l.eventManager.off("anyclick",Ve)}}},[l.eventManager,r.closeOnClick]);var a=l.viewport,P=l.map,D=r.className,N=r.longitude,F=r.latitude,W=r.tipSize,oe=r.closeButton,me=r.children,fe=r.altitude;fe===void 0&&(fe=gp(P,{longitude:N,latitude:F}));var Ee=a.project([N,F,fe]),Ce=qB(r,a,e.current,Ee),ke=XB(r,a,u.current,Ee,Ce),$e=je.useCallback(function(Ve){i.props.onClose();var Re=i.context.eventManager;Re&&Re.once("click",function(ot){return ot.stopPropagation()},Ve.target)},[]);return je.createElement("div",{className:"mapboxgl-popup mapboxgl-popup-anchor-".concat(Ce," ").concat(D),style:ke,ref:u},je.createElement("div",{key:"tip",className:"mapboxgl-popup-tip",style:{borderWidth:W}}),je.createElement("div",{key:"content",ref:e,className:"mapboxgl-popup-content"},oe&&je.createElement("button",{key:"close-button",className:"mapboxgl-popup-close-button",type:"button",onClick:$e},"×"),me))}F_.propTypes=$B;F_.defaultProps=WB;je.memo(F_);function Db(r,e){var i=Object.keys(r);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(r);e&&(l=l.filter(function(u){return Object.getOwnPropertyDescriptor(r,u).enumerable})),i.push.apply(i,l)}return i}function HB(r){for(var e=1;e<arguments.length;e++){var i=arguments[e]!=null?arguments[e]:{};e%2?Db(Object(i),!0).forEach(function(l){j(r,l,i[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(i)):Db(Object(i)).forEach(function(l){Object.defineProperty(r,l,Object.getOwnPropertyDescriptor(i,l))})}return r}var YB=Object.assign({},fs,{toggleLabel:Pe.string,className:Pe.string,style:Pe.object,compact:Pe.bool,customAttribution:Pe.oneOfType([Pe.string,Pe.arrayOf(Pe.string)])}),KB=Object.assign({},ma,{className:"",toggleLabel:"Toggle Attribution"});function JB(r,e,i,l){var u=new Vs.AttributionControl(r);return u._map=e,u._container=i,u._innerContainer=l,u._updateAttributions(),u._updateEditLink(),e.on("styledata",u._updateData),e.on("sourcedata",u._updateData),u}function QB(r){r._map.off("styledata",r._updateData),r._map.off("sourcedata",r._updateData)}function N_(r){var e=ga(r),i=e.context,l=e.containerRef,u=je.useRef(null),m=je.useState(!1),y=ir(m,2),T=y[0],a=y[1];je.useEffect(function(){var F;return i.map&&(F=JB({customAttribution:r.customAttribution},i.map,l.current,u.current)),function(){return F&&QB(F)}},[i.map]);var P=r.compact===void 0?i.viewport.width<=640:r.compact;je.useEffect(function(){!P&&T&&a(!1)},[P]);var D=je.useCallback(function(){return a(function(F){return!F})},[]),N=je.useMemo(function(){return HB({position:"absolute"},r.style)},[r.style]);return je.createElement("div",{style:N,className:r.className},je.createElement("div",{ref:l,"aria-pressed":T,className:"mapboxgl-ctrl mapboxgl-ctrl-attrib ".concat(P?"mapboxgl-compact":""," ").concat(T?"mapboxgl-compact-show":"")},je.createElement("button",{type:"button",className:"mapboxgl-ctrl-attrib-button",title:r.toggleLabel,onClick:D}),je.createElement("div",{ref:u,className:"mapboxgl-ctrl-attrib-inner",role:"list"})))}N_.propTypes=YB;N_.defaultProps=KB;je.memo(N_);function zb(r,e){var i=Object.keys(r);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(r);e&&(l=l.filter(function(u){return Object.getOwnPropertyDescriptor(r,u).enumerable})),i.push.apply(i,l)}return i}function eF(r){for(var e=1;e<arguments.length;e++){var i=arguments[e]!=null?arguments[e]:{};e%2?zb(Object(i),!0).forEach(function(l){j(r,l,i[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(i)):zb(Object(i)).forEach(function(l){Object.defineProperty(r,l,Object.getOwnPropertyDescriptor(i,l))})}return r}var tF=Object.assign({},fs,{className:Pe.string,style:Pe.object,container:Pe.object,label:Pe.string}),iF=Object.assign({},ma,{className:"",container:null,label:"Toggle fullscreen"});function U_(r){var e=ga(r),i=e.context,l=e.containerRef,u=je.useState(!1),m=ir(u,2),y=m[0],T=m[1],a=je.useState(!1),P=ir(a,2),D=P[0],N=P[1],F=je.useState(null),W=ir(F,2),oe=W[0],me=W[1];je.useEffect(function(){var Ve=new Vs.FullscreenControl;me(Ve),N(Ve._checkFullscreenSupport());var Re=function(){var bt=!Ve._fullscreen;Ve._fullscreen=bt,T(bt)};return vo.addEventListener(Ve._fullscreenchange,Re),function(){vo.removeEventListener(Ve._fullscreenchange,Re)}},[]);var fe=function(){oe&&(oe._container=r.container||i.container,oe._onClickFullscreen())},Ee=je.useMemo(function(){return eF({position:"absolute"},r.style)},[r.style]);if(!D)return null;var Ce=r.className,ke=r.label,$e=y?"shrink":"fullscreen";return je.createElement("div",{style:Ee,className:Ce},je.createElement("div",{className:"mapboxgl-ctrl mapboxgl-ctrl-group",ref:l},je.createElement("button",{key:$e,className:"mapboxgl-ctrl-icon mapboxgl-ctrl-".concat($e),type:"button",title:ke,onClick:fe},je.createElement("span",{className:"mapboxgl-ctrl-icon","aria-hidden":"true"}))))}U_.propTypes=tF;U_.defaultProps=iF;je.memo(U_);var yc;function rF(){return yc!==void 0?Promise.resolve(yc):window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(function(r){return yc=r.state!=="denied",yc}):(yc=!!window.navigator.geolocation,Promise.resolve(yc))}function Bb(r,e){var i=Object.keys(r);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(r);e&&(l=l.filter(function(u){return Object.getOwnPropertyDescriptor(r,u).enumerable})),i.push.apply(i,l)}return i}function nF(r){for(var e=1;e<arguments.length;e++){var i=arguments[e]!=null?arguments[e]:{};e%2?Bb(Object(i),!0).forEach(function(l){j(r,l,i[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(i)):Bb(Object(i)).forEach(function(l){Object.defineProperty(r,l,Object.getOwnPropertyDescriptor(i,l))})}return r}var Fb=function(){},sF=Object.assign({},fs,{className:Pe.string,style:Pe.object,label:Pe.string,disabledLabel:Pe.string,auto:Pe.bool,positionOptions:Pe.object,fitBoundsOptions:Pe.object,trackUserLocation:Pe.bool,showUserLocation:Pe.bool,showAccuracyCircle:Pe.bool,showUserHeading:Pe.bool,onViewStateChange:Pe.func,onViewportChange:Pe.func,onGeolocate:Pe.func}),oF=Object.assign({},ma,{className:"",label:"Find My Location",disabledLabel:"Location Not Available",auto:!1,positionOptions:{enableHighAccuracy:!1,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showUserLocation:!0,showUserHeading:!1,showAccuracyCircle:!0,onGeolocate:function(){}});function aF(r){var e=new Vs.LngLat(r.coords.longitude,r.coords.latitude),i=r.coords.accuracy,l=e.toBounds(i);return[[l._ne.lng,l._ne.lat],[l._sw.lng,l._sw.lat]]}function lF(r,e,i){var l=new Vs.GeolocateControl(e);l._container=vo.createElement("div"),l._map={on:function(){},_getUIString:function(){return""}},l._setupUI(!0),l._map=r.map,l._geolocateButton=i;var u=r.eventManager;return l.options.trackUserLocation&&u&&u.on("panstart",function(){l._watchState==="ACTIVE_LOCK"&&(l._watchState="BACKGROUND",i.classList.add("mapboxgl-ctrl-geolocate-background"),i.classList.remove("mapboxgl-ctrl-geolocate-active"))}),l.on("geolocate",e.onGeolocate),l}function cF(r,e){var i=e.context,l=e.props,u=aF(r),m=i.viewport.fitBounds(u,l.fitBoundsOptions),y=m.longitude,T=m.latitude,a=m.zoom,P=Object.assign({},i.viewport,{longitude:y,latitude:T,zoom:a}),D=new Ec(P),N=Object.assign({},D.getViewportProps(),_o),F=l.onViewportChange||i.onViewportChange||Fb,W=l.onViewStateChange||i.onViewStateChange||Fb;W({viewState:N}),F(N)}function j_(r){var e=ga(r),i=e.context,l=e.containerRef,u=je.useRef(null),m=je.useState(null),y=ir(m,2),T=y[0],a=y[1],P=je.useState(!1),D=ir(P,2),N=D[0],F=D[1];je.useEffect(function(){var ke;return i.map&&rF().then(function($e){F($e),u.current&&(ke=lF(i,r,u.current),ke._updateCamera=function(Ve){return cF(Ve,e)},a(ke))}),function(){ke&&ke._clearWatch()}},[i.map]);var W=je.useCallback(function(){T&&(T.options=e.props,T.trigger())},[T]);je.useEffect(function(){r.auto&&W()},[T,r.auto]),je.useEffect(function(){T&&T._onZoom()},[i.viewport.zoom]);var oe=r.className,me=r.label,fe=r.disabledLabel,Ee=r.trackUserLocation,Ce=je.useMemo(function(){return nF({position:"absolute"},r.style)},[r.style]);return je.createElement("div",{style:Ce,className:oe},je.createElement("div",{key:"geolocate-control",className:"mapboxgl-ctrl mapboxgl-ctrl-group",ref:l},je.createElement("button",{key:"geolocate",className:"mapboxgl-ctrl-icon mapboxgl-ctrl-geolocate",ref:u,disabled:!N,"aria-pressed":!Ee,type:"button",title:N?me:fe,"aria-label":N?me:fe,onClick:W},je.createElement("span",{className:"mapboxgl-ctrl-icon","aria-hidden":"true"}))))}j_.propTypes=sF;j_.defaultProps=oF;je.memo(j_);function uF(r,e){for(var i=(r||"").split(".").map(Number),l=e.split(".").map(Number),u=0;u<3;u++){var m=i[u]||0,y=l[u]||0;if(m<y)return-1;if(m>y)return 1}return 0}function Nb(r,e){var i=Object.keys(r);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(r);e&&(l=l.filter(function(u){return Object.getOwnPropertyDescriptor(r,u).enumerable})),i.push.apply(i,l)}return i}function hF(r){for(var e=1;e<arguments.length;e++){var i=arguments[e]!=null?arguments[e]:{};e%2?Nb(Object(i),!0).forEach(function(l){j(r,l,i[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(i)):Nb(Object(i)).forEach(function(l){Object.defineProperty(r,l,Object.getOwnPropertyDescriptor(i,l))})}return r}var Ub=function(){},fF=Object.assign({},fs,{className:Pe.string,style:Pe.object,onViewStateChange:Pe.func,onViewportChange:Pe.func,showCompass:Pe.bool,showZoom:Pe.bool,zoomInLabel:Pe.string,zoomOutLabel:Pe.string,compassLabel:Pe.string}),dF=Object.assign({},ma,{className:"",showCompass:!0,showZoom:!0,zoomInLabel:"Zoom In",zoomOutLabel:"Zoom Out",compassLabel:"Reset North"}),pF=1,t_=2;function mF(r){return uF(r,"1.6.0")>=0?t_:pF}function vg(r,e,i){var l=r.viewport,u=new Ec(Object.assign({},l,i)),m=Object.assign({},u.getViewportProps(),_o),y=e.onViewportChange||r.onViewportChange||Ub,T=e.onViewStateChange||r.onViewStateChange||Ub;T({viewState:m}),y(m)}function xg(r,e,i,l){return je.createElement("button",{key:r,className:"mapboxgl-ctrl-icon mapboxgl-ctrl-".concat(r),type:"button",title:e,onClick:i},l||je.createElement("span",{className:"mapboxgl-ctrl-icon","aria-hidden":"true"}))}function gF(r){var e=je.useMemo(function(){return r.map?mF(r.map.version):t_},[r.map]),i=r.viewport.bearing,l={transform:"rotate(".concat(-i,"deg)")};return e===t_?je.createElement("span",{className:"mapboxgl-ctrl-icon","aria-hidden":"true",style:l}):je.createElement("span",{className:"mapboxgl-ctrl-compass-arrow",style:l})}function V_(r){var e=ga(r),i=e.context,l=e.containerRef,u=function(){vg(i,r,{zoom:i.viewport.zoom+1})},m=function(){vg(i,r,{zoom:i.viewport.zoom-1})},y=function(){vg(i,r,{bearing:0,pitch:0})},T=r.className,a=r.showCompass,P=r.showZoom,D=r.zoomInLabel,N=r.zoomOutLabel,F=r.compassLabel,W=je.useMemo(function(){return hF({position:"absolute"},r.style)},[r.style]);return je.createElement("div",{style:W,className:T},je.createElement("div",{className:"mapboxgl-ctrl mapboxgl-ctrl-group",ref:l},P&&xg("zoom-in",D,u),P&&xg("zoom-out",N,m),a&&xg("compass",F,y,gF(i))))}V_.propTypes=fF;V_.defaultProps=dF;je.memo(V_);function jb(r,e){var i=Object.keys(r);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(r);e&&(l=l.filter(function(u){return Object.getOwnPropertyDescriptor(r,u).enumerable})),i.push.apply(i,l)}return i}function _F(r){for(var e=1;e<arguments.length;e++){var i=arguments[e]!=null?arguments[e]:{};e%2?jb(Object(i),!0).forEach(function(l){j(r,l,i[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(i)):jb(Object(i)).forEach(function(l){Object.defineProperty(r,l,Object.getOwnPropertyDescriptor(i,l))})}return r}var yF=Object.assign({},fs,{className:Pe.string,style:Pe.object,maxWidth:Pe.number,unit:Pe.oneOf(["imperial","metric","nautical"])}),vF=Object.assign({},ma,{className:"",maxWidth:100,unit:"metric"});function G_(r){var e=ga(r),i=e.context,l=e.containerRef,u=je.useState(null),m=ir(u,2),y=m[0],T=m[1];je.useEffect(function(){if(i.map){var P=new Vs.ScaleControl;P._map=i.map,P._container=l.current,T(P)}},[i.map]),y&&(y.options=r,y._onMove());var a=je.useMemo(function(){return _F({position:"absolute"},r.style)},[r.style]);return je.createElement("div",{style:a,className:r.className},je.createElement("div",{ref:l,className:"mapboxgl-ctrl mapboxgl-ctrl-scale"}))}G_.propTypes=yF;G_.defaultProps=vF;je.memo(G_);Object.assign({},fs,{redraw:Pe.func.isRequired});Object.assign({},fs,{redraw:Pe.func.isRequired,style:Pe.object});Object.assign({},fs,{redraw:Pe.func.isRequired,style:Pe.object});Vs&&Vs.setRTLTextPlugin;export{cR as A,Oi as B,Ti as C,Iz as D,AF as E,Vi as F,MF as G,kI as H,nP as I,RR as J,FI as K,bw as L,o3 as M,Mc as N,Zw as O,wF as P,ID as Q,w_ as R,pa as S,In as T,Ix as U,ll as W,j as _,I_ as a,IF as b,bg as c,go as d,Pe as e,Tw as f,Qr as g,Sg as h,iA as i,SF as j,cD as k,Ii as l,z1 as m,Ch as n,kr as o,PF as p,uD as q,y_ as r,pp as s,Bc as t,ca as u,tr as v,ai as w,f_ as x,cp as y,WD as z};
