import{d as $,n as w,g as m,m as H,C as _}from"./index-D_sw2g-2.js";import{d as D}from"./index-CVL_6l40.js";import{Y as x}from"./index-DFKcNkqO.js";import{f as z,g as E,p as P,n as v,t as M,H as F}from"./HTTPFileSystem-ChhivMzi.js";import{c as B}from"./index-D9ClEd7w.js";import{P as O,L as j}from"./LegendColors-Cl6Ph-UM.js";import{Z as N}from"./ZoomButtons-B4PrQ7mG.js";import{W as R,a as W,D as X}from"./DashboardDataManager-mkjvCydQ.js";import{b as U}from"./ColorsAndWidths-D0mbSer2.js";import{e as I,d as Y}from"./threeDBuildings-eDgufgS4.js";import{T as S,P as k,S as b}from"./geojson-layer-DvtTfj7b.js";import{A as T}from"./arc-layer-utQsdbjp.js";import{M as q}from"./mapbox-overlay-HS93bZkL.js";import{B as G}from"./BackgroundLayers-Dp9DDZZa.js";import"./fxp-DjoqftHf.js";import"./layer-extension-LbH36Bf-.js";import"./layer-T9N9JmIf.js";import"./group-hI8ly2Wr.js";import"./index-_doEQLKC.js";import"./cubehelix-BzW-tINw.js";import"./threshold-CrWFx_nu.js";import"./rainbow-DNS2KC2A.js";import"./Coords-C-Mhj230.js";import"./turf.es-BzqbG201.js";import"./geo-utils-DZRrIAx0.js";import"./sequential-pySAYR1V.js";import"./pow-RbZoge3Z.js";import"./precisionRound-CRsIqO1V.js";const V=$({name:"MapTooltip",components:{},props:{hoverInfo:{type:Object,required:!0},totalShipmentsPerHub:{type:Array,required:!0}},data(){return{tooltipType:0,activity:"",stop:{},hubInfo:{}}},watch:{hoverInfo(){this.renderTooltip(this.hoverInfo)}},methods:{renderTooltip(e){this.tooltipType=0;const{object:t}=e;if(!t)return null;if(t?.type=="pickup")return this.renderActivityTooltip(e,"pickup");if(t?.type=="delivery")return this.renderActivityTooltip(e,"delivery");if(t?.type=="leg")return this.renderTourTooltip(e);if(t?.color)return this.renderLegTooltip(e);if(t?.label=="Depot"||t?.locationX&&t?.locationY)return this.renderHubInfo(e);if(t?.tour)return this.renderStopTooltip(e)},renderActivityTooltip(e,t){this.tooltipType=1,this.activity=t},renderServicesTooltip(e,t){this.tooltipType=2},renderLegTooltip(e){this.tooltipType=3},renderTourTooltip(e){this.tooltipType=5},renderHubInfo(e){this.tooltipType=6;const{object:t,x:s,y:i}=e;this.hubInfo=this.totalShipmentsPerHub.find(r=>r.hubId===t?.id)},renderStopTooltip(e){this.tooltipType=2;const{object:t,x:s,y:i}=e,r=t.visits.length,n=t.visits.reduce((l,a)=>l+a.pickup.length,0),o=t.visits.reduce((l,a)=>l+a.delivery.length,0);this.stop={numPickupsAndDeliveries:n+o,overview:{visits:r,pickups:n,deliveries:o}}}}});var J=function(){var t=this,s=t._self._c;return t._self._setupProxy,t.tooltipType?s("div",{staticClass:"flex-col"},[t.tooltipType==1?s("div",{staticClass:"tooltip"},[s("table",{staticStyle:{"max-width":"30rem","font-size":"0.8rem"}},[s("tbody",[s("tr",[s("td",{staticStyle:{"text-align":"right","padding-right":"0.5rem","padding-top":"0.2rem"}},[t._v(t._s(t.activity)+":")]),s("td",{staticStyle:{"padding-top":"0.2rem"}},[t._v(t._s(t.hoverInfo.object.shipmentIds.join(", ")))])])])])]):t._e(),t.tooltipType==2?s("div",{staticClass:"tooltip flex-col"},[s("b",[t._v(t._s(t.hoverInfo.object?.$id))]),s("h5",{staticStyle:{"padding-top":"0.2rem"}},[t._v("Capacity Demand: "+t._s(t.hoverInfo.object.$capacityDemand))])]):t._e(),t.tooltipType==3?s("div",{staticClass:"tooltip flex-col"},[s("b",[t._v(t._s(t.hoverInfo.object?.tour?.vehicleId))]),s("p",[t._v("Leg # "+t._s(1+t.hoverInfo.object?.count))]),s("p",[t._v("Shipments on board: "+t._s(t.hoverInfo.object?.shipmentsOnBoard?.length))]),s("p",[t._v("Total size: "+t._s(t.hoverInfo.object?.totalSize))])]):t._e(),t.tooltipType==4?s("div",{staticClass:"tooltip flex-col"},[s("table",{staticStyle:{"font-size":"0.8rem"}},[s("tbody",[t._l(Object.keys(t.stop.overview),function(i){return s("tr",{key:i},[s("td",{staticStyle:{"text-align":"right","padding-right":"0.5rem"}},[t._v(t._s(i)+":")]),s("td",[s("b",[t._v(t._s(t.stop.overview[i]))])])])}),t._l(Object.keys(t.stop.numPickupsAndDeliveries==1?t.hoverInfo.object.details:[]),function(i){return s("tr",{key:i},[s("td",{staticStyle:{"text-align":"right","padding-right":"0.5rem","padding-top":"0.2rem"}},[t._v(t._s(i.slice(1))+":")]),s("td",{staticStyle:{"padding-top":"0.2rem"}},[t._v(t._s(t.hoverInfo.object.details[t.a]))])])})],2)])]):t._e(),t.tooltipType==5?s("div",{staticClass:"tooltip flex-col"},[s("b",[t._v("Vehicle Id: "+t._s(t.hoverInfo.object?.tour.vehicleId))]),s("p",[t._v("Tour Id: "+t._s(t.hoverInfo.object?.tour.tourId))])]):t._e(),t.tooltipType==6?s("div",{staticClass:"tooltip flex-col"},[s("b",[t._v("Hub Id: "+t._s(t.hubInfo?.hubId))]),s("p",[t._v("Total Shipments: "+t._s(t.hubInfo?.shipmentTotal))])]):t._e()]):t._e()},Z=[],K=w(V,J,Z,!1,null,null);const Q=K.exports,A="/simwrapper/",g={pickup:[0,150,255],delivery:[240,0,60]},tt=$({name:"LogisticsDeckComponent",components:{MapTooltip:Q},props:{activeTab:{type:String,required:!0},bgLayers:{type:Object},carrierServices:{type:Set},center:{type:Array},colors:{type:Object,required:!0},dark:{type:Boolean,required:!0},depots:{type:Array},hubLocation:{type:Array,required:!0},hubName:{type:String,required:!0},legs:{type:Array,required:!0},lspShipmentChains:{type:Array,required:!0},numSelectedTours:{type:Number,required:!0},onClick:{type:Function,required:!0},projection:{type:String,required:!0},settings:{type:Object,required:!0},shipments:{type:Array,required:!0},showHub:{type:Boolean,required:!0},stopActivities:{type:Array,required:!0},tourHubs:{type:Array,required:!0},viewId:{type:Number,required:!0},show3dBuildings:{type:Boolean,required:!1,default:!1}},data(){return{mymap:null,deckOverlay:null,globalState:m.state,prevHubChains:this.lspShipmentChains,totalShipmentsPerHub:[],tip:null,tooltipStyle:{position:"absolute",padding:"4px 8px",display:"block",top:0,left:0,zIndex:2e4}}},watch:{layers(){this.deckOverlay&&this.deckOverlay.setProps({layers:this.layers})},dark(){let e;this.projection&&this.projection!=="Atlantis"?e=`${A}map-styles/${this.globalState.isDarkMode?"dark":"positron"}.json`:e={version:8,sources:{},layers:[]},this.mymap?.setStyle(e)},show3dBuildings(){!this.mymap||this.projection==="Atlantis"||(this.show3dBuildings?I(this.mymap):Y(this.mymap))},"globalState.viewState"(){const e=this.globalState.viewState,t=this.mymap?.getCenter();(e.longitude!==t.lng||e.latitude!==t.lat||e.zoom!==this.mymap?.getZoom()||e.pitch!==this.mymap?.getPitch()||e.bearing!==this.mymap?.getBearing())&&this.mymap?.jumpTo(Object.assign({center:{lng:e.longitude,lat:e.latitude}},e))}},computed:{pickupsAndDeliveries(){const e={},t={};return this.shipments.forEach(s=>{let i=`${s.fromX}-${s.fromY}`;e[i]||(e[i]={type:"pickup",shipmentIds:[],coord:[s.fromX,s.fromY]}),e[i].shipmentIds.push(s.$id),i=`${s.toX}-${s.toY}`,t[i]||(t[i]={type:"delivery",shipmentIds:[],coord:[s.toX,s.toY]}),t[i].shipmentIds.push(s.$id)}),{type:"activity",pickups:Object.values(e),deliveries:Object.values(t)}},widthScale(){return this.settings.scaleFactor==0?1e-6:1/Math.pow(2,(100-this.settings.scaleFactor)/5-6)},widthScaleShipments(){return this.settings.scaleFactorShipments==0?1e-6:1/Math.pow(2,(100-this.settings.scaleFactorShipments)/5-6)},layers(){const e=[],t=this.bgLayers?.layers();return t&&e.push(...t.layersBelow),this.activeTab=="lspTours"&&e.push(...this.getLspTourLayers()),this.activeTab=="shipments"&&this.settings.scaleFactorShipments===0&&e.push(...this.setShipments()),this.activeTab==="lspShipmentChains"&&this.showHub&&this.hubLocation.length>0&&e.push(new S({id:"lspHubs2",data:this.hubLocation,getPosition:[this.hubLocation[0],this.hubLocation[1]],getText:()=>this.hubName,getRadius:2,opacity:.9,background:!0,backgroundPadding:this.numSelectedTours!==1?[2,1,2,1]:[3,2,3,1],getBackgroundColor:()=>[240,130,0],getColor:[255,255,255],parameters:{depthTest:!1},pickable:!0,radiusUnits:"pixels",getSize:s=>11,getTextAnchor:"middle",getAlignmentBaseline:"center",noAlloc:!1,billboard:!0,sizeScale:1,autoHighlight:!0})),this.activeTab=="lspShipmentChains"&&!this.showHub&&this.hubLocation.length==0&&e.push(...this.getLspShipmentChainLayers()),t&&e.push(...t.layersOnTop),e}},mounted(){let e;this.projection&&this.projection!=="Atlantis"?e=`${A}map-styles/${this.globalState.isDarkMode?"dark":"positron"}.json`:e={version:8,sources:{},layers:[]};const t=`map-${this.viewId}`,s=this.globalState.viewState.center,i=this.globalState.viewState.zoom;this.mymap=new H.Map({container:t,style:e,center:s,zoom:i}),this.mymap.on("move",this.handleMove),this.mymap.on("style.load",()=>{this.projection!=="Atlantis"&&this.show3dBuildings&&this.mymap&&I(this.mymap),this.deckOverlay=new q({interleaved:!0,layers:this.layers,onClick:this.handleClick,onHover:this.getTooltip}),this.mymap?.addControl(this.deckOverlay)})},beforeDestroy(){this.deckOverlay&&this.mymap?.removeControl(this.deckOverlay),this.mymap?.remove()},methods:{getLineWidth(e,t){return e+1==Number(t.route.length-1)?1*(this.settings.scaleFactor/2):3*(this.settings.scaleFactor/2)},getSourceColor(e,t){const s=this.shipments.length>1?32:255;return e+1==Number(t.route.length-1)?[0,228,255,s]:[255,140,0]},getTargetColor(e,t){return e+1==Number(t.route.length-1)?[240,0,60,224]:[255,140,0]},getLspShipmentChainLayers(){const e=[],t=this.shipments.length>1?32:255;if(this.lspShipmentChains[0].hubsChains.length===0)e.push(new T({id:"shipmentdirectchains",data:this.lspShipmentChains[0].directChains,getSourcePosition:s=>[s.fromX,s.fromY],getTargetPosition:s=>[s.toX,s.toY],getSourceColor:[0,228,255,t],getTargetColor:[240,0,60,224],getWidth:this.settings.scaleFactor?s=>parseInt(s.$size)||1:1,widthUnits:"pixels",getHeight:.5,opacity:.9,parameters:{depthTest:!1},widthScale:this.settings.widthScale,widthMinPixels:1,widthMaxPixels:100,updateTriggers:{getWidth:[this.settings.scaleFactor]},transitions:{getWidth:200}})),e.push(new b({id:"deliveriesHubChain",data:this.lspShipmentChains[0].directChains,getPosition:s=>[s.toX,s.toY],getColor:g.delivery,getRadius:3,opacity:.9,parameters:{depthTest:!1},pickable:!0,radiusUnits:"pixels"})),e.push(new b({id:"pickupsHubChain",data:this.lspShipmentChains[0].directChains,getPosition:s=>[s.fromX,s.fromY],getColor:g.pickup,getRadius:2,opacity:.9,parameters:{depthTest:!1},pickable:!0,radiusUnits:"pixels"}));else{const s=this.lspShipmentChains[0].hubsChains.flatMap(r=>r.hubs);let i=s.reduce((r,n)=>(r.find(l=>JSON.stringify(l)===JSON.stringify(n))||r.push(n),r),[]);i.forEach(r=>{let n={hubId:r.id,shipmentTotal:0};this.totalShipmentsPerHub.push(n)}),this.totalShipmentsPerHub.forEach(r=>{r.shipmentTotal=0}),this.lspShipmentChains[0].hubsChains.forEach(r=>{r.hubs.forEach(o=>{if(i.some(a=>a.id===o.id)){let a=this.totalShipmentsPerHub.find(c=>c.hubId===o.id);a&&a.shipmentTotal++}}),console.log("Adding 3x",r.route.length,"layers");const n=r.route.map((o,l)=>l?[o,r.route[l-1]]:null).slice(1);e.push(new T({id:"shipmenthubchains_"+r.shipmentId,data:n,getSourcePosition:o=>o[0],getTargetPosition:o=>o[1],getSourceColor:(o,l)=>this.getSourceColor(l,r),getTargetColor:(o,l)=>this.getTargetColor(l,r),getWidthColor:(o,l)=>this.getLineWidth(l,r),widthUnits:"pixels",getHeight:.5,opacity:.9,parameters:{depthTest:!1},widthMinPixels:1,widthMaxPixels:100,transitions:{getWidth:200}})),e.push(new b({id:"HubChainMarker_"+r.shipmentId,data:[r],getPosition:()=>[r.route[r.route.length-1][0],r.route[r.route.length-1][1]],getFillColor:g.pickup,getRadius:3,opacity:.9,parameters:{depthTest:!1},pickable:!0,radiusUnits:"pixels"})),e.push(new b({id:"pickupsHubChain",data:[{}],getPosition:o=>[r.route[0][0],r.route[0][1]],getColor:g.pickup,getRadius:2,opacity:.9,parameters:{depthTest:!1},pickable:!0,radiusUnits:"pixels"}))}),e.push(new S({id:"HubChain",data:s,getPosition:r=>[r.locationX,r.locationY],getText:r=>r.id,getAlignmentBaseline:"center",getColor:[255,255,255],getBackgroundColor:[240,130,0],background:!0,backgroundPadding:[2,2,2,2],fontWeight:"normal",getSize:10,getTextAnchor:"middle",pickable:!0}))}return e},setShipments(){const e=[];e.push(new b({id:"deliveries",data:this.pickupsAndDeliveries.deliveries,getPosition:s=>s.coord,getFillColor:g.delivery,getRadius:3,opacity:.9,parameters:{depthTest:!1},pickable:!0,radiusUnits:"pixels"})),e.push(new b({id:"pickups",data:this.pickupsAndDeliveries.pickups,getPosition:s=>s.coord,getFillColor:g.pickup,getRadius:2,opacity:.9,parameters:{depthTest:!1},pickable:!0,radiusUnits:"pixels"}));const t=this.shipments.length>1?32:255;return e.push(new T({id:"shipments",data:this.shipments,getSourcePosition:s=>[s.fromX,s.fromY],getTargetPosition:s=>[s.toX,s.toY],getSourceColor:[0,228,255,t],getTargetColor:[240,0,60,224],getWidth:this.settings.scaleFactorShipments?s=>parseInt(s.$size)||1:1,widthUnits:"pixels",getHeight:.5,opacity:.9,parameters:{depthTest:!1},widthScale:this.settings.widthScaleShipments,widthMinPixels:1,widthMaxPixels:100,updateTriggers:{getWidth:[this.settings.scaleFactorShipments]},transitions:{getWidth:200}})),e},getLspTourLayers(){const e=[];return this.showHub===!0&&this.hubLocation.length>0?e.push(new S({id:"pickupsHubChain",data:this.hubLocation,getPosition:[this.hubLocation[0],this.hubLocation[1]],getText:()=>this.hubName,getRadius:2,opacity:.9,background:!0,backgroundPadding:this.numSelectedTours!==1?[2,1,2,1]:[3,2,3,1],getBackgroundColor:()=>[240,130,0],getColor:[255,255,255],parameters:{depthTest:!1},pickable:!0,radiusUnits:"pixels",getSize:t=>11,getTextAnchor:"middle",getAlignmentBaseline:"center",noAlloc:!1,billboard:!0,sizeScale:1,autoHighlight:!0})):(e.push(new k({id:"shipmentLocationDashedLine",data:this.stopActivities,getPath:t=>[t.ptFrom,t.ptTo],getColor:[128,128,128],getOffset:2,opacity:1,widthMinPixels:3,jointRounded:!0,shadowEnabled:!1,pickable:!1,autoHighlight:!1,highlightColor:[255,255,255],parameters:{depthTest:!1},getDashArray:[3,2],dashJustified:!0,extensions:[new O({dash:!0})]})),this.settings.simplifyTours&&!this.settings.showEachCarrierTour?e.push(new T({id:"leg-arcs",data:this.legs,getSourcePosition:t=>t.points[0],getTargetPosition:t=>t.points[t.points.length-1],getSourceColor:t=>this.getLspTourColor(t.tour),getTargetColor:t=>this.getLspTourColor(t.tour),getWidth:this.settings.scaleFactor?t=>t.totalSize/2:3,getHeight:.5,widthMinPixels:2,widthMaxPixels:200,widthUnits:"pixels",opacity:.9,parameters:{depthTest:!1},updateTriggers:{getWidth:[this.settings.scaleFactor]},transitions:{getWidth:150},pickable:!0,autoHighlight:!0,highlightColor:[255,255,255]})):this.settings.showEachCarrierTour&&!this.settings.simplifyTours?e.push(new k({id:"deliveryroutes2",data:this.legs,getPath:t=>t.points,getColor:t=>this.getCarrierToursColors(t),getWidth:this.settings.scaleFactor?t=>t.totalSize:3,getOffset:2,opacity:1,widthMinPixels:3,widthMaxPixels:200,widthUnits:"pixels",jointRounded:!0,shadowEnabled:!1,pickable:!0,autoHighlight:!0,highlightColor:[255,255,255],parameters:{depthTest:!1},updateTriggers:{getWidth:[this.settings.scaleFactor]},transitions:{getWidth:150}})):this.settings.simplifyTours&&this.settings.showEachCarrierTour?e.push(new T({id:"leg-arcs-showAll",data:this.legs,getSourcePosition:t=>t.points[0],getTargetPosition:t=>t.points[t.points.length-1],getSourceColor:t=>this.getCarrierToursColors(t),getTargetColor:t=>this.getCarrierToursColors(t),getWidth:this.settings.scaleFactor?t=>t.totalSize/2:3,getHeight:.5,widthMinPixels:2,widthMaxPixels:200,widthUnits:"pixels",opacity:.9,parameters:{depthTest:!1},updateTriggers:{getWidth:[this.settings.scaleFactor]},transitions:{getWidth:150},pickable:!0,autoHighlight:!0,highlightColor:[255,255,255,160]})):e.push(new k({id:"deliveryroutes1",data:this.legs,getPath:t=>t.points,getColor:t=>this.getLspTourColor(t.tour),getWidth:this.settings.scaleFactor?t=>t.totalSize:3,getOffset:2,opacity:1,widthMinPixels:3,widthMaxPixels:200,widthUnits:"pixels",jointRounded:!0,shadowEnabled:!1,pickable:!0,autoHighlight:!0,highlightColor:[255,255,255],parameters:{depthTest:!1},updateTriggers:{getWidth:[this.settings.scaleFactor]},transitions:{getWidth:150}})),e.push(new S({id:"dest-labels",data:this.stopActivities,background:!0,backgroundPadding:this.numSelectedTours!==1?[2,1,2,1]:[3,2,3,1],getColor:[255,255,255],getBackgroundColor:t=>{const s=t.visits.reduce((n,o)=>n+o.pickup.length,0),i=t.visits.reduce((n,o)=>n+o.delivery.length,0),r=t.visits.reduce((n,o)=>n+o.service.length,0);return s&&i&&!t.depot?[0,0,255]:s&&!t.depot?g.pickup:i&&!t.depot||r&&!t.depot?g.delivery:t.depot?[240,130,0]:[240,130,0]},getPosition:t=>t.midpoint,getText:t=>t.label=="Hub"?t.label:this.numSelectedTours!==1?" ":`${t.label}`,getSize:t=>t.label=="Hub"?11:this.numSelectedTours!==1?4:11,getTextAnchor:"middle",getAlignmentBaseline:"center",opacity:1,noAlloc:!1,billboard:!0,sizeScale:1,pickable:!0,autoHighlight:!0,highlightColor:[255,255,255],visible:this.settings.shipmentDotsOnTourMap})),e.push(new S({id:"HubChain",data:this.tourHubs,getPosition:t=>[t.Xcoord,t.Ycoord],getText:t=>t.hubId,getAlignmentBaseline:"center",getColor:[255,255,255],getBackgroundColor:[240,130,0],background:!0,backgroundPadding:[2,2,2,2],fontWeight:"normal",getSize:10,getTextAnchor:"middle",pickable:!0}))),e},getLspTourColor(e){const t=this.colors[e.carrier];try{if(t){const o=U([t]);if(o)return o[0]}}catch{}let s=0;for(let o=0;o<e.vehicleId.length;o++)s=e.vehicleId.charCodeAt(o)+((s<<5)-s);const i=(s&16711680)>>16,r=(s&65280)>>8,n=s&255;return[i,r,n]},getCarrierToursColors(e){let t=0;for(let n=0;n<e.tour.tourId.length;n++)t=e.tour.tourId.charCodeAt(n)+((t<<5)-t);t*=e.tour.tourNumber;const s=(t%360+360)%360;return this.hslToRgb(s,70,50)},hslToRgb(e,t,s){t/=100,s/=100;const i=o=>(o+e/30)%12,r=t*Math.min(s,1-s),n=o=>s-r*Math.max(-1,Math.min(i(o)-3,Math.min(9-i(o),1)));return[Math.round(n(0)*255),Math.round(n(8)*255),Math.round(n(4)*255)]},handleMove(){const e=this.mymap?.getCenter(),t={latitude:e.lat,longitude:e.lng,zoom:this.mymap?.getZoom(),bearing:this.mymap?.getBearing(),pitch:this.mymap?.getPitch(),jump:!0};m.commit("setMapCamera",t)},getTooltip(e){const{x:t,y:s,object:i}=e;if(!i){this.tooltipStyle.display="none",this.tip=null;return}this.tip={...e},this.tooltipStyle.display="block",this.tooltipStyle.top=`${s+12}px`,this.tooltipStyle.left=`${t+12}px`},oldgetTooltip(e){const{x:t,y:s,object:i}=e;if(!i||!i.position||!i.position.length){this.tooltipStyle.display="none";return}this.tooltipStyle.display="block",this.tooltipStyle.top=`${s+12}px`,this.tooltipStyle.left=`${t+12}px`},handleClick(e){e.object?this.onClick(e.object):this.onClick(null)}}});var st=function(){var t=this,s=t._self._c;return t._self._setupProxy,s("div",{staticClass:"deck-map flex-col"},[s("div",{staticClass:"map-container",attrs:{id:`map-${t.viewId}`}}),t.tip?s("MapTooltip",{staticClass:"deck-tooltip",style:t.tooltipStyle,attrs:{hoverInfo:t.tip,totalShipmentsPerHub:t.totalShipmentsPerHub}}):t._e()],1)},et=[],it=w(tt,st,et,!1,null,null);const rt=it.exports,ot={messages:{en:{carriers:"Carriers",vehicles:"VEHICLES",services:"SERVICES",shipments:"SHIPMENTS",tours:"TOURS",pickup:"Pickup",service:"service",delivery:"Delivery",flatten:"Simple&nbsp;tours",shipmentDots:"Show shipments",scaleSize:"Widths",scaleFactor:"Width",scaleFactorShipments:"Width","Shipment Chains":"Shipment Chains",Shipments:"Shipments","LSP Tours":"LSP Tours",lspShipmentChains:"lspShipmentChains","Lsp Shipments":"Lsp Shipments","Carrier Tours":"Carrier Tours",Tours:"Tours"},de:{carriers:"Unternehmen",vehicles:"FAHRZEUGE",services:"BETRIEBE",shipments:"LIEFERUNGEN",Shipments:"Lieferungen",service:"service",tours:"TOUREN",pickup:"Abholung",delivery:"Lieferung","Shipment Chains":"Lieferungketten",Tours:"Tours",scaleSize:"Widths",scaleFactor:"Width",scaleFactorShipments:"Width",lspShipmentChains:"lspShipmentChains","LSP Tours":"LSP Touren","Lsp Shipments":"Lsp Lieferungen","Carrier Tours":"Carrier Touren",shipmentDots:"Lieferungen anzeigen",flatten:"Einfache Touren"}}};v.insensitive=!0;const nt=$({name:"LogisticsPlugin",i18n:ot,components:{LegendColors:j,ToggleButton:D.ToggleButton,DeckMap:rt,ZoomButtons:N},props:{root:{type:String,required:!0},subfolder:{type:String,required:!0},yamlConfig:String,config:Object,thumbnail:Boolean,datamanager:{type:Object}},data(){return{linkLayerId:Math.floor(1e12*Math.random()),vizSettings:{simplifyTours:!1,showEachCarrierTour:!1,scaleShipmentSizes:!0,shipmentDotsOnTourMap:!0,selectedTours:!1,scaleFactor:0,scaleFactorShipments:0},isDraggingDivider:0,dragStartWidth:250,legendSectionWidth:275,vizDetails:{network:"",carriers:"",lsps:"",projection:"",title:"",description:"",thumbnail:"",center:null,colors:{}},show3dBuildings:!1,myState:{statusMessage:"",isRunning:!1,subfolder:"",yamlConfig:"",thumbnail:!0,data:[]},myDataManager:this.datamanager||new X(this.root,this.subfolder),searchTerm:"",searchEnabled:!1,globalState:m.state,isLoaded:!0,showHelp:!1,activeTab:"",legendBits:[],links:null,toggleTours:!0,toggleVehicles:!0,toggleShipments:!0,toggleServices:!0,backgroundLayers:null,detailContent:"",linksCsvData:null,data:null,darkMode:null,lightMode:null,avroNetwork:null,lsps:[],lspPlan:{},resources:[],lspShipmentChains:[],lspShipmentDirectChains:[],lspShipmentHubChains:[],lspChainTours:[],lspChainToursAll:[],lspDirectToursAll:[],lspToursAll:[],lspCarriers:[],lspHubChainCarriers:[],lspHubCarriers:[],lspDirectCarriers:[],lspCarrier:{},globalHubChainBoolean:!1,tourHubs:[],allHubChains:[],allCarrierHubIds:[],hubLocation:[],showHub:!1,hubName:"",carriers:[],carrierTours:[],carrierServicesAll:new Set,showCompleteHubChain:!1,showCarrierTours:!1,showCarrierToursList:!1,vehicles:[],shipments:[],shipmentLookup:{},services:[],stopActivities:[],tours:[],plans:[],shownShipments:[],shipmentIdsInTour:[],depots:[],shownDepots:[],shownLegs:[],selectedLsp:"",selectedCarrier:"",lspHubChainTours:"Hub Chain0",selectedLspHubChainTours:"",selectedTours:[],selectedPlan:null,selectedPlanIndex:null,selectedShipment:null,selectedLSPChain:null,thumbnailUrl:"",vehicleLookup:[],vehicleLookupString:{},rgb:B({colormap:"phase",nshades:9,format:"rba"}).map(e=>e.slice(0,3)).reverse(),dropdownIsActive:!1}},computed:{fileApi(){return new F(this.fileSystem,m)},fileSystem(){const e=this.$store.state.svnProjects.filter(t=>t.slug===this.root);if(e.length===0)throw console.log("no such project"),Error;return e[0]},textColor(){const e={text:"#3498db",bg:"#eeeef480"},t={text:"white",bg:"#181518aa"};return this.globalState.isDarkMode?t:e}},watch:{"globalState.isDarkMode"(){this.updateLegendColors()},async"globalState.authAttempts"(){console.log("AUTH CHANGED - Reload"),this.yamlConfig||this.buildRouteFromUrl(),await this.getVizDetails()}},methods:{dividerDragStart(e){this.isDraggingDivider=e.clientX,this.dragStartWidth=this.legendSectionWidth},dividerDragEnd(e){this.isDraggingDivider=0},dividerDragging(e){if(!this.isDraggingDivider)return;const t=this.isDraggingDivider-e.clientX;this.legendSectionWidth=Math.max(0,this.dragStartWidth+t)},checkIfHubChain(){return this.lspShipmentHubChains.length>0},checkIfDirectChain(){return this.globalHubChainBoolean=!1,this.lspShipmentDirectChains.length>0&&this.lspShipmentHubChains.length==0},handleSelectShipment(e){if(this.selectedShipment===e){if(this.selectedShipment=null,this.shownShipments=[],!this.selectedTours.length){const t=this.carriers.filter(s=>s.$id==this.selectedCarrier);this.selectedCarrier="",this.handleSelectCarrier(t[0],!0,"")}return}this.shownShipments=this.shipments.filter(t=>t.$id===e.$id),this.selectedShipment=e},handleSelectShipmentChain(e){if(this.selectedLSPChain===e){if(this.selectedLSPChain=null,this.shownShipments=[],this.selectedLSPChain==null){const s=this.lsps.filter(r=>r.$id==this.selectedLsp);let i;s[0].resources.carrier.forEach(r=>{r.$id==this.selectedCarrier&&(i=r)}),this.shipments=this.processShipments(i),this.lspShipmentChains=[],this.lspShipmentChains.push(this.processLogisticChains(this.shipments)),this.shownShipments=this.shipments}return}let t={hubsChains:this.lspShipmentHubChains,directChains:this.lspShipmentDirectChains};t.hubsChains=this.lspShipmentHubChains.filter(s=>s.shipmentId===e.shipmentId),t.directChains=[],this.lspShipmentChains=[],this.lspShipmentChains.push(t),this.selectedLSPChain=e},processActivitiesInTour(e){const t=[];let s=0;const i={};let r=[],n="";if(this.lspShipmentHubChains.length>0)for(let l=0;l<this.lspShipmentHubChains[0].hubs.length;l++){const a=this.links[this.lspShipmentHubChains[0].hubs[l].location];r=[.5*(a[0]+a[2]),.5*(a[1]+a[3])],n=this.lspShipmentHubChains[0].hubs[l].location,i[`L${this.lspShipmentHubChains[0].hubs[l].location}`]={link:this.lspShipmentHubChains[0].hubs[l].location,midpoint:r,visits:[{pickup:[],delivery:[],service:[]}],label:"",tour:e,hub:!0,depot:!1,details:{},ptFrom:[a[0],a[1]],ptTo:[a[2],a[3]]}}else if(this.lspShipmentDirectChains.length>0&&!this.globalHubChainBoolean){const l=this.links[this.lspShipmentDirectChains[0].from];r=[.5*(l[0]+l[2]),.5*(l[1]+l[3])],n=this.lspShipmentDirectChains[0].from,i[`L${this.lspShipmentDirectChains[0].from}`]={link:this.lspShipmentDirectChains[0].from,midpoint:r,visits:[{pickup:[],delivery:[],service:[]}],label:"",tour:e,hub:!1,depot:!0,details:{},ptFrom:[l[0],l[1]],ptTo:[l[2],l[3]]}}else for(let l=0;l<this.lspShipmentHubChains[0].hubs.length;l++){const a=this.links[this.lspShipmentHubChains[0].hubs[l].location];r=[.5*(a[0]+a[2]),.5*(a[1]+a[3])],n=this.lspShipmentHubChains[0].hubs[l].location,i[`L${this.lspShipmentHubChains[0].hubs[l].location}`]={link:this.lspShipmentHubChains[0].hubs[l].location,midpoint:r,visits:[{pickup:[],delivery:[],service:[]}],label:"",tour:e,hub:!0,depot:!1,details:{},ptFrom:[a[0],a[1]],ptTo:[a[2],a[3]]}}e.plan.forEach(l=>{if(!(!l.$serviceId&&!l.$shipmentId))if(l.$serviceId&&t.push(l.$serviceId),l.$shipmentId&&t.push(l.$shipmentId),e.vehicleId=="mainTruck"){const a=e.legs[0].links[0],c=[this.links[a][0],this.links[a][1]],p=[this.links[a][2],this.links[a][3]],h=[.5*(c[0]+p[0]),.5*(c[1]+p[1])],u=this.$t(String(l.$type)),d={id:e.id,type:u,count:s++,link:a,midpoint:h,label:"",tour:e,ptFrom:c,ptTo:p};if(a==n)i[`L${a}`].visits[i[`L${a}`].visits.length-1][l.$type].push(d);else if(`L${a}`in i){const f={pickup:[],delivery:[],service:[]};f[l.$type].push(d),i[`L${a}`].visits.push(f)}else{const f={pickup:[],delivery:[],service:[]};f[l.$type].push(d),i[`L${a}`]={link:a,midpoint:h,label:"",tour:e,hub:!1,depot:!0,ptFrom:c,ptTo:p,visits:[f]}}n=a}else{const a=this.shipmentLookup[l.$serviceId]||this.shipmentLookup[l.$shipmentId];if(!a)return;const c=l.$type==="pickup"?a.$from:a.$to,p=[this.links[c][0],this.links[c][1]],h=[this.links[c][2],this.links[c][3]],u=[.5*(p[0]+h[0]),.5*(p[1]+h[1])],d=this.$t(l.$type),{from:f,fromX:ct,fromY:pt,to:ut,toX:dt,toY:gt,id:mt,...L}=a,y={id:a.$id,type:d,count:s++,link:c,midpoint:u,label:"",tour:e,details:L,ptFrom:p,ptTo:h};if(c==n)i[`L${c}`].visits[i[`L${c}`].visits.length-1][l.$type].push(y);else if(`L${c}`in i){const C={pickup:[],delivery:[],service:[]};C[l.$type].push(y),i[`L${c}`].visits.push(C)}else{const C={pickup:[],delivery:[],service:[]};C[l.$type].push(y),i[`L${c}`]={link:c,midpoint:u,label:"",tour:e,hub:!1,depot:!1,details:L,ptFrom:p,ptTo:h,visits:[C]}}n=c}});const o=Object.values(i);for(let l=0;l<o.length;l++)o[l].hub?o[l].label="hub":o[l].depot?o[l].label="depot":o[l].label=`${l}`;return{shipmentIdsInTour:t,stopActivities:o}},setupDepots(){const e={};this.vehicles.forEach(t=>{const s=t.$depotLinkId;let i=this.links[s];i&&(e[s]||(e[s]={type:"depot",link:t.$depotLinkId,midpoint:[.5*(i[0]+i[2]),.5*(i[1]+i[3])],coords:this.links[t.$depotLinkId],vehicles:{}}),e[s].vehicles[t.$id]=t)}),this.depots=Object.values(e),this.shownDepots=this.depots.slice(0)},selectAllLspTours(){this.selectedTours=[],this.shownLegs=[],this.stopActivities=[],this.shownDepots=[],this.shownShipments=this.shipments.slice(0);let e=this.lsps.find(t=>t.$id===this.selectedLsp);if(this.tourHubs=[],e.resources.hub&&e.resources.hub.forEach(t=>{let s={Xcoord:(this.links[t.$location][0]+this.links[t.$location][2])/2,Ycoord:(this.links[t.$location][1]+this.links[t.$location][3])/2,hubId:t.$id};this.tourHubs.push(s)}),this.globalHubChainBoolean)for(const t of this.lspChainToursAll){t.legs.forEach((i,r)=>this.addRouteToMap(t,i,r++));const s=this.processActivitiesInTour(t);this.stopActivities=this.stopActivities.concat(s.stopActivities),this.setupDepots()}else if(this.selectedCarrier)for(const t of this.lspChainToursAll)for(const s of t){s.legs.forEach((r,n)=>this.addRouteToMap(s,r,n++));const i=this.processActivitiesInTour(s);this.stopActivities=this.stopActivities.concat(i.stopActivities),this.setupDepots()}else if(!this.selectedCarrier&&!this.globalHubChainBoolean)for(const t of this.lspChainToursAll)for(const s of t){s.legs.forEach((r,n)=>this.addRouteToMap(s,r,n++));const i=this.processActivitiesInTour(s);this.stopActivities=this.stopActivities.concat(i.stopActivities),this.setupDepots()}else for(const t of this.lspChainToursAll){t.legs.forEach((i,r)=>this.addRouteToMap(t,i,r++));const s=this.processActivitiesInTour(t);this.stopActivities=this.stopActivities.concat(s.stopActivities),this.setupDepots()}},selectAllTours(){if(this.selectedTours=[],this.shownLegs=[],this.stopActivities=[],this.shownDepots=[],this.shownShipments=this.shipments.slice(0),this.carrierTours.length>0)for(const e of this.carrierTours[0]){e.legs.forEach((s,i)=>this.addRouteToMap(e,s,i++));const t=this.processActivitiesInTour(e);this.stopActivities=this.stopActivities.concat(t.stopActivities),this.setupDepots()}else if(this.lspChainToursAll)for(const e of this.lspChainToursAll){e.legs.forEach((s,i)=>this.addRouteToMap(e,s,i++));const t=this.processActivitiesInTour(e);this.stopActivities=this.stopActivities.concat(t.stopActivities),this.setupDepots()}},hslToRgb(e,t,s){t/=100,s/=100;const i=o=>(o+e/30)%12,r=t*Math.min(s,1-s),n=o=>s-r*Math.max(-1,Math.min(i(o)-3,Math.min(9-i(o),1)));return[Math.round(n(0)*255),Math.round(n(8)*255),Math.round(n(4)*255)]},getTourColor(e,t){let s=0;for(let l=0;l<e.length;l++)s=e.charCodeAt(l)+((s<<5)-s);s*=t;const i=(s%360+360)%360;let o=this.hslToRgb(i,70,50);return`rgb(${o[0]}, ${o[1]}, ${o[2]})`},getLspTourColor(e){const t=this.vizDetails.colors&&this.vizDetails.colors[e.carrier];if(t)return t;e.vehicleId||this.$emit("error","WARN: tour has no vehicleId: "+e);const s=e.vehicleId||"unknown";let i=0;for(let l=0;l<s.length;l++)i=s.charCodeAt(l)+((i<<5)-i);const r=(i&16711680)>>16,n=(i&65280)>>8,o=i&255;return`rgb(${r}, ${n}, ${o})`},async handleSelectTour(e){if(this.vizSettings.selectedTours=!0,!e.legs.length){console.log("No Route.");for(let r=0;r<e.plan.length;r++)if(e.plan[r].$shipmentId){const n=e.plan[r].$shipmentId,o=[this.shipmentLookup[n].$from,this.shipmentLookup[n].$to];e.legs.push({links:o})}this.vizSettings.simplifyTours=!0}if(this.selectedTours.includes(e)){this.selectedTours=this.selectedTours.filter(r=>r!==e),this.shownLegs=this.shownLegs.filter(r=>r.tour!==e),this.stopActivities=this.stopActivities.filter(r=>r.tour!==e),!this.selectedTours.length&&!this.selectedCarrier?(this.selectAllLspTours(),this.vizSettings.selectedTours=!1):!this.selectedCarrier&&this.selectedTours.length?this.vizSettings.selectedTours=!1:(this.selectAllTours(),this.vizSettings.selectedTours=!1);return}this.selectedTours.length||(this.selectedTours=[],this.shownLegs=[],this.stopActivities=[],this.shownDepots=[]),this.selectedTours.push(e);const{shipmentIdsInTour:t,stopActivities:s}=this.processActivitiesInTour(e);this.shipmentIdsInTour=t;let i=0;for(const r of e.legs)this.addRouteToMap(e,r,i++);this.stopActivities=this.stopActivities.concat(s)},addRouteToMap(e,t,s){const i=[[this.links[t.links[0]][0],this.links[t.links[0]][1]]];for(const r of t.links){const n=i[i.length-1],o=[this.links[r][0],this.links[r][1]];(o[0]!==n[0]||o[1]!==n[1])&&i.push(o),i.push([this.links[r][2],this.links[r][3]])}this.shownLegs=this.shownLegs.concat([{tour:e,shipmentsOnBoard:t.shipmentsOnBoard,totalSize:t.totalSize,count:s,points:i,color:this.rgb[(3+i.length)%this.rgb.length],type:"leg"}])},handleSelectLspButton(e){this.showCarrierToursList=!1,this.activeTab="lspTours",this.selectedCarrier="",this.handleSelectLsp(e,!1,null)},handleSelectLspFromList(e){this.showCarrierToursList=!1,this.lspShipmentDirectChains.length==0&&this.lspShipmentHubChains.length==0?this.activeTab="lspShipmentChains":this.activeTab="shipments",this.selectedCarrier=this.getFirstCarrierFromSelectedLsp(e),this.vizSettings.showEachCarrierTour=!1,this.handleSelectLsp(e,!1,null)},handleSelectLsp(e,t,s){this.globalHubChainBoolean=t,typeof e=="string"&&(e=this.lsps.find(o=>o.$id===e)),this.lspToursAll=[],this.lspCarriers=[],this.lspHubChainCarriers=[],this.allHubChains=[];const i=e.LspPlans.LspPlan.find(o=>o.$selected=="true");i.logisticChains.logisticChain.forEach(o=>{if(o.$id.includes("direct")||o.$id.includes("Direct"))this.lspCarriers.push(o.logisticChainElement[0].$resourceId);else if(o.$id.includes("hub")||o.$id.includes("Hub")){let l=[];l.push(o);let a=0;l.forEach(c=>{let p={chainIds:[],chainIndex:a};c.logisticChainElement.forEach(h=>{p.chainIds.push(h.$resourceId),this.allCarrierHubIds.push(h.$resourceId)}),this.allHubChains.push(p),a++})}}),this.lspHubChainCarriers=this.allHubChains;const r=e.$id;this.selectedLsp=r,this.lspCarrier=this.carriers.filter(o=>o.$id==i.logisticChains.logisticChain[0].logisticChainElement[0].$resourceId)[0],this.lspCarrier==null&&console.error("no logistic chain elements for lsp Plan."),this.shipments=this.processShipments(this.lspCarrier),this.lspShipmentChains=[],this.lspShipmentChains.push(this.processLogisticChains(this.shipments)),this.shownShipments=[],this.shownShipments=this.shipments;let n=e.LspPlans.LspPlan.find(o=>o.$selected==="true");this.lspChainToursAll=[],n.logisticChains.logisticChain.forEach(o=>{s!=null&&t?JSON.stringify(this.allHubChains[s].chainIds)==JSON.stringify(o.logisticChainElement.flatMap(l=>l.$resourceId))&&(this.allHubChains[s].chainIds.forEach(l=>{this.handleSelectCarrier(l,!0,"")}),this.selectedCarrier="",this.lspToursAll=this.lspChainToursAll):s==null&&!t&&(this.lspHubChainTours="",this.selectedLspHubChainTours="Hub_Chain_0",o.logisticChainElement.forEach(l=>{let a=this.processTours(l);a.length>0&&this.lspChainToursAll.push(a)}),this.lspToursAll=[...this.lspChainToursAll].flat())}),this.selectAllLspTours()},getCarrierServicesForHubChain(e,t){if(this.activeTab=="lspTours"||this.activeTab=="tours"){if(this.lspHubChainTours===this.selectedLspHubChainTours){this.lspHubChainTours="Hub Chain0",this.selectedLspHubChainTours="",this.selectedCarrier="",console.log("carriers unselected - TRIGGER THE LSP!"),this.handleSelectLsp(this.lsps.find(s=>s.$id==this.selectedLsp),!1,null);return}this.lspHubChainTours="Hub_Chain_"+t,this.selectedLspHubChainTours="Hub_Chain_"+t,this.showCompleteHubChain=!0,this.handleSelectLsp(e,!0,t)}},handleSelectCarrier(e,t,s){console.log("---handleSelectCarrier");let i={};if(M(e)=="string"?i=this.carriers.find(h=>h.$id===e):i=this.carriers.find(h=>h.$id===e.$id),this.showHub=!1,this.hubLocation=[],i==null){this.shipments=[],this.hubLocation=[],this.lspShipmentChains=[];let u=this.lsps.find(d=>d.$id==this.selectedLsp).resources.hub.find(d=>d.$id==e);this.hubLocation.push(.5*(this.links[u.$location][0]+this.links[u.$location][2])),this.hubLocation.push(.5*(this.links[u.$location][1]+this.links[u.$location][3])),this.hubName=e,this.showHub=!0,this.globalHubChainBoolean||(this.selectedCarrier=e,this.lspHubChainTours="",this.selectedLspHubChainTours="Hub_Chain_0");return}if(this.dropdownIsActive=!1,!this.links)return;const r=i.$id;if(this.vehicles=[],this.shipments=[],this.services=[],this.plans=[],this.shownShipments=[],this.shownDepots=[],this.selectedShipment=null,this.shipmentIdsInTour=[],this.stopActivities=[],this.shownLegs=[],this.selectedCarrier===r&&t&&!this.globalHubChainBoolean){this.selectedCarrier="",console.log("--- carriers unselected - TRIGGER THE LSP!"),this.handleSelectLsp(this.lsps.find(h=>h.$id==this.selectedLsp),!1,null);return}s=="direct"&&(this.lspHubChainTours="",this.selectedLspHubChainTours="Hub_Chain_0"),this.globalHubChainBoolean||(this.selectedCarrier=r),this.setupDepots(),this.shipments=this.processShipments(i),this.lspShipmentChains=[],this.lspShipmentChains.push(this.processLogisticChains(this.shipments)),i.services?.service?.length&&(this.services=i?.services.service.map(h=>h.$).sort((h,u)=>v(h.$id,u.$id))),this.shownShipments=this.shipments,this.lspChainTours=[],this.lspChainToursAll=[];let n={};this.lsps.forEach(h=>{h.resources.carrier.find(u=>u.$id==i.$id)&&(n=h)});let o={};n.LspPlans.LspPlan.forEach(h=>{h.$selected==="true"&&(o=h)}),this.carrierTours=[];let l=o.logisticChains.logisticChain.find(h=>h.$id.includes("Direct")||h.$id.includes("direct")),a=o.logisticChains.logisticChain.find(h=>h.$id.includes("Hub")||h.$id.includes("hub")),c=[],p=[];l&&l.logisticChainElement.forEach(h=>{c.push(h.$resourceId)}),a&&a.logisticChainElement.forEach(h=>{p.push(h.$resourceId)}),c.find(h=>h===i.$id)?l.logisticChainElement.forEach(h=>{h.$resourceId===i.$id&&this.carrierTours.push(this.processTours(h))}):p.find(h=>h===i.$id)&&a.logisticChainElement.forEach(h=>{h.$resourceId===i.$id&&this.carrierTours.push(this.processTours(h)),this.lspChainTours.push(this.processTours(h))}),this.lspChainTours.forEach(h=>{this.lspChainToursAll=this.lspChainToursAll.concat(h)}),this.lspChainToursAll.length==0?this.lspChainToursAll.push(this.carrierTours):this.lspChainToursAll.concat(this.carrierTours),this.activeTab!="lspTours"&&this.activeTab!="tours"&&!this.allCarrierHubIds.includes(e)&&(this.activeTab="shipments"),this.activeTab!="lspTours"&&this.activeTab!="tours"&&this.allCarrierHubIds.includes(e)&&(this.activeTab="lspShipmentChains"),this.selectAllTours()},getAllPlans(e){if(e.plan!=null){this.plans.push(e.plan),this.selectedPlan=e.plan;return}if(e.plans!=null){if(e.plans.plan.length==null){this.plans.push(e.plans.plan),this.selectedPlan=e.plans.plan;return}this.plans=e.plans.plan;for(let t=0;t<e.plans.plan.length;t++){if(e.plans.plan[t].selected=="true"){this.selectedPlan=e.plans.plan[t];break}this.selectedPlan=e.plans.plan[t]}}},processTours(e){let t=this.carriers.find(s=>s.$id===e.$resourceId);if(t!=null){this.getAllPlans(t),Array.isArray(this.selectedPlan.tour)||(this.selectedPlan.tour=[this.selectedPlan.tour]);const s=this.selectedPlan.tour.map((i,r)=>{const n=[i.act[0]],o=new Set;for(let c=1;c<i.act.length;c++)i.leg[c-1].shipmentsOnBoard=[...o],n.push(i.leg[c-1]),n.push(i.act[c]),i.act[c].$type=="pickup"&&i.act[c].$shipmentId&&o.add(i.act[c].$shipmentId),i.act[c].$type=="delivery"&&i.act[c].$shipmentId&&o.delete(i.act[c].$shipmentId);const l=i.leg.filter(c=>c.route&&c.route.length).map(c=>{const p=c.shipmentsOnBoard.map(u=>this.shipmentLookup[u]),h=p.reduce((u,d)=>u+parseFloat(d?.$size||0),0);return{shipmentsOnBoard:p,totalSize:h,links:c.route?c.route.split(" "):[]}});return{vehicleId:i.$vehicleId,tourId:i.$tourId,plan:n,legs:l,tourNumber:0,carrier:e.$resourceId}});return s.sort((i,r)=>v(i.vehicleId,r.vehicleId)),s.forEach((i,r)=>i.tourNumber=r),s}else return[]},processLogisticChains(e){this.lspShipmentHubChains=[],this.lspShipmentDirectChains=[];let t=this.lsps.find(r=>r.$id===this.selectedLsp);for(let r=0;r<t.LspPlans.LspPlan.length;r++)t.LspPlans.LspPlan[r].$selected=="true"&&(this.lspPlan=t.LspPlans.LspPlan[r]);let s=0;for(let r=0;r<this.lspPlan.shipmentPlans.shipmentPlan.length;r++){let n=e.find(o=>o.$id==this.lspPlan.shipmentPlans.shipmentPlan[r].$shipmentId);if(n)try{let o={isDirectChain:!0,hubs:[],from:n.$from,to:n.$to,fromX:.5*(this.links[n.$from][0]+this.links[n.$from][2]),fromY:.5*(this.links[n.$from][1]+this.links[n.$from][3]),toX:.5*(this.links[n.$to][0]+this.links[n.$to][2]),toY:.5*(this.links[n.$to][1]+this.links[n.$to][3]),chainId:this.lspPlan.shipmentPlans.shipmentPlan[r].$chainId,route:[],color:0,shipmentId:n.$id};if(o.chainId.includes("direct"))this.lspShipmentDirectChains.push(o);else if(o.chainId.includes("hub")){o.isDirectChain=!1;for(let l=0;l<this.lspPlan.shipmentPlans.shipmentPlan[r].element.length;l++){let a=t.resources.hub.find(c=>c.$id==this.lspPlan.shipmentPlans.shipmentPlan[r].element[l].$resourceId);if(a){let c={id:this.lspPlan.shipmentPlans.shipmentPlan[r].element[l].$resourceId,location:a.$location,locationX:.5*(this.links[a.$location][0]+this.links[a.$location][2]),locationY:.5*(this.links[a.$location][1]+this.links[a.$location][3])};o.hubs.push(c)}}o.route.push([o.fromX,o.fromY]),o.hubs.forEach(l=>{o.route.push([l.locationX,l.locationY])}),o.route.push([o.toX,o.toY]),o.color=this.rgb[(3+o.route.length)%this.rgb.length],this.lspShipmentHubChains.push(o)}}catch{console.log(n.$id+": can't be parsed: links missing, plan not parsed, etc"),s+=1}}return s&&this.$emit("error",`Warning: ${s} of ${this.lspPlan.shipmentPlans.shipmentPlan.length} shipments could not be parsed.`),{hubsChains:this.lspShipmentHubChains,directChains:this.lspShipmentDirectChains}},processShipments(e){this.shipmentLookup={};let t={};if(this.lsps.forEach(o=>{o.resources.carrier.find(l=>l.$id==e.$id)&&(t=o)}),!t.shipments?.shipment?.length)return[];this.carriers.forEach(o=>{o.$id==e.$id});const s=t.LspPlans.LspPlan.find(o=>o.$selected=="true"),i=[];s.shipmentPlans.shipmentPlan.forEach(o=>{o.element.forEach(l=>{l.$resourceId==e.$id&&i.push(o.$shipmentId)})});let r=[];[...new Set(i)].forEach(o=>{t.shipments.shipment.find(l=>{l.$id==o&&r.push(l)})}),r=r.sort((o,l)=>v(o.$id,l.$id));try{r.forEach(o=>{o.fromX=.5*(this.links[o.$from][0]+this.links[o.$from][2]),o.fromY=.5*(this.links[o.$from][1]+this.links[o.$from][3]),o.toX=.5*(this.links[o.$to][0]+this.links[o.$to][2]),o.toY=.5*(this.links[o.$to][1]+this.links[o.$to][3]),this.shipmentLookup[o.$id]=o})}catch{}return r},addToSet(e,t){Array.from(e).some(i=>JSON.stringify(i)===JSON.stringify(t))||e.add(t)},buildRouteFromUrl(){const e=this.$route.params;if(!e.project||!e.pathMatch){console.log("I CANT EVEN: NO PROJECT/PARHMATCH");return}const t=1+e.pathMatch.lastIndexOf("/"),s=e.pathMatch.substring(0,t),i=e.pathMatch.substring(t);this.myState.subfolder=s,this.myState.yamlConfig=i},async getVizDetails(){if(this.config){this.vizDetails=Object.assign({},this.config),this.sync3dBuildingsSetting();return}if(this.yamlConfig?.endsWith("yaml")||this.yamlConfig?.endsWith("yml"))try{const i=this.yamlConfig.indexOf("/")>-1?this.yamlConfig:this.subfolder+"/"+this.yamlConfig,r=await this.fileApi.getFileText(i);this.vizDetails=x.parse(r),this.sync3dBuildingsSetting();return}catch(i){console.log("failed"+i);const r=i;this.fileSystem.needPassword&&r.status===401?m.commit("requestLogin",this.fileSystem.slug):this.$emit("error",""+i);return}const e=this.myState.yamlConfig.substring(0,15+this.myState.yamlConfig.indexOf("carriers")),{files:t}=await this.fileApi.getDirectory(this.myState.subfolder);let s=this.myState.yamlConfig.replaceAll("carriers","network");if(t.indexOf(s)==-1){const i=t.filter(r=>r.indexOf("network")>-1);i.length?s=i[0]:(this.myState.statusMessage="No road network found.",s="")}this.vizDetails={lsps:this.yamlConfig,network:s,carriers:"",title:e,description:"",center:this.vizDetails.center,projection:"",thumbnail:"",colors:{}},this.sync3dBuildingsSetting()},sync3dBuildingsSetting(){this.show3dBuildings=!!(this.vizDetails.buildings3d??this.vizDetails.show3dBuildings)},toggle3dBuildings(){this.show3dBuildings=!this.show3dBuildings},async setMapCenter(){let e=0,t=0,s=0;if(this.vizDetails.center)typeof this.vizDetails.center=="string"&&(this.vizDetails.center=this.vizDetails.center.split(",").map(Number)),t=this.vizDetails.center[0],s=this.vizDetails.center[1];else if(!this.vizDetails.center){if(this.data=Object.entries(this.links),!this.data.length)return;const i=this.data.length/2,r=4096;for(let n=0;n<i;n+=r)t+=this.data[n*2][1][0],s+=this.data[n*2+1][1][1],e++;t=t/e,s=s/e}t&&s&&this.$store.commit("setMapCamera",{longitude:t,latitude:s,zoom:9,bearing:0,pitch:0,jump:!1})},handleClick(e){console.log("CLICK!",e),e||this.clickedEmptyMap(),e?.type=="depot"&&this.clickedDepot(e),e?.type=="leg"&&this.clickedLeg(e)},clickedDepot(e){const t=Object.values(e.vehicles).map(s=>s.$id);this.selectedTours=[],this.shownShipments=[];for(const s of this.lspChainToursAll)t.includes(s.vehicleId)&&(this.handleSelectTour(s),this.shipmentIdsInTour.forEach(i=>{this.shownShipments.push(this.shipmentLookup[i])}))},clickedLeg(e){e?.tour&&this.handleSelectTour(e?.tour)},clickedEmptyMap(){},updateLegendColors(){},async loadLSPS(){const e=await this.loadFileOrGzippedFile(this.vizDetails.lsps);return e?(await P(e,{alwaysArray:["lsps.lsp","lsps.lsp.resources.carrier","lsps.lsp.resources.hub","lsps.lsp.shipments.shipment","lsps.lsp.LspPlans.LspPlan","lsps.lsp.LspPlans.LspPlan.logisticChains.logisticChain","lsps.lsp.LspPlans.LspPlan.logisticChains.logisticChain.logisticChainElement","lsps.lsp.LspPlans.LspPlan.shipmentPlans.shipmentPlan","lsps.lsp.LspPlans.LspPlan.shipmentPlans.shipmentPlan.element"]})).lsps.lsp.sort((i,r)=>v(i.$id,r.$id)):[]},async loadLinksCsv(){const e=await this.loadFileOrGzippedFile("output_links.csv.gz");return e&&[]},async loadCarriers(){var e=[];this.lsps.forEach(r=>{r.resources.carrier.forEach(n=>{e.includes(n)||e.push(n)})});const t=await this.loadFileOrGzippedFile("output_carriers.xml.gz");if(!t)return console.log("can't find carriers"),[];var i=(await P(t,{alwaysArray:["carriers.carrier","carriers.carrier.capabilities.vehicles.vehicle","carriers.carrier.plan.tour","carriers.carrier.shipments.shipment","carriers.carrier.services.service"]})).carriers.carrier.sort((r,n)=>v(r.$id,n.$id));return e.forEach(r=>{if(i.filter(o=>o.$id===r.$id).length==0){let o={$id:r.$id,attributes:{},capabilities:{},plans:{},services:{}};i.push(o)}}),i},async loadAvroRoadNetwork(){console.log("LOADING AVRO:",this.vizDetails.network);const e=`${this.subfolder}/${this.vizDetails.network}`,t=await this.fileApi.getFileBlob(e),s=await new Promise((i,r)=>{const n=[];W.createBlobDecoder(t).on("metadata",o=>{}).on("data",o=>{n.push(o)}).on("end",()=>{i(n)})});return console.log(s[0]),s[0]},async loadNetwork(){if(this.myState.statusMessage="Loading network...",this.vizDetails.network.indexOf(".xml.")>-1||this.vizDetails.network.endsWith(".avro")){const e=await this.myDataManager.getRoadNetwork(this.vizDetails.network,this.subfolder,this.vizDetails,null,!0);this.vizDetails.projection="EPSG:4326",this.myState.statusMessage="Building network link table";const t={};return e.linkId.forEach((s,i)=>{t[s]=[e.source[i*2],e.source[i*2+1],e.dest[i*2],e.dest[i*2+1]]}),t}else if(this.vizDetails.network.indexOf(".avro")>-1){this.avroNetwork=await this.loadAvroRoadNetwork();const e={};if(this.avroNetwork){const t=this.avroNetwork?.nodeCoordinates;this.avroNetwork.linkId.forEach((s,i)=>{const r=2*this.avroNetwork.from[i],n=2*this.avroNetwork.to[i];e[s]=[t[r],t[1+r],t[n],t[1+n]]})}return this.vizDetails.projection="EPSG:4326",console.log(e[6e3]),e}else return await this.fileApi.getFileJson(this.myState.subfolder+"/"+this.vizDetails.network)},async fetchNetwork(e,t){return new Promise((s,i)=>{const r=new R;try{r.postMessage({filePath:e,fileSystem:this.fileSystem,vizDetails:t}),r.onmessage=n=>{if(n.data.promptUserForCRS){let o=prompt("Enter the coordinate reference system, e.g. EPSG:25832")||"EPSG:31468";Number.isFinite(parseInt(o))&&(o=`EPSG:${o}`),r.postMessage({crs:o});return}if(n.data.status){this.myState.statusMessage=""+n.data.status;return}r.terminate(),n.data.error&&(console.error(n.data.error),m.commit("error",n.data.error),this.myState.statusMessage=n.data.error,i(n.data.error)),s(n.data.links)}}catch(n){r.terminate(),console.error(n),i(n)}})},toggleLoaded(e){this.isLoaded=e},rotateColors(){localStorage.setItem("plugin/agent-animation/colorscheme",this.globalState.isDarkMode?_.DarkMode:_.LightMode)},async loadFileOrGzippedFile(e){let t=`${this.subfolder}/${e}`;try{if(t.indexOf("*")>-1||t.indexOf("?")>-1){const r=t.substring(1+t.lastIndexOf("/")),n=t.substring(0,t.lastIndexOf("/")),{files:o}=await this.fileApi.getDirectory(n),l=z(o,r);if(l.length==0)throw Error(`No files matched "${r}"`);if(l.length>1)throw Error(`More than one file matched "${r}": ${l}`);t=`${n}/${l[0]}`}let i="";if(t.endsWith("xml")||t.endsWith("gz")){const n=await(await this.fileApi.getFileBlob(t)).arrayBuffer(),o=await E(n);return new TextDecoder("utf-8").decode(o)}}catch{}const s=`Error loading ${t}`;return m.commit("error",s),this.myState.statusMessage=s,""},selectDropdown(){this.dropdownIsActive=!this.dropdownIsActive},selectPlan(e){for(let t=0;t<this.plans.length;t++)this.plans[t].$selected="false";e.$selected="true",this.selectedPlanIndex=this.plans.indexOf(e),this.selectedTours=[],this.selectDropdown(),this.selectedPlan=e},getFirstCarrierFromSelectedLsp(e){return e.LspPlans.LspPlan.find(s=>s.$selected=="true").logisticChains.logisticChain[0].logisticChainElement[0].$resourceId}},async mounted(){if(m.commit("setFullScreen",!this.thumbnail),this.myState.thumbnail=this.thumbnail,this.myState.subfolder=this.subfolder,this.yamlConfig||this.buildRouteFromUrl(),await this.getVizDetails(),this.thumbnail)return;this.showHelp=!1,this.updateLegendColors();let e=this.vizDetails.title||"Logistic Viewer";this.$emit("title",e),this.myState.statusMessage="Loading carriers...",await this.$nextTick();try{this.lsps=await this.loadLSPS(),this.carriers=await this.loadCarriers()}catch(t){this.lsps||this.$emit("error","Error loading LSP:"+t),this.carriers||this.$emit("error","Error loading carriers:"+t);return}await this.$nextTick();try{this.links=await this.loadNetwork()}catch(t){this.$emit("error","Error loading network: "+t);return}this.setMapCenter(),this.myState.statusMessage="",this.lsps.length&&this.handleSelectLsp(this.lsps[0],!1,null),this.lspShipmentHubChains.length>0?this.activeTab="lspShipmentChains":this.activeTab="shipments",this.lspChainTours.length&&this.selectAllTours(),this.selectedCarrier=this.getFirstCarrierFromSelectedLsp(this.lsps[0]);try{this.backgroundLayers=new G({vizDetails:this.vizDetails,fileApi:this.fileApi,subfolder:this.subfolder}),await this.backgroundLayers.initialLoad()}catch{this.$emit("error","Error loading background layers")}},beforeDestroy(){this.myState.isRunning=!1,m.commit("setFullScreen",!1),this.$store.commit("setFullScreen",!1)}});var lt=function(){var t=this,s=t._self._c;return t._self._setupProxy,s("div",{staticClass:"carrier-viewer",class:{"hide-thumbnail":!t.thumbnail},attrs:{oncontextmenu:"return false"}},[s("div",{staticClass:"container-1",on:{mousemove:t.dividerDragging,mouseup:t.dividerDragEnd}},[s("div",{staticClass:"main-panel"},[t.vizDetails.projection&&!t.thumbnail?s("deck-map",{staticClass:"anim",attrs:{activeTab:t.activeTab,bgLayers:t.backgroundLayers,carrierServices:t.carrierServicesAll,center:t.vizDetails.center,colors:t.vizDetails.colors||{},dark:t.globalState.isDarkMode,depots:t.shownDepots,hubLocation:t.hubLocation,hubName:t.hubName,legs:t.shownLegs,lspShipmentChains:t.lspShipmentChains,numSelectedTours:t.selectedTours.length,onClick:t.handleClick,projection:t.vizDetails.projection,settings:t.vizSettings,shipments:t.shownShipments,showCompleteHubChain:t.showCompleteHubChain,showHub:t.showHub,stopActivities:t.stopActivities,tourHubs:t.tourHubs,viewId:t.linkLayerId,show3dBuildings:t.show3dBuildings}}):t._e(),t.thumbnail?t._e():s("ZoomButtons",{attrs:{corner:"top-left",show3dToggle:!0,is3dBuildings:t.show3dBuildings,onToggle3dBuildings:t.toggle3dBuildings}}),t.myState.statusMessage?s("div",{staticClass:"xmessage"},[t._v(t._s(t.myState.statusMessage))]):t._e()],1),s("div",{staticClass:"dragger",on:{mousedown:t.dividerDragStart,mouseup:t.dividerDragEnd,mousemove:function(i){return i.stopPropagation(),t.dividerDragging.apply(null,arguments)}}}),s("div",{staticClass:"right-panel",style:{width:`${t.legendSectionWidth}px`},attrs:{darkMode:!0}},[t.lsps.length?s("h3",{staticStyle:{"margin-left":"0.25rem"}},[t._v(t._s("Service Providers"))]):t._e(),s("div",{staticClass:"lsp-list"},t._l(t.lsps,function(i){return s("div",{key:i.$id,staticClass:"lsp",class:{selected:i.$id===t.selectedLsp},on:{click:function(r){return t.handleSelectLspFromList(i)}}},[s("div",{staticClass:"lsp-title"},[t._v(t._s(i.$id))])])}),0),s("h4",[t._v(t._s(t.selectedLsp||"Details"))]),t.selectedLsp?s("b-field",{staticClass:"detail-buttons",attrs:{size:"is-small"}},[t.checkIfDirectChain()?s("b-radio-button",{attrs:{"native-value":"shipments",size:"is-small",type:"is-warning"},nativeOn:{click:function(i){return t.handleSelectCarrier(t.lspCarrier,!1,"")}},model:{value:t.activeTab,callback:function(i){t.activeTab=i},expression:"activeTab"}},[s("span",[t._v(t._s(t.$t("Shipment Chains")))])]):t._e(),t.checkIfHubChain()?s("b-radio-button",{attrs:{"native-value":"lspShipmentChains",size:"is-small",type:"is-warning"},nativeOn:{click:function(i){return t.handleSelectCarrier(t.lspCarrier,!1,"")}},model:{value:t.activeTab,callback:function(i){t.activeTab=i},expression:"activeTab"}},[s("span",[t._v(t._s(t.$t("Shipment Chains")))])]):t._e(),s("b-radio-button",{staticStyle:{},attrs:{"native-value":"lspTours",size:"is-small",type:"is-warning"},nativeOn:{click:function(i){return t.handleSelectLspButton(t.selectedLsp)}},model:{value:t.activeTab,callback:function(i){t.activeTab=i},expression:"activeTab"}},[s("span",[t._v(t._s(t.$t("LSP Tours")))])])],1):t._e(),s("br"),s("br"),t.activeTab=="lspTours"||t.activeTab=="tours"?s("h6",[s("b",[t._v("*All Carriers shown. Please select individual Carrier to view its specific tours.")])]):t._e(),s("br"),t.lsps.length?s("h3",{staticStyle:{"margin-left":"0.25rem"}},[t._v(t._s("Carriers"))]):t._e(),s("div",{staticClass:"carrier-list",attrs:{"data-testid":"carrier-list"}},[s("h5",{staticStyle:{"font-weight":"bold"}},[t._v(t._s("Direct Chain Carriers:"))]),t._l(t.lspCarriers,function(i){return s("div",{key:i,staticClass:"carrier",class:{selected:i==t.selectedCarrier},on:{click:function(r){return t.handleSelectCarrier(i,!0,"direct")}}},[s("div",{staticClass:"carrier-title"},[t._v(t._s(i))])])}),s("br"),s("h5",{staticStyle:{"font-weight":"bold"}},[t._v(t._s("Hub Chain Carriers:")),t._l(t.allHubChains,function(i){return s("div",{key:i.chainIndex,staticClass:"carrierHub"},[s("div",{staticClass:"carrierHubTitle",class:{selected:t.lspHubChainTours===t.selectedLspHubChainTours},staticStyle:{"font-weight":"bold"},attrs:{name:""},on:{click:function(r){return t.getCarrierServicesForHubChain(t.selectedLsp,i.chainIndex)}}},[t._v(t._s("Hub Chain "+i.chainIndex+":"))]),t._l(i.chainIds,function(r){return s("div",{key:r,staticClass:"carrier",class:{selected:r===t.selectedCarrier},on:{click:function(n){return t.handleSelectCarrier(r,!0,"")}}},[s("div",{staticClass:"carrier-title"},[t._v(t._s(r))])])})],2)})],2)],2),s("h4",[t._v(t._s(t.selectedCarrier||"Details"))]),s("div",{staticClass:"switchbox"},[s("div",{staticClass:"switches"},[(t.activeTab=="lspTours"||t.activeTab=="tours")&&t.selectedCarrier!=""?s("b-switch",{model:{value:t.vizSettings.showEachCarrierTour,callback:function(i){t.$set(t.vizSettings,"showEachCarrierTour",i)},expression:"vizSettings.showEachCarrierTour"}},[s("span",{domProps:{innerHTML:t._s(t.$t("Carrier Tours"))}})]):t._e()],1)]),s("div",{staticClass:"detail-area"},[t.activeTab=="lspShipmentChains"?s("div",{staticClass:"lspShipmentChains"},[s("span",[t._v(t._s(t.$t("Lsp Shipments"))+": "+t._s(t.lspShipmentHubChains.length))]),t._l(t.lspShipmentHubChains,function(i,r){return s("div",{key:`${r}-${i.shipmentId}`,staticClass:"leaf tour",class:{selected:i==t.selectedLSPChain},on:{click:function(n){return t.handleSelectShipmentChain(i)}}},[t._v(t._s(`${i.shipmentId}: ${i.chainId}`))])})],2):t._e(),t.activeTab=="shipments"?s("div",{staticClass:"lspShipmentChains"},[s("span",[t._v(t._s(t.$t("Shipments"))+": "+t._s(t.shipments.length))]),t._l(t.shipments,function(i,r){return s("div",{key:`${r}-${i.$id}`,staticClass:"leaf tour",class:{selected:i==t.selectedShipment},on:{click:function(n){return t.handleSelectShipment(i)}}},[t._v(t._s(`${i.$id}`))])})],2):t._e(),t.activeTab=="lspTours"&&t.selectedCarrier&&t.hubLocation.length==0?s("div",{staticClass:"tours"},[s("span",[t._v(t._s(t.$t("tours"))+": "+t._s(t.carrierTours[0].length))]),t._l(t.carrierTours[0],function(i,r){return s("div",{key:`${r}-${i.$id}`,staticClass:"leaf tour",class:{selected:t.selectedTours.includes(i)},on:{click:function(n){return t.handleSelectTour(i)}}},[i.tourId?s("div",{staticClass:"carrier-tours"},[i.tourId&&t.vizSettings.showEachCarrierTour?s("div",{style:{backgroundColor:t.getTourColor(i.tourId,i.tourNumber)},attrs:{id:"tourColor"}}):t._e(),i.tourId&&!t.vizSettings.showEachCarrierTour?s("div",{style:{backgroundColor:t.getLspTourColor(i)},attrs:{id:"tourColor"}}):t._e(),i.tourId?s("div",{attrs:{id:"tour"}},[t._v(t._s(i.tourId)+": "+t._s(`${i.vehicleId}`))]):s("div",[t._v(t._s(`${i.vehicleId}`))])]):t._e()])})],2):t._e(),t.activeTab=="lspTours"&&!t.selectedCarrier||t.globalHubChainBoolean?s("div",{staticClass:"lsptours"},[s("span",[t._v(t._s(t.$t("tours"))+": "+t._s(t.lspToursAll.length))]),t._l(t.lspToursAll,function(i,r){return s("div",{key:`${r}-${i.$id}`,staticClass:"leaf tour",class:{selected:t.selectedTours.includes(i)},on:{click:function(n){return t.handleSelectTour(i)}}},[i.tourId?s("div",{staticClass:"lsp-tours"},[i.tourId?s("div",{style:{backgroundColor:t.getLspTourColor(i)},attrs:{id:"tourColor"}}):t._e(),i.tourId?s("div",[t._v(t._s(i.tourId)+": "+t._s(`${i.vehicleId}`))]):s("div",[t._v(t._s(`${i.vehicleId}`))])]):t._e()])})],2):t._e()]),s("div",{staticClass:"switchbox"},[t.activeTab=="shipments"||t.activeTab=="lspShipmentChains"?s("div",{staticClass:"switches"},[s("p",[t._v(t._s(t.$t("scaleSize")))]),t.activeTab=="lspShipmentChains"?s("b-slider",{staticClass:"slider",attrs:{tooltip:!1,type:"is-link",size:"is-small"},model:{value:t.vizSettings.scaleFactor,callback:function(i){t.$set(t.vizSettings,"scaleFactor",i)},expression:"vizSettings.scaleFactor"}}):t._e(),t.activeTab=="shipments"?s("b-slider",{staticClass:"slider",attrs:{tooltip:!1,type:"is-link",size:"is-small"},model:{value:t.vizSettings.scaleFactorShipments,callback:function(i){t.$set(t.vizSettings,"scaleFactorShipments",i)},expression:"vizSettings.scaleFactorShipments"}}):t._e()],1):t._e(),t.activeTab=="tours"||t.activeTab=="lspTours"?s("div",{staticClass:"addedSpace"},[s("br")]):t._e(),t.activeTab=="tours"||t.activeTab=="lspTours"?s("div",{staticClass:"switches"},[s("b-switch",{model:{value:t.vizSettings.shipmentDotsOnTourMap,callback:function(i){t.$set(t.vizSettings,"shipmentDotsOnTourMap",i)},expression:"vizSettings.shipmentDotsOnTourMap"}},[s("span",{domProps:{innerHTML:t._s(t.$t("shipmentDots"))}})]),s("b-switch",{model:{value:t.vizSettings.simplifyTours,callback:function(i){t.$set(t.vizSettings,"simplifyTours",i)},expression:"vizSettings.simplifyTours"}},[s("span",{domProps:{innerHTML:t._s(t.$t("flatten"))}})])],1):t._e()])],1)])])},at=[],ht=w(nt,lt,at,!1,null,"3801fff2");const Xt=ht.exports;export{Xt as default};
