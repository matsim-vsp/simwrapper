import{V as d,n as a,d as m,g as f}from"./index-D_sw2g-2.js";import{a as u}from"./index-CCqgbF9K.js";import{H as p}from"./HTTPFileSystem-ChhivMzi.js";import{W as v}from"./NewXmlFetcher.worker-DdEXgVTv.js";import"./fxp-DjoqftHf.js";const b=d.component("tree-item",{props:{item:{type:Object,required:!0},expandAll:{type:Boolean},level:{type:Number},numberOfUnfoldLevel:{type:Number}},data(){return{isOpen:this.expandAll,text:"",elementId:"",children:[],attributes:[]}},mounted(){const i={...this.item};this.attributes=this.getAttributes(i),delete i[":@"];const e=Object.keys(i);e.length!==1&&console.log("WHAT",e),this.elementId=e[0],this.children=i[e[0]]||[],this.children.length===1&&this.children[0]["#text"]&&(this.text=this.children[0]["#text"],this.children=[]),this.level<this.numberOfUnfoldLevel+1?this.isOpen=!0:this.isOpen=this.expandAll},methods:{getAttributes(i){const e=i[":@"];return e?Object.entries(e).map(t=>{const[s,l]=t;return[s.startsWith("$$")?s.substring(2):s,l]}):[]},toggle(){this.isOpen=!this.isOpen}},computed:{isFolder(){return this.children.length>0}}});var x=function(){var e=this,t=e._self._c;return e._self._setupProxy,t("li",[t("div",{staticClass:"leaf-node",on:{click:e.toggle}},[t("div",{staticClass:"leaf-nav-title"},[e.children.length?t("div",{staticClass:"toggle"},[t("i",{staticClass:"fa",class:{"fa-plus-square":!e.isOpen,"fa-minus-square":e.isOpen},staticStyle:{"font-size":"0.7rem",margin:"5px 0 auto -8px"}})]):e._e(),t("b",{staticClass:"leaf-label"},[e._v(e._s(e.elementId))])]),e.text?t("div",{staticClass:"leaf-text"},[e._v("  "+e._s(e.text))]):e._e(),e._l(e.attributes,function(s){return t("div",{staticClass:"leaf-attribute"},[t("span",[e._v("  "+e._s(s[0])+": ")]),t("b",[e._v('"'+e._s(s[1])+'"')])])})],2),e.isFolder&&e.isOpen?t("ul",{staticClass:"children"},e._l(e.children,function(s,l){return t("tree-item",{key:l,staticClass:"item",attrs:{item:s,root:!1,expandAll:e.expandAll,numberOfUnfoldLevel:e.numberOfUnfoldLevel,level:e.level+1},on:{navigate:function(r){return e.$emit("navigate",r)}}})}),1):e._e()])},_=[],g=a(b,x,_,!1,null,"0883f91d");const y=g.exports,O=d.component("tree-view",{props:{initialData:{},expandAll:{type:Boolean},level:{type:Number},numberOfUnfoldLevel:{type:Number}},components:{TreeItem:y},data:function(){return{treeData:this.initialData}},methods:{}});var L=function(){var e=this,t=e._self._c;return e._self._setupProxy,t("ul",[t("tree-item",{staticClass:"item",attrs:{item:e.treeData||{},expandAll:e.expandAll,level:e.level+1,numberOfUnfoldLevel:e.numberOfUnfoldLevel}})],1)},w=[],C=a(O,L,w,!1,null,"f6b34187");const S=C.exports,$={messages:{en:{},de:{}}},k=!!window.showDirectoryPicker,T=!k,D=m({name:"XmlViewer",components:{TreeView:S},i18n:$,props:{root:{type:String,required:!0},subfolder:{type:String,required:!0},config:{type:Object},resize:Object,thumbnail:Boolean,yamlConfig:String},data(){return{globalState:f.state,vizDetails:{title:"",description:"",file:""},loadingText:"",id:`id-${Math.floor(1e12*Math.random())}`,xmlWorker:null,viewXml:{},fullXml:null,searchXml:null,searchTerm:"",debounceSearch:{},isLoaded:!1,isSearch:!1,numberOfUnfoldLevel:1}},watch:{searchTerm(){this.debounceSearch()}},computed:{fileApi(){return new p(this.fileSystem,f)},fileSystem(){const i=this.$store.state.svnProjects.filter(e=>e.slug===this.root);if(i.length===0)throw console.log("no such project"),Error;return i[0]}},async mounted(){this.debounceSearch=u(this.handleSearch,500);try{if(this.getVizDetails(),this.thumbnail)return;const i=await this.fetchXml();this.fullXml=i[1],this.viewXml=this.fullXml,this.isLoaded=!0}catch(i){const e=i;console.error({e}),this.loadingText=""+e}this.numberOfUnfoldLevel=this.config?.unfoldLevel??1},methods:{getVizDetails(){if(this.config)this.vizDetails={...this.config},this.vizDetails.file=`/${this.subfolder}/${this.config.file}`,this.$emit("titles",this.vizDetails.title||this.vizDetails.file||"XML");else{const i=this.yamlConfig??"";this.vizDetails={title:i,description:"",file:this.subfolder+"/"+i}}this.$emit("titles",this.vizDetails.title)},async fetchXml(){return this.loadingText=`Loading ${this.vizDetails.file}...`,this.xmlWorker&&this.xmlWorker.terminate(),this.xmlWorker=new v,new Promise((i,e)=>{this.xmlWorker.onmessage=t=>{if(this.xmlWorker.terminate(),t.data.error&&e(t.data.error),t.data.resolvedFilename&&!this.vizDetails.title){const s=t.data.resolvedFilename.lastIndexOf("/");s>-1&&this.$emit("titles","XML Config: "+t.data.resolvedFilename.slice(s+1))}i(t.data.xml)},this.xmlWorker.postMessage({id:1,fileSystem:this.fileSystem,filePath:this.vizDetails.file,options:{ignoreAttributes:!1,preserveOrder:!0,attributeNamePrefix:"$$",isFirefox:T}})})},async handleSearch(){if(console.log("search:",this.searchTerm),!this.searchTerm)this.viewXml=this.fullXml,this.isSearch=!1;else{const i=this.findSearchTermInElement([this.fullXml],this.searchTerm.toLocaleLowerCase());this.viewXml=i[0],this.isSearch=!0}this.isLoaded=!1,await this.$nextTick(),this.isLoaded=!0},findSearchTermInElement(i,e){if(e!==this.searchTerm.toLocaleLowerCase())return[];const t=[];for(const s of i){const l={...s};if(l[":@"]&&JSON.stringify(l[":@"]).toLocaleLowerCase().indexOf(e)>-1){t.push(s);continue}if(l["#text"]){`${l["#text"]}`.toLocaleLowerCase().indexOf(e)>-1&&t.push(s);continue}const r=l[":@"];delete l[":@"];const o=Object.keys(l)[0],c=l[o];if(!c.length)continue;const h=this.findSearchTermInElement(c,e);if(h.length){const n={};r&&(n[":@"]=r),n[o]=h,t.push(n)}}return t}}});var X=function(){var e=this,t=e._self._c;return e._self._setupProxy,t("div",{staticClass:"c-xmlviewer flex-col",class:{"is-thumbnail":e.thumbnail}},[t("b-input",{staticClass:"xml-searchbox",attrs:{type:"search","icon-pack":"fas",icon:"search",placeholder:"search..."},model:{value:e.searchTerm,callback:function(s){e.searchTerm=s},expression:"searchTerm"}}),t("div",{staticClass:"viewer"},[e.isLoaded?t("tree-view",{staticClass:"things",attrs:{initialData:e.viewXml,expandAll:e.isSearch,level:0,numberOfUnfoldLevel:e.numberOfUnfoldLevel}}):e._e()],1)],1)},z=[],A=a(D,X,z,!1,null,"a451fe59");const I=A.exports;export{I as default};
