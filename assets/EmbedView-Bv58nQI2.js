import{d as b,g as p,V as g,p as w,n as P}from"./index-D_sw2g-2.js";import{m as x}from"./HTTPFileSystem-ChhivMzi.js";import{T as y,S,F as $,E as v}from"./ErrorPanel-BiGfKPxL.js";import"./fxp-DjoqftHf.js";import"./index-DFKcNkqO.js";import"./index-CCqgbF9K.js";import"./SW_logo_white-BC-0sXUm.js";import"./TopSheet-D3y6zxfo.js";import"./DashboardDataManager-mkjvCydQ.js";import"./group-hI8ly2Wr.js";import"./index-_doEQLKC.js";const _={messages:{en:{close:"Close panel",back:"Go back"},de:{close:"Schließen",back:"Zurück"}}},l="/simwrapper/",C=b({name:"EmbeddedView",i18n:_,components:Object.assign({ErrorPanel:v,FolderBrowser:$,SettingsPanel:S,TabbedDashboardView:y},w),data:()=>({authHandles:[],errorPanelText:"",firstPanelProjectFolder:"",firstPanelSubfolder:"",isEmbedded:!0,isLeftPanelHidden:!0,isShowingActiveSection:!1,navRoot:"",panel:{},panelsWithScrollbars:["TabbedDashboardView","FolderBrowser","calc-table"],prevUrl:"BOOP~~",showSettings:!1,zoomed:!1}),computed:{isMultipanel(){return!1},activeSectionStyle(){return{display:"none"}}},watch:{},methods:{setProjectFolder(t){this.firstPanelProjectFolder=t},setPanelError(t){this.errorPanelText=""+(t.msg||t),t&&console.error("LMError: "+(t.msg||t))},async buildLayoutFromURL(){let t=this.$route.params?.pathMatch;if(!t)return;this.prevUrl=t,t?.startsWith("/")&&(t=t.slice(1));let e=t,s="";const o=t.indexOf("/");o>-1&&(e=t.substring(0,o),s=t.substring(o+1),s.startsWith("/")&&(s=s.slice(1)),s.endsWith("/")&&(s=s.slice(0,-1)));const r=t.substring(1+t.lastIndexOf("/")),a=r.toLocaleLowerCase();for(const n of p.state.visualizationTypes.values())if(x.isMatch(a,n.filePatterns)){let u=Math.random(),i=s.substring(0,s.lastIndexOf("/"));i.startsWith("/")&&(i=i.slice(1)),s=i,this.panel={key:u,component:n.kebabName,title:"",description:"",props:{root:e,subfolder:i,xsubfolder:s,yamlConfig:r,thumbnail:!1}};return}let f=Math.random();const d=this.$store.state.svnProjects.filter(n=>n.slug===e);if(!d.length)throw Error("no such project");const h=d[0],c=s.startsWith("/")?s.slice(1):s,m=c.substring(1+c.lastIndexOf("/"))||h.name;p.commit("setShowFilesTab",!0),this.panel={key:f,title:m,component:"TabbedDashboardView",props:{root:e,xsubfolder:c}}},getShowHeader(t){return!["SplashPage","TabbedDashboardView","SimRunner"].includes(t.component)},updateURL(t){this.$store.dispatch("gamepadStop"),this.firstPanelSubfolder=this.panel?.props?.xsubfolder||"";const e=this.panel?.props||{},s=e.root||"",o=e.xsubfolder||e.subfolder||"",r=e.yamlConfig||"";if(r.indexOf("/")>-1){const a=r.substring(r.lastIndexOf("/"));this.$router.replace(`${l}${s}/${o}/${a}`)}else if(r)this.$router.push(`${l}${s}/${o}/${r}`);else{let a=`${l}${s}/${o}`;e.config&&(a+=`/${e.config}`),t?.showFiles&&(a+="?tab=files"),this.$router.push(a)}},cleanProps(t){const{title:e,...s}=t;return s},setCardTitles(t,e){typeof e=="string"?(g.set(t,"title",e),t.description=""):(t.title=e.title,t.description=e.description||"")},getTileStyle(t){const e=p.state.isDarkMode,s={overflow:this.panelsWithScrollbars.includes(t.component)?"auto":"hidden"};return this.getShowHeader(t)&&(s.border="0px solid #4dd4ef90",s.backgroundColor=e?"black":"white",s.color=e?"white":"black",s.margin="4px 4px",s.padding="0 0"),s},getContainerStyle(t,e,s){return{padding:"0px 0px"}},gotData(t){const e=t.data.data;e&&(this.panel={component:"area-map",props:{root:"local",subfolder:"",configFromDashboard:Object.assign({xferdata:e},t.data.config)}})}},beforeDestroy(){window.removeEventListener("message",this.gotData)},async mounted(){this.isEmbedded=!0,window.addEventListener("message",this.gotData),this.$store.commit("setActiveLeftSection",""),this.$store.commit("setShowLeftBar",!1);const t=this.$route.params.pathMatch;if(t&&!t.endsWith("/")&&t.slice(t.lastIndexOf("/")).indexOf(".")==-1){const s=Object.entries(this.$route.query).map(([r,a])=>`${encodeURIComponent(r)}=${encodeURIComponent(a)}`).join("&");let o=`${l}${t}/`;s&&(o+="?"+s),history.replaceState({},"",o)}await this.buildLayoutFromURL(),this.firstPanelSubfolder=this.panel?.props?.xsubfolder||""}});var F=function(){var e=this,s=e._self._c;return e._self._setupProxy,s("div",{attrs:{id:"embed-view"}},[e.panel.component?s(e.panel.component,e._b({tag:"component",staticClass:"map-tile",style:e.getTileStyle(e.panel),attrs:{isMultipanel:!1,split:{row:0,col:0}},on:{title:function(o){return e.setCardTitles(e.panel,o)},projectFolder:e.setProjectFolder,error:e.setPanelError}},"component",e.cleanProps(e.panel.props),!1)):s("div",{staticClass:"waiting"},[s("h3",[e._v("SimWrapper")]),s("p",[e._v("waiting for data to load...")])]),e.errorPanelText?s("p",{staticClass:"error-text"},[e._v(e._s(e.errorPanelText)),s("span",{staticClass:"clear-error",on:{click:function(o){e.errorPanelText=""}}},[e._v("×")])]):e._e()],1)},T=[],E=P(C,F,T,!1,null,"0df8bd2c");const B=E.exports;export{B as default};
